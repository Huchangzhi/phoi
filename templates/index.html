<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>C++ 在线编辑器</title>
    <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <!-- VS Code 风格顶部菜单栏 -->
    <div id="top-menu-bar">
        <div id="menu-bar-left">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" id="logo">
            <div class="menu-item" id="file-menu">文件</div>
            <div class="menu-item" id="about-menu">关于</div>
        </div>
        <div id="menu-bar-center">
            <span id="current-file-name" class="current-file">new.cpp</span>
        </div>
        <div id="menu-bar-right">
            <!-- <button id="luogu-btn" class="tool-btn" title="洛谷题目"><img src="{{ url_for('static', filename='Luogu.png') }}" alt="Luogu" class="icon-btn"></button> -->
            <button id="run-btn" class="tool-btn" title="运行"><img src="{{ url_for('static', filename='debug.png') }}" alt="Run" class="icon-btn"></button>
            <button id="copy-btn" class="tool-btn" title="复制">❐</button>
            <button id="mode-toggle-btn" class="tool-btn">▲</button>
        </div>
    </div>

    <!-- 下拉菜单 -->
    <div id="file-dropdown" class="dropdown-menu" style="display: none;">
        <div class="dropdown-item" id="upload-file">上传文件</div>
        <div class="dropdown-item" id="download-file">下载文件</div>
        <div class="dropdown-item" id="save-as">另存为</div>
        <div class="dropdown-divider"></div>
        <div class="dropdown-item" id="new-file">新建文件</div>
    </div>

    <!-- 左侧边栏 -->
    <div id="left-sidebar">
        <div id="sidebar-toggle" class="sidebar-button" title="显示/隐藏虚拟文件系统"><img src="{{ url_for('static', filename='file.png') }}" alt="Files" class="icon-btn"></div>
        <div id="plugin-center-toggle" class="sidebar-button" title="插件中心"><img src="{{ url_for('static', filename='ext.png') }}" alt="Plugins" class="icon-btn"></div>
        <div id="cph-plugin-toggle" class="sidebar-button" title="CPH - 试题集管理"><img src="{{ url_for('static', filename='cph.png') }}" alt="CPH" class="icon-btn"></div>
    </div>

    <!-- 虚拟文件系统面板 -->
    <div id="vfs-panel" class="vfs-panel" style="display: none;">
        <div class="vfs-header">
            <span>资源管理器</span>
            <button id="vfs-close-btn" class="vfs-close-btn">×</button>
        </div>
        <div id="vfs-content" class="vfs-content">
            <div class="vfs-root">
                <div class="vfs-folder" data-path="/">根目录</div>
            </div>
        </div>
    </div>

    <!-- 插件中心面板 -->
    <div id="plugin-center-panel" class="vfs-panel" style="display: none;">
        <div class="vfs-header">
            <span>插件中心</span>
            <button id="plugin-center-close-btn" class="vfs-close-btn">×</button>
        </div>
        <div id="plugin-center-content" class="vfs-content">
            <!-- C++代码补全插件 -->
            <div class="plugin-item">
                <div class="plugin-header">C++代码补全</div>
                <div class="plugin-settings">
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="cpp-autocomplete-enabled" checked> 启用
                        </label>
                    </div>
                    <div class="setting-item">
                        <label for="cpp-autocomplete-delay">延迟时间(ms):</label>
                        <input type="number" id="cpp-autocomplete-delay" value="200" min="0">
                    </div>
                </div>
            </div>

            <!-- 查看洛谷主题库插件 -->
            <div class="plugin-item">
                <div class="plugin-header">查看洛谷主题库</div>
                <div class="plugin-header">题目来源于洛谷开放平台</div>
                <div class="plugin-settings">
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="luogu-theme-enabled"> 启用
                        </label>
                    </div>
                </div>
            </div>

            <!-- CPH插件 -->
            <div class="plugin-item">
                <div class="plugin-header">CPH - 测试用例管理</div>
                <div class="plugin-description">管理当前文件的测试用例，支持批量运行</div>
                <div class="plugin-settings">
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="cph-plugin-enabled"> 启用
                        </label>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- 3行预览区 (结构已修改，包含行号) -->
    <div id="lines-container" style="display: none;">
        <!-- 上一行 -->
        <div class="line-wrapper">
            <div id="ln-prev" class="line-number"></div>
            <div id="line-prev" class="line-view"></div>
        </div>
        <!-- 当前行 -->
        <div class="line-wrapper current">
            <div id="ln-curr" class="line-number"></div>
            <div id="line-curr" class="line-view current"></div>
        </div>
        <!-- 下一行 -->
        <div class="line-wrapper">
            <div id="ln-next" class="line-number"></div>
            <div id="line-next" class="line-view"></div>
        </div>
    </div>

    <!-- 输入模态框 -->
    <div id="input-modal">
        <div class="modal-content">
            <div class="modal-header">Standard Input (Stdin)</div>
            <textarea id="modal-textarea" placeholder="在此输入数据..."></textarea>
            <div class="modal-footer">
                <button id="modal-cancel" class="modal-btn">取消</button>
                <button id="modal-run" class="modal-btn">运行</button>
            </div>
        </div>
    </div>

    <!-- 输出面板 -->
    <div id="output-panel">
        <div id="output-header">
            <span>Terminal</span>
            <span id="close-output">✕</span>
        </div>
        <div id="output-content"></div>
        <div id="output-resizer" class="output-resizer"></div>
    </div>

    <!-- 中心编辑器区域 -->
    <div id="editor-area" style="flex: 1; display: flex; overflow: hidden;">
        <!-- 编辑器容器 -->
        <div id="editor-container" style="flex: 1; height: 100%;"></div>
    </div>

    <!-- 虚拟键盘容器 -->
    <div id="keyboard-container">
        <!-- Row 1 -->
        <div class="row">
            <div class="key w-1" data-key="`" data-shift="~"><div class="key-content"><span class="sup">~</span><span class="main">`</span></div></div>
            <div class="key w-1" data-key="1" data-shift="!"><div class="key-content"><span class="sup">!</span><span class="main">1</span></div></div>
            <div class="key w-1" data-key="2" data-shift="@"><div class="key-content"><span class="sup">@</span><span class="main">2</span></div></div>
            <div class="key w-1" data-key="3" data-shift="#"><div class="key-content"><span class="sup">#</span><span class="main">3</span></div></div>
            <div class="key w-1" data-key="4" data-shift="$"><div class="key-content"><span class="sup">$</span><span class="main">4</span></div></div>
            <div class="key w-1" data-key="5" data-shift="%"><div class="key-content"><span class="sup">%</span><span class="main">5</span></div></div>
            <div class="key w-1" data-key="6" data-shift="^"><div class="key-content"><span class="sup">^</span><span class="main">6</span></div></div>
            <div class="key w-1" data-key="7" data-shift="&"><div class="key-content"><span class="sup">&</span><span class="main">7</span></div></div>
            <div class="key w-1" data-key="8" data-shift="*"><div class="key-content"><span class="sup">*</span><span class="main">8</span></div></div>
            <div class="key w-1" data-key="9" data-shift="("><div class="key-content"><span class="sup">(</span><span class="main">9</span></div></div>
            <div class="key w-1" data-key="0" data-shift=")"><div class="key-content"><span class="sup">)</span><span class="main">0</span></div></div>
            <div class="key w-1" data-key="-" data-shift="_"><div class="key-content"><span class="sup">_</span><span class="main">-</span></div></div>
            <div class="key w-1" data-key="=" data-shift="+"><div class="key-content"><span class="sup">+</span><span class="main">=</span></div></div>
            <div class="key w-2 mod repeat-key" data-key="Backspace">Bksp</div>
            <div class="spacer-sm"></div><div class="spacer"></div>
            <div class="key nav-key" data-key="Home">Hom</div><div class="key nav-key" data-key="PageUp">PgU</div>
        </div>
        <!-- Row 2 -->
        <div class="row">
            <div class="key w-1-5 mod" data-key="Tab">Tab</div>
            <div class="key w-1 alpha-key" data-key="q">Q</div><div class="key w-1 alpha-key" data-key="w">W</div><div class="key w-1 alpha-key" data-key="e">E</div>
            <div class="key w-1 alpha-key" data-key="r">R</div><div class="key w-1 alpha-key" data-key="t">T</div><div class="key w-1 alpha-key" data-key="y">Y</div>
            <div class="key w-1 alpha-key" data-key="u">U</div><div class="key w-1 alpha-key" data-key="i">I</div><div class="key w-1 alpha-key" data-key="o">O</div>
            <div class="key w-1 alpha-key" data-key="p">P</div>
            <div class="key w-1" data-key="[" data-shift="{"><div class="key-content"><span class="sup">{</span><span class="main">[</span></div></div>
            <div class="key w-1" data-key="]" data-shift="}"><div class="key-content"><span class="sup">}</span><span class="main">]</span></div></div>
            <div class="key w-1-5" data-key="\" data-shift="|"><div class="key-content"><span class="sup">|</span><span class="main">\</span></div></div>
            <div class="spacer-sm"></div>
            <div class="key nav-key" data-key="Delete">Del</div><div class="key nav-key" data-key="End">End</div><div class="key nav-key" data-key="PageDown">PgD</div>
        </div>
        <!-- Row 3 -->
        <div class="row">
            <div class="key w-1-75 mod" data-key="CapsLock">Caps</div>
            <div class="key w-1 alpha-key" data-key="a">A</div><div class="key w-1 alpha-key" data-key="s">S</div><div class="key w-1 alpha-key" data-key="d">D</div>
            <div class="key w-1 alpha-key" data-key="f">F</div><div class="key w-1 alpha-key" data-key="g">G</div><div class="key w-1 alpha-key" data-key="h">H</div>
            <div class="key w-1 alpha-key" data-key="j">J</div><div class="key w-1 alpha-key" data-key="k">K</div><div class="key w-1 alpha-key" data-key="l">L</div>
            <div class="key w-1" data-key=";" data-shift=":"><div class="key-content"><span class="sup">:</span><span class="main">;</span></div></div>
            <div class="key w-1" data-key="'" data-shift='"'><div class="key-content"><span class="sup">"</span><span class="main">'</span></div></div>
            <div class="key w-2-25 mod highlight" data-key="Enter" style="background:#444">Enter</div>
            <div class="spacer-sm"></div>
            <div class="spacer"></div><div class="spacer"></div><div class="spacer"></div>
        </div>
        <!-- Row 4 -->
        <div class="row">
            <div class="key w-2-25 mod shift-key" data-key="Shift">Shift</div>
            <div class="key w-1 alpha-key" data-key="z">Z</div><div class="key w-1 alpha-key" data-key="x">X</div><div class="key w-1 alpha-key" data-key="c">C</div>
            <div class="key w-1 alpha-key" data-key="v">V</div><div class="key w-1 alpha-key" data-key="b">B</div><div class="key w-1 alpha-key" data-key="n">N</div>
            <div class="key w-1 alpha-key" data-key="m">M</div>
            <div class="key w-1" data-key="," data-shift="<"><div class="key-content"><span class="sup">&lt;</span><span class="main">,</span></div></div>
            <div class="key w-1" data-key="." data-shift=">"><div class="key-content"><span class="sup">&gt;</span><span class="main">.</span></div></div>
            <div class="key w-1" data-key="/" data-shift="?"><div class="key-content"><span class="sup">?</span><span class="main">/</span></div></div>
            <div class="key w-2 mod shift-key" data-key="Shift">Shift</div>
            <div class="spacer-sm"></div><div class="spacer"></div>
            <div class="key nav-key repeat-key" data-key="ArrowUp">↑</div><div class="spacer"></div>
        </div>
        <!-- Row 5 -->
        <div class="row">
            <div class="key w-1-5 mod ctrl-key" data-key="Control">Ctrl</div>
            <div class="spacer"></div><div class="spacer-1-5"></div>
            <div class="key w-space" data-key=" ">Space</div>
            <div class="spacer"></div><div class="spacer"></div>
            <div class="key w-1 mod" data-key="ContextMenu">≡</div>
            <div class="key w-1-5 mod ctrl-key" data-key="Control">Ctrl</div>
            <div class="spacer-sm"></div>
            <div class="key nav-key repeat-key" data-key="ArrowLeft">←</div>
            <div class="key nav-key repeat-key" data-key="ArrowDown">↓</div>
            <div class="key nav-key repeat-key" data-key="ArrowRight">→</div>
        </div>
    </div>

    <!-- 关于弹窗 -->
    <div id="about-modal" class="modal-overlay">
        <div class="modal-content about-modal">
            <div class="modal-header">
                <h2>关于 phoi</h2>
                <span id="close-about" class="close-btn">×</span>
            </div>
            <div class="modal-body">
                <p><a href="https://github.com/huchangzhi/phoi" target="_blank">phoi</a> - 适合OI的在线C++编辑器</p>
                <p>版本: 2.0beta</p>
                <p>这是一个专为信息学竞赛（OI）设计的在线C++编辑器，支持在手机等移动设备上编写和运行C++代码。</p>
            </div>
        </div>
    </div>

    <!-- 引入 KaTeX CSS -->
    <link rel="stylesheet" href="https://unpkg.com/katex@0.16.9/dist/katex.min.css">

    <!-- 引入 Marked.js 和 KaTeX JS -->
    <script src="https://unpkg.com/marked@4.3.0/marked.min.js"></script>
    <script src="https://unpkg.com/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://unpkg.com/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <script src="https://unpkg.com/monaco-editor@0.33.0/min/vs/loader.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="{{ url_for('static', filename='cph.js') }}"></script>
</body>
</html>