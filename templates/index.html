<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>C++ 在线编辑器</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <!-- 全局顶部栏 -->
    <div id="global-toolbar">
        <div class="tool-group">
            <button id="run-btn" class="tool-btn" title="运行">▶</button>
            <button id="copy-btn" class="tool-btn" title="复制">❐</button>
            <button id="debug-btn" class="tool-btn" title="AI调试">⚙</button>
            <p style="color:#666; font-size:12px; margin-left:10px; line-height: 45px;">Powered by <a href="https://github.com/Huchangzhi/phoi">phoi</a></p>
        </div>
        <button id="mode-toggle-btn" class="tool-btn">▼</button>
    </div>

    <!-- 3行预览区 (结构已修改，包含行号) -->
    <div id="lines-container">
        <!-- 上一行 -->
        <div class="line-wrapper">
            <div id="ln-prev" class="line-number"></div>
            <div id="line-prev" class="line-view"></div>
        </div>
        <!-- 当前行 -->
        <div class="line-wrapper current">
            <div id="ln-curr" class="line-number"></div>
            <div id="line-curr" class="line-view current"></div>
        </div>
        <!-- 下一行 -->
        <div class="line-wrapper">
            <div id="ln-next" class="line-number"></div>
            <div id="line-next" class="line-view"></div>
        </div>
    </div>

    <!-- 输入模态框 -->
    <div id="input-modal">
        <div class="modal-content">
            <div class="modal-header">Standard Input (Stdin)</div>
            <textarea id="modal-textarea" placeholder="在此输入数据..."></textarea>
            <div class="modal-footer">
                <button id="modal-cancel" class="modal-btn">取消</button>
                <button id="modal-run" class="modal-btn">运行</button>
            </div>
        </div>
    </div>

    <!-- AI调试模态框 -->
    <div id="ai-debug-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">AI代码调试</span>
                <span class="modal-step" id="debug-step">步骤 1/3</span>
                <span id="close-ai-debug">✕</span>
            </div>
            <div class="modal-body">
                <!-- 配置界面 -->
                <div id="config-section" class="debug-section">
                    <h3>API配置</h3>
                    <div class="form-group">
                        <label for="api-base-url">Base URL:</label>
                        <input type="text" id="api-base-url" placeholder="https://api.openai.com/v1">
                    </div>
                    <div class="form-group">
                        <label for="api-key">API Key:</label>
                        <input type="password" id="api-key" placeholder="sk-...">
                    </div>
                    <div class="form-group">
                        <label for="api-model">模型:</label>
                        <input type="text" id="api-model" placeholder="gpt-3.5-turbo" value="gpt-3.5-turbo">
                    </div>
                    <button id="use-public-api-btn" class="modal-btn">使用公共API</button>
                    <button id="save-config-btn" class="modal-btn primary">保存配置</button>
                </div>

                <!-- 问题输入界面 -->
                <div id="problem-section" class="debug-section" style="display: none;">
                    <h3>题目与样例</h3>
                    <div class="form-group">
                        <label for="problem-desc">题目描述:</label>
                        <textarea id="problem-desc" placeholder="输入题目描述..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="sample-input">样例输入:</label>
                        <textarea id="sample-input" placeholder="输入样例输入..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="sample-output">样例输出:</label>
                        <textarea id="sample-output" placeholder="输入样例输出..."></textarea>
                    </div>
                    <div class="modal-footer">
                        <button id="prev-problem-btn" class="modal-btn">上一步</button>
                        <button id="start-debug-btn" class="modal-btn primary">开始调试</button>
                    </div>
                </div>


                <!-- 调试界面 -->
                <div id="debugging-section" class="debug-section" style="display: none;">
                    <div id="debug-output" class="debug-output">
                        <div id="debug-messages"></div>
                        <div id="debug-loading" class="loading" style="display: none;">
                            <div class="loading-dots">
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </div>
                    </div>
                    <!-- 代码查看框 -->
                    <div class="form-group">
                        <label>AI生成的最新代码:</label>
                        <pre id="ai-code-output" class="code-output"></pre>
                    </div>
                    <!-- 代码替换功能 -->
                    <div class="form-group">
                        <button id="replace-code-btn" class="modal-btn primary">替换当前代码</button>
                    </div>
                    <!-- 用户与AI交流功能 -->
                    <div class="form-group">
                        <label for="user-query">与AI交流:</label>
                        <textarea id="user-query" placeholder="向AI询问关于代码的问题..."></textarea>
                    </div>
                    <div class="form-group">
                        <button id="send-query-btn" class="modal-btn primary">发送</button>
                    </div>
                    <div class="form-group">
                        <label>AI回复:</label>
                        <div id="ai-response" class="ai-response-box"></div>
                    </div>
                    <div class="debug-controls">
                        <button id="stop-debug-btn" class="modal-btn">停止调试</button>
                        <button id="finish-debug-btn" class="modal-btn primary">完成调试</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 输出面板 -->
    <div id="output-panel">
        <div id="output-header">
            <span>Terminal</span>
            <span id="close-output">✕</span>
        </div>
        <div id="output-content"></div>
        <div id="output-resizer" class="output-resizer"></div>
    </div>

    <!-- 全屏编辑器 (结构已修改，包含行号槽) -->
    <div id="editor-wrapper">
        <!-- 左侧行号槽 -->
        <div id="gutter" class="editor-font"></div>
        <!-- 右侧代码容器 -->
        <div id="file-content">
            <pre id="highlight-layer" class="editor-font"></pre>
            <textarea id="full-editor" class="editor-font" spellcheck="false" autocapitalize="off"></textarea>
        </div>
    </div>

    <!-- 虚拟键盘容器 -->
    <div id="keyboard-container">
        <!-- Row 1 -->
        <div class="row">
            <div class="key w-1" data-key="`" data-shift="~"><div class="key-content"><span class="sup">~</span><span class="main">`</span></div></div>
            <div class="key w-1" data-key="1" data-shift="!"><div class="key-content"><span class="sup">!</span><span class="main">1</span></div></div>
            <div class="key w-1" data-key="2" data-shift="@"><div class="key-content"><span class="sup">@</span><span class="main">2</span></div></div>
            <div class="key w-1" data-key="3" data-shift="#"><div class="key-content"><span class="sup">#</span><span class="main">3</span></div></div>
            <div class="key w-1" data-key="4" data-shift="$"><div class="key-content"><span class="sup">$</span><span class="main">4</span></div></div>
            <div class="key w-1" data-key="5" data-shift="%"><div class="key-content"><span class="sup">%</span><span class="main">5</span></div></div>
            <div class="key w-1" data-key="6" data-shift="^"><div class="key-content"><span class="sup">^</span><span class="main">6</span></div></div>
            <div class="key w-1" data-key="7" data-shift="&"><div class="key-content"><span class="sup">&</span><span class="main">7</span></div></div>
            <div class="key w-1" data-key="8" data-shift="*"><div class="key-content"><span class="sup">*</span><span class="main">8</span></div></div>
            <div class="key w-1" data-key="9" data-shift="("><div class="key-content"><span class="sup">(</span><span class="main">9</span></div></div>
            <div class="key w-1" data-key="0" data-shift=")"><div class="key-content"><span class="sup">)</span><span class="main">0</span></div></div>
            <div class="key w-1" data-key="-" data-shift="_"><div class="key-content"><span class="sup">_</span><span class="main">-</span></div></div>
            <div class="key w-1" data-key="=" data-shift="+"><div class="key-content"><span class="sup">+</span><span class="main">=</span></div></div>
            <div class="key w-2 mod repeat-key" data-key="Backspace">Bksp</div>
            <div class="spacer-sm"></div><div class="spacer"></div>
            <div class="key nav-key" data-key="Home">Hom</div><div class="key nav-key" data-key="PageUp">PgU</div>
        </div>
        <!-- Row 2 -->
        <div class="row">
            <div class="key w-1-5 mod" data-key="Tab">Tab</div>
            <div class="key w-1 alpha-key" data-key="q">Q</div><div class="key w-1 alpha-key" data-key="w">W</div><div class="key w-1 alpha-key" data-key="e">E</div>
            <div class="key w-1 alpha-key" data-key="r">R</div><div class="key w-1 alpha-key" data-key="t">T</div><div class="key w-1 alpha-key" data-key="y">Y</div>
            <div class="key w-1 alpha-key" data-key="u">U</div><div class="key w-1 alpha-key" data-key="i">I</div><div class="key w-1 alpha-key" data-key="o">O</div>
            <div class="key w-1 alpha-key" data-key="p">P</div>
            <div class="key w-1" data-key="[" data-shift="{"><div class="key-content"><span class="sup">{</span><span class="main">[</span></div></div>
            <div class="key w-1" data-key="]" data-shift="}"><div class="key-content"><span class="sup">}</span><span class="main">]</span></div></div>
            <div class="key w-1-5" data-key="\" data-shift="|"><div class="key-content"><span class="sup">|</span><span class="main">\</span></div></div>
            <div class="spacer-sm"></div>
            <div class="key nav-key" data-key="Delete">Del</div><div class="key nav-key" data-key="End">End</div><div class="key nav-key" data-key="PageDown">PgD</div>
        </div>
        <!-- Row 3 -->
        <div class="row">
            <div class="key w-1-75 mod" data-key="CapsLock">Caps</div>
            <div class="key w-1 alpha-key" data-key="a">A</div><div class="key w-1 alpha-key" data-key="s">S</div><div class="key w-1 alpha-key" data-key="d">D</div>
            <div class="key w-1 alpha-key" data-key="f">F</div><div class="key w-1 alpha-key" data-key="g">G</div><div class="key w-1 alpha-key" data-key="h">H</div>
            <div class="key w-1 alpha-key" data-key="j">J</div><div class="key w-1 alpha-key" data-key="k">K</div><div class="key w-1 alpha-key" data-key="l">L</div>
            <div class="key w-1" data-key=";" data-shift=":"><div class="key-content"><span class="sup">:</span><span class="main">;</span></div></div>
            <div class="key w-1" data-key="'" data-shift='"'><div class="key-content"><span class="sup">"</span><span class="main">'</span></div></div>
            <div class="key w-2-25 mod highlight" data-key="Enter" style="background:#444">Enter</div>
            <div class="spacer-sm"></div>
            <div class="spacer"></div><div class="spacer"></div><div class="spacer"></div>
        </div>
        <!-- Row 4 -->
        <div class="row">
            <div class="key w-2-25 mod shift-key" data-key="Shift">Shift</div>
            <div class="key w-1 alpha-key" data-key="z">Z</div><div class="key w-1 alpha-key" data-key="x">X</div><div class="key w-1 alpha-key" data-key="c">C</div>
            <div class="key w-1 alpha-key" data-key="v">V</div><div class="key w-1 alpha-key" data-key="b">B</div><div class="key w-1 alpha-key" data-key="n">N</div>
            <div class="key w-1 alpha-key" data-key="m">M</div>
            <div class="key w-1" data-key="," data-shift="<"><div class="key-content"><span class="sup">&lt;</span><span class="main">,</span></div></div>
            <div class="key w-1" data-key="." data-shift=">"><div class="key-content"><span class="sup">&gt;</span><span class="main">.</span></div></div>
            <div class="key w-1" data-key="/" data-shift="?"><div class="key-content"><span class="sup">?</span><span class="main">/</span></div></div>
            <div class="key w-2 mod shift-key" data-key="Shift">Shift</div>
            <div class="spacer-sm"></div><div class="spacer"></div>
            <div class="key nav-key repeat-key" data-key="ArrowUp">↑</div><div class="spacer"></div>
        </div>
        <!-- Row 5 -->
        <div class="row">
            <div class="key w-1-5 mod ctrl-key" data-key="Control">Ctrl</div>
            <div class="spacer"></div><div class="spacer-1-5"></div>
            <div class="key w-space" data-key=" ">Space</div>
            <div class="spacer"></div><div class="spacer"></div>
            <div class="key w-1 mod" data-key="ContextMenu">≡</div>
            <div class="key w-1-5 mod ctrl-key" data-key="Control">Ctrl</div>
            <div class="spacer-sm"></div>
            <div class="key nav-key repeat-key" data-key="ArrowLeft">←</div>
            <div class="key nav-key repeat-key" data-key="ArrowDown">↓</div>
            <div class="key nav-key repeat-key" data-key="ArrowRight">→</div>
        </div>
    </div>

    <script src="https://unpkg.com/monaco-editor@0.33.0/min/vs/loader.js"></script>
<div id="editor-container" style="width:100%;height:100vh;border:1px solid grey;"></div>
<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>