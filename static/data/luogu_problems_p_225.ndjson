{"pid": "P5551", "type": "P", "difficulty": 3, "samples": [["3\n6 17 43 55 20 55 38", "81"], ["4\n6 20 72 61 26 55 26 7 17 55 26 7 38 7 35", "159"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": [], "title": "Chino的树学", "background": "Chino非常喜欢树", "description": "Chino树是一棵具有某种性质的满二叉树，具体来说，对于这棵树的每一个非叶子节点，它的左子节点$(A)$的右子节点$(C)$与它的右子节点$(B)$的左子节点$(D)$的值相同，且$C$与$D$下方的子树也完全相同。现在，Chino想知道，要如何从根节点走到其中任意叶节点使路上经过的节点的权值之和最大。\n\n![](https://cdn.luogu.com.cn/upload/pic/23672.png )\n\n$Orz yky,dyh,wjk,jjy,cxr,gsy,cpy,zcy,tyz,yy,hz,zhr,ygg$", "inputFormat": "第一行，一个数，$n$，代表该二叉树的层数。\n\n第二行，$2^n-1$个数，代表该二叉树的先序遍历。", "outputFormat": "一行，一个数，代表点权最大和。", "hint": "![](https://cdn.luogu.com.cn/upload/pic/23674.png )\n![](https://cdn.luogu.com.cn/upload/pic/23675.png )\n![](https://cdn.luogu.com.cn/upload/pic/23673.png )\n答案longlong救星", "locale": "zh-CN", "translations": {"en": {"title": "Chino's Tree Study", "background": "Chino really likes trees.", "description": "A Chino tree is a full binary tree with a certain property. Specifically, for every non-leaf node in this tree, the value of the right child $(C)$ of its left child $(A)$ is the same as the value of the left child $(D)$ of its right child $(B)$. Also, the subtrees rooted at $C$ and $D$ are exactly the same. Now, Chino wants to know how to walk from the root to any leaf node so that the sum of the node weights along the path is as large as possible.\n\n![](https://cdn.luogu.com.cn/upload/pic/23672.png )\n\n$Orz yky,dyh,wjk,jjy,cxr,gsy,cpy,zcy,tyz,yy,hz,zhr,ygg$", "inputFormat": "The first line contains an integer $n$, which represents the number of levels of the binary tree.\n\nThe second line contains $2^n-1$ numbers, which represent the preorder traversal of the binary tree.", "outputFormat": "One line containing one number, which is the maximum possible sum of node weights.", "hint": "![](https://cdn.luogu.com.cn/upload/pic/23674.png )\n![](https://cdn.luogu.com.cn/upload/pic/23675.png )\n![](https://cdn.luogu.com.cn/upload/pic/23673.png )\nA long long savior.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "Chino的树学", "background": "Chino非常喜欢树", "description": "Chino树是一棵具有某种性质的满二叉树，具体来说，对于这棵树的每一个非叶子节点，它的左子节点$(A)$的右子节点$(C)$与它的右子节点$(B)$的左子节点$(D)$的值相同，且$C$与$D$下方的子树也完全相同。现在，Chino想知道，要如何从根节点走到其中任意叶节点使路上经过的节点的权值之和最大。\n\n![](https://cdn.luogu.com.cn/upload/pic/23672.png )\n\n$Orz yky,dyh,wjk,jjy,cxr,gsy,cpy,zcy,tyz,yy,hz,zhr,ygg$", "inputFormat": "第一行，一个数，$n$，代表该二叉树的层数。\n\n第二行，$2^n-1$个数，代表该二叉树的先序遍历。", "outputFormat": "一行，一个数，代表点权最大和。", "hint": "![](https://cdn.luogu.com.cn/upload/pic/23674.png )\n![](https://cdn.luogu.com.cn/upload/pic/23675.png )\n![](https://cdn.luogu.com.cn/upload/pic/23673.png )\n答案longlong救星", "locale": "zh-CN"}}}
{"pid": "P5552", "type": "P", "difficulty": 6, "samples": [["5 1\n2 3 1 4 5", "8"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 4000, 4000, 4000, 4000, 4000], "memory": [300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000, 300000]}, "tags": ["线段树", "O2优化"], "title": "Chino的试卷", "background": "orz trz\n\nChino参加了萌妹子期末考试，又到了发试卷的时候了，但是，老师 $ygg$ 与 老师 $ggy$ 就怎样发试卷才最省力这一事发生了一些争论。现在，为了解决这一矛盾，你决定帮Chino用数据说话。\n\n下面是 $ygg$ 老师的发试卷策略，请你帮他计算发完试卷要走的总路程。", "description": "为了简化问题，我们规定Chino的同学们(妹子们)都参加了考试，且坐在一排，顺次位置的编号为 $1\\sim n$，不妨规定位置 $i$, $j$ 之间的路程为 $|i - j|$。每张试卷上都有一个编号，代表要发给坐在这个编号的妹子。\n\n$ygg$ 老师正在分发试卷。我们定义这个分发试卷的老师有两只手。刚开始，所有的试卷都在 $ygg$ 老师的左手，老师位于位置 $s$ 处。发试卷时，$ygg$ 老师会用右手拿起左手顶部的一张试卷。如果这是最后一张需要发的试卷，显然他别无选择，只能走到这张试卷主人的位置上去发这张试卷。如果他的左手还有试卷，那么他会进行一次比较，比较发左手顶部的那张试卷走的路程短，还是发右手那张试卷走的路程短。如果左手那张试卷走的路程短，他会把右手的试卷放到左手试卷的最下面，不然的话，他会直接发掉右手的试卷，并停留在刚发完这张试卷的位置。无论如何，他都会从左手再拿一张试卷，来进行下一步的决策，直到所有卷子都被发完。\n\n现在，给定试卷的初始顺序序列$p$，以及老师的初始位置 $s$，问他要发完所有试卷走过的总路程是多少。\n\nChino想快速的知道答案，所以你要在$+4s$内完成这道题哦qwq\n\nOrz yky,dyh,wjk,jjy,cxr,gsy,cpy,zcy,tyz,yy,hz,zhr,ygg", "inputFormat": "- 第一行两个正整数 $n, s$  ，分别表示人数老师的初始位置。\n- 第二行 $n$ 个非负整数，其中第 $i$ 个数表示 $p_i$ ，即从上往下数第 $i$ 张试卷要发到哪里去。", "outputFormat": "输出一个整数，表示需要走的总路程。", "hint": "| 测试点 |     $n= $     | 测试点 |     $n =$     |\n| :----: | :-----------: | :----: | :-----------: |\n|   1    | $3\\times10^1$ |   11   | $3\\times10^5$ |\n|   2    | $3\\times10^2$ |   12   | $3\\times10^5$ |\n|   3    | $3\\times10^2$ |   13   | $3\\times10^5$ |\n|   4    | $3\\times10^3$ |   14   | $3\\times10^5$ |\n|   5    | $3\\times10^3$ |   15   | $3\\times10^5$ |\n|   6    | $3\\times10^3$ |   16   | $3\\times10^6$ |\n|   7    | $3\\times10^4$ |   17   | $3\\times10^6$ |\n|   8    | $3\\times10^4$ |   18   | $3\\times10^6$ |\n|   9    | $3\\times10^4$ |   19   | $3\\times10^6$ |\n|   10   | $3\\times10^4$ |   20   | $3\\times10^6$ |\n\n对于前$15$个测试点，时限$1s$\n\n对于后$5$个测试点，时限$4s$", "locale": "zh-CN", "translations": {"en": {"title": "Chino's Exam Papers.", "background": "orz trz\n\nChino took the “cute girls” final exam, and it is time to hand out the papers again. However, teacher $ygg$ and teacher $ggy$ had a dispute about how to hand out the papers with the least effort. Now, to resolve this conflict, you decide to help Chino speak with data.\n\nBelow is teacher $ygg$'s strategy for handing out papers. Please help him compute the total distance walked to finish handing out all papers.", "description": "To simplify the problem, we assume that all of Chino’s classmates (girls) took the exam and are seated in a single row, with positions numbered $1\\sim n$ in order. Define the distance between positions $i$ and $j$ as $|i - j|$. Each paper has a number on it, indicating which girl (at that numbered position) it should be handed to.\n\nTeacher $ygg$ is handing out the papers. We define that this teacher has two hands. At the beginning, all papers are in teacher $ygg$'s left hand, and the teacher is at position $s$. When handing out papers, teacher $ygg$ will use his right hand to pick up one paper from the top of the left-hand stack. If this is the last paper that still needs to be handed out, then obviously he has no choice but to walk to that paper owner’s position and hand it out. If there are still papers left in his left hand, then he will make a comparison: he compares whether the walking distance to hand out the paper on the top of the left hand is shorter, or the walking distance to hand out the paper currently in the right hand is shorter. If the left-hand paper requires a shorter distance, he will put the right-hand paper to the very bottom of the left-hand stack. Otherwise, he will hand out the right-hand paper directly, and stay at the position where he just handed it out. In any case, he will take another paper from the left hand to make the next decision, until all papers are handed out.\n\nNow, given the initial order sequence $p$ of the papers and the teacher’s initial position $s$, ask what the total distance he walks to finish handing out all papers is.\n\nChino wants to know the answer quickly, so you must finish this problem within $+4s$ time, qwq.\n\nOrz yky,dyh,wjk,jjy,cxr,gsy,cpy,zcy,tyz,yy,hz,zhr,ygg.", "inputFormat": "- The first line contains two positive integers $n, s$, representing the number of people and the teacher’s initial position, respectively.\n- The second line contains $n$ non-negative integers. The $i$-th number denotes $p_i$, i.e., the $i$-th paper from top to bottom should be handed to that position.", "outputFormat": "Output one integer, representing the total distance that needs to be walked.", "hint": "| Test Point |     $n= $     | Test Point |     $n =$     |\n| :----: | :-----------: | :----: | :-----------: |\n|   1    | $3\\times10^1$ |   11   | $3\\times10^5$ |\n|   2    | $3\\times10^2$ |   12   | $3\\times10^5$ |\n|   3    | $3\\times10^2$ |   13   | $3\\times10^5$ |\n|   4    | $3\\times10^3$ |   14   | $3\\times10^5$ |\n|   5    | $3\\times10^3$ |   15   | $3\\times10^5$ |\n|   6    | $3\\times10^3$ |   16   | $3\\times10^6$ |\n|   7    | $3\\times10^4$ |   17   | $3\\times10^6$ |\n|   8    | $3\\times10^4$ |   18   | $3\\times10^6$ |\n|   9    | $3\\times10^4$ |   19   | $3\\times10^6$ |\n|   10   | $3\\times10^4$ |   20   | $3\\times10^6$ |\n\nFor the first $15$ test points, the time limit is $1s$.\n\nFor the last $5$ test points, the time limit is $4s$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "Chino的试卷", "background": "orz trz\n\nChino参加了萌妹子期末考试，又到了发试卷的时候了，但是，老师 $ygg$ 与 老师 $ggy$ 就怎样发试卷才最省力这一事发生了一些争论。现在，为了解决这一矛盾，你决定帮Chino用数据说话。\n\n下面是 $ygg$ 老师的发试卷策略，请你帮他计算发完试卷要走的总路程。", "description": "为了简化问题，我们规定Chino的同学们(妹子们)都参加了考试，且坐在一排，顺次位置的编号为 $1\\sim n$，不妨规定位置 $i$, $j$ 之间的路程为 $|i - j|$。每张试卷上都有一个编号，代表要发给坐在这个编号的妹子。\n\n$ygg$ 老师正在分发试卷。我们定义这个分发试卷的老师有两只手。刚开始，所有的试卷都在 $ygg$ 老师的左手，老师位于位置 $s$ 处。发试卷时，$ygg$ 老师会用右手拿起左手顶部的一张试卷。如果这是最后一张需要发的试卷，显然他别无选择，只能走到这张试卷主人的位置上去发这张试卷。如果他的左手还有试卷，那么他会进行一次比较，比较发左手顶部的那张试卷走的路程短，还是发右手那张试卷走的路程短。如果左手那张试卷走的路程短，他会把右手的试卷放到左手试卷的最下面，不然的话，他会直接发掉右手的试卷，并停留在刚发完这张试卷的位置。无论如何，他都会从左手再拿一张试卷，来进行下一步的决策，直到所有卷子都被发完。\n\n现在，给定试卷的初始顺序序列$p$，以及老师的初始位置 $s$，问他要发完所有试卷走过的总路程是多少。\n\nChino想快速的知道答案，所以你要在$+4s$内完成这道题哦qwq\n\nOrz yky,dyh,wjk,jjy,cxr,gsy,cpy,zcy,tyz,yy,hz,zhr,ygg", "inputFormat": "- 第一行两个正整数 $n, s$  ，分别表示人数老师的初始位置。\n- 第二行 $n$ 个非负整数，其中第 $i$ 个数表示 $p_i$ ，即从上往下数第 $i$ 张试卷要发到哪里去。", "outputFormat": "输出一个整数，表示需要走的总路程。", "hint": "| 测试点 |     $n= $     | 测试点 |     $n =$     |\n| :----: | :-----------: | :----: | :-----------: |\n|   1    | $3\\times10^1$ |   11   | $3\\times10^5$ |\n|   2    | $3\\times10^2$ |   12   | $3\\times10^5$ |\n|   3    | $3\\times10^2$ |   13   | $3\\times10^5$ |\n|   4    | $3\\times10^3$ |   14   | $3\\times10^5$ |\n|   5    | $3\\times10^3$ |   15   | $3\\times10^5$ |\n|   6    | $3\\times10^3$ |   16   | $3\\times10^6$ |\n|   7    | $3\\times10^4$ |   17   | $3\\times10^6$ |\n|   8    | $3\\times10^4$ |   18   | $3\\times10^6$ |\n|   9    | $3\\times10^4$ |   19   | $3\\times10^6$ |\n|   10   | $3\\times10^4$ |   20   | $3\\times10^6$ |\n\n对于前$15$个测试点，时限$1s$\n\n对于后$5$个测试点，时限$4s$", "locale": "zh-CN"}}}
{"pid": "P5553", "type": "P", "difficulty": 4, "samples": [["3\n1\n2\n998244853", "1\n0\n-1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["数学"], "title": "电学实验", "background": "", "description": "物理课上，小L和小K在做电学实验：“探究电阻两端的电压一定时，通过电阻的电流和电阻的大小的关系”。在这一实验中，控制电阻箱两端的电压为 $1~ V$ ，调节旋钮改变电阻箱的电阻，分别改为 $1 ~ \\Omega , 2 ~ \\Omega , 3 ~ \\Omega , \\ldots , n ~ \\Omega $ ，分别读出对应的电流表示数为 $1 ~ A, \\dfrac 1 2 ~  A , \\dfrac 1 3 ~ A , ... ,\\dfrac 1 n ~ A$ 。\n\n在描述实验结论的时候，小L和小K产生了分歧。\n\n小K：“众所周知，电阻两端的电压一定时，通过电阻的电流和电阻的大小成反比。也就是说，如果电阻箱两端电压保持不变，电阻箱的电阻为 $x ~ \\Omega $ ，则通过电阻箱的电流为 $\\dfrac 1 x ~ A$ 。”\n\n小L：“但是我们为什么不可以用一个最高 $n-1$ 次的曲线去拟合它呢？”\n\n为了改变小L的错误认识，小K决定先让 **小L按自己的结论** 去计算出电阻箱的电阻为 $(n+1) ~ \\Omega$ 时，通过电阻箱的电流，然后进行实验，检验答案的正确性。同时，为了让小L更深刻地认识到自己的错误，小K决定进行多组实验，每组实验取不同的 $n$ 。\n\n但是，小L在求解关于这 $n$ 组实验数据的最高 $n-1$ 次曲线时，遇到了问题。小L不想手算出这条曲线和曲线在 $(n+1) ~ \\Omega $ 时的值，所以他找到了你，希望你能够求出这个值。\n\n为了使运算更方便，小L将所有数据转化为取模 $998244353$ 意义下的整数值，你的输出也应该是这个整数值。但是，有时候数据的组数过多，导致实验数据或最后的运算结果没有意义，此时你需要输出 `-1` 。", "inputFormat": "输入第一行有一个整数 $T$ ，表示进行了 $T$ 组实验。\n\n每组实验一行，有一个整数 $n$ 。", "outputFormat": "对于每组实验，输出 **按照小L的结论** ，电阻箱电阻为 $(n+1) ~ \\Omega$ 时对应的电流值。如果实验数据或求得的结果在模意义下没有定义，输出 `-1`  。", "hint": "对于 $10\\%$ 的数据， $1\\le n\\le 6$ 。\n\n对于 $30\\%$ 的数据， $1\\le n\\le 50$ 。\n\n对于 $50\\%$ 的数据， $1\\le n\\le 5000$ 。\n\n对于 $70\\%$ 的数据， $1\\le n\\le 10^5$ 。\n\n对于 $100\\%$ 的数据， $1\\le T\\le 100,1\\le n\\le 10^{18}$ 。", "locale": "zh-CN", "translations": {"en": {"title": "Electrical Experiment", "background": "", "description": "In physics class, Xiao L and Xiao K are doing an electrical experiment: “Exploring the relationship between the current through a resistor and the resistance value when the voltage across the resistor is fixed.” In this experiment, they keep the voltage across the resistance box at $1~ V$, and adjust the knob to change the resistance of the box to $1 ~ \\Omega , 2 ~ \\Omega , 3 ~ \\Omega , \\ldots , n ~ \\Omega$. They then read the corresponding current values as $1 ~ A, \\dfrac 1 2 ~  A , \\dfrac 1 3 ~ A , ... ,\\dfrac 1 n ~ A$.\n\nWhen describing the experimental conclusion, Xiao L and Xiao K disagree.\n\nXiao K: “As everyone knows, when the voltage across a resistor is fixed, the current through the resistor is inversely proportional to the resistance. That is, if the voltage across the resistance box stays unchanged and the resistance is $x ~ \\Omega$, then the current through it is $\\dfrac 1 x ~ A$.”\n\nXiao L: “But why can’t we use a curve of degree at most $n-1$ to fit it?”\n\nTo correct Xiao L’s misunderstanding, Xiao K decides to first let **Xiao L compute according to his own conclusion** the current through the resistance box when its resistance is $(n+1) ~ \\Omega$, and then perform an experiment to check whether the answer is correct. Meanwhile, to make Xiao L realize his mistake more deeply, Xiao K decides to do multiple experiments, each with a different $n$.\n\nHowever, when Xiao L tries to find the degree at most $n-1$ curve for these $n$ experimental data points, he runs into difficulties. Xiao L does not want to manually compute this curve and its value at $(n+1) ~ \\Omega$, so he asks you to compute this value.\n\nTo make calculations easier, Xiao L converts all data into integers under modulo $998244353$, and your output should also be this integer value. However, sometimes there are too many data points, causing the experimental data or the final computed result to be meaningless. In this case, you should output `-1`.", "inputFormat": "The first line contains an integer $T$, indicating that $T$ experiments were conducted.\n\nEach experiment consists of one line containing an integer $n$.", "outputFormat": "For each experiment, output **according to Xiao L’s conclusion** the current value when the resistance box has resistance $(n+1) ~ \\Omega$. If the experimental data or the computed result is not defined under the modulo meaning, output `-1`.", "hint": "For $10\\%$ of the testdata, $1\\le n\\le 6$.\n\nFor $30\\%$ of the testdata, $1\\le n\\le 50$.\n\nFor $50\\%$ of the testdata, $1\\le n\\le 5000$.\n\nFor $70\\%$ of the testdata, $1\\le n\\le 10^5$.\n\nFor $100\\%$ of the testdata, $1\\le T\\le 100, 1\\le n\\le 10^{18}$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "电学实验", "background": "", "description": "物理课上，小L和小K在做电学实验：“探究电阻两端的电压一定时，通过电阻的电流和电阻的大小的关系”。在这一实验中，控制电阻箱两端的电压为 $1~ V$ ，调节旋钮改变电阻箱的电阻，分别改为 $1 ~ \\Omega , 2 ~ \\Omega , 3 ~ \\Omega , \\ldots , n ~ \\Omega $ ，分别读出对应的电流表示数为 $1 ~ A, \\dfrac 1 2 ~  A , \\dfrac 1 3 ~ A , ... ,\\dfrac 1 n ~ A$ 。\n\n在描述实验结论的时候，小L和小K产生了分歧。\n\n小K：“众所周知，电阻两端的电压一定时，通过电阻的电流和电阻的大小成反比。也就是说，如果电阻箱两端电压保持不变，电阻箱的电阻为 $x ~ \\Omega $ ，则通过电阻箱的电流为 $\\dfrac 1 x ~ A$ 。”\n\n小L：“但是我们为什么不可以用一个最高 $n-1$ 次的曲线去拟合它呢？”\n\n为了改变小L的错误认识，小K决定先让 **小L按自己的结论** 去计算出电阻箱的电阻为 $(n+1) ~ \\Omega$ 时，通过电阻箱的电流，然后进行实验，检验答案的正确性。同时，为了让小L更深刻地认识到自己的错误，小K决定进行多组实验，每组实验取不同的 $n$ 。\n\n但是，小L在求解关于这 $n$ 组实验数据的最高 $n-1$ 次曲线时，遇到了问题。小L不想手算出这条曲线和曲线在 $(n+1) ~ \\Omega $ 时的值，所以他找到了你，希望你能够求出这个值。\n\n为了使运算更方便，小L将所有数据转化为取模 $998244353$ 意义下的整数值，你的输出也应该是这个整数值。但是，有时候数据的组数过多，导致实验数据或最后的运算结果没有意义，此时你需要输出 `-1` 。", "inputFormat": "输入第一行有一个整数 $T$ ，表示进行了 $T$ 组实验。\n\n每组实验一行，有一个整数 $n$ 。", "outputFormat": "对于每组实验，输出 **按照小L的结论** ，电阻箱电阻为 $(n+1) ~ \\Omega$ 时对应的电流值。如果实验数据或求得的结果在模意义下没有定义，输出 `-1`  。", "hint": "对于 $10\\%$ 的数据， $1\\le n\\le 6$ 。\n\n对于 $30\\%$ 的数据， $1\\le n\\le 50$ 。\n\n对于 $50\\%$ 的数据， $1\\le n\\le 5000$ 。\n\n对于 $70\\%$ 的数据， $1\\le n\\le 10^5$ 。\n\n对于 $100\\%$ 的数据， $1\\le T\\le 100,1\\le n\\le 10^{18}$ 。", "locale": "zh-CN"}}}
{"pid": "P5554", "type": "P", "difficulty": 6, "samples": [["5\nquery 1.000\nadd 1.000 5.000 1.000 2.000\nquery 1.000\nquery 2.000\nquery 1.500", "Undefined\n1.000000\n1.100000\n2.275000"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["Special Judge"], "title": "篮球统计", "background": "小L喜欢唱、跳、Rap和篮球。\n\n在同一时刻，篮球场上可能会有很多个在空中的篮球，小L想统计这些篮球的信息。", "description": "当一个篮球被抛到空中时，小L会记下一个时刻 $l$ ，此时这个篮球开始被小L统计；当一个篮球被接住时，小L会记下一个时刻 $r$ ，在这之后这个篮球的状态不再被小L统计。对于每个篮球，小L会计算出在时刻 $l$ 这个篮球的高度和向上的初速度。\n\n对于一个时刻 $x$ ，小L想知道，对于所有此时还在空中的篮球，高度最高的篮球的高度是多少。\n\n**注意** ：被发现的篮球的出现时间 $l,r$ 和小L统计信息的时刻 $x$ 均没有任何单调性。", "inputFormat": "输入的第一行为一个整数 $m$ 。\n\n接下来的 $m$ 行，每行为一个操作或询问，为以下形式之一：\n\n1.  `add a v l r` ：小L发现了一个在空中的篮球，这个篮球在时刻 $l$ 被抛向空中，在时刻 $r$ 被接住，这个篮球在时刻 $l$ 的高度是 $a$ ，向上的初始速度为 $v$ 。\n\n2.  `query x` ：请告诉小L，在他已经给出的信息中，在时刻 $x$ 在空中的所有篮球中最高的高度是多少。", "outputFormat": "对于每个 `query` 操作，输出一行，为这个最高的高度。如果此时不存在在空中的篮球，输出 `Undefined` 。\n\n为了减小精度误差，推荐使用 `long double` 类型存储浮点数，输出格式为 `%Lf` 。\n\n为了避免精度问题，本题使用 **Special Judge** 。如果您的答案与标程的答案相差小于等于 $0.005$ ，则会被视为是正确的。", "hint": "对于 $30\\%$ 的数据， $m\\le 5000$\n\n对于另外 $30\\%$ 的数据， $-100< l,r,x< 100$\n\n对于 $100\\%$ 的数据， $1\\le m\\le 100000,-1000< a,v < 1000,-10^6< l,r,x < 10^6,l\\le r$ ，保证输入中所有的小数均为 $3$ 位小数。\n\n篮球高度可能是负数。\n\n### 小K教你学物理\n\n本题中所有的单位均采用国际单位制。即时间单位是秒（ $s$ ），长度单位是米（ $m$ ）。\n\n本题中取重力加速度 $g=9.8 ~ m \\cdot s^{-2}$ 。\n\n省略掉篮球横向的位移，可以将篮球的运动看做是 **竖直上抛运动** 。根据题目中给出的信息，已知篮球初始的高度 $a$ ，初速度 $v$ ，重力加速度 $g$ ， **在空中的时间**  $t$ ，则篮球在这一时刻的高度是 $-\\dfrac 1 2 g t^2 + vt+a$ 。", "locale": "zh-CN", "translations": {"en": {"title": "Basketball Statistics", "background": "Xiao L likes singing, dancing, rap, and basketball.\n\nAt the same moment, there may be many basketballs in the air on the court, and Xiao L wants to collect statistics about these basketballs.", "description": "When a basketball is thrown into the air, Xiao L records a time $l$, from which this basketball starts being counted by Xiao L. When a basketball is caught, Xiao L records a time $r$, after which the state of this basketball is no longer counted by Xiao L. For each basketball, Xiao L computes the height of this basketball at time $l$ and its initial upward velocity.\n\nFor a time $x$, Xiao L wants to know: among all basketballs that are still in the air at that moment, what is the height of the highest one.\n\n**Note**: The discovered basketballs' times $l, r$ and Xiao L's query times $x$ have no monotonicity.", "inputFormat": "The first line contains an integer $m$.\n\nThe next $m$ lines each describe an operation or a query, in one of the following forms:\n\n1. `add a v l r`: Xiao L discovers a basketball in the air. This basketball is thrown into the air at time $l$ and is caught at time $r$. Its height at time $l$ is $a$, and its initial upward velocity is $v$.\n\n2. `query x`: Please tell Xiao L, based on the information he has given so far, what the maximum height is among all basketballs that are in the air at time $x$.", "outputFormat": "For each `query` operation, output one line containing this maximum height. If there is no basketball in the air at that time, output `Undefined`.\n\nTo reduce precision errors, it is recommended to use the `long double` type to store floating-point numbers, and use `%Lf` as the output format.\n\nTo avoid precision issues, this problem uses **Special Judge**. If the difference between your answer and the reference solution's answer is less than or equal to $0.005$, it will be considered correct.", "hint": "For $30\\%$ of the testdata, $m \\le 5000$.\n\nFor another $30\\%$ of the testdata, $-100 < l, r, x < 100$.\n\nFor $100\\%$ of the testdata, $1 \\le m \\le 100000$, $-1000 < a, v < 1000$, $-10^6 < l, r, x < 10^6$, $l \\le r$. It is guaranteed that all decimals in the input have exactly $3$ digits after the decimal point.\n\nThe basketball's height may be negative.\n\n### Xiao K Teaches You Physics\n\nAll units in this problem use the International System of Units (SI). That is, the time unit is seconds ($s$), and the length unit is meters ($m$).\n\nIn this problem, the gravitational acceleration is $g = 9.8 ~ m \\cdot s^{-2}$.\n\nIgnoring the horizontal displacement of the basketball, we can treat its motion as **vertical upward throw motion**. Based on the information given in the statement, if the basketball's initial height is $a$, initial velocity is $v$, gravitational acceleration is $g$, and the **time in the air** is $t$, then the height of the basketball at that time is $-\\dfrac 1 2 g t^2 + vt + a$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "篮球统计", "background": "小L喜欢唱、跳、Rap和篮球。\n\n在同一时刻，篮球场上可能会有很多个在空中的篮球，小L想统计这些篮球的信息。", "description": "当一个篮球被抛到空中时，小L会记下一个时刻 $l$ ，此时这个篮球开始被小L统计；当一个篮球被接住时，小L会记下一个时刻 $r$ ，在这之后这个篮球的状态不再被小L统计。对于每个篮球，小L会计算出在时刻 $l$ 这个篮球的高度和向上的初速度。\n\n对于一个时刻 $x$ ，小L想知道，对于所有此时还在空中的篮球，高度最高的篮球的高度是多少。\n\n**注意** ：被发现的篮球的出现时间 $l,r$ 和小L统计信息的时刻 $x$ 均没有任何单调性。", "inputFormat": "输入的第一行为一个整数 $m$ 。\n\n接下来的 $m$ 行，每行为一个操作或询问，为以下形式之一：\n\n1.  `add a v l r` ：小L发现了一个在空中的篮球，这个篮球在时刻 $l$ 被抛向空中，在时刻 $r$ 被接住，这个篮球在时刻 $l$ 的高度是 $a$ ，向上的初始速度为 $v$ 。\n\n2.  `query x` ：请告诉小L，在他已经给出的信息中，在时刻 $x$ 在空中的所有篮球中最高的高度是多少。", "outputFormat": "对于每个 `query` 操作，输出一行，为这个最高的高度。如果此时不存在在空中的篮球，输出 `Undefined` 。\n\n为了减小精度误差，推荐使用 `long double` 类型存储浮点数，输出格式为 `%Lf` 。\n\n为了避免精度问题，本题使用 **Special Judge** 。如果您的答案与标程的答案相差小于等于 $0.005$ ，则会被视为是正确的。", "hint": "对于 $30\\%$ 的数据， $m\\le 5000$\n\n对于另外 $30\\%$ 的数据， $-100< l,r,x< 100$\n\n对于 $100\\%$ 的数据， $1\\le m\\le 100000,-1000< a,v < 1000,-10^6< l,r,x < 10^6,l\\le r$ ，保证输入中所有的小数均为 $3$ 位小数。\n\n篮球高度可能是负数。\n\n### 小K教你学物理\n\n本题中所有的单位均采用国际单位制。即时间单位是秒（ $s$ ），长度单位是米（ $m$ ）。\n\n本题中取重力加速度 $g=9.8 ~ m \\cdot s^{-2}$ 。\n\n省略掉篮球横向的位移，可以将篮球的运动看做是 **竖直上抛运动** 。根据题目中给出的信息，已知篮球初始的高度 $a$ ，初速度 $v$ ，重力加速度 $g$ ， **在空中的时间**  $t$ ，则篮球在这一时刻的高度是 $-\\dfrac 1 2 g t^2 + vt+a$ 。", "locale": "zh-CN"}}}
{"pid": "P5555", "type": "P", "difficulty": 6, "samples": [["6 7\naaabab\nababaaa", "3 3"], ["10 10\nbbaabaaaac\nbbaabaaaac", "5 1"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["字符串", "后缀自动机 SAM", "哈希 hashing", "回文自动机 PAM"], "title": "秩序魔咒", "background": "", "description": "现代魔法师小L和小K正在研究魔咒。\n\n“你知道如何使用魔咒吗？”\n\n“当然知道，这是一个现代魔法师最基本的修养。”\n\n“那你对魔咒的发展史了解多少？”\n\n“课上讲的我还记得一点。那是在很久很久之前了。当时，世界上还没有人会使用魔咒，而混沌魔法成为了魔法界当时的主流魔法。这是一种邪恶的法术，不需要技巧，不需要规则，内心越黑暗，力量越强。于是，邪恶的魔法师们自相残杀，弄得天昏地暗，血流成河。其中，以自称‘混沌恶魔’的魔法师为首的魔法师集团通过极其肮脏的手段控制了几乎整个魔法界，让那些向往秩序与和平的魔法师难以生存。就在这个时候，世界救星的救星出现了。名为莱赫穆拉和肯埋多卡的两名魔法师勇敢地站了出来，仅凭两个人的力量就与混沌恶魔集团展开了决战，可终究寡不敌众，被逼到了绝境。就在混沌恶魔的最后一击打中他们的身体时，莱赫穆拉和肯埋多卡利用这一击的巨大魔力，将两人余下的全部魔法与意志升格成了概念，创造了秩序魔咒体系，扭转了世界理论，使得混沌魔法被永远封印。而混沌恶魔也在这强烈的扭曲中灰飞烟灭。从此，魔法界由混沌纪元进入了秩序纪元，人们遵循莱赫穆拉和肯埋多卡这两位圣人的遗志，在秩序魔咒体系下使用魔咒，直到现在。”\n\n“原来是这样。我们如今需要遵循一系列原则来使用魔咒，是这个原因啊。”\n\n“是啊，这正是两位圣人为维持现在这个世界不退回混沌纪元而做的努力。话说，你是上个星期才刚刚上了第一堂魔法课，你还记得使用魔咒的几个原则吗？”\n\n“我想想。第一，必须出现在秩序序列中。当时二位圣人留下来的体系，经过后代魔法师不懈的努力，被翻译成了名为秩序序列的存在。为了方便现代魔法师使用，**秩序序列只由英文小写字母组成**。由于体系的力量过于强大而不能仅仅限制在一个序列中，**魔法师们分别将两位圣人的遗志转移到了两个秩序序列里**。魔咒必须受到秩序序列的限制。**具体来说，是必须出现在秩序序列里（是秩序序列的子串）**。由于二位圣人的遗志不可分割，**魔咒必须同时出现在两个秩序序列里**。第二，为了让魔咒稳定而精确，秩序体系规定了魔咒的形态。**具体来说，魔咒的第一个字符需要与魔咒的倒数第一个字符相同，魔咒的第二个字符需要与魔咒的倒数第二个字符相同，以此类推**。这样就可以使魔咒对称而有秩序了。还有的话，让我看看……”\n\n“别看了别看了，最重要的就是这些了。还有，你说不定还不知道，魔咒越长，力量越强大。”\n\n“是这样的吗？难怪那天老师演示的魔咒魔力比我的大那么多。”\n\n“是的是的。你是不是已经发现了，魔咒的力量是有最高限制的？”\n\n“啊，好像没错。但老师那天说，最强魔咒的使用者还没出现？”\n\n“对。使用者自身必须要有与魔咒同样程度的能力，才可能顺利地使用这个魔咒。我们这些初学者，不知道何年何月才能达到这个程度呢……”\n\n“唉……不如，我们来数一数力量最强的魔咒的长度，和它们有多少个吧。”\n\n“嗯，反正没事可做，我们就来干一干这种力所能及的事吧。”\n\n于是，小L和小K就开始数最强魔咒的长度和个数。可过了不一会儿，它们就坚持不住了，因为秩序序列实在太长太长了。\n\n现在，你作为一个资深魔法师，有必要告诉他们这种基本的常识。你当然已经知道两个秩序序列的形态，请你帮小L和小K算出最强魔咒的长度和个数。", "inputFormat": "第一行，两个整数$n,m$，分别表示两个秩序序列的长度。\n\n接着第二行与第三行，两个字符串，表示两个秩序序列，长度分别为$n,m$。", "outputFormat": "一行两个整数，用单个空格隔开，分别表示最强魔咒的长度与个数。", "hint": "**样例解释**\n\n样例1：符合规定的魔咒有$a,b,aa,aaa,aba,bab$，其中最强的有$aaa,aba,bab$，长度为$3$，共$3$个。\n\n样例2：符合规定的魔咒有$a,b,aa,aaa,aaaa,bb,baab,aba,aabaa,c$，其中最强的有$aabaa$，长度为$5$，共$1$个。\n\n**数据范围**\n\n由于某些原因，本题需要使用$Subtask$。为取得一个$Subtask$的得分，你需要通过此$Subtask$中的所有数据点。\n|  | 分值 | $n,m$取值范围 | 特殊性质 |\n| :----------: | :----------: | :----------: | :----------: |\n| $Subtask1$ | $0$ | $1\\le n,m\\le260817$ | 是样例 |\n| $Subtask2$ | $5$ | $1\\le n,m\\le260817$ | 两个秩序序列由同一字符组成 |\n| $Subtask3$ | $5$ | $1\\le n,m\\le10$ | 无 |\n| $Subtask4$ | $10$ | $1\\le n,m\\le300$ | 无 |\n| $Subtask5$ | $10$ | $1\\le n,m\\le2000$ | 无 |\n| $Subtask6$ | $30$ | $1\\le n,m\\le260817$ | 两个秩序序列相同 |\n| $Subtask7$ | $40$ | $1\\le n,m\\le260817$ | 无 |\n\n显然，相同的魔咒数量只计一次。保证至少存在一个长度不小于$1$的符合规定的魔咒。\n\n注意时限为$3s$。", "locale": "zh-CN", "translations": {"en": {"title": "Order Spell.", "background": "", "description": "Modern magicians Xiao L and Xiao K are studying spells.\n\n“Do you know how to use spells?”\n\n“Of course. This is the most basic quality of a modern magician.”\n\n“Then how much do you know about the history of spells?”\n\n“I still remember some of what was taught in class. That was a very, very long time ago. Back then, no one in the world could use spells, and chaotic magic was the mainstream magic in the magic world. This was an evil technique: it needed no skill and no rules, and the darker one’s heart was, the stronger its power became. So the evil magicians killed each other, turning the world upside down, with blood flowing like rivers. Among them, a magician who called himself the ‘Chaos Demon’ led a group of magicians who used extremely dirty means to control almost the entire magic world, making it hard for those who longed for order and peace to survive. At that time, the savior of the savior of the world appeared. Two magicians named Laihemu La and Kenmaiduoka bravely stood up. With only the power of the two of them, they started a decisive battle with the Chaos Demon group, but in the end they were outnumbered and forced into a desperate situation. Just as the Chaos Demon’s final strike hit their bodies, Laihemu La and Kenmaiduoka used the huge magical power of that strike to elevate all their remaining magic and will into concepts, creating the Order Spell system, twisting the world’s theory so that chaotic magic was sealed forever. And the Chaos Demon was also reduced to ashes in this intense distortion. From then on, the magic world entered the Age of Order from the Age of Chaos. People followed the last wishes of these two saints, Laihemu La and Kenmaiduoka, and used spells under the Order Spell system, until now.”\n\n“So that’s how it is. This is why we must follow a series of principles when using spells.”\n\n“Yes. This is exactly the effort the two saints made to keep the world from falling back into the Age of Chaos. By the way, you only had your first magic class last week. Do you still remember the principles for using spells?”\n\n“Let me think. First, it must appear in the order sequence. The system left by the two saints, after the unremitting efforts of later magicians, was translated into something called the order sequence. For the convenience of modern magicians, **the order sequence consists only of lowercase English letters**. Because the power of the system was too strong to be limited to only one sequence, **magicians transferred the wills of the two saints into two order sequences respectively**. A spell must be restricted by the order sequence. **Specifically, it must appear in the order sequence (it is a substring of the order sequence)**. Since the wills of the two saints are inseparable, **a spell must appear in both order sequences at the same time**. Second, in order to make the spell stable and accurate, the order system规定了魔咒的形态. **Specifically, the first character of the spell must be the same as the last character of the spell, the second character must be the same as the second-to-last character, and so on**. In this way, the spell becomes symmetric and orderly. As for more, let me see...”\n\n“Stop looking, stop looking. The most important things are these. Also, you might not know: the longer the spell, the stronger its power.”\n\n“Is that so? No wonder the spell the teacher demonstrated that day was so much more powerful than mine.”\n\n“Yes, yes. Have you already noticed that there is an upper limit to the power of spells?”\n\n“Ah, seems so. But the teacher said that the user of the strongest spell has not appeared yet?”\n\n“Right. The user must have ability at the same level as the spell in order to use it smoothly. We beginners don’t know when we will reach that level...”\n\n“Sigh... How about we count the length of the most powerful spell, and how many of them there are?”\n\n“Sure. Anyway we have nothing to do, so let’s do something within our ability.”\n\nSo Xiao L and Xiao K started counting the length and number of the strongest spells. But before long, they could not hold on, because the order sequences were far, far too long.\n\nNow, as a senior magician, you need to tell them this basic common knowledge. You already know the form of the two order sequences. Please help Xiao L and Xiao K compute the length and the number of the strongest spells.", "inputFormat": "The first line contains two integers $n,m$, representing the lengths of the two order sequences.\n\nThen the second and third lines contain two strings, representing the two order sequences, with lengths $n,m$ respectively.", "outputFormat": "Output one line containing two integers separated by a single space, representing the length and the number of the strongest spells.", "hint": "**Sample Explanation**\n\nSample 1: The spells that satisfy the requirements are $a,b,aa,aaa,aba,bab$. Among them, the strongest are $aaa,aba,bab$, with length $3$, and there are $3$ of them.\n\nSample 2: The spells that satisfy the requirements are $a,b,aa,aaa,aaaa,bb,baab,aba,aabaa,c$. Among them, the strongest is $aabaa$, with length $5$, and there is $1$ of it.\n\n**Constraints**\n\nFor some reason, this problem needs to use $Subtask$. To get the score of a $Subtask$, you need to pass all testdata points in this $Subtask$.\n|  | Score | Range of $n,m$ | Special Property |\n| :----------: | :----------: | :----------: | :----------: |\n| $Subtask1$ | $0$ | $1\\le n,m\\le260817$ | Samples |\n| $Subtask2$ | $5$ | $1\\le n,m\\le260817$ | Both order sequences consist of the same single character |\n| $Subtask3$ | $5$ | $1\\le n,m\\le10$ | None |\n| $Subtask4$ | $10$ | $1\\le n,m\\le300$ | None |\n| $Subtask5$ | $10$ | $1\\le n,m\\le2000$ | None |\n| $Subtask6$ | $30$ | $1\\le n,m\\le260817$ | The two order sequences are identical |\n| $Subtask7$ | $40$ | $1\\le n,m\\le260817$ | None |\n\nObviously, identical spells are counted only once. It is guaranteed that there exists at least one valid spell with length at least $1$.\n\nNote that the time limit is $3s$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "秩序魔咒", "background": "", "description": "现代魔法师小L和小K正在研究魔咒。\n\n“你知道如何使用魔咒吗？”\n\n“当然知道，这是一个现代魔法师最基本的修养。”\n\n“那你对魔咒的发展史了解多少？”\n\n“课上讲的我还记得一点。那是在很久很久之前了。当时，世界上还没有人会使用魔咒，而混沌魔法成为了魔法界当时的主流魔法。这是一种邪恶的法术，不需要技巧，不需要规则，内心越黑暗，力量越强。于是，邪恶的魔法师们自相残杀，弄得天昏地暗，血流成河。其中，以自称‘混沌恶魔’的魔法师为首的魔法师集团通过极其肮脏的手段控制了几乎整个魔法界，让那些向往秩序与和平的魔法师难以生存。就在这个时候，世界救星的救星出现了。名为莱赫穆拉和肯埋多卡的两名魔法师勇敢地站了出来，仅凭两个人的力量就与混沌恶魔集团展开了决战，可终究寡不敌众，被逼到了绝境。就在混沌恶魔的最后一击打中他们的身体时，莱赫穆拉和肯埋多卡利用这一击的巨大魔力，将两人余下的全部魔法与意志升格成了概念，创造了秩序魔咒体系，扭转了世界理论，使得混沌魔法被永远封印。而混沌恶魔也在这强烈的扭曲中灰飞烟灭。从此，魔法界由混沌纪元进入了秩序纪元，人们遵循莱赫穆拉和肯埋多卡这两位圣人的遗志，在秩序魔咒体系下使用魔咒，直到现在。”\n\n“原来是这样。我们如今需要遵循一系列原则来使用魔咒，是这个原因啊。”\n\n“是啊，这正是两位圣人为维持现在这个世界不退回混沌纪元而做的努力。话说，你是上个星期才刚刚上了第一堂魔法课，你还记得使用魔咒的几个原则吗？”\n\n“我想想。第一，必须出现在秩序序列中。当时二位圣人留下来的体系，经过后代魔法师不懈的努力，被翻译成了名为秩序序列的存在。为了方便现代魔法师使用，**秩序序列只由英文小写字母组成**。由于体系的力量过于强大而不能仅仅限制在一个序列中，**魔法师们分别将两位圣人的遗志转移到了两个秩序序列里**。魔咒必须受到秩序序列的限制。**具体来说，是必须出现在秩序序列里（是秩序序列的子串）**。由于二位圣人的遗志不可分割，**魔咒必须同时出现在两个秩序序列里**。第二，为了让魔咒稳定而精确，秩序体系规定了魔咒的形态。**具体来说，魔咒的第一个字符需要与魔咒的倒数第一个字符相同，魔咒的第二个字符需要与魔咒的倒数第二个字符相同，以此类推**。这样就可以使魔咒对称而有秩序了。还有的话，让我看看……”\n\n“别看了别看了，最重要的就是这些了。还有，你说不定还不知道，魔咒越长，力量越强大。”\n\n“是这样的吗？难怪那天老师演示的魔咒魔力比我的大那么多。”\n\n“是的是的。你是不是已经发现了，魔咒的力量是有最高限制的？”\n\n“啊，好像没错。但老师那天说，最强魔咒的使用者还没出现？”\n\n“对。使用者自身必须要有与魔咒同样程度的能力，才可能顺利地使用这个魔咒。我们这些初学者，不知道何年何月才能达到这个程度呢……”\n\n“唉……不如，我们来数一数力量最强的魔咒的长度，和它们有多少个吧。”\n\n“嗯，反正没事可做，我们就来干一干这种力所能及的事吧。”\n\n于是，小L和小K就开始数最强魔咒的长度和个数。可过了不一会儿，它们就坚持不住了，因为秩序序列实在太长太长了。\n\n现在，你作为一个资深魔法师，有必要告诉他们这种基本的常识。你当然已经知道两个秩序序列的形态，请你帮小L和小K算出最强魔咒的长度和个数。", "inputFormat": "第一行，两个整数$n,m$，分别表示两个秩序序列的长度。\n\n接着第二行与第三行，两个字符串，表示两个秩序序列，长度分别为$n,m$。", "outputFormat": "一行两个整数，用单个空格隔开，分别表示最强魔咒的长度与个数。", "hint": "**样例解释**\n\n样例1：符合规定的魔咒有$a,b,aa,aaa,aba,bab$，其中最强的有$aaa,aba,bab$，长度为$3$，共$3$个。\n\n样例2：符合规定的魔咒有$a,b,aa,aaa,aaaa,bb,baab,aba,aabaa,c$，其中最强的有$aabaa$，长度为$5$，共$1$个。\n\n**数据范围**\n\n由于某些原因，本题需要使用$Subtask$。为取得一个$Subtask$的得分，你需要通过此$Subtask$中的所有数据点。\n|  | 分值 | $n,m$取值范围 | 特殊性质 |\n| :----------: | :----------: | :----------: | :----------: |\n| $Subtask1$ | $0$ | $1\\le n,m\\le260817$ | 是样例 |\n| $Subtask2$ | $5$ | $1\\le n,m\\le260817$ | 两个秩序序列由同一字符组成 |\n| $Subtask3$ | $5$ | $1\\le n,m\\le10$ | 无 |\n| $Subtask4$ | $10$ | $1\\le n,m\\le300$ | 无 |\n| $Subtask5$ | $10$ | $1\\le n,m\\le2000$ | 无 |\n| $Subtask6$ | $30$ | $1\\le n,m\\le260817$ | 两个秩序序列相同 |\n| $Subtask7$ | $40$ | $1\\le n,m\\le260817$ | 无 |\n\n显然，相同的魔咒数量只计一次。保证至少存在一个长度不小于$1$的符合规定的魔咒。\n\n注意时限为$3s$。", "locale": "zh-CN"}}}
{"pid": "P5556", "type": "P", "difficulty": 6, "samples": [["2 3\n3 4\n1 2\nQuery 1 2\nUpdate 2 2 7\nQuery 2 1", "NO\nYES"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["树状数组", "树链剖分", "线性基"], "title": "圣剑护符", "background": "小L和小K正在研究传说中的圣剑。\n\n“所谓圣剑，是封入了各种护符并将其固定为刀剑外形的一种东西。据说一旦用咒力线把护符们接合在一起，就会产生复杂的相互干涉作用。”", "description": "小L和小K面前的圣剑由 $n$ 块护符组成，分别编号为 $1,2,\\ldots , n$ ，有 $n-1$ 条咒力线连接两块护符，形成了一个树形结构。\n\n经过小L和小K的长时间的研究，他们发现护符之间的相互作用并不复杂。每块护符都有一个属性值，第 $i$ 块护符的属性值记为 $v_i$ 。这个值的每个二进制位上的 $0$ 或 $1$ 表示这块护符是否拥有特定属性。所有属性值中相同的二进制位对应的是相同的属性。\n\n对于一系列护符（护符的集合），对于每种特定属性，统计其中包含这一属性的护符数量，如果为偶数，则这一系列护符形成了干涉，最终的属性值对应的二进制位上为 $0$ ，如果为奇数则干涉后剩下了一块护符的影响，对应的二进制位为 $1$ 。也就是说， **护符集合的属性值为单个护符的属性值的异或和** 。 **空集的属性值定义为 $0$** 。\n\n现在，小L想知道，如果取出两块护符 $x,y$ 间的简单路径上的所有护符，能否找到两个不相等的子集，使得两个子集的属性值相同（注意到空集也是路径上所有护符集合的子集）。同时，小K还会将两块护符间的路径上的所有护符取出进行调整，将所有这些护符的属性值在某些相同二进制位上进行修改（即 $0$ 变为 $1$ ， $1$ 变为 $0$ ），可以看做是将所有这些护符的属性值异或上了一个值。", "inputFormat": "输入的第一行为两个整数 $n,q$ ，分别表示护符的数量和小L和小K的操作的数量。\n\n下一行有 $n$ 个整数，第 $i$ 个数表示第 $i$ 块护符的属性值 $v_i$ 。\n\n接下来的 $n-1$ 行，每行有两个整数 $x,y$ ，表示有一条咒力线连接了 $x,y$ 两块护符。保证形成一个树形结构。\n\n接下来的 $q$ 行，每行一个操作，形式如下：\n\n1.  `Update x y z` ：将编号分别为 $x,y$ 的两块护符间的简单路径上的所有护符的属性值异或上一个值 $z$ 。\n\n2. `Query x y` ： 判断对于编号分别为 $x,y$ 的两块护符间的简单路径上的护符的集合，是否存在两个不相等的子集，使得两个子集的属性值相同。", "outputFormat": "对于每个 `Query` 操作，输出一行 `YES` 或 `NO` 。", "hint": "由于某种原因，本题将采用 **捆绑测试** 。只有通过一个子任务内的所有测试点，才能得到该子任务的全部分数，否则得 $0$ 分。\n\n$Subtask\\#1$ ： $20pts$ ， $x,y$ 在树上的距离小于等于 $5$ 。\n\n$Subtask\\#2$ ： $40pts$ ， $n,q\\le 5000,0\\le v_i,z\\le 2^{10}$\n\n$Subtask\\#3$ ： $40pts$ ，无特殊限制。\n\n对于 $100\\%$ 的数据，有 $1\\le n,q\\le 10^5,1\\le x,y\\le n,0\\le v_i,z< 2^{30}$\n", "locale": "zh-CN", "translations": {"en": {"title": "Sacred Sword Talismans", "background": "Xiao L and Xiao K are studying the legendary sacred sword.\n\n“A so-called sacred sword is something made by sealing various talismans and fixing them into the shape of a blade. It is said that once the talismans are connected together with spell-power lines, complicated mutual interference will occur.”", "description": "The sacred sword in front of Xiao L and Xiao K is made of $n$ talismans, numbered $1,2,\\ldots,n$. There are $n-1$ spell-power lines connecting pairs of talismans, forming a tree structure.\n\nAfter a long period of research, they found that the interaction between talismans is not complicated. Each talisman has an attribute value; the attribute value of talisman $i$ is denoted by $v_i$. Each bit ($0$ or $1$) in the binary representation of this value indicates whether the talisman has a certain attribute. The same bit position across all attribute values corresponds to the same attribute.\n\nFor a collection of talismans (a set of talismans), for each specific attribute, count how many talismans in the collection contain this attribute. If the count is even, then this collection produces interference, and the corresponding bit in the final attribute value is $0$. If the count is odd, then after interference there remains the influence of one talisman, and the corresponding bit is $1$. In other words, **the attribute value of a set of talismans is the XOR sum of the attribute values of the individual talismans**. **The attribute value of the empty set is defined as $0$**.\n\nNow, Xiao L wants to know: if we take all talismans on the simple path between two talismans $x$ and $y$, can we find two different subsets such that the two subsets have the same attribute value (note that the empty set is also a subset of the set of all talismans on the path). Meanwhile, Xiao K will also take out all talismans on the path between the two talismans and adjust them, modifying the attribute values of all these talismans on some same bit positions (i.e., changing $0$ to $1$ and $1$ to $0$). This can be seen as XOR-ing the attribute values of all these talismans with a value.", "inputFormat": "The first line contains two integers $n,q$, representing the number of talismans and the number of operations by Xiao L and Xiao K.\n\nThe next line contains $n$ integers. The $i$-th number is the attribute value $v_i$ of talisman $i$.\n\nThe following $n-1$ lines each contain two integers $x,y$, indicating that there is a spell-power line connecting talismans $x$ and $y$. It is guaranteed to form a tree structure.\n\nThe next $q$ lines each describe an operation in one of the following forms:\n\n1. `Update x y z`: XOR the attribute values of all talismans on the simple path between talismans $x$ and $y$ with a value $z$.\n\n2. `Query x y`: Determine whether, for the set of talismans on the simple path between talismans $x$ and $y$, there exist two different subsets such that their attribute values are the same.", "outputFormat": "For each `Query` operation, output one line containing `YES` or `NO`.", "hint": "For some reason, this problem uses **bundled testdata**. You can get the full score of a subtask only if you pass all test points in that subtask; otherwise you get $0$ points.\n\n$Subtask\\#1$: $20pts$, the distance between $x$ and $y$ in the tree is at most $5$.\n\n$Subtask\\#2$: $40pts$, $n,q\\le 5000$, $0\\le v_i,z\\le 2^{10}$.\n\n$Subtask\\#3$: $40pts$, no special constraints.\n\nFor $100\\%$ of the data, $1\\le n,q\\le 10^5$, $1\\le x,y\\le n$, $0\\le v_i,z<2^{30}$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "圣剑护符", "background": "小L和小K正在研究传说中的圣剑。\n\n“所谓圣剑，是封入了各种护符并将其固定为刀剑外形的一种东西。据说一旦用咒力线把护符们接合在一起，就会产生复杂的相互干涉作用。”", "description": "小L和小K面前的圣剑由 $n$ 块护符组成，分别编号为 $1,2,\\ldots , n$ ，有 $n-1$ 条咒力线连接两块护符，形成了一个树形结构。\n\n经过小L和小K的长时间的研究，他们发现护符之间的相互作用并不复杂。每块护符都有一个属性值，第 $i$ 块护符的属性值记为 $v_i$ 。这个值的每个二进制位上的 $0$ 或 $1$ 表示这块护符是否拥有特定属性。所有属性值中相同的二进制位对应的是相同的属性。\n\n对于一系列护符（护符的集合），对于每种特定属性，统计其中包含这一属性的护符数量，如果为偶数，则这一系列护符形成了干涉，最终的属性值对应的二进制位上为 $0$ ，如果为奇数则干涉后剩下了一块护符的影响，对应的二进制位为 $1$ 。也就是说， **护符集合的属性值为单个护符的属性值的异或和** 。 **空集的属性值定义为 $0$** 。\n\n现在，小L想知道，如果取出两块护符 $x,y$ 间的简单路径上的所有护符，能否找到两个不相等的子集，使得两个子集的属性值相同（注意到空集也是路径上所有护符集合的子集）。同时，小K还会将两块护符间的路径上的所有护符取出进行调整，将所有这些护符的属性值在某些相同二进制位上进行修改（即 $0$ 变为 $1$ ， $1$ 变为 $0$ ），可以看做是将所有这些护符的属性值异或上了一个值。", "inputFormat": "输入的第一行为两个整数 $n,q$ ，分别表示护符的数量和小L和小K的操作的数量。\n\n下一行有 $n$ 个整数，第 $i$ 个数表示第 $i$ 块护符的属性值 $v_i$ 。\n\n接下来的 $n-1$ 行，每行有两个整数 $x,y$ ，表示有一条咒力线连接了 $x,y$ 两块护符。保证形成一个树形结构。\n\n接下来的 $q$ 行，每行一个操作，形式如下：\n\n1.  `Update x y z` ：将编号分别为 $x,y$ 的两块护符间的简单路径上的所有护符的属性值异或上一个值 $z$ 。\n\n2. `Query x y` ： 判断对于编号分别为 $x,y$ 的两块护符间的简单路径上的护符的集合，是否存在两个不相等的子集，使得两个子集的属性值相同。", "outputFormat": "对于每个 `Query` 操作，输出一行 `YES` 或 `NO` 。", "hint": "由于某种原因，本题将采用 **捆绑测试** 。只有通过一个子任务内的所有测试点，才能得到该子任务的全部分数，否则得 $0$ 分。\n\n$Subtask\\#1$ ： $20pts$ ， $x,y$ 在树上的距离小于等于 $5$ 。\n\n$Subtask\\#2$ ： $40pts$ ， $n,q\\le 5000,0\\le v_i,z\\le 2^{10}$\n\n$Subtask\\#3$ ： $40pts$ ，无特殊限制。\n\n对于 $100\\%$ 的数据，有 $1\\le n,q\\le 10^5,1\\le x,y\\le n,0\\le v_i,z< 2^{30}$\n", "locale": "zh-CN"}}}
{"pid": "P5557", "type": "P", "difficulty": 5, "samples": [["6\n2 3 4 5 6 1\n3\n1 2 2\n2 7 1\n6 1 1", "5\n3\n1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["倍增", "O2优化"], "title": "旅行", "background": "> 光阴似箭。如烟火，只许刹那芳华；似九月，夜幕昙花一闪而散。\n> 辉煌已逝。步征夫，辗转行路之洼；立孤叶，夙夜漂泊四海之旅。\n——《旅行》", "description": "行走与尘世之间，charine 是一位旅行家。踏入城市的喧嚣，他开始了辗转于城市的旅行……\n\n这是一个具有 $n$ 个城市的城市群，每两个点可以互相到达。现代交通技术飞速发展，大大缩短了航程，距离已显得不在那么重要：\n\n城市群里，道路已经没有长长短短之说，**每一条道路由于时间的不断缩短都可视为等长**，把它们以一个单位计量，可以容易的视其为 $1$ zm。\n\n正是由于城市群的庞大，未脱离于城市的 charine 亦有牵绊，这使他不可能无限遨游于这宽广的城市群里。这使 charine 极为郁闷，他决定选择尽可能短的时间走遍整个城市群。\n\n具体而言，charine 不会因为在某个城市里而耽误他遨游天下的决心，他走访的每一个城市，都会在极短的时间里将其印在脑海里。\n\ncharine 的行走速度不会很快，这意味着他只能在一个单位时间内行走 $1$ zm。\n\n这却使他更着急着找到足够旅行更多城市的方法……\n\n为了去除他在每一个岔路口的犹豫时间，charine 亦是聪明的提前了他的旅行计划。对于走出城市 $i$ 的那几个路口，charine 给这个城市定义了一个通路 $a_i$，他相信自己的计划，就一定会踩着通路向前走。**走访完城市 $i$ 的他会给自己的下一个城市目标定为 $a_i$**。\n\n处理完这些以后，他便是再也找不出继续缩短时间的办法了，于是他开始执行了自己的旅行计划。\n\ncharine 有 $m$ 个季度都有出行的机会，对于第 $i$ 个季度，charine 将会从 $S_i$ 出发，他告诉你，他会准备 $t$ 单位时间去旅行。\n\n为了能及时的看到他的身影，你要知道，**$t$ 单位时间后 charine 会出现在哪个城市……**\n\n**注意“道路”与“通路”的定义问题。**", "inputFormat": "输入数据的第一行为一个正整数 $n$，表示城市数。\n\n第二行 $n$ 个整数，第 $i$ 个整数表示 $a_i$。\n\n接下来一个整数 $m$，表示 $m$ 个季度。\n\n第 $4$ 到 $m+3$ 行，描述一次旅行，每行 $3$ 个整数，$S_i,t_1,t_2$，描述见题面，其中，$t=t_1^{t_2}$。", "outputFormat": "对于每个季度输出一行，表示答案。", "hint": "样例解析：\n\n从 $1$ 开始走 $2^{2}$ 步到达 $5$（$1-2-3-4-5$）\n\n从 $2$ 开始走 $7^{1}$ 步到达 $3$（$2-3-4-5-6-1-2-3$）\n\n从 $6$ 开始走 $1^{1}$ 步到达 $1$（$6-1$）\n\n对于 $10\\%$ 的数据，$n\\leq 100$，$m\\leq 300$，$t_1\\leq 100$。\n\n对于 $50\\%$ 的数据，$n\\leq 3000$，$m\\leq 3000$，$t_1\\leq 3000$，$t_2=1$。\n\n对于 $70\\%$ 的数据，$n\\leq 3000$，$m\\leq 3000$。\n\n对于 $100\\%$ 的数据，$n\\leq 400000$，$m\\leq 300000$，$t_1\\leq 10^{9}$，$t_2\\leq 10^9$。", "locale": "zh-CN", "translations": {"en": {"title": "Travel", "background": "> Time flies like an arrow. Like fireworks, beauty lasts only for a moment; like September, the night-blooming cereus flashes and disappears.\n> Glory has faded. Like a traveler on a long march, turning through the lows of the road; like a lonely leaf, wandering day and night on a journey across the world.\n— “Travel”", "description": "Walking through the mortal world, charine is a traveler. Stepping into the noise of cities, he begins his journey from city to city.\n\nThere is a group of cities with $n$ cities, and any two cities are reachable from each other. With the rapid development of modern transportation, travel time has been greatly reduced, so distance no longer seems that important:\n\nIn this city group, roads no longer have different lengths. **Because travel time keeps shrinking, every road can be regarded as having the same length**, measured as one unit, which can be seen as $1$ zm.\n\nHowever, because the city group is huge and charine still has things tying him down, he cannot travel forever in this vast city group. This makes him very upset, so he decides to spend as little time as possible to visit the entire city group.\n\nSpecifically, charine will not waste time staying in any city. Every city he visits will be remembered in a very short time.\n\ncharine does not walk fast, which means he can only walk $1$ zm in one unit of time.\n\nThis makes him even more eager to find a way to travel to more cities.\n\nTo remove the hesitation time at every intersection, charine wisely planned his trip in advance. For the exits leaving city $i$, charine defines a “passage” $a_i$ for this city. He trusts his plan and will definitely follow the passage forward. **After visiting city $i$, he will set his next target city to be $a_i$.**\n\nAfter finishing these preparations, he can no longer find any way to further shorten the time, so he starts executing his travel plan.\n\ncharine has $m$ seasons when he has a chance to travel. For the $i$-th season, charine will start from $S_i$. He tells you that he will prepare $t$ units of time for traveling.\n\nTo see him in time, you need to know: **after $t$ units of time, which city will charine appear in?**\n\n**Note the difference between the definitions of “road” and “passage”.**", "inputFormat": "The first line contains a positive integer $n$, the number of cities.\n\nThe second line contains $n$ integers. The $i$-th integer is $a_i$.\n\nNext is an integer $m$, indicating $m$ seasons.\n\nLines $4$ to $m+3$ each describe one trip. Each line contains three integers $S_i, t_1, t_2$ as described above, where $t=t_1^{t_2}$.", "outputFormat": "For each season, output one line containing the answer.", "hint": "Sample explanation:\n\nStart from $1$ and walk $2^{2}$ steps to reach $5$ ($1-2-3-4-5$).\n\nStart from $2$ and walk $7^{1}$ steps to reach $3$ ($2-3-4-5-6-1-2-3$).\n\nStart from $6$ and walk $1^{1}$ step to reach $1$ ($6-1$).\n\nFor $10\\%$ of the testdata, $n\\leq 100$, $m\\leq 300$, $t_1\\leq 100$.\n\nFor $50\\%$ of the testdata, $n\\leq 3000$, $m\\leq 3000$, $t_1\\leq 3000$, $t_2=1$.\n\nFor $70\\%$ of the testdata, $n\\leq 3000$, $m\\leq 3000$.\n\nFor $100\\%$ of the testdata, $n\\leq 400000$, $m\\leq 300000$, $t_1\\leq 10^{9}$, $t_2\\leq 10^9$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "旅行", "background": "> 光阴似箭。如烟火，只许刹那芳华；似九月，夜幕昙花一闪而散。\n> 辉煌已逝。步征夫，辗转行路之洼；立孤叶，夙夜漂泊四海之旅。\n——《旅行》", "description": "行走与尘世之间，charine 是一位旅行家。踏入城市的喧嚣，他开始了辗转于城市的旅行……\n\n这是一个具有 $n$ 个城市的城市群，每两个点可以互相到达。现代交通技术飞速发展，大大缩短了航程，距离已显得不在那么重要：\n\n城市群里，道路已经没有长长短短之说，**每一条道路由于时间的不断缩短都可视为等长**，把它们以一个单位计量，可以容易的视其为 $1$ zm。\n\n正是由于城市群的庞大，未脱离于城市的 charine 亦有牵绊，这使他不可能无限遨游于这宽广的城市群里。这使 charine 极为郁闷，他决定选择尽可能短的时间走遍整个城市群。\n\n具体而言，charine 不会因为在某个城市里而耽误他遨游天下的决心，他走访的每一个城市，都会在极短的时间里将其印在脑海里。\n\ncharine 的行走速度不会很快，这意味着他只能在一个单位时间内行走 $1$ zm。\n\n这却使他更着急着找到足够旅行更多城市的方法……\n\n为了去除他在每一个岔路口的犹豫时间，charine 亦是聪明的提前了他的旅行计划。对于走出城市 $i$ 的那几个路口，charine 给这个城市定义了一个通路 $a_i$，他相信自己的计划，就一定会踩着通路向前走。**走访完城市 $i$ 的他会给自己的下一个城市目标定为 $a_i$**。\n\n处理完这些以后，他便是再也找不出继续缩短时间的办法了，于是他开始执行了自己的旅行计划。\n\ncharine 有 $m$ 个季度都有出行的机会，对于第 $i$ 个季度，charine 将会从 $S_i$ 出发，他告诉你，他会准备 $t$ 单位时间去旅行。\n\n为了能及时的看到他的身影，你要知道，**$t$ 单位时间后 charine 会出现在哪个城市……**\n\n**注意“道路”与“通路”的定义问题。**", "inputFormat": "输入数据的第一行为一个正整数 $n$，表示城市数。\n\n第二行 $n$ 个整数，第 $i$ 个整数表示 $a_i$。\n\n接下来一个整数 $m$，表示 $m$ 个季度。\n\n第 $4$ 到 $m+3$ 行，描述一次旅行，每行 $3$ 个整数，$S_i,t_1,t_2$，描述见题面，其中，$t=t_1^{t_2}$。", "outputFormat": "对于每个季度输出一行，表示答案。", "hint": "样例解析：\n\n从 $1$ 开始走 $2^{2}$ 步到达 $5$（$1-2-3-4-5$）\n\n从 $2$ 开始走 $7^{1}$ 步到达 $3$（$2-3-4-5-6-1-2-3$）\n\n从 $6$ 开始走 $1^{1}$ 步到达 $1$（$6-1$）\n\n对于 $10\\%$ 的数据，$n\\leq 100$，$m\\leq 300$，$t_1\\leq 100$。\n\n对于 $50\\%$ 的数据，$n\\leq 3000$，$m\\leq 3000$，$t_1\\leq 3000$，$t_2=1$。\n\n对于 $70\\%$ 的数据，$n\\leq 3000$，$m\\leq 3000$。\n\n对于 $100\\%$ 的数据，$n\\leq 400000$，$m\\leq 300000$，$t_1\\leq 10^{9}$，$t_2\\leq 10^9$。", "locale": "zh-CN"}}}
{"pid": "P5558", "type": "P", "difficulty": 6, "samples": [["5\n1 2 5\n2 3 1\n1 4 1\n3 5 4\n3\n2 1\n4 2\n1 1\n", "1\n2\n0\n"], ["7\n1 2 1\n1 3 5\n2 4 1\n4 5 4\n5 6 1\n1 7 1\n5\n7 5\n7 6\n2 7\n1 1\n2 4", "4\n4\n2\n0\n1\n"], ["20\n1 2 1\n1 3 3\n2 4 5\n1 5 1\n5 6 5\n1 7 5\n1 8 4\n7 9 1\n8 10 2\n1 11 1\n2 12 5\n3 13 1\n3 14 3\n3 15 3\n10 16 1\n5 17 1\n12 18 5\n7 19 4\n7 20 5\n10\n10 3\n17 16\n11 9\n4 6\n16 17\n11 16\n11 11\n13 11\n2 1\n10 11", "2\n3\n2\n3\n3\n2\n0\n2\n1\n2\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1500, 1500, 1500], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["动态规划 DP", "倍增", "O2优化", "矩阵加速", "树链剖分"], "title": "心上秋", "background": "辗转经由他人唇齿\n\n多少日夜听闻你的故事\n\n难道这情之一字\n\n竟连抛生死亦不可探知\n\n听说北国的那座城池\n\n被冬雪覆了终日\n\n等到故人长诀渐行渐远\n\n转眼已隔两世\n\n谁向生而死 谁患得患失\n\n相顾也再无多时\n\n画中人暗自 竟心荡神痴\n\n一滴泪氤氲满纸\n\n挥墨描眉目 提笔勾鬓丝\n\n寥寥几笔竟如此\n\n夜半无人处 对月展卷时\n\n忽然看懂这相思\n\n落款谁提了名字\n\n————《心上秋》", "description": "竟宁元年（前33年）正月，昭君出塞前一晚。\n\n画师跌跌撞撞地来到昭君居住的宫殿。\n\n     听说北国的那座城池\n     被冬雪覆了终日\n     等到故人长诀渐行渐远\n     转眼已隔两世\n                ——《心上秋》\n\n如果再也不能相见的话，画师想着，他想给昭君留下些什么。\n\n他想把他的画笔送给昭君。\n\n**昭君的宫殿里有$N$个房间，有$N-1$条道路连接这些房间。**\n\n**画师现在在宫殿的入口大厅$S$房间，他依稀记得，昭君的房间在$T$号。**\n\n窗外，风雨大作，宫内忽暗忽明，一个人影也没有。\n\n画家走进晦暗的通道，每条通道里的墙壁上都画有若干片枫叶，这是之前昭君让画师画的。昭君说，她特别喜欢秋天，尤其喜欢秋天的枫叶。\n\n      并肩长谈过多少往事，恍然间黄昏已至    ——《心上秋》\n\n通道内晦暗无比，画师想点亮通道内备好的蜡烛，他记得昭君有个习惯，**每个通道内的蜡烛数量就是墙上枫叶的数量。昭君若想点燃一条通道内的蜡烛，就会全部点燃，此时昭君认为这条通道已被点亮，并且不会再点亮任何枫叶数少于这条通道的通道**。\n\n这应该是最后一次来到这个地方了，画师想着，他要按昭君的习惯，走到昭君的房间。同时，画师不想走回头路，所以他不会走自己已经走过的通道。\n\n**现在画师想知道，他从宫殿大厅$S$走到昭君房间$T$，在不走回头路的情况下，最多可以点亮多少通道。**", "inputFormat": "第一行一个数$N$，表示宫殿房间数量。\n\n接下来有$N-1$行，每行三个数$u_{i},v_{i},leaf_{i}$，表示$u,v$之间有一条通道，通道上画有$leaf_{i}$片枫叶。\n\n接下来一个数$M$。\n\n最后$M$行，每行两个数$S_{i},T_{i}$", "outputFormat": "输出$M$行，对于每组$S_{i},T_{i}$，输出最多能够点亮的通道数。", "hint": "| 数据编号 | N | M | 特殊性质 |\n| :----------: | :----------: | :----------: | :----------: |\n| $1$ | $100$ | $100$ | 无 |\n| $2$ | $100$ | $100$ | 无 |\n| $3$ | $100$ | $1000$ | 无 |\n| $4$ | $10000$ | $10000$ | 无 |\n| $5$ | $10000$ | $10000$ | $1$ |\n| $6$ | $10000$ | $10000$ | $1,2$ |\n| $7$ | $10000$ | $10000$ | $1,2$ |\n| $8$ | $30000$ | $100000$ | 无 |\n| $9$ | $30000$ | $100000$ | 无 |\n| $10$ | $30000$ |$300000$  | 无 |\n特殊性质$1$：$1<=leaf_{i}<=2$\n\n特殊性质$2$：$u_{i}+1=v_{i}$\n\n对于所有的数据，保证$1<=leaf_{i}<=5$\n\n样例一解析：\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/eaxwdth6.png)\n\n询问$1$：从$2$走到$1$最多点亮$1$条通道（$2-1$）\n\n询问$2$：从$4$走到$2$最多点亮$2$条通道（$4-1,1-2$）\n\n询问$3$：显然无法点亮通道。\n\n样例二解析：\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/8z9tovt5.png))\n\n询问$1$：从$7$走到$5$，可以点亮$4$个通道（$7-1,1-2,2-4,4-5$）\n\n询问$2$：从$7$走到$6$，可以点亮$4$个通道（$7-1,1-2,2-4,4-5$），不点亮（$5-6$）是因为已经点亮（$4-5$）后无法点亮比枫叶数小于$4$的通道，易知这样是最优的，或者不点亮（$4-5$）而点亮（$5-6$），这同样是最优解。\n\n询问$3$：从$2$走到$7$，可以点亮$2$个通道（$2-1$,$1-7$）\n\n询问$4$：不经过任何通道。\n\n询问$5$：经过$1$条通道（$2-4$）\n\n\n     何处合成愁。离人心上秋。纵芭蕉，不雨也飕飕。都道晚凉天气好，有明月，怕登楼。\n\n     年事梦中休。花空烟水流。燕辞归，客尚淹留。垂柳不萦裙带住。漫长是，系行舟。", "locale": "zh-CN", "translations": {"en": {"title": "Heartfelt Autumn", "background": "Windingly passing through others’ lips and teeth.\n\nHow many days and nights have I heard your story.\n\nCould it be that this one word, “love,”\n\nCannot be understood even if one throws away life and death.\n\nI heard that city in the northern land,\n\nIs covered by winter snow all day long.\n\nBy the time old friends part forever and walk farther and farther away,\n\nIn the blink of an eye, it is already two lifetimes apart.\n\nWho goes from life to death, who worries about gain and loss,\n\nThere is not much time left even to look at each other.\n\nThe person in the painting secretly—his heart sways and his spirit is lost.\n\nA drop of tears blurs the whole page.\n\nWaving ink to draw eyebrows and eyes, lifting the brush to trace the hair at the temples.\n\nWith just a few strokes, it turns out to be like this.\n\nAt midnight where no one is, unrolling the scroll to the moon,\n\nSuddenly I understand this longing.\n\nWhose signature wrote the name.\n\n———— “Heartfelt Autumn”\n\n# Background\n\nIn the first month of the first year of Jingning (33 BC), the night before Zhaojun left for the frontier.\n\nThe painter stumbled and crashed as he came to the palace where Zhaojun lived.\n\n> I heard that city in the northern land  \n> Is covered by winter snow all day long  \n> By the time old friends part forever and walk farther and farther away  \n> In the blink of an eye, it is already two lifetimes apart  \n> —— “Heartfelt Autumn”\n\nIf they could never meet again, the painter thought, he wanted to leave something for Zhaojun.\n\nHe wanted to give his paintbrush to Zhaojun.\n\n**There are $N$ rooms in Zhaojun’s palace, connected by $N-1$ roads.**\n\n**The painter is now in the entrance hall room $S$. He vaguely remembers that Zhaojun’s room is number $T$.**\n\nOutside the window, the wind and rain rage. Inside the palace it flickers between light and dark, and there is not a single shadow of a person.\n\nThe painter walks into the dim corridor. On the wall of each corridor, there are several maple leaves painted—these were painted earlier at Zhaojun’s request. Zhaojun said she especially liked autumn, and especially the maple leaves of autumn.\n\n> How many past events did we talk about side by side—before we knew it, dusk had arrived.  \n> —— “Heartfelt Autumn”\n\nThe corridor is extremely dark. The painter wants to light the candles prepared inside. He remembers Zhaojun had a habit: **in each corridor, the number of candles equals the number of maple leaves on the wall. If Zhaojun wants to light the candles in a corridor, she will light them all. At that moment, Zhaojun considers that corridor to be lit up, and she will not light up any corridor whose number of maple leaves is less than that corridor’s**.\n\nThis should be the last time coming to this place, the painter thought. He wants to follow Zhaojun’s habit and walk to Zhaojun’s room. At the same time, the painter does not want to go back the way he came, so he will not take any corridor he has already walked through.\n\n**Now the painter wants to know: when he walks from the palace hall $S$ to Zhaojun’s room $T$, without going back, what is the maximum number of corridors he can light up?**", "description": "In the first month of the first year of Jingning (33 BC), the night before Zhaojun left for the frontier.\n\nThe painter stumbled and crashed as he came to the palace where Zhaojun lived.\n\n> I heard that city in the northern land  \n> Is covered by winter snow all day long  \n> By the time old friends part forever and walk farther and farther away  \n> In the blink of an eye, it is already two lifetimes apart  \n> —— “Heartfelt Autumn”\n\nIf they could never meet again, the painter thought, he wanted to leave something for Zhaojun.\n\nHe wanted to give his paintbrush to Zhaojun.\n\n**There are $N$ rooms in Zhaojun’s palace, connected by $N-1$ roads.**\n\n**The painter is now in the entrance hall room $S$. He vaguely remembers that Zhaojun’s room is number $T$.**\n\nOutside the window, the wind and rain rage. Inside the palace it flickers between light and dark, and there is not a single shadow of a person.\n\nThe painter walks into the dim corridor. On the wall of each corridor, there are several maple leaves painted—these were painted earlier at Zhaojun’s request. Zhaojun said she especially liked autumn, and especially the maple leaves of autumn.\n\n> How many past events did we talk about side by side—before we knew it, dusk had arrived.  \n> —— “Heartfelt Autumn”\n\nThe corridor is extremely dark. The painter wants to light the candles prepared inside. He remembers Zhaojun had a habit: **in each corridor, the number of candles equals the number of maple leaves on the wall. If Zhaojun wants to light the candles in a corridor, she will light them all. At that moment, Zhaojun considers that corridor to be lit up, and she will not light up any corridor whose number of maple leaves is less than that corridor’s**.\n\nThis should be the last time coming to this place, the painter thought. He wants to follow Zhaojun’s habit and walk to Zhaojun’s room. At the same time, the painter does not want to go back the way he came, so he will not take any corridor he has already walked through.\n\n**Now the painter wants to know: when he walks from the palace hall $S$ to Zhaojun’s room $T$, without going back, what is the maximum number of corridors he can light up?**", "inputFormat": "The first line contains an integer $N$, meaning the number of rooms in the palace.\n\nNext there are $N-1$ lines. Each line contains three integers $u_{i}, v_{i}, leaf_{i}$, meaning there is a corridor between $u$ and $v$, and there are $leaf_{i}$ maple leaves painted in that corridor.\n\nNext is an integer $M$.\n\nThe last $M$ lines each contain two integers $S_{i}, T_{i}$.", "outputFormat": "Output $M$ lines. For each query $S_{i}, T_{i}$, output the maximum number of corridors that can be lit.", "hint": "## Constraints\n\n| Test ID | N | M | Special Properties |\n| :----------: | :----------: | :----------: | :----------: |\n| $1$ | $100$ | $100$ | None |\n| $2$ | $100$ | $100$ | None |\n| $3$ | $100$ | $1000$ | None |\n| $4$ | $10000$ | $10000$ | None |\n| $5$ | $10000$ | $10000$ | $1$ |\n| $6$ | $10000$ | $10000$ | $1,2$ |\n| $7$ | $10000$ | $10000$ | $1,2$ |\n| $8$ | $30000$ | $100000$ | None |\n| $9$ | $30000$ | $100000$ | None |\n| $10$ | $30000$ | $300000$ | None |\n\nSpecial property $1$: $1<=leaf_{i}<=2$.\n\nSpecial property $2$: $u_{i}+1=v_{i}$.\n\nFor all testdata, it is guaranteed that $1<=leaf_{i}<=5$.\n\nAnalysis of Sample 1:\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/eaxwdth6.png)\n\nQuery $1$: From $2$ to $1$, at most $1$ corridor can be lit ($2-1$).\n\nQuery $2$: From $4$ to $2$, at most $2$ corridors can be lit ($4-1, 1-2$).\n\nQuery $3$: Obviously, no corridor can be lit.\n\nAnalysis of Sample 2:\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/8z9tovt5.png))\n\nQuery $1$: From $7$ to $5$, $4$ corridors can be lit ($7-1, 1-2, 2-4, 4-5$).\n\nQuery $2$: From $7$ to $6$, $4$ corridors can be lit ($7-1, 1-2, 2-4, 4-5$). Not lighting ($5-6$) is because after lighting ($4-5$), it is impossible to light a corridor whose number of maple leaves is less than $4$. It is easy to see this is optimal. Alternatively, do not light ($4-5$) and instead light ($5-6$); this is also optimal.\n\nQuery $3$: From $2$ to $7$, $2$ corridors can be lit ($2-1$, $1-7$).\n\nQuery $4$: Do not pass through any corridor.\n\nQuery $5$: Pass through $1$ corridor ($2-4$).\n\nWhere can sorrow be made whole. Autumn rests on the hearts of those who part. Even banana leaves, without rain, still rustle. All say the late-cool weather is good; there is a bright moon, yet one fears climbing the tower.\n\nLet age and affairs end within dreams. Flowers fall empty, smoke and waters flow. The swallows have left to return, while the traveler still lingers. Drooping willows cannot hold back the skirt belt. Long is it, the rope that ties the moving boat.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "心上秋", "background": "辗转经由他人唇齿\n\n多少日夜听闻你的故事\n\n难道这情之一字\n\n竟连抛生死亦不可探知\n\n听说北国的那座城池\n\n被冬雪覆了终日\n\n等到故人长诀渐行渐远\n\n转眼已隔两世\n\n谁向生而死 谁患得患失\n\n相顾也再无多时\n\n画中人暗自 竟心荡神痴\n\n一滴泪氤氲满纸\n\n挥墨描眉目 提笔勾鬓丝\n\n寥寥几笔竟如此\n\n夜半无人处 对月展卷时\n\n忽然看懂这相思\n\n落款谁提了名字\n\n————《心上秋》", "description": "竟宁元年（前33年）正月，昭君出塞前一晚。\n\n画师跌跌撞撞地来到昭君居住的宫殿。\n\n     听说北国的那座城池\n     被冬雪覆了终日\n     等到故人长诀渐行渐远\n     转眼已隔两世\n                ——《心上秋》\n\n如果再也不能相见的话，画师想着，他想给昭君留下些什么。\n\n他想把他的画笔送给昭君。\n\n**昭君的宫殿里有$N$个房间，有$N-1$条道路连接这些房间。**\n\n**画师现在在宫殿的入口大厅$S$房间，他依稀记得，昭君的房间在$T$号。**\n\n窗外，风雨大作，宫内忽暗忽明，一个人影也没有。\n\n画家走进晦暗的通道，每条通道里的墙壁上都画有若干片枫叶，这是之前昭君让画师画的。昭君说，她特别喜欢秋天，尤其喜欢秋天的枫叶。\n\n      并肩长谈过多少往事，恍然间黄昏已至    ——《心上秋》\n\n通道内晦暗无比，画师想点亮通道内备好的蜡烛，他记得昭君有个习惯，**每个通道内的蜡烛数量就是墙上枫叶的数量。昭君若想点燃一条通道内的蜡烛，就会全部点燃，此时昭君认为这条通道已被点亮，并且不会再点亮任何枫叶数少于这条通道的通道**。\n\n这应该是最后一次来到这个地方了，画师想着，他要按昭君的习惯，走到昭君的房间。同时，画师不想走回头路，所以他不会走自己已经走过的通道。\n\n**现在画师想知道，他从宫殿大厅$S$走到昭君房间$T$，在不走回头路的情况下，最多可以点亮多少通道。**", "inputFormat": "第一行一个数$N$，表示宫殿房间数量。\n\n接下来有$N-1$行，每行三个数$u_{i},v_{i},leaf_{i}$，表示$u,v$之间有一条通道，通道上画有$leaf_{i}$片枫叶。\n\n接下来一个数$M$。\n\n最后$M$行，每行两个数$S_{i},T_{i}$", "outputFormat": "输出$M$行，对于每组$S_{i},T_{i}$，输出最多能够点亮的通道数。", "hint": "| 数据编号 | N | M | 特殊性质 |\n| :----------: | :----------: | :----------: | :----------: |\n| $1$ | $100$ | $100$ | 无 |\n| $2$ | $100$ | $100$ | 无 |\n| $3$ | $100$ | $1000$ | 无 |\n| $4$ | $10000$ | $10000$ | 无 |\n| $5$ | $10000$ | $10000$ | $1$ |\n| $6$ | $10000$ | $10000$ | $1,2$ |\n| $7$ | $10000$ | $10000$ | $1,2$ |\n| $8$ | $30000$ | $100000$ | 无 |\n| $9$ | $30000$ | $100000$ | 无 |\n| $10$ | $30000$ |$300000$  | 无 |\n特殊性质$1$：$1<=leaf_{i}<=2$\n\n特殊性质$2$：$u_{i}+1=v_{i}$\n\n对于所有的数据，保证$1<=leaf_{i}<=5$\n\n样例一解析：\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/eaxwdth6.png)\n\n询问$1$：从$2$走到$1$最多点亮$1$条通道（$2-1$）\n\n询问$2$：从$4$走到$2$最多点亮$2$条通道（$4-1,1-2$）\n\n询问$3$：显然无法点亮通道。\n\n样例二解析：\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/8z9tovt5.png))\n\n询问$1$：从$7$走到$5$，可以点亮$4$个通道（$7-1,1-2,2-4,4-5$）\n\n询问$2$：从$7$走到$6$，可以点亮$4$个通道（$7-1,1-2,2-4,4-5$），不点亮（$5-6$）是因为已经点亮（$4-5$）后无法点亮比枫叶数小于$4$的通道，易知这样是最优的，或者不点亮（$4-5$）而点亮（$5-6$），这同样是最优解。\n\n询问$3$：从$2$走到$7$，可以点亮$2$个通道（$2-1$,$1-7$）\n\n询问$4$：不经过任何通道。\n\n询问$5$：经过$1$条通道（$2-4$）\n\n\n     何处合成愁。离人心上秋。纵芭蕉，不雨也飕飕。都道晚凉天气好，有明月，怕登楼。\n\n     年事梦中休。花空烟水流。燕辞归，客尚淹留。垂柳不萦裙带住。漫长是，系行舟。", "locale": "zh-CN"}}}
{"pid": "P5559", "type": "P", "difficulty": 6, "samples": [["5 2 0\n1 2 2\n1 3 3\n4 3 2\n5 3 7\n0 1 1 0 1\n2 2 4\n2 4 3", "7\n12"], ["6 3 0\n2 1 3\n3 1 5\n4 1 2\n6 4 8\n4 5 9\n1 1 1 0 0 1\n2 1 1\n1 5\n2 3 6", "18\n12"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["线段树", "树状数组", "O2优化", "树链剖分"], "title": "失昼城的守星使", "background": "> 月伏潮汐生，星染万屿寂，无晦明之变化者，是为失昼。   ————《失昼城手札·起源》\n\n失昼城四面环海，建城于 7325 年前。\n\n失昼城没有黑夜白天的变化，一轮明月自建城伊始就挂在天空，故名失昼。\n\n\n失昼城城主月凌霜，掌控着失昼城的守星塔，守星塔在终日无昼的失昼城中作为照明的灯塔，一直是城里人们的精神寄托，她的另一个身份是失昼城的守星使，比起作为城主，月凌霜更喜欢守着守星塔。\n\n失昼城的特殊环境导致其空间异常不稳定，根据失昼城城史记载，七千多年历史的失昼城，其和平的时间总共不超过三百年，其他大部分时间失昼城局部地区都在空间风暴的笼罩之下，依托于特殊空间存在的守星塔，同时兼具着向人们传递信息的功能，在不稳定的空间影响下，这是唯一能够维持信号稳定的方法。", "description": "失昼城共由 $N$ 座岛屿组成，由 $N-1$ 条传递信息的空间通道联通。\n\n作为失昼城的守星使，月凌霜具有部署守星塔的能力，具体而言，为了依靠特殊空间波动向每个有居民居住的岛屿传递消息，月凌霜可以任意数量地部署守星塔，每座岛屿只能部署一座守星塔，**但是同一时刻所有部署的守星塔必须依靠空间通道连成一条链**。\n\n失昼城常年受到空间风暴的困扰，常常会出现某座岛屿遭受空间风暴，岛上全体居民被迫离开岛屿，此时，**守星塔不再需要向该地传输消息**，等到空间风暴散去，居民重新回到这里，**守星塔才需要恢复向该地的信息传输**。\n\n由于空间波动的干扰，守星塔传递消息必须依靠联通岛屿的空间通道完成，具体而言，如果一座守星塔要向一座岛屿传递消息，**其消耗的能量为该座守星塔所处的岛屿到需要接收消息的岛屿的所有空间通道能耗总和**，当然，如果一座守星塔向自身所处的岛屿发送消息，则不需要消耗能量，守星塔对岛屿传递消息的信号波动互相独立，也就是说，**每座守星塔对于每座岛屿的能量传输互不干扰**。\n\n作为城主兼守星使，月凌霜近期正在研究怎样部署守星塔才能使消息传递所消耗的能量最小，现在月凌霜已经找到了记载失昼城七千多年来空间风暴的爆发情况和当时失昼城的守星塔部署的资料，由于历史过于久远，每次能量的消耗情况已经不得而知，现在月凌霜希望你帮助她还原这些史料，具体详见输入格式。", "inputFormat": "第一行三个数 $N,Q,Type$，表示失昼城岛屿数量，月凌霜的询问个数以及该数据点的特殊性质，$Type$ 在二进制下，若第 $i-1$ 位为 $1$，则表示存在特殊性质 $i$。\n\n接下来 $N-1$ 行，每行三个数 $u_{i},v_{i},w_{i}$ 表示岛屿 $u_i$ 和岛屿 $v_i$ 之间存在一条双向空间通道，消息经过这条空间通道需要消耗能量为 $w_i$。\n\n接下来一行 $N$ 个数，由 $0,1$ 两个数字构成，表示第 $i$ 个岛屿在失昼城建城之时是否存在空间风暴，$0$ 表示存在空间风暴，$1$ 表示不存在，同时我们认为，**如果一个岛屿不存在空间风暴，那么它一定会吸引人们聚居，若存在空间风暴，则不会有人们在该岛屿居住**。\n\n最后 $Q$ 行，每行表示一个事件，具体如下：\n\n$1$  $x$：对于岛屿 $x$，若原本该岛屿没有空间风暴，则空间风暴产生，岛上全体居民撤出该岛，否则表示该岛屿空间风暴散去，人们重新回到这里居住。\n\n$2$  $x$  $y$：月凌霜向你提出一个询问，询问若此时部署守星塔在 $x$ 到 $y$ 的简单路径上，则向**所有有居民的岛屿**传递一次消息所需要的能量消耗之和**最小**为多少。一座守星塔可以同时向多座岛屿传递消息，也可以不向任何岛屿传递消息。", "outputFormat": "输出 $Q$ 行，每行一个数，表示该次询问的答案。", "hint": "|测试点编号|$N \\leq$|$Q \\leq$|1 操作个数 |特殊约束 1|特殊约束 2|特殊约束 3|\n|:---:|:------:|:------:|:-----:|:----:|:----:|:----:|\n|1    |$200$   |$200$   |$\\leq Q$|$0$   |$1$   |$0$   |\n|2    |^       |^       |^      |^     |^     |^     |\n|3    |^       |^       |$0$    |^     |$0$   |^     |\n|4    |^       |^       |^      |^     |^     |$1$   |\n|5    |$2000$  |$2000$  |^      |^     |^     |^     |\n|6    |^       |^       |^      |$1$   |^     |^     |\n|7    |^       |^       |$100$  |^     |$1$   |^     |\n|8    |^       |^       |^      |^     |^     |^     |\n|9    |$200000$|$200000$|^      |^     |^     |^     |\n|10   |^       |^       |^      |^     |^     |^     |\n|11   |^       |^       |^      |^     |$0$   |^     |\n|12   |^       |^       |^      |^     |^     |^     |\n|13   |^       |^       |^      |$0$   |^     |^     |\n|14   |^       |^       |^      |^     |^     |^     |\n|15   |^       |^       |$\\leq Q$|^     |^     |^      |\n|16   |^       |^       |^      |^     |^     |^     |\n|17   |^       |^       |^      |^     |^     |$0$   |\n|18   |^       |^       |^      |^     |^     |^     |\n|19   |^       |^       |^      |^     |^     |^     |\n|20   |^       |^       |^      |^     |^     |^      |\n\n\n\n特殊性质 $1$：$v_{i}=u_{i}+1$。\n\n特殊性质 $2$：月凌霜所有的询问的 $x$ 和 $y$ 相同。\n\n特殊性质 $3$：月凌霜所有的询问的 $x=1$。\n\n对于所有的 $w_{i}$，保证 $0 \\leq w_{i}\\leq 10^{5}$。\n\n对于 $100\\%$ 的数据，保证 $N,Q\\leq 200000,0\\leq Type\\leq 7$。\n\n样例 1 解释：\n\n![](https://cdn.luogu.com.cn/upload/pic/74831.png)\n\n初始图像如左图。\n\n对于第一个询问如中图，有 $2,3,5$ 有居民，所以$ans_2=ans_3=0,ans_5=7$，所以$ans=7$。\n\n对于第二组询问如右图，$ans_2=2+3=5,ans_3=0,ans_5=7$，因此 $ans=7+5=12$。\n\n样例 2 解释：\n\n![](https://cdn.luogu.com.cn/upload/pic/74836.png)\n\n初始图如左上。\n\n询问 $1$ 点如图右上，存在 $1,2,3,6$ 有居民。\n$ans_1=0,ans_2=3,ans_3=5,ans_6=8+2=10$，因此 $ans=3+5+10=18$。\n\n1 操作后所有有居民点如左下。\n\n接下来的操作图为右下，同上有 $ans_1=0,ans_2=3,ans_3=0,ans_5=9,ans_6=0$，所以 $ans=3+9=12$。", "locale": "zh-CN", "translations": {"en": {"title": "Star Tower Keeper of Shizhou City", "background": "> When the moon lies low, the tides are born; when starlight dyes ten thousand isles, all is silent. That which has no change between darkness and light is called Shizhou. ———— *Notes of Shizhou City · Origin*.\n\nShizhou City is surrounded by the sea on all sides and was founded 7325 years ago.\n\nIn Shizhou City, there is no change between night and day. Since the founding of the city, a bright moon has been hanging in the sky, hence the name Shizhou.\n\nThe lord of Shizhou City, Yue Lingxue, controls the Star Tower. In Shizhou City, which never has daytime, the Star Tower serves as a lighthouse for lighting and has always been a spiritual support for the people in the city. Her other identity is the Star Tower Keeper of Shizhou City. Compared with being the city lord, Yue Lingxue prefers guarding the Star Tower.\n\nThe special environment of Shizhou City causes the space there to be extremely unstable. According to the city chronicles, during the more than seven-thousand-year history of Shizhou City, the total time of peace did not exceed three hundred years. During most of the remaining time, local areas of Shizhou City were covered by spatial storms. The Star Tower, which relies on special space to exist, also has the function of transmitting information to people. Under the influence of unstable space, this is the only way to keep signals stable.", "description": "Shizhou City consists of $N$ islands, connected by $N-1$ space channels for transmitting information.\n\nAs the Star Tower Keeper of Shizhou City, Yue Lingxue can deploy Star Towers. Specifically, in order to transmit messages to every island where residents live by relying on special spatial fluctuations, Yue Lingxue may deploy any number of Star Towers. Each island can have at most one Star Tower. **However, at the same time, all deployed Star Towers must be connected into a single chain through space channels**.\n\nShizhou City is troubled by spatial storms all year round. Often, an island will be hit by a spatial storm and all residents on it are forced to leave. At this time, **the Star Towers no longer need to transmit messages to that place**. After the spatial storm dissipates and residents return, **the Star Towers need to resume transmitting information to that place**.\n\nDue to interference from spatial fluctuations, Star Towers must rely on space channels connecting islands to transmit messages. Specifically, if a Star Tower needs to transmit a message to an island, **the energy cost equals the sum of energy costs of all space channels along the path from the island where the Star Tower is located to the destination island**. Of course, if a Star Tower sends a message to the island it is on, no energy is needed. The signal fluctuations of Star Towers transmitting messages to islands are independent of each other, that is, **for each Star Tower and each island, the energy transmission does not interfere with others**.\n\nAs both the city lord and the Star Tower Keeper, Yue Lingxue has recently been studying how to deploy Star Towers to minimize the energy consumed for message transmission. She has found records of spatial storm outbreaks over the past seven thousand years and the Star Tower deployment data at those times. Since the history is too old, the energy consumption of each time is no longer known. Now Yue Lingxue hopes you can help her reconstruct these historical materials. See the input format for details.", "inputFormat": "The first line contains three integers $N,Q,Type$, representing the number of islands in Shizhou City, the number of queries by Yue Lingxue, and the special properties of this test point. In binary, if the $(i-1)$-th bit of $Type$ is $1$, then special property $i$ exists.\n\nThe next $N-1$ lines each contain three integers $u_{i},v_{i},w_{i}$, indicating that there is a bidirectional space channel between islands $u_i$ and $v_i$, and the energy cost for a message to pass through this channel is $w_i$.\n\nThe next line contains $N$ numbers, consisting only of $0$ and $1$, indicating whether there is a spatial storm on the $i$-th island at the time the city was founded. $0$ means there is a spatial storm, and $1$ means there is no spatial storm. We also assume that **if an island has no spatial storm, then it will definitely attract people to live there; if it has a spatial storm, then nobody lives on that island**.\n\nThe last $Q$ lines each describe an event, as follows:\n\n$1$  $x$: For island $x$, if there was originally no spatial storm on this island, then a spatial storm occurs and all residents evacuate the island; otherwise, it means the spatial storm on this island dissipates and people return to live here.\n\n$2$  $x$  $y$: Yue Lingxue asks you a query: if Star Towers are deployed on the simple path from $x$ to $y$ at this moment, what is the **minimum** possible total energy consumption required to transmit one message to **all islands with residents**. A Star Tower can transmit messages to multiple islands at the same time, and it may also transmit to no island.", "outputFormat": "Output $Q$ lines, each containing one number, representing the answer to that query.", "hint": "|Test Point ID|$N \\leq$|$Q \\leq$|Number of operation 1|Special Constraint 1|Special Constraint 2|Special Constraint 3|\n|:---:|:------:|:------:|:-----:|:----:|:----:|:----:|\n|1    |$200$   |$200$   |$\\leq Q$|$0$   |$1$   |$0$   |\n|2    |^       |^       |^      |^     |^     |^     |\n|3    |^       |^       |$0$    |^     |$0$   |^     |\n|4    |^       |^       |^      |^     |^     |$1$   |\n|5    |$2000$  |$2000$  |^      |^     |^     |^     |\n|6    |^       |^       |^      |$1$   |^     |^     |\n|7    |^       |^       |$100$  |^     |$1$   |^     |\n|8    |^       |^       |^      |^     |^     |^     |\n|9    |$200000$|$200000$|^      |^     |^     |^     |\n|10   |^       |^       |^      |^     |^     |^     |\n|11   |^       |^       |^      |^     |$0$   |^     |\n|12   |^       |^       |^      |^     |^     |^     |\n|13   |^       |^       |^      |$0$   |^     |^     |\n|14   |^       |^       |^      |^     |^     |^     |\n|15   |^       |^       |$\\leq Q$|^     |^     |^      |\n|16   |^       |^       |^      |^     |^     |^     |\n|17   |^       |^       |^      |^     |^     |$0$   |\n|18   |^       |^       |^      |^     |^     |^     |\n|19   |^       |^       |^      |^     |^     |^     |\n|20   |^       |^       |^      |^     |^     |^      |\n\nSpecial property $1$: $v_{i}=u_{i}+1$.\n\nSpecial property $2$: In all of Yue Lingxue’s queries, $x$ and $y$ are the same.\n\nSpecial property $3$: In all of Yue Lingxue’s queries, $x=1$.\n\nFor all $w_{i}$, it is guaranteed that $0 \\leq w_{i}\\leq 10^{5}$.\n\nFor $100\\%$ of the data, it is guaranteed that $N,Q\\leq 200000,0\\leq Type\\leq 7$.\n\nSample 1 explanation:\n\n![](https://cdn.luogu.com.cn/upload/pic/74831.png)\n\nThe initial graph is shown on the left.\n\nFor the first query, as shown in the middle, islands $2,3,5$ have residents, so $ans_2=ans_3=0,ans_5=7$, hence $ans=7$.\n\nFor the second query, as shown on the right, $ans_2=2+3=5,ans_3=0,ans_5=7$, hence $ans=7+5=12$.\n\nSample 2 explanation:\n\n![](https://cdn.luogu.com.cn/upload/pic/74836.png)\n\nThe initial graph is shown at the upper left.\n\nFor query $1$, as shown at the upper right, islands $1,2,3,6$ have residents.\n$ans_1=0,ans_2=3,ans_3=5,ans_6=8+2=10$, hence $ans=3+5+10=18$.\n\nAfter one operation 1, all islands with residents are shown at the lower left.\n\nThe subsequent operations are shown at the lower right. Similarly, $ans_1=0,ans_2=3,ans_3=0,ans_5=9,ans_6=0$, so $ans=3+9=12$.\n\n# Input Format\n\n# Output Format\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "失昼城的守星使", "background": "> 月伏潮汐生，星染万屿寂，无晦明之变化者，是为失昼。   ————《失昼城手札·起源》\n\n失昼城四面环海，建城于 7325 年前。\n\n失昼城没有黑夜白天的变化，一轮明月自建城伊始就挂在天空，故名失昼。\n\n\n失昼城城主月凌霜，掌控着失昼城的守星塔，守星塔在终日无昼的失昼城中作为照明的灯塔，一直是城里人们的精神寄托，她的另一个身份是失昼城的守星使，比起作为城主，月凌霜更喜欢守着守星塔。\n\n失昼城的特殊环境导致其空间异常不稳定，根据失昼城城史记载，七千多年历史的失昼城，其和平的时间总共不超过三百年，其他大部分时间失昼城局部地区都在空间风暴的笼罩之下，依托于特殊空间存在的守星塔，同时兼具着向人们传递信息的功能，在不稳定的空间影响下，这是唯一能够维持信号稳定的方法。", "description": "失昼城共由 $N$ 座岛屿组成，由 $N-1$ 条传递信息的空间通道联通。\n\n作为失昼城的守星使，月凌霜具有部署守星塔的能力，具体而言，为了依靠特殊空间波动向每个有居民居住的岛屿传递消息，月凌霜可以任意数量地部署守星塔，每座岛屿只能部署一座守星塔，**但是同一时刻所有部署的守星塔必须依靠空间通道连成一条链**。\n\n失昼城常年受到空间风暴的困扰，常常会出现某座岛屿遭受空间风暴，岛上全体居民被迫离开岛屿，此时，**守星塔不再需要向该地传输消息**，等到空间风暴散去，居民重新回到这里，**守星塔才需要恢复向该地的信息传输**。\n\n由于空间波动的干扰，守星塔传递消息必须依靠联通岛屿的空间通道完成，具体而言，如果一座守星塔要向一座岛屿传递消息，**其消耗的能量为该座守星塔所处的岛屿到需要接收消息的岛屿的所有空间通道能耗总和**，当然，如果一座守星塔向自身所处的岛屿发送消息，则不需要消耗能量，守星塔对岛屿传递消息的信号波动互相独立，也就是说，**每座守星塔对于每座岛屿的能量传输互不干扰**。\n\n作为城主兼守星使，月凌霜近期正在研究怎样部署守星塔才能使消息传递所消耗的能量最小，现在月凌霜已经找到了记载失昼城七千多年来空间风暴的爆发情况和当时失昼城的守星塔部署的资料，由于历史过于久远，每次能量的消耗情况已经不得而知，现在月凌霜希望你帮助她还原这些史料，具体详见输入格式。", "inputFormat": "第一行三个数 $N,Q,Type$，表示失昼城岛屿数量，月凌霜的询问个数以及该数据点的特殊性质，$Type$ 在二进制下，若第 $i-1$ 位为 $1$，则表示存在特殊性质 $i$。\n\n接下来 $N-1$ 行，每行三个数 $u_{i},v_{i},w_{i}$ 表示岛屿 $u_i$ 和岛屿 $v_i$ 之间存在一条双向空间通道，消息经过这条空间通道需要消耗能量为 $w_i$。\n\n接下来一行 $N$ 个数，由 $0,1$ 两个数字构成，表示第 $i$ 个岛屿在失昼城建城之时是否存在空间风暴，$0$ 表示存在空间风暴，$1$ 表示不存在，同时我们认为，**如果一个岛屿不存在空间风暴，那么它一定会吸引人们聚居，若存在空间风暴，则不会有人们在该岛屿居住**。\n\n最后 $Q$ 行，每行表示一个事件，具体如下：\n\n$1$  $x$：对于岛屿 $x$，若原本该岛屿没有空间风暴，则空间风暴产生，岛上全体居民撤出该岛，否则表示该岛屿空间风暴散去，人们重新回到这里居住。\n\n$2$  $x$  $y$：月凌霜向你提出一个询问，询问若此时部署守星塔在 $x$ 到 $y$ 的简单路径上，则向**所有有居民的岛屿**传递一次消息所需要的能量消耗之和**最小**为多少。一座守星塔可以同时向多座岛屿传递消息，也可以不向任何岛屿传递消息。", "outputFormat": "输出 $Q$ 行，每行一个数，表示该次询问的答案。", "hint": "|测试点编号|$N \\leq$|$Q \\leq$|1 操作个数 |特殊约束 1|特殊约束 2|特殊约束 3|\n|:---:|:------:|:------:|:-----:|:----:|:----:|:----:|\n|1    |$200$   |$200$   |$\\leq Q$|$0$   |$1$   |$0$   |\n|2    |^       |^       |^      |^     |^     |^     |\n|3    |^       |^       |$0$    |^     |$0$   |^     |\n|4    |^       |^       |^      |^     |^     |$1$   |\n|5    |$2000$  |$2000$  |^      |^     |^     |^     |\n|6    |^       |^       |^      |$1$   |^     |^     |\n|7    |^       |^       |$100$  |^     |$1$   |^     |\n|8    |^       |^       |^      |^     |^     |^     |\n|9    |$200000$|$200000$|^      |^     |^     |^     |\n|10   |^       |^       |^      |^     |^     |^     |\n|11   |^       |^       |^      |^     |$0$   |^     |\n|12   |^       |^       |^      |^     |^     |^     |\n|13   |^       |^       |^      |$0$   |^     |^     |\n|14   |^       |^       |^      |^     |^     |^     |\n|15   |^       |^       |$\\leq Q$|^     |^     |^      |\n|16   |^       |^       |^      |^     |^     |^     |\n|17   |^       |^       |^      |^     |^     |$0$   |\n|18   |^       |^       |^      |^     |^     |^     |\n|19   |^       |^       |^      |^     |^     |^     |\n|20   |^       |^       |^      |^     |^     |^      |\n\n\n\n特殊性质 $1$：$v_{i}=u_{i}+1$。\n\n特殊性质 $2$：月凌霜所有的询问的 $x$ 和 $y$ 相同。\n\n特殊性质 $3$：月凌霜所有的询问的 $x=1$。\n\n对于所有的 $w_{i}$，保证 $0 \\leq w_{i}\\leq 10^{5}$。\n\n对于 $100\\%$ 的数据，保证 $N,Q\\leq 200000,0\\leq Type\\leq 7$。\n\n样例 1 解释：\n\n![](https://cdn.luogu.com.cn/upload/pic/74831.png)\n\n初始图像如左图。\n\n对于第一个询问如中图，有 $2,3,5$ 有居民，所以$ans_2=ans_3=0,ans_5=7$，所以$ans=7$。\n\n对于第二组询问如右图，$ans_2=2+3=5,ans_3=0,ans_5=7$，因此 $ans=7+5=12$。\n\n样例 2 解释：\n\n![](https://cdn.luogu.com.cn/upload/pic/74836.png)\n\n初始图如左上。\n\n询问 $1$ 点如图右上，存在 $1,2,3,6$ 有居民。\n$ans_1=0,ans_2=3,ans_3=5,ans_6=8+2=10$，因此 $ans=3+5+10=18$。\n\n1 操作后所有有居民点如左下。\n\n接下来的操作图为右下，同上有 $ans_1=0,ans_2=3,ans_3=0,ans_5=9,ans_6=0$，所以 $ans=3+9=12$。", "locale": "zh-CN"}}}
{"pid": "P5560", "type": "P", "difficulty": 4, "samples": [["4\n1\n2\n3\n9\n", "0\n1\n2\n8"]], "limits": {"time": [500, 500, 500, 500], "memory": [128000, 128000, 128000, 128000]}, "tags": [], "title": "[Celeste-B] Golden Feather", "background": "> 就是这样，Madeline。\n\n> 保持呼吸。你能行。", "description": "“你的呼吸让那片羽毛一直飘着。”\n\n“平稳缓慢地呼吸，吸气，吐气。”\n\n“看吧，每次都是这么轻松。”\n\n随着 Madeline 的呼吸，羽毛上下移动着。\n\n通过 Madeline 的观察，她还发现，羽毛似乎遵循这一种神奇的运动轨迹。\n\n在每一轮呼吸中，羽毛会在特定的地方停止，这些地方都是有魔力的，具体来说，第 $i$ 个停留处的魔力是 $(i+1)^2-1$。\n\n并且，在一轮呼吸停止时，羽毛会渗透出一些能量，只要能用这些能量沟通这些停止的地方，Madeline 就能运用羽毛的力量飞翔。更具体的，由于同性相斥，两个地方魔力的相似程度越高就越难被沟通，沟通两个地方所需要的能量为这两个地方魔力的 $gcd$。\n\n在一轮一轮的呼吸中，Madeline 已经无暇算出最少需要的能量，由于羽毛渗透出的能量不多，你能帮帮她算出最少需要多少能量来沟通这些羽毛停止的地方吗？", "inputFormat": "第一行一个正整数 $T$，表示呼吸轮数。\n\n接下来 $T$ 行一行一个正整数 $n$，表示该轮呼吸中羽毛停止的地方个数。", "outputFormat": "输出 $T$ 行，一行一个整数，最少需要的能量。", "hint": "n=3 的样例解释如下图\n\n![T1_2.png](https://i.loli.net/2019/09/14/PtflkNCE8b3iKzB.png)\n![T1.png](https://i.loli.net/2019/09/14/AIYlMZgonL7thfu.png)\n\n对于 $5\\%$ 的数据，$n \\leq 3$\n\n对于 $10\\%$ 的数据，$n \\leq 1000$\n\n对于 $50\\%$ 的数据，$n \\leq 10^6$,$T \\leq 10$\n\n对于 $100\\%$ 的数据，$n \\leq 10^{18}$,$T \\leq 100$", "locale": "zh-CN", "translations": {"en": {"title": "[Celeste-B] Golden Feather", "background": "> That is it, Madeline.\n\n> Keep breathing. You can do it.", "description": "\"Your breathing keeps that feather floating.\"\n\n\"Breathe steadily and slowly. Inhale, exhale.\"\n\n\"See, it is this easy every time.\"\n\nAs Madeline breathes, the feather moves up and down.\n\nFrom her observation, Madeline also found that the feather seems to follow a strange trajectory.\n\nIn each round of breathing, the feather stops at certain places. These places are magical. Specifically, the magic value of the $i$-th stop is $(i+1)^2-1$.\n\nAlso, when a round of breathing ends, the feather seeps out some energy. As long as she can use this energy to connect these stopping places, Madeline can use the feather's power to fly. More specifically, due to \"like repels like\", the more similar the magic values of two places are, the harder it is to connect them. The energy required to connect two places is the $gcd$ of their magic values.\n\nWith one breath after another, Madeline has no time to compute the minimum energy needed. Since the energy seeping out of the feather is limited, can you help her compute the minimum energy needed to connect these places where the feather stops?", "inputFormat": "The first line contains a positive integer $T$, indicating the number of breathing rounds.\n\nThe next $T$ lines each contain a positive integer $n$, indicating the number of stopping places of the feather in that round.", "outputFormat": "Output $T$ lines, one integer per line, representing the minimum energy required.", "hint": "The sample explanation for $n=3$ is shown in the figures below.\n\n![T1_2.png](https://i.loli.net/2019/09/14/PtflkNCE8b3iKzB.png)\n![T1.png](https://i.loli.net/2019/09/14/AIYlMZgonL7thfu.png)\n\nConstraints:\n\nFor $5\\%$ of the testdata, $n \\leq 3$.\n\nFor $10\\%$ of the testdata, $n \\leq 1000$.\n\nFor $50\\%$ of the testdata, $n \\leq 10^6$, $T \\leq 10$.\n\nFor $100\\%$ of the testdata, $n \\leq 10^{18}$, $T \\leq 100$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[Celeste-B] Golden Feather", "background": "> 就是这样，Madeline。\n\n> 保持呼吸。你能行。", "description": "“你的呼吸让那片羽毛一直飘着。”\n\n“平稳缓慢地呼吸，吸气，吐气。”\n\n“看吧，每次都是这么轻松。”\n\n随着 Madeline 的呼吸，羽毛上下移动着。\n\n通过 Madeline 的观察，她还发现，羽毛似乎遵循这一种神奇的运动轨迹。\n\n在每一轮呼吸中，羽毛会在特定的地方停止，这些地方都是有魔力的，具体来说，第 $i$ 个停留处的魔力是 $(i+1)^2-1$。\n\n并且，在一轮呼吸停止时，羽毛会渗透出一些能量，只要能用这些能量沟通这些停止的地方，Madeline 就能运用羽毛的力量飞翔。更具体的，由于同性相斥，两个地方魔力的相似程度越高就越难被沟通，沟通两个地方所需要的能量为这两个地方魔力的 $gcd$。\n\n在一轮一轮的呼吸中，Madeline 已经无暇算出最少需要的能量，由于羽毛渗透出的能量不多，你能帮帮她算出最少需要多少能量来沟通这些羽毛停止的地方吗？", "inputFormat": "第一行一个正整数 $T$，表示呼吸轮数。\n\n接下来 $T$ 行一行一个正整数 $n$，表示该轮呼吸中羽毛停止的地方个数。", "outputFormat": "输出 $T$ 行，一行一个整数，最少需要的能量。", "hint": "n=3 的样例解释如下图\n\n![T1_2.png](https://i.loli.net/2019/09/14/PtflkNCE8b3iKzB.png)\n![T1.png](https://i.loli.net/2019/09/14/AIYlMZgonL7thfu.png)\n\n对于 $5\\%$ 的数据，$n \\leq 3$\n\n对于 $10\\%$ 的数据，$n \\leq 1000$\n\n对于 $50\\%$ 的数据，$n \\leq 10^6$,$T \\leq 10$\n\n对于 $100\\%$ 的数据，$n \\leq 10^{18}$,$T \\leq 100$", "locale": "zh-CN"}}}
{"pid": "P5561", "type": "P", "difficulty": 6, "samples": [["3\nabccccd\nabccddc\nacbbcad\n5\n1 1 1 7\n1 2 1 7\n1 3 1 7\n2 3\n2 2\n", "7\n4\n1\n4\n7\n"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["O2优化"], "title": "[Celeste-B] Mirror Magic", "background": "> ...\n\n> 呼吸。\n\n> 你能站起来，Madeline\n\n> 想想羽毛。你能拯救 Theo", "description": "镜之神庙是一座有魔力的神庙，在这里你能一窥自己心灵的真相。\n\nTheo 被困在了一面镜子里。当 Madeline 尝试去拯救 Theo 时，神庙里的\"生物\"们给她出了一道难题，这道难题是这样的：\n\n神庙的\"生物\"们准备了 $n$ 串草莓，这些草莓的长度之和 $<= 10^6$，现在它们可以执行这样一些操作：\n\n$1\\ x\\ l\\ r$，表示将编号 $x$ 的草莓串的子草莓串 $[l,r]$ 复制一份，插入当前的草莓集合中，保证草莓串 $x$ 的长度 $>=r$。\n\n$2\\ k$，表示删除第 $k$ 次操作插入的草莓串，保证第 $k$ 次操作为插入并且此时第 $k$ 次操作插入的草莓串在集合中。\n\n\"生物\"们认为和谐的味道才是美味的。在执行任意一次操作之后，\"生物\"们想要知道当前集合中所有草莓串的美味度(即 $LCP$ - 最长公共前缀)。（若集合为空，则美味度 $0$，若集合中只有一个草莓串，则美味度为草莓串的长度）\n\n为了方便表达，我们把每一种草莓表示为一个**小写英文字母**。\n\n多年以后，Madeline 又来到了镜之神庙，想要回忆多年前自己的登山旅途，可是她已经不记得自己当年是怎么解决那道谜题的了，你能帮帮她找到谜题的答案吗？", "inputFormat": "第一行一个正整数 $n$，表示草莓串的个数。\n\n接下来 $n$ 行一行一个**只包含小写字母**的字符串，表示原来的 $n$ 个草莓串。\n\n接下来一行一个正整数 $q$，表示操作个数。\n\n接下来 $q$ 行一行一个操作。", "outputFormat": "输出 $q$ 行，对应每次操作之后集合中草莓串的美味度($LCP$ - 最长公共前缀).", "hint": "样例解释：\n\n第一次操作后，集合为 $\\{\"abccccd\"\\}$,$LCP=7$\n\n第二次操作后，集合为 $\\{\"abccccd\",\"abccddc\"\\}$,$LCP=4$\n\n第三次操作后，集合为 $\\{\"abccccd\",\"abccddc\",\"acbbcad\"\\}$,$LCP=1$\n\n第四次删除了第三次插入的串，故 $LCP=4$\n\n第五次删除了第二次插入的串，故 $LCP=7$\n\n令 $len$ 等于 $n$ 个串的长度之和。总有 $len \\leq 10^6$\n\nSubtask $1$($10$ Pts), $n \\leq 5, q = 10$\n\nSubtask $2$($30$ Pts), $n \\leq 10^6, q = 10^6$, 保证每次插入的是串的一个前缀\n\nSubtask $3$($10$ Pts), $n \\leq 10^6, q = 10^5$, 不含 $2$ 操作, **保证询问为随机生成**\n\nSubtask $4$($50$ Pts), $n \\leq 10^6, q = 10^6$\n\n提示：你可以根据 $q$ 判断 Subtask 编号\n\n", "locale": "zh-CN", "translations": {"en": {"title": "[Celeste-B] Mirror Magic", "background": "> ...\n\n> Breathe.\n\n> You can stand up, Madeline.\n\n> Think of the feather. You can save Theo.", "description": "The Mirror Temple is a magical temple, where you can catch a glimpse of the truth in your heart.\n\nTheo is trapped inside a mirror. When Madeline tries to save Theo, the “creatures” in the temple give her a difficult puzzle. The puzzle is as follows:\n\nThe “creatures” prepare $n$ strawberry strings, and the sum of their lengths $<= 10^6$. Now they can perform the following operations:\n\n$1\\ x\\ l\\ r$ means copying the substring $[l,r]$ of the strawberry string with index $x$, and inserting the copied string into the current set of strawberry strings. It is guaranteed that the length of string $x$ is $>=r$.\n\n$2\\ k$ means deleting the strawberry string that was inserted by the $k$-th operation. It is guaranteed that the $k$-th operation is an insertion, and the string inserted by the $k$-th operation is currently in the set.\n\nThe “creatures” believe that a harmonious flavor is delicious. After performing any operation, they want to know the deliciousness of all strawberry strings in the current set (i.e., $LCP$ - the longest common prefix). (If the set is empty, the deliciousness is $0$. If there is only one strawberry string in the set, the deliciousness is the length of that string.)\n\nFor convenience, we represent each type of strawberry as a **lowercase English letter**.\n\nMany years later, Madeline comes to the Mirror Temple again, wanting to recall her climbing journey from long ago, but she no longer remembers how she solved that puzzle back then. Can you help her find the answer to the puzzle?", "inputFormat": "The first line contains a positive integer $n$, indicating the number of strawberry strings.\n\nThe next $n$ lines each contain a string consisting of **only lowercase letters**, representing the original $n$ strawberry strings.\n\nThe next line contains a positive integer $q$, indicating the number of operations.\n\nThe next $q$ lines each contain one operation.", "outputFormat": "Output $q$ lines. Each line should be the deliciousness ($LCP$ - the longest common prefix) of the strawberry strings in the set after the corresponding operation.", "hint": "Sample explanation:\n\nAfter the first operation, the set is $\\{\"abccccd\"\\}$, $LCP=7$.\n\nAfter the second operation, the set is $\\{\"abccccd\",\"abccddc\"\\}$, $LCP=4$.\n\nAfter the third operation, the set is $\\{\"abccccd\",\"abccddc\",\"acbbcad\"\\}$, $LCP=1$.\n\nThe fourth operation deletes the string inserted by the third operation, so $LCP=4$.\n\nThe fifth operation deletes the string inserted by the second operation, so $LCP=7$.\n\nLet $len$ be the sum of lengths of the $n$ strings. We always have $len \\leq 10^6$.\n\nSubtask $1$ ($10$ Pts): $n \\leq 5, q = 10$.\n\nSubtask $2$ ($30$ Pts): $n \\leq 10^6, q = 10^6$, and it is guaranteed that each insertion is a prefix of a string.\n\nSubtask $3$ ($10$ Pts): $n \\leq 10^6, q = 10^5$, there are no type $2$ operations, and **it is guaranteed that the queries are randomly generated**.\n\nSubtask $4$ ($50$ Pts): $n \\leq 10^6, q = 10^6$.\n\nHint: You can determine the subtask number based on $q$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[Celeste-B] Mirror Magic", "background": "> ...\n\n> 呼吸。\n\n> 你能站起来，Madeline\n\n> 想想羽毛。你能拯救 Theo", "description": "镜之神庙是一座有魔力的神庙，在这里你能一窥自己心灵的真相。\n\nTheo 被困在了一面镜子里。当 Madeline 尝试去拯救 Theo 时，神庙里的\"生物\"们给她出了一道难题，这道难题是这样的：\n\n神庙的\"生物\"们准备了 $n$ 串草莓，这些草莓的长度之和 $<= 10^6$，现在它们可以执行这样一些操作：\n\n$1\\ x\\ l\\ r$，表示将编号 $x$ 的草莓串的子草莓串 $[l,r]$ 复制一份，插入当前的草莓集合中，保证草莓串 $x$ 的长度 $>=r$。\n\n$2\\ k$，表示删除第 $k$ 次操作插入的草莓串，保证第 $k$ 次操作为插入并且此时第 $k$ 次操作插入的草莓串在集合中。\n\n\"生物\"们认为和谐的味道才是美味的。在执行任意一次操作之后，\"生物\"们想要知道当前集合中所有草莓串的美味度(即 $LCP$ - 最长公共前缀)。（若集合为空，则美味度 $0$，若集合中只有一个草莓串，则美味度为草莓串的长度）\n\n为了方便表达，我们把每一种草莓表示为一个**小写英文字母**。\n\n多年以后，Madeline 又来到了镜之神庙，想要回忆多年前自己的登山旅途，可是她已经不记得自己当年是怎么解决那道谜题的了，你能帮帮她找到谜题的答案吗？", "inputFormat": "第一行一个正整数 $n$，表示草莓串的个数。\n\n接下来 $n$ 行一行一个**只包含小写字母**的字符串，表示原来的 $n$ 个草莓串。\n\n接下来一行一个正整数 $q$，表示操作个数。\n\n接下来 $q$ 行一行一个操作。", "outputFormat": "输出 $q$ 行，对应每次操作之后集合中草莓串的美味度($LCP$ - 最长公共前缀).", "hint": "样例解释：\n\n第一次操作后，集合为 $\\{\"abccccd\"\\}$,$LCP=7$\n\n第二次操作后，集合为 $\\{\"abccccd\",\"abccddc\"\\}$,$LCP=4$\n\n第三次操作后，集合为 $\\{\"abccccd\",\"abccddc\",\"acbbcad\"\\}$,$LCP=1$\n\n第四次删除了第三次插入的串，故 $LCP=4$\n\n第五次删除了第二次插入的串，故 $LCP=7$\n\n令 $len$ 等于 $n$ 个串的长度之和。总有 $len \\leq 10^6$\n\nSubtask $1$($10$ Pts), $n \\leq 5, q = 10$\n\nSubtask $2$($30$ Pts), $n \\leq 10^6, q = 10^6$, 保证每次插入的是串的一个前缀\n\nSubtask $3$($10$ Pts), $n \\leq 10^6, q = 10^5$, 不含 $2$ 操作, **保证询问为随机生成**\n\nSubtask $4$($50$ Pts), $n \\leq 10^6, q = 10^6$\n\n提示：你可以根据 $q$ 判断 Subtask 编号\n\n", "locale": "zh-CN"}}}
{"pid": "P5562", "type": "P", "difficulty": 5, "samples": [["2", "8\n1 1 1\n1 1 2\n1 2 1\n1 2 2\n2 1 1\n2 1 2\n2 2 1\n2 2 2"]], "limits": {"time": [1000, 1000, 1000], "memory": [128000, 128000, 128000]}, "tags": ["Special Judge"], "title": "[Celeste-B] Center of the Earth", "background": "> 我曾如此地接近。\n\n> 我**恨**她。\n\n> \n\n> ...\n\n> 我这次一定要坚持到底。\n\n> 不能再逃跑了。", "description": "Madeline 来到了一座神龛前，这座神龛布满尘埃，四周还都是不明所以的符号。\n\n通过 Madeline 强大的观察能力，她发现这些符号其实对应着一个个冲刺顺序，按照一定顺序冲刺就相当于输入一个密码，只有输入特定的密码才能点亮神龛获得水晶之心。\n\n多年之后，当 Madeline 回忆她的登山之旅时，她已经不记得密码是什么了，只记得密码长度为 $3$，并且每一位密码有 $n$ 种可能。她还知道，在她输入的密码中，任意两位与标准密码相符就能点亮神龛获得水晶之心。\n\n今天，Madeline 又回到了这座神龛前，她希望使用最少的输入密码次数来保证能获得这颗水晶之心，你能帮帮她吗？", "inputFormat": "第一行一个整数 $n$，表示每一位密码有多少种可能。", "outputFormat": "第一行输出一个整数 $k$，表示你给出的方案中输入密码的次数。\n\n接下来 $k$ 行，输出每次尝试的密码。", "hint": "样例不是最优解，只是对输出的一个示例。\n\n**请务必输出方案，否则可能会遇到未知错误**\n\n共有三个测试点：\n\n测试点 $1$($10$pts) : $n=2$\n\n测试点 $2$($20$pts) : $n=100$\n\n测试点 $3$($70$pts) : $n=1000$\n\n对于每组数据我们采取如下评分方式：\n\n- 若 $k > 5000000$ ，你的输出过大，你将无法得到任何分数。\n\n- 否则：\n\n  - 若给出的方案无法保证能点亮神龛，或者方案本身是错误的，则按照如下规则评分：\n\n    - 若 $k$ 小于最小次数，不给分。\n\n    - 否则，若 $k$ 等于最小次数，则给出该测试点 $10\\%$ 的分数。\n\n    - 否则，若你的 $k$ 是最小次数的 $q$ 倍，你将得到这个测试点 $\\frac{1}{10*q}$ 的分数。\n\n  - 否则，你的方案可以保证点亮神龛，则按照如下规则评分：\n\n    - 首先得到 $10\\%$ 的基础分。\n\n    - 接着，令最小次数为 $p$，你将得到如下额外分数：\n\n      - $k=p$，你将得到 $90\\%$ 的额外分数。\n\n      - $p<k<=1.5p$，你将得到 $50+\\frac{1.5p-k}{0.5p}*40\\%$ 的额外分数。\n\n      - $1.5p<k<=2p$，你将得到 $20+\\frac{2p-k}{0.5p}*30\\%$ 的额外分数。\n\n      - $k>2p$，你将不会得到额外分数。\n", "locale": "zh-CN", "translations": {"en": {"title": "[Celeste-B] Center of the Earth", "background": "> I was once so close.\n>\n> I **hate** her.\n>\n> ...\n>\n> This time, I must hold on until the end.\n>\n> I cannot run away anymore.", "description": "Madeline comes to a shrine. It is covered in dust, and it is surrounded by strange symbols whose meaning is unclear.\n\nWith Madeline’s strong observation skills, she discovers that these symbols actually correspond to dash sequences. Dashing in a certain order is like entering a password. Only by entering a specific password can she light up the shrine and obtain the Crystal Heart.\n\nMany years later, when Madeline recalls her climbing journey, she no longer remembers what the password was. She only remembers that the password length is $3$, and each position of the password has $n$ possible values. She also knows that for the password she enters, as long as any two positions match the standard password, she can light up the shrine and obtain the Crystal Heart.\n\nToday, Madeline returns to the shrine again. She wants to use the minimum number of password attempts to guarantee that she can obtain the Crystal Heart. Can you help her?", "inputFormat": "The first line contains an integer $n$, indicating how many possible values there are for each position of the password.", "outputFormat": "The first line outputs an integer $k$, indicating the number of password attempts in your plan.\n\nThe next $k$ lines output the password for each attempt.", "hint": "The sample is not an optimal solution; it is only an example of the output.\n\n**You must output a plan, otherwise you may encounter unknown errors.**\n\nThere are three test points:\n\n- Test point $1$ ($10$ pts): $n=2$.\n- Test point $2$ ($20$ pts): $n=100$.\n- Test point $3$ ($70$ pts): $n=1000$.\n\nFor each dataset, we use the following scoring method:\n\n- If $k > 5000000$, your output is too large, and you will not get any score.\n\n- Otherwise:\n\n  - If the plan you provide cannot guarantee lighting up the shrine, or the plan itself is incorrect, then it is scored as follows:\n\n    - If $k$ is less than the minimum number of attempts, you get $0$ points.\n\n    - Otherwise, if $k$ equals the minimum number of attempts, you get $10\\%$ of the score for this test point.\n\n    - Otherwise, if your $k$ is $q$ times the minimum number of attempts, you will get $\\frac{1}{10*q}$ of the score for this test point.\n\n  - Otherwise, if your plan can guarantee lighting up the shrine, it is scored as follows:\n\n    - First, you get a base score of $10\\%$.\n\n    - Then, let the minimum number of attempts be $p$. You will get the following additional score:\n\n      - If $k=p$, you will get an additional $90\\%$.\n\n      - If $p<k<=1.5p$, you will get an additional $50+\\frac{1.5p-k}{0.5p}*40\\%$.\n\n      - If $1.5p<k<=2p$, you will get an additional $20+\\frac{2p-k}{0.5p}*30\\%$.\n\n      - If $k>2p$, you will not get any additional score.\n\n# Input Format\n\nThe first line contains an integer $n$, indicating how many possible values there are for each position of the password.\n\n# Output Format\n\nThe first line outputs an integer $k$, indicating the number of password attempts in your plan.\n\nThe next $k$ lines output the password for each attempt.\n\n# Hint\n\nThe sample is not an optimal solution; it is only an example of the output.\n\n**You must output a plan, otherwise you may encounter unknown errors.**\n\nThere are three test points:\n\n- Test point $1$ ($10$ pts): $n=2$.\n- Test point $2$ ($20$ pts): $n=100$.\n- Test point $3$ ($70$ pts): $n=1000$.\n\nFor each dataset, we use the following scoring method:\n\n- If $k > 5000000$, your output is too large, and you will not get any score.\n\n- Otherwise:\n\n  - If the plan you provide cannot guarantee lighting up the shrine, or the plan itself is incorrect, then it is scored as follows:\n\n    - If $k$ is less than the minimum number of attempts, you get $0$ points.\n\n    - Otherwise, if $k$ equals the minimum number of attempts, you get $10\\%$ of the score for this test point.\n\n    - Otherwise, if your $k$ is $q$ times the minimum number of attempts, you will get $\\frac{1}{10*q}$ of the score for this test point.\n\n  - Otherwise, if your plan can guarantee lighting up the shrine, it is scored as follows:\n\n    - First, you get a base score of $10\\%$.\n\n    - Then, let the minimum number of attempts be $p$. You will get the following additional score:\n\n      - If $k=p$, you will get an additional $90\\%$.\n\n      - If $p<k<=1.5p$, you will get an additional $50+\\frac{1.5p-k}{0.5p}*40\\%$.\n\n      - If $1.5p<k<=2p$, you will get an additional $20+\\frac{2p-k}{0.5p}*30\\%$.\n\n      - If $k>2p$, you will not get any additional score.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[Celeste-B] Center of the Earth", "background": "> 我曾如此地接近。\n\n> 我**恨**她。\n\n> \n\n> ...\n\n> 我这次一定要坚持到底。\n\n> 不能再逃跑了。", "description": "Madeline 来到了一座神龛前，这座神龛布满尘埃，四周还都是不明所以的符号。\n\n通过 Madeline 强大的观察能力，她发现这些符号其实对应着一个个冲刺顺序，按照一定顺序冲刺就相当于输入一个密码，只有输入特定的密码才能点亮神龛获得水晶之心。\n\n多年之后，当 Madeline 回忆她的登山之旅时，她已经不记得密码是什么了，只记得密码长度为 $3$，并且每一位密码有 $n$ 种可能。她还知道，在她输入的密码中，任意两位与标准密码相符就能点亮神龛获得水晶之心。\n\n今天，Madeline 又回到了这座神龛前，她希望使用最少的输入密码次数来保证能获得这颗水晶之心，你能帮帮她吗？", "inputFormat": "第一行一个整数 $n$，表示每一位密码有多少种可能。", "outputFormat": "第一行输出一个整数 $k$，表示你给出的方案中输入密码的次数。\n\n接下来 $k$ 行，输出每次尝试的密码。", "hint": "样例不是最优解，只是对输出的一个示例。\n\n**请务必输出方案，否则可能会遇到未知错误**\n\n共有三个测试点：\n\n测试点 $1$($10$pts) : $n=2$\n\n测试点 $2$($20$pts) : $n=100$\n\n测试点 $3$($70$pts) : $n=1000$\n\n对于每组数据我们采取如下评分方式：\n\n- 若 $k > 5000000$ ，你的输出过大，你将无法得到任何分数。\n\n- 否则：\n\n  - 若给出的方案无法保证能点亮神龛，或者方案本身是错误的，则按照如下规则评分：\n\n    - 若 $k$ 小于最小次数，不给分。\n\n    - 否则，若 $k$ 等于最小次数，则给出该测试点 $10\\%$ 的分数。\n\n    - 否则，若你的 $k$ 是最小次数的 $q$ 倍，你将得到这个测试点 $\\frac{1}{10*q}$ 的分数。\n\n  - 否则，你的方案可以保证点亮神龛，则按照如下规则评分：\n\n    - 首先得到 $10\\%$ 的基础分。\n\n    - 接着，令最小次数为 $p$，你将得到如下额外分数：\n\n      - $k=p$，你将得到 $90\\%$ 的额外分数。\n\n      - $p<k<=1.5p$，你将得到 $50+\\frac{1.5p-k}{0.5p}*40\\%$ 的额外分数。\n\n      - $1.5p<k<=2p$，你将得到 $20+\\frac{2p-k}{0.5p}*30\\%$ 的额外分数。\n\n      - $k>2p$，你将不会得到额外分数。\n", "locale": "zh-CN"}}}
{"pid": "P5563", "type": "P", "difficulty": 6, "samples": [["5 16\n1 2 13\n2 3 15\n3 4 7\n3 5 3\n", "15\n15\n15\n10\n15"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 2000, 2000, 2000, 2000, 2000, 2000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["O2优化"], "title": "[Celeste-B] No More Running", "background": "> 逃离自己内心的人，\n\n> 永远也到达不了顶峰。\n\n> 想要到达山顶，你能做的只有\n\n> 不再逃避", "description": "通往山顶的路上水晶遍布。\n\n在晶簇中，Madeline 发现了一个不同寻常的水晶洞穴，洞穴中镶嵌着五彩斑斓的宝石。\n\n经过 Madeline 的观察，她发现这些宝石形成了一个奇妙的机关，只要让宝石收集到足够的魔力，就能打开机关，拿到水晶之心。\n\n具体来说，在这个巨大的洞穴里有着 $n$ 颗宝石，每颗宝石都被镶嵌在**形态结构完全相同**但**相互独立**的树形结构里。更具体地，在这个洞穴里有 $n$ 个相同的树形结构 $T$，树形结构 $T$ 有 $n$ 个节点，而第 $i$ 颗宝石被镶嵌到了第 $i$ 个树形结构 $T$ 的第 $i$ 号节点上。\n\nMadeline 能够推动宝石从而让宝石在树形结构上滑动。当宝石滑过树形结构的一条边**过后**，这条边就会被关闭，并且边上储存的魔力就会被积蓄到宝石中。(再次提醒，这 $n$ 颗宝石所在的树形结构是相互独立的，这意味着在一个树形结构中一条边的封闭并不会导致在其他树形结构中这条边也被封闭)\n\n宝石能储存的魔力是有上限的，更具体而言，每颗宝石都只能储存 $mod$ 的魔力，一旦超过这个魔力上界，宝石的魔力就会溢出，你可以认为宝石此时储存的魔力会对 $mod$ 取模。\n\nMadeline 想要知道，镶嵌在每个顶点上的宝石最终最多能储存多少魔力，你能帮帮她吗？", "inputFormat": "第一行为两个整数 $n$，$mod$，表示树形结构的节点数和 $mod$\n\n接下来 $n-1$ 行一行三个整数 $u,v,w$，描述树形结构中一条连接 $u,v$，能量值为 $w$ 的双向边 ($0 \\leq w < mod$ )。(注意，封闭一条边是双向的，这意味着你不能走回头路)\n\n保证这些边构成了一棵树。", "outputFormat": "$n$ 行 $n$ 个整数，第 $i$ 个表示镶嵌在第 $i$ 个顶点的宝石最多能储存的魔力。", "hint": "![图挂了](https://i.loli.net/2019/08/30/sPwyQKUDANRCT2f.png)\n\n\"特殊约定\" 中，\"一条链\"意味着树形结构的第 $i$ 条边连接第 $i$ 个和第 $i+1$ 个节点。\n\n对于所有数据有 $0\\leq w<mod$ \n\n保证输入的所有边构成一棵树\n\n对于 $1$~$6$ 号测试点，时限为 $1s$\n\n对于 $7$~$12$ 号测试点，时限为 $2s$\n\n对于 $13$~$20$ 号测试点，时限为 $3s$", "locale": "zh-CN", "translations": {"en": {"title": "[Celeste-B] No More Running", "background": "> Those who run away from their own heart,\n\n> will never reach the summit.\n\n> If you want to reach the top, the only thing you can do is\n\n> stop running away.", "description": "Crystals are scattered all along the road to the summit.\n\nIn a cluster of crystals, Madeline finds an unusual crystal cave, with colorful gems embedded inside.\n\nAfter observing, Madeline realizes that these gems form a wonderful mechanism: as long as the gems collect enough magic power, the mechanism can be activated and the Crystal Heart can be obtained.\n\nMore specifically, in this huge cave there are $n$ gems. Each gem is embedded in a tree structure that is **exactly the same in shape** but **independent from the others**. To be even more specific, there are $n$ identical tree structures $T$ in the cave. The tree structure $T$ has $n$ nodes, and the $i$-th gem is embedded at node $i$ of the $i$-th tree structure $T$.\n\nMadeline can push a gem so that it slides along the tree. After the gem passes through an edge, that edge will be closed, and the magic power stored on that edge will be accumulated into the gem. (Reminder: the tree structures containing these $n$ gems are independent. This means that closing an edge in one tree will not cause the same edge to be closed in other trees.)\n\nA gem has a limit on how much magic power it can store. More specifically, each gem can store only $mod$ magic power. Once it exceeds this upper bound, the magic power overflows. You can treat this as taking the stored magic power modulo $mod$.\n\nMadeline wants to know the maximum magic power that the gem embedded at each vertex can store in the end. Can you help her?", "inputFormat": "The first line contains two integers $n$, $mod$, representing the number of nodes in the tree structure and $mod$.\n\nThe next $n-1$ lines each contain three integers $u, v, w$, describing an undirected edge in the tree structure that connects $u$ and $v$ with energy value $w$ ($0 \\leq w < mod$). (Note that closing an edge works in both directions, which means you cannot go back along that edge.)\n\nIt is guaranteed that these edges form a tree.", "outputFormat": "Output $n$ lines, each line containing $n$ integers. The $i$-th integer represents the maximum magic power that the gem embedded at vertex $i$ can store.", "hint": "![Image failed to load](https://i.loli.net/2019/08/30/sPwyQKUDANRCT2f.png)\n\nIn the \"Special Convention\", \"a chain\" means that the $i$-th edge of the tree structure connects node $i$ and node $i+1$.\n\nFor all testdata, $0 \\leq w < mod$.\n\nIt is guaranteed that all input edges form a tree.\n\nFor test points $1$ to $6$, the time limit is $1s$.\n\nFor test points $7$ to $12$, the time limit is $2s$.\n\nFor test points $13$ to $20$, the time limit is $3s$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[Celeste-B] No More Running", "background": "> 逃离自己内心的人，\n\n> 永远也到达不了顶峰。\n\n> 想要到达山顶，你能做的只有\n\n> 不再逃避", "description": "通往山顶的路上水晶遍布。\n\n在晶簇中，Madeline 发现了一个不同寻常的水晶洞穴，洞穴中镶嵌着五彩斑斓的宝石。\n\n经过 Madeline 的观察，她发现这些宝石形成了一个奇妙的机关，只要让宝石收集到足够的魔力，就能打开机关，拿到水晶之心。\n\n具体来说，在这个巨大的洞穴里有着 $n$ 颗宝石，每颗宝石都被镶嵌在**形态结构完全相同**但**相互独立**的树形结构里。更具体地，在这个洞穴里有 $n$ 个相同的树形结构 $T$，树形结构 $T$ 有 $n$ 个节点，而第 $i$ 颗宝石被镶嵌到了第 $i$ 个树形结构 $T$ 的第 $i$ 号节点上。\n\nMadeline 能够推动宝石从而让宝石在树形结构上滑动。当宝石滑过树形结构的一条边**过后**，这条边就会被关闭，并且边上储存的魔力就会被积蓄到宝石中。(再次提醒，这 $n$ 颗宝石所在的树形结构是相互独立的，这意味着在一个树形结构中一条边的封闭并不会导致在其他树形结构中这条边也被封闭)\n\n宝石能储存的魔力是有上限的，更具体而言，每颗宝石都只能储存 $mod$ 的魔力，一旦超过这个魔力上界，宝石的魔力就会溢出，你可以认为宝石此时储存的魔力会对 $mod$ 取模。\n\nMadeline 想要知道，镶嵌在每个顶点上的宝石最终最多能储存多少魔力，你能帮帮她吗？", "inputFormat": "第一行为两个整数 $n$，$mod$，表示树形结构的节点数和 $mod$\n\n接下来 $n-1$ 行一行三个整数 $u,v,w$，描述树形结构中一条连接 $u,v$，能量值为 $w$ 的双向边 ($0 \\leq w < mod$ )。(注意，封闭一条边是双向的，这意味着你不能走回头路)\n\n保证这些边构成了一棵树。", "outputFormat": "$n$ 行 $n$ 个整数，第 $i$ 个表示镶嵌在第 $i$ 个顶点的宝石最多能储存的魔力。", "hint": "![图挂了](https://i.loli.net/2019/08/30/sPwyQKUDANRCT2f.png)\n\n\"特殊约定\" 中，\"一条链\"意味着树形结构的第 $i$ 条边连接第 $i$ 个和第 $i+1$ 个节点。\n\n对于所有数据有 $0\\leq w<mod$ \n\n保证输入的所有边构成一棵树\n\n对于 $1$~$6$ 号测试点，时限为 $1s$\n\n对于 $7$~$12$ 号测试点，时限为 $2s$\n\n对于 $13$~$20$ 号测试点，时限为 $3s$", "locale": "zh-CN"}}}
{"pid": "P5564", "type": "P", "difficulty": 7, "samples": [["3 3\n1 1 1", "8"], ["4 2\n1 3", "15"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1500, 1500, 1500, 1500], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": [], "title": "[Celeste-B] Say Goodbye", "background": "> 你们居然挺过来了，真是令人难以置信，不是吗？\n\n> 努力的过程还是挺有意思的。\n\n> 这个嘛，\n\n> 你又在等什么？", "description": "Madeline 将收集到的草莓分给了朋友们\n\n火红色的草莓和金黄色的草莓交错在一起，很受朋友们喜爱\n\n朋友们为了感谢 Madeline ，一起收集了许多五颜六色的珠子，打算串成一条花花绿绿的项链送给 Madeline\n\n经过朋友们的精心准备，现在桌子上摆着$n$个珠子，这些珠子一共有$k$种颜色。具体来说，第$i$种颜色的珠子有$a_i$个\n\n看着桌子上晶莹剔透的珠子，现在朋友们却犯难了，因为他们不知道怎样将它们串在一起才最美丽\n\n朋友们向你发出了请求，需要你帮忙求出本质不同的方案总数\n\n朋友们分不清这些珠子的顺序，因此**两个珠子不同仅当它们的颜色不同**\n\n这条项链必须是完整的，因此**所有珠子构成了一个连通块**\n\n这条项链还不能太杂乱，因此所有珠子必须构成一棵**基环树**\n\n在多次询问 Madeline 的朋友们之后，你发现这棵基环树的两个子树不同仅当**它们对应点的颜色不同或者这两棵子树不同构**。对于不同的子树是有先后顺序之分的\n\n举例来说，下面的几种**部分**串法是互不相同的\n\n![1566976736844.png](https://cdn.luogu.com.cn/upload/image_hosting/diwl819r.png)\n\n朋友们的时间很紧迫，因此如果两种项链能够通过**旋转基环**得到同样的结果，那么这两种项链本质上是相同的\n\n", "inputFormat": "第一行两个整数 $ n, k $，分别表示珠子的总数以及颜色种数\n\n接下来一行 $k$ 个整数 $a_i$，表示每种颜色的珠子个数\n\n ", "outputFormat": "输出一个整数，表示方案数模 $998244353$ 的余数", "hint": "基环树：一个有$n$个点$n$条边的联通图，**没有自环**。容易看出这样的图是一个环上连出了一些树\n\n基环：基环树中的环\n\n对于 $ 5\\% $ 的数据，$ n \\leq 8 $\n\n对于另 $ 10\\% $ 的数据，$ k = 1 , n \\leq 10^3 $\n\n对于前 $ 30\\% $ 的数据，$ n \\leq 10^3 $\n\n对于另 $ 20\\% $ 的数据，$ k = 1 , n \\leq 5 \\times 10^4 $\n\n对于前 $ 80\\% $ 的数据，$ n \\leq 5 \\times 10^4 $\n\n对于 $ 100\\% $ 的数据，$ a_i > 0 , \\sum a_i = n , n \\leq 2 \\times 10^5 , k \\leq n $\n\n\n第二个样例解释：\n\n有如下$15$种情况：\n\n![1567002672190.png](https://cdn.luogu.com.cn/upload/image_hosting/80ph1r8a.png)\n\n\n", "locale": "zh-CN", "translations": {"en": {"title": "[Celeste-B] Say Goodbye", "background": "> You actually made it through. It is hard to believe, is it not?\n\n> The process of working hard was pretty interesting.\n\n> Well then,\n\n> What are you waiting for?", "description": "Madeline shared the strawberries she collected with her friends.\n\nThe bright red strawberries and the golden yellow strawberries were mixed together, and her friends liked them very much.\n\nTo thank Madeline, her friends collected many colorful beads and planned to string them into a colorful necklace as a gift for Madeline.\n\nAfter careful preparation, there are now $n$ beads on the table. These beads have $k$ colors in total. Specifically, there are $a_i$ beads of the $i$-th color.\n\nLooking at the crystal-clear beads on the table, the friends are now troubled, because they do not know how to string them together to make it the most beautiful.\n\nThey ask you for help: compute the total number of essentially different plans.\n\nThey cannot tell the order of beads apart, so **two beads are different only if their colors are different**.\n\nThis necklace must be complete, so **all beads form one connected component**.\n\nThe necklace also cannot be too messy, so all beads must form a **unicyclic graph (基环树)**.\n\nAfter asking Madeline’s friends many times, you find that two subtrees of this unicyclic graph are different if and only if **the colors of their corresponding nodes are different, or the two subtrees have different structures**. Different subtrees are considered ordered.\n\nFor example, the following **partial** stringing methods are all different from each other.\n\n![1566976736844.png](https://cdn.luogu.com.cn/upload/image_hosting/diwl819r.png)\n\nThe friends are in a hurry, so if two necklaces can become the same by **rotating the cycle (基环)**, then these two necklaces are essentially the same.", "inputFormat": "The first line contains two integers $n, k$, representing the total number of beads and the number of colors.\n\nThe next line contains $k$ integers $a_i$, representing the number of beads of each color.", "outputFormat": "Output one integer, the number of plans modulo $998244353$.", "hint": "Unicyclic graph (基环树): a connected graph with $n$ vertices and $n$ edges, **with no self-loops**. It is easy to see that such a graph consists of a cycle with some trees attached to it.\n\nCycle (基环): the cycle in a unicyclic graph.\n\nFor $5\\%$ of the testdata, $n \\leq 8$.\n\nFor another $10\\%$ of the testdata, $k = 1$ and $n \\leq 10^3$.\n\nFor the first $30\\%$ of the testdata, $n \\leq 10^3$.\n\nFor another $20\\%$ of the testdata, $k = 1$ and $n \\leq 5 \\times 10^4$.\n\nFor the first $80\\%$ of the testdata, $n \\leq 5 \\times 10^4$.\n\nFor $100\\%$ of the testdata, $a_i > 0$, $\\sum a_i = n$, $n \\leq 2 \\times 10^5$, and $k \\leq n$.\n\nExplanation for the second sample:\n\nThere are $15$ cases as follows:\n\n![1567002672190.png](https://cdn.luogu.com.cn/upload/image_hosting/80ph1r8a.png)\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[Celeste-B] Say Goodbye", "background": "> 你们居然挺过来了，真是令人难以置信，不是吗？\n\n> 努力的过程还是挺有意思的。\n\n> 这个嘛，\n\n> 你又在等什么？", "description": "Madeline 将收集到的草莓分给了朋友们\n\n火红色的草莓和金黄色的草莓交错在一起，很受朋友们喜爱\n\n朋友们为了感谢 Madeline ，一起收集了许多五颜六色的珠子，打算串成一条花花绿绿的项链送给 Madeline\n\n经过朋友们的精心准备，现在桌子上摆着$n$个珠子，这些珠子一共有$k$种颜色。具体来说，第$i$种颜色的珠子有$a_i$个\n\n看着桌子上晶莹剔透的珠子，现在朋友们却犯难了，因为他们不知道怎样将它们串在一起才最美丽\n\n朋友们向你发出了请求，需要你帮忙求出本质不同的方案总数\n\n朋友们分不清这些珠子的顺序，因此**两个珠子不同仅当它们的颜色不同**\n\n这条项链必须是完整的，因此**所有珠子构成了一个连通块**\n\n这条项链还不能太杂乱，因此所有珠子必须构成一棵**基环树**\n\n在多次询问 Madeline 的朋友们之后，你发现这棵基环树的两个子树不同仅当**它们对应点的颜色不同或者这两棵子树不同构**。对于不同的子树是有先后顺序之分的\n\n举例来说，下面的几种**部分**串法是互不相同的\n\n![1566976736844.png](https://cdn.luogu.com.cn/upload/image_hosting/diwl819r.png)\n\n朋友们的时间很紧迫，因此如果两种项链能够通过**旋转基环**得到同样的结果，那么这两种项链本质上是相同的\n\n", "inputFormat": "第一行两个整数 $ n, k $，分别表示珠子的总数以及颜色种数\n\n接下来一行 $k$ 个整数 $a_i$，表示每种颜色的珠子个数\n\n ", "outputFormat": "输出一个整数，表示方案数模 $998244353$ 的余数", "hint": "基环树：一个有$n$个点$n$条边的联通图，**没有自环**。容易看出这样的图是一个环上连出了一些树\n\n基环：基环树中的环\n\n对于 $ 5\\% $ 的数据，$ n \\leq 8 $\n\n对于另 $ 10\\% $ 的数据，$ k = 1 , n \\leq 10^3 $\n\n对于前 $ 30\\% $ 的数据，$ n \\leq 10^3 $\n\n对于另 $ 20\\% $ 的数据，$ k = 1 , n \\leq 5 \\times 10^4 $\n\n对于前 $ 80\\% $ 的数据，$ n \\leq 5 \\times 10^4 $\n\n对于 $ 100\\% $ 的数据，$ a_i > 0 , \\sum a_i = n , n \\leq 2 \\times 10^5 , k \\leq n $\n\n\n第二个样例解释：\n\n有如下$15$种情况：\n\n![1567002672190.png](https://cdn.luogu.com.cn/upload/image_hosting/80ph1r8a.png)\n\n\n", "locale": "zh-CN"}}}
{"pid": "P5565", "type": "P", "difficulty": 7, "samples": [["5\n(1&b)\n3 |\n2 a\n3 &\n3 ^\n4 1", "6\n8\n4\n6\n4"], ["10\n1|a&1&(0&0|1)&1^1^a\n1 0\n10 1\n2 &\n1 a\n14 ^\n4 |\n17 0\n4 ^\n15 a\n15 1\n", "29\n30\n27\n35\n35\n43\n35\n35\n56\n35"], ["30\n0|0&0^(a&a&(1^0&0^0)^0&1)|0&a|1|(a&a|0|1|0^a&0&a|(a^0&1|a|a)^a|a&0&0)^a\n71 1\n51 0\n57 0\n65 &\n26 |\n5 a\n71 a\n56 |\n4 &\n41 ^\n52 |\n52 ^\n59 a\n44 0\n54 ^\n65 &\n51 a\n36 1\n16 ^\n1 1\n52 ^\n2 |\n59 0\n58 |\n37 ^\n55 1\n10 1\n26 ^\n18 |\n44 0\n", "21323\n10686\n5360\n5360\n5360\n8469\n16277\n16277\n16277\n16277\n16277\n16277\n16277\n8223\n8253\n8253\n16354\n8359\n8385\n8394\n8394\n8394\n4262\n4262\n4262\n4262\n2430\n2430\n2430\n2430"], ["20\na^1&0^1^1&1&a&1^a|1&a|0&a^a^1^a^0&1^a&a|a|1^0|a|0^1^a|0^0&1&1&a&a|0^0&a&1&a|a&a^a|0^a^a|a^1|a|1^a|0|a^0&0&0|a|a|a^0^1&0^1&a|1&0\n8 ^\n28 |\n100 ^\n119 a\n40 &\n105 1\n31 1\n125 1\n53 1\n98 &\n98 &\n98 &\n52 &\n2 ^\n38 |\n6 ^\n58 ^\n106 |\n12 ^\n57 1", "957521426\n957521583\n874091659\n57281108\n57278566\n140708493\n120472431\n120472431\n561701787\n551192201\n551192201\n551192201\n551120577\n551120577\n551121853\n551121853\n551178140\n656274015\n656274025\n656222855"]], "limits": {"time": [1000, 1000, 1000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["动态规划 DP", "O2优化", "矩阵加速", "树链剖分"], "title": "[Celeste-B] Farewell to Mount Celeste", "background": "> Sever the Skyline\n\n> Black Moonrise\n\n> Good Karma\n\n> Golden Feather\n\n> Mirror Magic\n\n> Center of the Earth\n\n> No More Running\n\n> And...\n\n> Say Goodbye.", "description": "在分别的宴会上，朋友们拿出他们把多彩的珠子串成的彩色的项链。\n\n项链在夕阳的余晖里闪闪发光，仔细一看，项链周围竟然已经聚集了许多鸟儿，鸟儿们带着 Madeline 与她的朋友们来到了一处他们不曾来过的地方，这里汇聚着好大一群鸟，似乎想要向他们表达些什么。\n\n经过 Madeline 仔细地观察，它发现一些鸟儿们飞动的方式好像排成了一个有序的式子，而另一些鸟儿飞动的方式则是一些符号，符号表达着一个问题。\n\n鸟儿们表达的问题是这样的：\n\n鸟儿们组成的式子会由 `(`,`)`,`^`,`&`,`|`,`0`,`1` 和小写字母构成，并且是一个表达式。\n\n其中：\n\n- `(`,`)` 表示括号，在括号中的运算优先级提高。\n\n- `&`,`|`,`^` 表示 `与`,`或`,`异或` 三种位运算，这三种运算**优先级相同**\n\n- `0`,`1` 即为 `0`,`1`\n\n- 小写字母表示变量，多次出现的同一小写字母表示**不同**的变量，一个变量取值 `0` 或 `1`\n\n- 表达式的定义如下：\n\n    - 一个变量,`0`,`1` 均为表达式\n    - 若 $T$ 是表达式，则 $(T)$ 是表达式\n    - 若 $S$,$T$ 是表达式，则$S\\&T$,$S|T$,$S\\ \\hat{}\\ T$均为表达式\n    - 例如，$(1\\ \\hat{}\\ 1\\&0)$ 是一个表达式，并且运算结果为 $0$，但 $(1\\&0$ 不是一个表达式\n\n鸟儿们认为，要能算出 $1$ 的表达式才是优美的，定义一个表达式的优美度为在这个表达式所有 $v$ 个变量的 $2^v$ 种取值中能算出 $1$ 的方案数。\n\n鸟儿们还认为，一个表达式的和谐度是这个表达式的所有**子连续表达式**的优美度的和。(包含自身)\n\n鸟儿们还是善变的，它们会时不时改变一个位置的字符，但是它们向 Madeline 和她的朋友们保证它们不会改变括号，并且进行修改之后整个串仍然是一个表达式。\n\n你能帮助 Madeline 和她的朋友们算出每次修改后整个表达式的和谐度吗？\n\n鸟儿们还说，因为表达式可能太和谐了，因此 Madeline 可以只回答和谐度对 $998244353$ 取模后的值。", "inputFormat": "第一行为一个数 $m$ ,表示修改数\n\n第二行为一个字符串，表示初始表达式\n\n之后 $m$ 行，每一行一个数 $a$ 和一个字符 $b$ ，表示鸟儿们将 $a$ 位置字符变成 $b$ \n\n在输入的表达式中，一个小写字母代表一个变量。(注意一个字母可能出现多次，但代表**不同**变量)", "outputFormat": "$m$ 行，第 $i$ 行为第 $i$ 次修改后的权值。由于和谐度可能很大，你需要对 $998244353$ 取模。", "hint": "设 $n$ 为表达式中变量和 $0,1$ 的个数，$len$ 为表达式长度\n\n有subtask\n\n对于 $ 5\\% $ 的数据, $ n \\leq 12 , len \\leq 50 , m \\leq 50 $,1s\n\n对于额外 $ 10\\% $ 的数据, $ n \\leq 150,len \\leq 400,m \\leq 200$\n\n对于额外 $ 10\\% $ 的数据, $ n \\leq 10^5,len \\leq 2\\times 10^5,m \\leq 10$ ,没有括号\n\n对于额外 $ 10\\% $ 的数据, $ n \\leq 10^5,len \\leq 2\\times 10^5,m \\leq 10^5 $ ,没有括号\n\n对于前 $ 50\\% $ 的数据, $ n \\leq 10^5,len \\leq 4\\times 10^5,m \\leq 10^5 $ ,保证括号随机生成\n\n对于 $ 100\\% $ 的数据, $ n \\leq 10^5,len \\leq 4\\times 10^5,m \\leq 10^5 ,len-2\\times n \\leq 2 \\times 10^5$ \n\n对于后 $ 95\\% $ 的数据，时限为3s", "locale": "zh-CN", "translations": {"en": {"title": "[Celeste-B] Farewell to Mount Celeste", "background": "> Sever the Skyline\n>\n> Black Moonrise\n>\n> Good Karma\n>\n> Golden Feather\n>\n> Mirror Magic\n>\n> Center of the Earth\n>\n> No More Running\n>\n> And...\n>\n> Say Goodbye.", "description": "At the farewell banquet, the friends took out colorful necklaces made by stringing together multicolored beads.\n\nThe necklaces glittered in the afterglow of the sunset. Looking closely, they found that many birds had already gathered around the necklaces. The birds brought Madeline and her friends to a place they had never been to before. A huge flock of birds gathered here, seemingly trying to express something to them.\n\nAfter Madeline observed carefully, she found that the way some birds flew seemed to form an ordered formula, while the way other birds flew formed some symbols. These symbols described a question.\n\nThe question described by the birds is as follows:\n\nThe formula formed by the birds consists of `(`, `)`, `^`, `&`, `|`, `0`, `1`, and lowercase letters, and it is an expression.\n\nSpecifically:\n\n- `(` and `)` are parentheses. Operations inside parentheses have higher precedence.\n\n- `&`, `|`, and `^` represent the three bitwise operations AND, OR, and XOR. These three operations have **the same precedence**.\n\n- `0` and `1` are the constants `0` and `1`.\n\n- Lowercase letters represent variables. Multiple occurrences of the same lowercase letter represent **different** variables. Each variable takes a value of `0` or `1`.\n\n- The expression is defined as follows:\n\n    - A variable, `0`, and `1` are all expressions.\n    - If $T$ is an expression, then $(T)$ is an expression.\n    - If $S$ and $T$ are expressions, then $S\\&T$, $S|T$, and $S\\ \\hat{}\\ T$ are expressions.\n    - For example, $(1\\ \\hat{}\\ 1\\&0)$ is an expression, and its result is $0$, but $(1\\&0$ is not an expression.\n\nThe birds believe that an expression that can evaluate to $1$ is beautiful. Define the beauty of an expression as the number of assignments (among all $2^v$ assignments to its $v$ variables) that make the expression evaluate to $1$.\n\nThe birds also believe that the harmony of an expression is the sum of the beauties of all its **contiguous subexpressions** (including itself).\n\nThe birds are fickle. From time to time, they will change the character at one position, but they promise Madeline and her friends that they will not change the parentheses, and after each modification the whole string is still an expression.\n\nCan you help Madeline and her friends compute the harmony of the entire expression after each modification?\n\nThe birds also said that the expression may be too harmonious, so Madeline only needs to output the harmony modulo $998244353$.", "inputFormat": "The first line contains an integer $m$, representing the number of modifications.\n\nThe second line contains a string representing the initial expression.\n\nThe next $m$ lines each contain an integer $a$ and a character $b$, meaning the birds change the character at position $a$ to $b$.\n\nIn the input expression, each lowercase letter represents one variable. (Note that a letter may appear multiple times, but they represent **different** variables.)", "outputFormat": "Output $m$ lines. The $i$-th line contains the value after the $i$-th modification. Since the harmony may be very large, you need to output it modulo $998244353$.", "hint": "Let $n$ be the number of variables and `0,1` in the expression, and let $len$ be the expression length.\n\nThere are subtasks.\n\nFor $5\\%$ of the testdata: $n \\leq 12$, $len \\leq 50$, $m \\leq 50$, time limit $1\\text{s}$.\n\nFor an additional $10\\%$ of the testdata: $n \\leq 150$, $len \\leq 400$, $m \\leq 200$.\n\nFor an additional $10\\%$ of the testdata: $n \\leq 10^5$, $len \\leq 2\\times 10^5$, $m \\leq 10$, with no parentheses.\n\nFor an additional $10\\%$ of the testdata: $n \\leq 10^5$, $len \\leq 2\\times 10^5$, $m \\leq 10^5$, with no parentheses.\n\nFor the first $50\\%$ of the testdata: $n \\leq 10^5$, $len \\leq 4\\times 10^5$, $m \\leq 10^5$, and the parentheses are guaranteed to be generated randomly.\n\nFor $100\\%$ of the testdata: $n \\leq 10^5$, $len \\leq 4\\times 10^5$, $m \\leq 10^5$, $len-2\\times n \\leq 2 \\times 10^5$.\n\nFor the last $95\\%$ of the testdata, the time limit is $3\\text{s}$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[Celeste-B] Farewell to Mount Celeste", "background": "> Sever the Skyline\n\n> Black Moonrise\n\n> Good Karma\n\n> Golden Feather\n\n> Mirror Magic\n\n> Center of the Earth\n\n> No More Running\n\n> And...\n\n> Say Goodbye.", "description": "在分别的宴会上，朋友们拿出他们把多彩的珠子串成的彩色的项链。\n\n项链在夕阳的余晖里闪闪发光，仔细一看，项链周围竟然已经聚集了许多鸟儿，鸟儿们带着 Madeline 与她的朋友们来到了一处他们不曾来过的地方，这里汇聚着好大一群鸟，似乎想要向他们表达些什么。\n\n经过 Madeline 仔细地观察，它发现一些鸟儿们飞动的方式好像排成了一个有序的式子，而另一些鸟儿飞动的方式则是一些符号，符号表达着一个问题。\n\n鸟儿们表达的问题是这样的：\n\n鸟儿们组成的式子会由 `(`,`)`,`^`,`&`,`|`,`0`,`1` 和小写字母构成，并且是一个表达式。\n\n其中：\n\n- `(`,`)` 表示括号，在括号中的运算优先级提高。\n\n- `&`,`|`,`^` 表示 `与`,`或`,`异或` 三种位运算，这三种运算**优先级相同**\n\n- `0`,`1` 即为 `0`,`1`\n\n- 小写字母表示变量，多次出现的同一小写字母表示**不同**的变量，一个变量取值 `0` 或 `1`\n\n- 表达式的定义如下：\n\n    - 一个变量,`0`,`1` 均为表达式\n    - 若 $T$ 是表达式，则 $(T)$ 是表达式\n    - 若 $S$,$T$ 是表达式，则$S\\&T$,$S|T$,$S\\ \\hat{}\\ T$均为表达式\n    - 例如，$(1\\ \\hat{}\\ 1\\&0)$ 是一个表达式，并且运算结果为 $0$，但 $(1\\&0$ 不是一个表达式\n\n鸟儿们认为，要能算出 $1$ 的表达式才是优美的，定义一个表达式的优美度为在这个表达式所有 $v$ 个变量的 $2^v$ 种取值中能算出 $1$ 的方案数。\n\n鸟儿们还认为，一个表达式的和谐度是这个表达式的所有**子连续表达式**的优美度的和。(包含自身)\n\n鸟儿们还是善变的，它们会时不时改变一个位置的字符，但是它们向 Madeline 和她的朋友们保证它们不会改变括号，并且进行修改之后整个串仍然是一个表达式。\n\n你能帮助 Madeline 和她的朋友们算出每次修改后整个表达式的和谐度吗？\n\n鸟儿们还说，因为表达式可能太和谐了，因此 Madeline 可以只回答和谐度对 $998244353$ 取模后的值。", "inputFormat": "第一行为一个数 $m$ ,表示修改数\n\n第二行为一个字符串，表示初始表达式\n\n之后 $m$ 行，每一行一个数 $a$ 和一个字符 $b$ ，表示鸟儿们将 $a$ 位置字符变成 $b$ \n\n在输入的表达式中，一个小写字母代表一个变量。(注意一个字母可能出现多次，但代表**不同**变量)", "outputFormat": "$m$ 行，第 $i$ 行为第 $i$ 次修改后的权值。由于和谐度可能很大，你需要对 $998244353$ 取模。", "hint": "设 $n$ 为表达式中变量和 $0,1$ 的个数，$len$ 为表达式长度\n\n有subtask\n\n对于 $ 5\\% $ 的数据, $ n \\leq 12 , len \\leq 50 , m \\leq 50 $,1s\n\n对于额外 $ 10\\% $ 的数据, $ n \\leq 150,len \\leq 400,m \\leq 200$\n\n对于额外 $ 10\\% $ 的数据, $ n \\leq 10^5,len \\leq 2\\times 10^5,m \\leq 10$ ,没有括号\n\n对于额外 $ 10\\% $ 的数据, $ n \\leq 10^5,len \\leq 2\\times 10^5,m \\leq 10^5 $ ,没有括号\n\n对于前 $ 50\\% $ 的数据, $ n \\leq 10^5,len \\leq 4\\times 10^5,m \\leq 10^5 $ ,保证括号随机生成\n\n对于 $ 100\\% $ 的数据, $ n \\leq 10^5,len \\leq 4\\times 10^5,m \\leq 10^5 ,len-2\\times n \\leq 2 \\times 10^5$ \n\n对于后 $ 95\\% $ 的数据，时限为3s", "locale": "zh-CN"}}}
{"pid": "P5566", "type": "P", "difficulty": 5, "samples": [["8", "1\n4"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["动态规划 DP", "2008", "各省省选", "山东"], "title": "[SDOI2008] 红黑树", "background": "", "description": "红黑树是一类特殊的二叉搜索树，其中每个结点被染成红色或黑色。若将二叉搜索树结点中的空指针看作是指向一个空结点，则称这类空结点为二叉搜索树的前端结点。并规定所有前端结点的高度为 $-1$。\n\n一棵红黑树是满足下面“红黑性质”的染色二叉搜索树：\n\n1. 每个结点被染成红色或黑色；\n2. 每个前端结点为黑色结点；\n3. 任一红结点的子结点均为黑结点；\n4. 在从任一结点到其子孙前端结点的所有路径上具有相同的黑结点数。\n\n从红黑树中任一结点 $x$ 出发（不包括结点 $x$），到达一个前端结点的任意一条路径上的黑结点个数称为结点 $x$ 的黑高度，记作 $bh(x)$ 。红黑树的黑高度定义为其根结点的黑高度。\n\n给定正整数 $N$，试设计一个算法，计算出在所有含有 $N$ 个结点的红黑树中，红色内结点个数的最小值和最大值。", "inputFormat": "输入一个数字 $N$。", "outputFormat": "输出第一行为红色内节点的个数最小值；第二行为红色内节点的个数最大值。", "hint": "$N \\leq 5000$", "locale": "zh-CN", "translations": {"en": {"title": "[SDOI2008] Red-Black Tree", "background": "", "description": "A red-black tree is a special kind of binary search tree, where each node is colored either red or black. If we treat the null pointers in a binary search tree as pointing to null nodes, then these null nodes are called the sentinel (leaf) nodes of the binary search tree. It is also specified that the height of all sentinel nodes is $-1$.\n\nA red-black tree is a colored binary search tree that satisfies the following “red-black properties”:\n\n1. Each node is colored either red or black.\n2. Each sentinel node is black.\n3. The children of any red node are all black nodes.\n4. On all paths from any node to any sentinel node among its descendants, the number of black nodes is the same.\n\nStarting from any node $x$ in a red-black tree (excluding node $x$ itself), the number of black nodes on any path to a sentinel node is called the black height of node $x$, denoted as $bh(x)$. The black height of a red-black tree is defined as the black height of its root.\n\nGiven a positive integer $N$, design an algorithm to compute, among all red-black trees with $N$ nodes, the minimum and maximum possible numbers of red internal nodes.", "inputFormat": "Input a number $N$.", "outputFormat": "Output two lines.  \nThe first line is the minimum number of red internal nodes.  \nThe second line is the maximum number of red internal nodes.", "hint": "Constraints: $N \\leq 5000$\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SDOI2008] 红黑树", "background": "", "description": "红黑树是一类特殊的二叉搜索树，其中每个结点被染成红色或黑色。若将二叉搜索树结点中的空指针看作是指向一个空结点，则称这类空结点为二叉搜索树的前端结点。并规定所有前端结点的高度为 $-1$。\n\n一棵红黑树是满足下面“红黑性质”的染色二叉搜索树：\n\n1. 每个结点被染成红色或黑色；\n2. 每个前端结点为黑色结点；\n3. 任一红结点的子结点均为黑结点；\n4. 在从任一结点到其子孙前端结点的所有路径上具有相同的黑结点数。\n\n从红黑树中任一结点 $x$ 出发（不包括结点 $x$），到达一个前端结点的任意一条路径上的黑结点个数称为结点 $x$ 的黑高度，记作 $bh(x)$ 。红黑树的黑高度定义为其根结点的黑高度。\n\n给定正整数 $N$，试设计一个算法，计算出在所有含有 $N$ 个结点的红黑树中，红色内结点个数的最小值和最大值。", "inputFormat": "输入一个数字 $N$。", "outputFormat": "输出第一行为红色内节点的个数最小值；第二行为红色内节点的个数最大值。", "hint": "$N \\leq 5000$", "locale": "zh-CN"}}}
{"pid": "P5567", "type": "P", "difficulty": 5, "samples": [["3\n0 0 0 3\n1 -1 0 1\n19 3 5 6", "1944"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2008", "线段树", "各省省选", "山东"], "title": "[SDOI2008] 立方体覆盖", "background": "", "description": "A 君近日为准备省队选拔，特意进行了数据结构的专项训练。训练过程中就遇到了“矩形面积并”这道经典问题，即：给出 $N$ 个各边与坐标轴平行（垂直）的矩形，求矩形覆盖的面积之和。A 君按纵坐标建立线段树后按横坐标扫描计算，轻易 AC 了这道题，时间复杂度为 $O(N\\log N)$。\n\n为了强化训练，A 君将问题推广到三维空间中，即：给出 $N$ 个各棱与坐标轴平行（垂直）的立方体，求立方体覆盖的体积之和。为了简化问题，令立方体均退化为正立方体，用四元组 $(x, y, z, r)$ 表示一个立方体，其中 $x, y, z$ 为立方体的中心点坐标，$r$ 为中心点到立方体各个面的距离（即立方体高的一半）。\n\n这次可难住了 A 君，只好请你——未来的金牌——来帮助他了。", "inputFormat": "第一行是一个正整数 $N$。\n\n以下 $N$ 行每行四个整数 $x, y, z, r$。", "outputFormat": "输出覆盖的总体积。", "hint": "$ N \\leq 100, -1000 \\leq x,y,z \\leq 1000, r \\leq 200$", "locale": "zh-CN", "translations": {"en": {"title": "[SDOI2008] Cube Coverage", "background": "", "description": "Recently, Mr. A has been doing special training on data structures to prepare for the NOI Qualifier team selection. During the training, he encountered the classic problem “Union Area of Rectangles”: given $N$ rectangles whose sides are parallel (perpendicular) to the coordinate axes, find the total area covered by these rectangles. Mr. A built a segment tree along the $y$-axis and then used a sweep line along the $x$-axis to compute it, easily getting AC, with time complexity $O(N\\log N)$.\n\nTo further strengthen the training, Mr. A extended the problem to three-dimensional space: given $N$ cubes whose edges are parallel (perpendicular) to the coordinate axes, find the total volume covered by these cubes. To simplify the problem, assume all cubes are axis-aligned regular cubes. Use a quadruple $(x, y, z, r)$ to represent a cube, where $x, y, z$ are the coordinates of the cube’s center, and $r$ is the distance from the center to each face of the cube (i.e. half of the cube’s side length).\n\nThis time Mr. A got stuck, so he asks you—the future gold medalist—to help him.", "inputFormat": "The first line contains a positive integer $N$.\n\nThe next $N$ lines each contain four integers $x, y, z, r$.", "outputFormat": "Output the total covered volume.", "hint": "Constraints: $N \\leq 100, -1000 \\leq x,y,z \\leq 1000, r \\leq 200$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SDOI2008] 立方体覆盖", "background": "", "description": "A 君近日为准备省队选拔，特意进行了数据结构的专项训练。训练过程中就遇到了“矩形面积并”这道经典问题，即：给出 $N$ 个各边与坐标轴平行（垂直）的矩形，求矩形覆盖的面积之和。A 君按纵坐标建立线段树后按横坐标扫描计算，轻易 AC 了这道题，时间复杂度为 $O(N\\log N)$。\n\n为了强化训练，A 君将问题推广到三维空间中，即：给出 $N$ 个各棱与坐标轴平行（垂直）的立方体，求立方体覆盖的体积之和。为了简化问题，令立方体均退化为正立方体，用四元组 $(x, y, z, r)$ 表示一个立方体，其中 $x, y, z$ 为立方体的中心点坐标，$r$ 为中心点到立方体各个面的距离（即立方体高的一半）。\n\n这次可难住了 A 君，只好请你——未来的金牌——来帮助他了。", "inputFormat": "第一行是一个正整数 $N$。\n\n以下 $N$ 行每行四个整数 $x, y, z, r$。", "outputFormat": "输出覆盖的总体积。", "hint": "$ N \\leq 100, -1000 \\leq x,y,z \\leq 1000, r \\leq 200$", "locale": "zh-CN"}}}
{"pid": "P5568", "type": "P", "difficulty": 5, "samples": [["U [1,5]\nD [3,3]\nS [2,4]\nC (1,5)\nI (2,3]", "(2,3)"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2008", "线段树", "各省省选", "颜色段均摊（珂朵莉树 ODT）", "山东"], "title": "[SDOI2008] 校门外的区间", "background": "", "description": "受校门外的树这道经典问题的启发，A君根据基本的离散数学的知识，抽象出 $5$ 种运算维护集合 $S$ （$S$ 初始为空）并最终输出 $S$。现在，请你完成这道校门外的树之难度增强版——校门外的区间。\n\n五种运算如下：\n\n- `U T`：$S = S \\cup T$\n- `I T`：$S = S \\cap T$\n- `D T`：$S = S - T$\n- `C T`：$S = T - S$\n- `S T`：$S = S \\oplus T$\n\n集合的基本运算操作定义如下：\n\n- $A \\cup B$：$\\{x | x \\in A \\vee x \\in B\\}$\n- $A \\cap B$：$\\{x | x \\in A \\wedge x \\in B\\}$\n- $A - B$：$\\{x | x \\in A \\wedge x \\notin B\\}$\n- $A \\oplus B$：$(A-B)\\cup (B-A)$", "inputFormat": "输入 $M$ 行。每行第一个字母描述操作类型，后面给出一个区间（区间用 `(a,b)`，`(a,b]`，`[a,b)`，`[a,b]` 表示）。", "outputFormat": "输出一行若干区间，代表集合 $S$，**所有区间按递增顺序输出，相邻两个区间之间以一个空格隔开**。\n\n如果区间为空，输出 `empty set`。", "hint": "$ 0 \\leq a,b \\leq 65535, M \\leq 70000$", "locale": "zh-CN", "translations": {"en": {"title": "[SDOI2008] Intervals Outside the School Gate", "background": "", "description": "Inspired by the classic problem “Trees Outside the School Gate”, person A, based on basic knowledge of discrete mathematics, abstracts $5$ kinds of operations to maintain a set $S$ ($S$ is initially empty) and finally output $S$. Now, please complete this harder enhanced version of “Trees Outside the School Gate” — “Intervals Outside the School Gate”.\n\nThe five operations are:\n\n- `U T`: $S = S \\cup T$\n- `I T`: $S = S \\cap T$\n- `D T`: $S = S - T$\n- `C T`: $S = T - S$\n- `S T`: $S = S \\oplus T$\n\nThe basic set operations are defined as follows:\n\n- $A \\cup B$: $\\{x \\mid x \\in A \\vee x \\in B\\}$\n- $A \\cap B$: $\\{x \\mid x \\in A \\wedge x \\in B\\}$\n- $A - B$: $\\{x \\mid x \\in A \\wedge x \\notin B\\}$\n- $A \\oplus B$: $(A-B)\\cup (B-A)$.", "inputFormat": "There are $M$ lines. The first letter of each line describes the operation type, followed by an interval (an interval is written as `(a,b)`, `(a,b]`, `[a,b)`, `[a,b]`).", "outputFormat": "Output one line containing several intervals representing the set $S$. **All intervals should be output in increasing order, and there should be exactly one space between two adjacent intervals**.\n\nIf the set is empty, output `empty set`.", "hint": "$0 \\leq a,b \\leq 65535, M \\leq 70000$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SDOI2008] 校门外的区间", "background": "", "description": "受校门外的树这道经典问题的启发，A君根据基本的离散数学的知识，抽象出 $5$ 种运算维护集合 $S$ （$S$ 初始为空）并最终输出 $S$。现在，请你完成这道校门外的树之难度增强版——校门外的区间。\n\n五种运算如下：\n\n- `U T`：$S = S \\cup T$\n- `I T`：$S = S \\cap T$\n- `D T`：$S = S - T$\n- `C T`：$S = T - S$\n- `S T`：$S = S \\oplus T$\n\n集合的基本运算操作定义如下：\n\n- $A \\cup B$：$\\{x | x \\in A \\vee x \\in B\\}$\n- $A \\cap B$：$\\{x | x \\in A \\wedge x \\in B\\}$\n- $A - B$：$\\{x | x \\in A \\wedge x \\notin B\\}$\n- $A \\oplus B$：$(A-B)\\cup (B-A)$", "inputFormat": "输入 $M$ 行。每行第一个字母描述操作类型，后面给出一个区间（区间用 `(a,b)`，`(a,b]`，`[a,b)`，`[a,b]` 表示）。", "outputFormat": "输出一行若干区间，代表集合 $S$，**所有区间按递增顺序输出，相邻两个区间之间以一个空格隔开**。\n\n如果区间为空，输出 `empty set`。", "hint": "$ 0 \\leq a,b \\leq 65535, M \\leq 70000$", "locale": "zh-CN"}}}
{"pid": "P5569", "type": "P", "difficulty": 6, "samples": [["4\n1\n1\n1\n1", "8"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["贪心", "2008", "各省省选", "山东"], "title": "[SDOI2008] 石子合并", "background": "", "description": "在一个操场上摆放着一排 $N$ 堆石子。现要将石子有次序地合并成一堆。规定每次只能选相邻的 $2$ 堆石子合并成新的一堆，并将新的一堆石子数记为该次合并的得分。\n\n试设计一个算法，计算出将 $N$ 堆石子合并成一堆的最小得分。", "inputFormat": "第一行一个整数 $N$。\n\n接下来 $N$ 行，第 $i$ 行一个整数 $a_i$，代表第 $i$ 堆石子的石子数。", "outputFormat": "输出将所有石子合并为一堆的最小得分。", "hint": "$ N \\leq 40000, a_i \\leq 200$\n\n**请注意 $N$ 的范围（来自上传者的提示）**", "locale": "zh-CN", "translations": {"en": {"title": "[SDOI2008] Stone Merging", "background": "", "description": "On a playground, there is a row of $N$ piles of stones. Now you need to merge the piles in order into a single pile. Each time, you may only choose two adjacent piles to merge into a new pile, and the number of stones in the new pile is counted as the score of this merge.\n\nDesign an algorithm to compute the minimum total score needed to merge the $N$ piles into one pile.", "inputFormat": "The first line contains an integer $N$.\n\nIn the next $N$ lines, the $i$-th line contains an integer $a_i$, representing the number of stones in the $i$-th pile.", "outputFormat": "Output the minimum total score to merge all piles into one pile.", "hint": "$ N \\leq 40000, a_i \\leq 200$\n\n**Please note the range of $N$ (a hint from the uploader).**\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SDOI2008] 石子合并", "background": "", "description": "在一个操场上摆放着一排 $N$ 堆石子。现要将石子有次序地合并成一堆。规定每次只能选相邻的 $2$ 堆石子合并成新的一堆，并将新的一堆石子数记为该次合并的得分。\n\n试设计一个算法，计算出将 $N$ 堆石子合并成一堆的最小得分。", "inputFormat": "第一行一个整数 $N$。\n\n接下来 $N$ 行，第 $i$ 行一个整数 $a_i$，代表第 $i$ 堆石子的石子数。", "outputFormat": "输出将所有石子合并为一堆的最小得分。", "hint": "$ N \\leq 40000, a_i \\leq 200$\n\n**请注意 $N$ 的范围（来自上传者的提示）**", "locale": "zh-CN"}}}
{"pid": "P5570", "type": "P", "difficulty": 7, "samples": [["2 3\n1 1\n..1\n221\n2\n1 3", "PUT 1 2\nPUT 1 1\nSTAR 2 1\nEND"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2012", "NOI", "提交答案", "Special Judge"], "title": "[NOI2012] 三重镇", "background": "小西同学最近喜欢上了 iOS 游戏《三重镇 Triple Town》。游戏之余，小西也在思考如何才能在这个游戏中获得更高的分数。 ", "description": "如下图所示，游戏在一个 $n \\times m$ 的地图中进行。游戏给定一个**建造序列**，玩家按照此建造序列依次选择空白位置建造相应的建筑单位。建筑有九个不同的等级，由低到高分别为 `Grass`, `Bush`, `Tree`, `Hut` 等（为了方便描述，我们称之为 $L_1, L_2, L_3, \\ldots , L_9$）。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/huzjus9n.png)\n\n当玩家在一个空白位置建造单位之后，有可能引起反应。反应的构成条件是：**从这个格子出发，与该建筑单位等级相同的格子所构成的连通块大小大于等于 $3$**， 则这个连通块将被合并为一个下一等级的建筑，此建筑的位置为最后建造的建筑单位位置，连通块中其他位置将变回空格。这里的连通块是指直接或者间接相邻的位置集合。\n\n另外需要注意的是，**$L_9$ 为建筑的最高等级，所以多个 $L_9$ 的连通块并不会合并**。例如在下图中，当建造了中间的 $L_1$ 之后，与该位置相连的 $L_1$就被合并成了一个 $L_2$。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/95tnhrda.png)\n\n注意，在合并的过程中，可能会引起连环反应，如下图所示。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/0zmj49xv.png)\n\n游戏的得分取决于玩家建造和反应生成的单位，建造或者反应生成建筑单位就可以获得相应的分数。不同等级建筑的得分表如下：\n\n|建筑|$L_1$|$L_2$|$L_3$|$L_4$|$L_5$|$L_6$|$L_7$|$L_8$|$L_9$|\n|:----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|\n|得分|$4$|$20$|$100$|$500$|$1500$|$5000$|$20000$|$100000$|$500000$|\n\n以刚才的两个游戏过程为例。图 2 中，首先建造了 $L_1$, 将得到 $4$ 分，随后， $L_1$ 进行了反应生成了 $L_2$, 此时再得到 $20$ 分。总共得分为 $24$。而在图 3 中，这一步操作得分为 $4+20+100+500=624$ 分。\n\n为了降低游戏的难度，游戏中还设有两种道具，分别为“星星”和“炸弹”。在游戏开始时，玩家被给定 $p$ 个星星道具和 $q$ 个炸弹道具，玩家可以在任意时刻使用。两者功能如下：\n\n- “星星”道具：可以放置在一个空格位置。当星星被放置时，星星会自动变为**能引起反应的最高等级建筑**。当在该位置不能引起任何反应时，星星变为 $L_1$。例如，在图 3 正中间位置放置星星，星星自动变为 $L_3$。星星的得分按照变化后的建筑计算得分。\n- “炸弹”道具：炸弹道具可以放在在一个有建筑的位置上，作用为炸掉这个建筑并将该位置恢复为空格。当使用炸弹时，得分将扣除被炸掉的建筑的一半分数（即，得分为负数）。\n\n在游戏的进行过程中，玩家必须按照给定的顺序进行建造，但可以随时穿插使用两种道具。游戏的目标是，通过合理的操作，取得最高的分数。", "inputFormat": "**本题是一道提交答案题。**\n\n对于每个数据，输入文件中第一行为两个整数 $n$，$m$, 表示地图一共包含 $n$ 行 $m$ 列。\n\n接下来一行包含两个整数 $p$，$q$，分别表示道具星星和道具炸弹的数目。\n\n接下来 $n$ 行包含一个 $n \\times m$ 的初始地图。其中字符 `.` 表示空地，数字 $1\\sim 9$ 分别表示相应等级的建筑。\n\n再接下来一行包含一个数字 $k$，表示建造序列的长度。\n\n最后一行包含 $k$ 个空格隔开的 $1\\sim 9$ 之间的数字，表示建造序列的内容。", "outputFormat": "针对给定的 $10$ 个输入文件 `tritown1.in` ~ `tritown10.in`，你需要分别提交你的输出文件 `tritown1.out` ~ `tritown10.out`。\n\n输出文件包含玩家进行游戏的指令，共 $4$ 种指令：\n\n|指令|含义|\n|:--:|:----------:|\n|`PUT x y`|将建造序列中的下一个单位放置到第 $x$ 行第 $y$ 列的空格中。\n|`STAR x y`|放置星星道具到第$x$行第$y$列的空格中。|\n|`BOMBER x y`|在第 $x$ 行第 $y$ 列放置炸弹，此位置必须非空。|\n|`END`|游戏结束，结算当前得分。|\n\n输出必须以 `END` 指令结尾，玩家可以在任意时刻结束游戏。", "hint": "#### 样例解释\n\n本样例对应下图：\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/62gxe52w.png)\n\n第一步得分为 $4+20+100=124$；\n\n第二步得分为 $100$；\n\n第三步得分为 $100+500=600$；\n\n游戏总得分 $124+100+600=824$ 分。\n\n#### 评分标准\n\n对于每组数据，我们设置了 $9$ 个评分参数 $a_{10}, a_9, …, a_2$，它们按此顺序每行一个放置在附加文件中的 `tritown1.ans` ~ `tritown10.ans` 内。如果选手的输出不合法，则得零分。否则，设在你的方案中，游戏得分为 $w_{user}$，你的分数将会由下表给出：\n\n|得分|条件|得分|条件|\n|:----:|:------:|:----:|:------:|\n|10|$w_{user}\\geq a_{10}$|5|$w_{user}\\geq a_5$|\n|9|$w_{user}\\geq a_9$|4|$w_{user}\\geq a_4$|\n|8|$w_{user}\\geq a_8$|3|$w_{user}\\geq a_3$|\n|7|$w_{user}\\geq a_7$|2|$w_{user}\\geq a_2$|\n|6|$w_{user}\\geq a_6$|1|$w_{user}>0$|\n\n如果有多项满足，则取满足条件中的最高得分。\n\n#### 附加文件\n\nchecker 需要自行编译后使用。\n\n请前往 [Github](https://github.com/MikeMirzayanov/testlib) 下载 testlib.h 的最新源代码。", "locale": "zh-CN", "translations": {"en": {"title": "[NOI2012] Triple Town", "background": "Student Xiao Xi recently became interested in the iOS game *Triple Town*. After playing, Xiao Xi also started thinking about how to get a higher score in this game.", "description": "As shown in the figure below, the game is played on an $n \\times m$ grid map. The game provides a **building sequence**. The player chooses an empty cell each time and places the corresponding building unit in order. Buildings have nine different levels. From low to high they are `Grass`, `Bush`, `Tree`, `Hut`, etc. (for convenience, we call them $L_1, L_2, L_3, \\ldots , L_9$).\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/huzjus9n.png)\n\nAfter the player builds a unit on an empty cell, it may trigger a reaction. A reaction happens if: **starting from this cell, the size of the connected component formed by cells with the same building level as this unit is at least $3$**. Then this connected component will be merged into one building of the next level. The new building is placed at the position of the last built unit, and all other cells in the component become empty. Here, a connected component means a set of positions that are directly or indirectly adjacent.\n\nAlso note that **$L_9$ is the highest level, so connected components of multiple $L_9$ will not merge**. For example, in the figure below, after building the middle $L_1$, the $L_1$ connected to it are merged into one $L_2$.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/95tnhrda.png)\n\nNote that during merging, chain reactions may occur, as shown below.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/0zmj49xv.png)\n\nThe game score depends on the units the player builds and the units generated by reactions. Whenever a building unit is placed or generated by a reaction, the corresponding score is added. The score table for different building levels is as follows:\n\n|Building|$L_1$|$L_2$|$L_3$|$L_4$|$L_5$|$L_6$|$L_7$|$L_8$|$L_9$|\n|:----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|\n|Score|$4$|$20$|$100$|$500$|$1500$|$5000$|$20000$|$100000$|$500000$|\n\nUsing the two game processes above as examples: in Figure 2, first an $L_1$ is built, gaining $4$ points. Then the $L_1$ reacts and generates an $L_2$, gaining another $20$ points. The total is $24$. In Figure 3, this move scores $4+20+100+500=624$ points.\n\nTo reduce the difficulty, the game also provides two items: “star” and “bomb”. At the start of the game, the player is given $p$ stars and $q$ bombs, and can use them at any time. Their functions are:\n\n- “Star” item: It can be placed on an empty cell. When a star is placed, it automatically becomes the **highest-level building that can trigger a reaction**. If no reaction can be triggered at that position, the star becomes $L_1$. For example, placing a star at the very center in Figure 3, the star automatically becomes $L_3$. The score of the star is calculated according to the building level it becomes.\n- “Bomb” item: A bomb can be placed on a cell that already has a building. It destroys the building and turns that cell back into empty. When using a bomb, half of the destroyed building’s score is deducted (i.e. the score added is negative).\n\nDuring the game, the player must place buildings in the given order, but may interleave the use of the two items at any time. The goal is to achieve the highest possible score through proper operations.", "inputFormat": "**This is an output-only problem.**\n\nFor each test, the first line of the input file contains two integers $n$, $m$, indicating that the map has $n$ rows and $m$ columns.\n\nThe next line contains two integers $p$, $q$, indicating the number of star items and bomb items.\n\nThe next $n$ lines contain the initial $n \\times m$ map. The character `.` means an empty cell, and digits $1\\sim 9$ represent buildings of the corresponding levels.\n\nThe next line contains a number $k$, indicating the length of the building sequence.\n\nThe last line contains $k$ space-separated integers between $1\\sim 9$, indicating the content of the building sequence.", "outputFormat": "For the given $10$ input files `tritown1.in` ~ `tritown10.in`, you need to submit your output files `tritown1.out` ~ `tritown10.out` respectively.\n\nEach output file contains the player’s game commands. There are $4$ types of commands:\n\n|Command|Meaning|\n|:--:|:----------:|\n|`PUT x y`|Place the next unit in the building sequence into the empty cell at row $x$, column $y$.|\n|`STAR x y`|Place a star item into the empty cell at row $x$, column $y$.|\n|`BOMBER x y`|Place a bomb at row $x$, column $y$. This cell must be non-empty.|\n|`END`|End the game and settle the current score.|\n\nThe output must end with the `END` command. The player may end the game at any time.", "hint": "#### Sample Explanation\n\nThis sample corresponds to the figure below:\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/62gxe52w.png)\n\nThe first move scores $4+20+100=124$.\n\nThe second move scores $100$.\n\nThe third move scores $100+500=600$.\n\nThe total score is $124+100+600=824$.\n\n#### Scoring\n\nFor each test, we provide $9$ scoring parameters $a_{10}, a_9, \\ldots, a_2$, one per line in this order, in the additional files `tritown1.ans` ~ `tritown10.ans`. If your output is invalid, you get $0$ points. Otherwise, let your game score be $w_{user}$. Your score is given by the table below:\n\n|Score|Condition|Score|Condition|\n|:----:|:------:|:----:|:------:|\n|10|$w_{user}\\geq a_{10}$|5|$w_{user}\\geq a_5$|\n|9|$w_{user}\\geq a_9$|4|$w_{user}\\geq a_4$|\n|8|$w_{user}\\geq a_8$|3|$w_{user}\\geq a_3$|\n|7|$w_{user}\\geq a_7$|2|$w_{user}\\geq a_2$|\n|6|$w_{user}\\geq a_6$|1|$w_{user}>0$|\n\nIf multiple conditions are satisfied, take the highest score among them.\n\n#### Additional Files\n\nThe checker needs to be compiled before use.\n\nPlease go to [Github](https://github.com/MikeMirzayanov/testlib) to download the latest source code of testlib.h.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[NOI2012] 三重镇", "background": "小西同学最近喜欢上了 iOS 游戏《三重镇 Triple Town》。游戏之余，小西也在思考如何才能在这个游戏中获得更高的分数。 ", "description": "如下图所示，游戏在一个 $n \\times m$ 的地图中进行。游戏给定一个**建造序列**，玩家按照此建造序列依次选择空白位置建造相应的建筑单位。建筑有九个不同的等级，由低到高分别为 `Grass`, `Bush`, `Tree`, `Hut` 等（为了方便描述，我们称之为 $L_1, L_2, L_3, \\ldots , L_9$）。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/huzjus9n.png)\n\n当玩家在一个空白位置建造单位之后，有可能引起反应。反应的构成条件是：**从这个格子出发，与该建筑单位等级相同的格子所构成的连通块大小大于等于 $3$**， 则这个连通块将被合并为一个下一等级的建筑，此建筑的位置为最后建造的建筑单位位置，连通块中其他位置将变回空格。这里的连通块是指直接或者间接相邻的位置集合。\n\n另外需要注意的是，**$L_9$ 为建筑的最高等级，所以多个 $L_9$ 的连通块并不会合并**。例如在下图中，当建造了中间的 $L_1$ 之后，与该位置相连的 $L_1$就被合并成了一个 $L_2$。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/95tnhrda.png)\n\n注意，在合并的过程中，可能会引起连环反应，如下图所示。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/0zmj49xv.png)\n\n游戏的得分取决于玩家建造和反应生成的单位，建造或者反应生成建筑单位就可以获得相应的分数。不同等级建筑的得分表如下：\n\n|建筑|$L_1$|$L_2$|$L_3$|$L_4$|$L_5$|$L_6$|$L_7$|$L_8$|$L_9$|\n|:----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|\n|得分|$4$|$20$|$100$|$500$|$1500$|$5000$|$20000$|$100000$|$500000$|\n\n以刚才的两个游戏过程为例。图 2 中，首先建造了 $L_1$, 将得到 $4$ 分，随后， $L_1$ 进行了反应生成了 $L_2$, 此时再得到 $20$ 分。总共得分为 $24$。而在图 3 中，这一步操作得分为 $4+20+100+500=624$ 分。\n\n为了降低游戏的难度，游戏中还设有两种道具，分别为“星星”和“炸弹”。在游戏开始时，玩家被给定 $p$ 个星星道具和 $q$ 个炸弹道具，玩家可以在任意时刻使用。两者功能如下：\n\n- “星星”道具：可以放置在一个空格位置。当星星被放置时，星星会自动变为**能引起反应的最高等级建筑**。当在该位置不能引起任何反应时，星星变为 $L_1$。例如，在图 3 正中间位置放置星星，星星自动变为 $L_3$。星星的得分按照变化后的建筑计算得分。\n- “炸弹”道具：炸弹道具可以放在在一个有建筑的位置上，作用为炸掉这个建筑并将该位置恢复为空格。当使用炸弹时，得分将扣除被炸掉的建筑的一半分数（即，得分为负数）。\n\n在游戏的进行过程中，玩家必须按照给定的顺序进行建造，但可以随时穿插使用两种道具。游戏的目标是，通过合理的操作，取得最高的分数。", "inputFormat": "**本题是一道提交答案题。**\n\n对于每个数据，输入文件中第一行为两个整数 $n$，$m$, 表示地图一共包含 $n$ 行 $m$ 列。\n\n接下来一行包含两个整数 $p$，$q$，分别表示道具星星和道具炸弹的数目。\n\n接下来 $n$ 行包含一个 $n \\times m$ 的初始地图。其中字符 `.` 表示空地，数字 $1\\sim 9$ 分别表示相应等级的建筑。\n\n再接下来一行包含一个数字 $k$，表示建造序列的长度。\n\n最后一行包含 $k$ 个空格隔开的 $1\\sim 9$ 之间的数字，表示建造序列的内容。", "outputFormat": "针对给定的 $10$ 个输入文件 `tritown1.in` ~ `tritown10.in`，你需要分别提交你的输出文件 `tritown1.out` ~ `tritown10.out`。\n\n输出文件包含玩家进行游戏的指令，共 $4$ 种指令：\n\n|指令|含义|\n|:--:|:----------:|\n|`PUT x y`|将建造序列中的下一个单位放置到第 $x$ 行第 $y$ 列的空格中。\n|`STAR x y`|放置星星道具到第$x$行第$y$列的空格中。|\n|`BOMBER x y`|在第 $x$ 行第 $y$ 列放置炸弹，此位置必须非空。|\n|`END`|游戏结束，结算当前得分。|\n\n输出必须以 `END` 指令结尾，玩家可以在任意时刻结束游戏。", "hint": "#### 样例解释\n\n本样例对应下图：\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/62gxe52w.png)\n\n第一步得分为 $4+20+100=124$；\n\n第二步得分为 $100$；\n\n第三步得分为 $100+500=600$；\n\n游戏总得分 $124+100+600=824$ 分。\n\n#### 评分标准\n\n对于每组数据，我们设置了 $9$ 个评分参数 $a_{10}, a_9, …, a_2$，它们按此顺序每行一个放置在附加文件中的 `tritown1.ans` ~ `tritown10.ans` 内。如果选手的输出不合法，则得零分。否则，设在你的方案中，游戏得分为 $w_{user}$，你的分数将会由下表给出：\n\n|得分|条件|得分|条件|\n|:----:|:------:|:----:|:------:|\n|10|$w_{user}\\geq a_{10}$|5|$w_{user}\\geq a_5$|\n|9|$w_{user}\\geq a_9$|4|$w_{user}\\geq a_4$|\n|8|$w_{user}\\geq a_8$|3|$w_{user}\\geq a_3$|\n|7|$w_{user}\\geq a_7$|2|$w_{user}\\geq a_2$|\n|6|$w_{user}\\geq a_6$|1|$w_{user}>0$|\n\n如果有多项满足，则取满足条件中的最高得分。\n\n#### 附加文件\n\nchecker 需要自行编译后使用。\n\n请前往 [Github](https://github.com/MikeMirzayanov/testlib) 下载 testlib.h 的最新源代码。", "locale": "zh-CN"}}}
