{"pid": "P9133", "type": "P", "difficulty": 5, "samples": [["7\n0 0 1 0 0 0 0\n1 1 2 2 3 3\n", "2"], ["见附件中的 2.in", "见附件中的 2.ans"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["贪心", "博弈论", "2023", "O2优化", "THUPC"], "title": "[THUPC 2023 初赛] 大富翁", "background": "有一天，小 W 和小 H 在玩大富翁。", "description": "这版大富翁的游戏规则比较独特。它的地图是一棵 $n$ 个节点的有根树，其中 $1$ 号节点为根。树上每个节点都有一个价格，第 $x$ 号节点的价格记为 $w_x$。\n\n对于树上两个不同的节点 $x,y$，若 $x$ 是 $y$ 的祖先节点（即，$x$ 在 $1$ 号点到 $y$ 号点的简单路径上），则称 $x$ **支配** $y$。\n\n游戏过程中，小 W 和小 H 轮流**购买**树上的一个未被人购买过的节点，直到树上的 $n$ 个节点都被小 W 或小 H 购买。（游戏开始前，树上的所有节点都没有被购买。）\n\n对于一次购买，假设买方购买了 $x$ 号节点，那么他首先要向系统支付 $w_x$ 个游戏币。假设此时 $x$ 支配着 $n_1$ 个已被买方的对手购买了的节点，同时又被 $n_2$ 个已被对手购买了的节点支配。若 $n_1>n_2$，那么对手要向买方支付 $n_1-n_2$ 个游戏币，若 $n_1<n_2$，那么买方要向对手支付 $n_2-n_1$ 个游戏币。\n\n小 W 和小 H 都是绝顶聪明的人，他们都会在游戏中采用最优策略，来使自己赚到尽量多的游戏币。现在，小 W 想考考你：如果他先手，他最终能赚到多少个游戏币？（即，在整个游戏过程中，小 W 从小 H 手中获得的游戏币个数减去他支付给系统和小 H 的游戏币个数。你可以认为，游戏开始前，小 H 和小 W 手中都有足够数量的游戏币。注意：答案可能为负数。）", "inputFormat": "第一行一个正整数 $n$。\n\n第二行 $n$ 个非负整数，第 $i$ 个整数为 $i$ 号节点的价格 $w_i$。\n\n第三行 $n-1$ 个正整数，第 $i$ 个正整数表示第 $i+1$ 号节点的父亲编号。", "outputFormat": "一行一个整数表示答案。", "hint": "#### 样例解释 1\n\n一个可能的游戏过程是：\n\n- 第一次购买：小 W 购买 $1$ 号节点，向系统支付 $0$ 个游戏币。\n- 第二次购买：小 H 购买 $2$ 号节点，向系统支付 $0$ 个游戏币，并向小 W 支付 $1$ 个游戏币。\n- 第三次购买：小 W 购买 $3$ 号节点，向系统支付 $1$ 个游戏币。\n- 第四次购买：小 H 购买 $4$ 号节点，向系统支付 $0$ 个游戏币，并向小 W 支付 $1$ 个游戏币。\n- 第五次购买：小 W 购买 $6$ 号节点，向系统支付 $0$ 个游戏币。\n- 第六次购买：小 H 购买 $5$ 号节点，向系统支付 $0$ 个游戏币，并向小 W 支付 $1$ 个游戏币。\n- 第七次购买：小 W 购买 $7$ 号节点，向系统支付 $0$ 个游戏币。\n\n#### 子任务\n\n对于所有测试数据，$1\\leq n\\leq 2\\times 10^5$，$0\\leq w_x\\leq 2\\times 10^5$。保证输入的图为一棵以 $1$ 号节点为根的有根树。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 大富翁", "background": "有一天，小 W 和小 H 在玩大富翁。", "description": "这版大富翁的游戏规则比较独特。它的地图是一棵 $n$ 个节点的有根树，其中 $1$ 号节点为根。树上每个节点都有一个价格，第 $x$ 号节点的价格记为 $w_x$。\n\n对于树上两个不同的节点 $x,y$，若 $x$ 是 $y$ 的祖先节点（即，$x$ 在 $1$ 号点到 $y$ 号点的简单路径上），则称 $x$ **支配** $y$。\n\n游戏过程中，小 W 和小 H 轮流**购买**树上的一个未被人购买过的节点，直到树上的 $n$ 个节点都被小 W 或小 H 购买。（游戏开始前，树上的所有节点都没有被购买。）\n\n对于一次购买，假设买方购买了 $x$ 号节点，那么他首先要向系统支付 $w_x$ 个游戏币。假设此时 $x$ 支配着 $n_1$ 个已被买方的对手购买了的节点，同时又被 $n_2$ 个已被对手购买了的节点支配。若 $n_1>n_2$，那么对手要向买方支付 $n_1-n_2$ 个游戏币，若 $n_1<n_2$，那么买方要向对手支付 $n_2-n_1$ 个游戏币。\n\n小 W 和小 H 都是绝顶聪明的人，他们都会在游戏中采用最优策略，来使自己赚到尽量多的游戏币。现在，小 W 想考考你：如果他先手，他最终能赚到多少个游戏币？（即，在整个游戏过程中，小 W 从小 H 手中获得的游戏币个数减去他支付给系统和小 H 的游戏币个数。你可以认为，游戏开始前，小 H 和小 W 手中都有足够数量的游戏币。注意：答案可能为负数。）", "inputFormat": "第一行一个正整数 $n$。\n\n第二行 $n$ 个非负整数，第 $i$ 个整数为 $i$ 号节点的价格 $w_i$。\n\n第三行 $n-1$ 个正整数，第 $i$ 个正整数表示第 $i+1$ 号节点的父亲编号。", "outputFormat": "一行一个整数表示答案。", "hint": "#### 样例解释 1\n\n一个可能的游戏过程是：\n\n- 第一次购买：小 W 购买 $1$ 号节点，向系统支付 $0$ 个游戏币。\n- 第二次购买：小 H 购买 $2$ 号节点，向系统支付 $0$ 个游戏币，并向小 W 支付 $1$ 个游戏币。\n- 第三次购买：小 W 购买 $3$ 号节点，向系统支付 $1$ 个游戏币。\n- 第四次购买：小 H 购买 $4$ 号节点，向系统支付 $0$ 个游戏币，并向小 W 支付 $1$ 个游戏币。\n- 第五次购买：小 W 购买 $6$ 号节点，向系统支付 $0$ 个游戏币。\n- 第六次购买：小 H 购买 $5$ 号节点，向系统支付 $0$ 个游戏币，并向小 W 支付 $1$ 个游戏币。\n- 第七次购买：小 W 购买 $7$ 号节点，向系统支付 $0$ 个游戏币。\n\n#### 子任务\n\n对于所有测试数据，$1\\leq n\\leq 2\\times 10^5$，$0\\leq w_x\\leq 2\\times 10^5$。保证输入的图为一棵以 $1$ 号节点为根的有根树。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN"}}}
{"pid": "P9134", "type": "P", "difficulty": 6, "samples": [["3 2\n", "2\n"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["模拟", "高精度", "2023", "O2优化", "THUPC"], "title": "[THUPC 2023 初赛] 拧螺丝", "background": "张华考上了北京大学；李萍进了中等技术学校；~~小 E 在工地搬砖~~：他们都有光明的前途。\n\n由于搬砖太累，小 E 决定进厂拧螺丝。但是小 E 遇到了一个各种刁难人的老板。", "description": "加工一个模块需要拧 $n$ 个螺丝。但是，每隔 $10$ 分钟，小 E 的老板就会到小 E 的工位上收走一个未完工的模块。在这期间，只够小 E 拧 $k$ 个螺丝。\n\n小 E 的老板刚刚离开。问老板接下来第几次来的时候小 E 才可能有一个完工的模块？假设小 E 的老板极力不想让小 E 达成这件事。", "inputFormat": "一行两个正整数，$n,k$。", "outputFormat": "如果小 E 无论如何也不能有一个完工的模块，那么输出一行 `Poor E.S.!`。\n\n否则输出一行一个正整数，表示答案。", "hint": "#### 样例解释 1\n\n小 E 先选择两个模块各拧上一个螺丝，然后老板来了拿走一个。接下来小 E 只需要在剩下的那个零件上面拧两个螺丝就可以完工了。所以老板第二次来的时候小 E 就有了一个完工的模块。注意小 E 在老板来的时候不能有只拧上了一半的螺丝，不然老板看到了会说小 E 加工不合格。\n\n#### 子任务\n\n保证 $1\\le k \\le n \\le 10^5$。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 拧螺丝", "background": "张华考上了北京大学；李萍进了中等技术学校；~~小 E 在工地搬砖~~：他们都有光明的前途。\n\n由于搬砖太累，小 E 决定进厂拧螺丝。但是小 E 遇到了一个各种刁难人的老板。", "description": "加工一个模块需要拧 $n$ 个螺丝。但是，每隔 $10$ 分钟，小 E 的老板就会到小 E 的工位上收走一个未完工的模块。在这期间，只够小 E 拧 $k$ 个螺丝。\n\n小 E 的老板刚刚离开。问老板接下来第几次来的时候小 E 才可能有一个完工的模块？假设小 E 的老板极力不想让小 E 达成这件事。", "inputFormat": "一行两个正整数，$n,k$。", "outputFormat": "如果小 E 无论如何也不能有一个完工的模块，那么输出一行 `Poor E.S.!`。\n\n否则输出一行一个正整数，表示答案。", "hint": "#### 样例解释 1\n\n小 E 先选择两个模块各拧上一个螺丝，然后老板来了拿走一个。接下来小 E 只需要在剩下的那个零件上面拧两个螺丝就可以完工了。所以老板第二次来的时候小 E 就有了一个完工的模块。注意小 E 在老板来的时候不能有只拧上了一半的螺丝，不然老板看到了会说小 E 加工不合格。\n\n#### 子任务\n\n保证 $1\\le k \\le n \\le 10^5$。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN"}}}
{"pid": "P9135", "type": "P", "difficulty": 6, "samples": [["3\n2 3 4\n", "40\n"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["2023", "数论", "O2优化", "快速傅里叶变换 FFT", "THUPC"], "title": "[THUPC 2023 初赛] 快速 LCM 变换", "background": "", "description": "小 I 今天学习了快速最小公倍数变换（Fast Least-Common-Multiple Transform, FLT），于是他想考考你。\n\n给定一个长度为 $n$ 的正整数序列 $r_1,r_2,\\cdots,r_n$。你需要做以下操作恰好一次：\n\n- 选择整数 $i,j$ 使得 $1 \\le i < j \\le n$。在序列末尾加入 $(r_i+r_j)$，并将 $r_i$ 和 $r_j$ 从序列中删除。\n\n可以注意到总共有 $\\frac{n(n-1)}{2}$ 种可能的操作，每种操作会得到一个长度为 $n-1$ 的序列。\n\n你需要对所有的这 $\\frac{n(n-1)}{2}$ 个序列，求出序列中所有元素的最小公倍数，并给出它们的和模 $998244353$ 的值。", "inputFormat": "输入的第一行包含一个正整数 $n$，表示序列的长度。接下来一行 $n$ 个正整数 $r_1,r_2,\\cdots,r_n$，描述初始序列。", "outputFormat": "输出一行一个整数，表示所有序列的最小公倍数的和模 $998244353$ 的值。", "hint": "#### 样例解释 1\n\n- $i=1,j=2$ 时，得到的序列为 $\\{4,5\\}$，最小公倍数为 $20$；\n- $i=1,j=3$ 时，得到的序列为 $\\{3,6\\}$，最小公倍数为 $6$；\n- $i=2,j=3$ 时，得到的序列为 $\\{2,7\\}$，最小公倍数为 $14$。\n\n因此输出为 $20+6+14=40$。\n\n#### 子任务\n\n对于所有测试数据，$2 \\le n \\le 5 \\times 10^5, 1 \\le r_1,r_2,\\cdots,r_n \\le 10^6$。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 快速 LCM 变换", "background": "", "description": "小 I 今天学习了快速最小公倍数变换（Fast Least-Common-Multiple Transform, FLT），于是他想考考你。\n\n给定一个长度为 $n$ 的正整数序列 $r_1,r_2,\\cdots,r_n$。你需要做以下操作恰好一次：\n\n- 选择整数 $i,j$ 使得 $1 \\le i < j \\le n$。在序列末尾加入 $(r_i+r_j)$，并将 $r_i$ 和 $r_j$ 从序列中删除。\n\n可以注意到总共有 $\\frac{n(n-1)}{2}$ 种可能的操作，每种操作会得到一个长度为 $n-1$ 的序列。\n\n你需要对所有的这 $\\frac{n(n-1)}{2}$ 个序列，求出序列中所有元素的最小公倍数，并给出它们的和模 $998244353$ 的值。", "inputFormat": "输入的第一行包含一个正整数 $n$，表示序列的长度。接下来一行 $n$ 个正整数 $r_1,r_2,\\cdots,r_n$，描述初始序列。", "outputFormat": "输出一行一个整数，表示所有序列的最小公倍数的和模 $998244353$ 的值。", "hint": "#### 样例解释 1\n\n- $i=1,j=2$ 时，得到的序列为 $\\{4,5\\}$，最小公倍数为 $20$；\n- $i=1,j=3$ 时，得到的序列为 $\\{3,6\\}$，最小公倍数为 $6$；\n- $i=2,j=3$ 时，得到的序列为 $\\{2,7\\}$，最小公倍数为 $14$。\n\n因此输出为 $20+6+14=40$。\n\n#### 子任务\n\n对于所有测试数据，$2 \\le n \\le 5 \\times 10^5, 1 \\le r_1,r_2,\\cdots,r_n \\le 10^6$。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN"}}}
{"pid": "P9136", "type": "P", "difficulty": 7, "samples": [["5 6\n1 3 3 2 2\n1 2\n1 3\n2 4\n2 5\n4 3 4 2\n3 2 6 2\n4 0 7 1\n1 5 6 1\n2 2 7\n4 0 3 0\n", "3\n4\n2\n"]], "limits": {"time": [6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["2023", "O2优化", "分块", "THUPC"], "title": "[THUPC 2023 初赛] 种苹果", "background": "", "description": "农夫种了一棵苹果树，树上结满了大大小小的苹果。夏天正是果树生长发育的大好时节，树上不断抽出新的枝条、结出新的苹果，已有的苹果也在不断长大。\n\n为了观察和记录苹果的生长状况，以便对未来收获的行情有大致的估计，农夫进行了长时间仔细的观察和研究。在整个记录周期的最开始，树上一共结有 $n$ 个苹果，农夫将其编号为 $1\\sim n$ ，有 $n-1$ 条树枝连接这些苹果，每条树枝的两端都恰好挂有一个苹果，使得整个苹果树成为一个名副其实的树形结构。农夫对每个苹果进行了一番价值估计，第 $i$ 个苹果的初始价值为 $a_i$ ，表示农夫此时摘下它并卖出的净收益，考虑到成本因素， $a_i$ 可能为负。\n\n在整个记录周期中，共发生了 $m$ 件值得记录的事件，所有的事件共分为以下几种类型：\n\n$1\\ u\\ v\\ w$：树上原本连接苹果 $u$ 和苹果 $v$ 的树枝中间结出了一个新的苹果。设原先树上共有 $k$ 个苹果，则此时变为 $k+1$ 个，农夫将新长出的苹果编号为 $k+1$ ，其价值为 $w$ 。原先连接苹果 $u$ 和 $v$ 的树枝也因此分裂成两条，一条连接苹果 $u$ 和 $k+1$ ，另一条连接苹果 $k+1$ 和 $v$；\n\n$2\\ u\\ w$：树上长出了一条新树枝和一个新苹果。设原先树上共有 $k$ 个苹果，则此时变为 $k+1$ 个，农夫将新长出的苹果编号为 $k+1$，其价值为 $w$。新树枝连接苹果 $u$ 和 $k+1$。\n\n$3\\ u\\ v\\ w$：树上一部分苹果的价值发生了变化。树上连接苹果 $u$ 和 $v$ 的一整段枝条（即树形结构上连接 $u$ 和 $v$ 的最短路径，包括 $u$ 和 $v$ 本身）上的所有苹果的价值均增加了 $w$ 。考虑到价值的变化也可能是由于营养不足或病虫害引起的，因此 $w$ 可能为负。\n\n$4\\ u\\ v\\ w$：农夫想在树上进行一次抽样调查来研究自己的可能收益。他定义价值不小于 $w$ 的苹果为“优质苹果”，并选择了树上连接苹果 $u$ 和 $v$ 的一整段枝条（含义同上），想统计一下这段枝条上的苹果中有多少个“优质苹果”。\n\n但由于苹果的数量是在太多了，农夫数不过来，便只好请你来帮忙。注意：由于农夫不能预测未来，因此你帮农夫时必须**强制在线**地回答问题。", "inputFormat": "第 $1$ 行： $2$ 个正整数 $n,m$。\n\n第 $2$ 行： $n$ 个整数 $a_i$。\n\n接下来 $n-1$ 行：每行两个正整数 $u_i,v_i$，依次描述初始时树上的所有树枝。\n\n接下来 $m$ 行，每行 $3$ 或 $4$ 个整数，按照时间顺序描述所有的事件，格式如题目描述中所述。\n\n为了体现强制在线性，设上一次 $4$ 事件的答案是 $lastans$ （最开始时 $lastans=0$），则所有事件中输入的 $u,v,w$ 都需要异或上 $lastans$ 才是真正的 $u,v,w$。", "outputFormat": "对于每个 $4$ 事件输出一行，一个非负整数，表示农夫此次调查的“优质苹果”数量。", "hint": "#### 样例解释 1\n\n对于这组样例，去除强制在线后的数据如下：\n\n```\n5 6\n1 3 3 2 2\n1 2\n1 3\n2 4\n2 5\n4 3 4 2\n3 1 5 1\n4 3 4 2\n1 1 2 5\n2 6 3\n4 4 7 4\n```\n\n#### 数据范围\n\n对于所有数据， $n,m \\leq 2 \\times 10^5$，$|a_i|, |w|\\leq 10^9$，保证任意时刻涉及到的苹果编号均有意义，保证初始的 $n-1$ 条树枝构成树形结构，所有 $1$ 事件保证连接苹果 $u$ 和 $v$ 的树枝在事件发生时存在。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 种苹果", "background": "", "description": "农夫种了一棵苹果树，树上结满了大大小小的苹果。夏天正是果树生长发育的大好时节，树上不断抽出新的枝条、结出新的苹果，已有的苹果也在不断长大。\n\n为了观察和记录苹果的生长状况，以便对未来收获的行情有大致的估计，农夫进行了长时间仔细的观察和研究。在整个记录周期的最开始，树上一共结有 $n$ 个苹果，农夫将其编号为 $1\\sim n$ ，有 $n-1$ 条树枝连接这些苹果，每条树枝的两端都恰好挂有一个苹果，使得整个苹果树成为一个名副其实的树形结构。农夫对每个苹果进行了一番价值估计，第 $i$ 个苹果的初始价值为 $a_i$ ，表示农夫此时摘下它并卖出的净收益，考虑到成本因素， $a_i$ 可能为负。\n\n在整个记录周期中，共发生了 $m$ 件值得记录的事件，所有的事件共分为以下几种类型：\n\n$1\\ u\\ v\\ w$：树上原本连接苹果 $u$ 和苹果 $v$ 的树枝中间结出了一个新的苹果。设原先树上共有 $k$ 个苹果，则此时变为 $k+1$ 个，农夫将新长出的苹果编号为 $k+1$ ，其价值为 $w$ 。原先连接苹果 $u$ 和 $v$ 的树枝也因此分裂成两条，一条连接苹果 $u$ 和 $k+1$ ，另一条连接苹果 $k+1$ 和 $v$；\n\n$2\\ u\\ w$：树上长出了一条新树枝和一个新苹果。设原先树上共有 $k$ 个苹果，则此时变为 $k+1$ 个，农夫将新长出的苹果编号为 $k+1$，其价值为 $w$。新树枝连接苹果 $u$ 和 $k+1$。\n\n$3\\ u\\ v\\ w$：树上一部分苹果的价值发生了变化。树上连接苹果 $u$ 和 $v$ 的一整段枝条（即树形结构上连接 $u$ 和 $v$ 的最短路径，包括 $u$ 和 $v$ 本身）上的所有苹果的价值均增加了 $w$ 。考虑到价值的变化也可能是由于营养不足或病虫害引起的，因此 $w$ 可能为负。\n\n$4\\ u\\ v\\ w$：农夫想在树上进行一次抽样调查来研究自己的可能收益。他定义价值不小于 $w$ 的苹果为“优质苹果”，并选择了树上连接苹果 $u$ 和 $v$ 的一整段枝条（含义同上），想统计一下这段枝条上的苹果中有多少个“优质苹果”。\n\n但由于苹果的数量是在太多了，农夫数不过来，便只好请你来帮忙。注意：由于农夫不能预测未来，因此你帮农夫时必须**强制在线**地回答问题。", "inputFormat": "第 $1$ 行： $2$ 个正整数 $n,m$。\n\n第 $2$ 行： $n$ 个整数 $a_i$。\n\n接下来 $n-1$ 行：每行两个正整数 $u_i,v_i$，依次描述初始时树上的所有树枝。\n\n接下来 $m$ 行，每行 $3$ 或 $4$ 个整数，按照时间顺序描述所有的事件，格式如题目描述中所述。\n\n为了体现强制在线性，设上一次 $4$ 事件的答案是 $lastans$ （最开始时 $lastans=0$），则所有事件中输入的 $u,v,w$ 都需要异或上 $lastans$ 才是真正的 $u,v,w$。", "outputFormat": "对于每个 $4$ 事件输出一行，一个非负整数，表示农夫此次调查的“优质苹果”数量。", "hint": "#### 样例解释 1\n\n对于这组样例，去除强制在线后的数据如下：\n\n```\n5 6\n1 3 3 2 2\n1 2\n1 3\n2 4\n2 5\n4 3 4 2\n3 1 5 1\n4 3 4 2\n1 1 2 5\n2 6 3\n4 4 7 4\n```\n\n#### 数据范围\n\n对于所有数据， $n,m \\leq 2 \\times 10^5$，$|a_i|, |w|\\leq 10^9$，保证任意时刻涉及到的苹果编号均有意义，保证初始的 $n-1$ 条树枝构成树形结构，所有 $1$ 事件保证连接苹果 $u$ 和 $v$ 的树枝在事件发生时存在。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN"}}}
{"pid": "P9137", "type": "P", "difficulty": 5, "samples": [["3\n1 3 3\n", "3\n2 1 2\n"], ["1\n1", "-1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["2023", "Special Judge", "O2优化", "构造", "THUPC"], "title": "[THUPC 2023 初赛] 速战速决", "background": "", "description": "小 I 与小 J 正在玩一个叫做“开火车”，又称作“拖板车”和“小猫钓鱼”的扑克游戏。游戏规则如下，注意其与一般玩法可能有不同：\n\n- 有 $2n$ 张牌，其中对于整数 $1 \\le i \\le n$，牌面为 $i$ 的牌恰好有 $2$ 张。\n- 游戏开始时，小 I 和小 J 各拿其中 $n$ 张牌组成双方的初始手牌。\n- 维护一个公共牌堆（可以将其看作一个栈），初始没有牌。小 I 与小 J 依次行动，小 I 先手。一次行动时，行动方依次进行以下操作：\n  1. 将手牌中的一张牌放在公共牌堆顶；\n  2. 若此时公共牌堆中有两张相同的牌，则这两张相同的牌以及在这两张牌之间的所有牌从公共牌堆移到当前行动方手牌中；\n  3. 若此时当前行动方没有手牌，则当前行动方失败，另一方胜利。\n\n小 J 是扑克萌新，所以会按照以下策略行动：\n\n- 维护一个队列，初始将 $n$ 张手牌按照一定顺序放入队列中；\n- 每次行动时，将队列开头的牌放在公共牌堆顶；\n- 若小 J 放入某张牌后公共牌堆中有两张相同的牌，则按照在公共牌堆中自顶到底的顺序将获得的牌放入队列尾。\n\n小 I 通过偷看得到了小 J 的策略以及队列中牌的顺序。现在小 I 不仅想获胜，还想速战速决，用**最少**的行动次数获胜，但他也是扑克萌新。所以给定小 J 队列中的 $n$ 张牌以及它们的顺序，你需要给出小 I 的策略，使得小 I 能够获胜，同时行动次数最少，或者告诉他这是不可能的。", "inputFormat": "每组数据的第一行一个整数 $n$ 表示牌面的种数。\n\n第二行 $n$ 个整数 $a_1,a_2,\\cdots,a_n$，从队头到队尾的顺序依次描述小 J 队列中的牌。\n\n得到小 J 的 $n$ 张手牌也就得到了小 I 的 $n$ 张手牌，因此不会输入小 I 的手牌。", "outputFormat": "如果小 I 不可能获胜，只需要输出一个整数 `-1`；否则第一行输出一个整数 $s$，表示你给出的策略中小 I 的行动次数。接下来一行 $s$ 个整数，依次描述每次行动时小 I 从手牌中放入公共牌堆的牌的牌面，两个数之间以一个空格分隔。**注意你给出的策略要满足 $s$ 最小。**", "hint": "#### 样例解释 1\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/m1asrjdd.png)\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/x5w65xlc.png)\n\n#### 子任务\n\n对于所有测试数据，$1 \\le n \\le 3 \\times 10^5$，$1 \\le a_1,a_2,\\cdots, a_n \\le n$，且每个整数在序列 $a$ 中至多出现两次。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 速战速决", "background": "", "description": "小 I 与小 J 正在玩一个叫做“开火车”，又称作“拖板车”和“小猫钓鱼”的扑克游戏。游戏规则如下，注意其与一般玩法可能有不同：\n\n- 有 $2n$ 张牌，其中对于整数 $1 \\le i \\le n$，牌面为 $i$ 的牌恰好有 $2$ 张。\n- 游戏开始时，小 I 和小 J 各拿其中 $n$ 张牌组成双方的初始手牌。\n- 维护一个公共牌堆（可以将其看作一个栈），初始没有牌。小 I 与小 J 依次行动，小 I 先手。一次行动时，行动方依次进行以下操作：\n  1. 将手牌中的一张牌放在公共牌堆顶；\n  2. 若此时公共牌堆中有两张相同的牌，则这两张相同的牌以及在这两张牌之间的所有牌从公共牌堆移到当前行动方手牌中；\n  3. 若此时当前行动方没有手牌，则当前行动方失败，另一方胜利。\n\n小 J 是扑克萌新，所以会按照以下策略行动：\n\n- 维护一个队列，初始将 $n$ 张手牌按照一定顺序放入队列中；\n- 每次行动时，将队列开头的牌放在公共牌堆顶；\n- 若小 J 放入某张牌后公共牌堆中有两张相同的牌，则按照在公共牌堆中自顶到底的顺序将获得的牌放入队列尾。\n\n小 I 通过偷看得到了小 J 的策略以及队列中牌的顺序。现在小 I 不仅想获胜，还想速战速决，用**最少**的行动次数获胜，但他也是扑克萌新。所以给定小 J 队列中的 $n$ 张牌以及它们的顺序，你需要给出小 I 的策略，使得小 I 能够获胜，同时行动次数最少，或者告诉他这是不可能的。", "inputFormat": "每组数据的第一行一个整数 $n$ 表示牌面的种数。\n\n第二行 $n$ 个整数 $a_1,a_2,\\cdots,a_n$，从队头到队尾的顺序依次描述小 J 队列中的牌。\n\n得到小 J 的 $n$ 张手牌也就得到了小 I 的 $n$ 张手牌，因此不会输入小 I 的手牌。", "outputFormat": "如果小 I 不可能获胜，只需要输出一个整数 `-1`；否则第一行输出一个整数 $s$，表示你给出的策略中小 I 的行动次数。接下来一行 $s$ 个整数，依次描述每次行动时小 I 从手牌中放入公共牌堆的牌的牌面，两个数之间以一个空格分隔。**注意你给出的策略要满足 $s$ 最小。**", "hint": "#### 样例解释 1\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/m1asrjdd.png)\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/x5w65xlc.png)\n\n#### 子任务\n\n对于所有测试数据，$1 \\le n \\le 3 \\times 10^5$，$1 \\le a_1,a_2,\\cdots, a_n \\le n$，且每个整数在序列 $a$ 中至多出现两次。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN"}}}
{"pid": "P9138", "type": "P", "difficulty": 6, "samples": [["2 4\n1 2", "0.687500000000000000\n"], ["见附件中的 2.in", "见附件中的 2.out"], ["见附件中的 3.in", "见附件中的 3.out"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["动态规划 DP", "博弈论", "倍增", "2023", "Special Judge", "O2优化", "THUPC"], "title": "[THUPC 2023 初赛] 公平合作", "background": "", "description": "在大地的尽头，一座灰白的灯塔矗立在漫长的海岸线上。这一片海域海流复杂、礁石嶙峋，却又是不少航线的必经之路。若没有如此高耸而明亮的灯塔为过路的船只照亮航路，或许会有更多不幸的生命葬身海底。为了看管好这一座海上明灯，一批训练有素的守望人轮流值守于此。日复一日的工作枯燥乏味却又不能有丝毫闪失，紧绷的神经直到下一班守望人到来才得以放松。\n\n在电力普及之前，灯塔通常使用煤油灯为过往的水手指引前行的方向。每次为这座灯塔添加燃油时，需要两位守望人各自搬运一个容积为 $L$ 的油桶；而每次轮到 Y 和 S 所在的班组照料这座灯塔时，总是由 Y 和 S 负责为灯塔加油。将煤油搬运至灯室时，如果不装满油桶，对灯塔的正常运转也没有太大影响，无非是需要多来回搬运几趟。但是，如果两位守望人都想着偷懒，问题恐怕就不只是多几趟那么简单。Y 和 S 想到了一个好办法：互相为对方的油桶装油。\n\n灯塔里有 $N$ 个用于将储存的煤油转移到油桶中的容器，其中第 $i$ 个容器的容积为 $a_i$。Y 和 S 先想办法决定由谁先装油。两人先后装油；轮到其中一位守望人装油时，这位守望人每次从所有容器中等概率地随机选出一个容器，将其装满油，并全部倒入对方的油桶中。两位守望人都可以在操作任意多次（可以是 0 次）后结束装油，但后手必须等先手结束后才能开始装油。Y 和 S 先后装完煤油后，两人会比一下谁把对方的油桶装得更满，再各自把自己的油桶搬运到灯室。但是，如果有谁某次选出一个容器后，把对方的油桶装满了，但容器里还有没倒出的煤油，那么这位倒霉的守望人就必须把两个油桶都独自搬到灯室——这也算是为单调的生活平添了几分乐趣。显然，如果先手某次随机选中的容器会使得油桶溢出，那么后手可以往先手的油桶里面装任意量的煤油，然后幸灾乐祸；因此我们约定：当先手溢出时，必定由先手搬两个油桶。\n\n现在只剩下了一个问题：当 Y 和 S 都采取最优策略，使得对方搬的煤油尽可能地比自己多的时候，先手搬的煤油不多于后手的概率是多大？", "inputFormat": "输入的第一行包括两个正整数 $N$ 和 $L$，分别表示转移用的容器数量和油桶的容积。\n\n输入的第二行包括 $N$ 个正整数 $a_1, \\cdots, a_N$，分别表示每个转移用的容器的容积。", "outputFormat": "输出一个实数，表示先手搬的煤油不多于后手的概率。当你的输出与标准输出的绝对误差不超过 $10^{-6}$ 时，我们认为你的输出是正确的。", "hint": "#### 样例解释 1\n\n可以证明，此时先手的策略一定是装满对方的油桶，且装满时必胜。经过若干次随机抽取后，能恰好将对方的油桶装满的概率为：\n\n$$\n\\left(\\frac{1}{2}\\right)^2 + \\binom{3}{1}\\left(\\frac{1}{2}\\right)^3 + \\left(\\frac{1}{2}\\right)^4 = \\frac{11}{16}=0.6875\n$$\n\n#### 数据范围\n\n对于 $100\\%$ 的数据，保证 $1\\le N\\le 2\\times 10^3$，$1\\le L\\le 10^9$，$1\\le a_i\\le 2\\times 10^3$。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 公平合作", "background": "", "description": "在大地的尽头，一座灰白的灯塔矗立在漫长的海岸线上。这一片海域海流复杂、礁石嶙峋，却又是不少航线的必经之路。若没有如此高耸而明亮的灯塔为过路的船只照亮航路，或许会有更多不幸的生命葬身海底。为了看管好这一座海上明灯，一批训练有素的守望人轮流值守于此。日复一日的工作枯燥乏味却又不能有丝毫闪失，紧绷的神经直到下一班守望人到来才得以放松。\n\n在电力普及之前，灯塔通常使用煤油灯为过往的水手指引前行的方向。每次为这座灯塔添加燃油时，需要两位守望人各自搬运一个容积为 $L$ 的油桶；而每次轮到 Y 和 S 所在的班组照料这座灯塔时，总是由 Y 和 S 负责为灯塔加油。将煤油搬运至灯室时，如果不装满油桶，对灯塔的正常运转也没有太大影响，无非是需要多来回搬运几趟。但是，如果两位守望人都想着偷懒，问题恐怕就不只是多几趟那么简单。Y 和 S 想到了一个好办法：互相为对方的油桶装油。\n\n灯塔里有 $N$ 个用于将储存的煤油转移到油桶中的容器，其中第 $i$ 个容器的容积为 $a_i$。Y 和 S 先想办法决定由谁先装油。两人先后装油；轮到其中一位守望人装油时，这位守望人每次从所有容器中等概率地随机选出一个容器，将其装满油，并全部倒入对方的油桶中。两位守望人都可以在操作任意多次（可以是 0 次）后结束装油，但后手必须等先手结束后才能开始装油。Y 和 S 先后装完煤油后，两人会比一下谁把对方的油桶装得更满，再各自把自己的油桶搬运到灯室。但是，如果有谁某次选出一个容器后，把对方的油桶装满了，但容器里还有没倒出的煤油，那么这位倒霉的守望人就必须把两个油桶都独自搬到灯室——这也算是为单调的生活平添了几分乐趣。显然，如果先手某次随机选中的容器会使得油桶溢出，那么后手可以往先手的油桶里面装任意量的煤油，然后幸灾乐祸；因此我们约定：当先手溢出时，必定由先手搬两个油桶。\n\n现在只剩下了一个问题：当 Y 和 S 都采取最优策略，使得对方搬的煤油尽可能地比自己多的时候，先手搬的煤油不多于后手的概率是多大？", "inputFormat": "输入的第一行包括两个正整数 $N$ 和 $L$，分别表示转移用的容器数量和油桶的容积。\n\n输入的第二行包括 $N$ 个正整数 $a_1, \\cdots, a_N$，分别表示每个转移用的容器的容积。", "outputFormat": "输出一个实数，表示先手搬的煤油不多于后手的概率。当你的输出与标准输出的绝对误差不超过 $10^{-6}$ 时，我们认为你的输出是正确的。", "hint": "#### 样例解释 1\n\n可以证明，此时先手的策略一定是装满对方的油桶，且装满时必胜。经过若干次随机抽取后，能恰好将对方的油桶装满的概率为：\n\n$$\n\\left(\\frac{1}{2}\\right)^2 + \\binom{3}{1}\\left(\\frac{1}{2}\\right)^3 + \\left(\\frac{1}{2}\\right)^4 = \\frac{11}{16}=0.6875\n$$\n\n#### 数据范围\n\n对于 $100\\%$ 的数据，保证 $1\\le N\\le 2\\times 10^3$，$1\\le L\\le 10^9$，$1\\le a_i\\le 2\\times 10^3$。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN"}}}
{"pid": "P9139", "type": "P", "difficulty": 7, "samples": [["2\n1 1 2 1 2 2 1 2", "Yes\n10000111\n"]], "limits": {"time": [4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000], "memory": [1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576]}, "tags": ["2023", "Special Judge", "O2优化", "2-SAT", "可持久化线段树", "构造", "THUPC"], "title": "[THUPC 2023 初赛] 喵了个喵 II", "background": "本来这题的题面和《喵了个喵》有关的。但是听说有人嫌题面长，就少说点好了。", "description": "给定一个长为 $4n$ 的序列，其中 $1\\sim n$ 各出现 $4$ 次。问是否能够将其划分为两个相等的子序列。", "inputFormat": "第一行一个正整数 $n$。\n\n第二行 $4n$ 个正整数，表示序列。保证 $1\\sim n$ 各出现 $4$ 次。", "outputFormat": "如果不能划分为两个相等的子序列，输出一行 `No`。\n\n否则第一行输出 `Yes`。第二行输出一个长为 $4n$ 的 `01` 串。其中第 $i$ 位表示原序列的第 $i$ 个数被划分到第几个子序列。你需要保证你划分出来的两个子序列完全相等。", "hint": "#### 样例解释 1\n\n两个子序列均为 $(1,2,1,2)$。\n\n#### 子任务\n\n保证 $1\\le n \\le 5\\times10^4$。\n\n保证序列中 $1\\sim n$ 各出现 $4$ 次。\n\n#### 评分方式\n\n你的输出的第一行需要与标准答案一致。若为 `Yes`，输出任意一种合法的划分均算正确。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。\n\nBy E.Space：由于考场上数据太弱，本题数据已加强。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 喵了个喵 II", "background": "本来这题的题面和《喵了个喵》有关的。但是听说有人嫌题面长，就少说点好了。", "description": "给定一个长为 $4n$ 的序列，其中 $1\\sim n$ 各出现 $4$ 次。问是否能够将其划分为两个相等的子序列。", "inputFormat": "第一行一个正整数 $n$。\n\n第二行 $4n$ 个正整数，表示序列。保证 $1\\sim n$ 各出现 $4$ 次。", "outputFormat": "如果不能划分为两个相等的子序列，输出一行 `No`。\n\n否则第一行输出 `Yes`。第二行输出一个长为 $4n$ 的 `01` 串。其中第 $i$ 位表示原序列的第 $i$ 个数被划分到第几个子序列。你需要保证你划分出来的两个子序列完全相等。", "hint": "#### 样例解释 1\n\n两个子序列均为 $(1,2,1,2)$。\n\n#### 子任务\n\n保证 $1\\le n \\le 5\\times10^4$。\n\n保证序列中 $1\\sim n$ 各出现 $4$ 次。\n\n#### 评分方式\n\n你的输出的第一行需要与标准答案一致。若为 `Yes`，输出任意一种合法的划分均算正确。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。\n\nBy E.Space：由于考场上数据太弱，本题数据已加强。", "locale": "zh-CN"}}}
{"pid": "P9140", "type": "P", "difficulty": 6, "samples": [["2 2\n6 10\n8 15\n100000000001\n100000000002\n", "-1\n187500000000\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["贪心", "2023", "O2优化", "最短路", "THUPC"], "title": "[THUPC 2023 初赛] 背包", "background": "", "description": "本题中，你需要解决完全背包问题。\n\n有 $n$ 种物品，第 $i$ 种物品单个体积为 $v_i$、价值为 $c_i$。\n\n$q$ 次询问，每次给出背包的容积 $V$，你需要选择若干个物品，每种物品可以选择任意多个（也可以不选），在选出物品的体积的和**恰好**为 $V$ 的前提下最大化选出物品的价值的和。你需要给出这个最大的价值和，或报告不存在体积和恰好为 $V$ 的方案。\n\n为了体现你解决 NP-Hard 问题的能力，$V$ 会远大于 $v_i$，详见数据范围部分。", "inputFormat": "第一行两个整数 $n,q$，表示物品种数和询问次数。\n\n接下来 $n$ 行每行两个整数 $v_i,c_i$ 描述一种物品。\n\n接下来 $q$ 行每行一个整数 $V$ 描述一次询问中背包的体积。", "outputFormat": "对于每组询问输出一行一个整数。若不存在体积和恰好为 $V$ 的方案，输出 `-1`；否则输出最大的选出物品的价值和。", "hint": "#### 样例解释 1\n\n第二组询问的最优方案为：选择 $3$ 个物品 $1$ 和 $12499999998$ 个物品 $2$。\n\n#### 子任务\n\n对于所有测试数据，$1 \\le n \\le 50, 1 \\le v_i \\le 10^5, 1 \\le c_i \\le 10^6, 1 \\le q \\le 10^5, 10^{11} \\le V \\le 10^{12}$。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 背包", "background": "", "description": "本题中，你需要解决完全背包问题。\n\n有 $n$ 种物品，第 $i$ 种物品单个体积为 $v_i$、价值为 $c_i$。\n\n$q$ 次询问，每次给出背包的容积 $V$，你需要选择若干个物品，每种物品可以选择任意多个（也可以不选），在选出物品的体积的和**恰好**为 $V$ 的前提下最大化选出物品的价值的和。你需要给出这个最大的价值和，或报告不存在体积和恰好为 $V$ 的方案。\n\n为了体现你解决 NP-Hard 问题的能力，$V$ 会远大于 $v_i$，详见数据范围部分。", "inputFormat": "第一行两个整数 $n,q$，表示物品种数和询问次数。\n\n接下来 $n$ 行每行两个整数 $v_i,c_i$ 描述一种物品。\n\n接下来 $q$ 行每行一个整数 $V$ 描述一次询问中背包的体积。", "outputFormat": "对于每组询问输出一行一个整数。若不存在体积和恰好为 $V$ 的方案，输出 `-1`；否则输出最大的选出物品的价值和。", "hint": "#### 样例解释 1\n\n第二组询问的最优方案为：选择 $3$ 个物品 $1$ 和 $12499999998$ 个物品 $2$。\n\n#### 子任务\n\n对于所有测试数据，$1 \\le n \\le 50, 1 \\le v_i \\le 10^5, 1 \\le c_i \\le 10^6, 1 \\le q \\le 10^5, 10^{11} \\le V \\le 10^{12}$。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN"}}}
{"pid": "P9141", "type": "P", "difficulty": 7, "samples": [["1 1\n0 0 0\n1 0 0 0 0 1\n1 1 1 4 1 1\n1 3 1 1 1 1\n8 0 0\n-1 0 0 0 0 1\n1 1 1 4 1 1\n1 3 1 1 1 1\n", "0 0 1\n2 1 2\n"], ["1 4\n0 0 0\n1 0 0 0 0 1\n1 1 1 3 1 1\n1 15 3 2 1 10\n60 0 0\n-1 0 0 0 0 1\n1 1 1 3 1 1\n1 15 3 2 1 10\n", "0 0 0\n0 0 0\n0 0 0\n0 2 0\n1 1 2\n2 1 1\n"]], "limits": {"time": [5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000], "memory": [1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576]}, "tags": ["模拟", "计算几何", "2023", "O2优化", "THUPC"], "title": "[THUPC 2023 初赛] 乱西星上的空战", "background": "众所周知，在乱西星的现代战争中，制空权是很重要的。为此，人们发展出了无人机技术——遗憾的是，由于乱西星的算法水平和各种意义上的通讯水平实在太落后了，所以这些无人机只能采用各自独立的傻瓜式战斗模式，这些模式不含任何随机因素，因此一场傻瓜式无人机空战总是几乎能在开始前就被预测到结果。\n\n总而言之，乱西星上正在相互战争的 |\\\\| 国和 () 国的傻瓜式无人机战斗机编队在其边境交界处的空域遭遇了，现在两国军方希望你能预测这一空战的结果。", "description": "### 空域与时刻\n\n由于乱西星的神秘物理法则，乱西星的时间和空间并不是连续的；若认为遭遇战开始的时刻是第 $1$ 时刻，那么对于任意的第 $k\\in \\N$ 个时刻，在这一时刻开始和结束时，一个物体（无人机或导弹）只能在形如 $(x,y,z)\\in\\mathbb Z^3$ 的位置（即空域内的整点）上。\n\n### 无人机\n\n由于空域相比无人机要大得多，因此我们可以将无人机视为一个质点（尽管他们实际上长得和地球上的一般意义上的飞机十分相似）。\n\n#### 飞行状态\n\n在每个时刻，一架无人机的飞行状态可以用以下三组参数描述：\n\n1. 当前时刻所在的坐标 $\\vec p=(x,y,z)\\in\\mathbb Z^3$；\n2. 当前时刻的飞行方向向量 $\\vec{d},\\|\\vec d\\|=1$；\n   - 其中， $\\|\\vec{v}\\|$ 表示向量 $\\vec v$ 的长度：设 $\\vec{v}=(v_x,v_y,v_z)$，则 $\\|\\vec{v}\\|=\\sqrt{v_x^2+v_y^2+v_z^2}$。\n   - 你可以简单地将 $\\vec d$ 理解为机头指向的方向。\n3. 当前时刻的无人机升力线方向 $\\vec u,\\|\\vec u\\|=1,\\vec u\\bot \\vec d$；\n   - 你可以简单的将 $\\vec u$ 理解为飞机所在平面的、从机腹指向机背的单位法向量。\n   - 此时，$\\vec d$ 和 $\\vec u$ 可以唯一确定一个“左手向” $\\vec l=\\vec u\\times \\vec d$。\n\n#### 飞行性能\n\n不严格地讲，一般而言，一架飞机通常有三个操作轴，即俯仰、滚转和偏航：俯(负杆)和仰(正杆)分别对应飞机机头向下和向上（即保持 $\\vec l$ 不变）；滚转即飞机以飞行方向为中轴线旋转（即保持 $\\vec d$ 不变）；偏航则为飞机机头向左或者向右（即保持 $\\vec u$ 不变）。由于无人机的特殊设计，其**没有偏航**轴，只能进行俯仰和滚转——容易看出，即使仅进行俯仰和滚转，一架无人机也能随意地改变 $\\vec d$ 和 $\\vec u$ （在保持 $\\|\\vec u\\|=\\|\\vec d\\|=1,\\vec u\\bot \\vec d$ 的前提下）。\n\n以上的俯仰(正杆或负杆)、滚转操作，以及直线飞行，及其复合统称“机动”。\n\n由于无人机型号差异，一架无人机的飞行性能可以用以下三组参数描述（为方便起见，在本节中，对进行一次机动前的飞行状态对应参数为 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$，进行一次机动后的飞行状态对应的参数为 $\\vec p'=(x',y',z'),\\vec d',\\vec u',\\vec l'$）：\n\n1. 正杆率 $\\theta_u\\in(\\dfrac\\pi4,\\dfrac\\pi2)$ 和负杆率 $\\theta_d\\in(\\dfrac\\pi4,\\dfrac \\pi2)$；\n   - 若无人机**仅进行正杆**机动，则必须有 $\\vec p=\\vec p',\\vec l=\\vec l',\\vec u\\cdot \\vec d'\\ge 0$；此时，进行一次这样的机动花费的时间是 $\\dfrac{\\angle(\\vec d,\\vec d')}{\\theta_u}$。\n   - 若无人机**仅进行负杆**机动，则必须有 $\\vec p=\\vec p',\\vec l=\\vec l',\\vec u\\cdot \\vec d'\\le 0$；此时，进行一次这样的机动花费的时间是 $\\dfrac{\\angle(\\vec d,\\vec d')}{\\theta_d}$。\n2. 滚转率 $\\gamma\\in(\\dfrac\\pi4,\\dfrac \\pi 2)$；\n   - 若无人机**仅进行滚转**机动，则必须有 $\\vec p=\\vec p',\\vec d=\\vec d'$；此时，进行一次这样的机动花费的时间是 $\\dfrac{\\angle(\\vec u,\\vec u')}{\\gamma}$。\n3. 飞行极速 $v_{m}>0$；\n   - 若无人机**仅进行直线飞行**，则必须有 $\\vec d=\\vec d',\\vec u=\\vec u'$；此时，花费的时间是 $\\dfrac{\\|\\vec p'-\\vec p\\|}{v_m}$。\n\n#### 合法位移\n\n在每个时刻，若一架无人机可以从 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$ 这一飞行状态，严格按照**滚转**、**俯仰**(正杆或负杆)和**直线飞行**的顺序进行机动，使飞行状态变为 $\\vec p'=(x',y',z')\\not=\\vec p,\\vec d',\\vec u',\\vec l'$，满足 $\\vec d'//(\\vec p'-\\vec p)$，并且各机动花费的时间之和不超过 $1$，则称这是一次(无人机的)合法的综合机动。\n\n如果一架无人机可以从 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$ 通过一次合法的综合机动，使飞行状态变为 $\\vec p'=(x',y',z')\\not=\\vec p,\\vec d',\\vec u',\\vec l'$，并且在所有使飞行状态变为 $\\vec p''=\\vec p',\\vec d'',\\vec u'',\\vec l''$ 的合法综合机动中，总用时是最短的，则称之为一次（无人机的）合法位移（或称该位移合法）。此时，无人机会沿直线从 $\\vec p$ 移动到 $\\vec p'$。如无特殊指明，下文中“位移”均默认(应当为)合法位移。\n\n#### 眼镜蛇机动\n\n在每个时刻，无论无人机飞行性能如何，无人机总是可以通过眼镜蛇机动，从 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$ 这一飞行状态，变为 $\\vec p'=\\vec p,\\vec d'=\\vec u,\\vec u'=-\\vec d,\\vec l'=\\vec l$ 这一飞行状态。注意，这种机动不被视为合法机动。\n\n#### 其它参数\n\n除此之外，一架无人机还具有以下参数：\n\n1. 无人机编号（简称“编号”）；\n   - 保证任意两架无人机编号不同。\n2. 所在阵营（简称“阵营”）；\n   - 所在阵营必须是|\\\\| 国或者是 () 国中之一，并且双方互称敌方阵营。\n\n#### 坠毁\n\n一架无人机坠毁，当且仅当其符合下列条件之一：\n\n1. 在某激活的导弹位移过程中，与该导弹的距离不大于导弹的空爆距离（详见下文）。\n2. 在某导弹位移结束后，与该导弹位置重合（从而导弹直接命中无人机导致坠毁，下同）。\n3. 在无人机位移过程中，存在至少一枚激活的导弹，与其距离不大于该导弹的空爆距离。\n4. 在无人机位移结束后，存在至少一枚导弹所在位置与其位置重合。\n5. 在无人机位移结束后，存在另一架无人机与其坐标相同（从而发生碰撞导致双双坠毁）。\n\n无人机坠毁后将立即消失，此后不会发射导弹，也不会导致其它无人机坠毁。但无人机已经发射的导弹不会立刻消失或爆炸。\n\n此时也称无人机被摧毁。\n\n### 空空红外制导导弹\n\n类似的，一枚空空红外制导导弹（下文简称“导弹”）也可视为一质点，并且同样可以描述其飞行状态和飞行性能。\n\n#### 飞行状态\n\n由于导弹无所谓上下左右，因此仅需要以下两组参数以描述一个导弹的飞行状态：\n\n1. 当前时刻所在的坐标 $\\vec p=(x,y,z)\\in\\Z^3$；\n2. 当前时刻的飞行方向向量 $\\vec{d},\\|\\vec d\\|=1$；\n   - 你可以简单地将 $\\vec d$ 理解为导弹弹头指向的方向。\n\n#### 飞行性能\n\n同样由于一枚导弹无所谓上下左右，因此其不存在俯仰、滚转和偏航轴，其向各个方向改变 $\\vec d$ 的性能是相同的，此时统称仅改变 $\\vec d$ 的操作为 \"偏航\"。其与直线飞行及复合统称“机动”。\n\n因此一枚导弹的飞行性能可以用以下两组参数描述（为方便起见，在本节中，对进行一次机动前的飞行状态对应参数为 $\\vec p=(x,y,z),\\vec d$，进行一次机动后的飞行状态对应的参数为 $\\vec p'=(x',y',z'),\\vec d'$）：\n\n1. 偏航率 $\\theta_r\\in(\\dfrac\\pi4,\\dfrac\\pi2)$；\n   - 若导弹**仅进行偏航**机动，则必须有 $\\vec p=\\vec p'$；此时，进行一次这样的机动花费的时间是 $\\dfrac{\\angle(\\vec d,\\vec d')}{\\theta_r}$；\n2. 飞行极速 $v_m>0$；\n   - 若导弹**仅进行直线飞行**，则必须有 $\\vec d=\\vec d'$；此时，花费的时间是 $\\dfrac{\\|\\vec p'-\\vec p\\|}{v_m}$。\n\n#### 合法位移\n\n在每个时刻，若一枚导弹可以从 $\\vec p=(x,y,z),\\vec d$ 这一飞行状态，严格按照**偏航**和**直线飞行**的顺序进行机动，使飞行状态变为 $\\vec p'=(x',y',z')\\not=\\vec p,\\vec d'$，满足 $\\vec d//(\\vec p'-\\vec p)$，并且各机动花费的时间之和不超过 $1$，则称这是一次(导弹的)合法位移（或称该位移合法）。此时，导弹会沿直线从 $\\vec p$ 移动到 $\\vec p'$。如无特殊指明，下文中“位移”均（应当）默认为合法位移。\n\n#### 其它参数\n\n除此之外，一枚导弹还具有以下参数：\n\n1. 保险距离 $d_s>0$ 和激活状态；\n   - 导弹被发射后立即处于未激活状态。\n   - 每个时刻结束时，若导弹处于未激活状态，并且发射该导弹的无人机已坠毁，或者与发射该导弹的无人机的距离大于保险距离 $d_s$ 时，进入激活状态。此后将保持激活状态，并称该导弹被激活，或称其为一枚激活的导弹。\n2. 空爆距离 $d_p>0$；\n   - 每次导弹位移过程中，当一枚激活的导弹与任一无人机（包括发射该导弹的无人机）距离不大于 $d_p$ 时，该导弹会进入可空爆状态（详见下文“可空爆”）。\n   - 每次无人机位移过程中，若存在一无人机与一枚激活的导弹距离不大于 $d_p$ 时，该导弹也会进入可空爆状态。\n3. 最大锁定角 $\\beta_s\\in(\\dfrac\\pi4,\\dfrac\\pi2)$；\n   - 任意时刻，一枚飞行状态为 $\\vec p=(x,y,z),\\vec d$、最大锁定角的导弹能锁定到 $\\vec p'$ 处的无人机，当且仅当 $\\vec d\\cdot(\\vec p'-\\vec p)>0$，并且 $\\angle(\\vec d,\\vec p'-\\vec p)\\le \\beta_s$。\n   - 此时称该无人机能被该导弹锁定，或称其在导弹的锁定范围内。\n   - 称 $\\angle(\\vec d,\\vec p'-\\vec p)$ 为锁定角。\n4. 制导时长 $t_z>0$；\n   - 若导弹在第 $k$ 个时刻被发射，则到第 $k+t_z$ 个时刻结束时，若导弹仍未爆炸，则导弹会立刻消失（见“爆炸、消失与可空爆”）。此时称导弹超过制导时长。\n\n#### 爆炸、消失与可空爆\n\n一枚导弹在符合下列全部条件时，会立刻爆炸并消失：\n\n1. 在导弹位移开始前，导弹处于激活状态；\n\n2. 符合以下条件之一：\n   \n   1. 在该导弹位移过程中，存在一架位于 $\\vec q$ 的无人机，使 $\\min_{\\lambda\\in[0,1]}\\|\\lambda \\vec p+(1-\\lambda)\\vec p'-\\vec q\\|\\le d_p$，其中  $\\vec p,\\vec p'$ 为导弹本次位移的起点和终点。\n      \n      - 此时，所有这样的无人机都会被该导弹摧毁。同时，一架无人机可能同时被若干枚导弹摧毁。\n   \n   2. 在无人机位移过程中，存在一架无人机，记其从位置 $\\vec q$ 位移到 $\\vec q'$ ，满足 $\\min_{\\lambda\\in[0,1]}\\|\\lambda \\vec q+(1-\\lambda)\\vec q'-\\vec p\\|\\le d_p$，其中 $\\vec p$ 为导弹此时的位置。\n      \n      - 此时，所有这样的无人机都会被该导弹摧毁。同时，该导弹也可能同时摧毁若干这样的无人机。\n\n此时，称该导弹可空爆，或该导弹进入可空爆状态。\n\n一枚导弹在符合下列条件之一时，不会发生爆炸，但是会在当前时刻结束时消失：\n\n1. 导弹脱锁（见下文“导弹脱锁”），并且在当前时刻开始时已被激活；\n\n2. 导弹超过制导时长；\n\n3. 导弹未激活，并且导弹位移结束后与一无人机位置重合；\n   \n   - 此时，该无人机会被这枚导弹摧毁。同时，一架无人机可能同时被若干枚导弹摧毁。\n\n4. 导弹未激活，无人机位移结束后，该导弹与一无人机位置重合。\n   \n   - 此时，该无人机会被这枚导弹摧毁。同时，一枚导弹可能同时摧毁若干这样的无人机。\n\n### 无人机视野、雷达搜索与导弹锁定\n\n#### 无人机视野\n\n任意时刻，一架飞行状态为 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$ 的无人机能够发现一架位于 $\\vec p'=(x',y',z')$ 的无人机，当且仅当 $\\vec d\\cdot(\\vec p'-\\vec p)> 0$；此时称 $\\vec p'$ 处的无人机在 $\\vec p$ 处无人机的视野内。\n\n#### 无人机机载雷达搜索范围\n\n一架无人机的机载雷达（下文简称“雷达”）的扫描范围可以用以下两个参数描述：\n\n1. 水平扫描范围 $L_x\\in\\N^+$ 和垂直扫描范围 $H_y\\in\\N^+$；\n   - 任意时刻，一架飞行状态为 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$ 、雷达扫描范围为 $L_x,H_y$ 的无人机的能够扫描到一架位于 $\\vec p'$ 的无人机，当且仅当，$\\vec d\\cdot(\\vec p'-\\vec p)>0$ 并且 $\\exist x,y,s.t.\\ |x|\\le L_x,|y|\\le H_y$ 且 $[\\vec p'-(\\vec p+x\\vec l+y\\vec u)]//\\vec d$。\n   - 即若以 $\\vec p$ 为原点、以 $\\vec l$ 和 $\\vec u$ 为 $X,Y$ 轴建一平面 $\\alpha=\\alpha(\\vec p;\\vec l,\\vec u)$，则  $\\vec p'$ 在这一平面上的投影 $\\vec r=P(\\vec p';\\alpha)$ 应当落在 $[-L_x,L_x]\\times [-H_y,H_y]$ 中。\n   - 此时称 $\\vec p'$ 处的无人机在 $\\vec p$ 处无人机雷达扫描范围内。\n\n#### 导弹脱锁\n\n当无人机位移结束后，若一枚导弹选定的目标已坠毁，或其不能被该导弹锁定，则称该导弹脱锁，或处于脱锁状态。\n\n此后将一直保持脱锁状态，无论是否此前选定的无人机是否重新可以被导弹锁定。\n\n### 无人机选定目标策略\n\n任意时刻，无人机（简称\"本机\"，下同）按下述策略选择目标无人机。\n\n1. 若本机视野内无敌方阵营无人机（简称“敌机”，下同），则本机无选定目标；\n2. 否则，若上一时刻本机选择的无人机仍位于本机视野内，则本机仍选定该目标；\n3. 否则，若存在至少一架敌机处于本机雷达扫描范围内，则选取其中与本机距离最近的；若与本机距离最近的敌机不唯一，则选取编号最小的。\n4. 否则，对视野内的处于 $\\vec p'$ 的敌机，记 $\\alpha=\\alpha(\\vec p;\\vec l,\\vec u),\\vec r=P(\\vec p';\\alpha)=(r_x,r_y)$，则选取 $\\min\\{|r_x-L_x|,|r_x+L_x|\\}+\\min\\{|r_y-H_y|,|r_y+H_y|\\}$ 最小的。若有多个最小值，则同样选择编号最小的。\n\n### 飞行策略\n\n#### 无人机飞行策略\n\n设无人机飞行状态是 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$，其飞行极速为 $v_m$，机载雷达扫描范围为 $L_x,H_y$。\n\n1. 若无人机有位于 $\\vec p'$ 的选定目标：\n   1. 若无人机能够合法地位移到某个位置，使敌机现在的位置 $\\vec p'$ 仍处于本机的视野内，则无人机会合法地移动到飞行状态 $\\vec q=(x_q,y_q,z_q),\\vec d_q,\\vec u_q,\\vec l_q$，使敌机现在的位置 $\\vec p'$ 仍处于本机视野内，且 $\\|\\vec p'-\\vec q\\|$ 最小。\n      1. 若有多个这样的位置，记 $\\alpha_q=\\alpha(\\vec q;\\vec l_q,\\vec u_q),\\vec r_q=P(\\vec p';\\alpha_q)=(r_{qx},r_{qy})$，则优先选取使 $\\vec r_q=(r_{qx},r_{qy})\\in[-L_x,L_x]\\times [-H_y,H_y]$ 的位置；\n         1. 若仍有多个这样的位置，则选取使 $\\|\\vec r_q\\|=\\sqrt{r_{qx}^2+r_{qy}^2}$ 最小的；\n         2. 若仍有多个这样的位置，则选取 $\\vec q$ 字典序最小的。\n      2. 若不存在这样的 $\\vec r_q$，则选取使 $\\min\\{|r_{qx}-L_x|,|r_{qx}+L_x|\\}+\\min\\{|r_{qy}-H_y|,|r_{qy}+H_y|\\}$ 最小的；\n         1. 若仍有多个这样的位置，则选取 $\\vec q$ 字典序最小的。\n   2. 否则，无人机会合法地移动到某个位置 $\\vec q$，使 $\\|\\vec q-\\vec p-v_m\\vec d\\|$ 最小；\n      1. 若有多个这样的位置，则选取 $\\vec q$ 字典序最小的。\n2. 否则，无人机通过眼镜蛇机动，将飞行状态变为 $\\vec p=(x,y,z),\\vec u,-\\vec d,\\vec l$。\n\n保证在上述1.的情况下，无人机总能合法地移动到某个位置。\n\n#### 导弹飞行策略\n\n设导弹当前时刻飞行状态 $\\vec p,\\vec d$，其选定的敌机飞行状态为 $\\vec p',\\vec d',\\vec u',\\vec l'$；\n\n若上一时刻结束时，导弹未脱锁，则记 $\\vec q'$ 为敌机根据其飞行策略，下一时刻会移动到的位置。\n\n若导弹能合法位移到 $\\vec q'$，则导弹会直接位移到 $\\vec q'$。\n\n否则，导弹会合法地位移到能使敌机位移后的位置 $\\vec q'$ 处于锁定范围内的位置 $\\vec q$ ，且 $\\|\\vec q-\\vec q'\\|$ 最小。\n\n1. 若有多个这样的 $\\vec q$，则选取位移后锁定角最小的；\n2. 若仍有多种可能，则选取 $\\vec q$ 字典序最小的。\n\n若不存在这样的位置，或者上个时刻结束时，导弹已经脱锁，则导弹会合法地位移到某个位置 $\\vec q$，使 $\\|\\vec q-\\vec p-v_m\\vec d\\|$ 最小。\n\n保证导弹总能合法地移动到某个位置。\n\n### 无人机发射导弹规则\n\n一飞行状态为 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$ 的无人机（简称\"本机\"）向**被本机选定**的、处于 $\\vec p'$ 的目标无人机（简称“敌机”）发射导弹的规则为：\n\n在每个时刻开始时，若选定的敌机已处于本机雷达扫描范围内，且当前不存在由本机发射且未爆炸（或消失）的导弹，则向敌机发射一初始飞行状态为 $\\vec p,\\vec d=\\dfrac{\\vec p'-\\vec p}{\\|\\vec p'-\\vec p\\|}$ 的未激活的导弹，该导弹选定敌机。\n\n### 同一时刻内各事件发生顺序\n\n1. 所有无人机选定目标，并确定当前时刻内的飞行策略；\n2. 所有能发射导弹的无人机发射导弹；\n3. 所有导弹确定飞行策略并位移，该过程中部分无人机可能被摧毁；\n4. 所有可空爆的导弹爆炸并消失；\n5. 所有无人机按 1. 中确定的飞行策略位移，该过程中部分无人机可能被摧毁；\n6. 所有可空爆的导弹爆炸并消失；\n7. 所有位置相同的无人机发生碰撞并坠毁。\n8. 所有超过制导时长和脱锁且已激活的导弹消失。\n9. 所有可激活的导弹被激活。\n\n### 任务\n\n给定空域开始时（即第 $1$ 时刻开始时），各无人机的飞行性能与状态、导弹的飞行性能，假定这场空战会持续 $T$ 个时刻，双方指挥官希望你能按时间顺序依次给出每个时刻发生的所有重要事件。", "inputFormat": "第一行两个正整数 $n,T$ ，表示共有 $2n$ 架无人机，模拟前 $T$ 个时刻。其中，前 $n$ 架阵营是 |\\\\| 国，后 $n$ 架阵营是 () 国。\n\n接下来有 $2n$ 组数据，每一组包含若干行，其中第 $i$ 组描述了编号为 $i$ 的无人机。\n\n在每组数据中：\n\n第一行三个整数表示 $\\vec p\\in\\mathbb Z^3$；保证所有的 $\\vec p$ 两两不同，且坐标的绝对值不超过 $100$。\n\n第二行六个整数依次表示无人机的 $\\vec d,\\vec u$，保证 $\\vec d,\\vec u\\in S_v$；\n\n- 其中， $S_v=\\{(1,0,0),(-1,0,0),(0,1,0),(0,-1,0),(0,0,1),(0,0,-1)\\}$；\n\n第三行六个实数依次表示无人机的 $\\theta_u,\\theta_d,\\gamma,v_m,L_x,H_y$；\n\n第四行五个实数和一个正整数依次表示导弹的 $\\theta_r,v_m,d_s,d_p,\\beta_s,t_z$。", "outputFormat": "输出 $T$ 组数据，第 $i$ 组数据表示第 $i$ 个时刻发生的重要事件。\n\n在每组数据中：\n\n第一行三个非负整数 $p_1,p_2,p_3$ ，表示在这个时刻的导弹位移过程中被摧毁的无人机数量、在这个时刻的无人机位移过程中被摧毁的无人机数量、这个时刻结束时，有多少组无人机因位置相同而两两碰撞坠毁。\n\n接下来 $p_1$ 行，每行形如 $id_0\\ k\\ id_1\\ id_2\\ \\cdots\\ id_k$，表示编号为 $id_0$ 的无人机在这个时刻的导弹位移过程中被摧毁，并且在该过程中摧毁该无人机的导弹共有 $k$ 枚，分别来自编号为 $id_1,id_2,\\cdots,id_k$ 的无人机。\n\n为保证输出唯一，这 $p_1$ 行中的每一行内，$id_1,\\dots,id_k$ 应当从小到大输出，行之间按 $id_0$ 从小到大输出。\n\n接下来 $p_2$ 行，每行形如 $id_0\\ k\\ id_1\\ id_2\\ \\cdots\\ id_k$，表示编号为 $id_0$ 的无人机在这个时刻的无人机位移过程中被摧毁，并且在该过程中摧毁该无人机的导弹共有 $k$ 枚，分别来自编号为 $id_1,id_2,\\cdots,id_k$ 的无人机。\n\n为保证输出唯一，这 $p_2$ 行中的每一行内，$id_1,\\dots,id_k$ 应当从小到大输出，行之间按 $id_0$ 从小到大输出。\n\n接下来 $p_3$ 行，每行形如 $k\\ id_1\\ id_2\\ \\dots id_k$，表示该时刻结束时，有 $k$ 架无人机位置相同 ，它们的编号是 $id_1,...,id_n$。\n\n为保证输出唯一，这 $p_3$ 行中的每一行内，$id_1,\\dots,id_k$ 应当从小到大输出，行之间按 $id_1$ 从小到大输出，并且每个编号出现至多一次。", "hint": "#### 样例解释 1\n\n在第 $1$ 时刻，两架飞机于 $(4,0,0)$ 处相撞。\n\n#### 样例解释 2\n\n在第 $4$ 时刻，两枚导弹分别摧毁了敌机。\n\n#### 数据范围\n\n$T,n\\le 100,3\\le v_m\\le 20$；\n\n$v_m>10$ 的无人机和导弹总数不超过 $10$；\n\n$\\theta_u,\\theta_d,\\gamma,\\theta_r,\\beta_s\\in(\\dfrac\\pi4,\\dfrac\\pi2)$；\n\n$1\\le d_s,d_p\\le 20,1\\le t_z\\le 100$；\n\n$|x|,|y|,|z|\\le 100$；\n\n$1\\le L_x,H_y\\le 100$。\n\n所有输入的实数精确到小数点后不超过 $6$ 位。\n\n最初时，$\\vec p$ 两两不同。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 乱西星上的空战", "background": "众所周知，在乱西星的现代战争中，制空权是很重要的。为此，人们发展出了无人机技术——遗憾的是，由于乱西星的算法水平和各种意义上的通讯水平实在太落后了，所以这些无人机只能采用各自独立的傻瓜式战斗模式，这些模式不含任何随机因素，因此一场傻瓜式无人机空战总是几乎能在开始前就被预测到结果。\n\n总而言之，乱西星上正在相互战争的 |\\\\| 国和 () 国的傻瓜式无人机战斗机编队在其边境交界处的空域遭遇了，现在两国军方希望你能预测这一空战的结果。", "description": "### 空域与时刻\n\n由于乱西星的神秘物理法则，乱西星的时间和空间并不是连续的；若认为遭遇战开始的时刻是第 $1$ 时刻，那么对于任意的第 $k\\in \\N$ 个时刻，在这一时刻开始和结束时，一个物体（无人机或导弹）只能在形如 $(x,y,z)\\in\\mathbb Z^3$ 的位置（即空域内的整点）上。\n\n### 无人机\n\n由于空域相比无人机要大得多，因此我们可以将无人机视为一个质点（尽管他们实际上长得和地球上的一般意义上的飞机十分相似）。\n\n#### 飞行状态\n\n在每个时刻，一架无人机的飞行状态可以用以下三组参数描述：\n\n1. 当前时刻所在的坐标 $\\vec p=(x,y,z)\\in\\mathbb Z^3$；\n2. 当前时刻的飞行方向向量 $\\vec{d},\\|\\vec d\\|=1$；\n   - 其中， $\\|\\vec{v}\\|$ 表示向量 $\\vec v$ 的长度：设 $\\vec{v}=(v_x,v_y,v_z)$，则 $\\|\\vec{v}\\|=\\sqrt{v_x^2+v_y^2+v_z^2}$。\n   - 你可以简单地将 $\\vec d$ 理解为机头指向的方向。\n3. 当前时刻的无人机升力线方向 $\\vec u,\\|\\vec u\\|=1,\\vec u\\bot \\vec d$；\n   - 你可以简单的将 $\\vec u$ 理解为飞机所在平面的、从机腹指向机背的单位法向量。\n   - 此时，$\\vec d$ 和 $\\vec u$ 可以唯一确定一个“左手向” $\\vec l=\\vec u\\times \\vec d$。\n\n#### 飞行性能\n\n不严格地讲，一般而言，一架飞机通常有三个操作轴，即俯仰、滚转和偏航：俯(负杆)和仰(正杆)分别对应飞机机头向下和向上（即保持 $\\vec l$ 不变）；滚转即飞机以飞行方向为中轴线旋转（即保持 $\\vec d$ 不变）；偏航则为飞机机头向左或者向右（即保持 $\\vec u$ 不变）。由于无人机的特殊设计，其**没有偏航**轴，只能进行俯仰和滚转——容易看出，即使仅进行俯仰和滚转，一架无人机也能随意地改变 $\\vec d$ 和 $\\vec u$ （在保持 $\\|\\vec u\\|=\\|\\vec d\\|=1,\\vec u\\bot \\vec d$ 的前提下）。\n\n以上的俯仰(正杆或负杆)、滚转操作，以及直线飞行，及其复合统称“机动”。\n\n由于无人机型号差异，一架无人机的飞行性能可以用以下三组参数描述（为方便起见，在本节中，对进行一次机动前的飞行状态对应参数为 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$，进行一次机动后的飞行状态对应的参数为 $\\vec p'=(x',y',z'),\\vec d',\\vec u',\\vec l'$）：\n\n1. 正杆率 $\\theta_u\\in(\\dfrac\\pi4,\\dfrac\\pi2)$ 和负杆率 $\\theta_d\\in(\\dfrac\\pi4,\\dfrac \\pi2)$；\n   - 若无人机**仅进行正杆**机动，则必须有 $\\vec p=\\vec p',\\vec l=\\vec l',\\vec u\\cdot \\vec d'\\ge 0$；此时，进行一次这样的机动花费的时间是 $\\dfrac{\\angle(\\vec d,\\vec d')}{\\theta_u}$。\n   - 若无人机**仅进行负杆**机动，则必须有 $\\vec p=\\vec p',\\vec l=\\vec l',\\vec u\\cdot \\vec d'\\le 0$；此时，进行一次这样的机动花费的时间是 $\\dfrac{\\angle(\\vec d,\\vec d')}{\\theta_d}$。\n2. 滚转率 $\\gamma\\in(\\dfrac\\pi4,\\dfrac \\pi 2)$；\n   - 若无人机**仅进行滚转**机动，则必须有 $\\vec p=\\vec p',\\vec d=\\vec d'$；此时，进行一次这样的机动花费的时间是 $\\dfrac{\\angle(\\vec u,\\vec u')}{\\gamma}$。\n3. 飞行极速 $v_{m}>0$；\n   - 若无人机**仅进行直线飞行**，则必须有 $\\vec d=\\vec d',\\vec u=\\vec u'$；此时，花费的时间是 $\\dfrac{\\|\\vec p'-\\vec p\\|}{v_m}$。\n\n#### 合法位移\n\n在每个时刻，若一架无人机可以从 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$ 这一飞行状态，严格按照**滚转**、**俯仰**(正杆或负杆)和**直线飞行**的顺序进行机动，使飞行状态变为 $\\vec p'=(x',y',z')\\not=\\vec p,\\vec d',\\vec u',\\vec l'$，满足 $\\vec d'//(\\vec p'-\\vec p)$，并且各机动花费的时间之和不超过 $1$，则称这是一次(无人机的)合法的综合机动。\n\n如果一架无人机可以从 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$ 通过一次合法的综合机动，使飞行状态变为 $\\vec p'=(x',y',z')\\not=\\vec p,\\vec d',\\vec u',\\vec l'$，并且在所有使飞行状态变为 $\\vec p''=\\vec p',\\vec d'',\\vec u'',\\vec l''$ 的合法综合机动中，总用时是最短的，则称之为一次（无人机的）合法位移（或称该位移合法）。此时，无人机会沿直线从 $\\vec p$ 移动到 $\\vec p'$。如无特殊指明，下文中“位移”均默认(应当为)合法位移。\n\n#### 眼镜蛇机动\n\n在每个时刻，无论无人机飞行性能如何，无人机总是可以通过眼镜蛇机动，从 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$ 这一飞行状态，变为 $\\vec p'=\\vec p,\\vec d'=\\vec u,\\vec u'=-\\vec d,\\vec l'=\\vec l$ 这一飞行状态。注意，这种机动不被视为合法机动。\n\n#### 其它参数\n\n除此之外，一架无人机还具有以下参数：\n\n1. 无人机编号（简称“编号”）；\n   - 保证任意两架无人机编号不同。\n2. 所在阵营（简称“阵营”）；\n   - 所在阵营必须是|\\\\| 国或者是 () 国中之一，并且双方互称敌方阵营。\n\n#### 坠毁\n\n一架无人机坠毁，当且仅当其符合下列条件之一：\n\n1. 在某激活的导弹位移过程中，与该导弹的距离不大于导弹的空爆距离（详见下文）。\n2. 在某导弹位移结束后，与该导弹位置重合（从而导弹直接命中无人机导致坠毁，下同）。\n3. 在无人机位移过程中，存在至少一枚激活的导弹，与其距离不大于该导弹的空爆距离。\n4. 在无人机位移结束后，存在至少一枚导弹所在位置与其位置重合。\n5. 在无人机位移结束后，存在另一架无人机与其坐标相同（从而发生碰撞导致双双坠毁）。\n\n无人机坠毁后将立即消失，此后不会发射导弹，也不会导致其它无人机坠毁。但无人机已经发射的导弹不会立刻消失或爆炸。\n\n此时也称无人机被摧毁。\n\n### 空空红外制导导弹\n\n类似的，一枚空空红外制导导弹（下文简称“导弹”）也可视为一质点，并且同样可以描述其飞行状态和飞行性能。\n\n#### 飞行状态\n\n由于导弹无所谓上下左右，因此仅需要以下两组参数以描述一个导弹的飞行状态：\n\n1. 当前时刻所在的坐标 $\\vec p=(x,y,z)\\in\\Z^3$；\n2. 当前时刻的飞行方向向量 $\\vec{d},\\|\\vec d\\|=1$；\n   - 你可以简单地将 $\\vec d$ 理解为导弹弹头指向的方向。\n\n#### 飞行性能\n\n同样由于一枚导弹无所谓上下左右，因此其不存在俯仰、滚转和偏航轴，其向各个方向改变 $\\vec d$ 的性能是相同的，此时统称仅改变 $\\vec d$ 的操作为 \"偏航\"。其与直线飞行及复合统称“机动”。\n\n因此一枚导弹的飞行性能可以用以下两组参数描述（为方便起见，在本节中，对进行一次机动前的飞行状态对应参数为 $\\vec p=(x,y,z),\\vec d$，进行一次机动后的飞行状态对应的参数为 $\\vec p'=(x',y',z'),\\vec d'$）：\n\n1. 偏航率 $\\theta_r\\in(\\dfrac\\pi4,\\dfrac\\pi2)$；\n   - 若导弹**仅进行偏航**机动，则必须有 $\\vec p=\\vec p'$；此时，进行一次这样的机动花费的时间是 $\\dfrac{\\angle(\\vec d,\\vec d')}{\\theta_r}$；\n2. 飞行极速 $v_m>0$；\n   - 若导弹**仅进行直线飞行**，则必须有 $\\vec d=\\vec d'$；此时，花费的时间是 $\\dfrac{\\|\\vec p'-\\vec p\\|}{v_m}$。\n\n#### 合法位移\n\n在每个时刻，若一枚导弹可以从 $\\vec p=(x,y,z),\\vec d$ 这一飞行状态，严格按照**偏航**和**直线飞行**的顺序进行机动，使飞行状态变为 $\\vec p'=(x',y',z')\\not=\\vec p,\\vec d'$，满足 $\\vec d//(\\vec p'-\\vec p)$，并且各机动花费的时间之和不超过 $1$，则称这是一次(导弹的)合法位移（或称该位移合法）。此时，导弹会沿直线从 $\\vec p$ 移动到 $\\vec p'$。如无特殊指明，下文中“位移”均（应当）默认为合法位移。\n\n#### 其它参数\n\n除此之外，一枚导弹还具有以下参数：\n\n1. 保险距离 $d_s>0$ 和激活状态；\n   - 导弹被发射后立即处于未激活状态。\n   - 每个时刻结束时，若导弹处于未激活状态，并且发射该导弹的无人机已坠毁，或者与发射该导弹的无人机的距离大于保险距离 $d_s$ 时，进入激活状态。此后将保持激活状态，并称该导弹被激活，或称其为一枚激活的导弹。\n2. 空爆距离 $d_p>0$；\n   - 每次导弹位移过程中，当一枚激活的导弹与任一无人机（包括发射该导弹的无人机）距离不大于 $d_p$ 时，该导弹会进入可空爆状态（详见下文“可空爆”）。\n   - 每次无人机位移过程中，若存在一无人机与一枚激活的导弹距离不大于 $d_p$ 时，该导弹也会进入可空爆状态。\n3. 最大锁定角 $\\beta_s\\in(\\dfrac\\pi4,\\dfrac\\pi2)$；\n   - 任意时刻，一枚飞行状态为 $\\vec p=(x,y,z),\\vec d$、最大锁定角的导弹能锁定到 $\\vec p'$ 处的无人机，当且仅当 $\\vec d\\cdot(\\vec p'-\\vec p)>0$，并且 $\\angle(\\vec d,\\vec p'-\\vec p)\\le \\beta_s$。\n   - 此时称该无人机能被该导弹锁定，或称其在导弹的锁定范围内。\n   - 称 $\\angle(\\vec d,\\vec p'-\\vec p)$ 为锁定角。\n4. 制导时长 $t_z>0$；\n   - 若导弹在第 $k$ 个时刻被发射，则到第 $k+t_z$ 个时刻结束时，若导弹仍未爆炸，则导弹会立刻消失（见“爆炸、消失与可空爆”）。此时称导弹超过制导时长。\n\n#### 爆炸、消失与可空爆\n\n一枚导弹在符合下列全部条件时，会立刻爆炸并消失：\n\n1. 在导弹位移开始前，导弹处于激活状态；\n\n2. 符合以下条件之一：\n   \n   1. 在该导弹位移过程中，存在一架位于 $\\vec q$ 的无人机，使 $\\min_{\\lambda\\in[0,1]}\\|\\lambda \\vec p+(1-\\lambda)\\vec p'-\\vec q\\|\\le d_p$，其中  $\\vec p,\\vec p'$ 为导弹本次位移的起点和终点。\n      \n      - 此时，所有这样的无人机都会被该导弹摧毁。同时，一架无人机可能同时被若干枚导弹摧毁。\n   \n   2. 在无人机位移过程中，存在一架无人机，记其从位置 $\\vec q$ 位移到 $\\vec q'$ ，满足 $\\min_{\\lambda\\in[0,1]}\\|\\lambda \\vec q+(1-\\lambda)\\vec q'-\\vec p\\|\\le d_p$，其中 $\\vec p$ 为导弹此时的位置。\n      \n      - 此时，所有这样的无人机都会被该导弹摧毁。同时，该导弹也可能同时摧毁若干这样的无人机。\n\n此时，称该导弹可空爆，或该导弹进入可空爆状态。\n\n一枚导弹在符合下列条件之一时，不会发生爆炸，但是会在当前时刻结束时消失：\n\n1. 导弹脱锁（见下文“导弹脱锁”），并且在当前时刻开始时已被激活；\n\n2. 导弹超过制导时长；\n\n3. 导弹未激活，并且导弹位移结束后与一无人机位置重合；\n   \n   - 此时，该无人机会被这枚导弹摧毁。同时，一架无人机可能同时被若干枚导弹摧毁。\n\n4. 导弹未激活，无人机位移结束后，该导弹与一无人机位置重合。\n   \n   - 此时，该无人机会被这枚导弹摧毁。同时，一枚导弹可能同时摧毁若干这样的无人机。\n\n### 无人机视野、雷达搜索与导弹锁定\n\n#### 无人机视野\n\n任意时刻，一架飞行状态为 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$ 的无人机能够发现一架位于 $\\vec p'=(x',y',z')$ 的无人机，当且仅当 $\\vec d\\cdot(\\vec p'-\\vec p)> 0$；此时称 $\\vec p'$ 处的无人机在 $\\vec p$ 处无人机的视野内。\n\n#### 无人机机载雷达搜索范围\n\n一架无人机的机载雷达（下文简称“雷达”）的扫描范围可以用以下两个参数描述：\n\n1. 水平扫描范围 $L_x\\in\\N^+$ 和垂直扫描范围 $H_y\\in\\N^+$；\n   - 任意时刻，一架飞行状态为 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$ 、雷达扫描范围为 $L_x,H_y$ 的无人机的能够扫描到一架位于 $\\vec p'$ 的无人机，当且仅当，$\\vec d\\cdot(\\vec p'-\\vec p)>0$ 并且 $\\exist x,y,s.t.\\ |x|\\le L_x,|y|\\le H_y$ 且 $[\\vec p'-(\\vec p+x\\vec l+y\\vec u)]//\\vec d$。\n   - 即若以 $\\vec p$ 为原点、以 $\\vec l$ 和 $\\vec u$ 为 $X,Y$ 轴建一平面 $\\alpha=\\alpha(\\vec p;\\vec l,\\vec u)$，则  $\\vec p'$ 在这一平面上的投影 $\\vec r=P(\\vec p';\\alpha)$ 应当落在 $[-L_x,L_x]\\times [-H_y,H_y]$ 中。\n   - 此时称 $\\vec p'$ 处的无人机在 $\\vec p$ 处无人机雷达扫描范围内。\n\n#### 导弹脱锁\n\n当无人机位移结束后，若一枚导弹选定的目标已坠毁，或其不能被该导弹锁定，则称该导弹脱锁，或处于脱锁状态。\n\n此后将一直保持脱锁状态，无论是否此前选定的无人机是否重新可以被导弹锁定。\n\n### 无人机选定目标策略\n\n任意时刻，无人机（简称\"本机\"，下同）按下述策略选择目标无人机。\n\n1. 若本机视野内无敌方阵营无人机（简称“敌机”，下同），则本机无选定目标；\n2. 否则，若上一时刻本机选择的无人机仍位于本机视野内，则本机仍选定该目标；\n3. 否则，若存在至少一架敌机处于本机雷达扫描范围内，则选取其中与本机距离最近的；若与本机距离最近的敌机不唯一，则选取编号最小的。\n4. 否则，对视野内的处于 $\\vec p'$ 的敌机，记 $\\alpha=\\alpha(\\vec p;\\vec l,\\vec u),\\vec r=P(\\vec p';\\alpha)=(r_x,r_y)$，则选取 $\\min\\{|r_x-L_x|,|r_x+L_x|\\}+\\min\\{|r_y-H_y|,|r_y+H_y|\\}$ 最小的。若有多个最小值，则同样选择编号最小的。\n\n### 飞行策略\n\n#### 无人机飞行策略\n\n设无人机飞行状态是 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$，其飞行极速为 $v_m$，机载雷达扫描范围为 $L_x,H_y$。\n\n1. 若无人机有位于 $\\vec p'$ 的选定目标：\n   1. 若无人机能够合法地位移到某个位置，使敌机现在的位置 $\\vec p'$ 仍处于本机的视野内，则无人机会合法地移动到飞行状态 $\\vec q=(x_q,y_q,z_q),\\vec d_q,\\vec u_q,\\vec l_q$，使敌机现在的位置 $\\vec p'$ 仍处于本机视野内，且 $\\|\\vec p'-\\vec q\\|$ 最小。\n      1. 若有多个这样的位置，记 $\\alpha_q=\\alpha(\\vec q;\\vec l_q,\\vec u_q),\\vec r_q=P(\\vec p';\\alpha_q)=(r_{qx},r_{qy})$，则优先选取使 $\\vec r_q=(r_{qx},r_{qy})\\in[-L_x,L_x]\\times [-H_y,H_y]$ 的位置；\n         1. 若仍有多个这样的位置，则选取使 $\\|\\vec r_q\\|=\\sqrt{r_{qx}^2+r_{qy}^2}$ 最小的；\n         2. 若仍有多个这样的位置，则选取 $\\vec q$ 字典序最小的。\n      2. 若不存在这样的 $\\vec r_q$，则选取使 $\\min\\{|r_{qx}-L_x|,|r_{qx}+L_x|\\}+\\min\\{|r_{qy}-H_y|,|r_{qy}+H_y|\\}$ 最小的；\n         1. 若仍有多个这样的位置，则选取 $\\vec q$ 字典序最小的。\n   2. 否则，无人机会合法地移动到某个位置 $\\vec q$，使 $\\|\\vec q-\\vec p-v_m\\vec d\\|$ 最小；\n      1. 若有多个这样的位置，则选取 $\\vec q$ 字典序最小的。\n2. 否则，无人机通过眼镜蛇机动，将飞行状态变为 $\\vec p=(x,y,z),\\vec u,-\\vec d,\\vec l$。\n\n保证在上述1.的情况下，无人机总能合法地移动到某个位置。\n\n#### 导弹飞行策略\n\n设导弹当前时刻飞行状态 $\\vec p,\\vec d$，其选定的敌机飞行状态为 $\\vec p',\\vec d',\\vec u',\\vec l'$；\n\n若上一时刻结束时，导弹未脱锁，则记 $\\vec q'$ 为敌机根据其飞行策略，下一时刻会移动到的位置。\n\n若导弹能合法位移到 $\\vec q'$，则导弹会直接位移到 $\\vec q'$。\n\n否则，导弹会合法地位移到能使敌机位移后的位置 $\\vec q'$ 处于锁定范围内的位置 $\\vec q$ ，且 $\\|\\vec q-\\vec q'\\|$ 最小。\n\n1. 若有多个这样的 $\\vec q$，则选取位移后锁定角最小的；\n2. 若仍有多种可能，则选取 $\\vec q$ 字典序最小的。\n\n若不存在这样的位置，或者上个时刻结束时，导弹已经脱锁，则导弹会合法地位移到某个位置 $\\vec q$，使 $\\|\\vec q-\\vec p-v_m\\vec d\\|$ 最小。\n\n保证导弹总能合法地移动到某个位置。\n\n### 无人机发射导弹规则\n\n一飞行状态为 $\\vec p=(x,y,z),\\vec d,\\vec u,\\vec l$ 的无人机（简称\"本机\"）向**被本机选定**的、处于 $\\vec p'$ 的目标无人机（简称“敌机”）发射导弹的规则为：\n\n在每个时刻开始时，若选定的敌机已处于本机雷达扫描范围内，且当前不存在由本机发射且未爆炸（或消失）的导弹，则向敌机发射一初始飞行状态为 $\\vec p,\\vec d=\\dfrac{\\vec p'-\\vec p}{\\|\\vec p'-\\vec p\\|}$ 的未激活的导弹，该导弹选定敌机。\n\n### 同一时刻内各事件发生顺序\n\n1. 所有无人机选定目标，并确定当前时刻内的飞行策略；\n2. 所有能发射导弹的无人机发射导弹；\n3. 所有导弹确定飞行策略并位移，该过程中部分无人机可能被摧毁；\n4. 所有可空爆的导弹爆炸并消失；\n5. 所有无人机按 1. 中确定的飞行策略位移，该过程中部分无人机可能被摧毁；\n6. 所有可空爆的导弹爆炸并消失；\n7. 所有位置相同的无人机发生碰撞并坠毁。\n8. 所有超过制导时长和脱锁且已激活的导弹消失。\n9. 所有可激活的导弹被激活。\n\n### 任务\n\n给定空域开始时（即第 $1$ 时刻开始时），各无人机的飞行性能与状态、导弹的飞行性能，假定这场空战会持续 $T$ 个时刻，双方指挥官希望你能按时间顺序依次给出每个时刻发生的所有重要事件。", "inputFormat": "第一行两个正整数 $n,T$ ，表示共有 $2n$ 架无人机，模拟前 $T$ 个时刻。其中，前 $n$ 架阵营是 |\\\\| 国，后 $n$ 架阵营是 () 国。\n\n接下来有 $2n$ 组数据，每一组包含若干行，其中第 $i$ 组描述了编号为 $i$ 的无人机。\n\n在每组数据中：\n\n第一行三个整数表示 $\\vec p\\in\\mathbb Z^3$；保证所有的 $\\vec p$ 两两不同，且坐标的绝对值不超过 $100$。\n\n第二行六个整数依次表示无人机的 $\\vec d,\\vec u$，保证 $\\vec d,\\vec u\\in S_v$；\n\n- 其中， $S_v=\\{(1,0,0),(-1,0,0),(0,1,0),(0,-1,0),(0,0,1),(0,0,-1)\\}$；\n\n第三行六个实数依次表示无人机的 $\\theta_u,\\theta_d,\\gamma,v_m,L_x,H_y$；\n\n第四行五个实数和一个正整数依次表示导弹的 $\\theta_r,v_m,d_s,d_p,\\beta_s,t_z$。", "outputFormat": "输出 $T$ 组数据，第 $i$ 组数据表示第 $i$ 个时刻发生的重要事件。\n\n在每组数据中：\n\n第一行三个非负整数 $p_1,p_2,p_3$ ，表示在这个时刻的导弹位移过程中被摧毁的无人机数量、在这个时刻的无人机位移过程中被摧毁的无人机数量、这个时刻结束时，有多少组无人机因位置相同而两两碰撞坠毁。\n\n接下来 $p_1$ 行，每行形如 $id_0\\ k\\ id_1\\ id_2\\ \\cdots\\ id_k$，表示编号为 $id_0$ 的无人机在这个时刻的导弹位移过程中被摧毁，并且在该过程中摧毁该无人机的导弹共有 $k$ 枚，分别来自编号为 $id_1,id_2,\\cdots,id_k$ 的无人机。\n\n为保证输出唯一，这 $p_1$ 行中的每一行内，$id_1,\\dots,id_k$ 应当从小到大输出，行之间按 $id_0$ 从小到大输出。\n\n接下来 $p_2$ 行，每行形如 $id_0\\ k\\ id_1\\ id_2\\ \\cdots\\ id_k$，表示编号为 $id_0$ 的无人机在这个时刻的无人机位移过程中被摧毁，并且在该过程中摧毁该无人机的导弹共有 $k$ 枚，分别来自编号为 $id_1,id_2,\\cdots,id_k$ 的无人机。\n\n为保证输出唯一，这 $p_2$ 行中的每一行内，$id_1,\\dots,id_k$ 应当从小到大输出，行之间按 $id_0$ 从小到大输出。\n\n接下来 $p_3$ 行，每行形如 $k\\ id_1\\ id_2\\ \\dots id_k$，表示该时刻结束时，有 $k$ 架无人机位置相同 ，它们的编号是 $id_1,...,id_n$。\n\n为保证输出唯一，这 $p_3$ 行中的每一行内，$id_1,\\dots,id_k$ 应当从小到大输出，行之间按 $id_1$ 从小到大输出，并且每个编号出现至多一次。", "hint": "#### 样例解释 1\n\n在第 $1$ 时刻，两架飞机于 $(4,0,0)$ 处相撞。\n\n#### 样例解释 2\n\n在第 $4$ 时刻，两枚导弹分别摧毁了敌机。\n\n#### 数据范围\n\n$T,n\\le 100,3\\le v_m\\le 20$；\n\n$v_m>10$ 的无人机和导弹总数不超过 $10$；\n\n$\\theta_u,\\theta_d,\\gamma,\\theta_r,\\beta_s\\in(\\dfrac\\pi4,\\dfrac\\pi2)$；\n\n$1\\le d_s,d_p\\le 20,1\\le t_z\\le 100$；\n\n$|x|,|y|,|z|\\le 100$；\n\n$1\\le L_x,H_y\\le 100$。\n\n所有输入的实数精确到小数点后不超过 $6$ 位。\n\n最初时，$\\vec p$ 两两不同。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN"}}}
{"pid": "P9142", "type": "P", "difficulty": 5, "samples": [["1\n", "665496236 332748118\n332748118 665496236\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["递推", "博弈论", "2023", "O2优化", "THUPC"], "title": "[THUPC 2023 初赛] 欺诈游戏", "background": "在《LIAR GAME》中，小 E 看到了一个有趣的游戏。", "description": "这个游戏名叫《走私游戏》。游戏规则大概是这样的：一名玩家扮演走私者，一名玩家扮演检察官。走私者可以将 $x$ 日元（$x$ 为 $[0,n]$ 内的整数，由走私者决定）秘密放入箱子中，而检查官需要猜测箱子中的金额。假设检察官猜了 $y$（$y$ 也必须是整数）。如果 $x=y$，则走私失败，走私者一分钱也拿不到。如果 $x>y$，则走私成功，走私者可以从检查官那里拿走 $x$ 日元。如果 $x<y$，则走私失败，但是由于冤枉检察官需要赔付给走私者 $y/2$ 日元。游戏分有限回合进行。双方轮流做走私者和检察官。\n\n可以证明，最优情况下每个回合走私者会采用同一种策略，检察官也会采用同一种策略。小 E 想知道在一个回合中，双方的最优策略分别是什么。", "inputFormat": "一行一个正整数 $n$。", "outputFormat": "输出两行，每行 $n+1$ 个数，其中第 $i$ 个表示放/猜 $i-1$ 日元的概率。\n\n第一行输出走私者的策略，第二行输出检察官的策略。\n\n你需要保证，在一方的策略不变的情况下，另一方无论如何改变自己的策略，都不能使自己的期望收益比原来多。\n\n可以证明，这样的策略是唯一的。\n\n答案对 $998244353$ 取模。", "hint": "#### 样例解释 1\n\n这 $4$ 个数分别为 $2/3,1/3,1/3,2/3$。\n\n#### 子任务\n\n保证 $1\\le n \\le 400000$。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 欺诈游戏", "background": "在《LIAR GAME》中，小 E 看到了一个有趣的游戏。", "description": "这个游戏名叫《走私游戏》。游戏规则大概是这样的：一名玩家扮演走私者，一名玩家扮演检察官。走私者可以将 $x$ 日元（$x$ 为 $[0,n]$ 内的整数，由走私者决定）秘密放入箱子中，而检查官需要猜测箱子中的金额。假设检察官猜了 $y$（$y$ 也必须是整数）。如果 $x=y$，则走私失败，走私者一分钱也拿不到。如果 $x>y$，则走私成功，走私者可以从检查官那里拿走 $x$ 日元。如果 $x<y$，则走私失败，但是由于冤枉检察官需要赔付给走私者 $y/2$ 日元。游戏分有限回合进行。双方轮流做走私者和检察官。\n\n可以证明，最优情况下每个回合走私者会采用同一种策略，检察官也会采用同一种策略。小 E 想知道在一个回合中，双方的最优策略分别是什么。", "inputFormat": "一行一个正整数 $n$。", "outputFormat": "输出两行，每行 $n+1$ 个数，其中第 $i$ 个表示放/猜 $i-1$ 日元的概率。\n\n第一行输出走私者的策略，第二行输出检察官的策略。\n\n你需要保证，在一方的策略不变的情况下，另一方无论如何改变自己的策略，都不能使自己的期望收益比原来多。\n\n可以证明，这样的策略是唯一的。\n\n答案对 $998244353$ 取模。", "hint": "#### 样例解释 1\n\n这 $4$ 个数分别为 $2/3,1/3,1/3,2/3$。\n\n#### 子任务\n\n保证 $1\\le n \\le 400000$。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN"}}}
{"pid": "P9143", "type": "P", "difficulty": 3, "samples": [["3\n1 3 2", "17"]], "limits": {"time": [500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["贪心", "2023", "O2优化", "THUPC"], "title": "[THUPC 2023 初赛] 众数", "background": "", "description": "你有若干个 $[1,n]$ 内的正整数：对于 $1 \\le i \\le n$，你有 $a_i$ 个整数 $i$。设 $S = \\sum_{i=1}^n a_i$。\n\n对于一个序列 $p_1,p_2,\\cdots,p_l$，定义其众数 $\\text{maj}(p_1,p_2,\\cdots,p_l)$ 为出现次数最多的数。若有多个数出现次数最多，则其中最大的数为其众数。\n\n现在你需要把这 $S$ 个数排成一个序列 $b_1,b_2,\\cdots,b_S$，使得 $\\sum_{i=1}^S \\text{maj}(b_1,b_2,\\cdots,b_i)$ 最大。输出该最大值。", "inputFormat": "第一行一个整数 $n$，表示值域。\n\n接下来一行 $n$ 个正整数 $a_1,a_2,\\cdots,a_n$，表示每种数的个数。", "outputFormat": "输出一行一个正整数表示 $\\sum_{i=1}^S \\text{maj}(b_1,b_2,\\cdots,b_i)$ 的最大值。", "hint": "#### 样例解释 1\n\n一个达到最大值的序列为 $(3,2,3,1,2,2)$。\n\n#### 数据范围\n\n对于所有测试数据，$1 \\le n \\leq 10^5$，$1 \\le a_1,a_2,\\cdots,a_n \\le 10^5$。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 众数", "background": "", "description": "你有若干个 $[1,n]$ 内的正整数：对于 $1 \\le i \\le n$，你有 $a_i$ 个整数 $i$。设 $S = \\sum_{i=1}^n a_i$。\n\n对于一个序列 $p_1,p_2,\\cdots,p_l$，定义其众数 $\\text{maj}(p_1,p_2,\\cdots,p_l)$ 为出现次数最多的数。若有多个数出现次数最多，则其中最大的数为其众数。\n\n现在你需要把这 $S$ 个数排成一个序列 $b_1,b_2,\\cdots,b_S$，使得 $\\sum_{i=1}^S \\text{maj}(b_1,b_2,\\cdots,b_i)$ 最大。输出该最大值。", "inputFormat": "第一行一个整数 $n$，表示值域。\n\n接下来一行 $n$ 个正整数 $a_1,a_2,\\cdots,a_n$，表示每种数的个数。", "outputFormat": "输出一行一个正整数表示 $\\sum_{i=1}^S \\text{maj}(b_1,b_2,\\cdots,b_i)$ 的最大值。", "hint": "#### 样例解释 1\n\n一个达到最大值的序列为 $(3,2,3,1,2,2)$。\n\n#### 数据范围\n\n对于所有测试数据，$1 \\le n \\leq 10^5$，$1 \\le a_1,a_2,\\cdots,a_n \\le 10^5$。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN"}}}
{"pid": "P9144", "type": "P", "difficulty": 6, "samples": [["2 8 50\n3 4 0 1 1 0 1 1\n4 5 1 2 1 1 1 2\n", "0.125000000000000000 0.140625000000000000 0.515625000000000000 0.564453125000000000 0.135009765625000000 0.328369140625000000 0.548858642578125000 0.625278472900390625\n"], ["见附件中的 2.in", "见附件中的 2.ans"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["动态规划 DP", "二分", "2023", "Special Judge", "O2优化", "THUPC"], "title": "[THUPC 2023 初赛] 最后的活动", "background": "各位亲爱的《La Lumière: Scarlet Intense Flame》玩家：\n\n感谢您一直给予《La Lumière: Scarlet Intense Flame》的支持与厚爱。我们非常遗憾地宣布，《La Lumière: Scarlet Intense Flame》将于 2023 年 3 月 5 日 16:00 停止运营服务。\n\n停止运营相关时间表如下：\n\n……", "description": "元老级二次元手游《La Lumière: Scarlet Intense Flame》将于今年 3 月停止运营服务。作为这款游戏的忠实玩家，小 S 希望能在游戏的最后一次活动中刷到一个特殊的分数，以此为近十年来与这款游戏共度的难忘时光画上一个圆满的句号。\n\n《La Lumière: Scarlet Intense Flame》中的每种活动都有其独特的规则，而最后一次活动是 Chase Festival。在 Chase Festival 中，玩家需要多次攻略每次随机生成的多层迷宫，每次退出迷宫时根据在迷宫中各层击杀怪物的评价独立结算本次随机迷宫的分数。每次挑战迷宫时的流程简化如下：\n\n1. 选择挑战的随机迷宫的难度。小 S 是这款游戏的资深玩家，因此在本题中假定小 S 总是挑战最高难度的迷宫。最高难度的迷宫最深为 $N$ 层。确定难度后，从随机生成的迷宫的第 1 层开始挑战。\n\n2. 进行第 $i$ 层的挑战。挑战第 $i$ 层时，小 S 有可能挑战失败，挑战成功并获得普通评价，或者挑战成功并获得高评价。如果小 S 选择保守的挑战策略，则有 $p_{i,0}$ 的概率挑战失败，有 $p_{i,1}$ 的概率挑战成功并获得普通评价，有 $p_{i,2}$ 的概率挑战成功并获得高评价；如果小 S 选择激进的挑战策略，则有 $q_{i,0}$ 的概率挑战失败，有 $q_{i,1}$  的概率挑战成功并获得普通评价，有 $q_{i, 2}$ 的概率挑战成功并获得高评价。\n   \n   - 获得普通评价时，在当前层获得 $s_{i,1}$ 的分数；获得高评价时，在当前层获得 $s_{i,2}$ 的分数。这部分获得的分数**不会直接加算**到玩家的总分数中，而是**在退出迷宫时结算**。如果挑战成功，且当前不是最后一层（$i<N$），则跳转到第 3 步，选择是否继续挑战；否则（$i=N$），退出迷宫并跳转到第 4 步进行结算。\n   \n   - 如果挑战失败，则强制退出迷宫，跳转到第 4 步。\n\n3. 如果当前不是最后一层，玩家可以选择是否继续挑战下一层。如果选择继续，则返回第 2 步；否则退出当前迷宫，跳转到第 4 步进行结算。\n\n4. 本次迷宫的分数结算：如果因为失败而强制退出，则当前层不获得任何奖励，且**本次迷宫中之前各层**累积的分数需要乘上惩罚系数 $c$（为了使最终分数为整数，游戏会对惩罚后的分数先求和再下取整）；除了强制退出之外，玩家主动退出或者通关迷宫后退出都可以获得全部尚未结算的分数。\n\n小 S 想得到的目标分数是一个比较大的分数，因此小 S 需要先大量刷最高难度的迷宫，再在接近目标分数时根据当前剩余的分数选择相对稳定的策略，以确保活动结束时能恰好获得目标分数。小 S 不会编程，因此小 S 找到了你，希望你能帮忙计算当剩余分数在 $1$ 至 $M$ 分之间，仅按照上述的流程挑战迷宫，并采用最佳策略时，最终能够恰好达到目标分数的最大概率。", "inputFormat": "输入的第一行包含三个整数 $N, M, c'$，其中 $N$ 和 $M$ 的含义与题面相同，$c'=100c$。保证 $1\\le N\\le 6$，$1\\le M\\le 10000$，$0\\le c'\\le 100$。\n\n接下来 $N$ 行，每行输入八个整数 $s_{i,1},s_{i,2},u_{i,0},u_{i,1},u_{i,2}, v_{i,0}, v_{i,1}, v_{i,2}$，其中 $s_{i,1}$ 与 $s_{i,2}$ 分别表示挑战时普通评价和高评价对应的分数；$u_{i,j}$ 和 $v_{i,j}$ 分别表示使用保守的挑战策略及激进的挑战策略时，对应结果的概率权重：$p_{i,j}=\\dfrac{u_{i,j}}{u_{i,0}+u_{i,1}+u_{i,2}}$，$q_{i,j}=\\dfrac{v_{i,j}}{v_{i,0}+v_{i,1}+v_{i,2}}$。保证 $1\\le s_{i, 1} \\le s_{i, 2}\\le 10000$，$0\\le u_{i,j}, v_{i,j}\\le 10000$ 且 $u_{i,1}+u_{i,2}\\ge 1$，$v_{i,1}+v_{i,2}\\ge 1$。", "outputFormat": "输出一行 $M$ 个实数，其中第 $i$ （$1\\le i\\le M$）个实数表示当距离目标分数恰好还剩 $i$ 分时，在最优策略下能够恰好获得 $i$ 分的最大概率。 当你输出中的每个实数与相应标准输出的绝对误差不超过 $10^{-6}$ 时，我们认为你的输出是正确的。", "hint": "#### 子任务\n\n对于 $100\\%$ 的数据，保证 $1\\le N\\le 6$，$1\\le M\\le 10000$，$0\\le c'\\le 100$，$1\\le s_{i,1}\\le s_{i, 2}\\le 10000$，$0\\le u_{i, 0}, u_{i, 1}, u_{i, 2}, v_{i, 0}, v_{i, 1}, v_{i, 2}\\le 10000$，$u_{i,1}+u_{i,2}\\ge 1$，$v_{i,1}+v_{i,2}\\ge 1$。\n\n#### 提示\n\n《La Lumière: Scarlet Intense Flame 2》将于 2023 年春暖花开的时节与大家相见！\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 最后的活动", "background": "各位亲爱的《La Lumière: Scarlet Intense Flame》玩家：\n\n感谢您一直给予《La Lumière: Scarlet Intense Flame》的支持与厚爱。我们非常遗憾地宣布，《La Lumière: Scarlet Intense Flame》将于 2023 年 3 月 5 日 16:00 停止运营服务。\n\n停止运营相关时间表如下：\n\n……", "description": "元老级二次元手游《La Lumière: Scarlet Intense Flame》将于今年 3 月停止运营服务。作为这款游戏的忠实玩家，小 S 希望能在游戏的最后一次活动中刷到一个特殊的分数，以此为近十年来与这款游戏共度的难忘时光画上一个圆满的句号。\n\n《La Lumière: Scarlet Intense Flame》中的每种活动都有其独特的规则，而最后一次活动是 Chase Festival。在 Chase Festival 中，玩家需要多次攻略每次随机生成的多层迷宫，每次退出迷宫时根据在迷宫中各层击杀怪物的评价独立结算本次随机迷宫的分数。每次挑战迷宫时的流程简化如下：\n\n1. 选择挑战的随机迷宫的难度。小 S 是这款游戏的资深玩家，因此在本题中假定小 S 总是挑战最高难度的迷宫。最高难度的迷宫最深为 $N$ 层。确定难度后，从随机生成的迷宫的第 1 层开始挑战。\n\n2. 进行第 $i$ 层的挑战。挑战第 $i$ 层时，小 S 有可能挑战失败，挑战成功并获得普通评价，或者挑战成功并获得高评价。如果小 S 选择保守的挑战策略，则有 $p_{i,0}$ 的概率挑战失败，有 $p_{i,1}$ 的概率挑战成功并获得普通评价，有 $p_{i,2}$ 的概率挑战成功并获得高评价；如果小 S 选择激进的挑战策略，则有 $q_{i,0}$ 的概率挑战失败，有 $q_{i,1}$  的概率挑战成功并获得普通评价，有 $q_{i, 2}$ 的概率挑战成功并获得高评价。\n   \n   - 获得普通评价时，在当前层获得 $s_{i,1}$ 的分数；获得高评价时，在当前层获得 $s_{i,2}$ 的分数。这部分获得的分数**不会直接加算**到玩家的总分数中，而是**在退出迷宫时结算**。如果挑战成功，且当前不是最后一层（$i<N$），则跳转到第 3 步，选择是否继续挑战；否则（$i=N$），退出迷宫并跳转到第 4 步进行结算。\n   \n   - 如果挑战失败，则强制退出迷宫，跳转到第 4 步。\n\n3. 如果当前不是最后一层，玩家可以选择是否继续挑战下一层。如果选择继续，则返回第 2 步；否则退出当前迷宫，跳转到第 4 步进行结算。\n\n4. 本次迷宫的分数结算：如果因为失败而强制退出，则当前层不获得任何奖励，且**本次迷宫中之前各层**累积的分数需要乘上惩罚系数 $c$（为了使最终分数为整数，游戏会对惩罚后的分数先求和再下取整）；除了强制退出之外，玩家主动退出或者通关迷宫后退出都可以获得全部尚未结算的分数。\n\n小 S 想得到的目标分数是一个比较大的分数，因此小 S 需要先大量刷最高难度的迷宫，再在接近目标分数时根据当前剩余的分数选择相对稳定的策略，以确保活动结束时能恰好获得目标分数。小 S 不会编程，因此小 S 找到了你，希望你能帮忙计算当剩余分数在 $1$ 至 $M$ 分之间，仅按照上述的流程挑战迷宫，并采用最佳策略时，最终能够恰好达到目标分数的最大概率。", "inputFormat": "输入的第一行包含三个整数 $N, M, c'$，其中 $N$ 和 $M$ 的含义与题面相同，$c'=100c$。保证 $1\\le N\\le 6$，$1\\le M\\le 10000$，$0\\le c'\\le 100$。\n\n接下来 $N$ 行，每行输入八个整数 $s_{i,1},s_{i,2},u_{i,0},u_{i,1},u_{i,2}, v_{i,0}, v_{i,1}, v_{i,2}$，其中 $s_{i,1}$ 与 $s_{i,2}$ 分别表示挑战时普通评价和高评价对应的分数；$u_{i,j}$ 和 $v_{i,j}$ 分别表示使用保守的挑战策略及激进的挑战策略时，对应结果的概率权重：$p_{i,j}=\\dfrac{u_{i,j}}{u_{i,0}+u_{i,1}+u_{i,2}}$，$q_{i,j}=\\dfrac{v_{i,j}}{v_{i,0}+v_{i,1}+v_{i,2}}$。保证 $1\\le s_{i, 1} \\le s_{i, 2}\\le 10000$，$0\\le u_{i,j}, v_{i,j}\\le 10000$ 且 $u_{i,1}+u_{i,2}\\ge 1$，$v_{i,1}+v_{i,2}\\ge 1$。", "outputFormat": "输出一行 $M$ 个实数，其中第 $i$ （$1\\le i\\le M$）个实数表示当距离目标分数恰好还剩 $i$ 分时，在最优策略下能够恰好获得 $i$ 分的最大概率。 当你输出中的每个实数与相应标准输出的绝对误差不超过 $10^{-6}$ 时，我们认为你的输出是正确的。", "hint": "#### 子任务\n\n对于 $100\\%$ 的数据，保证 $1\\le N\\le 6$，$1\\le M\\le 10000$，$0\\le c'\\le 100$，$1\\le s_{i,1}\\le s_{i, 2}\\le 10000$，$0\\le u_{i, 0}, u_{i, 1}, u_{i, 2}, v_{i, 0}, v_{i, 1}, v_{i, 2}\\le 10000$，$u_{i,1}+u_{i,2}\\ge 1$，$v_{i,1}+v_{i,2}\\ge 1$。\n\n#### 提示\n\n《La Lumière: Scarlet Intense Flame 2》将于 2023 年春暖花开的时节与大家相见！\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN"}}}
{"pid": "P9145", "type": "P", "difficulty": 0, "samples": [], "limits": {"time": [1000], "memory": [524288]}, "tags": ["2023", "O2优化", "THUPC"], "title": "[THUPC 2023 初赛] 世界杯", "background": "", "description": "2022 年卡塔尔世界杯已于 12 月 18 日落下帷幕，作为一项始于 1930 年的悠久赛事，迄今已走过 22 届，四年一度的足球盛宴，是陪伴全世界无数足球运动员和爱好者成长的荣耀时光和青春记忆。\n\n作为一个新球迷，小 M 在这届世界杯前对足球几乎一无所知，但受到身边小伙伴的带动，他也决定加入到球迷的大家庭中。赛前，小 M 对世界杯进行了一定的了解，得知世界杯正赛共分为小组赛和淘汰赛，其中淘汰赛尤为刺激，16 强、8 强、半决赛、决赛，只要输一场便立刻淘汰出局，唯有全胜者方能捧得桂冠。因此，小 M 心想，夺得世界杯冠军当然是无可争议的世界巅峰，而能否从小组赛出线杀入淘汰赛、以及在淘汰赛阶段走得多远，也同样是衡量一支队伍强弱的重要指标。\n\n世界杯正赛共有 32 支球队参加，而遗憾落选的队伍则更多。全世界这么多支球队，对于萌新小 M 来说，逐一去了解难免是一个浩大的工作。因此，小 M 决定先从联合国五常来入手，对应的 5 支球队分别为：中国队（`China`）、英格兰队（`England`）、法国队（`France`）、俄罗斯队（`Russia`）和美国队（`United States`）。值得一提的是，苏格兰队和威尔士队也曾打进过世界杯正赛，但以小 M 的知识水平来说，显然忽略了它们。\n\n随后，小 M 仔细调查了这 5 支球队的历届世界杯战绩：英格兰队、法国队和美国队在近 30 年来均有至少 4 次杀入世界杯淘汰赛的经历，其中法国队收获了 1998、2018 世界杯的冠军，虽也有过小组赛 2 败出局的经历，但已足够向世界展示其强大；英格兰队唯一的世界杯冠军在 1966 年，近年来最好战绩为四强，而美国队近年来最好战绩为八强，这两支队伍的实力也都不容小觑；俄罗斯队近 30 年来的前 3 次世界杯之旅都不顺利，在小组赛阶段便早早接连失利并被淘汰，但 2018 年以东道主的身份打入淘汰赛并杀入八强；而中国队则实力稍逊，唯一一次打入世界杯正赛是在 2002 年，但小组赛三战全败，只得遗憾出局。\n\n正像无数球迷心中都有一支“主队”，小 M 也希望从这 5 支球队中选出一支“最强球队”，作为他今后支持的对象。在他进一步了解后，也知道了评价一支球队有各项指标，这几支球队也似乎各有所长。到底该怎样衡量“最强”呢？小 M 思来想去，决定以“世界杯正赛中输球总场数最少”作为衡量依据。又经过了细致的查找资料和分析，他心中的“最强球队”已经呼之欲出。\n\n此时，他想考考屏幕前的你：能猜出他心中的“最强球队”是哪一支吗？", "inputFormat": "无输入。", "outputFormat": "输出一个字符串，一定是 `China`，`England`，`France`，`Russia`，`United States` 中的一个，表示小 M 心中的“最强球队”。", "hint": "#### 提示\n\n题面所述信息已经足以推断出问题的答案，无需任何额外的足球知识。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[THUPC 2023 初赛] 世界杯", "background": "", "description": "2022 年卡塔尔世界杯已于 12 月 18 日落下帷幕，作为一项始于 1930 年的悠久赛事，迄今已走过 22 届，四年一度的足球盛宴，是陪伴全世界无数足球运动员和爱好者成长的荣耀时光和青春记忆。\n\n作为一个新球迷，小 M 在这届世界杯前对足球几乎一无所知，但受到身边小伙伴的带动，他也决定加入到球迷的大家庭中。赛前，小 M 对世界杯进行了一定的了解，得知世界杯正赛共分为小组赛和淘汰赛，其中淘汰赛尤为刺激，16 强、8 强、半决赛、决赛，只要输一场便立刻淘汰出局，唯有全胜者方能捧得桂冠。因此，小 M 心想，夺得世界杯冠军当然是无可争议的世界巅峰，而能否从小组赛出线杀入淘汰赛、以及在淘汰赛阶段走得多远，也同样是衡量一支队伍强弱的重要指标。\n\n世界杯正赛共有 32 支球队参加，而遗憾落选的队伍则更多。全世界这么多支球队，对于萌新小 M 来说，逐一去了解难免是一个浩大的工作。因此，小 M 决定先从联合国五常来入手，对应的 5 支球队分别为：中国队（`China`）、英格兰队（`England`）、法国队（`France`）、俄罗斯队（`Russia`）和美国队（`United States`）。值得一提的是，苏格兰队和威尔士队也曾打进过世界杯正赛，但以小 M 的知识水平来说，显然忽略了它们。\n\n随后，小 M 仔细调查了这 5 支球队的历届世界杯战绩：英格兰队、法国队和美国队在近 30 年来均有至少 4 次杀入世界杯淘汰赛的经历，其中法国队收获了 1998、2018 世界杯的冠军，虽也有过小组赛 2 败出局的经历，但已足够向世界展示其强大；英格兰队唯一的世界杯冠军在 1966 年，近年来最好战绩为四强，而美国队近年来最好战绩为八强，这两支队伍的实力也都不容小觑；俄罗斯队近 30 年来的前 3 次世界杯之旅都不顺利，在小组赛阶段便早早接连失利并被淘汰，但 2018 年以东道主的身份打入淘汰赛并杀入八强；而中国队则实力稍逊，唯一一次打入世界杯正赛是在 2002 年，但小组赛三战全败，只得遗憾出局。\n\n正像无数球迷心中都有一支“主队”，小 M 也希望从这 5 支球队中选出一支“最强球队”，作为他今后支持的对象。在他进一步了解后，也知道了评价一支球队有各项指标，这几支球队也似乎各有所长。到底该怎样衡量“最强”呢？小 M 思来想去，决定以“世界杯正赛中输球总场数最少”作为衡量依据。又经过了细致的查找资料和分析，他心中的“最强球队”已经呼之欲出。\n\n此时，他想考考屏幕前的你：能猜出他心中的“最强球队”是哪一支吗？", "inputFormat": "无输入。", "outputFormat": "输出一个字符串，一定是 `China`，`England`，`France`，`Russia`，`United States` 中的一个，表示小 M 心中的“最强球队”。", "hint": "#### 提示\n\n题面所述信息已经足以推断出问题的答案，无需任何额外的足球知识。\n\n#### 题目来源\n\n来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。\n\n题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。", "locale": "zh-CN"}}}
{"pid": "P9147", "type": "P", "difficulty": 3, "samples": [["5\n1 4 2 2 3\n", "3\n"], ["5\n1 2 3 2 1\n", "4\n"], ["5\n1 2 3 1 5\n", "5\n"], ["6\n8 2 3 1 4 5\n", "4\n"], ["6\n7 2 9 4 5 6\n", "5\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144]}, "tags": ["动态规划 DP", "贪心", "洛谷原创", "O2优化", "洛谷月赛"], "title": "签到题", "background": "著名的【数据删除】是一个热爱旅游的人！这一天他来到了神秘的 ZYL 国度。\n\n入海关的时候他被问到了一个题目，如果答对他就可以顺利到达 ZYL 的首都 ZY 了！身为堂堂【数据删除】，他居然还花了 $10^{-233}$ 秒才想出来做法，实在是有点难的！于是他决定拿来考考你。", "description": "给定长度为 $n$ 的序列 $a$，保证 $a_i$ 是**正整数**。你需要选择一个位置 $i$ 并将 $a_i$ 修改为一个**任意的整数**。最大化最长**严格**上升子串的长度。\n\n所谓严格上升子串，就是从序列中选出位置**连续**的若干个数字，满足后一个数字比前一个大（而不能相等或小于）。\n\n如序列 $[1,4,2,3,5]$ 中，子序列 $[2,3,5]$ 就是严格上升子串，而 $[4,2,3]$（不上升）和 $[1,2,3]$（不连续）则不是。", "inputFormat": "第一行，一个正整数 $n$，表示序列的长度。\n\n第二行，$n$ 个正整数 $a_1, a_2, \\ldots, a_n$，表示序列 $a$。", "outputFormat": "输出一行一个整数，表示修改后，你最大化的最长严格上升子串的长度。", "hint": "**【样例解释 \\#1】**\n\n对于样例 \\#1，我们可以将序列 $[1,4,2,2,3]$ 中的第三个位置修改为 $5$，得到新序列 $[1,4,5,2,3]$。这个序列的最长严格上升子串是 $[1,4,5]$，长度为 $3$。\n\n容易证明，不存在一种修改方案使得修改后的序列的最长严格上升子串的长度大于 $3$。\n\n---\n\n**【样例解释 \\#4】**\n\n对于样例 \\#4，我们可以将序列 $[8,2,3,1,4,5]$ 中的第三个位置修改为 $0$，得到新序列 $[8,2,0,1,4,5]$。这个序列的最长严格上升子串是 $[0,1,4,5]$，长度为 $4$。\n\n容易证明，不存在一种修改方案使得修改后的序列的最长严格上升子串的长度大于 $4$。\n\n---\n\n**【数据范围】**\n\n对于前 $20\\%$ 的数据，满足 $n \\le 5$，$a_i \\le 5$。  \n对于前 $40\\%$ 的数据，满足 $n \\le 10$，$a_i \\le 10$。  \n对于前 $70\\%$ 的数据，满足 $n \\le 300$。  \n对于 $100 \\%$ 的数据，满足 $1 \\le n \\le {10}^6$，$1 \\le a_i \\le {10}^9$。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "签到题", "background": "著名的【数据删除】是一个热爱旅游的人！这一天他来到了神秘的 ZYL 国度。\n\n入海关的时候他被问到了一个题目，如果答对他就可以顺利到达 ZYL 的首都 ZY 了！身为堂堂【数据删除】，他居然还花了 $10^{-233}$ 秒才想出来做法，实在是有点难的！于是他决定拿来考考你。", "description": "给定长度为 $n$ 的序列 $a$，保证 $a_i$ 是**正整数**。你需要选择一个位置 $i$ 并将 $a_i$ 修改为一个**任意的整数**。最大化最长**严格**上升子串的长度。\n\n所谓严格上升子串，就是从序列中选出位置**连续**的若干个数字，满足后一个数字比前一个大（而不能相等或小于）。\n\n如序列 $[1,4,2,3,5]$ 中，子序列 $[2,3,5]$ 就是严格上升子串，而 $[4,2,3]$（不上升）和 $[1,2,3]$（不连续）则不是。", "inputFormat": "第一行，一个正整数 $n$，表示序列的长度。\n\n第二行，$n$ 个正整数 $a_1, a_2, \\ldots, a_n$，表示序列 $a$。", "outputFormat": "输出一行一个整数，表示修改后，你最大化的最长严格上升子串的长度。", "hint": "**【样例解释 \\#1】**\n\n对于样例 \\#1，我们可以将序列 $[1,4,2,2,3]$ 中的第三个位置修改为 $5$，得到新序列 $[1,4,5,2,3]$。这个序列的最长严格上升子串是 $[1,4,5]$，长度为 $3$。\n\n容易证明，不存在一种修改方案使得修改后的序列的最长严格上升子串的长度大于 $3$。\n\n---\n\n**【样例解释 \\#4】**\n\n对于样例 \\#4，我们可以将序列 $[8,2,3,1,4,5]$ 中的第三个位置修改为 $0$，得到新序列 $[8,2,0,1,4,5]$。这个序列的最长严格上升子串是 $[0,1,4,5]$，长度为 $4$。\n\n容易证明，不存在一种修改方案使得修改后的序列的最长严格上升子串的长度大于 $4$。\n\n---\n\n**【数据范围】**\n\n对于前 $20\\%$ 的数据，满足 $n \\le 5$，$a_i \\le 5$。  \n对于前 $40\\%$ 的数据，满足 $n \\le 10$，$a_i \\le 10$。  \n对于前 $70\\%$ 的数据，满足 $n \\le 300$。  \n对于 $100 \\%$ 的数据，满足 $1 \\le n \\le {10}^6$，$1 \\le a_i \\le {10}^9$。", "locale": "zh-CN"}}}
{"pid": "P9148", "type": "P", "difficulty": 4, "samples": [["4\n1 2 3 4\n", "36\n"], ["6\n8 6 4 2 10 15\n", "268\n"]], "limits": {"time": [5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["数学", "数论", "洛谷原创", "O2优化", "组合数学", "前缀和", "洛谷月赛"], "title": "除法题", "background": "", "description": "给定大小为 $n$ 的集合 $a$，保证其中元素互不相同且均为正整数。\n\n如果我们从中**按顺序**取出三个元素 $a, b, c$，则共有 $n \\cdot (n-1) \\cdot (n-2)$ 种不同的选择方案。\n\n现在对于一种选择方案 $(a,b,c)$，定义其权值为 $\\Bigl\\lfloor\\dfrac{a}{b}\\Bigr\\rfloor\\Bigl\\lfloor\\dfrac{a}{c}\\Bigr\\rfloor\\Bigl\\lfloor\\dfrac{b}{c}\\Bigr\\rfloor$。\n\n你需要对所有的选择方案计算权值的总和，你只需输出这个总和对 $2^{32}$ 取模的结果。\n\n注：$\\lfloor a\\rfloor$ 表示不大于 $a$ 的最大整数。如 $\\lfloor 2.4\\rfloor=2$、$\\lfloor 5\\rfloor=5$。", "inputFormat": "第一行，一个正整数 $n$，表示序列的长度。\n\n第二行，$n$ 个正整数 $a_1, a_2, \\ldots, a_n$，每个数描述了集合 $a$ 的一个元素，这些数互不相同。", "outputFormat": "输出一行一个整数，表示答案对 $2^{32}$ 取模的结果。", "hint": "**【样例解释 \\#1】**\n\n对于样例 \\#1，权值不为 $0$ 的选择方案只有以下几种：\n\n- $(3,2,1)$，权值为 $6$。\n- $(4,2,1)$，权值为 $16$。\n- $(4,3,1)$，权值为 $12$。\n- $(4,3,2)$，权值为 $2$。\n\n因此，样例 \\#1 的答案为 $6+16+12+2=36$。\n\n---\n\n**【数据范围】**\n\n对于 $100\\%$ 的数据，$1 \\le n, a_i \\le 5000$。\n\n**本题采用捆绑测试。**\n\n|子任务|$n$|特殊性质|分值|\n|-|-|-|-|\n|1|$=3$||$10$|\n|2|$\\le 300$||$20$|\n|3|$\\le 2000$||$20$|\n|4||A|$20$|\n|5|||$30$|\n\n特殊性质 A：保证 $a_i=i$。\n\n---\n\n**【提示】**\n\n本题中大部分算法都拥有较小的常数，请相信你的复杂度。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "除法题", "background": "", "description": "给定大小为 $n$ 的集合 $a$，保证其中元素互不相同且均为正整数。\n\n如果我们从中**按顺序**取出三个元素 $a, b, c$，则共有 $n \\cdot (n-1) \\cdot (n-2)$ 种不同的选择方案。\n\n现在对于一种选择方案 $(a,b,c)$，定义其权值为 $\\Bigl\\lfloor\\dfrac{a}{b}\\Bigr\\rfloor\\Bigl\\lfloor\\dfrac{a}{c}\\Bigr\\rfloor\\Bigl\\lfloor\\dfrac{b}{c}\\Bigr\\rfloor$。\n\n你需要对所有的选择方案计算权值的总和，你只需输出这个总和对 $2^{32}$ 取模的结果。\n\n注：$\\lfloor a\\rfloor$ 表示不大于 $a$ 的最大整数。如 $\\lfloor 2.4\\rfloor=2$、$\\lfloor 5\\rfloor=5$。", "inputFormat": "第一行，一个正整数 $n$，表示序列的长度。\n\n第二行，$n$ 个正整数 $a_1, a_2, \\ldots, a_n$，每个数描述了集合 $a$ 的一个元素，这些数互不相同。", "outputFormat": "输出一行一个整数，表示答案对 $2^{32}$ 取模的结果。", "hint": "**【样例解释 \\#1】**\n\n对于样例 \\#1，权值不为 $0$ 的选择方案只有以下几种：\n\n- $(3,2,1)$，权值为 $6$。\n- $(4,2,1)$，权值为 $16$。\n- $(4,3,1)$，权值为 $12$。\n- $(4,3,2)$，权值为 $2$。\n\n因此，样例 \\#1 的答案为 $6+16+12+2=36$。\n\n---\n\n**【数据范围】**\n\n对于 $100\\%$ 的数据，$1 \\le n, a_i \\le 5000$。\n\n**本题采用捆绑测试。**\n\n|子任务|$n$|特殊性质|分值|\n|-|-|-|-|\n|1|$=3$||$10$|\n|2|$\\le 300$||$20$|\n|3|$\\le 2000$||$20$|\n|4||A|$20$|\n|5|||$30$|\n\n特殊性质 A：保证 $a_i=i$。\n\n---\n\n**【提示】**\n\n本题中大部分算法都拥有较小的常数，请相信你的复杂度。", "locale": "zh-CN"}}}
{"pid": "P9149", "type": "P", "difficulty": 5, "samples": [["2\n4 2 3 1\n1 1 2 1\n1 1\n8 3 4 1\n1 2 3 1 2 3 1 2\n1 2 1\n", "3\n2\n"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144]}, "tags": ["字符串", "数学", "洛谷原创", "O2优化", "组合数学", "KMP 算法", "洛谷月赛"], "title": "串串题", "background": "", "description": "给定长度分别为 $n,m$ 的整数序列 $A,B$ 和常数 $W,d$，序列从 $1$ 开始标号，保证 $A_i,B_i \\in [1,W]$。\n\n容易发现，我们有 $\\binom{W}{d}$ 种方案选择 $[1,W]$ 中的 $d$ 个互不相同的整数。\n\n对于每一种选择的方案，我们删去 $A$ 中出现的对应的 $d$ 种整数，令此时序列 $B$ 在序列 $A$ 中的出现次数为这次选择方案的权值。\n\n你需要求所有的选择方案的权值和，对 ${10}^9+7$ 取模。\n\n若对题意有疑问，请阅读样例及样例解释。\n\n注：$\\binom{a}{b}$ 表示组合数，含义为在 $a$ 个物品中**无序**地选择出 $b$ 个物品的方案数。\n\n**请注意：我们并不会删除序列 $\\bm{B}$ 中出现的对应整数。**", "inputFormat": "**本题有多组数据。**\n\n第一行，一个正整数 $T$，表示数据组数。对于每组数据：\n\n第一行，四个正整数 $n, m, W, d$，保证 $d \\le W$。\n\n第二行，$n$ 个正整数 $A_1, A_2, \\ldots, A_n$，表示序列 $A$。\n\n第三行，$m$ 个正整数 $B_1, B_2, \\ldots, B_m$，表示序列 $B$。", "outputFormat": "对于每组数据，输出一个整数表示答案对 ${10}^9+7$ 取模的结果。", "hint": "**【样例解释】**\n\n在样例的第一组数据中：\n\n1. 如果我们选择删去 $A$ 中的字符 $1$，$A$ 将变为 $\\{2\\}$，此时 $B$ 在 $A$ 中的出现次数为 $0$。\n1. 如果我们选择删去 $A$ 中的字符 $2$，$A$ 将变为 $\\{1,1,1\\}$，此时 $B$ 在 $A$ 中的出现次数为 $2$。\n1. 如果我们选择删去 $A$ 中的字符 $3$，$A$ 将变为 $\\{1,1,2,1\\}$，此时 $B$ 在 $A$ 中的出现次数为 $1$。\n\n因此，第一组数据的答案为 $0+2+1=3$。\n\n**再次提醒：我们并不会删除序列 $\\bm{B}$ 中出现的对应整数。**\n\n---\n\n**【数据范围】**\n\n对于 $100\\%$ 的数据，$1 \\le n,m,W \\le {10}^6$，$1 \\le d, A_i, B_j \\le W$，$1 \\le T \\le 5$。\n\n**本题采用捆绑测试且开启子任务依赖！**\n\n| 子任务 | $n \\le$ | $m \\le$ | $W \\le$ | 特殊性质 | 分数 | 依赖 |\n| - | - | - | - | - | - | - |\n| 1 | $10$ | $10$ | $5$ | | $10$ | \\ |\n| 2 | $1000$ | $1000$ | $5$ | | $20$ | 子任务 1 |\n| 3 |  | | | A | $15$ | \\ |\n| 4 |  | | | B | $25$ | \\ |\n| 5 | | | | | $30$ | 子任务 1、2、3、4 |\n\n特殊性质 A：保证 $d=1$。\n\n特殊性质 B：令 $c$ 表示仅在序列 $A$ 中出现，而不在序列 $B$ 中出现的数字总数。保证 $c \\le 5$。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "串串题", "background": "", "description": "给定长度分别为 $n,m$ 的整数序列 $A,B$ 和常数 $W,d$，序列从 $1$ 开始标号，保证 $A_i,B_i \\in [1,W]$。\n\n容易发现，我们有 $\\binom{W}{d}$ 种方案选择 $[1,W]$ 中的 $d$ 个互不相同的整数。\n\n对于每一种选择的方案，我们删去 $A$ 中出现的对应的 $d$ 种整数，令此时序列 $B$ 在序列 $A$ 中的出现次数为这次选择方案的权值。\n\n你需要求所有的选择方案的权值和，对 ${10}^9+7$ 取模。\n\n若对题意有疑问，请阅读样例及样例解释。\n\n注：$\\binom{a}{b}$ 表示组合数，含义为在 $a$ 个物品中**无序**地选择出 $b$ 个物品的方案数。\n\n**请注意：我们并不会删除序列 $\\bm{B}$ 中出现的对应整数。**", "inputFormat": "**本题有多组数据。**\n\n第一行，一个正整数 $T$，表示数据组数。对于每组数据：\n\n第一行，四个正整数 $n, m, W, d$，保证 $d \\le W$。\n\n第二行，$n$ 个正整数 $A_1, A_2, \\ldots, A_n$，表示序列 $A$。\n\n第三行，$m$ 个正整数 $B_1, B_2, \\ldots, B_m$，表示序列 $B$。", "outputFormat": "对于每组数据，输出一个整数表示答案对 ${10}^9+7$ 取模的结果。", "hint": "**【样例解释】**\n\n在样例的第一组数据中：\n\n1. 如果我们选择删去 $A$ 中的字符 $1$，$A$ 将变为 $\\{2\\}$，此时 $B$ 在 $A$ 中的出现次数为 $0$。\n1. 如果我们选择删去 $A$ 中的字符 $2$，$A$ 将变为 $\\{1,1,1\\}$，此时 $B$ 在 $A$ 中的出现次数为 $2$。\n1. 如果我们选择删去 $A$ 中的字符 $3$，$A$ 将变为 $\\{1,1,2,1\\}$，此时 $B$ 在 $A$ 中的出现次数为 $1$。\n\n因此，第一组数据的答案为 $0+2+1=3$。\n\n**再次提醒：我们并不会删除序列 $\\bm{B}$ 中出现的对应整数。**\n\n---\n\n**【数据范围】**\n\n对于 $100\\%$ 的数据，$1 \\le n,m,W \\le {10}^6$，$1 \\le d, A_i, B_j \\le W$，$1 \\le T \\le 5$。\n\n**本题采用捆绑测试且开启子任务依赖！**\n\n| 子任务 | $n \\le$ | $m \\le$ | $W \\le$ | 特殊性质 | 分数 | 依赖 |\n| - | - | - | - | - | - | - |\n| 1 | $10$ | $10$ | $5$ | | $10$ | \\ |\n| 2 | $1000$ | $1000$ | $5$ | | $20$ | 子任务 1 |\n| 3 |  | | | A | $15$ | \\ |\n| 4 |  | | | B | $25$ | \\ |\n| 5 | | | | | $30$ | 子任务 1、2、3、4 |\n\n特殊性质 A：保证 $d=1$。\n\n特殊性质 B：令 $c$ 表示仅在序列 $A$ 中出现，而不在序列 $B$ 中出现的数字总数。保证 $c \\le 5$。", "locale": "zh-CN"}}}
{"pid": "P9150", "type": "P", "difficulty": 6, "samples": [["3\n4 5\n2 3 4 1\n1 2\n2 3\n3 1\n1 4\n4 3\n5 6\n2 3 4 5 1\n1 2\n2 3\n3 4\n4 5\n5 2\n4 1\n3 2\n2 3 1\n1 2\n1 3\n", "4 4\n2 1\n1 1\n1 1\n5 5\n5 5\n3 1\n2 1\n1 1\n2 1\n1 1\n1 1\n"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["图论", "洛谷原创", "O2优化", "强连通分量", "洛谷月赛", "均摊分析"], "title": "邮箱题", "background": "邮箱，一种历史悠久的接信箱子。西方的邮箱以红色为主，东方的邮箱以绿色为主。", "description": "有一张 $n$ 个点和 $m$ 条边构成的**有向**图。每个点内都有一把另一个点的钥匙，$i$ 号点内有 $k_i$ 号点的钥匙。你能进入一个点当且仅当你有该点的钥匙。保证 $k_i$ 构成排列。\n\n只要进入了一个点，就获得了这个点内有的钥匙。一旦获得钥匙就不会被消耗。\n\n现在你拿到了 $i$ 号点的钥匙并到了 $i$ 号点。你需要对每个 $i$ 求出：\n\n1. 有多少点能被你到达。\n2. 有多少点能被你到达并返回起点 $i$。\n\n**请注意：给出的边均是有向边！**", "inputFormat": "**本题有多组数据。**\n\n第一行，一个正整数 $T$，表示数据的组数。对于每组数据：\n\n第一行，两个整数 $n,m$，表示图的点数和边数。\n\n第二行，$n$ 个整数 $k_1, k_2, \\ldots, k_n$，表示 $i$ 号点内有 $k_i$ 号点的钥匙。保证 $k_i$ 构成排列。\n\n接下来 $m$ 行，每行两个整数 $x, y$，表示图上的一条从 $x$ 指向 $y$ 的有向边。保证不含重边或自环。", "outputFormat": "对于每组数据，输出 $n$ 行，每行两个整数，第 $i$ 行的整数分别表示从 $i$ 号点出发，能到达的点数和能到达并返回起点的点数。", "hint": "**【样例解释】**\n\n以下是第一组数据的解释：（图中括号内的内容为点上的钥匙编号）\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/hrserkw2.png)\n\n1. $1$ 能到达的结点集合为 $\\{1,2,3,4\\}$，$1$ 能到达且能返回 $1$ 的结点集合为 $\\{1,2,3,4\\}$；\n2. $2$ 能到达的结点集合为 $\\{2,3\\}$，$2$ 能到达且能返回 $2$ 的结点集合为 $\\{2\\}$；\n3. $3$ 能到达的结点集合为 $\\{3\\}$，$3$ 能到达且能返回 $3$ 的结点集合为 $\\{3\\}$；\n4. $4$ 能到达的结点集合为 $\\{4\\}$，$4$ 能到达且能返回 $4$ 的结点集合为 $\\{4\\}$。\n\n这是一个合法的遍历过程：从 $1$ 开始，初始钥匙为 $2$，到达结点 $2$ 并获得钥匙 $3$，到达结点 $3$ 并获得钥匙 $4$，回到结点 $1$，到达结点 $4$ 并获得钥匙 $1$，到达结点 $3$，回到结点 $1$。\n\n**【数据范围】**\n\n对于 $100\\%$ 的数据，满足 $n \\ge 3$，$m\\ge 0$，$\\sum n\\le 1.5\\times{10}^6$，$\\sum m\\le 3\\times{10}^6$，$1 \\le T\\le 2\\times{10}^4$，$1 \\le x, y \\le n$，保证图中不含重边或自环。\n\n**本题采用捆绑测试且开启子任务依赖！**\n\n|子任务|对 $n$ 的约束|对 $m$ 的约束|分值|依赖|\n|-|-|-|-|-|\n|1|$n\\le 6$|$m\\le 12$|$20$|\\ |\n|2|$\\sum n^3\\le {10}^7$|$\\sum m^3\\le 2\\times {10}^7$|$25$|\\ |\n|3|$\\sum n^2\\le {10}^8$|$\\sum m^2\\le {10}^8$|$25$|子任务 1、2|\n|4|||$30$|子任务 1、2、3|", "locale": "zh-CN", "translations": {"zh-CN": {"title": "邮箱题", "background": "邮箱，一种历史悠久的接信箱子。西方的邮箱以红色为主，东方的邮箱以绿色为主。", "description": "有一张 $n$ 个点和 $m$ 条边构成的**有向**图。每个点内都有一把另一个点的钥匙，$i$ 号点内有 $k_i$ 号点的钥匙。你能进入一个点当且仅当你有该点的钥匙。保证 $k_i$ 构成排列。\n\n只要进入了一个点，就获得了这个点内有的钥匙。一旦获得钥匙就不会被消耗。\n\n现在你拿到了 $i$ 号点的钥匙并到了 $i$ 号点。你需要对每个 $i$ 求出：\n\n1. 有多少点能被你到达。\n2. 有多少点能被你到达并返回起点 $i$。\n\n**请注意：给出的边均是有向边！**", "inputFormat": "**本题有多组数据。**\n\n第一行，一个正整数 $T$，表示数据的组数。对于每组数据：\n\n第一行，两个整数 $n,m$，表示图的点数和边数。\n\n第二行，$n$ 个整数 $k_1, k_2, \\ldots, k_n$，表示 $i$ 号点内有 $k_i$ 号点的钥匙。保证 $k_i$ 构成排列。\n\n接下来 $m$ 行，每行两个整数 $x, y$，表示图上的一条从 $x$ 指向 $y$ 的有向边。保证不含重边或自环。", "outputFormat": "对于每组数据，输出 $n$ 行，每行两个整数，第 $i$ 行的整数分别表示从 $i$ 号点出发，能到达的点数和能到达并返回起点的点数。", "hint": "**【样例解释】**\n\n以下是第一组数据的解释：（图中括号内的内容为点上的钥匙编号）\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/hrserkw2.png)\n\n1. $1$ 能到达的结点集合为 $\\{1,2,3,4\\}$，$1$ 能到达且能返回 $1$ 的结点集合为 $\\{1,2,3,4\\}$；\n2. $2$ 能到达的结点集合为 $\\{2,3\\}$，$2$ 能到达且能返回 $2$ 的结点集合为 $\\{2\\}$；\n3. $3$ 能到达的结点集合为 $\\{3\\}$，$3$ 能到达且能返回 $3$ 的结点集合为 $\\{3\\}$；\n4. $4$ 能到达的结点集合为 $\\{4\\}$，$4$ 能到达且能返回 $4$ 的结点集合为 $\\{4\\}$。\n\n这是一个合法的遍历过程：从 $1$ 开始，初始钥匙为 $2$，到达结点 $2$ 并获得钥匙 $3$，到达结点 $3$ 并获得钥匙 $4$，回到结点 $1$，到达结点 $4$ 并获得钥匙 $1$，到达结点 $3$，回到结点 $1$。\n\n**【数据范围】**\n\n对于 $100\\%$ 的数据，满足 $n \\ge 3$，$m\\ge 0$，$\\sum n\\le 1.5\\times{10}^6$，$\\sum m\\le 3\\times{10}^6$，$1 \\le T\\le 2\\times{10}^4$，$1 \\le x, y \\le n$，保证图中不含重边或自环。\n\n**本题采用捆绑测试且开启子任务依赖！**\n\n|子任务|对 $n$ 的约束|对 $m$ 的约束|分值|依赖|\n|-|-|-|-|-|\n|1|$n\\le 6$|$m\\le 12$|$20$|\\ |\n|2|$\\sum n^3\\le {10}^7$|$\\sum m^3\\le 2\\times {10}^7$|$25$|\\ |\n|3|$\\sum n^2\\le {10}^8$|$\\sum m^2\\le {10}^8$|$25$|子任务 1、2|\n|4|||$30$|子任务 1、2、3|", "locale": "zh-CN"}}}
{"pid": "P9151", "type": "P", "difficulty": 7, "samples": [["4\n1001\n111000\n101010\n111000101010\n", "3\n7\n3\n25\n"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["动态规划 DP", "数学", "洛谷原创", "O2优化", "组合数学", "洛谷月赛"], "title": "计数题", "background": "[Easy Counting Problem](https://atcoder.jp/contests/agc022/tasks/agc022_e)\n\n> 身のうさを思ひしらでややみなまし そむくならひのなき世なりせば", "description": "给定长度为 $N$ 的 $01$ 串 $S$，你可以做若干个操作，形如将长度为 $3$ 的子串变成它们的中位数（注意是变成一个数字），问可以得到多少个不同的串。\n\n答案对 $998244353$ 取模。", "inputFormat": "本题有多组数据。第一行输入数据组数 $T$。\n\n对于每组数据，仅输入一个字符串 $S$ 表示给定的 $01$ 串。", "outputFormat": "对每组数据输出一行一个整数，表示答案对 $998244353$ 取模的结果。", "hint": "**【样例解释】**\n\n可以证明，$1001$ 仅能通过操作获得串 $10,01,1001$ ，因此样例第一组数据的答案为 $3$。\n\n---\n\n**【数据范围】**\n\n对于 $100 \\%$ 的数据，满足 $1\\le N \\le 5\\times {10}^6$，$S_i\\in\\{0,1\\}$，$1 \\le T \\le 5$。\n\n| 子任务 | $N \\le$ | 特殊性质 | 分数 |\n| - | - | - | - |\n| 1 | $10$ | | $5$ |\n| 2 | $50$ | | $10$ |\n| 3 | $300$ | | $10$ |\n| 4 | $2000$ | | $15$ |\n| 5 | | A | $5$ |\n| 6 | | B | $5$ |\n| 7 | ${10}^5$ | | $20$ |\n| 8 | | | $30$ |\n\n特殊性质 A：保证 $S_i=0$。\n\n特殊性质 B：保证 $S_{2k}=0$、$S_{2k+1}=1$。\n\n**字符串下标的编号从 $1$ 开始。**", "locale": "zh-CN", "translations": {"zh-CN": {"title": "计数题", "background": "[Easy Counting Problem](https://atcoder.jp/contests/agc022/tasks/agc022_e)\n\n> 身のうさを思ひしらでややみなまし そむくならひのなき世なりせば", "description": "给定长度为 $N$ 的 $01$ 串 $S$，你可以做若干个操作，形如将长度为 $3$ 的子串变成它们的中位数（注意是变成一个数字），问可以得到多少个不同的串。\n\n答案对 $998244353$ 取模。", "inputFormat": "本题有多组数据。第一行输入数据组数 $T$。\n\n对于每组数据，仅输入一个字符串 $S$ 表示给定的 $01$ 串。", "outputFormat": "对每组数据输出一行一个整数，表示答案对 $998244353$ 取模的结果。", "hint": "**【样例解释】**\n\n可以证明，$1001$ 仅能通过操作获得串 $10,01,1001$ ，因此样例第一组数据的答案为 $3$。\n\n---\n\n**【数据范围】**\n\n对于 $100 \\%$ 的数据，满足 $1\\le N \\le 5\\times {10}^6$，$S_i\\in\\{0,1\\}$，$1 \\le T \\le 5$。\n\n| 子任务 | $N \\le$ | 特殊性质 | 分数 |\n| - | - | - | - |\n| 1 | $10$ | | $5$ |\n| 2 | $50$ | | $10$ |\n| 3 | $300$ | | $10$ |\n| 4 | $2000$ | | $15$ |\n| 5 | | A | $5$ |\n| 6 | | B | $5$ |\n| 7 | ${10}^5$ | | $20$ |\n| 8 | | | $30$ |\n\n特殊性质 A：保证 $S_i=0$。\n\n特殊性质 B：保证 $S_{2k}=0$、$S_{2k+1}=1$。\n\n**字符串下标的编号从 $1$ 开始。**", "locale": "zh-CN"}}}
{"pid": "P9152", "type": "P", "difficulty": 7, "samples": [["5 3\n2 4 5 1 3\n3 5\n1 5\n1 4\n", "5\n12\n6\n"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536]}, "tags": ["洛谷原创", "O2优化", "分块", "洛谷月赛", "笛卡尔树"], "title": "待黑白分明", "background": "", "description": "[Shiro](https://www.bilibili.com/video/BV1jb411k7wa) 所在的城市可以看成数轴上 $n$ 个坐标连续的点，其中 $i$  号点的高度为 $p_i$，保证 $p$ 是一个 $\\{1,2,\\ldots,n\\}$ 的排列。\n\n3202 年的科技非常发达，发展出了虫洞列车技术。共有 $n$ 种列车，第 $i$ 种列车会经过所有高度大于等于 $i$ 的位置，每种列车线路都是双向的，也就是说可以乘列车从左到右，也可以从右到左。\n\nShiro 想在城市里转转，她定义一个位置集合 $S$ 合法，当且仅当我们将 $S$ 中的位置**按照高度排序**后，相邻的城市可以通过乘坐**一种**列车在中途不停靠的情况下直达。\n\n她会给你 $q$ 次询问，每次给定 $l,r$，你需要告诉 Shiro 所有位置的**高度**均在 $[l,r]$ 内的合法集合 $T$ 的数量对 $998244353$ 取模的结果。", "inputFormat": "第一行，两个正整数 $n,q$。\n\n第二行，$n$ 个正整数，表示 $p_{1,2,\\ldots,n}$。\n\n接下来 $q$ 行，第 $i$ 行两个正整数 $l_i, r_i$，表示第 $i$ 次询问的高度区间。", "outputFormat": "输出 $q$ 行，每行一个非负整数，表示答案。", "hint": "**【样例解释】**\n\n第一组询问解释：\n\n合法的高度集合有：$\\{3\\},\\{4\\},\\{5\\},\\{3,5\\},\\{4,5\\}$。\n\n---\n\n**【数据范围】**\n\n对于 $100 \\%$ 的数据，$1\\le n,q\\le 2\\times {10}^5$，保证 $p$ 是一个排列，且 $1\\le l_i \\le r_i \\le n$。\n\n|子任务|$n\\le$|$q\\le$|特殊性质|分值|\n|-|-|-|-|-|\n|1|$15$|$1000$||$10$|\n|2|$1000$|$1000$||$15$|\n|3|||A|$5$|\n|4|||B|$30$|\n|5|$5\\times{10}^4$|$5\\times{10}^4$||$20$|\n|6||||$20$|\n\n特殊性质 A：$p_i=i$。\n\n特殊性质 B：$p$ 在所有长度为 $n$ 的排列中随机选取。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "待黑白分明", "background": "", "description": "[Shiro](https://www.bilibili.com/video/BV1jb411k7wa) 所在的城市可以看成数轴上 $n$ 个坐标连续的点，其中 $i$  号点的高度为 $p_i$，保证 $p$ 是一个 $\\{1,2,\\ldots,n\\}$ 的排列。\n\n3202 年的科技非常发达，发展出了虫洞列车技术。共有 $n$ 种列车，第 $i$ 种列车会经过所有高度大于等于 $i$ 的位置，每种列车线路都是双向的，也就是说可以乘列车从左到右，也可以从右到左。\n\nShiro 想在城市里转转，她定义一个位置集合 $S$ 合法，当且仅当我们将 $S$ 中的位置**按照高度排序**后，相邻的城市可以通过乘坐**一种**列车在中途不停靠的情况下直达。\n\n她会给你 $q$ 次询问，每次给定 $l,r$，你需要告诉 Shiro 所有位置的**高度**均在 $[l,r]$ 内的合法集合 $T$ 的数量对 $998244353$ 取模的结果。", "inputFormat": "第一行，两个正整数 $n,q$。\n\n第二行，$n$ 个正整数，表示 $p_{1,2,\\ldots,n}$。\n\n接下来 $q$ 行，第 $i$ 行两个正整数 $l_i, r_i$，表示第 $i$ 次询问的高度区间。", "outputFormat": "输出 $q$ 行，每行一个非负整数，表示答案。", "hint": "**【样例解释】**\n\n第一组询问解释：\n\n合法的高度集合有：$\\{3\\},\\{4\\},\\{5\\},\\{3,5\\},\\{4,5\\}$。\n\n---\n\n**【数据范围】**\n\n对于 $100 \\%$ 的数据，$1\\le n,q\\le 2\\times {10}^5$，保证 $p$ 是一个排列，且 $1\\le l_i \\le r_i \\le n$。\n\n|子任务|$n\\le$|$q\\le$|特殊性质|分值|\n|-|-|-|-|-|\n|1|$15$|$1000$||$10$|\n|2|$1000$|$1000$||$15$|\n|3|||A|$5$|\n|4|||B|$30$|\n|5|$5\\times{10}^4$|$5\\times{10}^4$||$20$|\n|6||||$20$|\n\n特殊性质 A：$p_i=i$。\n\n特殊性质 B：$p$ 在所有长度为 $n$ 的排列中随机选取。", "locale": "zh-CN"}}}
{"pid": "P9153", "type": "P", "difficulty": 6, "samples": [["1\n3\n4 1 3\n4 7 7\n9 10 3\n", "31\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["欧拉回路"], "title": "「SvR-2」1+2=3（加强版）", "background": null, "description": "你有一些木棒，每个木棒左边有一个数，右边有一个数，数是 $[0,c)$ 的自然数，你要将所有木棒拼起来，使相邻的数和为 $c$ 的对数最大。\n\n例如，$c=3$，$1\\text{ - }2$ 和 $1\\text{ - }0$ 两个木棒，如果按 $1\\text{ - }0,1\\text{ - }2$ 这样拼，相邻的数和为 $3$ 的对数是 $0$；而按 $1\\text{ - }\\textcolor{red}{\\underline{\\textbf 2}},\\textcolor{red}{\\underline{\\textbf 1}}\\text{ - }0$ 这样拼相邻的数和为 $3$ 的对数是 $1$，因为 $2+1=3$。", "inputFormat": "**本题有多组数据。**\n\n输入的第一行一个正整数表示数据组数 $T$。\n\n对于每组数据，第一行输入一个正整数 $c$，之后 $c$ 行，每行 $c$ 个整数，第 $i$ 行第 $j$ 个整数 $a_{i,j}$ 为 $(i-1)\\text{ - }(j-1)$ 型木棒的个数。", "outputFormat": "共 $T$ 行，每行一个整数表示答案。", "hint": "对于 $100\\%$ 的数据，$1\\le T\\le10^5$，$1\\le a_{i,j}\\le10^9$，$3\\le c\\le10^3$，$\\sum c^2\\le5\\times10^6$。\n\n**注：本题数据较弱，如有 hack 欢迎告知出题人。**", "locale": "zh-CN", "translations": {"zh-CN": {"title": "「SvR-2」1+2=3（加强版）", "background": null, "description": "你有一些木棒，每个木棒左边有一个数，右边有一个数，数是 $[0,c)$ 的自然数，你要将所有木棒拼起来，使相邻的数和为 $c$ 的对数最大。\n\n例如，$c=3$，$1\\text{ - }2$ 和 $1\\text{ - }0$ 两个木棒，如果按 $1\\text{ - }0,1\\text{ - }2$ 这样拼，相邻的数和为 $3$ 的对数是 $0$；而按 $1\\text{ - }\\textcolor{red}{\\underline{\\textbf 2}},\\textcolor{red}{\\underline{\\textbf 1}}\\text{ - }0$ 这样拼相邻的数和为 $3$ 的对数是 $1$，因为 $2+1=3$。", "inputFormat": "**本题有多组数据。**\n\n输入的第一行一个正整数表示数据组数 $T$。\n\n对于每组数据，第一行输入一个正整数 $c$，之后 $c$ 行，每行 $c$ 个整数，第 $i$ 行第 $j$ 个整数 $a_{i,j}$ 为 $(i-1)\\text{ - }(j-1)$ 型木棒的个数。", "outputFormat": "共 $T$ 行，每行一个整数表示答案。", "hint": "对于 $100\\%$ 的数据，$1\\le T\\le10^5$，$1\\le a_{i,j}\\le10^9$，$3\\le c\\le10^3$，$\\sum c^2\\le5\\times10^6$。\n\n**注：本题数据较弱，如有 hack 欢迎告知出题人。**", "locale": "zh-CN"}}}
