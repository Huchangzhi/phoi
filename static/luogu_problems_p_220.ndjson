{"pid": "P5449", "type": "P", "difficulty": 0, "samples": [["2 4 4\n1 1 -1 -1\n0 10 0 -1\n1 -1 1 -1\n10 0 -1 0\n1 1\n2 1\n1 2\n2 2", "122\n144\n242\n244"]], "limits": {"time": [1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2018", "THUPC"], "title": "[THUPC 2018] 《算法与数据结构》小助教招募通知", "background": "T 大学和 U 大学是 W 国最好的两个大学。《算法与数据结构》是 U 大学的一门经典课程，曾连续百余年获得“U 大学一级精品课程”的荣誉。\n\n小 O 是这门课明年的助教。由于这门课过于火爆，他一个人忙不过来，所以他正在招募这门课的小助教。不过，招募的条件有点奇怪……", "description": "《算法与数据结构》课程的内容共分为 $n$ 个知识点，而每个知识点均有配套的的 $m$ 道练习题。每道题有两个属性值，第 $i$ 个知识点的第 $j$ 道练习题可以让做这道题的学生的算法能力提高 $a_{i, j}$，数据结构能力提高 $d_{i, j}$。这些属性值均为整数，但是可能为负数，甚至可能存在两个属性均为负的练习题。（不要问这种题是怎么被加进题库的…）\n\n明年的《算法与数据结构》课共有 $q$ 个学生注册。通过对每个学生以前学习情况的考察，小 O 决定对每个学生进行“因材施教”。具体方法是，对于第 $k$ 个学生、第 $i$ 个知识点，小 O 希望这个学生完成这个知识点的恰好 $c_{k, i}$ 道练习题。\n\n其实小 O 和 T 大学关系密切，希望在 U 大学搞点事情。对于每个学生，设为该学生选出的所有练习题对于算法能力与数据结构能力的提升分别为 $A$ 与 $D$，小 O 的目标是最大化 $A^2+D^2$，这样无论这个学生在哪个方面能力提升或降低的程度很大，都是小 O 所期望的。\n\n请对于每个学生计算这个目标的最大值。", "inputFormat": "每个输入文件仅包含一个测试数据。\n\n* 第一行包含三个正整数 $n, m, q$。\n\n* 接下来 $n$ 行，每行包含 $m$ 个整数；其中第 $i$ 行的第 $j$ 个整数为 $a_{i, j}$。\n\n* 接下来 $n$ 行，每行包含 $m$ 个整数；其中第 $i$ 行的第 $j$ 个整数为 $d_{i, j}$。\n\n* 接下来 $q$ 行，每行包含 $n$ 个整数；其中第 $k$ 行的第 $i$ 个整数为 $c_{k, i}$。\n\n对于输入的每一行，如果有多个数输入，则相邻两个数用恰好一个空格隔开。", "outputFormat": "输出 $q$ 行，每行 1 个整数：第 $k$ 行的整数表示第 $k$ 个学生的 $A^2+D^2$ 的最大值。", "hint": "### 样例解释\n\n有 2 个知识点，每个知识点有 4 道练习题；有 4 个学生。\n\n以第 2 个学生为例，我们需要为该学生在第 1 个知识点中选择恰好 2 道练习题，在第 2 个知识点中选择恰好 1 道练习题。一种最优的方案是，在第 1 个知识点中选择第 1 道题和第 3 道题，在第 2 个知识点中选择第 1 道题。这些题目对于算法能力的提高为 $A=a_{1,1}+a_{1,3}+a_{2,1}=1+(-1)+0=0$，对于数据结构能力的提高为 $D=d_{1,1}+d_{1,3}+d_{2,1}=1+1+10=12$，此时 $A^2+D^2=144$，并且不存在更优的方案。\n\n### 数据范围\n\n$1 \\leq n \\leq 6$，$1 \\leq m \\leq 666$，$1 \\leq q \\leq 666$，所有的 $a_{i, j}$ 与 $d_{i, j}$ 均在 $[-10^9,10^9]$ 范围内。\n对于最终测试数据，所有的 $c_{k, i}$ 均在 $[0, m]$ 范围内**独立、均匀**随机生成。\n\n### 提示\n\n输出的每个数可能非常大，甚至可能超过64位整数的范围。\n\n* C++语言可以使用`__int128_t`类型表示带符号128位整数，或使用`__uint128_t`类型表示无符号128位整数；这两种数据类型无法直接进行输入/输出。\n\n* Java语言可以使用`BigInteger`类。\n\n### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN", "translations": {"en": {"title": "[THUPC 2018] Recruitment Notice for Junior Teaching Assistants of \"Algorithms and Data Structures\"", "background": "University T and University U are the two best universities in Country W. \"Algorithms and Data Structures\" is a classic course at University U, and it has won the honor of \"University U First-Class Premium Course\" for more than one hundred consecutive years.\n\nLittle O is the TA for this course next year. Because the course is too popular, he cannot handle it alone, so he is recruiting junior teaching assistants for this course. However, the recruitment requirements are a bit strange...", "description": "The content of the course \"Algorithms and Data Structures\" is divided into $n$ knowledge points, and each knowledge point has $m$ corresponding practice problems. Each problem has two attribute values: the $j$-th practice problem of the $i$-th knowledge point can increase the algorithm ability of the student who solves it by $a_{i, j}$, and increase the data structure ability by $d_{i, j}$. These attribute values are all integers, but they may be negative, and there may even be practice problems where both attributes are negative. (Do not ask how such problems got into the problem set...)\n\nThere are $q$ students registered for next year's \"Algorithms and Data Structures\" course. By examining each student's previous learning situation, Little O decides to teach each student according to their aptitude. Specifically, for the $k$-th student and the $i$-th knowledge point, Little O wants this student to complete exactly $c_{k, i}$ practice problems of this knowledge point.\n\nIn fact, Little O has close ties with University T and wants to stir up some trouble at University U. For each student, let the total improvements in algorithm ability and data structure ability from all selected practice problems be $A$ and $D$, respectively. Little O's goal is to maximize $A^2 + D^2$. In this way, no matter how much the student's abilities increase or decrease in either aspect, it is what Little O wants.\n\nPlease compute the maximum value of this objective for each student.", "inputFormat": "Each input file contains only one testdata.\n\n* The first line contains three positive integers $n, m, q$.\n\n* The next $n$ lines each contain $m$ integers; in the $i$-th of these lines, the $j$-th integer is $a_{i, j}$.\n\n* The next $n$ lines each contain $m$ integers; in the $i$-th of these lines, the $j$-th integer is $d_{i, j}$.\n\n* The next $q$ lines each contain $n$ integers; in the $k$-th of these lines, the $i$-th integer is $c_{k, i}$.\n\nFor each line of input, if multiple numbers are given, then adjacent numbers are separated by exactly one space.", "outputFormat": "Output $q$ lines, each with 1 integer: the integer on line $k$ is the maximum value of $A^2 + D^2$ for the $k$-th student.", "hint": "### Sample Explanation\n\nThere are 2 knowledge points, and each knowledge point has 4 practice problems; there are 4 students.\n\nTake the 2nd student as an example. We need to select exactly 2 practice problems from the 1st knowledge point and exactly 1 practice problem from the 2nd knowledge point for this student. One optimal plan is to choose the 1st and 3rd problems in the 1st knowledge point, and choose the 1st problem in the 2nd knowledge point. The improvement in algorithm ability from these problems is $A = a_{1,1} + a_{1,3} + a_{2,1} = 1 + (-1) + 0 = 0$, and the improvement in data structure ability is $D = d_{1,1} + d_{1,3} + d_{2,1} = 1 + 1 + 10 = 12$. Then $A^2 + D^2 = 144$, and there is no better plan.\n\n### Constraints\n\n$1 \\leq n \\leq 6$, $1 \\leq m \\leq 666$, $1 \\leq q \\leq 666$, and all $a_{i, j}$ and $d_{i, j}$ are in the range $[-10^9, 10^9]$.\nFor the final testdata, all $c_{k, i}$ are generated independently and uniformly at random in the range $[0, m]$.\n\n### Hint\n\nEach output number may be very large, and may even exceed the range of 64-bit integers.\n\n* In C++, you can use the `__int128_t` type to represent signed 128-bit integers, or use `__uint128_t` to represent unsigned 128-bit integers. These two data types cannot be directly used for input/output.\n\n* In Java, you can use the `BigInteger` class.\n\n### Copyright Information\n\nFrom the 2018 Tsinghua University Programming Contest and Intercollegiate Invitational (THUPC2018). Thanks to [Pony.ai](http://pony.ai/) for supporting this contest.\n\nResources such as editorials can be found at <https://github.com/wangyurzee7/THUPC2018>.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[THUPC 2018] 《算法与数据结构》小助教招募通知", "background": "T 大学和 U 大学是 W 国最好的两个大学。《算法与数据结构》是 U 大学的一门经典课程，曾连续百余年获得“U 大学一级精品课程”的荣誉。\n\n小 O 是这门课明年的助教。由于这门课过于火爆，他一个人忙不过来，所以他正在招募这门课的小助教。不过，招募的条件有点奇怪……", "description": "《算法与数据结构》课程的内容共分为 $n$ 个知识点，而每个知识点均有配套的的 $m$ 道练习题。每道题有两个属性值，第 $i$ 个知识点的第 $j$ 道练习题可以让做这道题的学生的算法能力提高 $a_{i, j}$，数据结构能力提高 $d_{i, j}$。这些属性值均为整数，但是可能为负数，甚至可能存在两个属性均为负的练习题。（不要问这种题是怎么被加进题库的…）\n\n明年的《算法与数据结构》课共有 $q$ 个学生注册。通过对每个学生以前学习情况的考察，小 O 决定对每个学生进行“因材施教”。具体方法是，对于第 $k$ 个学生、第 $i$ 个知识点，小 O 希望这个学生完成这个知识点的恰好 $c_{k, i}$ 道练习题。\n\n其实小 O 和 T 大学关系密切，希望在 U 大学搞点事情。对于每个学生，设为该学生选出的所有练习题对于算法能力与数据结构能力的提升分别为 $A$ 与 $D$，小 O 的目标是最大化 $A^2+D^2$，这样无论这个学生在哪个方面能力提升或降低的程度很大，都是小 O 所期望的。\n\n请对于每个学生计算这个目标的最大值。", "inputFormat": "每个输入文件仅包含一个测试数据。\n\n* 第一行包含三个正整数 $n, m, q$。\n\n* 接下来 $n$ 行，每行包含 $m$ 个整数；其中第 $i$ 行的第 $j$ 个整数为 $a_{i, j}$。\n\n* 接下来 $n$ 行，每行包含 $m$ 个整数；其中第 $i$ 行的第 $j$ 个整数为 $d_{i, j}$。\n\n* 接下来 $q$ 行，每行包含 $n$ 个整数；其中第 $k$ 行的第 $i$ 个整数为 $c_{k, i}$。\n\n对于输入的每一行，如果有多个数输入，则相邻两个数用恰好一个空格隔开。", "outputFormat": "输出 $q$ 行，每行 1 个整数：第 $k$ 行的整数表示第 $k$ 个学生的 $A^2+D^2$ 的最大值。", "hint": "### 样例解释\n\n有 2 个知识点，每个知识点有 4 道练习题；有 4 个学生。\n\n以第 2 个学生为例，我们需要为该学生在第 1 个知识点中选择恰好 2 道练习题，在第 2 个知识点中选择恰好 1 道练习题。一种最优的方案是，在第 1 个知识点中选择第 1 道题和第 3 道题，在第 2 个知识点中选择第 1 道题。这些题目对于算法能力的提高为 $A=a_{1,1}+a_{1,3}+a_{2,1}=1+(-1)+0=0$，对于数据结构能力的提高为 $D=d_{1,1}+d_{1,3}+d_{2,1}=1+1+10=12$，此时 $A^2+D^2=144$，并且不存在更优的方案。\n\n### 数据范围\n\n$1 \\leq n \\leq 6$，$1 \\leq m \\leq 666$，$1 \\leq q \\leq 666$，所有的 $a_{i, j}$ 与 $d_{i, j}$ 均在 $[-10^9,10^9]$ 范围内。\n对于最终测试数据，所有的 $c_{k, i}$ 均在 $[0, m]$ 范围内**独立、均匀**随机生成。\n\n### 提示\n\n输出的每个数可能非常大，甚至可能超过64位整数的范围。\n\n* C++语言可以使用`__int128_t`类型表示带符号128位整数，或使用`__uint128_t`类型表示无符号128位整数；这两种数据类型无法直接进行输入/输出。\n\n* Java语言可以使用`BigInteger`类。\n\n### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN"}}}
{"pid": "P5450", "type": "P", "difficulty": 7, "samples": [["4 1 2\n1 2\n2 3\n3 4", "4"]], "limits": {"time": [10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2018", "THUPC"], "title": "[THUPC 2018] 淘米神的树", "background": "", "description": "可爱的 Tommy 有一棵树。这棵树上只有点 $a$ 和 $b$ 是黑色，其它的点都是白色。\n\n每次，Tommy 可以将一个黑色 $p$ 的点染成红色，然后把和 $p$ 相邻的所有白色的点染成黑色。最后，所有的点都会被染成红色。\n\n设第 $i$ 个点是第 $t_i$ 个被染成红色的，那么 $t_i$ 是一个 $1$ 到 $n$ 的排列。Tommy 希望你帮他求出，有多少种不同的 $t_i$。", "inputFormat": "每个输入文件仅包含一个测试数据。\n\n* 第一行三个用空格隔开的正整数 $n,a,b$，表示树的点数和初始的黑色点的编号；\n\n* 接下来 $n-1$ 行，每行两个正整数 $x,y$ 描述树上的一条边 $\\left( x,y\\right)$。\n\n树上的节点从 $1$ 开始编号。", "outputFormat": "输出 $1$ 行：\n\n* 一个整数，表示不同的排列 $t_i$ 的个数除以 $998,244,353$ 的余数。", "hint": "### 数据范围\n\n保证 $a,b\\le n\\le 234,567$。\n\n### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN", "translations": {"en": {"title": "[THUPC 2018] Taomi God’s Tree", "background": "", "description": "Lovely Tommy has a tree. In this tree, only vertices $a$ and $b$ are black, and all other vertices are white.\n\nEach time, Tommy can recolor a black vertex $p$ to red, and then recolor all white vertices adjacent to $p$ into black. In the end, all vertices will be recolored to red.\n\nLet the $i$-th vertex be recolored to red as the $t_i$-th one; then $t_i$ is a permutation of $1$ to $n$. Tommy wants you to help him find how many different $t_i$ there are.", "inputFormat": "Each input file contains only one testdata.\n\n* The first line contains three positive integers $n,a,b$ separated by spaces, representing the number of vertices of the tree and the indices of the initial black vertices.\n\n* The next $n-1$ lines each contain two positive integers $x,y$, describing an edge $\\left( x,y\\right)$ in the tree.\n\nThe vertices of the tree are numbered starting from $1$.", "outputFormat": "Output $1$ line:\n\n* One integer, representing the number of different permutations $t_i$ modulo $998,244,353$.", "hint": "### Constraints\n\nIt is guaranteed that $a,b\\le n\\le 234,567$.\n\n### Copyright Information\n\nFrom the 2018 Tsinghua University Programming Contest and Collegiate Invitational (THUPC2018). Thanks to [Pony.ai](http://pony.ai/) for supporting this contest.\n\nResources such as editorials can be found at <https://github.com/wangyurzee7/THUPC2018>.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[THUPC 2018] 淘米神的树", "background": "", "description": "可爱的 Tommy 有一棵树。这棵树上只有点 $a$ 和 $b$ 是黑色，其它的点都是白色。\n\n每次，Tommy 可以将一个黑色 $p$ 的点染成红色，然后把和 $p$ 相邻的所有白色的点染成黑色。最后，所有的点都会被染成红色。\n\n设第 $i$ 个点是第 $t_i$ 个被染成红色的，那么 $t_i$ 是一个 $1$ 到 $n$ 的排列。Tommy 希望你帮他求出，有多少种不同的 $t_i$。", "inputFormat": "每个输入文件仅包含一个测试数据。\n\n* 第一行三个用空格隔开的正整数 $n,a,b$，表示树的点数和初始的黑色点的编号；\n\n* 接下来 $n-1$ 行，每行两个正整数 $x,y$ 描述树上的一条边 $\\left( x,y\\right)$。\n\n树上的节点从 $1$ 开始编号。", "outputFormat": "输出 $1$ 行：\n\n* 一个整数，表示不同的排列 $t_i$ 的个数除以 $998,244,353$ 的余数。", "hint": "### 数据范围\n\n保证 $a,b\\le n\\le 234,567$。\n\n### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN"}}}
{"pid": "P5451", "type": "P", "difficulty": 5, "samples": [["1\n1502992813 2511821915 653507 57809 2638352023", "19260817"]], "limits": {"time": [1000, 1000], "memory": [512000, 512000]}, "tags": ["2018", "THUPC"], "title": "[THUPC 2018] 密码学第三次小作业", "background": "1977年，罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）提出了RSA 加密算法。RSA 加密算法是一种非对称加密算法，其可靠性由极大整数因数分解的难度决定。换言之，对一极大整数做因数分解愈困难，RSA 算法愈可靠。假如有人找到一种快速因数分解的算法的话，那么用 RSA 加密的信息的可靠性就肯定会极度下降。\n\nRSA 的基本原理如下：\n\n- 公钥与私钥的产生\n  1. 随机选择两个不同大质数 $p$ 和 $q$，计算 $N=p\\times q$\n  2. 根据欧拉函数性质，求得 $r=\\varphi (N)=\\varphi (p)\\varphi (q)=(p-1)(q-1)$\n  3. 选择一个小于 $r$ 的正整数 $e$，使 $e$ 和 $r$ 互质。并求得 $e$ 关于 $r$ 的乘法逆元 $d$，有 $ed\\equiv 1 \\pmod r$\n  4. 将 $p$ 和 $q$ 的记录销毁。此时，$(N,e)$ 是公钥，$(N,d)$ 是私钥。\n- 消息加密：首先需要将消息 $m$ 以一个双方约定好的格式转化为一个小于 $N$，且与 $N$ 互质的整数 $n$。如果消息太长，可以将消息分为几段，这也就是我们所说的块加密，后对于每一部分利用如下公式加密：\n\n$$\nn^{e}\\equiv c\\pmod N\n$$\n\n- 消息解密：利用密钥 $d$ 进行解密\n\n$$\nc^{d}\\equiv n\\pmod N\n$$", "description": "现在有两个用户由于巧合，拥有了相同的模数 $N$，但是私钥不同。设两个用户的公钥分别为 $e_1$ 和 $e_2$，**且两者互质**。明文消息为 $m$，密文分别为：\n\n$$\\begin{matrix}c_1=m^{e_1}\\bmod N\\\\c_2=m^{e_2}\\bmod N\\end{matrix}$$\n\n现在，一个攻击者截获了 $c_1$ ，$c_2$，$e_1$，$e_2$，$N$，请帮助他恢复出明文 $m$ 。", "inputFormat": "输入包含多组数据，第一行一个整数 $T$ 表示数据组数，保证 $1\\le T\\le 10^4$ 。接下来依次描述每组数据，对于每组数据：\n\n* 一行包含五个正整数 $c_1$，$c_2$，$e_1$，$e_2$，$N$，保证 $2^{8}< N < 2^{63}$，$N$ 有且仅有两个素因子，其余数据严格按照上述RSA算法生成。\n", "outputFormat": "对于每组数据，输出 $1$ 行：\n\n- 一个非负整数 $m$，请选手务必在输出时保证 $0\\le m<N$。答案 $m$ 保证与 $N$ 互质。", "hint": "### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN", "translations": {"en": {"title": "[THUPC 2018] The Third Cryptography Homework", "background": "In 1977, Ronald Rivest, Adi Shamir, and Leonard Adleman proposed the RSA encryption algorithm. RSA is an asymmetric encryption algorithm, and its security depends on the difficulty of factoring very large integers. In other words, the harder it is to factor a very large integer, the more reliable RSA is. If someone finds a fast factoring algorithm, then the security of information encrypted with RSA will definitely drop a lot.\n\nThe basic idea of RSA is as follows:\n\n- Generating the public key and private key\n  1. Randomly choose two different large primes $p$ and $q$, and compute $N=p\\times q$.\n  2. By the property of Euler's totient function, compute $r=\\varphi (N)=\\varphi (p)\\varphi (q)=(p-1)(q-1)$.\n  3. Choose a positive integer $e$ less than $r$ such that $e$ and $r$ are coprime. Then compute the multiplicative inverse $d$ of $e$ modulo $r$, satisfying $ed\\equiv 1 \\pmod r$.\n  4. Destroy the records of $p$ and $q$. At this point, $(N,e)$ is the public key, and $(N,d)$ is the private key.\n- Message encryption: First, convert the message $m$ into an integer $n$ that is less than $N$ and coprime with $N$, in a format agreed upon by both parties. If the message is too long, it can be split into several parts (this is what we call block encryption). Then each part is encrypted using:\n\n$$\nn^{e}\\equiv c\\pmod N\n$$\n\n- Message decryption: Decrypt using the key $d$:\n\n$$\nc^{d}\\equiv n\\pmod N\n$$", "description": "Now there are two users who, by coincidence, have the same modulus $N$ but different private keys. Let their public keys be $e_1$ and $e_2$, **and they are coprime**. The plaintext message is $m$, and the ciphertexts are:\n\n$$\\begin{matrix}c_1=m^{e_1}\\bmod N\\\\c_2=m^{e_2}\\bmod N\\end{matrix}$$\n\nNow, an attacker has intercepted $c_1$, $c_2$, $e_1$, $e_2$, and $N$. Please help him recover the plaintext $m$.", "inputFormat": "The input contains multiple test cases. The first line contains an integer $T$ indicating the number of test cases, and it is guaranteed that $1\\le T\\le 10^4$ . Then each test case is described as follows:\n\n- One line contains five positive integers $c_1$, $c_2$, $e_1$, $e_2$, $N$. It is guaranteed that $2^{8}< N < 2^{63}$, $N$ has exactly two prime factors, and the other values are generated strictly according to the RSA algorithm described above.", "outputFormat": "For each test case, output $1$ line:\n\n- A non-negative integer $m$. Please make sure that $0\\le m<N$ when outputting. It is guaranteed that the answer $m$ is coprime with $N$.", "hint": "### Copyright Information\n\nFrom the 2018 Tsinghua University Programming Contest and Intercollegiate Invitational (THUPC2018). Thanks to [Pony.ai](http://pony.ai/) for supporting this contest.\n\nSolutions and other resources can be found at <https://github.com/wangyurzee7/THUPC2018>.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[THUPC 2018] 密码学第三次小作业", "background": "1977年，罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）提出了RSA 加密算法。RSA 加密算法是一种非对称加密算法，其可靠性由极大整数因数分解的难度决定。换言之，对一极大整数做因数分解愈困难，RSA 算法愈可靠。假如有人找到一种快速因数分解的算法的话，那么用 RSA 加密的信息的可靠性就肯定会极度下降。\n\nRSA 的基本原理如下：\n\n- 公钥与私钥的产生\n  1. 随机选择两个不同大质数 $p$ 和 $q$，计算 $N=p\\times q$\n  2. 根据欧拉函数性质，求得 $r=\\varphi (N)=\\varphi (p)\\varphi (q)=(p-1)(q-1)$\n  3. 选择一个小于 $r$ 的正整数 $e$，使 $e$ 和 $r$ 互质。并求得 $e$ 关于 $r$ 的乘法逆元 $d$，有 $ed\\equiv 1 \\pmod r$\n  4. 将 $p$ 和 $q$ 的记录销毁。此时，$(N,e)$ 是公钥，$(N,d)$ 是私钥。\n- 消息加密：首先需要将消息 $m$ 以一个双方约定好的格式转化为一个小于 $N$，且与 $N$ 互质的整数 $n$。如果消息太长，可以将消息分为几段，这也就是我们所说的块加密，后对于每一部分利用如下公式加密：\n\n$$\nn^{e}\\equiv c\\pmod N\n$$\n\n- 消息解密：利用密钥 $d$ 进行解密\n\n$$\nc^{d}\\equiv n\\pmod N\n$$", "description": "现在有两个用户由于巧合，拥有了相同的模数 $N$，但是私钥不同。设两个用户的公钥分别为 $e_1$ 和 $e_2$，**且两者互质**。明文消息为 $m$，密文分别为：\n\n$$\\begin{matrix}c_1=m^{e_1}\\bmod N\\\\c_2=m^{e_2}\\bmod N\\end{matrix}$$\n\n现在，一个攻击者截获了 $c_1$ ，$c_2$，$e_1$，$e_2$，$N$，请帮助他恢复出明文 $m$ 。", "inputFormat": "输入包含多组数据，第一行一个整数 $T$ 表示数据组数，保证 $1\\le T\\le 10^4$ 。接下来依次描述每组数据，对于每组数据：\n\n* 一行包含五个正整数 $c_1$，$c_2$，$e_1$，$e_2$，$N$，保证 $2^{8}< N < 2^{63}$，$N$ 有且仅有两个素因子，其余数据严格按照上述RSA算法生成。\n", "outputFormat": "对于每组数据，输出 $1$ 行：\n\n- 一个非负整数 $m$，请选手务必在输出时保证 $0\\le m<N$。答案 $m$ 保证与 $N$ 互质。", "hint": "### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN"}}}
{"pid": "P5452", "type": "P", "difficulty": 0, "samples": [["3 5\n4 1 -10.10 -10.20 10.30 -10.40 10.50 10.60 -10.70 10.80\n4 2 -20.80 -20.70 20.60 -20.50 20.40 20.30 -20.20 20.10\n4 1 -30.10 -30.30 30.50 -30.70 30.20 30.40 -30.60 30.80\n2 1 15.80 15.60\n2 1 25.40 25.20\n1 2\n2 1 15.70 15.50\n2 1 25.30 25.10", "3271.8500\n3271.8500\n1236.0000\n2035.8500"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2018", "THUPC"], "title": "[THUPC 2018] 琪亚娜之墙", "background": "", "description": "那一天，人类终于回想起，曾经一度被她们支配的恐惧，还有被囚禁于鸟笼中的那份耻辱。\n\n为了守护最珍视之物，Kiana建立起了 $n$ 座围墙，每一座围墙都闭合形成了一个**凸多边形**，不同的围墙**互不相交**。出于特别的目的，围墙分为两种：用砖瓦和岩石砌成的**工匠之墙**、用树木和荆棘形成的**自然之墙**。\n\n只依靠墙壁并不使人放心，Kiana还派遣了两类士兵在墙内巡逻：\n\n**追魂猎人**：他们从小与大自然为伴，可以自由穿越自然之墙，但无法通过工匠之墙。\n\n**天马骑士**：他们拥有在天空中飞行的能力，可以自由飞越工匠之墙，但由于某些信仰的缘故，无法通过自然之墙。\n\n只依靠墙壁和士兵任然难以让人放心，但Kiana还拥有神之力量，在某段时间内，她发挥了 $m$ 次这股力量，以完成两类事件：\n\n1. 将某座工匠之墙转化为自然之墙，或将某座自然之墙转化为工匠之墙。\n\n2. 将一位追魂猎人或天马骑士直接传送到坐标 $(x,y)$ 处，保证这个坐标不位于围墙之上，且与最近的围墙相距至少 $10^{-3}$。\n\n在每一次传送士兵完成后，Kiana希望知道这名士兵可以自由活动的区域**面积**有多大。由于她不会做，所以希望你来告诉她答案。", "inputFormat": "输入第一行包含两个正整数 $n$ 和 $m$，分别表示围墙的数量和Kiana发动神之力量的次数，数据保证 $n\\leq 3\\times 10^4$且 $m\\leq 10^5$。\n\n接下来 $n$ 行，第 $i$ 行用于描述第 $i$ 座围墙的情况，首先有两个正整数 $k_i$ 和 $r_i$，分别表示这座围墙的顶点数和类型，若 $r_i=1$ 表示这是工匠之墙，若 $r_i=2$ 表示这是自然之墙，接下来 $2k_i$ 个实数，第 $2p-1$ 和第 $2p$ 个数表示这座围墙上第 $p$ 个顶点的横、纵坐标，所有的顶点按照在多边形上逆时针排列的顺序输入，数据保证 $3\\leq k_i\\leq 100$ 且 $\\sum_{i=1}^{n}k_i\\leq 10^5$。\n\n接下来 $m$ 行，第 $j$ 行用于描述Kiana第 $j$ 次使用神之力量的情况，首先有一个正整数 $op$，表示Kiana发动的神之力量类型，若：\n\n$op=1$：这一行还有一个正整数 $u$，表示Kiana转换了第 $u$ 座围墙的类型（若本来为工匠之墙，则转化为自然之墙，若本来为自然之墙，则转化为工匠之墙），数据保证 $1\\leq u\\leq n$。\n\n$op=2$：这一行还有一个正整数 $v$ 与两个实数 $x$ 和 $y$，若 $v=1$，表示Kiana将一名追魂猎人传送到了 $(x,y)$ 处，若 $v=2$，表示Kiana将一名天马骑士传送到了 $(x,y)$ 处。\n\n数据保证所有的 $r_i$、$op$ 和 $v$ 的取值仅为 $1$ 或 $2$，所有的实数保留到小数点后两位且绝对值小于 $2\\times 10^5$，任意两个的多边形之间的距离至少为 $10^{-3}$，任意两个输入顶点的横坐标之差与纵坐标之差的绝对值不小于 $10^{-3}$。", "outputFormat": "输出由若干行组成，对于每个 $op=2$ 的输入，输出一行一个实数 $S$（保留到小数点后 $4$ 位），表示该名士兵可以自由活动的区域面积，数据保证这个面积是有限的。", "hint": "来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN", "translations": {"en": {"title": "[THUPC 2018] Kiana’s Wall.", "background": "", "description": "That day, humanity finally remembered the fear of being ruled by them, and the shame of being imprisoned in a cage.\n\nTo protect what she values most, Kiana built $n$ walls. Each wall is closed and forms a **convex polygon**, and different walls **do not intersect** each other. For special purposes, the walls are divided into two types: the **Craftsman Wall**, built from bricks and rocks, and the **Natural Wall**, formed by trees and thorns.\n\nRelying only on walls is still not reassuring, so Kiana also sent two types of soldiers to patrol inside the walls:\n\n**Soul Hunter**: They grew up with nature, can pass through Natural Walls freely, but cannot pass through Craftsman Walls.\n\n**Pegasus Knight**: They can fly in the sky, so they can fly over Craftsman Walls freely, but due to certain beliefs, they cannot pass through Natural Walls.\n\nEven relying on walls and soldiers is still not reassuring, but Kiana also possesses divine power. During a period of time, she used this power $m$ times to perform two kinds of events:\n\n1. Convert a Craftsman Wall into a Natural Wall, or convert a Natural Wall into a Craftsman Wall.\n\n2. Teleport a Soul Hunter or a Pegasus Knight directly to the coordinate $(x,y)$. It is guaranteed that this coordinate is not on any wall, and its distance to the nearest wall is at least $10^{-3}$.\n\nAfter each soldier teleportation, Kiana wants to know the **area** of the region where this soldier can move freely. Since she cannot do it, she hopes you can tell her the answer.", "inputFormat": "The first line contains two positive integers $n$ and $m$, representing the number of walls and the number of times Kiana uses divine power. The testdata guarantees $n\\leq 3\\times 10^4$ and $m\\leq 10^5$.\n\nIn the next $n$ lines, the $i$-th line describes the $i$-th wall. It starts with two positive integers $k_i$ and $r_i$, representing the number of vertices and the type of this wall. If $r_i=1$, it is a Craftsman Wall; if $r_i=2$, it is a Natural Wall. Then follow $2k_i$ real numbers: the $(2p-1)$-th and $2p$-th numbers are the $x$- and $y$-coordinates of the $p$-th vertex of this wall. All vertices are given in counterclockwise order along the polygon. The testdata guarantees $3\\leq k_i\\leq 100$ and $\\sum_{i=1}^{n}k_i\\leq 10^5$.\n\nIn the next $m$ lines, the $j$-th line describes the $j$-th use of divine power. It starts with a positive integer $op$, indicating the type of operation. If:\n\n$op=1$: This line also contains a positive integer $u$, meaning Kiana changes the type of wall $u$ (if it is originally a Craftsman Wall, it becomes a Natural Wall; if it is originally a Natural Wall, it becomes a Craftsman Wall). The testdata guarantees $1\\leq u\\leq n$.\n\n$op=2$: This line also contains a positive integer $v$ and two real numbers $x$ and $y$. If $v=1$, Kiana teleports a Soul Hunter to $(x,y)$; if $v=2$, Kiana teleports a Pegasus Knight to $(x,y)$.\n\nThe testdata guarantees that all $r_i$, $op$, and $v$ take values only $1$ or $2$. All real numbers are given with exactly two digits after the decimal point and have absolute value less than $2\\times 10^5$. The distance between any two polygons is at least $10^{-3}$. For any two input vertices, the absolute value of the difference in their $x$-coordinates and the absolute value of the difference in their $y$-coordinates are both at least $10^{-3}$.", "outputFormat": "The output consists of several lines. For each input with $op=2$, output one line with a real number $S$ (rounded to $4$ digits after the decimal point), representing the area of the region where the soldier can move freely. The testdata guarantees that this area is finite.", "hint": "From the 2018 Tsinghua University Programming Contest and Collegiate Invitational (THUPC2018). Thanks to [Pony.ai](http://pony.ai/) for supporting this contest.\n\nSolutions and other resources can be found at <https://github.com/wangyurzee7/THUPC2018>.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[THUPC 2018] 琪亚娜之墙", "background": "", "description": "那一天，人类终于回想起，曾经一度被她们支配的恐惧，还有被囚禁于鸟笼中的那份耻辱。\n\n为了守护最珍视之物，Kiana建立起了 $n$ 座围墙，每一座围墙都闭合形成了一个**凸多边形**，不同的围墙**互不相交**。出于特别的目的，围墙分为两种：用砖瓦和岩石砌成的**工匠之墙**、用树木和荆棘形成的**自然之墙**。\n\n只依靠墙壁并不使人放心，Kiana还派遣了两类士兵在墙内巡逻：\n\n**追魂猎人**：他们从小与大自然为伴，可以自由穿越自然之墙，但无法通过工匠之墙。\n\n**天马骑士**：他们拥有在天空中飞行的能力，可以自由飞越工匠之墙，但由于某些信仰的缘故，无法通过自然之墙。\n\n只依靠墙壁和士兵任然难以让人放心，但Kiana还拥有神之力量，在某段时间内，她发挥了 $m$ 次这股力量，以完成两类事件：\n\n1. 将某座工匠之墙转化为自然之墙，或将某座自然之墙转化为工匠之墙。\n\n2. 将一位追魂猎人或天马骑士直接传送到坐标 $(x,y)$ 处，保证这个坐标不位于围墙之上，且与最近的围墙相距至少 $10^{-3}$。\n\n在每一次传送士兵完成后，Kiana希望知道这名士兵可以自由活动的区域**面积**有多大。由于她不会做，所以希望你来告诉她答案。", "inputFormat": "输入第一行包含两个正整数 $n$ 和 $m$，分别表示围墙的数量和Kiana发动神之力量的次数，数据保证 $n\\leq 3\\times 10^4$且 $m\\leq 10^5$。\n\n接下来 $n$ 行，第 $i$ 行用于描述第 $i$ 座围墙的情况，首先有两个正整数 $k_i$ 和 $r_i$，分别表示这座围墙的顶点数和类型，若 $r_i=1$ 表示这是工匠之墙，若 $r_i=2$ 表示这是自然之墙，接下来 $2k_i$ 个实数，第 $2p-1$ 和第 $2p$ 个数表示这座围墙上第 $p$ 个顶点的横、纵坐标，所有的顶点按照在多边形上逆时针排列的顺序输入，数据保证 $3\\leq k_i\\leq 100$ 且 $\\sum_{i=1}^{n}k_i\\leq 10^5$。\n\n接下来 $m$ 行，第 $j$ 行用于描述Kiana第 $j$ 次使用神之力量的情况，首先有一个正整数 $op$，表示Kiana发动的神之力量类型，若：\n\n$op=1$：这一行还有一个正整数 $u$，表示Kiana转换了第 $u$ 座围墙的类型（若本来为工匠之墙，则转化为自然之墙，若本来为自然之墙，则转化为工匠之墙），数据保证 $1\\leq u\\leq n$。\n\n$op=2$：这一行还有一个正整数 $v$ 与两个实数 $x$ 和 $y$，若 $v=1$，表示Kiana将一名追魂猎人传送到了 $(x,y)$ 处，若 $v=2$，表示Kiana将一名天马骑士传送到了 $(x,y)$ 处。\n\n数据保证所有的 $r_i$、$op$ 和 $v$ 的取值仅为 $1$ 或 $2$，所有的实数保留到小数点后两位且绝对值小于 $2\\times 10^5$，任意两个的多边形之间的距离至少为 $10^{-3}$，任意两个输入顶点的横坐标之差与纵坐标之差的绝对值不小于 $10^{-3}$。", "outputFormat": "输出由若干行组成，对于每个 $op=2$ 的输入，输出一行一个实数 $S$（保留到小数点后 $4$ 位），表示该名士兵可以自由活动的区域面积，数据保证这个面积是有限的。", "hint": "来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN"}}}
{"pid": "P5453", "type": "P", "difficulty": 6, "samples": [["4\n2 4 4 2\n0 0 0 0\n0 0 0 1\n1 2 1 1 0 2 1 10 1 2dsaigao 1 0 20\n2 1 1 1 0 0 1 10 1 faceking\n2 1 1 1 0 3 1 10 1 rabiribi 1\n1 3 1 1 0 1 1 10 1 toolihai\n1 5 4 4\n0 0 0 0 0\n1 1 2 2 0 3 1 1 100 onepunch 1 2\n1 2 1 1 1 0 1 1 100 toolihai\n1 3 1 1 1 0 1 1 100 toolihai\n1 4 2 1 1 0 1 1 100 toolihai\n1 4 1 4\n0 0 0 0\n1 1 1 1 0 3 3 2 2 backward 2\n10 10 10 20\n0 0 0 1 0 1 0 0 0 1\n0 0 0 0 0 0 0 0 0 1\n0 1 0 0 1 0 0 1 0 0\n0 0 0 0 0 1 0 0 0 0\n0 0 0 0 0 1 0 0 0 1\n0 1 0 0 0 0 0 0 0 0\n1 0 0 0 1 0 1 0 1 1\n0 0 0 0 0 0 0 0 0 1\n0 0 1 0 1 1 0 1 0 1\n1 0 0 0 0 0 0 0 0 0\n10 9 8 0 0 1 6 7 2 viuganda\n5 3 10 0 1 1 6 3 7 toolihai\n2 7 6 3 0 3 7 3 1 faceking\n5 7 10 9 1 3 9 8 8 rabiribi 10\n6 10 1 1 0 1 11 7 7 backward 9\n2 3 8 5 0 3 2 9 4 onepunch 6 1\n1 7 8 2 0 3 11 2 5 hupraise\n9 9 4 3 1 3 12 4 9 gugugugu\n2 1 10 6 1 2 6 6 2 2dsaigao 9 9 9\n10 10 10 5 1 1 12 4 8 firework 4", "1 1\n1 1\n2 3\n2 1\n1 4\n1 2\n1 3\n1 4\n1 2\n5\n10 6\n2 5\n1 5\n5 8\n6 10\n1 7\n1 5\n8 9\n4 9\n8 1"]], "limits": {"time": [10000], "memory": [512000]}, "tags": ["2018", "THUPC"], "title": "[THUPC 2018] 组合数问题", "background": "**友情提示：本题篇幅较长。**", "description": "众所周知，小葱同学擅长计算，尤其擅长计算组合数。\n\n于是现在我们有了一个 $N\\times M$ 的棋盘，棋盘上有些地方会有障碍物的存在。在棋盘上有 $K$ 枚棋子，每枚棋子要么属于红队要么属于蓝队。此外，每枚棋子有两个属性值，第 $i$ 枚棋子的两个属性记为 $a_i,b_i$ 并且保证 $a_i\\geq b_i$。既然有了两支队伍那么小葱同学就要来玩游戏，这个游戏一共有 $R$ 个回合。每个回合内，每枚棋子会按照如下顺序进行游戏：\n\n0. 回合开始，记当前是第 $H$ 回合。若现在为游戏的开始时刻，则 $H=1$。\n\n1. 对于所有能够移动的棋子，沿着自己当前的方向移动一格。每枚棋子的朝向一定是上下左右中的一种。如果棋子发现自己不能移动，即前方格子为棋盘外部或者障碍物，那么则不向前移动，而是将自己的方向旋转一百八十度，即进行向后转的操作（注意此时转了之后棋子这回合内并不会进行移动）。\n\n2. 对于所有棋子，每个棋子都拥有且仅拥有一种技能。此时所有棋子按照编号从小到大依次释放技能，如果不能释放技能则跳过。技能总共分为以下几种：\n\n\t1. 重锤火花（toolihai）：以自身为中心，制造出绚丽的烟花，令人赏心悦目，无任何效果。\n\n\t2. 面子之王（faceking）：该棋子充满了面子，所有棋子都要听其号令，使得所有棋子的方向强制向左（逆时针）转九十度。该技能的效果持续时间为永久。\n\n\t3. 头发掉光（onepunch）：头发掉光之后，王队长变得更强了，使该枚棋子的属性大幅度提升。即若当前棋子 $i$ 的属性为 $\\left(a_i,b_i\\right)$，属性的提升值为 $v$，那么该棋子的属性则变为 $\\left(a_i+v,b_i\\right)$。该技能的效果能持续 $l$ 个回合，若当前回合为 $H$，则该技能效果会在第 $H+l$ 回合开始的时候消失。若在技能消失前棋子 $i$ 的属性为 $\\left(a_i,b_i\\right)$，则技能效果消失后其属性会变为 $\\left(\\max\\left(a_i-v,0\\right),\\min\\left(b_i,\\max\\left(a_i-v,0\\right)\\right)\\right)$。注意在该技能效果消失前该技能可能被再次释放，则多次释放的技能效果叠加，但技能效果消失的时间分开计算。（详见样例第二组数据）\n\n\t4. 拉比哩比（rabiribi）：挥动真正的重锤，制造火花，击退前方扇形区域的所有敌方单位。该技能所能影响到的范围为前方大小为 $v$ 的扇形区域，所谓扇形区域可见下图：\n\n        ![](https://cdn.luogu.com.cn/upload/image_hosting/zgtwzsld.png)\n\t\t\n        从上图我们可以看出，在图的最下方有正在释放技能的棋子，其技能朝向为上，所以其技能方向也为上。则上方的所有区域则为其技能所影响到的扇形区域，该扇形区域大小为 $5$，即 $v=5$。注意到棋盘上某些位置会有障碍物，障碍物的存在会影响到该技能的影响范围。如果一个障碍物存在于技能范围之内，那么以障碍物开始的处于技能范围内的扇形区域也都不会受到技能的影响。如上图可见，所有黑色格子的最下方格子即为障碍物的位置，所有黑色格子即为受到障碍物影响所不能被技能效果影响的格子。\n        \n        另一方面，击退效果的定义为将受到技能影响效果的棋子沿着技能释放方向强制移动一格，即从图中 $p_2$ 被击退到 $p_3$ 的位置。如果被击退方向是障碍物或者棋盘边界，则按一下规则进行：\n        \n        - 如果下一位置为障碍物，则被击退到该障碍物后面，即从图中的 $p_0$ 击退到 $p_1$。\n        - 如果下一位置为棋盘外部，如当前在第一行并且要被击退到第零行，则被击退到第 $N$ 行对应的同一列的位置。\n        \n        重复以上过程直到被击退到一个不是障碍物和棋盘外部的位置，则该击退过程结束。（详见样例第一组数据）\n\t\n\t5. 退学花火（firework）：退学之后，有了更多的时间来挖坑。使得上一个释放重锤火花的棋子在接下来 $l$ 回合内无法移动。如果不存在这样的棋子，则使自己在接下来 $l$ 回合内无法移动。\n\n\t6. 救乌干达（viuganda）：使用vim，拯救阵亡的棋子，复活距离自身最远的阵亡的己方棋子。若己方没有阵亡棋子，则复活对方距离自身最近的阵亡棋子。如果对方也没有阵亡棋子，则什么也不做。我们这里使用的距离为曼哈顿距离，即若第 $i$ 枚棋子处于位置 $\\left(x_i,y_i\\right)$， 第 $j$ 枚棋子处于位置 $\\left(x_j,y_j\\right)$，那么此时两枚棋子的距离为 $\\left|x_i-x_j\\right|+\\left|y_i-y_j\\right|$。如果同时有多枚棋子距离当前棋子的曼哈顿距离一样，那么我们选择其中编号最大的棋子即可。棋子被复活后如果当前回合可以释放技能并且仍然没有被跳过，则会释放技能。\n\n\t7. 降维打击（2dsaigao）：利用超时空武器，向自己右前方发射动感光波，使得某个区域内的单位不能释放技能。该动感光波发射之后，遇到棋盘边缘或者障碍物则会发生方向改变的现象，如下图所示：\n\t\n\t\t![](https://cdn.luogu.com.cn/upload/image_hosting/3j1makll.png)\n\t\t\n        中间格子为当前棋子所处的位置，其方向向左。每当该光波会进入一个有障碍物的格子或者棋盘边缘的时候，该光波就会改变自己的方向顺时针旋转 $90^\\circ$。该光波每从一个格子的中心到达另一个格子的中心时我们称该光波走了 $1$ 的距离。当光波走了 $o$ 的距离之后，光波就会以当前格子为中心发生爆炸，使得所有距离当前格子曼哈顿距离不超过 $v$ 的棋子在接下来 $l$ 回合的时间内都不能释放技能，即从现在到第 $H+l$ 回合开始的这段时间内都不能释放技能。（详见样例第一组数据）\n\t\t\n\t8. 咕咕咕咕（gugugugu）：做人，绝不能普普通通的鸽了别人；要鸽，必须带着大家一起鸽。该技能效果为使得己方所有当前回合还没有释放技能的棋子全部跳过技能释放的环节，即使得己方还未释放技能的棋子当前回合不能释放技能。\n\t\n\t9. 反向传播（backward）：让时间暂停，让游戏倒流，让自身回到过去，回到之前的某个回合。若当前为第 $H$ 回合，该技能效果是回到 $l$ 回合前，则当前棋子 $i$ 会回到第 $H-l$ 回合。所谓回到第 $H-l$ 回合，即当前棋子的一下所有值都会变回第 $H-l$ 回合开始的时候的值：\n        \n        - 位置及方向。\n        - 属性。\n        - 是否存活以及复活时间。\n        - 受到的技能影响的效果以及剩余时间。\n        \n        注意此时棋子 $i$ 的技能刷新时间并不会回到第 $H-l$ 回合的时间。（详见样例第三组数据）（技能刷新时间的规则会在下面说明）\n\t\t\n\t10. 葱之礼赞（hupraise）：葱的到来，使得今天变为了一个神圣的日子，要将红蓝双方的棋子进行配对。每个红方棋子可以和任何一个蓝方棋子进行配对，并且每个棋子都最多只能和对面一个棋子进行配对。第 $i$ 枚棋子 和第 $j$ 枚棋子能够配对的条件为两个棋子属于不同阵营并且 $a_i\\oplus a_j$ 是 $3$ 的倍数（该符号为异或）。现在每当该技能发动时，你需要求出最多能够配多少对。\n\n\t**技能刷新规则**：对于所有技能，当前为第 $H$ 回合，如果第 $i$ 枚棋子释放了技能，那么在第 $H+z_i$ 回合的时候该技能才回复完毕，才能再次释放技能。如果第 $i$ 枚棋子在当前回合中了一个持续时间为 $l$ 回合的技能，那么该技能的影响将在第 $H+l$ 回合开始的时候消除。对于所有棋子，若其首轮技能回复时间为 $f_i$，技能回复时间为 $z_i$，则若没有其他棋子的影响，其第一次将在第 $f_i$ 回合释放技能，之后每 $z_i$ 回合再次释放技能。\n\n3. 对于棋盘上所有格子，如果一个格子内既有红队棋子又有蓝队棋子，那么此时这个格子内的棋子便会发生交战。交战的规则如下：\n\n    我们规定第 $i$ 枚棋子的战斗力为 $\\binom{a_i}{b_i}$（该式子等价于 $C_{a_i}^{b_i}$）。在交战时，每次由红蓝双方派出己方在这个格子战力最大的棋子进行交战。假设红方派出第 $i$ 枚棋子，蓝方派出第 $j$ 枚棋子。如果红方蓝方两枚棋子战斗力一样，那么派出的两枚棋子均阵亡。若战斗力不一样，假设第 $i$ 枚棋子战力更高，那么第 $j$ 枚棋子阵亡，同时第 $i$ 枚棋子的两个属性变为 $\\max\\left(a_i-a_j,0\\right),\\max\\left(b_i-a_j,0\\right)$。不断重复以上操作直到一方棋子全部阵亡。若第 $i$ 枚棋子在当前回合即第 $H$ 回合阵亡，那么第 $i$ 枚棋子会在第 $H+r_i$ 回合开始的时候复活。第 $i$ 枚棋子复活之后将其两个属性将变为游戏开始时候的属性值，并且移除所有当前棋子身上的技能效果，其移动方向保持阵亡前的移动方向。棋子阵亡期间其技能正常回复，但是不能移动和释放技能，并且不受到其他任何技能的影响。\n\n\n现在小葱告诉你所有与这游戏相关的东西，希望你按照游戏规则来进行游戏，并输出游戏结束之后每个棋子的位置。", "inputFormat": "输入包含多组数据，第一行一个整数 $T$ 表示数据组数。接下来依次描述每组数据，对于每组数据：\n\n* 第一行四个整数 $N,M,K,R$。\n\n* 接下来 $N$ 行每行 $M$ 个数。对于第 $i$ 行第 $j$ 列的数，如果等于 $0$ 则代表第 $i$ 行第 $j$ 列的格子为普通格子，否则为障碍物。\n\n* 接下来 $K$ 行，每行一开始有九个整数 $x_i,y_i,a_i,b_i,c_i,d_i,f_i,z_i,r_i$。代表第 $i$ 枚棋子一开始的位置位于第 $x_i$ 行 第 $y_i$ 列，其属性值为 $a_i,b_i$ 并且所属的阵营为 $c_i$。如果 $c_i=0$ 则为红方否则为蓝方。棋子 $i$ 一开始的朝向为 $d_i$，$d_i=0,1,2,3$ 分别表示上下左右四个方向。$f_i$ 为技能首轮回复时间，$z_i$ 为技能回复时间，即第 $i$ 枚棋子若在没有受到其他棋子影响的情况下，第一次将在第 $f_i$ 回合释放技能，之后每 $z_i$ 回合再次释放技能。$r_i$ 为其复活时间。接下来一个字符串 $s_i$ 为其技能的英文名字，已在每个技能后面注明了其对应的英文名字。对于不同的技能种类，会在当前行增加一定的输入值，具体如下：\n\n\t1. 重锤火花（toolihai），无增加的输入。\n\n\t2. 面子之王（faceking），无增加的输入。\n\n\t3. 头发掉光（onepunch），增加输入 $v_i,l_i$，代表该技能的增益效果和持续时间。\n\n\t4. 拉比哩比（rabiribi），增加输入 $v_i$ 代表技能的范围。\n\t\t\n\t5. 退学花火（firework），增加输入 $l_i$ 代表技能的影响时间。\n\n\t6. 救乌干达（viuganda），无增加的输入。\n\n\t7. 降维打击（2dsaigao），增加输入 $y_i,v_i,l_i$，代表光波能移动的距离、光波爆炸后能影响的范围以及技能的影响持续时间。\n\t\t\t\n\t8. 咕咕咕咕（gugugugu），无增加的输入。\n\t\t\n\t9. 反向传播（backward），增加输入 $l_i$，表示回到 $l_i$ 回合之前，数据保证不会回到游戏开始之前。\n\t\t\t\n\t10. 葱之礼赞（hupraise），无增加的输入。", "outputFormat": "对于每组数据：\n\n* 每当技能 $10$ 发动时，输出一行一个整数。\n\n* 在游戏结束之后，输出 $K$ 行，每行两个整数代表第 $i$ 枚棋子现在处于哪一行哪一列。", "hint": "### 样例解释\n\n对于第一组数据，在左上方释放技能 $7$ 时，是朝着角落里射出的动感光波，所以碰到角落返回回射出点时，此时距离为 $1$，正好原地爆炸，使得技能 $2$ 无法放出。而右下方是在释放技能 $4$ 时，将对方击穿了地图的例子。\n\n对于第二组数据，第一枚棋子每次向右走一步就会释放一次技能。第一回合走到 $(1,2)$，释放技能后属性变为 $(3,2)$，和对方交战后属性变为 $(2,1)$。第二回合走到 $(1,3)$，释放技能后属性变为 $(3,1)$，和对方交战后属性变为 $(3,0)$。第三回合走到 $(1,4)$，由于之前第一回合释放的技能效果消失，属性变回 $(2,0)$，再重新释放技能变为 $(3,0)$，然后被对手痛殴致死。所以最后停留在了 $(1,4)$。\n\n对于第三组数据，该棋子每走两次就会释放技能跳回两回合前的状态，不断循环这样的过程。\n\n### 数据范围\n\n保证 $1\\leq T\\leq 20$，$1\\leq N,M\\leq 100$，$1\\leq K\\leq 200$，$1\\leq R\\leq 1000$。\n\n保证所有的附加输入除了技能 $3,5,7$ 的影响时间大于 $0$ 以外，剩下均大于等于 $0$。\n\n保证棋子一开始不在障碍物上，一开始以及增幅的属性值均不超过 $1000$（但不保证增幅后的属性超过 $1000$）。\n\n保证技能的首轮回复时间、之后的回复时间以及复活时间均大于 $0$。\n\n### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN", "translations": {"en": {"title": "[THUPC 2018] Binomial Coefficient Problem", "background": "**Friendly reminder: This problem statement is quite long.**", "description": "As everyone knows, student Xiao Cong is good at calculation, especially at computing binomial coefficients.\n\nNow we have an $N \\times M$ board, and some cells on the board contain obstacles. There are $K$ pieces on the board. Each piece belongs to either the red team or the blue team. Also, each piece has two attributes; for piece $i$, the two attributes are denoted by $a_i, b_i$, and it is guaranteed that $a_i \\geq b_i$. Since there are two teams, Xiao Cong wants to play a game. The game has a total of $R$ rounds. In each round, every piece acts in the following order:\n\n0. At the start of the round, let the current round be the $H$-th round. If this is the start of the game, then $H = 1$.\n\n1. For all pieces that can move, move one cell forward in their current direction. Each piece’s direction must be one of up, down, left, or right. If a piece finds that it cannot move, i.e., the cell in front is outside the board or is an obstacle, then it does not move forward. Instead, it rotates its direction by $180^\\circ$ (i.e., turns around). Note that after turning around, the piece will not move in this round.\n\n2. For all pieces, each piece has exactly one skill. Now all pieces release skills in order of increasing index; if a piece cannot release its skill, it is skipped. There are the following kinds of skills:\n\n\t1. Heavy Hammer Sparkles (toolihai): Centered on itself, it creates gorgeous fireworks that are pleasing to the eye, with no effect.\n\n\t2. King of Face (faceking): This piece is full of “face”, and all pieces must obey its command, forcing all pieces to rotate their directions $90^\\circ$ to the left (counterclockwise). The effect lasts permanently.\n\n\t3. Hair Gone (onepunch): After losing all its hair, Captain Wang becomes stronger, greatly boosting this piece’s attributes. That is, if the current attributes of piece $i$ are $\\left(a_i, b_i\\right)$, and the boost value is $v$, then its attributes become $\\left(a_i + v, b_i\\right)$. This effect lasts for $l$ rounds. If the current round is $H$, then this effect disappears at the start of round $H + l$. If before the effect disappears piece $i$’s attributes are $\\left(a_i, b_i\\right)$, then after the effect disappears its attributes become $\\left(\\max\\left(a_i - v, 0\\right), \\min\\left(b_i, \\max\\left(a_i - v, 0\\right)\\right)\\right)$. Note that before the effect disappears, this skill may be released again; multiple releases stack, but the disappearance time is computed separately for each release. (See the second sample.)\n\n\t4. Rabi Ribi (rabiribi): Swings a real heavy hammer to create sparks, knocking back all enemy units in a forward fan-shaped area. The affected range is a forward fan-shaped area of size $v$, as shown below:\n\n        ![](https://cdn.luogu.com.cn/upload/image_hosting/zgtwzsld.png)\n\t\t\n        From the figure, we can see that the piece releasing the skill is at the bottom, facing up, so the skill direction is also up. All cells above form the fan-shaped area affected by the skill. The fan size is $5$, i.e., $v = 5$. Note that some positions on the board have obstacles, and obstacles affect the skill range. If an obstacle lies within the skill range, then the fan-shaped area within the skill range starting from that obstacle will not be affected by the skill. In the figure, the lowest cell of each black column is an obstacle, and all black cells are cells that cannot be affected due to the obstacle.\n        \n        On the other hand, the knockback effect is defined as forcing a piece affected by the skill to move one cell along the skill direction, i.e., from $p_2$ being knocked back to position $p_3$ in the figure. If the knockback direction hits an obstacle or the board boundary, then handle it as follows:\n        \n        - If the next position is an obstacle, then it is knocked back to the cell behind that obstacle, i.e., from $p_0$ knocked back to $p_1$ in the figure.\n        - If the next position is outside the board, e.g., currently in the first row and it would be knocked back to row $0$, then it is knocked back to the cell in row $N$ in the same column.\n        \n        Repeat the above process until it is knocked back to a position that is neither an obstacle nor outside the board; then the knockback process ends. (See the first sample.)\n\n\t5. Dropout Fireworks (firework): After dropping out, there is more time to dig holes. It makes the piece that most recently released Heavy Hammer Sparkles unable to move for the next $l$ rounds. If no such piece exists, then it makes itself unable to move for the next $l$ rounds.\n\n\t6. Save Uganda (viuganda): Uses vim to save fallen pieces, reviving the farthest dead allied piece from itself. If there is no dead allied piece, then revive the closest dead enemy piece from itself. If the enemy also has no dead pieces, do nothing. The distance used here is Manhattan distance: if piece $i$ is at $\\left(x_i, y_i\\right)$ and piece $j$ is at $\\left(x_j, y_j\\right)$, then the distance is $\\left|x_i - x_j\\right| + \\left|y_i - y_j\\right|$. If multiple pieces have the same Manhattan distance to the current piece, choose the one with the largest index. If the revived piece can release its skill in the current round and has not been skipped yet, it will release its skill.\n\n\t7. Dimensionality Reduction Strike (2dsaigao): Uses a hyperspace weapon to fire a dynamic light wave to its right-front, making units in some area unable to release skills. After the light wave is fired, when it hits the board edge or an obstacle, its direction changes as shown below:\n\t\n\t\t![](https://cdn.luogu.com.cn/upload/image_hosting/3j1makll.png)\n\t\t\n        The center cell is where the current piece is, and its direction is left. Each time the light wave is about to enter a cell with an obstacle or the board edge, it rotates its direction $90^\\circ$ clockwise. Each time the light wave travels from the center of one cell to the center of another, we say it travels a distance of $1$. After the wave has traveled a distance of $o$, it explodes centered at the current cell, making all pieces whose Manhattan distance to that cell is at most $v$ unable to release skills for the next $l$ rounds, i.e., they cannot release skills from now until the start of round $H + l$. (See the first sample.)\n\n\t8. Gugu Gugu (gugugugu): In life, you must never “pigeon” others in an ordinary way; if you pigeon, you must pigeon everyone together. This skill makes all allied pieces that have not released their skill yet in the current round skip the skill-releasing stage, i.e., allied pieces that have not yet released their skill cannot release their skill in the current round.\n\n\t9. Backward Propagation (backward): Stop time, reverse the game, and return itself to the past, to some previous round. If the current round is $H$, and this effect returns to $l$ rounds earlier, then piece $i$ will return to round $H - l$. “Returning to round $H - l$” means that all of the following values of piece $i$ revert to their values at the start of round $H - l$:\n        \n        - Position and direction.\n        - Attributes.\n        - Whether it is alive and its revival time.\n        - Skill effects applied to it and their remaining durations.\n        \n        Note that the skill cooldown time of piece $i$ does not revert to the time of round $H - l$. (See the third sample.) (The skill cooldown rules are explained below.)\n\n\t10. Praise of Scallions (hupraise): The arrival of scallions makes today a sacred day, and red and blue pieces should be paired. Each red piece can be paired with any blue piece, and each piece can be paired with at most one opposing piece. Pieces $i$ and $j$ can be paired if they are from different teams and $a_i \\oplus a_j$ is a multiple of $3$ (this symbol is XOR). Now every time this skill is activated, you need to find the maximum number of pairs that can be formed.\n\n\t**Skill cooldown rules**: For all skills, if the current round is $H$ and piece $i$ releases its skill, then the skill will not finish cooling down until round $H + z_i$, and it can only be released again after that. If piece $i$ is affected in the current round by a skill lasting $l$ rounds, then the effect will be removed at the start of round $H + l$. For all pieces, if its first skill cooldown time is $f_i$ and its cooldown interval is $z_i$, then without influence from other pieces, it will release its skill for the first time in round $f_i$, and then once every $z_i$ rounds thereafter.\n\n3. For all cells on the board, if a cell contains both red pieces and blue pieces, then the pieces in that cell will engage in combat. The combat rules are as follows:\n\n    We define the combat power of piece $i$ as $\\binom{a_i}{b_i}$ (this is equivalent to $C_{a_i}^{b_i}$). In combat, each time both teams send out their own piece with the highest combat power in this cell to fight. Suppose the red team sends piece $i$ and the blue team sends piece $j$. If their combat powers are equal, then both pieces die. If they are not equal, suppose piece $i$ has higher combat power, then piece $j$ dies, and the two attributes of piece $i$ become $\\max\\left(a_i - a_j, 0\\right), \\max\\left(b_i - a_j, 0\\right)$. Repeat the above process until all pieces of one team in the cell have died. If piece $i$ dies in the current round, i.e., round $H$, then it will revive at the start of round $H + r_i$. After reviving, its two attributes return to the initial attribute values at the start of the game, and all skill effects on it are removed; its movement direction remains the same as before it died. During death, its skill cooldown proceeds normally, but it cannot move or release skills, and it is not affected by any other skills.\n\nNow Xiao Cong tells you everything related to this game. You need to simulate the game according to the rules and output the position of each piece after the game ends.", "inputFormat": "The input contains multiple test cases. The first line contains an integer $T$ indicating the number of test cases. Each test case is described as follows:\n\n* The first line contains four integers $N, M, K, R$.\n\n* The next $N$ lines each contain $M$ numbers. For the number in row $i$, column $j$, if it equals $0$, it means the cell at row $i$, column $j$ is a normal cell; otherwise, it is an obstacle.\n\n* The next $K$ lines each start with nine integers $x_i, y_i, a_i, b_i, c_i, d_i, f_i, z_i, r_i$, describing piece $i$. Its initial position is at row $x_i$, column $y_i$, its attributes are $a_i, b_i$, and its team is $c_i$. If $c_i = 0$ it is red; otherwise it is blue. The initial facing direction is $d_i$, where $d_i = 0, 1, 2, 3$ represent up, down, left, right. $f_i$ is the first cooldown time, and $z_i$ is the cooldown interval, i.e., if not affected by other pieces, piece $i$ releases its skill for the first time in round $f_i$, and then once every $z_i$ rounds. $r_i$ is its revival time. Then there is a string $s_i$, which is the English name of its skill, already given after each skill above. For different skill types, additional values are appended on the same line as follows:\n\n\t1. Heavy Hammer Sparkles (toolihai): no additional input.\n\n\t2. King of Face (faceking): no additional input.\n\n\t3. Hair Gone (onepunch): additional input $v_i, l_i$, representing the boost value and duration.\n\n\t4. Rabi Ribi (rabiribi): additional input $v_i$, representing the skill range.\n\t\t\n\t5. Dropout Fireworks (firework): additional input $l_i$, representing the duration of the effect.\n\n\t6. Save Uganda (viuganda): no additional input.\n\n\t7. Dimensionality Reduction Strike (2dsaigao): additional input $y_i, v_i, l_i$, representing the travel distance of the wave, the affected range after explosion, and the duration of the effect.\n\t\t\t\n\t8. Gugu Gugu (gugugugu): no additional input.\n\t\t\n\t9. Backward Propagation (backward): additional input $l_i$, meaning returning to $l_i$ rounds earlier. The data guarantees it will not return to before the start of the game.\n\t\t\t\n\t10. Praise of Scallions (hupraise): no additional input.", "outputFormat": "For each test case:\n\n* Every time skill $10$ is activated, output one line containing one integer.\n\n* After the game ends, output $K$ lines. Each line contains two integers indicating the current row and column of piece $i$.", "hint": "### Sample Explanation\n\nFor the first sample, when skill $7$ is released at the upper-left, the dynamic light wave is fired toward the corner. When it hits the corner and bounces back to the firing point, the distance is $1$, so it explodes in place, making skill $2$ unable to be released. The lower-right part shows an example of using skill $4$ to knock the opponent through the map.\n\nFor the second sample, the first piece releases its skill every time it moves one step to the right. In the first round it moves to $(1, 2)$, after releasing the skill its attributes become $(3, 2)$, and after fighting the opponent its attributes become $(2, 1)$. In the second round it moves to $(1, 3)$, after releasing the skill its attributes become $(3, 1)$, and after fighting the opponent its attributes become $(3, 0)$. In the third round it moves to $(1, 4)$. Since the skill effect released in the first round disappears, its attributes revert to $(2, 0)$, then it releases the skill again to become $(3, 0)$, and then it is beaten to death by the opponent. So it finally stays at $(1, 4)$.\n\nFor the third sample, the piece releases its skill every two moves to jump back to the state two rounds ago, and repeats this cycle.\n\n### Constraints\n\nIt is guaranteed that $1 \\leq T \\leq 20$, $1 \\leq N, M \\leq 100$, $1 \\leq K \\leq 200$, $1 \\leq R \\leq 1000$.\n\nIt is guaranteed that among all additional inputs, except that the durations of skills $3, 5, 7$ are greater than $0$, all others are at least $0$.\n\nIt is guaranteed that no piece starts on an obstacle, and both the initial and boosted attribute values do not exceed $1000$ (but it is not guaranteed that attributes after boosts are at most $1000$).\n\nIt is guaranteed that the first cooldown time, the cooldown interval, and the revival time are all greater than $0$.\n\n### Copyright Information\n\nFrom Tsinghua University Programming Contest and Collegiate Invitational 2018 (THUPC2018). Thanks to [Pony.ai](http://pony.ai/) for supporting this contest.\n\nSolutions and other resources can be found at <https://github.com/wangyurzee7/THUPC2018>.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[THUPC 2018] 组合数问题", "background": "**友情提示：本题篇幅较长。**", "description": "众所周知，小葱同学擅长计算，尤其擅长计算组合数。\n\n于是现在我们有了一个 $N\\times M$ 的棋盘，棋盘上有些地方会有障碍物的存在。在棋盘上有 $K$ 枚棋子，每枚棋子要么属于红队要么属于蓝队。此外，每枚棋子有两个属性值，第 $i$ 枚棋子的两个属性记为 $a_i,b_i$ 并且保证 $a_i\\geq b_i$。既然有了两支队伍那么小葱同学就要来玩游戏，这个游戏一共有 $R$ 个回合。每个回合内，每枚棋子会按照如下顺序进行游戏：\n\n0. 回合开始，记当前是第 $H$ 回合。若现在为游戏的开始时刻，则 $H=1$。\n\n1. 对于所有能够移动的棋子，沿着自己当前的方向移动一格。每枚棋子的朝向一定是上下左右中的一种。如果棋子发现自己不能移动，即前方格子为棋盘外部或者障碍物，那么则不向前移动，而是将自己的方向旋转一百八十度，即进行向后转的操作（注意此时转了之后棋子这回合内并不会进行移动）。\n\n2. 对于所有棋子，每个棋子都拥有且仅拥有一种技能。此时所有棋子按照编号从小到大依次释放技能，如果不能释放技能则跳过。技能总共分为以下几种：\n\n\t1. 重锤火花（toolihai）：以自身为中心，制造出绚丽的烟花，令人赏心悦目，无任何效果。\n\n\t2. 面子之王（faceking）：该棋子充满了面子，所有棋子都要听其号令，使得所有棋子的方向强制向左（逆时针）转九十度。该技能的效果持续时间为永久。\n\n\t3. 头发掉光（onepunch）：头发掉光之后，王队长变得更强了，使该枚棋子的属性大幅度提升。即若当前棋子 $i$ 的属性为 $\\left(a_i,b_i\\right)$，属性的提升值为 $v$，那么该棋子的属性则变为 $\\left(a_i+v,b_i\\right)$。该技能的效果能持续 $l$ 个回合，若当前回合为 $H$，则该技能效果会在第 $H+l$ 回合开始的时候消失。若在技能消失前棋子 $i$ 的属性为 $\\left(a_i,b_i\\right)$，则技能效果消失后其属性会变为 $\\left(\\max\\left(a_i-v,0\\right),\\min\\left(b_i,\\max\\left(a_i-v,0\\right)\\right)\\right)$。注意在该技能效果消失前该技能可能被再次释放，则多次释放的技能效果叠加，但技能效果消失的时间分开计算。（详见样例第二组数据）\n\n\t4. 拉比哩比（rabiribi）：挥动真正的重锤，制造火花，击退前方扇形区域的所有敌方单位。该技能所能影响到的范围为前方大小为 $v$ 的扇形区域，所谓扇形区域可见下图：\n\n        ![](https://cdn.luogu.com.cn/upload/image_hosting/zgtwzsld.png)\n\t\t\n        从上图我们可以看出，在图的最下方有正在释放技能的棋子，其技能朝向为上，所以其技能方向也为上。则上方的所有区域则为其技能所影响到的扇形区域，该扇形区域大小为 $5$，即 $v=5$。注意到棋盘上某些位置会有障碍物，障碍物的存在会影响到该技能的影响范围。如果一个障碍物存在于技能范围之内，那么以障碍物开始的处于技能范围内的扇形区域也都不会受到技能的影响。如上图可见，所有黑色格子的最下方格子即为障碍物的位置，所有黑色格子即为受到障碍物影响所不能被技能效果影响的格子。\n        \n        另一方面，击退效果的定义为将受到技能影响效果的棋子沿着技能释放方向强制移动一格，即从图中 $p_2$ 被击退到 $p_3$ 的位置。如果被击退方向是障碍物或者棋盘边界，则按一下规则进行：\n        \n        - 如果下一位置为障碍物，则被击退到该障碍物后面，即从图中的 $p_0$ 击退到 $p_1$。\n        - 如果下一位置为棋盘外部，如当前在第一行并且要被击退到第零行，则被击退到第 $N$ 行对应的同一列的位置。\n        \n        重复以上过程直到被击退到一个不是障碍物和棋盘外部的位置，则该击退过程结束。（详见样例第一组数据）\n\t\n\t5. 退学花火（firework）：退学之后，有了更多的时间来挖坑。使得上一个释放重锤火花的棋子在接下来 $l$ 回合内无法移动。如果不存在这样的棋子，则使自己在接下来 $l$ 回合内无法移动。\n\n\t6. 救乌干达（viuganda）：使用vim，拯救阵亡的棋子，复活距离自身最远的阵亡的己方棋子。若己方没有阵亡棋子，则复活对方距离自身最近的阵亡棋子。如果对方也没有阵亡棋子，则什么也不做。我们这里使用的距离为曼哈顿距离，即若第 $i$ 枚棋子处于位置 $\\left(x_i,y_i\\right)$， 第 $j$ 枚棋子处于位置 $\\left(x_j,y_j\\right)$，那么此时两枚棋子的距离为 $\\left|x_i-x_j\\right|+\\left|y_i-y_j\\right|$。如果同时有多枚棋子距离当前棋子的曼哈顿距离一样，那么我们选择其中编号最大的棋子即可。棋子被复活后如果当前回合可以释放技能并且仍然没有被跳过，则会释放技能。\n\n\t7. 降维打击（2dsaigao）：利用超时空武器，向自己右前方发射动感光波，使得某个区域内的单位不能释放技能。该动感光波发射之后，遇到棋盘边缘或者障碍物则会发生方向改变的现象，如下图所示：\n\t\n\t\t![](https://cdn.luogu.com.cn/upload/image_hosting/3j1makll.png)\n\t\t\n        中间格子为当前棋子所处的位置，其方向向左。每当该光波会进入一个有障碍物的格子或者棋盘边缘的时候，该光波就会改变自己的方向顺时针旋转 $90^\\circ$。该光波每从一个格子的中心到达另一个格子的中心时我们称该光波走了 $1$ 的距离。当光波走了 $o$ 的距离之后，光波就会以当前格子为中心发生爆炸，使得所有距离当前格子曼哈顿距离不超过 $v$ 的棋子在接下来 $l$ 回合的时间内都不能释放技能，即从现在到第 $H+l$ 回合开始的这段时间内都不能释放技能。（详见样例第一组数据）\n\t\t\n\t8. 咕咕咕咕（gugugugu）：做人，绝不能普普通通的鸽了别人；要鸽，必须带着大家一起鸽。该技能效果为使得己方所有当前回合还没有释放技能的棋子全部跳过技能释放的环节，即使得己方还未释放技能的棋子当前回合不能释放技能。\n\t\n\t9. 反向传播（backward）：让时间暂停，让游戏倒流，让自身回到过去，回到之前的某个回合。若当前为第 $H$ 回合，该技能效果是回到 $l$ 回合前，则当前棋子 $i$ 会回到第 $H-l$ 回合。所谓回到第 $H-l$ 回合，即当前棋子的一下所有值都会变回第 $H-l$ 回合开始的时候的值：\n        \n        - 位置及方向。\n        - 属性。\n        - 是否存活以及复活时间。\n        - 受到的技能影响的效果以及剩余时间。\n        \n        注意此时棋子 $i$ 的技能刷新时间并不会回到第 $H-l$ 回合的时间。（详见样例第三组数据）（技能刷新时间的规则会在下面说明）\n\t\t\n\t10. 葱之礼赞（hupraise）：葱的到来，使得今天变为了一个神圣的日子，要将红蓝双方的棋子进行配对。每个红方棋子可以和任何一个蓝方棋子进行配对，并且每个棋子都最多只能和对面一个棋子进行配对。第 $i$ 枚棋子 和第 $j$ 枚棋子能够配对的条件为两个棋子属于不同阵营并且 $a_i\\oplus a_j$ 是 $3$ 的倍数（该符号为异或）。现在每当该技能发动时，你需要求出最多能够配多少对。\n\n\t**技能刷新规则**：对于所有技能，当前为第 $H$ 回合，如果第 $i$ 枚棋子释放了技能，那么在第 $H+z_i$ 回合的时候该技能才回复完毕，才能再次释放技能。如果第 $i$ 枚棋子在当前回合中了一个持续时间为 $l$ 回合的技能，那么该技能的影响将在第 $H+l$ 回合开始的时候消除。对于所有棋子，若其首轮技能回复时间为 $f_i$，技能回复时间为 $z_i$，则若没有其他棋子的影响，其第一次将在第 $f_i$ 回合释放技能，之后每 $z_i$ 回合再次释放技能。\n\n3. 对于棋盘上所有格子，如果一个格子内既有红队棋子又有蓝队棋子，那么此时这个格子内的棋子便会发生交战。交战的规则如下：\n\n    我们规定第 $i$ 枚棋子的战斗力为 $\\binom{a_i}{b_i}$（该式子等价于 $C_{a_i}^{b_i}$）。在交战时，每次由红蓝双方派出己方在这个格子战力最大的棋子进行交战。假设红方派出第 $i$ 枚棋子，蓝方派出第 $j$ 枚棋子。如果红方蓝方两枚棋子战斗力一样，那么派出的两枚棋子均阵亡。若战斗力不一样，假设第 $i$ 枚棋子战力更高，那么第 $j$ 枚棋子阵亡，同时第 $i$ 枚棋子的两个属性变为 $\\max\\left(a_i-a_j,0\\right),\\max\\left(b_i-a_j,0\\right)$。不断重复以上操作直到一方棋子全部阵亡。若第 $i$ 枚棋子在当前回合即第 $H$ 回合阵亡，那么第 $i$ 枚棋子会在第 $H+r_i$ 回合开始的时候复活。第 $i$ 枚棋子复活之后将其两个属性将变为游戏开始时候的属性值，并且移除所有当前棋子身上的技能效果，其移动方向保持阵亡前的移动方向。棋子阵亡期间其技能正常回复，但是不能移动和释放技能，并且不受到其他任何技能的影响。\n\n\n现在小葱告诉你所有与这游戏相关的东西，希望你按照游戏规则来进行游戏，并输出游戏结束之后每个棋子的位置。", "inputFormat": "输入包含多组数据，第一行一个整数 $T$ 表示数据组数。接下来依次描述每组数据，对于每组数据：\n\n* 第一行四个整数 $N,M,K,R$。\n\n* 接下来 $N$ 行每行 $M$ 个数。对于第 $i$ 行第 $j$ 列的数，如果等于 $0$ 则代表第 $i$ 行第 $j$ 列的格子为普通格子，否则为障碍物。\n\n* 接下来 $K$ 行，每行一开始有九个整数 $x_i,y_i,a_i,b_i,c_i,d_i,f_i,z_i,r_i$。代表第 $i$ 枚棋子一开始的位置位于第 $x_i$ 行 第 $y_i$ 列，其属性值为 $a_i,b_i$ 并且所属的阵营为 $c_i$。如果 $c_i=0$ 则为红方否则为蓝方。棋子 $i$ 一开始的朝向为 $d_i$，$d_i=0,1,2,3$ 分别表示上下左右四个方向。$f_i$ 为技能首轮回复时间，$z_i$ 为技能回复时间，即第 $i$ 枚棋子若在没有受到其他棋子影响的情况下，第一次将在第 $f_i$ 回合释放技能，之后每 $z_i$ 回合再次释放技能。$r_i$ 为其复活时间。接下来一个字符串 $s_i$ 为其技能的英文名字，已在每个技能后面注明了其对应的英文名字。对于不同的技能种类，会在当前行增加一定的输入值，具体如下：\n\n\t1. 重锤火花（toolihai），无增加的输入。\n\n\t2. 面子之王（faceking），无增加的输入。\n\n\t3. 头发掉光（onepunch），增加输入 $v_i,l_i$，代表该技能的增益效果和持续时间。\n\n\t4. 拉比哩比（rabiribi），增加输入 $v_i$ 代表技能的范围。\n\t\t\n\t5. 退学花火（firework），增加输入 $l_i$ 代表技能的影响时间。\n\n\t6. 救乌干达（viuganda），无增加的输入。\n\n\t7. 降维打击（2dsaigao），增加输入 $y_i,v_i,l_i$，代表光波能移动的距离、光波爆炸后能影响的范围以及技能的影响持续时间。\n\t\t\t\n\t8. 咕咕咕咕（gugugugu），无增加的输入。\n\t\t\n\t9. 反向传播（backward），增加输入 $l_i$，表示回到 $l_i$ 回合之前，数据保证不会回到游戏开始之前。\n\t\t\t\n\t10. 葱之礼赞（hupraise），无增加的输入。", "outputFormat": "对于每组数据：\n\n* 每当技能 $10$ 发动时，输出一行一个整数。\n\n* 在游戏结束之后，输出 $K$ 行，每行两个整数代表第 $i$ 枚棋子现在处于哪一行哪一列。", "hint": "### 样例解释\n\n对于第一组数据，在左上方释放技能 $7$ 时，是朝着角落里射出的动感光波，所以碰到角落返回回射出点时，此时距离为 $1$，正好原地爆炸，使得技能 $2$ 无法放出。而右下方是在释放技能 $4$ 时，将对方击穿了地图的例子。\n\n对于第二组数据，第一枚棋子每次向右走一步就会释放一次技能。第一回合走到 $(1,2)$，释放技能后属性变为 $(3,2)$，和对方交战后属性变为 $(2,1)$。第二回合走到 $(1,3)$，释放技能后属性变为 $(3,1)$，和对方交战后属性变为 $(3,0)$。第三回合走到 $(1,4)$，由于之前第一回合释放的技能效果消失，属性变回 $(2,0)$，再重新释放技能变为 $(3,0)$，然后被对手痛殴致死。所以最后停留在了 $(1,4)$。\n\n对于第三组数据，该棋子每走两次就会释放技能跳回两回合前的状态，不断循环这样的过程。\n\n### 数据范围\n\n保证 $1\\leq T\\leq 20$，$1\\leq N,M\\leq 100$，$1\\leq K\\leq 200$，$1\\leq R\\leq 1000$。\n\n保证所有的附加输入除了技能 $3,5,7$ 的影响时间大于 $0$ 以外，剩下均大于等于 $0$。\n\n保证棋子一开始不在障碍物上，一开始以及增幅的属性值均不超过 $1000$（但不保证增幅后的属性超过 $1000$）。\n\n保证技能的首轮回复时间、之后的回复时间以及复活时间均大于 $0$。\n\n### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN"}}}
{"pid": "P5454", "type": "P", "difficulty": 5, "samples": [["4 2\n0 0 1", "3 12\n1 2\n1 3\n1 4"], ["10 9\n10 9 8 7 6 5 4 3 2 1", "9 177454\n4 5\n4 6\n3 4\n3 7\n2 3\n2 8\n1 2\n1 9\n1 10"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2018", "Special Judge", "THUPC"], "title": "[THUPC 2018] 城市地铁规划", "background": "", "description": "经过选拔，Kiana成为了可乐城的市长，为了兑现选举承诺，她决定在可乐城的 $n$ 个重要地标之间修建地铁。\n\n可乐城的交通状况并不复杂，在任意两个地标之间修建一条地铁轨道都是可行的，但是地铁轨道并不是越多越好，如果有太多地铁从一个地标处经过，该地标的拥堵程度将大幅增加。为此，Kiana决定给每个地标一个便利度来衡量拥堵程度，如果有 $d$ 条地铁轨道经过了某个地标，那么该地标的便利度为 $f(d)\\mod 59393$，其中 $f(x)=\\sum_{i=0}^{k}a_ix^i$ 是Kiana指定的一个 $k$ 次多项式。\n\n因为修建地铁有一定的成本，所以Kiana希望新建的地铁轨道尽可能少，但任意两座地标之间都需要能通过地铁相互到达。Kiana想知道在给定的条件下，什么样的修建方案可以使得地标的便利度之和最大。由于她不会做，所以希望你来告诉她答案。", "inputFormat": "输入第一行包含两个正整数 $n$ 和 $k$，分别表示可乐城的地标总数和Kiana指定的多项式次数，地标的编号依次为 $1$ 至 $n$，数据保证 $n\\leq 3000$且 $k\\leq 10$。\n\n输入第二行包含 $k+1$ 个非负整数 $a_0\\sim a_k$，即Kiana指定的多项式的系数，数据保证所有的 $a_i\\leq 50$。", "outputFormat": "输出由若干行组成，第一行包含两个用空格隔开的正整数 $m$ 和 $S$，分别表示你的方案中修建的地铁轨道数量与最终的便利度之和。\n\n接下来 $m$ 行，每行包含两个用空格隔开的正整数 $u$ 和 $v$，表示在第 $u$ 和第 $v$ 个地标之间修建了一条地铁轨道。\n\n本题将采用Special Judge，如果有多种方案使得地标的便利度之和最大，输出其中任意一种即可。", "hint": "### 备注\n\n本题因为一些原因只保留了后 $50$ 组数据。\n\n### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN", "translations": {"en": {"title": "[THUPC 2018] City Metro Planning", "background": "", "description": "After being selected, Kiana became the mayor of Kele City. To fulfill her campaign promise, she decided to build a metro system among the $n$ important landmarks in Kele City.\n\nThe traffic situation in Kele City is not complicated. It is feasible to build a metro track between any two landmarks. However, more metro tracks are not always better: if too many tracks pass through a landmark, the congestion at that landmark will increase significantly. Therefore, Kiana decided to assign each landmark a convenience value to measure congestion. If $d$ metro tracks pass through a landmark, then its convenience value is $f(d)\\mod 59393$, where $f(x)=\\sum_{i=0}^{k}a_ix^i$ is a degree-$k$ polynomial specified by Kiana.\n\nBuilding metro tracks has a cost, so Kiana wants the number of newly built tracks to be as small as possible, while any two landmarks must be able to reach each other by metro. Kiana wants to know, under the given conditions, what construction plan can maximize the sum of convenience values over all landmarks. Since she cannot solve it, she asks you to give her the answer.", "inputFormat": "The first line contains two positive integers $n$ and $k$, representing the total number of landmarks in Kele City and the degree of the polynomial specified by Kiana. The landmarks are numbered from $1$ to $n$. The testdata guarantees $n\\leq 3000$ and $k\\leq 10$.\n\nThe second line contains $k+1$ non-negative integers $a_0\\sim a_k$, i.e., the coefficients of the polynomial specified by Kiana. The testdata guarantees that all $a_i\\leq 50$.", "outputFormat": "The output consists of multiple lines. The first line contains two positive integers $m$ and $S$ separated by a space, representing the number of metro tracks built in your plan and the final sum of convenience values.\n\nIn the next $m$ lines, each line contains two positive integers $u$ and $v$ separated by a space, indicating that a metro track is built between landmark $u$ and landmark $v$.\n\nThis problem uses a Special Judge. If multiple plans maximize the sum of convenience values, you may output any one of them.", "hint": "### Notes\n\nDue to some reasons, only the last $50$ groups of testdata are kept for this problem.\n\n### Copyright Information\n\nFrom the 2018 Tsinghua University Programming Contest and Collegiate Invitational (THUPC2018). Thanks to [Pony.ai](http://pony.ai/) for supporting this contest.\n\nResources such as solutions can be found at <https://github.com/wangyurzee7/THUPC2018>.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[THUPC 2018] 城市地铁规划", "background": "", "description": "经过选拔，Kiana成为了可乐城的市长，为了兑现选举承诺，她决定在可乐城的 $n$ 个重要地标之间修建地铁。\n\n可乐城的交通状况并不复杂，在任意两个地标之间修建一条地铁轨道都是可行的，但是地铁轨道并不是越多越好，如果有太多地铁从一个地标处经过，该地标的拥堵程度将大幅增加。为此，Kiana决定给每个地标一个便利度来衡量拥堵程度，如果有 $d$ 条地铁轨道经过了某个地标，那么该地标的便利度为 $f(d)\\mod 59393$，其中 $f(x)=\\sum_{i=0}^{k}a_ix^i$ 是Kiana指定的一个 $k$ 次多项式。\n\n因为修建地铁有一定的成本，所以Kiana希望新建的地铁轨道尽可能少，但任意两座地标之间都需要能通过地铁相互到达。Kiana想知道在给定的条件下，什么样的修建方案可以使得地标的便利度之和最大。由于她不会做，所以希望你来告诉她答案。", "inputFormat": "输入第一行包含两个正整数 $n$ 和 $k$，分别表示可乐城的地标总数和Kiana指定的多项式次数，地标的编号依次为 $1$ 至 $n$，数据保证 $n\\leq 3000$且 $k\\leq 10$。\n\n输入第二行包含 $k+1$ 个非负整数 $a_0\\sim a_k$，即Kiana指定的多项式的系数，数据保证所有的 $a_i\\leq 50$。", "outputFormat": "输出由若干行组成，第一行包含两个用空格隔开的正整数 $m$ 和 $S$，分别表示你的方案中修建的地铁轨道数量与最终的便利度之和。\n\n接下来 $m$ 行，每行包含两个用空格隔开的正整数 $u$ 和 $v$，表示在第 $u$ 和第 $v$ 个地标之间修建了一条地铁轨道。\n\n本题将采用Special Judge，如果有多种方案使得地标的便利度之和最大，输出其中任意一种即可。", "hint": "### 备注\n\n本题因为一些原因只保留了后 $50$ 组数据。\n\n### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN"}}}
{"pid": "P5455", "type": "P", "difficulty": 6, "samples": [["4 10\n1 6 10 2\n100 2333 666 300\n7\n3 1 4\n3 1 3\n1 2 4 1\n3 1 4\n2 2 3 -1000\n2 2 3 -600\n3 2 4", "15165 2865\n14165 2169\n36630 798\n4899 1273"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2018", "线段树", "背包 DP", "THUPC"], "title": "[THUPC 2018] 弗雷兹的玩具商店", "background": "物是人非事事休，欲语泪先流。\n", "description": "弗雷兹在 C 市有一个玩具店，店里有 $n$ 种玩具，编号依次为 $1,2,\\dots, n$，编号为 $i$ 的玩具的单价为 $c_i$ 元，一个该玩具提供的愉悦度为 $v_i$ 。\n\n突然有一天，C市来了 $m$ 个小朋友。据可靠消息，这些小朋友会在一些时刻一起来店里买东西，其中第 $i$ 个小朋友每次都会带 $i$ 元（ $1\\leq i\\leq m$ ）。\n\n由于某些玩具特别优秀，所以每次小朋友们都会在特定的编号范围内挑选玩具。\n\n除此之外，由于小朋友们在一年前的清华校赛中就愉悦得无法自拔，所以弗雷兹放弃了对他们的治疗，于是小朋友们就可以无限制地购买玩具了。也就是说，对于任意玩具，每个小朋友在每次的购买件数都可以是任意的非负整数。\n\n时代飞速发展，玩具的受欢迎程度和价格也会随着时代的发展而改变。\n\n为了方便你处理这些信息，Yazid 进行了整理，发现这些日子里，弗雷兹的玩具商店里共发生了 $Q$ 个事件。\n\n对于每个事件，都有 $3$ 个基本参数 $op,l,r$ 。其中 $op$ 为 $1$ 至 $3$ 之间的整数，代表了事件的类别：\n\n1. 对于 $op=1$ 的事件，Yazid 还会给你一个额外参数 $d$ ，表示这是一个**价格调整**事件：将编号在区间 $[l,r]$ 内的玩具的单价 $c$ 全部增加 $d$ 元。为了防止单价超过 $m$ 元导致玩具永远无法被小朋友们购买，弗雷兹会将所有超过 $m$ 的单价减去 $m$。（保证 $d$ 为不超过 $m$ 的正数）\n\n2. 对于 $op=2$ 的事件，Yazid还会给你一个额外参数 $b$ ，表示这是一个**愉悦修正**事件：将编号在区间 $[l,r]$ 内的玩具的愉悦度 $v$ 全部增加 $b$ 。（需要注意这里的 $b$ 可能是负数）\n\n3. 对于 $op=3$ 的事件，表示**购买**事件：所有的 $m$ 个小朋友来到弗雷兹的玩具商店，在编号范围在 $[l,r]$ 内的玩具中进行随意地购买。\n\n现在，对于每一次的购买事件，你想知道：\n\n1. 所有小朋友所能获得的最大愉悦度之和。\n\n2. 所有小朋友所能获得的最大愉悦度的异或和（异或运算是 $\\mathrm{xor}$ 运算，即 C++/Java/Python 中的 `^` 运算）。", "inputFormat": "* 第 $1$ 行 $2$ 个正整数 $n,m$，分别表示玩具数量、以及小朋友的数量。\n\n* 第 $2$ 行 $n$ 个正整数 $c_1,\\dots,c_n$，依次描述各玩具的单价。\n\n* 第 $3$ 行 $n$ 个正整数 $v_1,\\dots,v_n$，依次描述各玩具的愉悦度。\n\n* 第 $4$ 行 $1$ 个非负整数 $Q$，表示事件的数量。\n\n* 接下来 $Q$ 行依次描述所有事件，每行描述一个事件。每行的开头是 $3$ 个整数 $op,l,r$，意义见题目描述。\n\n\t* 如果 $op=1$，接下来跟随 $1$ 个该事件的额外参数（整数） $d$，意义见题目描述。\n\t\n\t* 如果 $op=2$，接下来跟随 $1$ 个该事件的额外参数（整数） $b$，意义见题目描述。\n\t\n\t* 如果 $op=3$，接下来无任何额外参数。\n\t\n\t* 保证 $1\\leq l\\leq r\\leq n$。\n\n对于每一行，如果包含多个数，则用单个空格将它们隔开。", "outputFormat": "* 对于每个购买事件，输出一行 $2$ 个用空格隔开的整数，依次表示所有小朋友所能获得的最大愉悦度之和、以及所有小朋友所能获得的最大愉悦度的异或和。", "hint": "### 样例解释\n\n对于第 $1$ 个购买事件，各位小朋友（编号从小到大，即从 $1$ 至 $10$）能够获得的最大愉悦度依次为：$100,300,400,600,700,2333,2433,2633,2733,2933$。\n\n对于第 $2$ 个购买事件，各位小朋友（编号从小到大，即从 $1$ 至 $10$）能够获得的最大愉悦度依次为：$100,200,300,400,500,2333,2433,2533,2633,2733$。\n\n对于第 $3$ 个购买事件，各位小朋友（编号从小到大，即从 $1$ 至 $10$）能够获得的最大愉悦度依次为：$666,1332,1998,2664,3330,3996,4662,5328,5994,6660$。\n\n对于第 $4$ 个购买事件，各位小朋友（编号从小到大，即从 $1$ 至 $10$）能够获得的最大愉悦度依次为：$0,0,300,300,300,600,733,733,900,1033$。\n\n根据这些信息，你将很容易计算出答案。\n\n### 数据范围\n\n保证 $1\\le n\\leq 200,000$，$1\\le m\\leq 60$，$0\\le Q\\leq 30,000$。\n\n保证 $1\\leq c_i,d\\leq m$。\n\n保证 $0\\leq v_i\\leq 10^7$，$\\left| b\\right|\\leq 10^3$。\n\n### 提示\n\n这个提示本不该有，但善良的出题人还是想提醒你：所有小朋友所能获得的最大愉悦度之和有可能超过 $32$ 位有符号整数的范围。\n\n### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN", "translations": {"en": {"title": "[THUPC 2018] Freyz’s Toy Store", "background": "Everything has changed, and nothing remains the same. I want to speak, but tears come first.", "description": "Freyz has a toy store in City C. The store sells $n$ kinds of toys, numbered $1,2,\\dots,n$. The unit price of toy $i$ is $c_i$ yuan, and buying one unit of this toy provides happiness value $v_i$.\n\nOne day, $m$ children came to City C. According to reliable information, these children will come to the store together at certain times to buy things. Each time, the $i$-th child will bring exactly $i$ yuan ($1\\leq i\\leq m$).\n\nBecause some toys are especially good, every time the children will only choose toys within a specific index range.\n\nAlso, since the children were already so happy in last year’s Tsinghua programming contest that they could not stop, Freyz gave up treating them, so the children can buy toys without limits. That is, for any toy, each child can buy any non-negative integer quantity each time.\n\nAs time moves forward quickly, the popularity and prices of toys may also change.\n\nTo help you handle this information, Yazid organized it and found that there were $Q$ events in Freyz’s toy store during these days.\n\nEach event has $3$ basic parameters $op,l,r$. Here $op$ is an integer from $1$ to $3$, representing the type of the event:\n\n1. For an event with $op=1$, Yazid will also give you an extra parameter $d$, meaning this is a **price adjustment** event: increase the unit price $c$ of all toys with indices in $[l,r]$ by $d$ yuan. To prevent a unit price from exceeding $m$ yuan and making the toy never purchasable by the children, Freyz will subtract $m$ from any unit price that exceeds $m$. (It is guaranteed that $d$ is a positive integer not exceeding $m$.)\n\n2. For an event with $op=2$, Yazid will also give you an extra parameter $b$, meaning this is a **happiness modification** event: increase the happiness value $v$ of all toys with indices in $[l,r]$ by $b$. (Note that $b$ may be negative.)\n\n3. For an event with $op=3$, this is a **purchase** event: all $m$ children come to Freyz’s toy store and buy freely among the toys with indices in $[l,r]$.\n\nNow, for each purchase event, you want to know:\n\n1. The sum of the maximum total happiness that all children can obtain.\n\n2. The xor sum of the maximum total happiness that all children can obtain (xor is the $\\mathrm{xor}$ operation, i.e. the `^` operator in C++/Java/Python).", "inputFormat": "* Line $1$: two positive integers $n,m$, representing the number of toys and the number of children.\n\n* Line $2$: $n$ positive integers $c_1,\\dots,c_n$, describing the unit price of each toy.\n\n* Line $3$: $n$ positive integers $v_1,\\dots,v_n$, describing the happiness value of each toy.\n\n* Line $4$: one non-negative integer $Q$, representing the number of events.\n\n* The next $Q$ lines describe all events, one per line. Each line starts with three integers $op,l,r$, as described above.\n\n\t* If $op=1$, it is followed by one extra parameter (integer) $d$, as described above.\n\t\n\t* If $op=2$, it is followed by one extra parameter (integer) $b$, as described above.\n\t\n\t* If $op=3$, there is no extra parameter.\n\t\n\t* It is guaranteed that $1\\leq l\\leq r\\leq n$.\n\nIn each line, if there are multiple numbers, they are separated by a single space.", "outputFormat": "* For each purchase event, output one line with two integers separated by a space, representing the sum of the maximum happiness all children can obtain, and the xor sum of the maximum happiness all children can obtain, in this order.", "hint": "### Sample Explanation\n\nFor the $1$-st purchase event, the maximum happiness each child (in order of indices from $1$ to $10$) can obtain is: $100,300,400,600,700,2333,2433,2633,2733,2933$.\n\nFor the $2$-nd purchase event, the maximum happiness each child (in order of indices from $1$ to $10$) can obtain is: $100,200,300,400,500,2333,2433,2533,2633,2733$.\n\nFor the $3$-rd purchase event, the maximum happiness each child (in order of indices from $1$ to $10$) can obtain is: $666,1332,1998,2664,3330,3996,4662,5328,5994,6660$.\n\nFor the $4$-th purchase event, the maximum happiness each child (in order of indices from $1$ to $10$) can obtain is: $0,0,300,300,300,600,733,733,900,1033$.\n\nWith this information, you can easily compute the answers.\n\n### Constraints\n\nIt is guaranteed that $1\\le n\\leq 200,000$, $1\\le m\\leq 60$, $0\\le Q\\leq 30,000$.\n\nIt is guaranteed that $1\\leq c_i,d\\leq m$.\n\nIt is guaranteed that $0\\leq v_i\\leq 10^7$, $\\left| b\\right|\\leq 10^3$.\n\n### Hint\n\nThis hint should not have existed, but the kind problem setter still wants to remind you: the sum of the maximum happiness all children can obtain may exceed the range of 32-bit signed integers.\n\n### Copyright Information\n\nFrom the 2018 Tsinghua University Programming Contest and Intercollegiate Invitational (THUPC2018). Thanks to [Pony.ai](http://pony.ai) for supporting this contest.\n\nSolutions and other resources can be found at <https://github.com/wangyurzee7/THUPC2018>.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[THUPC 2018] 弗雷兹的玩具商店", "background": "物是人非事事休，欲语泪先流。\n", "description": "弗雷兹在 C 市有一个玩具店，店里有 $n$ 种玩具，编号依次为 $1,2,\\dots, n$，编号为 $i$ 的玩具的单价为 $c_i$ 元，一个该玩具提供的愉悦度为 $v_i$ 。\n\n突然有一天，C市来了 $m$ 个小朋友。据可靠消息，这些小朋友会在一些时刻一起来店里买东西，其中第 $i$ 个小朋友每次都会带 $i$ 元（ $1\\leq i\\leq m$ ）。\n\n由于某些玩具特别优秀，所以每次小朋友们都会在特定的编号范围内挑选玩具。\n\n除此之外，由于小朋友们在一年前的清华校赛中就愉悦得无法自拔，所以弗雷兹放弃了对他们的治疗，于是小朋友们就可以无限制地购买玩具了。也就是说，对于任意玩具，每个小朋友在每次的购买件数都可以是任意的非负整数。\n\n时代飞速发展，玩具的受欢迎程度和价格也会随着时代的发展而改变。\n\n为了方便你处理这些信息，Yazid 进行了整理，发现这些日子里，弗雷兹的玩具商店里共发生了 $Q$ 个事件。\n\n对于每个事件，都有 $3$ 个基本参数 $op,l,r$ 。其中 $op$ 为 $1$ 至 $3$ 之间的整数，代表了事件的类别：\n\n1. 对于 $op=1$ 的事件，Yazid 还会给你一个额外参数 $d$ ，表示这是一个**价格调整**事件：将编号在区间 $[l,r]$ 内的玩具的单价 $c$ 全部增加 $d$ 元。为了防止单价超过 $m$ 元导致玩具永远无法被小朋友们购买，弗雷兹会将所有超过 $m$ 的单价减去 $m$。（保证 $d$ 为不超过 $m$ 的正数）\n\n2. 对于 $op=2$ 的事件，Yazid还会给你一个额外参数 $b$ ，表示这是一个**愉悦修正**事件：将编号在区间 $[l,r]$ 内的玩具的愉悦度 $v$ 全部增加 $b$ 。（需要注意这里的 $b$ 可能是负数）\n\n3. 对于 $op=3$ 的事件，表示**购买**事件：所有的 $m$ 个小朋友来到弗雷兹的玩具商店，在编号范围在 $[l,r]$ 内的玩具中进行随意地购买。\n\n现在，对于每一次的购买事件，你想知道：\n\n1. 所有小朋友所能获得的最大愉悦度之和。\n\n2. 所有小朋友所能获得的最大愉悦度的异或和（异或运算是 $\\mathrm{xor}$ 运算，即 C++/Java/Python 中的 `^` 运算）。", "inputFormat": "* 第 $1$ 行 $2$ 个正整数 $n,m$，分别表示玩具数量、以及小朋友的数量。\n\n* 第 $2$ 行 $n$ 个正整数 $c_1,\\dots,c_n$，依次描述各玩具的单价。\n\n* 第 $3$ 行 $n$ 个正整数 $v_1,\\dots,v_n$，依次描述各玩具的愉悦度。\n\n* 第 $4$ 行 $1$ 个非负整数 $Q$，表示事件的数量。\n\n* 接下来 $Q$ 行依次描述所有事件，每行描述一个事件。每行的开头是 $3$ 个整数 $op,l,r$，意义见题目描述。\n\n\t* 如果 $op=1$，接下来跟随 $1$ 个该事件的额外参数（整数） $d$，意义见题目描述。\n\t\n\t* 如果 $op=2$，接下来跟随 $1$ 个该事件的额外参数（整数） $b$，意义见题目描述。\n\t\n\t* 如果 $op=3$，接下来无任何额外参数。\n\t\n\t* 保证 $1\\leq l\\leq r\\leq n$。\n\n对于每一行，如果包含多个数，则用单个空格将它们隔开。", "outputFormat": "* 对于每个购买事件，输出一行 $2$ 个用空格隔开的整数，依次表示所有小朋友所能获得的最大愉悦度之和、以及所有小朋友所能获得的最大愉悦度的异或和。", "hint": "### 样例解释\n\n对于第 $1$ 个购买事件，各位小朋友（编号从小到大，即从 $1$ 至 $10$）能够获得的最大愉悦度依次为：$100,300,400,600,700,2333,2433,2633,2733,2933$。\n\n对于第 $2$ 个购买事件，各位小朋友（编号从小到大，即从 $1$ 至 $10$）能够获得的最大愉悦度依次为：$100,200,300,400,500,2333,2433,2533,2633,2733$。\n\n对于第 $3$ 个购买事件，各位小朋友（编号从小到大，即从 $1$ 至 $10$）能够获得的最大愉悦度依次为：$666,1332,1998,2664,3330,3996,4662,5328,5994,6660$。\n\n对于第 $4$ 个购买事件，各位小朋友（编号从小到大，即从 $1$ 至 $10$）能够获得的最大愉悦度依次为：$0,0,300,300,300,600,733,733,900,1033$。\n\n根据这些信息，你将很容易计算出答案。\n\n### 数据范围\n\n保证 $1\\le n\\leq 200,000$，$1\\le m\\leq 60$，$0\\le Q\\leq 30,000$。\n\n保证 $1\\leq c_i,d\\leq m$。\n\n保证 $0\\leq v_i\\leq 10^7$，$\\left| b\\right|\\leq 10^3$。\n\n### 提示\n\n这个提示本不该有，但善良的出题人还是想提醒你：所有小朋友所能获得的最大愉悦度之和有可能超过 $32$ 位有符号整数的范围。\n\n### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN"}}}
{"pid": "P5456", "type": "P", "difficulty": 4, "samples": [["5\n2 2 2 3\n7 7 8 8\n9 9 9 9\n3 3 5 6\n9 7 5 2", "0 0 0 8 16 0 0 0 0\n900 1320 724 176 16 0 0 0 0\n2401 2744 1176 224 16 0 0 0 0\n12 62 108 72 16 0 0 0 0\n0 210 284 120 16 0 0 0 0"]], "limits": {"time": [1000], "memory": [512000]}, "tags": ["2018", "THUPC"], "title": "[THUPC 2018] 蛋糕", "background": "", "description": "最近，菲菲学会了做蛋糕，她做了一个 **4D** 的蛋糕送给牛牛，这个蛋糕的大小是： $a \\times b \\times c \\times d$。\n\n蛋糕所有的表面都抹着奶油，牛牛想把蛋糕沿着与表面平行的超平面，切成 $1 \\times 1 \\times 1 \\times 1$ 的小块。\n\n现在，牛牛想知道，在这些小块蛋糕中，有 $0$ 个、$1$ 个、$2$ 个……$8$ 个表面抹着奶油的有分别有多少块。", "inputFormat": "输入包含多组数据，第一行一个整数 $T$ 表示数据组数。（$T <= 10000$）\n\n接下来依次描述每组数据，对于每组数据：\n\n* 一行 $4$ 个正整数 $a$、$b$、$c$、$d$。（四个正整数都在 $10^6$ 以内）", "outputFormat": "对于每组数据，输出 $1$ 行：\n\n* 一行输出 $9$ 个整数，分别表示有 $0$ 个、$1$ 个、$2$ 个……$8$ 个表面抹着奶油的小块蛋糕数量，所有值之间用单个空格隔开。为了防止答案过大，你只需要输出答案除以 $2148473648$ 的余数。", "hint": "### 样例解释\n\n对于第一组数据，把 $2 \\times 2 \\times 2 \\times 3$ 的蛋糕切成小块后，共形成了 $24$ 个小立方体，其中有 $16$ 个小块分别与其他 $4$ 个小块相邻，因此它们有 $4$ 个面涂有奶油，而另外 $8$ 个小块分别与其他 $5$ 个小块相邻，因此它们有 $3$ 个面涂有奶油。\n\n### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN", "translations": {"en": {"title": "[THUPC 2018] Cake", "background": "", "description": "Recently, Feifei learned how to make cakes. She made a **4D** cake for Niuniu. The size of the cake is: $a \\times b \\times c \\times d$.\n\nAll surfaces of the cake are covered with cream. Niuniu wants to cut the cake into $1 \\times 1 \\times 1 \\times 1$ small pieces along hyperplanes parallel to the surfaces.\n\nNow, Niuniu wants to know, among these small pieces, how many pieces have $0$ surface, $1$ surface, $2$ surfaces, $\\ldots$, $8$ surfaces covered with cream, respectively.", "inputFormat": "The input contains multiple test cases. The first line contains an integer $T$ indicating the number of test cases. ($T \\le 10000$)\n\nEach test case is described as follows:\n\n- One line with $4$ positive integers $a$, $b$, $c$, $d$. (All four positive integers are within $10^6$)", "outputFormat": "For each test case, output one line:\n\n- Output $9$ integers, representing the number of small pieces that have $0$ surface, $1$ surface, $2$ surfaces, $\\ldots$, $8$ surfaces covered with cream, respectively. Separate the values with a single space. To prevent the answer from being too large, you only need to output each value modulo $2148473648$.", "hint": "### Sample Explanation\n\nFor the first test case, after cutting a $2 \\times 2 \\times 2 \\times 3$ cake into small pieces, a total of $24$ small cubes are formed. Among them, $16$ pieces are each adjacent to the other $4$ pieces, so they have $4$ faces covered with cream. The other $8$ pieces are each adjacent to the other $5$ pieces, so they have $3$ faces covered with cream.\n\n### Copyright Information\n\nFrom the 2018 Tsinghua University Programming Contest and Intercollegiate Invitational (THUPC2018). Thanks to [Pony.ai](http://pony.ai) for supporting this contest.\n\nResources such as solutions can be found at <https://github.com/wangyurzee7/THUPC2018>.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[THUPC 2018] 蛋糕", "background": "", "description": "最近，菲菲学会了做蛋糕，她做了一个 **4D** 的蛋糕送给牛牛，这个蛋糕的大小是： $a \\times b \\times c \\times d$。\n\n蛋糕所有的表面都抹着奶油，牛牛想把蛋糕沿着与表面平行的超平面，切成 $1 \\times 1 \\times 1 \\times 1$ 的小块。\n\n现在，牛牛想知道，在这些小块蛋糕中，有 $0$ 个、$1$ 个、$2$ 个……$8$ 个表面抹着奶油的有分别有多少块。", "inputFormat": "输入包含多组数据，第一行一个整数 $T$ 表示数据组数。（$T <= 10000$）\n\n接下来依次描述每组数据，对于每组数据：\n\n* 一行 $4$ 个正整数 $a$、$b$、$c$、$d$。（四个正整数都在 $10^6$ 以内）", "outputFormat": "对于每组数据，输出 $1$ 行：\n\n* 一行输出 $9$ 个整数，分别表示有 $0$ 个、$1$ 个、$2$ 个……$8$ 个表面抹着奶油的小块蛋糕数量，所有值之间用单个空格隔开。为了防止答案过大，你只需要输出答案除以 $2148473648$ 的余数。", "hint": "### 样例解释\n\n对于第一组数据，把 $2 \\times 2 \\times 2 \\times 3$ 的蛋糕切成小块后，共形成了 $24$ 个小立方体，其中有 $16$ 个小块分别与其他 $4$ 个小块相邻，因此它们有 $4$ 个面涂有奶油，而另外 $8$ 个小块分别与其他 $5$ 个小块相邻，因此它们有 $3$ 个面涂有奶油。\n\n### 版权信息\n\n来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN"}}}
{"pid": "P5457", "type": "P", "difficulty": 5, "samples": [["2\n2 2\n3 3", "5\n150"]], "limits": {"time": [1000], "memory": [512000]}, "tags": ["2018", "THUPC"], "title": "[THUPC 2018] 生生不息", "background": "", "description": "生命游戏是一个经典的零玩家游戏。\n\n游戏在一块 $n \\times m$ 的方格棋盘上进行，初始时，棋盘上的一些格子中有生命，另一些格子中没有生命。\n\n在新的一天开始时，如果一个格子周围的 $8$ 个（边界上的格子也许不到 $8$ 个）格子中，在前一天有恰好$2$个或$3$个格子中有生命，则这个格子上的生命可以继续生存，如果周围的格子中恰好有$3$个格子在前一天有生命且这个格子中前一天没有生命，则会在这个格子中诞生新的生命。在其他情况下，该格子中原有的生命则会死去且不会产生新的生命。\n\n如果在某一天，棋盘上所有的格子里都没有生命，显然，在接下来的时间里，所有的格子中再也不会有生命了，我们就说这些生命灭绝了。\n\n现在，牛牛希望让菲菲来决定游戏开始时棋盘上的每个格子中是否有生命。\n\n而他想知道，在游戏开始时，菲菲有多少种不同的方法使得棋盘上的生命永远也不会灭绝。", "inputFormat": "输入包含多组数据，第一行一个整数 $T$ 表示数据组数。（$T <= 30$）\n\n接下来依次描述每组数据，对于每组数据：\n\n* 一行 $2$ 个正整数 $n$、$m$。（$n,m<=5$）", "outputFormat": "对于每组数据，输出 $1$ 行：\n\n* 一行输出 $1$ 个整数，表示问题的答案。", "hint": "来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN", "translations": {"en": {"title": "[THUPC 2018] Endless Life", "background": "", "description": "The Game of Life is a classic zero-player game.\n\nThe game is played on an $n \\times m$ grid board. Initially, some cells contain life, and the others do not.\n\nWhen a new day begins, if among the 8 neighboring cells around a cell (cells on the boundary may have fewer than 8 neighbors), there were exactly $2$ or $3$ living cells on the previous day, then the life in this cell can continue to survive. If among the neighboring cells there were exactly $3$ living cells on the previous day and this cell was not alive on the previous day, then new life is born in this cell. In all other cases, any existing life in this cell dies, and no new life is created.\n\nIf on some day, there is no life in any cell on the board, then obviously in the following days there will never be life in any cell again. We say that life has gone extinct.\n\nNow, Niuniu wants Feifei to decide whether each cell on the board is alive at the start of the game.\n\nHe wants to know how many different initial configurations Feifei can choose so that life on the board will never go extinct.", "inputFormat": "The input contains multiple test cases. The first line contains an integer $T$ indicating the number of test cases. ($T <= 30$)\n\nThen each test case is described as follows:\n\n* One line with $2$ positive integers $n$ and $m$. ($n,m<=5$)", "outputFormat": "For each test case, output $1$ line:\n\n* Output one integer, representing the answer.", "hint": "From the 2018 Tsinghua University Programming Contest and College Invitational Contest (THUPC 2018). Thanks to [Pony.ai](http://pony.ai) for supporting this contest.\n\nResources such as editorials can be found at <https://github.com/wangyurzee7/THUPC2018>.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[THUPC 2018] 生生不息", "background": "", "description": "生命游戏是一个经典的零玩家游戏。\n\n游戏在一块 $n \\times m$ 的方格棋盘上进行，初始时，棋盘上的一些格子中有生命，另一些格子中没有生命。\n\n在新的一天开始时，如果一个格子周围的 $8$ 个（边界上的格子也许不到 $8$ 个）格子中，在前一天有恰好$2$个或$3$个格子中有生命，则这个格子上的生命可以继续生存，如果周围的格子中恰好有$3$个格子在前一天有生命且这个格子中前一天没有生命，则会在这个格子中诞生新的生命。在其他情况下，该格子中原有的生命则会死去且不会产生新的生命。\n\n如果在某一天，棋盘上所有的格子里都没有生命，显然，在接下来的时间里，所有的格子中再也不会有生命了，我们就说这些生命灭绝了。\n\n现在，牛牛希望让菲菲来决定游戏开始时棋盘上的每个格子中是否有生命。\n\n而他想知道，在游戏开始时，菲菲有多少种不同的方法使得棋盘上的生命永远也不会灭绝。", "inputFormat": "输入包含多组数据，第一行一个整数 $T$ 表示数据组数。（$T <= 30$）\n\n接下来依次描述每组数据，对于每组数据：\n\n* 一行 $2$ 个正整数 $n$、$m$。（$n,m<=5$）", "outputFormat": "对于每组数据，输出 $1$ 行：\n\n* 一行输出 $1$ 个整数，表示问题的答案。", "hint": "来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai) 对此次比赛的支持。\n\n题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。", "locale": "zh-CN"}}}
{"pid": "P5458", "type": "P", "difficulty": 6, "samples": [["4\n0 0 0 11\n1 0 0 5\n0 1 0 7\n0 0 -1 13", "25.1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["图论", "2016", "各省省选", "网络流", "北京", "O2优化"], "title": "[BJOI2016] 水晶", "background": "不用惊慌，今天的题都不是小强出的。  \n\n——融入了无数心血的作品，现在却不得不亲手毁掉，难以体会他的心情啊。\n\n——那也是没有办法的事情，能量共振不消除的话…… \n\n望着已经被装上炸药的水晶，02放下了望远镜，看向了手中的共振分析报告。  \n\n还是会有一些水晶，幸存下来的…… 也许吧。", "description": "地图由密铺的六边形单元组成，每个单元与其他六个单元相邻。  \n\n为了方便起见，我们用坐标 $(x,y,z)$ 描述一个单元的位置，表示从原点开始按如图所示的 $x,y,z$ 方向各走若干步之后到达的地方。  \n\n有可能有两个坐标描述同一个单元，比如 $(1,1,1)$ 和 $(0,0,0)$ 描述的都是原点。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/dd1hb5vv.png)\n\n显然 $(x,y,z)$ 单元和 $(x+1,y,z)$，$(x-1,y,z)$ ，$(x,y+1,z)$，$(x,y-1,z)$，$(x,y,z+1)$，$(x,y,z-1)$ 相邻。  \n\n有 $N$ 块水晶位于地图的单元内，第 $i$ 块水晶位于坐标 $(x_i, y_i, z_i)$ 所表示的单元中，并拥有 $c_i$ 的价值，每个单元内部可能会有多块水晶。  \n\n地图中，有一些单元安装有能量源。如下图，任何满足 $x+y+z$ 是 $3$ 的整数倍的坐标所描述的单元内都安装有能量源。  \n\n![](https://cdn.luogu.com.cn/upload/image_hosting/9x4o6dhs.png)\n\n有能量源的单元中的水晶价值将会额外增加 $10\\%$。如果三块水晶所在的单元满足特定排列，那么它们将会引发共振。 \n\n共振分两种，$a$ 共振和 $b$ 共振。  \n\n$a$ 共振：如果三块水晶所在的单元两两相邻地排成一个三角形，那么会引起 $a$ 共振。   \n\n![](https://cdn.luogu.com.cn/upload/image_hosting/48uc3ey4.png)\n\n图中每一个三角形表示这三个单元各有一块水晶将会发生一个 $a$ 共振。  \n\n$b$ 共振：如果三块水晶所在的单元依次相邻地排成一条长度为 $2$ 的直线段，且正中间的单元恰好有能量源，那么会引起b共振。  \n\n![](https://cdn.luogu.com.cn/upload/image_hosting/2b47zl09.png)\n\n图中粉红色线段表示这三个单元各有一块水晶将会发生一个 $b$ 共振，黑色线段表示即使这三个单元有水晶也不会发生 $b$ 共振。  \n\n现在你要炸掉一部分水晶，使得任何共振都不会发生的前提下，剩余水晶的价值总和最大。", "inputFormat": "第一行一个正整数 $N$，表示水晶数量。  \n接下来 $N$ 行，每行四个整数用空格分开的整数 $x_i,y_i,z_i,c_i$，表示一个水晶的位置和价值。  \n有可能有水晶的位置重合。  ", "outputFormat": "一行一个实数，表示剩余水晶的价值总和，四舍五入保留 $1$ 位小数。", "hint": "【样例 $1$ 说明】   \n\n四块水晶排成一个菱形，没有 $b$ 共振，有 $2$ 处 $a$ 共振，分别是 $1,2,4$ 号水晶和 $1,3,4$ 号水晶形成的三角形。 \n因此，为了消除两处 $a$ 共振，有如下 $3$ 种方案：\n\n1. 炸掉 $1$ 号水晶，留下 $2,3,4$ 号水晶，总剩余价值 $5+7+13=25$\n2. 炸掉 $4$ 号水晶，留下 $1,2,3$ 号水晶，总剩余价值 $11 \\times(1+10\\%)+5+7=24.1$   \n3. 炸掉 $2,3$ 号水晶，留下$1,4$ 号水晶，总剩余价值 $11 \\times (1+10\\%)+13=25.1$  \n\n因此我们采用第三种方案，最大总剩余价值为$25.1$。    \n\n【数据范围】  \n\n$1\\le N \\le 50000$    \n$1\\le c_i \\le 1000$   \n$-1000 \\le x_i,y_i,z_i \\le 1000$   ", "locale": "zh-CN", "translations": {"en": {"title": "[BJOI2016] Crystal", "background": "Do not panic, none of today’s problems were made by Xiaoqiang.\n\n—A work poured with countless efforts, yet now he has to destroy it with his own hands. It is hard to understand how he feels.\n\n—There is no other choice. If the energy resonance is not removed...\n\nLooking at the crystals already planted with explosives, 02 put down the telescope and looked at the resonance analysis report in his hand.\n\nSome crystals will still survive... maybe.", "description": "The map consists of densely tiled hexagonal cells, and each cell is adjacent to six other cells.\n\nFor convenience, we use coordinates $(x,y,z)$ to describe the position of a cell: starting from the origin, walk several steps along the $x$, $y$, and $z$ directions as shown in the figure to reach that cell.\n\nIt is possible that two coordinates describe the same cell. For example, $(1,1,1)$ and $(0,0,0)$ both describe the origin.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/dd1hb5vv.png)\n\nClearly, cell $(x,y,z)$ is adjacent to $(x+1,y,z)$, $(x-1,y,z)$, $(x,y+1,z)$, $(x,y-1,z)$, $(x,y,z+1)$, and $(x,y,z-1)$.\n\nThere are $N$ crystals located in the cells of the map. The $i$-th crystal is in the cell described by coordinates $(x_i, y_i, z_i)$ and has value $c_i$. A single cell may contain multiple crystals.\n\nOn the map, some cells have energy sources installed. As shown below, any cell described by coordinates whose $x+y+z$ is a multiple of $3$ has an energy source installed.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/9x4o6dhs.png)\n\nThe value of crystals in a cell with an energy source increases by an additional $10\\%$. If the cells containing three crystals satisfy certain patterns, they will trigger resonance.\n\nThere are two types of resonance: $a$ resonance and $b$ resonance.\n\n$a$ resonance: If the cells containing three crystals form a triangle such that every pair of cells is adjacent, then an $a$ resonance is triggered.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/48uc3ey4.png)\n\nIn the figure, each triangle means that if each of the three cells contains one crystal, they will trigger one $a$ resonance.\n\n$b$ resonance: If the cells containing three crystals are arranged in a straight line segment of length $2$ such that consecutive cells are adjacent, and the middle cell has an energy source, then a $b$ resonance is triggered.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/2b47zl09.png)\n\nIn the figure, the pink segments indicate that if each of the three cells contains one crystal, they will trigger a $b$ resonance. The black segments indicate that even if these three cells contain crystals, they will not trigger a $b$ resonance.\n\nNow you need to blow up some crystals so that no resonance occurs, and under this condition, maximize the total value of the remaining crystals.", "inputFormat": "The first line contains a positive integer $N$, the number of crystals.  \nThe next $N$ lines each contain four integers separated by spaces: $x_i,y_i,z_i,c_i$, describing the position and value of a crystal.  \nDifferent crystals may share the same position.", "outputFormat": "Output one real number in a single line: the total value of the remaining crystals, rounded to $1$ decimal place.", "hint": "[Sample $1$ Explanation]\n\nFour crystals form a diamond shape. There is no $b$ resonance, and there are $2$ occurrences of $a$ resonance: the triangles formed by crystals $1,2,4$ and by crystals $1,3,4$.\n\nTherefore, to eliminate the two $a$ resonances, there are $3$ possible plans:\n\n1. Blow up crystal $1$, keep crystals $2,3,4$, total remaining value $5+7+13=25$.\n2. Blow up crystal $4$, keep crystals $1,2,3$, total remaining value $11 \\times(1+10\\%)+5+7=24.1$.\n3. Blow up crystals $2,3$, keep crystals $1,4$, total remaining value $11 \\times (1+10\\%)+13=25.1$.\n\nSo we choose the third plan, and the maximum total remaining value is $25.1$.\n\n[Constraints]\n\n$1\\le N \\le 50000$  \n$1\\le c_i \\le 1000$  \n$-1000 \\le x_i,y_i,z_i \\le 1000$\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[BJOI2016] 水晶", "background": "不用惊慌，今天的题都不是小强出的。  \n\n——融入了无数心血的作品，现在却不得不亲手毁掉，难以体会他的心情啊。\n\n——那也是没有办法的事情，能量共振不消除的话…… \n\n望着已经被装上炸药的水晶，02放下了望远镜，看向了手中的共振分析报告。  \n\n还是会有一些水晶，幸存下来的…… 也许吧。", "description": "地图由密铺的六边形单元组成，每个单元与其他六个单元相邻。  \n\n为了方便起见，我们用坐标 $(x,y,z)$ 描述一个单元的位置，表示从原点开始按如图所示的 $x,y,z$ 方向各走若干步之后到达的地方。  \n\n有可能有两个坐标描述同一个单元，比如 $(1,1,1)$ 和 $(0,0,0)$ 描述的都是原点。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/dd1hb5vv.png)\n\n显然 $(x,y,z)$ 单元和 $(x+1,y,z)$，$(x-1,y,z)$ ，$(x,y+1,z)$，$(x,y-1,z)$，$(x,y,z+1)$，$(x,y,z-1)$ 相邻。  \n\n有 $N$ 块水晶位于地图的单元内，第 $i$ 块水晶位于坐标 $(x_i, y_i, z_i)$ 所表示的单元中，并拥有 $c_i$ 的价值，每个单元内部可能会有多块水晶。  \n\n地图中，有一些单元安装有能量源。如下图，任何满足 $x+y+z$ 是 $3$ 的整数倍的坐标所描述的单元内都安装有能量源。  \n\n![](https://cdn.luogu.com.cn/upload/image_hosting/9x4o6dhs.png)\n\n有能量源的单元中的水晶价值将会额外增加 $10\\%$。如果三块水晶所在的单元满足特定排列，那么它们将会引发共振。 \n\n共振分两种，$a$ 共振和 $b$ 共振。  \n\n$a$ 共振：如果三块水晶所在的单元两两相邻地排成一个三角形，那么会引起 $a$ 共振。   \n\n![](https://cdn.luogu.com.cn/upload/image_hosting/48uc3ey4.png)\n\n图中每一个三角形表示这三个单元各有一块水晶将会发生一个 $a$ 共振。  \n\n$b$ 共振：如果三块水晶所在的单元依次相邻地排成一条长度为 $2$ 的直线段，且正中间的单元恰好有能量源，那么会引起b共振。  \n\n![](https://cdn.luogu.com.cn/upload/image_hosting/2b47zl09.png)\n\n图中粉红色线段表示这三个单元各有一块水晶将会发生一个 $b$ 共振，黑色线段表示即使这三个单元有水晶也不会发生 $b$ 共振。  \n\n现在你要炸掉一部分水晶，使得任何共振都不会发生的前提下，剩余水晶的价值总和最大。", "inputFormat": "第一行一个正整数 $N$，表示水晶数量。  \n接下来 $N$ 行，每行四个整数用空格分开的整数 $x_i,y_i,z_i,c_i$，表示一个水晶的位置和价值。  \n有可能有水晶的位置重合。  ", "outputFormat": "一行一个实数，表示剩余水晶的价值总和，四舍五入保留 $1$ 位小数。", "hint": "【样例 $1$ 说明】   \n\n四块水晶排成一个菱形，没有 $b$ 共振，有 $2$ 处 $a$ 共振，分别是 $1,2,4$ 号水晶和 $1,3,4$ 号水晶形成的三角形。 \n因此，为了消除两处 $a$ 共振，有如下 $3$ 种方案：\n\n1. 炸掉 $1$ 号水晶，留下 $2,3,4$ 号水晶，总剩余价值 $5+7+13=25$\n2. 炸掉 $4$ 号水晶，留下 $1,2,3$ 号水晶，总剩余价值 $11 \\times(1+10\\%)+5+7=24.1$   \n3. 炸掉 $2,3$ 号水晶，留下$1,4$ 号水晶，总剩余价值 $11 \\times (1+10\\%)+13=25.1$  \n\n因此我们采用第三种方案，最大总剩余价值为$25.1$。    \n\n【数据范围】  \n\n$1\\le N \\le 50000$    \n$1\\le c_i \\le 1000$   \n$-1000 \\le x_i,y_i,z_i \\le 1000$   ", "locale": "zh-CN"}}}
{"pid": "P5459", "type": "P", "difficulty": 4, "samples": [["5 5 9\n1 2 3 4 5", "6"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["2016", "线段树", "各省省选", "树状数组", "离散化", "北京", "cdq 分治", "O2优化"], "title": "[BJOI2016] 回转寿司", "background": null, "description": "酷爱日料的小 Z 经常光顾学校东门外的回转寿司店。在这里，一盘盘寿司通过传送带依次呈现在小 Z 眼前。  \n\n不同的寿司带给小 Z 的味觉感受是不一样的，我们定义小 Z 对每盘寿司都有一个满意度。  \n\n例如小 Z 酷爱三文鱼，他对一盘三文鱼寿司的满意度为 $10$；小 Z 觉得金枪鱼没有什么味道，他对一盘金枪鱼寿司的满意度只有 $5$；小 Z 最近看了电影《美人鱼》，被里面的八爪鱼恶心到了，所以他对一盘八爪鱼刺身的满意度是 $-100$。\n\n特别地，小 Z 是个著名的吃货，他吃回转寿司有一个习惯，我们称之为“狂吃不止”。具体地讲，当他吃掉传送带上的一盘寿司后，他会毫不犹豫地吃掉它后面的寿司，直到他不想再吃寿司了为止。  \n\n今天，小 Z 再次来到了这家回转寿司店，$N$ 盘寿司将依次经过他的面前。其中，小 Z 对第 $i$ 盘寿司的满意度为 $a_i$。  \n\n小 Z 可以选择从哪盘寿司开始吃，也可以选择吃到哪盘寿司为止。他想知道共有多少种不同的选择，使得他的满意度之和不低于 $L$，且不高于 $R$。\n\n注意，虽然这是回转寿司，但是我们不认为这是一个环上的问题，而是一条线上的问题。即，小 Z 能吃到的是输入序列的一个连续子序列；最后一盘转走之后，第一盘并不会再出现一次。", "inputFormat": "第一行三个正整数 $N,L,R$，表示寿司盘数，满意度的下限和上限。\n\n第二行包含 $N$ 个整数 $a_i$，表示小 Z 对寿司的满意度。", "outputFormat": "一行一个整数，表示有多少种方案可以使得小 Z 的满意度之和不低于 $L$ 且不高于 $R$。", "hint": "### 【数据范围】\n\n$1\\le N \\le 10^5$；  \n$|a_i| \\le 10^5$；   \n$0\\le L,R \\le 10^9$。", "locale": "zh-CN", "translations": {"en": {"title": "[BJOI2016] Conveyor Belt Sushi.", "background": "", "description": "Xiao Z, who loves Japanese food, often visits the conveyor belt sushi restaurant outside the east gate of his school. There, plates of sushi appear in front of him one by one on a conveyor belt.\n\nDifferent sushi gives Xiao Z different tastes, so we define that Xiao Z has a satisfaction value for each plate of sushi.\n\nFor example, Xiao Z loves salmon, so his satisfaction for a plate of salmon sushi is $10$; Xiao Z thinks tuna has little taste, so his satisfaction for a plate of tuna sushi is only $5$; Xiao Z recently watched the movie *Mermaid* and felt disgusted by the octopus in it, so his satisfaction for a plate of octopus sashimi is $-100$.\n\nIn particular, Xiao Z is a famous foodie and has a habit when eating conveyor belt sushi, which we call “eating nonstop”. Specifically, once he eats a plate of sushi on the conveyor belt, he will immediately eat the sushi after it, until he does not want to eat anymore.\n\nToday, Xiao Z comes to this restaurant again. There will be $N$ plates of sushi passing in front of him in order. Xiao Z’s satisfaction for the $i$-th plate is $a_i$.\n\nXiao Z can choose which plate to start eating from, and he can also choose which plate to stop at. He wants to know how many different choices there are such that the total satisfaction is not less than $L$ and not greater than $R$.\n\nNote that although this is conveyor belt sushi, we do not treat it as a circular problem, but as a linear one. That is, what Xiao Z can eat is a contiguous subsequence of the input sequence; after the last plate passes by, the first plate will not appear again.", "inputFormat": "The first line contains three positive integers $N, L, R$, representing the number of sushi plates, the lower bound and the upper bound of satisfaction.  \nThe second line contains $N$ integers $a_i$, representing Xiao Z’s satisfaction for each plate of sushi.", "outputFormat": "Output one integer in a single line, representing how many choices make the total satisfaction not less than $L$ and not greater than $R$.", "hint": "Constraints.\n\n$1 \\le N \\le 10^5$  \n$|a_i| \\le 10^5$  \n$0 \\le L, R \\le 10^9$\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[BJOI2016] 回转寿司", "background": null, "description": "酷爱日料的小 Z 经常光顾学校东门外的回转寿司店。在这里，一盘盘寿司通过传送带依次呈现在小 Z 眼前。  \n\n不同的寿司带给小 Z 的味觉感受是不一样的，我们定义小 Z 对每盘寿司都有一个满意度。  \n\n例如小 Z 酷爱三文鱼，他对一盘三文鱼寿司的满意度为 $10$；小 Z 觉得金枪鱼没有什么味道，他对一盘金枪鱼寿司的满意度只有 $5$；小 Z 最近看了电影《美人鱼》，被里面的八爪鱼恶心到了，所以他对一盘八爪鱼刺身的满意度是 $-100$。\n\n特别地，小 Z 是个著名的吃货，他吃回转寿司有一个习惯，我们称之为“狂吃不止”。具体地讲，当他吃掉传送带上的一盘寿司后，他会毫不犹豫地吃掉它后面的寿司，直到他不想再吃寿司了为止。  \n\n今天，小 Z 再次来到了这家回转寿司店，$N$ 盘寿司将依次经过他的面前。其中，小 Z 对第 $i$ 盘寿司的满意度为 $a_i$。  \n\n小 Z 可以选择从哪盘寿司开始吃，也可以选择吃到哪盘寿司为止。他想知道共有多少种不同的选择，使得他的满意度之和不低于 $L$，且不高于 $R$。\n\n注意，虽然这是回转寿司，但是我们不认为这是一个环上的问题，而是一条线上的问题。即，小 Z 能吃到的是输入序列的一个连续子序列；最后一盘转走之后，第一盘并不会再出现一次。", "inputFormat": "第一行三个正整数 $N,L,R$，表示寿司盘数，满意度的下限和上限。\n\n第二行包含 $N$ 个整数 $a_i$，表示小 Z 对寿司的满意度。", "outputFormat": "一行一个整数，表示有多少种方案可以使得小 Z 的满意度之和不低于 $L$ 且不高于 $R$。", "hint": "### 【数据范围】\n\n$1\\le N \\le 10^5$；  \n$|a_i| \\le 10^5$；   \n$0\\le L,R \\le 10^9$。", "locale": "zh-CN"}}}
{"pid": "P5460", "type": "P", "difficulty": 6, "samples": [["5 1\nAdd 110\nAdd 11\nDel 110\nDel 11\nAdd 110\n11011101001001010101011101000010 2 5", "3"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["字符串", "2016", "各省省选", "北京", "O2优化", "字典树 Trie"], "title": "[BJOI2016] IP地址", "background": null, "description": "路由表中每一项对应了一个形如 1011101????????????????????????? 的规则，会匹配指定的前缀为给定形式的 $\\texttt{ip}$。  \n\n当有多个规则匹配时，前缀最长的生效。同一时刻不会有多个匹配的规则的前缀一样长。每一个时刻，会有一条规则被加入，或者之前被加入的某条规则会过期。   \n\n给一系列 $\\texttt{ip}$，问每一个 $\\texttt{ip}$ 在一个给定的时间区间内匹配到的生效规则变了几次？  \n   \n例如，有一系列事件：    \n \n$\\texttt{Add}$ $110$   \n$\\texttt{Add}$ $11$   \n$\\texttt{Del}$ $110$   \n$\\texttt{Del}$ $11$   \n$\\texttt{Add}$ $110$     \n\n那么，$\\texttt{ip}$ 地址 11011101001001010101011101000010 在这五个时刻之后匹配到的生效规则分别是：  \n\n$110$ (第一条)，   \n$110$ (第一条)，   \n$11$ (第二条)，   \n空，   \n$110$ (第三条)。     \n\n其中，在第二个事件后到第五个事件后的这段过程中，一共变了 $3$ 次。", "inputFormat": "第一行两个正整数 $n,q$，表示事件数有询问数。  \n接下来 $n$ 行，每行描述一个事件，格式为：  \n\n$\\texttt{Add}$ $s$ 表示新建一个规则，匹配前缀为 $s$ 的所有 $\\texttt{ip}$。  \n$\\texttt{Del}$ $s$ 表示把当前前缀 $s$ 对应的规则删掉(过期)。保证之前有这样的一条规则还没被删。     \n\n接下来 $q$ 行，每行一个 $\\texttt{ip}$ 与两个正整数 $a,b$，表示查询在第 $a$ 个事件后到第 $b$ 个事件的这段时间里，这个 $\\texttt{ip}$ 匹配到的生效规则变化的次数。 $\\texttt{ip}$ 用01字符串来表示。", "outputFormat": "对于每次查询，输出一行一个整数表示答案。", "hint": "【数据范围】  \n\n- $1\\le n,q \\le 10^5$\n\n- $|s|\\le32$\n\n- 每个 $\\texttt{ip}$ 长度均为 $32$。", "locale": "zh-CN", "translations": {"en": {"title": "[BJOI2016] IP Address", "background": "", "description": "Each entry in the routing table corresponds to a rule of the form 1011101?????????????????????????, which matches an $\\texttt{ip}$ whose prefix fits the given pattern.\n\nWhen multiple rules match, the one with the longest prefix takes effect. At any time, there will not be multiple matching rules with the same prefix length. At each moment, either a rule is added, or some previously added rule expires.\n\nGiven a list of $\\texttt{ip}$ addresses, for each $\\texttt{ip}$, ask how many times the effective matched rule changes within a given time interval.\n\nFor example, suppose there is a sequence of events:\n\n$\\texttt{Add}$ $110$  \n$\\texttt{Add}$ $11$  \n$\\texttt{Del}$ $110$  \n$\\texttt{Del}$ $11$  \n$\\texttt{Add}$ $110$\n\nThen, for the $\\texttt{ip}$ address 11011101001001010101011101000010, the effective matched rules after these five moments are:\n\n$110$ (the first one),  \n$110$ (the first one),  \n$11$ (the second one),  \nempty,  \n$110$ (the third one).\n\nDuring the period from after the second event to after the fifth event, it changes a total of $3$ times.", "inputFormat": "The first line contains two positive integers $n,q$, representing the number of events and the number of queries.\n\nThe next $n$ lines each describe an event in the following format:\n\n$\\texttt{Add}$ $s$ means creating a new rule that matches all $\\texttt{ip}$ addresses with prefix $s$.  \n$\\texttt{Del}$ $s$ means deleting (expiring) the current rule corresponding to prefix $s$. It is guaranteed that such a rule exists and has not been deleted before.\n\nThe next $q$ lines each contain an $\\texttt{ip}$ and two positive integers $a,b$, meaning: during the time period from after the $a$-th event to the $b$-th event, how many times does the effective rule matched by this $\\texttt{ip}$ change? The $\\texttt{ip}$ is given as a binary string of 0 and 1.", "outputFormat": "For each query, output one line with an integer representing the answer.", "hint": "Constraints\n\n- $1\\le n,q \\le 10^5$.\n- $|s|\\le32$.\n- Each $\\texttt{ip}$ has length $32$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[BJOI2016] IP地址", "background": null, "description": "路由表中每一项对应了一个形如 1011101????????????????????????? 的规则，会匹配指定的前缀为给定形式的 $\\texttt{ip}$。  \n\n当有多个规则匹配时，前缀最长的生效。同一时刻不会有多个匹配的规则的前缀一样长。每一个时刻，会有一条规则被加入，或者之前被加入的某条规则会过期。   \n\n给一系列 $\\texttt{ip}$，问每一个 $\\texttt{ip}$ 在一个给定的时间区间内匹配到的生效规则变了几次？  \n   \n例如，有一系列事件：    \n \n$\\texttt{Add}$ $110$   \n$\\texttt{Add}$ $11$   \n$\\texttt{Del}$ $110$   \n$\\texttt{Del}$ $11$   \n$\\texttt{Add}$ $110$     \n\n那么，$\\texttt{ip}$ 地址 11011101001001010101011101000010 在这五个时刻之后匹配到的生效规则分别是：  \n\n$110$ (第一条)，   \n$110$ (第一条)，   \n$11$ (第二条)，   \n空，   \n$110$ (第三条)。     \n\n其中，在第二个事件后到第五个事件后的这段过程中，一共变了 $3$ 次。", "inputFormat": "第一行两个正整数 $n,q$，表示事件数有询问数。  \n接下来 $n$ 行，每行描述一个事件，格式为：  \n\n$\\texttt{Add}$ $s$ 表示新建一个规则，匹配前缀为 $s$ 的所有 $\\texttt{ip}$。  \n$\\texttt{Del}$ $s$ 表示把当前前缀 $s$ 对应的规则删掉(过期)。保证之前有这样的一条规则还没被删。     \n\n接下来 $q$ 行，每行一个 $\\texttt{ip}$ 与两个正整数 $a,b$，表示查询在第 $a$ 个事件后到第 $b$ 个事件的这段时间里，这个 $\\texttt{ip}$ 匹配到的生效规则变化的次数。 $\\texttt{ip}$ 用01字符串来表示。", "outputFormat": "对于每次查询，输出一行一个整数表示答案。", "hint": "【数据范围】  \n\n- $1\\le n,q \\le 10^5$\n\n- $|s|\\le32$\n\n- 每个 $\\texttt{ip}$ 长度均为 $32$。", "locale": "zh-CN"}}}
{"pid": "P5461", "type": "P", "difficulty": 3, "samples": [["3", "0 0 0 0 0 0 0 1\n0 0 0 0 0 0 1 1\n0 0 0 0 0 1 0 1\n0 0 0 0 1 1 1 1\n0 0 0 1 0 0 0 1\n0 0 1 1 0 0 1 1\n0 1 0 1 0 1 0 1\n1 1 1 1 1 1 1 1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["递归", "分治", "洛谷月赛"], "title": "赦免战俘", "background": "借助反作弊系统，一些在月赛有抄袭作弊行为的选手被抓出来了！", "description": "现有 $2^n\\times 2^n (n\\le10)$ 名作弊者站成一个正方形方阵等候 kkksc03 的发落。kkksc03 决定赦免一些作弊者。他将正方形矩阵均分为 $4$ 个更小的正方形矩阵，每个更小的矩阵的边长是原矩阵的一半。其中左上角那一个矩阵的所有作弊者都将得到赦免，剩下 $3$ 个小矩阵中，每一个矩阵继续分为 $4$ 个更小的矩阵，然后通过同样的方式赦免作弊者……直到矩阵无法再分下去为止。所有没有被赦免的作弊者都将被处以棕名处罚。\n\n给出 $n$，请输出每名作弊者的命运，其中 $0$ 代表被赦免，$1$ 代表不被赦免。", "inputFormat": "一个整数 $n$。", "outputFormat": "$2^n \\times 2^n$ 的 01 矩阵，代表每个人是否被赦免。数字之间有一个空格。", "hint": null, "locale": "zh-CN", "translations": {"en": {"title": "Pardoning Prisoners of War", "background": "With the help of the anti-cheating system, some contestants who copied or cheated in the monthly contest have been caught.", "description": "There are $2^n \\times 2^n$ cheaters $(n \\le 10)$ standing in a square matrix, waiting for kkksc03's decision. kkksc03 decides to pardon some of them. He splits the square matrix evenly into $4$ smaller square matrices, and each smaller matrix has side length half of the original matrix. All cheaters in the upper-left matrix will be pardoned. In the remaining $3$ smaller matrices, each matrix is split into $4$ even smaller matrices, and cheaters are pardoned in the same way... until the matrix can no longer be split.\n\nAll cheaters who are not pardoned will receive the brown-name penalty.\n\nGiven $n$, output the fate of each cheater, where $0$ means pardoned and $1$ means not pardoned.", "inputFormat": "An integer $n$.", "outputFormat": "A $2^n \\times 2^n$ 01 matrix representing whether each person is pardoned. There is one space between numbers.", "hint": "\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "赦免战俘", "background": "借助反作弊系统，一些在月赛有抄袭作弊行为的选手被抓出来了！", "description": "现有 $2^n\\times 2^n (n\\le10)$ 名作弊者站成一个正方形方阵等候 kkksc03 的发落。kkksc03 决定赦免一些作弊者。他将正方形矩阵均分为 $4$ 个更小的正方形矩阵，每个更小的矩阵的边长是原矩阵的一半。其中左上角那一个矩阵的所有作弊者都将得到赦免，剩下 $3$ 个小矩阵中，每一个矩阵继续分为 $4$ 个更小的矩阵，然后通过同样的方式赦免作弊者……直到矩阵无法再分下去为止。所有没有被赦免的作弊者都将被处以棕名处罚。\n\n给出 $n$，请输出每名作弊者的命运，其中 $0$ 代表被赦免，$1$ 代表不被赦免。", "inputFormat": "一个整数 $n$。", "outputFormat": "$2^n \\times 2^n$ 的 01 矩阵，代表每个人是否被赦免。数字之间有一个空格。", "hint": null, "locale": "zh-CN"}}}
{"pid": "P5462", "type": "P", "difficulty": 4, "samples": [["4 \n3 1 4 2", "4 2 3 1"], ["6 \n6 5 4 1 3 2", "6 5 4 1 3 2"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["堆", "洛谷月赛", "链表"], "title": "X龙珠", "background": null, "description": "“X 龙珠”是一款益智小游戏。游戏中有 $n(2|n)$ 个编号互不相同龙珠按照给定的顺序排成一个队列，每个龙珠上面都有一个编号。每次操作时，选择并取出龙珠队列中**相邻**的两个龙珠，放到目标队列的末尾（目标队列最开始是空的，且这两个龙珠的前后顺序不变），然后去除原龙珠队列的空隙。反复多次，直到原龙珠队列为空。可见，因为决策不一样导致目标队列顺序不一样。现在请求出所有方案中、目标队列字典序最大的方案。只需要给出目标队列即可。\n\n例如，当原龙珠队列是 $[1,3,2,4]$ 时，可以先取出 $3$ 和 $2$，此时目标队列是 $[3,2]$，原龙珠队列是 $[1,4]$；再将剩下两个龙珠放入目标队列，得到目标队列是 $[3,2,1,4]$。", "inputFormat": "第一行，一个整数 $n$。\n\n接下来一行，每行 $n$ 个整数，表示原龙珠队列的编号。", "outputFormat": "一行，$n$ 个整数。", "hint": "对于 $20\\%$ 的数据，$n\\le10$。  \n对于 $60\\%$ 的数据，$n\\le10^3$。  \n对于 $100\\%$ 的数据，$n\\le10^5$，龙珠编号不超过 $n$。", "locale": "zh-CN", "translations": {"en": {"title": "X Dragon Balls", "background": "", "description": "\"X Dragon Balls\" is a puzzle mini-game. In the game, there are $n(2|n)$ dragon balls with distinct numbers, arranged in a queue in the given order, and each dragon ball has a number on it.\n\nIn each operation, choose and take out two **adjacent** dragon balls from the original queue, and put them at the end of the target queue (the target queue is initially empty, and the relative order of these two dragon balls does not change). Then remove the gap in the original queue. Repeat this process until the original queue becomes empty. It is clear that different choices lead to different orders of the target queue. Now you need to find, among all possible operations, the one that makes the target queue lexicographically largest. You only need to output the target queue.\n\nFor example, when the original queue is [1,3,2,4], you can first take out 3 and 2. Then the target queue becomes [3,2], and the original queue becomes [1,4]. Next, put the remaining two dragon balls into the target queue, and the final target queue is [3,2,1,4].", "inputFormat": "The first line contains an integer $n$.\n\nThe next line contains $n$ integers, representing the numbers of the dragon balls in the original queue.", "outputFormat": "One line with $n$ integers.", "hint": "For 20% of the testdata, $n \\le 10$。  \nFor 60% of the testdata, $n \\le 10^3$。  \nFor 100% of the testdata, $n \\le 10^5$, and the dragon ball numbers do not exceed $n$。\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "X龙珠", "background": null, "description": "“X 龙珠”是一款益智小游戏。游戏中有 $n(2|n)$ 个编号互不相同龙珠按照给定的顺序排成一个队列，每个龙珠上面都有一个编号。每次操作时，选择并取出龙珠队列中**相邻**的两个龙珠，放到目标队列的末尾（目标队列最开始是空的，且这两个龙珠的前后顺序不变），然后去除原龙珠队列的空隙。反复多次，直到原龙珠队列为空。可见，因为决策不一样导致目标队列顺序不一样。现在请求出所有方案中、目标队列字典序最大的方案。只需要给出目标队列即可。\n\n例如，当原龙珠队列是 $[1,3,2,4]$ 时，可以先取出 $3$ 和 $2$，此时目标队列是 $[3,2]$，原龙珠队列是 $[1,4]$；再将剩下两个龙珠放入目标队列，得到目标队列是 $[3,2,1,4]$。", "inputFormat": "第一行，一个整数 $n$。\n\n接下来一行，每行 $n$ 个整数，表示原龙珠队列的编号。", "outputFormat": "一行，$n$ 个整数。", "hint": "对于 $20\\%$ 的数据，$n\\le10$。  \n对于 $60\\%$ 的数据，$n\\le10^3$。  \n对于 $100\\%$ 的数据，$n\\le10^5$，龙珠编号不超过 $n$。", "locale": "zh-CN"}}}
{"pid": "P5463", "type": "P", "difficulty": 4, "samples": [["8\n1 9 2 6 0 8 1 7", "106"], ["10\n1 10 8 5 6 2 3 9 4 7", "270"], ["20\n6 0 4 5 8 8 0 6 6 1 0 4 6 6 0 0 7 2 0 5", "3481"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["树状数组", "前缀和", "洛谷月赛"], "title": "小鱼比可爱（加强版）", "background": "", "description": "人比人，气死人；鱼比鱼，难死鱼。小鱼最近参加了一个“比可爱”比赛，比的是每只鱼的可爱程度。参赛的鱼被从左到右排成一排，头都朝向左边，然后每只鱼会得到一个整数数值，表示这只鱼的可爱程度，很显然整数越大，表示这只鱼越可爱，而且任意两只鱼的可爱程度可能一样。由于所有的鱼头都朝向左边，所以每只鱼只能看见在它左边的鱼的可爱程度，它们心里都在计算，在自己的眼力范围内有多少只鱼不如自己可爱呢。请你帮这些可爱但是鱼脑不够用的小鱼们计算一下。\n\n和之前的要求不一样，比赛组委会关心的是这个排列的“总得意值”。一共有 $n$ 只小鱼，总共有 $\\frac{n(n+1)}2$ 个不同的区间。每个区间的得意值等于这个区间中符合“左边的一只鱼的可爱值比右边的一只鱼可爱值更大”的对数（其实就是区间逆序对数啦）。总得意值就是所有区间的“得意值”的和。现在要求输出“总得意值”是多少。", "inputFormat": "第一行输入一个整数 $n$，表示鱼的数目。\n\n第二行内输入 $n$ 个整数 $a_1,a_2,\\cdots,a_n$，用空格间隔，依次表示从左到右每只小鱼的可爱程度。", "outputFormat": "输出一个整数表示答案。", "hint": "测试点　　　|$n$　　　　|$a_i$　　　　|是否有重复数字 　\n:-:|:-:|:-:|:-:\n$1$|$1$|无特殊限制|否\n$2$|$10$|无特殊限制|否\n$3$|$10$|无特殊限制|是\n$4$|$1000$|$\\le10$|是\n$5$|$1000$|无特殊限制|否\n$6$|$1000$|无特殊限制|是\n$7$|$10^5$|$\\le100$|是\n$8$|$3\\times 10^5$|无特殊限制|否\n$9$|$5\\times 10^5$|无特殊限制|是\n$10$|$10^6$|无特殊限制|是\n\n对于 $100\\%$ 的数据，$n \\le 10^6$，$a_i\\le 10^9$，所有数字均为非负整数。", "locale": "zh-CN", "translations": {"en": {"title": "Little Fish Compare Cuteness (Enhanced Version).", "background": "", "description": "When people compare with each other, it is annoying; when fish compare with each other, it is even worse. Little Fish recently joined a “cuteness comparison” contest, where the cuteness of each fish is compared. The fish are lined up from left to right, all facing to the left. Then each fish is given an integer value representing its cuteness. Obviously, the larger the integer is, the cuter the fish is, and any two fish may have the same cuteness value. Since all fish face left, each fish can only see the cuteness values of the fish to its left. They are all calculating in their minds: within their view, how many fish are less cute than themselves? Please help these cute little fish, whose brains are not good enough, compute this.\n\nDifferent from the previous requirement, the organizing committee cares about the “total smugness value” of this arrangement. There are $n$ little fish, and there are $\\frac{n(n+1)}2$ different intervals in total. The smugness value of each interval equals the number of pairs in this interval that satisfy “the fish on the left has a larger cuteness value than the fish on the right” (in fact, it is the number of inversions in the interval). The total smugness value is the sum of the smugness values of all intervals. Now you need to output what the “total smugness value” is.", "inputFormat": "The first line contains an integer $n$, representing the number of fish.\n\nThe second line contains $n$ integers $a_1,a_2,\\cdots,a_n$, separated by spaces, representing the cuteness of each little fish from left to right.", "outputFormat": "Output one integer representing the answer.", "hint": "Test Point | $n$ | $a_i$ | Are there duplicate numbers\n:-:|:-:|:-:|:-:\n$1$ | $1$ | No special restrictions | No\n$2$ | $10$ | No special restrictions | No\n$3$ | $10$ | No special restrictions | Yes\n$4$ | $1000$ | $\\le10$ | Yes\n$5$ | $1000$ | No special restrictions | No\n$6$ | $1000$ | No special restrictions | Yes\n$7$ | $10^5$ | $\\le100$ | Yes\n$8$ | $3\\times 10^5$ | No special restrictions | No\n$9$ | $5\\times 10^5$ | No special restrictions | Yes\n$10$ | $10^6$ | No special restrictions | Yes\n\nConstraints: for $100\\%$ of the data, $n \\le 10^6$, $a_i \\le 10^9$, and all numbers are non-negative integers.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "小鱼比可爱（加强版）", "background": "", "description": "人比人，气死人；鱼比鱼，难死鱼。小鱼最近参加了一个“比可爱”比赛，比的是每只鱼的可爱程度。参赛的鱼被从左到右排成一排，头都朝向左边，然后每只鱼会得到一个整数数值，表示这只鱼的可爱程度，很显然整数越大，表示这只鱼越可爱，而且任意两只鱼的可爱程度可能一样。由于所有的鱼头都朝向左边，所以每只鱼只能看见在它左边的鱼的可爱程度，它们心里都在计算，在自己的眼力范围内有多少只鱼不如自己可爱呢。请你帮这些可爱但是鱼脑不够用的小鱼们计算一下。\n\n和之前的要求不一样，比赛组委会关心的是这个排列的“总得意值”。一共有 $n$ 只小鱼，总共有 $\\frac{n(n+1)}2$ 个不同的区间。每个区间的得意值等于这个区间中符合“左边的一只鱼的可爱值比右边的一只鱼可爱值更大”的对数（其实就是区间逆序对数啦）。总得意值就是所有区间的“得意值”的和。现在要求输出“总得意值”是多少。", "inputFormat": "第一行输入一个整数 $n$，表示鱼的数目。\n\n第二行内输入 $n$ 个整数 $a_1,a_2,\\cdots,a_n$，用空格间隔，依次表示从左到右每只小鱼的可爱程度。", "outputFormat": "输出一个整数表示答案。", "hint": "测试点　　　|$n$　　　　|$a_i$　　　　|是否有重复数字 　\n:-:|:-:|:-:|:-:\n$1$|$1$|无特殊限制|否\n$2$|$10$|无特殊限制|否\n$3$|$10$|无特殊限制|是\n$4$|$1000$|$\\le10$|是\n$5$|$1000$|无特殊限制|否\n$6$|$1000$|无特殊限制|是\n$7$|$10^5$|$\\le100$|是\n$8$|$3\\times 10^5$|无特殊限制|否\n$9$|$5\\times 10^5$|无特殊限制|是\n$10$|$10^6$|无特殊限制|是\n\n对于 $100\\%$ 的数据，$n \\le 10^6$，$a_i\\le 10^9$，所有数字均为非负整数。", "locale": "zh-CN"}}}
{"pid": "P5464", "type": "P", "difficulty": 6, "samples": [["3\n1 5\n2 7\n4 8\n", "6"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["动态规划 DP", "前缀和", "洛谷月赛"], "title": "缩小社交圈", "background": "", "description": "社交圈子里有 $n$ 个人，每个人都有一个 SAN 值范围 $[l_i,r_i]$。当两个人的 SAN 值交集不为空时，这两个人有 PY 关系。\n\n现在希望从社交圈子里面挑选出一些人组成一个集合 $S$，如果将所有集合内的人中有 PY 关系的那一对人都连上边，则 $S$ 刚好成为一个树（森林不行哦）。\n\n请问，有多少种可以选择的方案？由于答案可能很大，请对 $10^{9}+7$ 取模。", "inputFormat": "第一行一个整数 $n$。\n\n接下来 $n$ 行，每行 2 个整数，表示这个人的 SAN 值区间。", "outputFormat": "一行一个整数，表示答案。", "hint": "对于20%的数据，满足 $n \\leq 18$ 。\n\n对于40%的数据，满足 $n \\leq 50$\n\n对于60%的数据，满足 $n \\leq 200$\n\n对于100%的数据，满足 $n \\leq 2000,1 \\leq l_{i} <r_{i} \\leq 4000 $\n", "locale": "zh-CN", "translations": {"en": {"title": "Shrink the Social Circle", "background": "", "description": "There are $n$ people in a social circle. Each person has a SAN value interval $[l_i, r_i]$. If the SAN intervals of two people have a non-empty intersection, then these two people have a PY relationship.\n\nNow we want to pick some people from the social circle to form a set $S$. If we add an edge between every pair of people in the set who have a PY relationship, then $S$ must form exactly a tree (a forest is not allowed).\n\nHow many ways are there to choose such a set? Since the answer may be very large, output it modulo $10^{9}+7$.", "inputFormat": "The first line contains an integer $n$.\n\nThe next $n$ lines each contain two integers, describing the SAN value interval of a person.", "outputFormat": "Output one integer, the answer.", "hint": "For $20\\%$ of the testdata, $n \\leq 18$.\n\nFor $40\\%$ of the testdata, $n \\leq 50$.\n\nFor $60\\%$ of the testdata, $n \\leq 200$.\n\nFor $100\\%$ of the testdata, $n \\leq 2000$, $1 \\leq l_i < r_i \\leq 4000$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "缩小社交圈", "background": "", "description": "社交圈子里有 $n$ 个人，每个人都有一个 SAN 值范围 $[l_i,r_i]$。当两个人的 SAN 值交集不为空时，这两个人有 PY 关系。\n\n现在希望从社交圈子里面挑选出一些人组成一个集合 $S$，如果将所有集合内的人中有 PY 关系的那一对人都连上边，则 $S$ 刚好成为一个树（森林不行哦）。\n\n请问，有多少种可以选择的方案？由于答案可能很大，请对 $10^{9}+7$ 取模。", "inputFormat": "第一行一个整数 $n$。\n\n接下来 $n$ 行，每行 2 个整数，表示这个人的 SAN 值区间。", "outputFormat": "一行一个整数，表示答案。", "hint": "对于20%的数据，满足 $n \\leq 18$ 。\n\n对于40%的数据，满足 $n \\leq 50$\n\n对于60%的数据，满足 $n \\leq 200$\n\n对于100%的数据，满足 $n \\leq 2000,1 \\leq l_{i} <r_{i} \\leq 4000 $\n", "locale": "zh-CN"}}}
{"pid": "P5465", "type": "P", "difficulty": 6, "samples": [["7\n1 1 2 1 4 6\n5\n3 4 6\n1 5 7\n1 2 4\n1 2 6\n1 3 5", "3/2\n13/5\n3/2\n2/1\n1/1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["贪心", "2018", "倍增"], "title": "[PKUSC2018] 星际穿越", "background": "", "description": "有 $n$ 个星球，它们的编号是 1 到 $n$，它们坐落在同一个星系内，这个星系可以抽象为一条数轴，每个星球都是数轴上的一个点，特别地，编号为 $i$ 的星球的坐标是 $i$。\n\n一开始，由于科技上的原因，这 $n$ 个星球的居民之间无法进行交流，因此他们也不知道彼此的存在。现在，这些星球独立发展出了星际穿越与星际交流的工具。对于第 $i$ 个星球，他通过发射强力信号，成功地与编号在 $[l_i,i-1]$ 的所有星球取得了联系(编号为 1 的星球没有发出任何信号)，取得联系的两个星球会建立 **双向** 的传送门，对于建立了传送门的两个星球 $u,v$，$u$ 上的居民可以花费 1 单位时间传送到 $v$，$v$ 上的居民也可以花费 1 单位时间传送到 $u$ ，我们用 $dist(x,y)$ 表示从编号为 $x$ 的星球出发，通过一系列星球间的传送门，传送到编号为 $y$ 的星球最少需要花费的时间。\n\n现在有 $q$ 个星际商人，第 $i$ 个商人初始所在的位置是 $x_i$, 他的目的地是 $[l_i,r_i]$ 中的其中一个星球，保证 $l_i<r_i<x_i$ 。他会在这些星球中等概率挑选一个星球 $y$ (每个星球都有一样的概率被选中作为目的地)，然后通过一系列星球的传送门，**花费最少的时间**到达星球 $y$ 。商人想知道他花费的期望时间是多少？也就是计算 $\\frac{1}{r_i-l_i+1}{\\sum_{y=l_i}^{r_i}{dist(x_i,y)}}$ 。\n", "inputFormat": "第一行一个正整数 $n$ ，表示星球的个数。\n\n第二行 $n-1$ 个正整数，第 $i$ 个正整数为  $l_{i+1}$ ，表示编号在 $[l_{i+1},i]$ 区间内所有星球已经与编号为 $i+1$ 的星球取得了联系，并且可以通过花费 1 单位进行彼此的传输。保证 $l_{i+1}\\leq i$\n\n第三行一个正整数 $q$ ，表示询问组数。\n\n接下来 $q$ 行，每行三个数字 $l_i,r_i,x_i$ ，表示在 $[l_i,r_i]$ 这个区间中等概率选择一个星球 $y$，$dist(x_i,y)$ 的期望。保证 $l_i<r_i<x_i$\n", "outputFormat": "对于每组询问，注意到答案必然是一个有理数，因此以 $p/q$ 的格式输出这个有理数，要求 $\\gcd(p,q)=1$ 。\n\n如果答案为整数 $m$ ，输出 $m/1$ 。", "hint": "样例对应的无向图如下：![ex](https://cdn.luogu.com.cn/upload/pic/63831.png)\n\n对于 $20\\%$ 的数据，满足 $n \\leq 100$。\n\n对于另 $25\\%$ 的数据，满足 $n\\leq 2000$\n\n对于另 $25\\%$ 的数据，满足 $n\\leq 5000$\n\n对于 $100\\%$ 的数据，满足 $n,q\\leq 3\\times 10^5$", "locale": "zh-CN", "translations": {"en": {"title": "[PKUSC2018] Interstellar Travel", "background": "", "description": "There are $n$ planets, numbered from 1 to $n$. They are located in the same galaxy, which can be modeled as a number line. Each planet is a point on the number line. In particular, the coordinate of planet $i$ is $i$.\n\nAt the beginning, due to technological limits, the residents of these $n$ planets could not communicate with each other, so they did not know each other existed. Now, these planets have independently developed tools for interstellar travel and interstellar communication. For planet $i$, by sending a powerful signal, it successfully made contact with all planets with indices in $[l_i,i-1]$ (planet 1 did not send any signal). Any two planets that make contact will build a **bidirectional** portal. For two planets $u,v$ that have a portal between them, residents on $u$ can spend 1 unit of time to teleport to $v$, and residents on $v$ can also spend 1 unit of time to teleport to $u$. Let $dist(x,y)$ denote the minimum time needed to travel from planet $x$ to planet $y$ through a sequence of portals between planets.\n\nNow there are $q$ interstellar merchants. The initial position of the $i$-th merchant is $x_i$, and his destination is one planet among $[l_i,r_i]$, where it is guaranteed that $l_i<r_i<x_i$. He will choose a planet $y$ in this interval uniformly at random (each planet has the same probability of being chosen as the destination), and then reach planet $y$ through portals, using the **minimum possible time**. The merchant wants to know the expected time he spends, i.e., compute $\\frac{1}{r_i-l_i+1}{\\sum_{y=l_i}^{r_i}{dist(x_i,y)}}$.", "inputFormat": "The first line contains a positive integer $n$, representing the number of planets.\n\nThe second line contains $n-1$ positive integers. The $i$-th positive integer is $l_{i+1}$, meaning that all planets with indices in the interval $[l_{i+1},i]$ have already made contact with planet $i+1$, and they can transmit to each other with cost 1. It is guaranteed that $l_{i+1}\\leq i$.\n\nThe third line contains a positive integer $q$, representing the number of queries.\n\nThe next $q$ lines each contain three numbers $l_i,r_i,x_i$, meaning: choose a planet $y$ uniformly at random in $[l_i,r_i]$, and ask for the expected value of $dist(x_i,y)$. It is guaranteed that $l_i<r_i<x_i$.", "outputFormat": "For each query, note that the answer must be a rational number, so output it in the form $p/q$, requiring $\\gcd(p,q)=1$.\n\nIf the answer is an integer $m$, output $m/1$.", "hint": "The undirected graph corresponding to the sample is as follows: ![ex](https://cdn.luogu.com.cn/upload/pic/63831.png)\n\nFor $20\\%$ of the testdata, $n \\leq 100$.\n\nFor another $25\\%$ of the testdata, $n\\leq 2000$.\n\nFor another $25\\%$ of the testdata, $n\\leq 5000$.\n\nFor $100\\%$ of the testdata, $n,q\\leq 3\\times 10^5$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[PKUSC2018] 星际穿越", "background": "", "description": "有 $n$ 个星球，它们的编号是 1 到 $n$，它们坐落在同一个星系内，这个星系可以抽象为一条数轴，每个星球都是数轴上的一个点，特别地，编号为 $i$ 的星球的坐标是 $i$。\n\n一开始，由于科技上的原因，这 $n$ 个星球的居民之间无法进行交流，因此他们也不知道彼此的存在。现在，这些星球独立发展出了星际穿越与星际交流的工具。对于第 $i$ 个星球，他通过发射强力信号，成功地与编号在 $[l_i,i-1]$ 的所有星球取得了联系(编号为 1 的星球没有发出任何信号)，取得联系的两个星球会建立 **双向** 的传送门，对于建立了传送门的两个星球 $u,v$，$u$ 上的居民可以花费 1 单位时间传送到 $v$，$v$ 上的居民也可以花费 1 单位时间传送到 $u$ ，我们用 $dist(x,y)$ 表示从编号为 $x$ 的星球出发，通过一系列星球间的传送门，传送到编号为 $y$ 的星球最少需要花费的时间。\n\n现在有 $q$ 个星际商人，第 $i$ 个商人初始所在的位置是 $x_i$, 他的目的地是 $[l_i,r_i]$ 中的其中一个星球，保证 $l_i<r_i<x_i$ 。他会在这些星球中等概率挑选一个星球 $y$ (每个星球都有一样的概率被选中作为目的地)，然后通过一系列星球的传送门，**花费最少的时间**到达星球 $y$ 。商人想知道他花费的期望时间是多少？也就是计算 $\\frac{1}{r_i-l_i+1}{\\sum_{y=l_i}^{r_i}{dist(x_i,y)}}$ 。\n", "inputFormat": "第一行一个正整数 $n$ ，表示星球的个数。\n\n第二行 $n-1$ 个正整数，第 $i$ 个正整数为  $l_{i+1}$ ，表示编号在 $[l_{i+1},i]$ 区间内所有星球已经与编号为 $i+1$ 的星球取得了联系，并且可以通过花费 1 单位进行彼此的传输。保证 $l_{i+1}\\leq i$\n\n第三行一个正整数 $q$ ，表示询问组数。\n\n接下来 $q$ 行，每行三个数字 $l_i,r_i,x_i$ ，表示在 $[l_i,r_i]$ 这个区间中等概率选择一个星球 $y$，$dist(x_i,y)$ 的期望。保证 $l_i<r_i<x_i$\n", "outputFormat": "对于每组询问，注意到答案必然是一个有理数，因此以 $p/q$ 的格式输出这个有理数，要求 $\\gcd(p,q)=1$ 。\n\n如果答案为整数 $m$ ，输出 $m/1$ 。", "hint": "样例对应的无向图如下：![ex](https://cdn.luogu.com.cn/upload/pic/63831.png)\n\n对于 $20\\%$ 的数据，满足 $n \\leq 100$。\n\n对于另 $25\\%$ 的数据，满足 $n\\leq 2000$\n\n对于另 $25\\%$ 的数据，满足 $n\\leq 5000$\n\n对于 $100\\%$ 的数据，满足 $n,q\\leq 3\\times 10^5$", "locale": "zh-CN"}}}
{"pid": "P5466", "type": "P", "difficulty": 6, "samples": [["1?0?", "17"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["字符串", "2018", "快速傅里叶变换 FFT", "快速数论变换 NTT"], "title": "[PKUSC2018] 神仙的游戏", "background": "", "description": "小 D 和小 H 是两位神仙。他们经常在一起玩神仙才会玩的一些游戏，比如 “口算一个 4 位数是不是完全平方数” 。\n\n今天他们发现了一种新的游戏：首先称 $s$ 长度为 $len$ 的前缀成为 border 当且仅当 $s[1\\dots len ] = s[|s|-len + 1\\dots |s|]$ 。给出一个由 $\\texttt{01?}$ 组成的字符串 $s$，将 $s$ 中的问号用 $\\texttt{01}$ 替换，对每个 $len$ 口算是否存在替换问号的方案使得 $s$ 长度为 $len$ 的前缀成为 border，把这个结果记做 $f(len)\\in \\{0,1\\}$。如果 $s$ 长度为 $len$ 的前缀能够成为 border 那么 $f(len) = 1$，否则 $f(len) = 0$。\n\n由于小 D 和小 H 是神仙，所以他们计算的 $s$ 的长度很长，因此把计算的结果一一比对会花费很长的时间。为了方便比对，他们规定了一个校验值：$(f(1)\\times 1^2)~\\operatorname{xor}~(f(2)\\times 2^2)~\\operatorname{xor}~(f(3)\\times 3^2)~\\operatorname{xor}~\\dots~\\operatorname{xor}~(f(n)\\times n^2)$ 来校验他们的答案是否相同。$\\operatorname{xor}$ 表示按位异或。但是不巧，在某一次游戏中，他们口算出的校验值并不一样，他们希望你帮助他们来计算一个正确的校验值。当然，他们不强迫你口算，可以编程解决。\n", "inputFormat": "一个串 $s$，保证每个字符都是 $\\texttt 0$，$\\texttt 1$ 或者 $\\texttt ?$。", "outputFormat": "输出字符串的校验值， 即 $(f(1)\\times 1^2)~\\operatorname{xor}~(f(2)\\times 2^2)~\\operatorname{xor}~(f(3)\\times 3^2)~\\operatorname{xor}~\\dots~\\operatorname{xor}~(f(n)\\times n^2)$。", "hint": "### 样例解释\n\n将问号填充为 1001，则这个串有长度为 1 的 border, 故 $f(1) = 1$。\n\n将问号填充为 1101，则这个串有长度为 4 的 border, 故 $f(4) = 1$。\n\n对于 $f(2)$ 和 $f(3)$，可以枚举填充的字符是什么来证明他们的值是 0。\n\n故答案是 $1^2~\\operatorname{xor}~4^2=17$。\n\n### 数据范围\n\n| 子任务编号 |        $\\lvert s \\rvert$         |         附加说明         | 分数 |\n| :--------: | :------------------: | :----------------------: | :--: |\n|     1      |     $\\leq 1000$      |            无            |  8   |\n|     2      | $\\leq 5 \\times 10^5$ |     输入的串没有问号     |  10  |\n|     3      | $\\leq 5\\times 10^5$  |         数据随机         |  22  |\n|     4      | $\\leq 5\\times 10^5$  | 问号个数至少是 $\\lvert s \\rvert -5000$ |  27  |\n|     5      | $\\leq 5\\times 10^5$  |            无            |  33  |\n", "locale": "zh-CN", "translations": {"en": {"title": "[PKUSC2018] Immortals' Game", "background": "", "description": "Little D and Little H are two immortals. They often play games that only immortals would play, such as “mentally checking whether a 4-digit number is a perfect square”.\n\nToday they found a new game: first, for a string $s$, a prefix of length $len$ is called a border if and only if $s[1\\dots len] = s[|s|-len+1\\dots |s|]$. Given a string $s$ consisting of $\\texttt{01?}$, replace each question mark in $s$ with $\\texttt{0}$ or $\\texttt{1}$. For each $len$, mentally determine whether there exists a way to replace the question marks such that the prefix of $s$ of length $len$ becomes a border, and record this result as $f(len)\\in\\{0,1\\}$. If the prefix of $s$ of length $len$ can become a border, then $f(len)=1$; otherwise $f(len)=0$.\n\nSince Little D and Little H are immortals, the length of $s$ they compute is very large, so comparing the results one by one would take a long time. To make comparison easier, they define a checksum: $(f(1)\\times 1^2)~\\operatorname{xor}~(f(2)\\times 2^2)~\\operatorname{xor}~(f(3)\\times 3^2)~\\operatorname{xor}~\\dots~\\operatorname{xor}~(f(n)\\times n^2)$ to verify whether their answers are the same. $\\operatorname{xor}$ denotes bitwise XOR. Unfortunately, in one game, the checksums they computed mentally were not the same. They want you to help them compute the correct checksum. Of course, they do not force you to do it mentally; you may solve it by programming.", "inputFormat": "A string $s$, guaranteed that each character is $\\texttt 0$, $\\texttt 1$, or $\\texttt ?$.", "outputFormat": "Output the checksum of the string, i.e. $(f(1)\\times 1^2)~\\operatorname{xor}~(f(2)\\times 2^2)~\\operatorname{xor}~(f(3)\\times 3^2)~\\operatorname{xor}~\\dots~\\operatorname{xor}~(f(n)\\times n^2)$.", "hint": "### Sample Explanation\n\nFill the question marks as 1001. Then this string has a border of length 1, so $f(1)=1$.\n\nFill the question marks as 1101. Then this string has a border of length 4, so $f(4)=1$.\n\nFor $f(2)$ and $f(3)$, you can enumerate what characters are filled in to prove that their values are 0.\n\nSo the answer is $1^2~\\operatorname{xor}~4^2=17$.\n\n### Constraints\n\n| Subtask ID |        $\\lvert s \\rvert$         |         Additional Notes         | Score |\n| :--------: | :------------------: | :----------------------: | :--: |\n|     1      |     $\\leq 1000$      |            None            |  8   |\n|     2      | $\\leq 5 \\times 10^5$ |     The input string has no question marks     |  10  |\n|     3      | $\\leq 5\\times 10^5$  |         The testdata is random         |  22  |\n|     4      | $\\leq 5\\times 10^5$  | The number of question marks is at least $\\lvert s \\rvert - 5000$ |  27  |\n|     5      | $\\leq 5\\times 10^5$  |            None            |  33  |\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[PKUSC2018] 神仙的游戏", "background": "", "description": "小 D 和小 H 是两位神仙。他们经常在一起玩神仙才会玩的一些游戏，比如 “口算一个 4 位数是不是完全平方数” 。\n\n今天他们发现了一种新的游戏：首先称 $s$ 长度为 $len$ 的前缀成为 border 当且仅当 $s[1\\dots len ] = s[|s|-len + 1\\dots |s|]$ 。给出一个由 $\\texttt{01?}$ 组成的字符串 $s$，将 $s$ 中的问号用 $\\texttt{01}$ 替换，对每个 $len$ 口算是否存在替换问号的方案使得 $s$ 长度为 $len$ 的前缀成为 border，把这个结果记做 $f(len)\\in \\{0,1\\}$。如果 $s$ 长度为 $len$ 的前缀能够成为 border 那么 $f(len) = 1$，否则 $f(len) = 0$。\n\n由于小 D 和小 H 是神仙，所以他们计算的 $s$ 的长度很长，因此把计算的结果一一比对会花费很长的时间。为了方便比对，他们规定了一个校验值：$(f(1)\\times 1^2)~\\operatorname{xor}~(f(2)\\times 2^2)~\\operatorname{xor}~(f(3)\\times 3^2)~\\operatorname{xor}~\\dots~\\operatorname{xor}~(f(n)\\times n^2)$ 来校验他们的答案是否相同。$\\operatorname{xor}$ 表示按位异或。但是不巧，在某一次游戏中，他们口算出的校验值并不一样，他们希望你帮助他们来计算一个正确的校验值。当然，他们不强迫你口算，可以编程解决。\n", "inputFormat": "一个串 $s$，保证每个字符都是 $\\texttt 0$，$\\texttt 1$ 或者 $\\texttt ?$。", "outputFormat": "输出字符串的校验值， 即 $(f(1)\\times 1^2)~\\operatorname{xor}~(f(2)\\times 2^2)~\\operatorname{xor}~(f(3)\\times 3^2)~\\operatorname{xor}~\\dots~\\operatorname{xor}~(f(n)\\times n^2)$。", "hint": "### 样例解释\n\n将问号填充为 1001，则这个串有长度为 1 的 border, 故 $f(1) = 1$。\n\n将问号填充为 1101，则这个串有长度为 4 的 border, 故 $f(4) = 1$。\n\n对于 $f(2)$ 和 $f(3)$，可以枚举填充的字符是什么来证明他们的值是 0。\n\n故答案是 $1^2~\\operatorname{xor}~4^2=17$。\n\n### 数据范围\n\n| 子任务编号 |        $\\lvert s \\rvert$         |         附加说明         | 分数 |\n| :--------: | :------------------: | :----------------------: | :--: |\n|     1      |     $\\leq 1000$      |            无            |  8   |\n|     2      | $\\leq 5 \\times 10^5$ |     输入的串没有问号     |  10  |\n|     3      | $\\leq 5\\times 10^5$  |         数据随机         |  22  |\n|     4      | $\\leq 5\\times 10^5$  | 问号个数至少是 $\\lvert s \\rvert -5000$ |  27  |\n|     5      | $\\leq 5\\times 10^5$  |            无            |  33  |\n", "locale": "zh-CN"}}}
{"pid": "P5467", "type": "P", "difficulty": 6, "samples": [["4 4\n0 0\n1 0\n-1 -1\n0 1\n0 0\n1 0\n1 1\n0 1\n", "0.50000\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2018"], "title": "[PKUSC2018] PKUSC", "background": "", "description": "九条可怜是一个爱玩游戏的女孩子。\n\n最近她在玩一个无双割草类的游戏，平面上有 $n$ 个敌人，每一个敌人的坐标为 $x_i,y_i$。可怜有一个技能是在平面上画一个 $m$ 个点的简单多边形，并消灭所有**严格**在多边形内部的敌人。\n\n不难发现如果想要快速的消灭敌人的话，只要画一个足够大的简单多边形就行了。但是这样的游戏性就太差了。于是可怜打算为游戏增加一定的随机性。\n\n可怜在平面上随便画了一个 $m$ 个点的简单多边形 $(a_i,b_i)$。接下来可怜打算按照 $[-\\pi,\\pi)$ 上的均匀分布随机选取数字 $\\alpha$（可以理解为等概率选取），并把这个简单多边形绕原点逆时针旋转 $\\alpha$ 的角度（弧度制）。\n\n现在可怜给你了每一个点的坐标，多边形的坐标，你的任务是帮助可怜计算在随机旋转后她期望可以消灭多少个敌人。", "inputFormat": "第一行四个整数 $n,m$。\n\n接下来 $n$ 行每行两个整数 $x_i,y_i$ 描述了一个敌人的坐标。\n\n接下来 $m$ 行每行两个整数 $a_i,b_i$ 按照逆时针的顺序描述了简单多边形的每一个顶点。", "outputFormat": "输出一行一个整数表示期望值，保留五位小数。同时保证所有数据的小数点后第 $6$ 位在舍入前不会是 $4$ 和 $5$。", "hint": "### 样例解释\n\n如果你对概率与期望不怎么了解，这儿给出一些 Hint:\n\n1. 设 $P_i$ 为旋转之后恰好能消灭 $i$ 个敌人的概率，那么期望就是 $\\sum_{i=1}^n iP_i$.\n2. 计算 $P_i$ 的一个方法是，在所有 $[-\\pi,\\pi)$ 范围内的旋转角度中，旋转后恰好消灭 $i$ 个敌人的角度构成了 $t_i$ 个区间 $(l_j,r_j)$（开闭不影响），那么 $P_i=\\frac{\\sum_{j=1}^{t_i}(r_j-l_j)}{2\\pi}$.\n\n在这题中：能消灭 $0$ 个敌人的区间是 $[\\frac{\\pi}{2},\\pi),[-\\pi,-\\frac{\\pi}{2}]$，能消灭 $1$ 个敌人的区间是 $(-\\frac{\\pi}{2},0),(0,\\frac{\\pi}{2})$。于是 $P_0 = P_1=\\frac{1}{2}$。所以答案为 $\\frac{1}{2}=0.50000$.\n\n### 数据范围\n\n对于 $30\\%$ 的数据，$n,m \\leq 15$。\n\n对于另外 $30\\%$ 的数据，选择的简单多边形是一个凸多边形。\n\n对于 $100\\%$ 的数据，$n \\leq 200, m \\leq 500, |x|,|y| \\leq 10^6$.", "locale": "zh-CN", "translations": {"en": {"title": "[PKUSC2018] PKUSC", "background": "", "description": "Jiutiao Keliang is a girl who loves playing games.\n\nRecently, she has been playing a hack-and-slash mowing game. There are $n$ enemies on the plane, and the coordinates of each enemy are $x_i,y_i$. Keliang has a skill that allows her to draw a simple polygon with $m$ points on the plane, and eliminate all enemies that are **strictly** inside the polygon.\n\nIt is not hard to see that if she wants to eliminate enemies quickly, she can just draw a sufficiently large simple polygon. But that would make the game much less fun. So, Keliang decides to add some randomness to the game.\n\nKeliang casually draws a simple polygon with $m$ points $(a_i,b_i)$ on the plane. Next, she plans to randomly choose a number $\\alpha$ according to the uniform distribution on $[-\\pi,\\pi)$ (you can think of it as choosing with equal probability), and rotate this simple polygon counterclockwise around the origin by an angle of $\\alpha$ (in radians).\n\nNow Keliang gives you the coordinates of every point and the polygon. Your task is to help Keliang compute the expected number of enemies she can eliminate after a random rotation.", "inputFormat": "The first line contains four integers $n,m$.\n\nThe next $n$ lines each contain two integers $x_i,y_i$, describing the coordinates of an enemy.\n\nThe next $m$ lines each contain two integers $a_i,b_i$, describing each vertex of the simple polygon in counterclockwise order.", "outputFormat": "Output one line with one number representing the expected value, rounded to five digits after the decimal point. It is guaranteed that, before rounding, the $6$-th digit after the decimal point will not be $4$ or $5$ for all testdata.", "hint": "### Sample Explanation\n\nIf you are not very familiar with probability and expectation, here are some hints:\n\n1. Let $P_i$ be the probability that after rotation, exactly $i$ enemies can be eliminated. Then the expectation is $\\sum_{i=1}^n iP_i$.\n2. One way to compute $P_i$ is: among all rotation angles in the range $[-\\pi,\\pi)$, the angles for which exactly $i$ enemies are eliminated after rotation form $t_i$ intervals $(l_j,r_j)$ (whether endpoints are open or closed does not matter). Then $P_i=\\frac{\\sum_{j=1}^{t_i}(r_j-l_j)}{2\\pi}$.\n\nIn this problem: the intervals where $0$ enemies can be eliminated are $[\\frac{\\pi}{2},\\pi),[-\\pi,-\\frac{\\pi}{2}]$, and the intervals where $1$ enemy can be eliminated are $(-\\frac{\\pi}{2},0),(0,\\frac{\\pi}{2})$. Therefore, $P_0 = P_1=\\frac{1}{2}$. So the answer is $\\frac{1}{2}=0.50000$.\n\n### Constraints\n\nFor $30\\%$ of the data, $n,m \\leq 15$.\n\nFor another $30\\%$ of the data, the chosen simple polygon is a convex polygon.\n\nFor $100\\%$ of the data, $n \\leq 200, m \\leq 500, |x|,|y| \\leq 10^6$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[PKUSC2018] PKUSC", "background": "", "description": "九条可怜是一个爱玩游戏的女孩子。\n\n最近她在玩一个无双割草类的游戏，平面上有 $n$ 个敌人，每一个敌人的坐标为 $x_i,y_i$。可怜有一个技能是在平面上画一个 $m$ 个点的简单多边形，并消灭所有**严格**在多边形内部的敌人。\n\n不难发现如果想要快速的消灭敌人的话，只要画一个足够大的简单多边形就行了。但是这样的游戏性就太差了。于是可怜打算为游戏增加一定的随机性。\n\n可怜在平面上随便画了一个 $m$ 个点的简单多边形 $(a_i,b_i)$。接下来可怜打算按照 $[-\\pi,\\pi)$ 上的均匀分布随机选取数字 $\\alpha$（可以理解为等概率选取），并把这个简单多边形绕原点逆时针旋转 $\\alpha$ 的角度（弧度制）。\n\n现在可怜给你了每一个点的坐标，多边形的坐标，你的任务是帮助可怜计算在随机旋转后她期望可以消灭多少个敌人。", "inputFormat": "第一行四个整数 $n,m$。\n\n接下来 $n$ 行每行两个整数 $x_i,y_i$ 描述了一个敌人的坐标。\n\n接下来 $m$ 行每行两个整数 $a_i,b_i$ 按照逆时针的顺序描述了简单多边形的每一个顶点。", "outputFormat": "输出一行一个整数表示期望值，保留五位小数。同时保证所有数据的小数点后第 $6$ 位在舍入前不会是 $4$ 和 $5$。", "hint": "### 样例解释\n\n如果你对概率与期望不怎么了解，这儿给出一些 Hint:\n\n1. 设 $P_i$ 为旋转之后恰好能消灭 $i$ 个敌人的概率，那么期望就是 $\\sum_{i=1}^n iP_i$.\n2. 计算 $P_i$ 的一个方法是，在所有 $[-\\pi,\\pi)$ 范围内的旋转角度中，旋转后恰好消灭 $i$ 个敌人的角度构成了 $t_i$ 个区间 $(l_j,r_j)$（开闭不影响），那么 $P_i=\\frac{\\sum_{j=1}^{t_i}(r_j-l_j)}{2\\pi}$.\n\n在这题中：能消灭 $0$ 个敌人的区间是 $[\\frac{\\pi}{2},\\pi),[-\\pi,-\\frac{\\pi}{2}]$，能消灭 $1$ 个敌人的区间是 $(-\\frac{\\pi}{2},0),(0,\\frac{\\pi}{2})$。于是 $P_0 = P_1=\\frac{1}{2}$。所以答案为 $\\frac{1}{2}=0.50000$.\n\n### 数据范围\n\n对于 $30\\%$ 的数据，$n,m \\leq 15$。\n\n对于另外 $30\\%$ 的数据，选择的简单多边形是一个凸多边形。\n\n对于 $100\\%$ 的数据，$n \\leq 200, m \\leq 500, |x|,|y| \\leq 10^6$.", "locale": "zh-CN"}}}
{"pid": "P5468", "type": "P", "difficulty": 6, "samples": [["3 4 1 5 10\n1 2 3 4\n1 2 5 7\n1 2 6 8\n2 3 9 10", "94"], ["4 3 1 2 3\n1 2 2 3\n2 3 5 7\n3 4 7 9", "34"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["动态规划 DP", "2019", "NOI", "O2优化", "深度优先搜索 DFS", "斜率优化", "生成树"], "title": "[NOI2019] 回家路线", "background": "本题原题数据强度较低，若想要测试较强数据可以去 [P6302](https://www.luogu.com.cn/problem/P6302)，除数据范围外均与原题相同。", "description": "猫国的铁路系统中有 $n$ 个站点，从 $1 - n$ 编号。小猫准备从 $1$ 号站点出发，乘坐列车回到猫窝所在的 $n$ 号站点。它查询了能够乘坐的列车，这些列车共 $m$ 班，从 $1 - m$ 编号。小猫将在 $0$ 时刻到达 $1$ 号站点。对于 $i$ 号列车，它将在时刻 $p_i$ 从站点 $x_i$ 出发，在时刻 $q_i$ 直达站点 $y_i$，小猫只能在时刻 $p_i$ 上 $i$ 号列车，也只能在时刻 $q_i$ 下 $i$ 号列车。小猫可以通过多次换乘到达 $n$ 号站点。一次换乘是指对于两班列车，假设分别为 $u$ 号与 $v$ 号列车，若 $y_u = x_v$ 并且 $q_u \\leq p_v$，那么小猫可以乘坐完 $u$ 号列车后在 $y_u$ 号站点等待 $p_v - q_u$ 个时刻，并在时刻 $p_v$ 乘坐 $v$ 号列车。\n\n小猫只想回到猫窝并且减少途中的麻烦，对此它用烦躁值来衡量。\n\n- 小猫在站点等待时将增加烦躁值，对于一次 $t (t \\geq 0)$ 个时刻的等待，烦躁值将增加 $At^2 + Bt + C$，其中 $A, B,C$ 是给定的常数。注意：小猫登上第一班列车前，即从 $0$ 时刻起停留在 $1$ 号站点的那些时刻也算作一次等待。\n\n- 若小猫最终在时刻 $z$ 到达 $n$ 号站点，则烦躁值将再增加 $z$。\n\n形式化地说，若小猫共乘坐了 $k$ 班列车，依次乘坐的列车编号可用序列 $s_1, s_2, \\cdots , s_k$表示。该方案被称作一条可行的回家路线，当且仅当它满足下列两个条件：\n\n1. $x_{s1} = 1$ , $y_{sk} = n$\n\n2. 对于所有 $j (1 \\leq j < k)$，满足 $y_{sj} = x_{s_{j+1}}$ 且 $q_{sj}\\leq p_{s_{j+1}}$\n\n对于该回家路线，小猫得到的烦躁值将为：\n\n$$q_{s_k}+(A\\times p_{s_1}^2+B\\times p_{s_1}+C)+\\sum_{j=1}^{k-1}(A(p_{s_{j+1}}-q_{s_j})^2+B(p_{s_{j+1}}-q_{s_j})+C)$$\n\n小猫想让自己的烦躁值尽量小，请你帮它求出所有可行的回家路线中，能得到的最小的烦躁值。题目保证至少存在一条可行的回家路线。", "inputFormat": "第一行五个整数 $n, m, A, B,C$，变量意义见题目描述。\n\n接下来 $m$ 行，第 $i$ 行四个整数 $x_i, y_i, p_i, q_i$，分别表示 $i$ 号列车的出发站、到达站、出发时刻与到达时刻。", "outputFormat": "输出仅一行一个整数，表示所求的答案。", "hint": "### 更多样例\n\n您可以通过附加文件获得更多样例。\n\n#### 样例 3\n\n见附加文件的 `route/route3.in` 与 `route/route3.ans`。\n\n该样例的数据类型与最终测试点 $5 \\sim 8$ 一致。\n\n#### 样例 4\n\n见附加文件的 `route/route4.in` 与 `route/route4.ans`。\n\n该样例的数据类型与最终测试点 $11 \\sim 14$ 一致。\n\n#### 样例 5\n\n见附加文件的 `route/route5.in` 与 `route/route5.ans`。\n\n该样例的数据类型与最终测试点 $18 \\sim 20$ 一致。\n\n### 样例 1 解释\n\n共有三条可行的回家路线：\n\n- 依次乘坐 1，4 号列车，得到的烦躁值为：$10 + (1 \\times 3^2 + 5 \\times 3 + 10) + (1 \\times (9 - 4)^2 + 5 \\times (9 - 4) + 10)= 104$\n- 依次乘坐 2，4 号列车，得到的烦躁值为：$10 + (1 \\times 5^2 + 5 \\times 5 + 10) + (1 \\times (9 - 7)^2 + 5 \\times (9 - 7) + 10)= 94$\n- 依次乘坐 3，4 号列车，得到的烦躁值为：$10 + (1 \\times 6^2 + 5 \\times 6 + 10) + (1 \\times (9 - 8)^2 + 5 \\times (9 - 8) + 10)= 102$\n\n第二条路线得到的烦躁值最小为 $94$。\n\n### 数据范围\n\n对于所有测试点：$2\\le n\\le 10^5,1\\le m\\le 2\\times 10^5,0 \\le A \\le 10 , 0 \\le B, C \\le 10^6,1 \\le x_i, y_i \\le n , x_i \\neq y_i , 0 \\le p_i < q_i \\le 10^3$。\n\n每个测试点的具体限制见下表：\n\n::cute-table{tuack}\n\n| 测试点编号  |        $n$         |          $m$          | $A,B,C$ 的特殊限制 | 其他特殊条件 |\n| :---------: | :----------------: | :-------------------: | :----------------: | :----------: |\n|  $1\\sim 2$  |     $\\le 100$      |        $=n-1$         |         无         | $y_i=x_i+1$  |\n|  $3\\sim 4$  |     ^      | $\\le 100$ |     $A=B=C=0$      | ^  |\n|  $5\\sim 8$  | $\\le 2\\times 10^3$ |  $\\le 4\\times 10^3$   |     ^              |  $x_i<y_i$   |\n|     $9$     | ^ |  ^   |      $A=B=0$       |  ^   |\n|    $10$     | ^ |  ^   |       $A=0$        |  ^   |\n| $11\\sim 14$ | ^ |  ^   |         无         |      无      |\n|    $15$     |     $\\le 10^5$     |  $\\le 2\\times 10^5$   |      $A=B=0$       |      ^      |\n| $16\\sim 17$ |     ^     |  ^   |       $A=0$        |      ^      |\n| $18\\sim 20$ |     ^     |  ^   |         无         |      ^      |", "locale": "zh-CN", "translations": {"en": {"title": "[NOI2019] Route Home", "background": "The original version of this problem has relatively weak testdata. If you want to test with stronger testdata, you can go to [P6302](https://www.luogu.com.cn/problem/P6302). Except for the Constraints, everything is the same as the original problem.", "description": "In the railway system of Cat Kingdom, there are $n$ stations numbered from $1$ to $n$. A kitten plans to start from station $1$ and take trains to return to its home at station $n$. It has checked the available trains: there are $m$ trains in total, numbered from $1$ to $m$. The kitten will arrive at station $1$ at time $0$.\n\nFor train $i$, it departs from station $x_i$ at time $p_i$ and goes directly to station $y_i$, arriving at time $q_i$. The kitten can only board train $i$ at time $p_i$, and can only get off train $i$ at time $q_i$. The kitten can reach station $n$ by transferring multiple times.\n\nA transfer means the following: for two trains, say train $u$ and train $v$, if $y_u = x_v$ and $q_u \\leq p_v$, then after taking train $u$, the kitten can wait at station $y_u$ for $p_v - q_u$ time units, and then take train $v$ at time $p_v$.\n\nThe kitten wants to get home while reducing the trouble on the way, and it measures this by an “irritation value”.\n\n- While the kitten is waiting at a station, the irritation value increases. For a wait of $t (t \\geq 0)$ time units, the irritation value increases by $At^2 + Bt + C$, where $A, B, C$ are given constants. Note: the time it stays at station $1$ starting from time $0$ before boarding the first train also counts as one wait.\n\n- If the kitten finally arrives at station $n$ at time $z$, the irritation value increases by an additional $z$.\n\nFormally, suppose the kitten takes $k$ trains in total, and the sequence of train indices is $s_1, s_2, \\cdots , s_k$. This plan is called a feasible route home if and only if it satisfies:\n\n1. $x_{s1} = 1$ , $y_{sk} = n$\n\n2. For all $j (1 \\leq j < k)$, $y_{sj} = x_{s_{j+1}}$ and $q_{sj}\\leq p_{s_{j+1}}$\n\nFor this route home, the irritation value is:\n\n$$q_{s_k}+(A\\times p_{s_1}^2+B\\times p_{s_1}+C)+\\sum_{j=1}^{k-1}(A(p_{s_{j+1}}-q_{s_j})^2+B(p_{s_{j+1}}-q_{s_j})+C)$$\n\nThe kitten wants the irritation value to be as small as possible. Please compute, among all feasible routes home, the minimum possible irritation value. The problem guarantees that at least one feasible route exists.", "inputFormat": "The first line contains five integers $n, m, A, B, C$. Their meanings are as described in the statement.\n\nThe next $m$ lines: line $i$ contains four integers $x_i, y_i, p_i, q_i$, representing the departure station, arrival station, departure time, and arrival time of train $i$.", "outputFormat": "Output one integer in a single line, the required answer.", "hint": "### More Samples\n\nYou can obtain more samples through the additional files.\n\n#### Sample 3\n\nSee `route/route3.in` and `route/route3.ans` in the additional files.\n\nThe data type of this sample is the same as that of final test points $5 \\sim 8$.\n\n#### Sample 4\n\nSee `route/route4.in` and `route/route4.ans` in the additional files.\n\nThe data type of this sample is the same as that of final test points $11 \\sim 14$.\n\n#### Sample 5\n\nSee `route/route5.in` and `route/route5.ans` in the additional files.\n\nThe data type of this sample is the same as that of final test points $18 \\sim 20$.\n\n### Explanation for Sample 1\n\nThere are three feasible routes home:\n\n- Take trains 1 and 4 in order. The irritation value is: $10 + (1 \\times 3^2 + 5 \\times 3 + 10) + (1 \\times (9 - 4)^2 + 5 \\times (9 - 4) + 10)= 104$\n- Take trains 2 and 4 in order. The irritation value is: $10 + (1 \\times 5^2 + 5 \\times 5 + 10) + (1 \\times (9 - 7)^2 + 5 \\times (9 - 7) + 10)= 94$\n- Take trains 3 and 4 in order. The irritation value is: $10 + (1 \\times 6^2 + 5 \\times 6 + 10) + (1 \\times (9 - 8)^2 + 5 \\times (9 - 8) + 10)= 102$\n\nThe second route has the smallest irritation value, which is $94$.\n\n### Constraints\n\nFor all test points: $2\\le n\\le 10^5,1\\le m\\le 2\\times 10^5,0 \\le A \\le 10 , 0 \\le B, C \\le 10^6,1 \\le x_i, y_i \\le n , x_i \\neq y_i , 0 \\le p_i < q_i \\le 10^3$.\n\nThe specific limits for each test point are shown in the table below:\n\n::cute-table{tuack}\n\n| Test Point ID |        $n$         |          $m$          | Special Limits on $A,B,C$ | Other Special Conditions |\n| :-----------: | :----------------: | :-------------------: | :-----------------------: | :----------------------: |\n|  $1\\sim 2$    |     $\\le 100$      |        $=n-1$         |           None            | $y_i=x_i+1$              |\n|  $3\\sim 4$    |         ^          |        $\\le 100$      |       $A=B=C=0$           | ^                        |\n|  $5\\sim 8$    | $\\le 2\\times 10^3$ |  $\\le 4\\times 10^3$   |            ^              |  $x_i<y_i$               |\n|     $9$       |         ^          |          ^            |        $A=B=0$            | ^                        |\n|    $10$       |         ^          |          ^            |         $A=0$             | ^                        |\n| $11\\sim 14$   |         ^          |          ^            |           None            |           None           |\n|    $15$       |     $\\le 10^5$     |  $\\le 2\\times 10^5$   |        $A=B=0$            | ^                        |\n| $16\\sim 17$   |         ^          |          ^            |         $A=0$             | ^                        |\n| $18\\sim 20$   |         ^          |          ^            |           None            | ^                        |\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[NOI2019] 回家路线", "background": "本题原题数据强度较低，若想要测试较强数据可以去 [P6302](https://www.luogu.com.cn/problem/P6302)，除数据范围外均与原题相同。", "description": "猫国的铁路系统中有 $n$ 个站点，从 $1 - n$ 编号。小猫准备从 $1$ 号站点出发，乘坐列车回到猫窝所在的 $n$ 号站点。它查询了能够乘坐的列车，这些列车共 $m$ 班，从 $1 - m$ 编号。小猫将在 $0$ 时刻到达 $1$ 号站点。对于 $i$ 号列车，它将在时刻 $p_i$ 从站点 $x_i$ 出发，在时刻 $q_i$ 直达站点 $y_i$，小猫只能在时刻 $p_i$ 上 $i$ 号列车，也只能在时刻 $q_i$ 下 $i$ 号列车。小猫可以通过多次换乘到达 $n$ 号站点。一次换乘是指对于两班列车，假设分别为 $u$ 号与 $v$ 号列车，若 $y_u = x_v$ 并且 $q_u \\leq p_v$，那么小猫可以乘坐完 $u$ 号列车后在 $y_u$ 号站点等待 $p_v - q_u$ 个时刻，并在时刻 $p_v$ 乘坐 $v$ 号列车。\n\n小猫只想回到猫窝并且减少途中的麻烦，对此它用烦躁值来衡量。\n\n- 小猫在站点等待时将增加烦躁值，对于一次 $t (t \\geq 0)$ 个时刻的等待，烦躁值将增加 $At^2 + Bt + C$，其中 $A, B,C$ 是给定的常数。注意：小猫登上第一班列车前，即从 $0$ 时刻起停留在 $1$ 号站点的那些时刻也算作一次等待。\n\n- 若小猫最终在时刻 $z$ 到达 $n$ 号站点，则烦躁值将再增加 $z$。\n\n形式化地说，若小猫共乘坐了 $k$ 班列车，依次乘坐的列车编号可用序列 $s_1, s_2, \\cdots , s_k$表示。该方案被称作一条可行的回家路线，当且仅当它满足下列两个条件：\n\n1. $x_{s1} = 1$ , $y_{sk} = n$\n\n2. 对于所有 $j (1 \\leq j < k)$，满足 $y_{sj} = x_{s_{j+1}}$ 且 $q_{sj}\\leq p_{s_{j+1}}$\n\n对于该回家路线，小猫得到的烦躁值将为：\n\n$$q_{s_k}+(A\\times p_{s_1}^2+B\\times p_{s_1}+C)+\\sum_{j=1}^{k-1}(A(p_{s_{j+1}}-q_{s_j})^2+B(p_{s_{j+1}}-q_{s_j})+C)$$\n\n小猫想让自己的烦躁值尽量小，请你帮它求出所有可行的回家路线中，能得到的最小的烦躁值。题目保证至少存在一条可行的回家路线。", "inputFormat": "第一行五个整数 $n, m, A, B,C$，变量意义见题目描述。\n\n接下来 $m$ 行，第 $i$ 行四个整数 $x_i, y_i, p_i, q_i$，分别表示 $i$ 号列车的出发站、到达站、出发时刻与到达时刻。", "outputFormat": "输出仅一行一个整数，表示所求的答案。", "hint": "### 更多样例\n\n您可以通过附加文件获得更多样例。\n\n#### 样例 3\n\n见附加文件的 `route/route3.in` 与 `route/route3.ans`。\n\n该样例的数据类型与最终测试点 $5 \\sim 8$ 一致。\n\n#### 样例 4\n\n见附加文件的 `route/route4.in` 与 `route/route4.ans`。\n\n该样例的数据类型与最终测试点 $11 \\sim 14$ 一致。\n\n#### 样例 5\n\n见附加文件的 `route/route5.in` 与 `route/route5.ans`。\n\n该样例的数据类型与最终测试点 $18 \\sim 20$ 一致。\n\n### 样例 1 解释\n\n共有三条可行的回家路线：\n\n- 依次乘坐 1，4 号列车，得到的烦躁值为：$10 + (1 \\times 3^2 + 5 \\times 3 + 10) + (1 \\times (9 - 4)^2 + 5 \\times (9 - 4) + 10)= 104$\n- 依次乘坐 2，4 号列车，得到的烦躁值为：$10 + (1 \\times 5^2 + 5 \\times 5 + 10) + (1 \\times (9 - 7)^2 + 5 \\times (9 - 7) + 10)= 94$\n- 依次乘坐 3，4 号列车，得到的烦躁值为：$10 + (1 \\times 6^2 + 5 \\times 6 + 10) + (1 \\times (9 - 8)^2 + 5 \\times (9 - 8) + 10)= 102$\n\n第二条路线得到的烦躁值最小为 $94$。\n\n### 数据范围\n\n对于所有测试点：$2\\le n\\le 10^5,1\\le m\\le 2\\times 10^5,0 \\le A \\le 10 , 0 \\le B, C \\le 10^6,1 \\le x_i, y_i \\le n , x_i \\neq y_i , 0 \\le p_i < q_i \\le 10^3$。\n\n每个测试点的具体限制见下表：\n\n::cute-table{tuack}\n\n| 测试点编号  |        $n$         |          $m$          | $A,B,C$ 的特殊限制 | 其他特殊条件 |\n| :---------: | :----------------: | :-------------------: | :----------------: | :----------: |\n|  $1\\sim 2$  |     $\\le 100$      |        $=n-1$         |         无         | $y_i=x_i+1$  |\n|  $3\\sim 4$  |     ^      | $\\le 100$ |     $A=B=C=0$      | ^  |\n|  $5\\sim 8$  | $\\le 2\\times 10^3$ |  $\\le 4\\times 10^3$   |     ^              |  $x_i<y_i$   |\n|     $9$     | ^ |  ^   |      $A=B=0$       |  ^   |\n|    $10$     | ^ |  ^   |       $A=0$        |  ^   |\n| $11\\sim 14$ | ^ |  ^   |         无         |      无      |\n|    $15$     |     $\\le 10^5$     |  $\\le 2\\times 10^5$   |      $A=B=0$       |      ^      |\n| $16\\sim 17$ |     ^     |  ^   |       $A=0$        |      ^      |\n| $18\\sim 20$ |     ^     |  ^   |         无         |      ^      |", "locale": "zh-CN"}}}
