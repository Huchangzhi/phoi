{"pid": "P3695", "type": "P", "difficulty": 6, "samples": [["{ vars\n    a:int\n    b:int\n}\n\n:set a, 1\n:set b, 2\n:yosoro a+b\n", "3"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["模拟", "字符串", "洛谷原创", "O2优化", "洛谷月赛"], "title": "CYaRon!语", "background": "「千歌です」（我是千歌）、「曜です」（我是曜）、「ルビィです」（我是露比）、「3人合わせて、We are CYaRon！ よろしくね！」（三人在一起，我们是CYaRon！多多指教哦！）\n\n\nCYaRon!的三人在学习了编程之后，决定发明一种自己的编程语言，她们称为CYaRon!语。\n\n\n\n(ltt: 明明是我帮她们发明的。)\n\n可是，因为洛谷评测机这时候突然爆了，ltt没有时间再帮CYaRon!的三位小姐姐写CYaRon!语的解释器了。\n\n\n于是ltt就出了这样一道题，然后等着有人交了AC程序就偷走给小姐姐们。\n", "description": "以下是一个典型的CYaRon! 语程序。\n\n\n```cpp\n{ vars\n    chika:int\n    you:int\n    ruby:array[int, 1..2]\n    i:int\n}\n# 以上变量默认值均为0\n# 变量名只可是英文字母。\n\n# yosoro语句可以输出一个数字，随后跟一个空格。\n:yosoro 2\n# 输出2和一个空格(以下不再提到空格)。\n\n# set语句可以为变量赋值。\n# 运算符只支持加减号即可。\n:set chika, 1\n:set you, 2\n:yosoro chika + you\n# 上一条语句将输出3\n\n# 以下的判断语句均使用以下的格式：\n# 操作符，表达式，表达式\n# 例如eq, a, 1即C语言中 a==1\n# 所有操作符包括: lt: < gt: > le: <= ge: >= eq: == neq: !=\n\n# 日本来的CYaRon三人没法正确地发出if这个音，因此她们就改成了ihu。\n{ ihu eq, chika, 1\n    :set you, 3\n    :yosoro 1\n}\n# 输出1\n# 以上是ihu语句，无需支持else。\n\n# hor语句同理，\n# for i=1 to you如下\n{ hor i, 1, you\n    :yosoro i\n}\n# 输出1 2 3\n\n# 如下是while和数组的使用方法。\n:set i, 1\n{ while le, i, 2\n    :yosoro i\n    :set ruby[i], i+1\n    :yosoro ruby[i]\n    :set i, i+1\n}\n# 输出1 2 2 3\n\n# 数组不会出现嵌套，即只会有a[i]、a[i+2]而不会有类似于a[i+b[i]]这样的。\n\n# CYaRon语的最后一行，一定是一个换行。\n \n```\n\n你的任务是写一个CYaRon!语的解释器，实现输入CYaRon!语的程序，解释之执行后输出执行结果。\n", "inputFormat": "输入文件全部为CYaRon!语程序，最后一行保证是个空行。\n\n请处理输入的时候，一直读到EOF为止。\n", "outputFormat": "该CYaRon!语程序的执行结果。\n\n具体上，是该CYaRon!语程序所有:yosoro语句的输出。\n", "hint": "对数据做出以下保证：\n\n1. 输入数据一定是合法的CYaRon!语程序，不包含注释，代码、缩进风格 （四个空格）与上述样例相同。**但不保证逗号、运算符前面的空格数量和有无一定相同**。\n\n2. 变量名在10个字符以下，仅包含小写英文，数组最大大小为1000，变量最多50个，所有表达式的运算结果，包括变量的值一定在int范围内。 （但数组可能是类似于[2001..3000]的，下标可能范围为0到1亿）\n\n3. 所有指令小写。\n\n4. 该程序一定能够在合理的时间、内存限制内执行完毕。\n\n5. hor语句执行过程中，循环变量、初始值、结束值不会被循环中的代码改变。\n\n6. **该程序最多500行**\n\n![](https://cdn.luogu.com.cn/upload/pic/4595.png)\n", "locale": "zh-CN", "translations": {"en": {"title": "CYaRon! Language", "background": "「千歌です」 (I am Chika), 「曜です」 (I am You), 「ルビィです」 (I am Ruby), 「3人合わせて、We are CYaRon！ よろしくね！」 (Together we are CYaRon! Nice to meet you!).\n\nAfter learning programming, the three members of CYaRon! decided to invent their own programming language, which they call the CYaRon! language.\n\n(ltt: Clearly I was the one who invented it for them.)\n\nHowever, because the Luogu judge suddenly exploded at this time, ltt did not have time to help the three young ladies of CYaRon! write an interpreter for the CYaRon! language.\n\nSo ltt made this problem and is waiting to steal an AC submission to give to the young ladies.", "description": "Below is a typical CYaRon! language program.\n\n```cpp\n{ vars\n    chika:int\n    you:int\n    ruby:array[int, 1..2]\n    i:int\n}\n# All the above variables have a default value of 0.\n# Variable names can only be English letters.\n\n# The yosoro statement outputs a number followed by a space.\n:yosoro 2\n# Outputs 2 and a space (we will no longer mention the space below).\n\n# The set statement assigns a value to a variable.\n# Only addition and subtraction operators are supported.\n:set chika, 1\n:set you, 2\n:yosoro chika + you\n# The previous statement outputs 3.\n\n# The following conditional statements all use this format:\n# operator, expression, expression\n# For example, eq, a, 1 means a == 1 in the C language.\n# All operators include: lt: < gt: > le: <= ge: >= eq: == neq: !=\n\n# The three from Japan cannot pronounce \"if\" correctly, so they changed it to \"ihu\".\n{ ihu eq, chika, 1\n    :set you, 3\n    :yosoro 1\n}\n# Outputs 1.\n# The above is an ihu statement; else is not required.\n\n# The hor statement is similar,\n# it corresponds to: for i = 1 to you\n{ hor i, 1, you\n    :yosoro i\n}\n# Outputs 1 2 3\n\n# Below is how to use while and arrays.\n:set i, 1\n{ while le, i, 2\n    :yosoro i\n    :set ruby[i], i+1\n    :yosoro ruby[i]\n    :set i, i+1\n}\n# Outputs 1 2 2 3\n\n# Arrays will not be nested, i.e., you will only have a[i], a[i+2], and not something like a[i + b[i]].\n\n# The last line of a CYaRon! program must be a newline.\n \n```\n\nYour task is to write an interpreter for the CYaRon! language. Read a CYaRon! program from input, execute it by interpretation, and output the execution result.", "inputFormat": "The input file is entirely a CYaRon! language program, and the last line is guaranteed to be an empty line.\n\nWhen reading the input, keep reading until EOF.", "outputFormat": "The execution result of the CYaRon! language program.\n\nSpecifically, it is the outputs of all :yosoro statements in the program.", "hint": "We guarantee the following about the testdata:\n\n1. The input is guaranteed to be a valid CYaRon! language program, without comments. The code style and indentation (four spaces) match the sample above. However, the number and presence of spaces before commas and operators are not guaranteed to be the same.\n\n2. Variable names are fewer than 10 characters and contain only lowercase English letters. The maximum array size is 1000. The maximum number of variables is 50. The result of every expression, including variable values, is guaranteed to fit in the int range. (However, arrays may have ranges like [2001..3000], and indices may range from 0 up to 1e8.)\n\n3. All instructions are lowercase.\n\n4. The program is guaranteed to finish within reasonable time and memory limits.\n\n5. During the execution of a hor statement, the loop variable, the initial value, and the end value will not be changed by the code inside the loop.\n\n6. The program has at most 500 lines.\n\n![](https://cdn.luogu.com.cn/upload/pic/4595.png)\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "CYaRon!语", "background": "「千歌です」（我是千歌）、「曜です」（我是曜）、「ルビィです」（我是露比）、「3人合わせて、We are CYaRon！ よろしくね！」（三人在一起，我们是CYaRon！多多指教哦！）\n\n\nCYaRon!的三人在学习了编程之后，决定发明一种自己的编程语言，她们称为CYaRon!语。\n\n\n\n(ltt: 明明是我帮她们发明的。)\n\n可是，因为洛谷评测机这时候突然爆了，ltt没有时间再帮CYaRon!的三位小姐姐写CYaRon!语的解释器了。\n\n\n于是ltt就出了这样一道题，然后等着有人交了AC程序就偷走给小姐姐们。\n", "description": "以下是一个典型的CYaRon! 语程序。\n\n\n```cpp\n{ vars\n    chika:int\n    you:int\n    ruby:array[int, 1..2]\n    i:int\n}\n# 以上变量默认值均为0\n# 变量名只可是英文字母。\n\n# yosoro语句可以输出一个数字，随后跟一个空格。\n:yosoro 2\n# 输出2和一个空格(以下不再提到空格)。\n\n# set语句可以为变量赋值。\n# 运算符只支持加减号即可。\n:set chika, 1\n:set you, 2\n:yosoro chika + you\n# 上一条语句将输出3\n\n# 以下的判断语句均使用以下的格式：\n# 操作符，表达式，表达式\n# 例如eq, a, 1即C语言中 a==1\n# 所有操作符包括: lt: < gt: > le: <= ge: >= eq: == neq: !=\n\n# 日本来的CYaRon三人没法正确地发出if这个音，因此她们就改成了ihu。\n{ ihu eq, chika, 1\n    :set you, 3\n    :yosoro 1\n}\n# 输出1\n# 以上是ihu语句，无需支持else。\n\n# hor语句同理，\n# for i=1 to you如下\n{ hor i, 1, you\n    :yosoro i\n}\n# 输出1 2 3\n\n# 如下是while和数组的使用方法。\n:set i, 1\n{ while le, i, 2\n    :yosoro i\n    :set ruby[i], i+1\n    :yosoro ruby[i]\n    :set i, i+1\n}\n# 输出1 2 2 3\n\n# 数组不会出现嵌套，即只会有a[i]、a[i+2]而不会有类似于a[i+b[i]]这样的。\n\n# CYaRon语的最后一行，一定是一个换行。\n \n```\n\n你的任务是写一个CYaRon!语的解释器，实现输入CYaRon!语的程序，解释之执行后输出执行结果。\n", "inputFormat": "输入文件全部为CYaRon!语程序，最后一行保证是个空行。\n\n请处理输入的时候，一直读到EOF为止。\n", "outputFormat": "该CYaRon!语程序的执行结果。\n\n具体上，是该CYaRon!语程序所有:yosoro语句的输出。\n", "hint": "对数据做出以下保证：\n\n1. 输入数据一定是合法的CYaRon!语程序，不包含注释，代码、缩进风格 （四个空格）与上述样例相同。**但不保证逗号、运算符前面的空格数量和有无一定相同**。\n\n2. 变量名在10个字符以下，仅包含小写英文，数组最大大小为1000，变量最多50个，所有表达式的运算结果，包括变量的值一定在int范围内。 （但数组可能是类似于[2001..3000]的，下标可能范围为0到1亿）\n\n3. 所有指令小写。\n\n4. 该程序一定能够在合理的时间、内存限制内执行完毕。\n\n5. hor语句执行过程中，循环变量、初始值、结束值不会被循环中的代码改变。\n\n6. **该程序最多500行**\n\n![](https://cdn.luogu.com.cn/upload/pic/4595.png)\n", "locale": "zh-CN"}}}
{"pid": "P3696", "type": "P", "difficulty": 6, "samples": [["3\n3 500\n2 200\n1 100\n1 1000\n3 700\n3 400", "1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["贪心", "排序", "洛谷月赛"], "title": "Bushiroad的偶像派对", "background": "Bushiroad又叫不许摸。\n", "description": "Bushiroad的派对有N个校园偶像团体，可能来自编号1-N的学校。每个学校可能有多个团体参加，也有可能没有团体参加。在所有的团体都演出完后，进行人气投票。\n\n我们已经掌握了中场时和结束时的两张人气排行表。给出排行表从人气高到低排序，并给出每个组的学校编号（你却不知道具体是哪个团体）\n\n可是，结束时的表是不太准确的。因为基于这样的一个事实：某个团体的结束时的人气不会低于中场的人气，而且每个团体的学校不会改变。结束的表产生一些矛盾。\n\n负责统计的人为了不想背锅，希望尽可能少修改结束时的排行表的某些团体的学校（人气值不能改），使其不矛盾，请问至少要修改多少个呢？\n", "inputFormat": "第一行一个整数N，表示有N个团体。\n\n接下来N行，每行两个整数，$Ta_i, Pa_i$，表示中场时的人气值排行，$Ta_i$表示学校名。$Pa_i$表示人气值，按照人气值高往低排列。\n\n接下来N行，每行两个整数，$Tb_i, Pb_i$，表示结束时的人气值排行。\n", "outputFormat": "一个整数表示答案。\n", "hint": "【数据范围】\n\n对于20%的数据， $N\\le16$，时限0.5s。\n\n对于40%的数据， $N\\le50$，时限0.5s。\n\n对于70%的数据， $N\\le5000$，时限1s。\n\n对于全部测试数据， $N\\le200000, A\\le10^9$。最后3个点时限3s。\n", "locale": "zh-CN", "translations": {"en": {"title": "Bushiroad's Idol Party", "background": "Bushiroad is also called \"bu xu mo\".", "description": "There are $N$ school idol groups, possibly from schools numbered $1$ to $N$. Each school may have multiple groups participating, or none. After all groups finish performing, a popularity vote is held.\n\nWe have two popularity rankings: one at halftime and one at the end. Each ranking is sorted from higher to lower popularity, and shows each group's school ID (but you do not know which specific group).\n\nHowever, the final ranking is not quite correct. Based on the facts that a group's final popularity is not lower than its halftime popularity, and a group's school does not change, the final ranking produces contradictions.\n\nThe statistician, trying to avoid blame, wants to modify as few school IDs in the final ranking as possible (popularity values cannot be changed) to eliminate contradictions. What is the minimum number of modifications?", "inputFormat": "- The first line contains an integer $N$, the number of groups.\n- The next $N$ lines each contain two integers, $Ta_i, Pa_i$, representing the halftime popularity ranking. $Ta_i$ is the school ID, and $Pa_i$ is the popularity value. These lines are sorted in descending order by popularity.\n- The next $N$ lines each contain two integers, $Tb_i, Pb_i$, representing the final popularity ranking. These lines are also sorted in descending order by popularity.", "outputFormat": "Output a single integer: the answer.", "hint": "Constraints\n\n- For 20% of the testdata, $N \\le 16$, time limit 0.5 s.\n- For 40% of the testdata, $N \\le 50$, time limit 1 s.\n- For 70% of the testdata, $N \\le 5000$, time limit 1 s.\n- For all testdata, $N \\le 200000$, and all popularity values are $\\le 10^9$. The last 3 test points have a 3 s time limit.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "Bushiroad的偶像派对", "background": "Bushiroad又叫不许摸。\n", "description": "Bushiroad的派对有N个校园偶像团体，可能来自编号1-N的学校。每个学校可能有多个团体参加，也有可能没有团体参加。在所有的团体都演出完后，进行人气投票。\n\n我们已经掌握了中场时和结束时的两张人气排行表。给出排行表从人气高到低排序，并给出每个组的学校编号（你却不知道具体是哪个团体）\n\n可是，结束时的表是不太准确的。因为基于这样的一个事实：某个团体的结束时的人气不会低于中场的人气，而且每个团体的学校不会改变。结束的表产生一些矛盾。\n\n负责统计的人为了不想背锅，希望尽可能少修改结束时的排行表的某些团体的学校（人气值不能改），使其不矛盾，请问至少要修改多少个呢？\n", "inputFormat": "第一行一个整数N，表示有N个团体。\n\n接下来N行，每行两个整数，$Ta_i, Pa_i$，表示中场时的人气值排行，$Ta_i$表示学校名。$Pa_i$表示人气值，按照人气值高往低排列。\n\n接下来N行，每行两个整数，$Tb_i, Pb_i$，表示结束时的人气值排行。\n", "outputFormat": "一个整数表示答案。\n", "hint": "【数据范围】\n\n对于20%的数据， $N\\le16$，时限0.5s。\n\n对于40%的数据， $N\\le50$，时限0.5s。\n\n对于70%的数据， $N\\le5000$，时限1s。\n\n对于全部测试数据， $N\\le200000, A\\le10^9$。最后3个点时限3s。\n", "locale": "zh-CN"}}}
{"pid": "P3697", "type": "P", "difficulty": 5, "samples": [["10 3 5\n10 3 5\n30\n1\n6\n10\n", "8\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["贪心", "优先队列", "洛谷月赛"], "title": "开心派对小火车", "background": null, "description": "Aqours 铁路公司旗下有 $N$ 个站，编号 $1,2,\\dots,N$。\n\n有各停（各站停车）电车特急电车两种。特急车会在 $S_1,S_2,...,S_M (1=S_1<S_2 <...<S_M=N)$，一共 $M$ 个车站停车。\n\n相邻的两站 (即编号为 $i$ 的车站和编号为 $i+1$ 的车站，而不是特急电车停车的相邻的两站) 之间，各停电车要运行 $A$ 分钟，特急需要 $B$ 分钟。我们认为列车一直匀速运行，不考虑停车和加减速。\n\n现在要加一种快速电车，要求其停站覆盖所有的特急电车的停站，而相邻的两站要运行 $C$ 分钟。为了要快，决定刚好停 $K$ 个站（$K>M$，包括特急的所有车站）。如果一个站可以停多种电车，那么旅客可以在这一站换乘。不过只能向前坐车，不能往回坐。\n\n你需要设计一种快速列车的设站方案，要求旅客在 $T$ 分钟**乘车时间（等车和换乘时间不计）** 内，可以从 $1$ 号站到尽可能多数量的站。你只需要告知能有几站可以达到。", "inputFormat": "第一行 $3$ 个整数，$N$，$M$，$K$，其意义已经在描述中给出。\n\n第二行 $3$ 个整数，$A$，$B$，$C$，其意义也已经在描述中给出。\n\n第三行 $1$ 个整数 $T$，表示乘车时间。\n\n接下来 $M$ 行，每行一个整数。其中第 $i$ 个整数为 $S_i$。", "outputFormat": "一个整数，表示限定时间内能够达到的最多站的数量。", "hint": "【样例解释】\n\n可以设快速列车站为 1/5/6/8/10。\n\n2,3,4 可以直接乘坐各停慢车，5 可以乘坐快速列车，6,10 可以乘坐特急列车，7 可以到 6 转慢车，8 可以到 6 传快速列车。9 没办法在 30 分钟的乘车时间内到达。\n\n【数据范围】\n\n对于 $20\\%$ 的数据，$N \\le 300, K-M=2, A \\le 10^6 , T \\le 10^9$\n\n对于 $50\\%$ 的数据，$N \\le 1000$\n\n对于 $100\\%$ 的数据，$2 \\le N \\le 10^9, 2 \\le M \\le K \\le 3000, 1 \\le B < C < A \\le 10^9, i \\le T \\le 10^{18}$", "locale": "zh-CN", "translations": {"en": {"title": "Happy Party Little Train", "background": "", "description": "Aqours Railway Company has $N$ stations, numbered 1, 2, ..., $N$.\n\nThere are two types of trains: Local (stops at every station) and Express. The express train stops at $S_1, S_2, ..., S_M$ ($1 = S_1 < S_2 < ... < S_M = N$), for a total of $M$ stations.\n\nBetween two adjacent stations (i.e., the station numbered $i$ and the station numbered $i+1$, not two consecutive express stops), the local takes $A$ minutes and the express takes $B$ minutes. We assume trains run at constant speed, ignoring dwell times and acceleration/deceleration.\n\nNow we add a new Rapid train. It must include all express stops among its stops, and it takes $C$ minutes to travel between two adjacent stations. To be faster, it will stop at exactly $K$ stations ($K > M$), including all express stations. If a station is served by multiple train types, passengers can transfer at that station. However, they can only travel forward, not backward.\n\nYou need to design a stopping pattern for the rapid train so that, within $T$ minutes of in-train time (waiting and transfer times are not counted), a passenger starting from station 1 can reach as many stations as possible. You only need to report how many stations can be reached.", "inputFormat": "The first line contains three integers $N$, $M$, $K$, as described above.\n\nThe second line contains three integers $A$, $B$, $C$, as described above.\n\nThe third line contains one integer $T$, the riding time.\n\nThen $M$ lines follow, each containing one integer. The $i$-th integer is $S_i$.", "outputFormat": "Output a single integer, the maximum number of stations that can be reached within the time limit.", "hint": "[Sample explanation]\n\nYou can set the rapid stops to be 1/5/6/8/10.\n\nStations 2, 3, 4 can be reached directly by taking the local. Station 5 can be reached by taking the rapid. Stations 6 and 10 can be reached by taking the express. Station 7 can be reached by transferring at 6 to the local, and station 8 can be reached by transferring at 6 to the rapid. Station 9 cannot be reached within 30 minutes of riding time.\n\nConstraints\n\n- For 20% of the testdata, $N \\le 300$, $K - M = 2$, $A \\le 10^6$, $T \\le 10^9$.\n- For 50% of the testdata, $N \\le 1000$.\n- For 100% of the testdata, $2 \\le N \\le 10^9$, $2 \\le M \\le K \\le 3000$, $1 \\le B < C < A \\le 10^9$, $1 \\le T \\le 10^{18}$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "开心派对小火车", "background": null, "description": "Aqours 铁路公司旗下有 $N$ 个站，编号 $1,2,\\dots,N$。\n\n有各停（各站停车）电车特急电车两种。特急车会在 $S_1,S_2,...,S_M (1=S_1<S_2 <...<S_M=N)$，一共 $M$ 个车站停车。\n\n相邻的两站 (即编号为 $i$ 的车站和编号为 $i+1$ 的车站，而不是特急电车停车的相邻的两站) 之间，各停电车要运行 $A$ 分钟，特急需要 $B$ 分钟。我们认为列车一直匀速运行，不考虑停车和加减速。\n\n现在要加一种快速电车，要求其停站覆盖所有的特急电车的停站，而相邻的两站要运行 $C$ 分钟。为了要快，决定刚好停 $K$ 个站（$K>M$，包括特急的所有车站）。如果一个站可以停多种电车，那么旅客可以在这一站换乘。不过只能向前坐车，不能往回坐。\n\n你需要设计一种快速列车的设站方案，要求旅客在 $T$ 分钟**乘车时间（等车和换乘时间不计）** 内，可以从 $1$ 号站到尽可能多数量的站。你只需要告知能有几站可以达到。", "inputFormat": "第一行 $3$ 个整数，$N$，$M$，$K$，其意义已经在描述中给出。\n\n第二行 $3$ 个整数，$A$，$B$，$C$，其意义也已经在描述中给出。\n\n第三行 $1$ 个整数 $T$，表示乘车时间。\n\n接下来 $M$ 行，每行一个整数。其中第 $i$ 个整数为 $S_i$。", "outputFormat": "一个整数，表示限定时间内能够达到的最多站的数量。", "hint": "【样例解释】\n\n可以设快速列车站为 1/5/6/8/10。\n\n2,3,4 可以直接乘坐各停慢车，5 可以乘坐快速列车，6,10 可以乘坐特急列车，7 可以到 6 转慢车，8 可以到 6 传快速列车。9 没办法在 30 分钟的乘车时间内到达。\n\n【数据范围】\n\n对于 $20\\%$ 的数据，$N \\le 300, K-M=2, A \\le 10^6 , T \\le 10^9$\n\n对于 $50\\%$ 的数据，$N \\le 1000$\n\n对于 $100\\%$ 的数据，$2 \\le N \\le 10^9, 2 \\le M \\le K \\le 3000, 1 \\le B < C < A \\le 10^9, i \\le T \\le 10^{18}$", "locale": "zh-CN"}}}
{"pid": "P3698", "type": "P", "difficulty": 4, "samples": [["5 2\n1 0\n2 1\n3 2\n4 3", "3"], ["9 5\n0 1\n0 2\n2 6\n4 2\n8 1\n1 3\n3 7\n3 5", "5"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["动态规划 DP", "贪心", "2017", "重庆", "各省省选", "枚举", "背包 DP", "连通块"], "title": "[CQOI2017] 小Q的棋盘", "background": null, "description": "小 Q 正在设计一种棋类游戏。\n\n在小 Q 设计的游戏中，棋子可以放在棋盘上的格点中。某些格点之间有连线，棋子只能在有连线的格点之间移动。整个棋盘上共有 $V$ 个格点，编号为 $0,1,2,\\cdots, V- 1$，它们是连通的，也就是说棋子从任意格点出发，总能到达所有的格点。小 Q 在设计棋盘时，还保证棋子从一个格点移动到另外任一格点的路径是唯一的。\n\n小 Q 现在想知道，当棋子从格点 $0$ 出发，移动 $N$ 步最多能经过多少格点。格点可以重复经过多次，但不重复计数。", "inputFormat": "第一行包含 $2$ 个正整数 $V, N$，其中 $V$ 表示格点总数，$N$ 表示移动步数。\n\n接下来 $V-1$ 行，每行两个数 $a_i,b_i$，表示编号为 $a_i,b_i$ 的两个格点之间有连线。", "outputFormat": "输出一行一个整数，表示最多经过的格点数量。", "hint": "【输入输出样例 1 说明】\n\n从格点 $0$ 出发移动 $2$ 步。经过 $0, 1, 2$ 这 $3$ 个格点。\n\n【输入输出样例 2 说明】\n\n一种可行的移动路径为 $0 \\to 1 \\to 3 \\to 5 \\to 3 \\to 7$，经过 $0, 1, 3, 5, 7$ 这 $5$ 个格点。\n\n【数据规模与约定】\n\n对于 $100\\%$ 的测试点，$1\\le N,V \\le 100$，$0 \\le a_i,b_i< V$。", "locale": "zh-CN", "translations": {"en": {"title": "[CQOI2017] Xiao Q's Chessboard", "background": "", "description": "Xiao Q is designing a board game.\n\nIn the game he designed, pieces can be placed on the grid points on the board. Some pairs of grid points are connected by lines, and a piece may move only between grid points that are connected by a line. There are $V$ grid points in total, labeled $0, 1, 2, \\cdots, V - 1$, and they are connected; that is, starting from any grid point, the piece can reach all grid points. Xiao Q also guarantees that the path between any two grid points is unique.\n\nXiao Q now wants to know: starting from grid point $0$, after moving $N$ steps, what is the maximum number of grid points that can be visited? A grid point may be visited multiple times, but is counted only once.", "inputFormat": "The first line contains $2$ positive integers $V, N$, where $V$ is the total number of grid points and $N$ is the number of moves.\n\nEach of the next $V - 1$ lines contains two integers $a_i, b_i$, indicating that there is a line connecting grid points $a_i$ and $b_i$.", "outputFormat": "Output a single integer, the maximum number of grid points that can be visited.", "hint": "[Explanation for Sample 1]\n\nFrom grid point $0$, move $2$ steps. The piece visits $0, 1, 2$, i.e., $3$ grid points.\n\n[Explanation for Sample 2]\n\nOne feasible path is $0 \\to 1 \\to 3 \\to 5 \\to 3 \\to 7$, visiting $0, 1, 3, 5, 7$, i.e., $5$ grid points.\n\nConstraints\n\nFor $100\\%$ of the testdata, $1 \\le N, V \\le 100$, and $0 \\le a_i, b_i < V$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[CQOI2017] 小Q的棋盘", "background": null, "description": "小 Q 正在设计一种棋类游戏。\n\n在小 Q 设计的游戏中，棋子可以放在棋盘上的格点中。某些格点之间有连线，棋子只能在有连线的格点之间移动。整个棋盘上共有 $V$ 个格点，编号为 $0,1,2,\\cdots, V- 1$，它们是连通的，也就是说棋子从任意格点出发，总能到达所有的格点。小 Q 在设计棋盘时，还保证棋子从一个格点移动到另外任一格点的路径是唯一的。\n\n小 Q 现在想知道，当棋子从格点 $0$ 出发，移动 $N$ 步最多能经过多少格点。格点可以重复经过多次，但不重复计数。", "inputFormat": "第一行包含 $2$ 个正整数 $V, N$，其中 $V$ 表示格点总数，$N$ 表示移动步数。\n\n接下来 $V-1$ 行，每行两个数 $a_i,b_i$，表示编号为 $a_i,b_i$ 的两个格点之间有连线。", "outputFormat": "输出一行一个整数，表示最多经过的格点数量。", "hint": "【输入输出样例 1 说明】\n\n从格点 $0$ 出发移动 $2$ 步。经过 $0, 1, 2$ 这 $3$ 个格点。\n\n【输入输出样例 2 说明】\n\n一种可行的移动路径为 $0 \\to 1 \\to 3 \\to 5 \\to 3 \\to 7$，经过 $0, 1, 3, 5, 7$ 这 $5$ 个格点。\n\n【数据规模与约定】\n\n对于 $100\\%$ 的测试点，$1\\le N,V \\le 100$，$0 \\le a_i,b_i< V$。", "locale": "zh-CN"}}}
{"pid": "P3699", "type": "P", "difficulty": 7, "samples": [["3 0\n0 0\n2 0\n2 2", "3"], ["3 1\n0 0\n2 0\n2 2\n1 0 1 1 2 1", "0"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2017", "重庆", "各省省选"], "title": "[CQOI2017] 小Q的草稿", "background": null, "description": "Q 是个程序员。\n\n众所周知，程序员在写程序的时候经常需要草稿纸。小 Q 现在需要一张草稿纸用来画图，但是桌上只有一张草稿纸，而且是一张被用过很多次的草稿纸。\n\n草稿纸可以看作一个二维平面，小 Q 甚至已经给它建立了直角坐标系。以前每一次草稿使用过的区域，都可以近似的看作一个平面上的一个三角形，这个三角形区域的内部和边界都不能再使用。当然了，以前的草稿也没有出现区域重叠的情况。\n\n小 Q 已经在草稿纸上画上了一些关键点，这些关键点都在没使用过的区域。小 Q 想把这些关键点两两之间尽可能的用线段连接起来。连接两个关键点的线段有可能会穿过已经用过的草稿区域，这样显然不允许。于是小 Q 就想知道，有多少对关键点可以被线段连接起来，而且还不会穿过已经用过的区域。为了方便，小 Q 保证任意三个关键点不会共线。", "inputFormat": "第一行包含两个整数 $V, T$，表示草稿纸上的关键点数量和三角形区域数量。\n\n接下来 $V$ 行，每行两个整数 $x, y$，表示一个关键点的坐标 $(x,y)$。\n\n接下来 $T$ 行，每行六个整数 $x_1,y_1,x_2,y_2,x_3,y_3$，表示一个三角形区域的三个顶点坐标分别是 $(x_1,y_1),(x_2,y_2),(x_3,y_3)$，保证三角形的面积大于 $0$。", "outputFormat": "输出一行，一个整数，表示能够被线段连接起来的关键点有多少对。", "hint": "【输入输出样例 1 说明】\n\n整个草稿纸是全新的，任意两个关键点都可以连线。\n\n【输入输出样例 2 说明】\n\n如图所示，任意两个关键点的连线都被挡住了。\n\n ![](https://cdn.luogu.com.cn/upload/pic/5011.png) \n\n【数据规模与约定】\n\n对于 $100\\%$ 的测试点，$0 \\le x,y,x_1,y_1,x_2,y_2,x_3,y_3 \\le 10^8$，且都是整数。\n\n|测试点编号|$V\\le$|$T\\le$|\n|:-:|:-:|:-:|\n|$1$|$10$|$10$|\n|$2$|$20$|$20$|\n|$3$|$50$|$50$|\n|$4$|$100$|$100$|\n|$5$|$200$|$200$|\n|$6$|$400$|$400$|\n|$7$|$600$|$600$|\n|$8\\sim10$|$1000$|$1000$|", "locale": "zh-CN", "translations": {"en": {"title": "[CQOI2017] Xiao Q's Scratch Paper", "background": "", "description": "Q is a programmer.\n\nAs we all know, programmers often need scratch paper when writing programs. Xiao Q now needs a sheet of scratch paper to draw a figure, but there is only one sheet on the desk, and it has already been used many times.\n\nWe can regard the scratch paper as a 2D plane, and Xiao Q has even set up a Cartesian coordinate system on it. Each previously used region can be approximated as a triangle on the plane. The interior and boundary of such a triangular region cannot be used again. Also, previously used regions do not overlap.\n\nXiao Q has already marked several key points on the scratch paper, all lying in unused regions. He wants to connect as many pairs of these key points as possible with straight segments. A segment connecting two key points may pass through an already used triangular region, which is not allowed. Therefore, Xiao Q wants to know how many pairs of key points can be connected by a straight segment without intersecting the interior or boundary of any used triangular region. For convenience, it is guaranteed that no three key points are collinear.", "inputFormat": "The first line contains two integers V, T, denoting the number of key points and the number of triangular regions on the scratch paper.\n\nThe next V lines each contain two integers x, y, representing the coordinates of a key point $(x, y)$.\n\nThen T lines follow. Each line contains six integers $x_1, y_1, x_2, y_2, x_3, y_3$, indicating that the three vertices of a triangular region are $(x_1, y_1)$, $(x_2, y_2)$, $(x_3, y_3)$, and the area of the triangle is greater than $0$.", "outputFormat": "Output one line with a single integer, the number of pairs of key points that can be connected by a straight segment without intersecting any used triangular region.", "hint": "[Explanation for Sample 1]\n\nThe entire scratch paper is unused, so any two key points can be connected.\n\n[Explanation for Sample 2]\n\nAs shown in the figure, the segment between any two key points is blocked.\n\n![](https://cdn.luogu.com.cn/upload/pic/5011.png)\n\nConstraints\n\nFor 100% of the test points, all coordinates are integers and satisfy $0 \\le  \\text{coordinate} \\le 10^8$.\n\n```cpp\nNO 1  2  3   4   5   6   7    8    9   10\nV 10 20 50 100 200 400 600 1000 1000 1000\nT 10 20 50 100 200 400 600 1000 1000 1000\n```\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[CQOI2017] 小Q的草稿", "background": null, "description": "Q 是个程序员。\n\n众所周知，程序员在写程序的时候经常需要草稿纸。小 Q 现在需要一张草稿纸用来画图，但是桌上只有一张草稿纸，而且是一张被用过很多次的草稿纸。\n\n草稿纸可以看作一个二维平面，小 Q 甚至已经给它建立了直角坐标系。以前每一次草稿使用过的区域，都可以近似的看作一个平面上的一个三角形，这个三角形区域的内部和边界都不能再使用。当然了，以前的草稿也没有出现区域重叠的情况。\n\n小 Q 已经在草稿纸上画上了一些关键点，这些关键点都在没使用过的区域。小 Q 想把这些关键点两两之间尽可能的用线段连接起来。连接两个关键点的线段有可能会穿过已经用过的草稿区域，这样显然不允许。于是小 Q 就想知道，有多少对关键点可以被线段连接起来，而且还不会穿过已经用过的区域。为了方便，小 Q 保证任意三个关键点不会共线。", "inputFormat": "第一行包含两个整数 $V, T$，表示草稿纸上的关键点数量和三角形区域数量。\n\n接下来 $V$ 行，每行两个整数 $x, y$，表示一个关键点的坐标 $(x,y)$。\n\n接下来 $T$ 行，每行六个整数 $x_1,y_1,x_2,y_2,x_3,y_3$，表示一个三角形区域的三个顶点坐标分别是 $(x_1,y_1),(x_2,y_2),(x_3,y_3)$，保证三角形的面积大于 $0$。", "outputFormat": "输出一行，一个整数，表示能够被线段连接起来的关键点有多少对。", "hint": "【输入输出样例 1 说明】\n\n整个草稿纸是全新的，任意两个关键点都可以连线。\n\n【输入输出样例 2 说明】\n\n如图所示，任意两个关键点的连线都被挡住了。\n\n ![](https://cdn.luogu.com.cn/upload/pic/5011.png) \n\n【数据规模与约定】\n\n对于 $100\\%$ 的测试点，$0 \\le x,y,x_1,y_1,x_2,y_2,x_3,y_3 \\le 10^8$，且都是整数。\n\n|测试点编号|$V\\le$|$T\\le$|\n|:-:|:-:|:-:|\n|$1$|$10$|$10$|\n|$2$|$20$|$20$|\n|$3$|$50$|$50$|\n|$4$|$100$|$100$|\n|$5$|$200$|$200$|\n|$6$|$400$|$400$|\n|$7$|$600$|$600$|\n|$8\\sim10$|$1000$|$1000$|", "locale": "zh-CN"}}}
{"pid": "P3700", "type": "P", "difficulty": 7, "samples": [["3 3\n1 1 1 2\n2 2 4 3\n1 2 4 2\n", "9\n36\n14\n"], ["4 125\n1 2 4 8\n1 3 9 27\n1 4 16 64\n1 5 25 125\n", "2073\n316642\n12157159\n213336861\n"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2017", "重庆", "各省省选", "数论", "最大公约数 gcd", "莫比乌斯反演", "分块"], "title": "[CQOI2017] 小 Q 的表格", "background": "", "description": "小 Q 是个程序员。\n\n作为一个年轻的程序员，小 Q 总是被老 C 欺负，老 C 经常把一些麻烦的任务交给小 Q 来处理。每当小 Q 不知道如何解决时，就只好向你求助。\n\n为了完成任务，小 Q 需要列一个表格，表格有无穷多行，无穷多列，行和列都从 $1$ 开始标号。为了完成任务，表格里面每个格子都填了一个整数，为了方便描述，小 Q 把第 $a$ 行第 $b$ 列的整数记为 $f(a, b)$。为了完成任务，这个表格要满足一些条件：\n\n1. 对任意的正整数 $a, b$，都要满足 $f(a, b) = f(b, a)$；\n2. 对任意的正整数 $a, b$，都要满足 $b \\times f(a, a + b) = (a + b) \\times f(a, b)$。\n\n为了完成任务，一开始表格里面的数很有规律，第 $a$ 行第 $b$ 列的数恰好等于 $a \\times b$，显然一开始是满足上述两个条件的。为了完成任务，小 Q 需要不断的修改表格里面的数，每当修改了一个格子的数之后，为了让表格继续满足上述两个条件，小 Q 还需要把这次修改能够波及到的全部格子里都改为恰当的数。由于某种神奇的力量驱使，已经确保了每一轮修改之后所有格子里的数仍然都是整数。为了完成任务，小 Q 还需要随时获取前 $k$ 行前 $k$ 列这个有限区域内所有数的和是多少，答案可能比较大，只需要算出答案 ${} \\bmod 1,000,000,007$ 之后的结果。", "inputFormat": "输入文件第一行包含两个整数 $m, n$，表示共有 $m$ 次操作，所有操作和查询涉及到的行编号和列编号都不超过 $n$。\n\n接下来 $m$ 行，每行四个整数 $a, b, x, k$，表示把第 $a$ 行 $b$ 列的数改成 $x$，然后把它能够波及到的所有格子全部修改，保证修改之后所有格子的数仍然都是整数，修改完成后计算前 $k$ 行前 $k$ 列里所有数的和。", "outputFormat": "输出共 $m$ 行，每次操作之后输出一行，表示答案 ${} \\bmod 1,000,000,007$ 之后的结果。", "hint": "**【样例解释 #1】**\n\n一开始，表格的前 $3$ 行前 $3$ 列如图中左边所示。前 $2$ 次操作后表格没有变化，第 $3$ 次操作之后的表格如右边所示。\n\n```cpp\n1 2 3     2  4  6\n2 4 6     4  4 12\n3 6 9     6 12  9\n```\n\n**【数据范围】**\n\n对于 $100 \\%$ 的测试点，$1 \\le m \\le {10}^4$，$1 \\le a, b, k \\le n \\le 4 \\times {10}^6$，$0 \\le x \\le {10}^{18}$。\n\n![](https://cdn.luogu.com.cn/upload/pic/5012.png)\n", "locale": "zh-CN", "translations": {"en": {"title": "[CQOI2017] Xiao Q's Table", "background": "", "description": "Xiao Q is a programmer.\n\nAs a young programmer, Xiao Q is always bullied by old C, who often assigns him troublesome tasks. Whenever Xiao Q does not know how to solve them, he has to ask you for help.\n\nTo complete the task, Xiao Q needs to make a table with infinitely many rows and infinitely many columns, both indexed starting from $1$. Every cell in the table contains an integer. For convenience, Xiao Q denotes the integer in row $a$, column $b$ as $f(a, b)$. The table must satisfy the following conditions:\n\n1. For any positive integers $a, b$, it must hold that $f(a, b) = f(b, a)$.\n2. For any positive integers $a, b$, it must hold that $b \\times f(a, a + b) = (a + b) \\times f(a, b)$.\n\nInitially, the numbers in the table are very regular: the number in row $a$, column $b$ is exactly $a \\times b$, which obviously satisfies the two conditions above. To complete the task, Xiao Q will keep modifying the numbers in the table. Each time a cell is changed, in order to keep the table satisfying the two conditions, Xiao Q must also update all cells that can be affected by this modification to appropriate values. By some mysterious power, it is guaranteed that after each round of modification all entries remain integers. Xiao Q also needs to query, at any time, the sum of all numbers in the finite region of the first $k$ rows and first $k$ columns; since the answer may be large, it suffices to output the result ${} \\bmod 1,000,000,007$.", "inputFormat": "The first line contains two integers $m, n$, indicating that there are $m$ operations, and that all row and column indices mentioned in the operations and queries do not exceed $n$.\n\nThen follow $m$ lines, each containing four integers $a, b, x, k$, meaning: set the number in row $a$, column $b$ to $x$, then update all cells that can be affected by this change, with the guarantee that after the modification all entries are still integers. After the modification is completed, compute the sum of all numbers in the first $k$ rows and first $k$ columns.", "outputFormat": "Output $m$ lines. After each operation, output one line containing the answer modulo $1,000,000,007$.", "hint": "**Sample Explanation #1**\n\nInitially, the top-left $3 \\times 3$ submatrix is as shown on the left. There is no change after the first $2$ operations. After the $3$rd operation, the table becomes as shown on the right.\n\n```cpp\n1 2 3     2  4  6\n2 4 6     4  4 12\n3 6 9     6 12  9\n```\n\n**Constraints**\n\nFor $100\\%$ of the testdata, $1 \\le m \\le 10^4$, $1 \\le a, b, k \\le n \\le 4 \\times 10^6$, $0 \\le x \\le 10^{18}$.\n\n![](https://cdn.luogu.com.cn/upload/pic/5012.png)\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[CQOI2017] 小 Q 的表格", "background": "", "description": "小 Q 是个程序员。\n\n作为一个年轻的程序员，小 Q 总是被老 C 欺负，老 C 经常把一些麻烦的任务交给小 Q 来处理。每当小 Q 不知道如何解决时，就只好向你求助。\n\n为了完成任务，小 Q 需要列一个表格，表格有无穷多行，无穷多列，行和列都从 $1$ 开始标号。为了完成任务，表格里面每个格子都填了一个整数，为了方便描述，小 Q 把第 $a$ 行第 $b$ 列的整数记为 $f(a, b)$。为了完成任务，这个表格要满足一些条件：\n\n1. 对任意的正整数 $a, b$，都要满足 $f(a, b) = f(b, a)$；\n2. 对任意的正整数 $a, b$，都要满足 $b \\times f(a, a + b) = (a + b) \\times f(a, b)$。\n\n为了完成任务，一开始表格里面的数很有规律，第 $a$ 行第 $b$ 列的数恰好等于 $a \\times b$，显然一开始是满足上述两个条件的。为了完成任务，小 Q 需要不断的修改表格里面的数，每当修改了一个格子的数之后，为了让表格继续满足上述两个条件，小 Q 还需要把这次修改能够波及到的全部格子里都改为恰当的数。由于某种神奇的力量驱使，已经确保了每一轮修改之后所有格子里的数仍然都是整数。为了完成任务，小 Q 还需要随时获取前 $k$ 行前 $k$ 列这个有限区域内所有数的和是多少，答案可能比较大，只需要算出答案 ${} \\bmod 1,000,000,007$ 之后的结果。", "inputFormat": "输入文件第一行包含两个整数 $m, n$，表示共有 $m$ 次操作，所有操作和查询涉及到的行编号和列编号都不超过 $n$。\n\n接下来 $m$ 行，每行四个整数 $a, b, x, k$，表示把第 $a$ 行 $b$ 列的数改成 $x$，然后把它能够波及到的所有格子全部修改，保证修改之后所有格子的数仍然都是整数，修改完成后计算前 $k$ 行前 $k$ 列里所有数的和。", "outputFormat": "输出共 $m$ 行，每次操作之后输出一行，表示答案 ${} \\bmod 1,000,000,007$ 之后的结果。", "hint": "**【样例解释 #1】**\n\n一开始，表格的前 $3$ 行前 $3$ 列如图中左边所示。前 $2$ 次操作后表格没有变化，第 $3$ 次操作之后的表格如右边所示。\n\n```cpp\n1 2 3     2  4  6\n2 4 6     4  4 12\n3 6 9     6 12  9\n```\n\n**【数据范围】**\n\n对于 $100 \\%$ 的测试点，$1 \\le m \\le {10}^4$，$1 \\le a, b, k \\le n \\le 4 \\times {10}^6$，$0 \\le x \\le {10}^{18}$。\n\n![](https://cdn.luogu.com.cn/upload/pic/5012.png)\n", "locale": "zh-CN"}}}
{"pid": "P3701", "type": "P", "difficulty": 5, "samples": [["3 3\nJ W YYY\nJ HK E\n2 2 2\n2 2 2\n", "3\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["网络流", "洛谷原创", "图论建模"], "title": "主主树", "background": "byx 和诗乃酱都非常都非常喜欢种树。有一天，他们得到了两颗奇怪的树种，于是各自取了一颗回家种树，并约定几年后比一比谁种出来的树更加牛 X。", "description": "很快，这棵树就开花结果了。byx 和诗乃酱惊讶的发现，这是一棵主主树，树上长满了主主和主主的朋友们。这棵树上一共有五种人，主主（$\\verb!J!$），记记（$\\verb!HK!$），高高（$\\verb!W!$），王王（$\\verb!E!$）和歪歪（$\\verb!YYY!$）。他们发现，他们的主主树上的人数相同，都为 $N$。\n\n ![](https://cdn.luogu.com.cn/upload/image_hosting/0vklm8ow.png) \n\n研究发现，这五种人的输赢如上图所示（一样的人不能 PK），箭头指向输的人。至于为什么，留给同学们自己思考。\n\n比赛如期进行。\n\nbyx 和诗乃酱要进行 $M$ 场比赛，每一场比赛他们会选出树上的两个人来比较看谁更牛 X。\n\n第 $i$ 个人寿命为 $\\text{Life}_i$ 秒，每次比完赛比赛的二人就会 $-1$s。当他们生命为 $0$s 时他们就不能再比赛了。\n\n同时，当 $\\verb!J!$ 的寿命为 $0$ 时，同一棵树上的 $\\verb!YYY!$ 可以为他 $+1$s。每个 $\\verb!YYY!$ 只能给每个 $\\verb!J!$ 续一次。\n\n那么问题来了：\n\n现在给定 $N,M(1\\le N\\le 100,1\\le M\\le 1000)$，诗乃酱和 byx 每一个人所属种类（$\\verb!J!,\\verb!HK!,\\verb!W!,\\verb!YYY!$ 或 $\\verb!E!$）以及每一个人的生命，生命不超过 $50$。请你算算 byx 最多能够赢得多少场比赛呢。\n\n数据保证每一场一定都有人用。两个人之间只能比一场。", "inputFormat": "第一行包含两个数 $N,M$，含义看上面。  \n\n第二行 $N$ 个字串（$\\verb!J!,\\verb!HK!,\\verb!W!,\\verb!YYY!$ 或 $\\verb!E!$），表示 byx 的人所属种类，用空格隔开。  \n\n第三行 $N$ 个字串（$\\verb!J!,\\verb!HK!,\\verb!W!,\\verb!YYY!$ 或 $\\verb!E!$），表示诗乃酱的人所属种类，用空格隔开。  \n\n第四行 $N$ 个数，表示 byx 的人的生命。  \n\n第五行 $N$ 个数，表示诗乃酱的人的生命。", "outputFormat": "一个数，byx 能赢的场次。", "hint": "第一场主主赢记记，第二场高高赢王王，第三场歪歪赢记记。", "locale": "zh-CN", "translations": {"en": {"title": "Zhuzhu Tree", "background": "byx and Shino-chan both love planting trees. One day, they got two strange seeds, each took one home to grow a tree, and agreed to compare in a few years to see whose tree is cooler.", "description": "Soon, the trees blossomed and bore fruit. byx and Shino-chan were surprised to find that theirs were Zhuzhu Trees, full of Zhuzhu and Zhuzhu’s friends. There are five kinds of people on the tree: Zhuzhu ($\\verb!J!$), Jiji ($\\verb!HK!$), Gaogao ($\\verb!W!$), Wangwang ($\\verb!E!$), and Waiwai ($\\verb!YYY!$). They found that the numbers of people on their Zhuzhu Trees are the same, both equal to $N$.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/0vklm8ow.png)\n\nResearch shows that the win–lose relationships among the five kinds are as in the figure above (two people of the same kind cannot “PK”). Arrows point to the loser. As for why, think about it yourself.\n\nThe contest begins as scheduled.\n\nbyx and Shino-chan will play $M$ matches. In each match, they will each choose one person from their own tree to see who is stronger.\n\nThe $i$-th person has a lifetime of $\\text{Life}_i$ seconds. After each match, both participants lose $-1\\text{s}$. When someone’s lifetime reaches $0\\text{s}$, they can no longer play.\n\nAlso, when a $\\verb!J!$’s lifetime is $0$, any $\\verb!YYY!$ on the same tree can add $+1\\text{s}$ to that $\\verb!J!$. Each $\\verb!YYY!$ can extend each $\\verb!J!$ at most once.\n\nThe problem:\n\nGiven $N, M (1\\le N\\le 100, 1\\le M\\le 1000)$, the kind of each person for Shino-chan and byx (one of $\\verb!J!, \\verb!HK!, \\verb!W!, \\verb!YYY!, \\verb!E!$), and each person’s lifetime (not exceeding $50$), compute the maximum number of matches that byx can win.\n\nThe testdata guarantees that there will be available participants for every match. Any pair of two specific people can play at most one match.", "inputFormat": "The first line contains two integers $N, M$, as described above.  \nThe second line contains $N$ strings ($\\verb!J!, \\verb!HK!, \\verb!W!, \\verb!YYY!$ or $\\verb!E!$), the kinds of byx’s people, separated by spaces.  \nThe third line contains $N$ strings ($\\verb!J!, \\verb!HK!, \\verb!W!, \\verb!YYY!$ or $\\verb!E!$), the kinds of Shino-chan’s people, separated by spaces.  \nThe fourth line contains $N$ integers, the lifetimes of byx’s people.  \nThe fifth line contains $N$ integers, the lifetimes of Shino-chan’s people.", "outputFormat": "Output a single integer: the number of matches byx can win.", "hint": "In the first match, $\\verb!J!$ beats $\\verb!HK!$. In the second match, $\\verb!W!$ beats $\\verb!E!$. In the third match, $\\verb!YYY!$ beats $\\verb!HK!$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "主主树", "background": "byx 和诗乃酱都非常都非常喜欢种树。有一天，他们得到了两颗奇怪的树种，于是各自取了一颗回家种树，并约定几年后比一比谁种出来的树更加牛 X。", "description": "很快，这棵树就开花结果了。byx 和诗乃酱惊讶的发现，这是一棵主主树，树上长满了主主和主主的朋友们。这棵树上一共有五种人，主主（$\\verb!J!$），记记（$\\verb!HK!$），高高（$\\verb!W!$），王王（$\\verb!E!$）和歪歪（$\\verb!YYY!$）。他们发现，他们的主主树上的人数相同，都为 $N$。\n\n ![](https://cdn.luogu.com.cn/upload/image_hosting/0vklm8ow.png) \n\n研究发现，这五种人的输赢如上图所示（一样的人不能 PK），箭头指向输的人。至于为什么，留给同学们自己思考。\n\n比赛如期进行。\n\nbyx 和诗乃酱要进行 $M$ 场比赛，每一场比赛他们会选出树上的两个人来比较看谁更牛 X。\n\n第 $i$ 个人寿命为 $\\text{Life}_i$ 秒，每次比完赛比赛的二人就会 $-1$s。当他们生命为 $0$s 时他们就不能再比赛了。\n\n同时，当 $\\verb!J!$ 的寿命为 $0$ 时，同一棵树上的 $\\verb!YYY!$ 可以为他 $+1$s。每个 $\\verb!YYY!$ 只能给每个 $\\verb!J!$ 续一次。\n\n那么问题来了：\n\n现在给定 $N,M(1\\le N\\le 100,1\\le M\\le 1000)$，诗乃酱和 byx 每一个人所属种类（$\\verb!J!,\\verb!HK!,\\verb!W!,\\verb!YYY!$ 或 $\\verb!E!$）以及每一个人的生命，生命不超过 $50$。请你算算 byx 最多能够赢得多少场比赛呢。\n\n数据保证每一场一定都有人用。两个人之间只能比一场。", "inputFormat": "第一行包含两个数 $N,M$，含义看上面。  \n\n第二行 $N$ 个字串（$\\verb!J!,\\verb!HK!,\\verb!W!,\\verb!YYY!$ 或 $\\verb!E!$），表示 byx 的人所属种类，用空格隔开。  \n\n第三行 $N$ 个字串（$\\verb!J!,\\verb!HK!,\\verb!W!,\\verb!YYY!$ 或 $\\verb!E!$），表示诗乃酱的人所属种类，用空格隔开。  \n\n第四行 $N$ 个数，表示 byx 的人的生命。  \n\n第五行 $N$ 个数，表示诗乃酱的人的生命。", "outputFormat": "一个数，byx 能赢的场次。", "hint": "第一场主主赢记记，第二场高高赢王王，第三场歪歪赢记记。", "locale": "zh-CN"}}}
{"pid": "P3702", "type": "P", "difficulty": 5, "samples": [["3 5 3", "33"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["2017", "各省省选", "山东", "素数判断,质数,筛法", "容斥原理", "矩阵乘法", "快速傅里叶变换 FFT"], "title": "[SDOI2017] 序列计数", "background": "", "description": "Alice 想要得到一个长度为 $n$ 的序列，序列中的数都是不超过 $m$ 的正整数，而且这 $n$ 个数的和是 $p$ 的倍数。\n\nAlice 还希望，这 $n$ 个数中，至少有一个数是质数。\n\nAlice 想知道，有多少个序列满足她的要求。", "inputFormat": "一行三个数，$n,m,p$。\n", "outputFormat": "一行一个数，满足 Alice 的要求的序列数量，答案对 $20170408$ 取模。", "hint": "对 $20\\%$ 的数据，$1\\leq n,m\\leq100$。\n\n\n对 $50\\%$ 的数据，$1\\leq m \\leq 100$。\n\n\n对 $80\\%$ 的数据，$1\\leq m\\leq 10^6$。\n\n\n对 $100\\%$ 的数据，$1\\leq n \\leq 10^9,1\\leq m \\leq 2\\times 10^7,1\\leq p\\leq 100$。", "locale": "zh-CN", "translations": {"en": {"title": "[SDOI2017] Sequence Counting", "background": "", "description": "Alice wants to obtain a sequence of length $n$, where all elements are positive integers not exceeding $m$, and the sum of these $n$ numbers is a multiple of $p$.\n\nAlice also wants at least one of these $n$ numbers to be a prime number.\n\nAlice wants to know how many sequences satisfy her requirements.", "inputFormat": "One line with three integers, $n, m, p$.", "outputFormat": "One line with a single number: the number of sequences that satisfy Alice’s requirements, taken modulo $20170408$.", "hint": "For $20\\%$ of the testdata, $1 \\leq n, m \\leq 100$.\n\nFor $50\\%$ of the testdata, $1 \\leq m \\leq 100$.\n\nFor $80\\%$ of the testdata, $1 \\leq m \\leq 10^6$.\n\nFor $100\\%$ of the testdata, $1 \\leq n \\leq 10^9, 1 \\leq m \\leq 2 \\times 10^7, 1 \\leq p \\leq 100$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SDOI2017] 序列计数", "background": "", "description": "Alice 想要得到一个长度为 $n$ 的序列，序列中的数都是不超过 $m$ 的正整数，而且这 $n$ 个数的和是 $p$ 的倍数。\n\nAlice 还希望，这 $n$ 个数中，至少有一个数是质数。\n\nAlice 想知道，有多少个序列满足她的要求。", "inputFormat": "一行三个数，$n,m,p$。\n", "outputFormat": "一行一个数，满足 Alice 的要求的序列数量，答案对 $20170408$ 取模。", "hint": "对 $20\\%$ 的数据，$1\\leq n,m\\leq100$。\n\n\n对 $50\\%$ 的数据，$1\\leq m \\leq 100$。\n\n\n对 $80\\%$ 的数据，$1\\leq m\\leq 10^6$。\n\n\n对 $100\\%$ 的数据，$1\\leq n \\leq 10^9,1\\leq m \\leq 2\\times 10^7,1\\leq p\\leq 100$。", "locale": "zh-CN"}}}
{"pid": "P3703", "type": "P", "difficulty": 6, "samples": [["5 6\n1 2\n2 3\n3 4\n3 5\n2 4 5\n3 3\n1 4\n2 4 5\n1 5\n2 4 5", "3\n4\n2\n2"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2017", "线段树", "各省省选", "山东", "树链剖分", "动态树 LCT"], "title": "[SDOI2017] 树点涂色", "background": "", "description": "Bob 有一棵 $n$ 个点的有根树，其中 $1$ 号点是根节点。Bob 在每个点上涂了颜色，并且每个点上的颜色不同。\n\n定义一条路径的权值是：这条路径上的点（包括起点和终点）共有多少种不同的颜色。\n\nBob可能会进行这几种操作：\n\n- `1 x` 表示把点 $x$ 到根节点的路径上所有的点染上一种没有用过的新颜色。\n\n\n- `2 x y` 求 $x$ 到 $y$ 的路径的权值。\n\n- `3 x` 在以 $x$ 为根的子树中选择一个点，使得这个点到根节点的路径权值最大，求最大权值。\n\n\nBob一共会进行 $m$ 次操作\n", "inputFormat": "第一行两个数 $n,m$。\n\n接下来 $n-1$ 行，每行两个数 $a,b$，表示 $a$ 与 $b$ 之间有一条边。\n\n接下来 $m$ 行，表示操作，格式见题目描述", "outputFormat": "每当出现 $2,3$ 操作，输出一行。\n\n如果是 $2$ 操作，输出一个数表示路径的权值\n\n如果是 $3$ 操作，输出一个数表示权值的最大值\n", "hint": "共 $10$ 个测试点。\n\n测试点 $1$，$1\\leq n,m\\leq1000$；\n\n测试点 $2,3$，没有 $2$ 操作；\n\n测试点 $4,5$，没有 $3$ 操作；\n\n测试点 $6$，树的生成方式是，对于 $i(2\\leq i \\leq n)$，在 $1 \\sim i-1$ 中随机选一个点作为 $i$ 的父节点；\n\n测试点 $7$，$1\\leq n,m\\leq 5\\times 10^4$；\n\n测试点 $8$，$1\\leq n \\leq 5 \\times 10^4$；\n\n测试点9,10，无特殊限制\n\n对所有数据，$1\\leq n \\leq 10^5$，$1\\leq m \\leq 10^5$。\n", "locale": "zh-CN", "translations": {"en": {"title": "[SDOI2017] Tree Node Coloring", "background": "", "description": "Bob has a rooted tree with $n$ nodes, where node $1$ is the root. Bob painted each node with a color, and all nodes have pairwise distinct colors.\n\nDefine the weight of a path as the number of distinct colors among the nodes on this path (including both endpoints).\n\nBob may perform the following operations:\n\n- `1 x` Recolor all nodes on the path from $x$ to the root with a brand-new color that has never been used before.\n- `2 x y` Query the weight of the path from $x$ to $y$.\n- `3 x` Within the subtree rooted at $x$, choose a node so that the weight of its path to the root is maximized; output that maximum weight.\n\nBob will perform $m$ operations in total.", "inputFormat": "The first line contains two integers $n, m$.\n\nThe next $n-1$ lines each contain two integers $a, b$, indicating an edge between $a$ and $b$.\n\nThe next $m$ lines describe the operations, in the format given in the statement.", "outputFormat": "For each operation of type 2 or 3, output one line.\n\nFor type 2, output one integer: the weight of the path.\n\nFor type 3, output one integer: the maximum weight.", "hint": "There are 10 test points.\n\nTest point 1: $1 \\leq n, m \\leq 1000$.\n\nTest points 2 and 3: no type 2 operations.\n\nTest points 4 and 5: no type 3 operations.\n\nTest point 6: the tree is generated as follows — for $i$ ($2 \\leq i \\leq n$), randomly choose a node from $1$ to $i-1$ as the parent of $i$.\n\nTest point 7: $1 \\leq n, m \\leq 5 \\times 10^4$.\n\nTest point 8: $1 \\leq n \\leq 5 \\times 10^4$.\n\nTest points 9 and 10: no special restrictions.\n\nFor all testdata: $1 \\leq n \\leq 10^5$, $1 \\leq m \\leq 10^5$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SDOI2017] 树点涂色", "background": "", "description": "Bob 有一棵 $n$ 个点的有根树，其中 $1$ 号点是根节点。Bob 在每个点上涂了颜色，并且每个点上的颜色不同。\n\n定义一条路径的权值是：这条路径上的点（包括起点和终点）共有多少种不同的颜色。\n\nBob可能会进行这几种操作：\n\n- `1 x` 表示把点 $x$ 到根节点的路径上所有的点染上一种没有用过的新颜色。\n\n\n- `2 x y` 求 $x$ 到 $y$ 的路径的权值。\n\n- `3 x` 在以 $x$ 为根的子树中选择一个点，使得这个点到根节点的路径权值最大，求最大权值。\n\n\nBob一共会进行 $m$ 次操作\n", "inputFormat": "第一行两个数 $n,m$。\n\n接下来 $n-1$ 行，每行两个数 $a,b$，表示 $a$ 与 $b$ 之间有一条边。\n\n接下来 $m$ 行，表示操作，格式见题目描述", "outputFormat": "每当出现 $2,3$ 操作，输出一行。\n\n如果是 $2$ 操作，输出一个数表示路径的权值\n\n如果是 $3$ 操作，输出一个数表示权值的最大值\n", "hint": "共 $10$ 个测试点。\n\n测试点 $1$，$1\\leq n,m\\leq1000$；\n\n测试点 $2,3$，没有 $2$ 操作；\n\n测试点 $4,5$，没有 $3$ 操作；\n\n测试点 $6$，树的生成方式是，对于 $i(2\\leq i \\leq n)$，在 $1 \\sim i-1$ 中随机选一个点作为 $i$ 的父节点；\n\n测试点 $7$，$1\\leq n,m\\leq 5\\times 10^4$；\n\n测试点 $8$，$1\\leq n \\leq 5 \\times 10^4$；\n\n测试点9,10，无特殊限制\n\n对所有数据，$1\\leq n \\leq 10^5$，$1\\leq m \\leq 10^5$。\n", "locale": "zh-CN"}}}
{"pid": "P3704", "type": "P", "difficulty": 6, "samples": [["3\n2 3\n4 5\n6 7", "1\n6\n960"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 3000, 3000, 3000, 3000, 3000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2017", "各省省选", "山东", "O2优化", "枚举", "莫比乌斯反演", "分块"], "title": "[SDOI2017] 数字表格", "background": "Doris 刚刚学习了 fibonacci 数列。用 $f_i$ 表示数列的第 $i$ 项，那么\n\n$$f_0=0,f_1=1$$\n\n$$f_n=f_{n-1}+f_{n-2},n\\geq 2$$", "description": "Doris 用老师的超级计算机生成了一个 $n\\times m$ 的表格，\n\n第 $i$ 行第 $j$ 列的格子中的数是 $f_{\\gcd(i,j)}$，其中 $\\gcd(i,j)$ 表示 $i,j$ 的最大公约数。\n\n\nDoris 的表格中共有 $n\\times m$ 个数，她想知道这些数的乘积是多少。\n\n答案对 $10^9+7$ 取模。\n", "inputFormat": "**本题单个测试点内有多组测试数据**。\n\n输入的第一行是一个整数 $T$，表示测试数据的组数。\n\n接下来 $T$ 行，每行两个整数 $n, m$，表示一组数据。", "outputFormat": "对于每组数据，输出一行一个整数表示答案。", "hint": "#### 数据规模与约定\n\n- 对于 $10\\%$ 的数据，保证 $n,m\\leq 10^2$。\n- 对于 $30\\%$ 的数据，保证 $n,m\\leq 10^3$。\n- 另有 $30\\%$ 的数据，保证 $T\\leq 3$。\n- 对于 $100\\%$ 的数据，保证 $1 \\leq T\\leq 10^3$，$1\\leq n,m\\leq 10^6$。\n", "locale": "zh-CN", "translations": {"en": {"title": "[SDOI2017] Number Table", "background": "Doris just learned the Fibonacci sequence. Let $f_i$ denote the $i$-th term of the sequence, then\n\n$$f_0=0,f_1=1$$\n\n$$f_n=f_{n-1}+f_{n-2},n\\geq 2$$", "description": "Doris used her teacher’s supercomputer to generate an $n \\times m$ table.\n\nThe number in the $i$-th row and the $j$-th column is $f_{\\gcd(i,j)}$, where $\\gcd(i,j)$ denotes the greatest common divisor of $i$ and $j$.\n\nThere are $n \\times m$ numbers in total in Doris’s table. She wants to know the product of all these numbers.\n\nOutput the answer modulo $10^9+7$.", "inputFormat": "There are multiple test cases in a single test file.\n\nThe first line contains an integer $T$, the number of test cases.\n\nEach of the next $T$ lines contains two integers $n, m$, describing one test case.", "outputFormat": "For each test case, output one integer on a separate line representing the answer.", "hint": "Constraints:\n- For $10\\%$ of the testdata, $n, m \\leq 10^2$.\n- For $30\\%$ of the testdata, $n, m \\leq 10^3$.\n- For another $30\\%$ of the testdata, $T \\leq 3$.\n- For $100\\%$ of the testdata, $1 \\leq T \\leq 10^3$, $1 \\leq n, m \\leq 10^6$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SDOI2017] 数字表格", "background": "Doris 刚刚学习了 fibonacci 数列。用 $f_i$ 表示数列的第 $i$ 项，那么\n\n$$f_0=0,f_1=1$$\n\n$$f_n=f_{n-1}+f_{n-2},n\\geq 2$$", "description": "Doris 用老师的超级计算机生成了一个 $n\\times m$ 的表格，\n\n第 $i$ 行第 $j$ 列的格子中的数是 $f_{\\gcd(i,j)}$，其中 $\\gcd(i,j)$ 表示 $i,j$ 的最大公约数。\n\n\nDoris 的表格中共有 $n\\times m$ 个数，她想知道这些数的乘积是多少。\n\n答案对 $10^9+7$ 取模。\n", "inputFormat": "**本题单个测试点内有多组测试数据**。\n\n输入的第一行是一个整数 $T$，表示测试数据的组数。\n\n接下来 $T$ 行，每行两个整数 $n, m$，表示一组数据。", "outputFormat": "对于每组数据，输出一行一个整数表示答案。", "hint": "#### 数据规模与约定\n\n- 对于 $10\\%$ 的数据，保证 $n,m\\leq 10^2$。\n- 对于 $30\\%$ 的数据，保证 $n,m\\leq 10^3$。\n- 另有 $30\\%$ 的数据，保证 $T\\leq 3$。\n- 对于 $100\\%$ 的数据，保证 $1 \\leq T\\leq 10^3$，$1\\leq n,m\\leq 10^6$。\n", "locale": "zh-CN"}}}
{"pid": "P3705", "type": "P", "difficulty": 6, "samples": [["3\n19 17 16\n25 24 23\n35 36 31\n9 5 6\n3 4 2\n7 8 9", "5.357143"]], "limits": {"time": [1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["2017", "二分", "各省省选", "山东", "O2优化", "分数规划", "费用流"], "title": "[SDOI2017] 新生舞会", "background": null, "description": "学校组织了一次新生舞会，Cathy 作为经验丰富的老学姐，负责为同学们安排舞伴。\n\n\n有 $n$ 个男生和 $n$ 个女生参加舞会，一个男生和一个女生一起跳舞，互为舞伴。\n\n\nCathy 收集了这些同学之间的关系，比如两个人之前认识没，计算得出 $a_{i,j}$。\n\nCathy 还需要考虑两个人一起跳舞是否方便，比如身高体重差别会不会太大，计算得出 $b_{i,j}$，表示第 $i$ 个男生和第 $j$ 个女生一起跳舞时的不协调程度。\n\n\n当然，还需要考虑很多其他问题。\n\n\nCathy 想先用一个程序通过 $a_{i,j}$ 和 $b_{i,j}$ 求出一种方案，再手动对方案进行微调。\n\nCathy 找到你，希望你帮她写那个程序。\n\n\n一个方案中有 $n$ 对舞伴，假设每对舞伴的喜悦程度分别是 $a'_1,a'_2,...,a'_n$，假设每对舞伴的不协调程度分别是 $b'_1,b'_2,...,b'_n$。令\n\n$C=\\frac {a'_1+a'_2+...+a'_n}{b'_1+b'_2+...+b'_n}$\n\nCathy 希望 $C$ 值最大。", "inputFormat": "第一行一个整数 $n$。\n\n接下来 $n$ 行，每行 $n$ 个整数，第 $i$ 行第 $j$ 个数表示 $a_{i,j}$。\n\n接下来 $n$ 行，每行 $n$ 个整数，第 $i$ 行第 $j$ 个数表示 $b_{i,j}$。", "outputFormat": "一行一个数，表示 $C$ 的最大值。四舍五入保留 $6$ 位小数，选手输出的小数需要与标准输出相等。", "hint": "对于 $10\\%$ 的数据，$1 \\le n \\le 5$。\n\n对于 $40\\%$ 的数据，$1 \\le n \\le 18$。\n\n另有 $20\\%$ 的数据，$b_{i,j} = 1$。\n\n对于 $100\\%$ 的数据，$1 \\le n \\le 100,1 \\le a_{i,j},b_{i,j} \\le 10^4$。", "locale": "zh-CN", "translations": {"en": {"title": "[SDOI2017] Freshmen Welcome Ball", "background": "", "description": "The school is holding a freshmen welcome ball. As an experienced senior, Cathy is responsible for pairing up dance partners.\n\nThere are $n$ boys and $n$ girls at the ball. Each pair consists of one boy and one girl, forming a one-to-one matching.\n\nCathy collected relationship information between these students, such as whether two people knew each other before, and computed $a_{i,j}$.\n\nCathy also needs to consider how convenient it is for two people to dance together, for example whether their height and weight differences are too large, and computed $b_{i,j}$, which represents the incompatibility when the $i$-th boy dances with the $j$-th girl.\n\nOf course, there are many other issues to consider.\n\nCathy wants to first use a program to find a plan based on $a_{i,j}$ and $b_{i,j}$, and then manually fine-tune the result.\n\nA plan consists of $n$ pairs of partners. Suppose the joy levels of the pairs are $a'_1, a'_2, ..., a'_n$, and the incompatibility levels are $b'_1, b'_2, ..., b'_n$. Let\n$C=\\frac {a'_1+a'_2+...+a'_n}{b'_1+b'_2+...+b'_n}$.\nCathy wants to maximize the value of $C$.", "inputFormat": "The first line contains an integer $n$.\n\nThe next $n$ lines each contain $n$ integers. In the $i$-th line, the $j$-th number denotes $a_{i,j}$.\n\nThe next $n$ lines each contain $n$ integers. In the $i$-th line, the $j$-th number denotes $b_{i,j}$.", "outputFormat": "Output a single number, the maximum value of $C$. Round to $6$ decimal places. Your output must exactly match the standard output.", "hint": "Constraints:\n- For $10\\%$ of the testdata, $1 \\le n \\le 5$.\n- For $40\\%$ of the testdata, $1 \\le n \\le 18$.\n- Additionally, for $20\\%$ of the testdata, $b_{i,j} = 1$.\n- For $100\\%$ of the testdata, $1 \\le n \\le 100, 1 \\le a_{i,j}, b_{i,j} \\le 10^4$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SDOI2017] 新生舞会", "background": null, "description": "学校组织了一次新生舞会，Cathy 作为经验丰富的老学姐，负责为同学们安排舞伴。\n\n\n有 $n$ 个男生和 $n$ 个女生参加舞会，一个男生和一个女生一起跳舞，互为舞伴。\n\n\nCathy 收集了这些同学之间的关系，比如两个人之前认识没，计算得出 $a_{i,j}$。\n\nCathy 还需要考虑两个人一起跳舞是否方便，比如身高体重差别会不会太大，计算得出 $b_{i,j}$，表示第 $i$ 个男生和第 $j$ 个女生一起跳舞时的不协调程度。\n\n\n当然，还需要考虑很多其他问题。\n\n\nCathy 想先用一个程序通过 $a_{i,j}$ 和 $b_{i,j}$ 求出一种方案，再手动对方案进行微调。\n\nCathy 找到你，希望你帮她写那个程序。\n\n\n一个方案中有 $n$ 对舞伴，假设每对舞伴的喜悦程度分别是 $a'_1,a'_2,...,a'_n$，假设每对舞伴的不协调程度分别是 $b'_1,b'_2,...,b'_n$。令\n\n$C=\\frac {a'_1+a'_2+...+a'_n}{b'_1+b'_2+...+b'_n}$\n\nCathy 希望 $C$ 值最大。", "inputFormat": "第一行一个整数 $n$。\n\n接下来 $n$ 行，每行 $n$ 个整数，第 $i$ 行第 $j$ 个数表示 $a_{i,j}$。\n\n接下来 $n$ 行，每行 $n$ 个整数，第 $i$ 行第 $j$ 个数表示 $b_{i,j}$。", "outputFormat": "一行一个数，表示 $C$ 的最大值。四舍五入保留 $6$ 位小数，选手输出的小数需要与标准输出相等。", "hint": "对于 $10\\%$ 的数据，$1 \\le n \\le 5$。\n\n对于 $40\\%$ 的数据，$1 \\le n \\le 18$。\n\n另有 $20\\%$ 的数据，$b_{i,j} = 1$。\n\n对于 $100\\%$ 的数据，$1 \\le n \\le 100,1 \\le a_{i,j},b_{i,j} \\le 10^4$。", "locale": "zh-CN"}}}
{"pid": "P3706", "type": "P", "difficulty": 7, "samples": [["3 3\nTHT\nTTH\nHTT", "0.3333333333\n0.2500000000\n0.4166666667"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144]}, "tags": ["字符串", "2017", "各省省选", "山东", "Special Judge", "枚举", "构造"], "title": "[SDOI2017] 硬币游戏", "background": "", "description": "周末同学们非常无聊，有人提议，咱们扔硬币玩吧，谁扔的硬币正面次数多谁胜利。\n\n\n大家纷纷觉得这个游戏非常符合同学们的特色，但只是扔硬币实在是太单调了。\n\n\n同学们觉得要加强趣味性，所以要找一个同学扔很多很多次硬币，其他同学记录下正反面情况。\n\n\n用 $\\texttt H$ 表示正面朝上，用 $\\texttt T$ 表示反面朝上，扔很多次硬币后，会得到一个硬币序列。比如 $\\texttt{HTT}$ 表示第一次正面朝上，后两次反面朝上。\n\n\n但扔到什么时候停止呢？大家提议，选出 $n$ 个同学，每个同学猜一个长度为 $m$ 的序列，当某一个同学猜的序列在硬币序列中出现时，就不再扔硬币了，并且这个同学胜利，为了保证只有一个同学胜利，同学们猜的 $n$ 个序列两两不同。\n\n\n很快，$n$ 个同学猜好序列，然后进入了紧张而又刺激的扔硬币环节。你想知道，如果硬币正反面朝上的概率相同，每个同学胜利的概率是多少。\n", "inputFormat": "第一行两个整数 $n,m$。\n\n\n接下里 $n$ 行，每行一个长度为 $m$ 的字符串，表示第 $i$ 个同学猜的序列。\n", "outputFormat": "输出 $n$ 行，第 $i$ 行表示第 $i$ 个同学胜利的概率。选手输出与标准输出的绝对误差不超过 $10^{-6}$ 即视为正确。\n", "hint": "对于 $10\\%$ 的数据，$1\\le n,m\\le 3$。\n\n对于 $40\\%$ 的数据，$1\\le n,m\\le 18$。\n\n另有 $20\\%$ 的数据，$n=2$。\n\n对于 $100\\%$ 的数据，$1\\le n,m\\le 300$。\n", "locale": "zh-CN", "translations": {"en": {"title": "[SDOI2017] Coin Game", "background": "", "description": "On the weekend, the students were very bored. Someone suggested: let’s toss coins; whoever gets more heads wins.\n\nEveryone thought this game suited the students’ style, but simply tossing coins was too monotonous.\n\nTo make it more interesting, they decided that one student would toss the coin many times, while the others would record the sequence of heads and tails.\n\nUse $\\texttt H$ to denote heads and $\\texttt T$ to denote tails. After many tosses, we obtain a coin sequence. For example, $\\texttt{HTT}$ means heads on the first toss and tails on the next two.\n\nWhen should we stop tossing? They proposed that $n$ students each guess a sequence of length $m$. When some student’s guessed sequence appears in the coin sequence, they stop tossing and that student wins. To ensure a unique winner, the $n$ sequences are pairwise distinct.\n\nThe $n$ students quickly made their guesses, and the exciting coin-tossing began. You want to know, assuming the coin is fair (heads and tails are equally likely), what is the probability that each student wins.", "inputFormat": "The first line contains two integers $n, m$.\n\nThe next $n$ lines each contain a string of length $m$, representing the sequence guessed by the $i$-th student.", "outputFormat": "Output $n$ lines. The $i$-th line contains the probability that the $i$-th student wins. Your answer is accepted if the absolute error does not exceed $10^{-6}$.", "hint": "For $10\\%$ of the testdata, $1 \\le n, m \\le 3$.\n\nFor $40\\%$ of the testdata, $1 \\le n, m \\le 18$.\n\nAdditionally, for $20\\%$ of the testdata, $n = 2$.\n\nFor $100\\%$ of the testdata, $1 \\le n, m \\le 300$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SDOI2017] 硬币游戏", "background": "", "description": "周末同学们非常无聊，有人提议，咱们扔硬币玩吧，谁扔的硬币正面次数多谁胜利。\n\n\n大家纷纷觉得这个游戏非常符合同学们的特色，但只是扔硬币实在是太单调了。\n\n\n同学们觉得要加强趣味性，所以要找一个同学扔很多很多次硬币，其他同学记录下正反面情况。\n\n\n用 $\\texttt H$ 表示正面朝上，用 $\\texttt T$ 表示反面朝上，扔很多次硬币后，会得到一个硬币序列。比如 $\\texttt{HTT}$ 表示第一次正面朝上，后两次反面朝上。\n\n\n但扔到什么时候停止呢？大家提议，选出 $n$ 个同学，每个同学猜一个长度为 $m$ 的序列，当某一个同学猜的序列在硬币序列中出现时，就不再扔硬币了，并且这个同学胜利，为了保证只有一个同学胜利，同学们猜的 $n$ 个序列两两不同。\n\n\n很快，$n$ 个同学猜好序列，然后进入了紧张而又刺激的扔硬币环节。你想知道，如果硬币正反面朝上的概率相同，每个同学胜利的概率是多少。\n", "inputFormat": "第一行两个整数 $n,m$。\n\n\n接下里 $n$ 行，每行一个长度为 $m$ 的字符串，表示第 $i$ 个同学猜的序列。\n", "outputFormat": "输出 $n$ 行，第 $i$ 行表示第 $i$ 个同学胜利的概率。选手输出与标准输出的绝对误差不超过 $10^{-6}$ 即视为正确。\n", "hint": "对于 $10\\%$ 的数据，$1\\le n,m\\le 3$。\n\n对于 $40\\%$ 的数据，$1\\le n,m\\le 18$。\n\n另有 $20\\%$ 的数据，$n=2$。\n\n对于 $100\\%$ 的数据，$1\\le n,m\\le 300$。\n", "locale": "zh-CN"}}}
{"pid": "P3707", "type": "P", "difficulty": 6, "samples": [["3 5\n1 2 3\n1 2 3\n1 1 3\n2 2 3 -3 2\n1 1 2\n3 1 2 2 1\n1 1 3\n", "1.0000000000\n-1.5000000000\n-0.6153846154\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2017", "线段树", "各省省选", "山东", "Special Judge", "前缀和", "分块"], "title": "[SDOI2017] 相关分析", "background": "", "description": "Frank 对天文学非常感兴趣，他经常用望远镜看星星，同时记录下它们的信息，比如亮度、颜色等等，进而估算出星星的距离，半径等等。\n\nFrank 不仅喜欢观测，还喜欢分析观测到的数据。他经常分析两个参数之间（比如亮度和半径）是否存在某种关系。\n\n现在 Frank 要分析参数 $X$ 与 $Y$ 之间的关系。他有 $n$ 组观测数据，第 $i$ 组观测数据记录了 $x_i$ 和 $y_i$。他需要一下几种操作。\n\n###  $\\verb!1 L R!$\n\n用直线拟合第 $L$ 组到第 $R$ 组观测数据。用 $\\overline{x}$ 表示这些观测数据中 $x$ 的平均数，用 $\\overline{y}$ 表示这些观测数据中 $y$ 的平均数，即\n \n$$\\begin{aligned}\\overline{x}&={1 \\over R-L+1} \\sum _{i=L} ^R x_i \\\\\\overline{y}&={1 \\over R-L+1} \\sum _{i=L} ^R y_i\\end{aligned}$$\n\n如果直线方程是 $y=ax+b$，那么 $a$ 应当这样计算：\n\n$$a={\\displaystyle\\sum_{i=L} ^R (x_i-\\overline{x})(y_i-\\overline{y}) \\over \\displaystyle\\sum _{i=L} ^R (x_i -\\overline{x})^2}$$\n\n \n你需要帮助 Frank 计算 $a$。\n\n \n###  $\\verb!2 L R S T!$\n\nFrank 发现测量数据第 $L$ 组到第 $R$ 组数据有误差，对每个 $i$ 满足 $L \\leq i \\leq R$，$x_i$ 需要加上 $S$，$y_i$ 需要加上 $T$。\n \n###  $\\verb!3 L R S T!$\n\nFrank 发现第 $L$ 组到第 $R$ 组数据需要修改，对于每个 $i$ 满足 $L \\leq i \\leq R$，$x_i$ 需要修改为 $(S+i)$，$y_i$ 需要修改为 $(T+i)$。\n", "inputFormat": "第一行两个数 $n,m$，表示观测数据组数和操作次数。\n\n接下来一行 $n$ 个数，第 $i$ 个数是 $x_i$。\n\n接下来一行 $n$ 个数，第 $i$ 个数是 $y_i$。\n\n接下来 $m$ 行，表示操作，格式见题目描述。\n", "outputFormat": "对于每个 $1$ 操作，输出一行，表示直线斜率 $a$。选手输出与标准输出的绝对误差或相对误差不超过 $10^{-5}$ 即为正确。\n", "hint": "### 数据范围及约定\n\n- 对于 $20\\%$ 的数据 $1 \\leq n,m \\leq 1000$；\n- 另有 $20\\%$ 的数据，没有 $3$ 操作，且 $2$ 操作中 $S=0$；\n- 另有 $30\\%$ 的数据，没有 $3$ 操作。\n\n对于 $100\\%$ 的数据，$1 \\leq n,m \\leq 10^5$，$0 \\leq |S|,|T| \\leq 10^5$，$0 \\leq |x_i|,|y_i| \\leq 10^5$。\n\n保证 $1$ 操作不会出现分母为 $0$ 的情况。\n", "locale": "zh-CN", "translations": {"en": {"title": "[SDOI2017] Correlation Analysis", "background": "", "description": "Frank is very interested in astronomy. He often observes stars with a telescope and records their information, such as brightness and color, and then estimates properties like distance and radius.\n\nFrank not only enjoys observing but also analyzing the data he collects. He often checks whether there is some relationship between two parameters (for example, brightness and radius).\n\nNow Frank wants to analyze the relationship between parameters $X$ and $Y$. He has $n$ groups of observations. The $i$-th group records $x_i$ and $y_i$. He needs to perform the following types of operations.\n\n###  $\\verb!1 L R!$\n\nFit a line to the observations from group $L$ to group $R$. Let $\\overline{x}$ denote the mean of $x$ among these observations, and let $\\overline{y}$ denote the mean of $y$, that is,\n \n$$\\begin{aligned}\\overline{x}&={1 \\over R-L+1} \\sum _{i=L} ^R x_i \\\\\\overline{y}&={1 \\over R-L+1} \\sum _{i=L} ^R y_i\\end{aligned}$$\n\nIf the line equation is $y=ax+b$, then $a$ should be computed as:\n\n$$a={\\displaystyle\\sum_{i=L} ^R (x_i-\\overline{x})(y_i-\\overline{y}) \\over \\displaystyle\\sum _{i=L} ^R (x_i -\\overline{x})^2}$$\n\nYou need to help Frank compute $a$.\n\n###  $\\verb!2 L R S T!$\n\nFrank found that the measurements from group $L$ to group $R$ have errors. For each $i$ with $L \\leq i \\leq R$, add $S$ to $x_i$ and add $T$ to $y_i$.\n \n###  $\\verb!3 L R S T!$\n\nFrank needs to modify the data from group $L$ to group $R$. For each $i$ with $L \\leq i \\leq R$, set $x_i$ to $(S+i)$ and set $y_i$ to $(T+i)$.", "inputFormat": "The first line contains two numbers $n,m$, denoting the number of observation groups and the number of operations.\n\nThe next line contains $n$ numbers, where the $i$-th number is $x_i$.\n\nThe next line contains $n$ numbers, where the $i$-th number is $y_i$.\n\nThe next $m$ lines describe the operations. See the formats in the problem statement.", "outputFormat": "For each operation of type $1$, output one line containing the slope $a$. Your output is considered correct if the absolute or relative error does not exceed $10^{-5}$.", "hint": "### Constraints and Notes\n\n- For $20\\%$ of the testdata, $1 \\leq n,m \\leq 1000$.\n- For another $20\\%$ of the testdata, there is no operation $3$, and in operation $2$ we have $S=0$.\n- For another $30\\%$ of the testdata, there is no operation $3$.\n\nFor $100\\%$ of the testdata, $1 \\leq n,m \\leq 10^5$, $0 \\leq |S|,|T| \\leq 10^5$, $0 \\leq |x_i|,|y_i| \\leq 10^5$.\n\nIt is guaranteed that in operation $1$ the denominator will not be $0$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SDOI2017] 相关分析", "background": "", "description": "Frank 对天文学非常感兴趣，他经常用望远镜看星星，同时记录下它们的信息，比如亮度、颜色等等，进而估算出星星的距离，半径等等。\n\nFrank 不仅喜欢观测，还喜欢分析观测到的数据。他经常分析两个参数之间（比如亮度和半径）是否存在某种关系。\n\n现在 Frank 要分析参数 $X$ 与 $Y$ 之间的关系。他有 $n$ 组观测数据，第 $i$ 组观测数据记录了 $x_i$ 和 $y_i$。他需要一下几种操作。\n\n###  $\\verb!1 L R!$\n\n用直线拟合第 $L$ 组到第 $R$ 组观测数据。用 $\\overline{x}$ 表示这些观测数据中 $x$ 的平均数，用 $\\overline{y}$ 表示这些观测数据中 $y$ 的平均数，即\n \n$$\\begin{aligned}\\overline{x}&={1 \\over R-L+1} \\sum _{i=L} ^R x_i \\\\\\overline{y}&={1 \\over R-L+1} \\sum _{i=L} ^R y_i\\end{aligned}$$\n\n如果直线方程是 $y=ax+b$，那么 $a$ 应当这样计算：\n\n$$a={\\displaystyle\\sum_{i=L} ^R (x_i-\\overline{x})(y_i-\\overline{y}) \\over \\displaystyle\\sum _{i=L} ^R (x_i -\\overline{x})^2}$$\n\n \n你需要帮助 Frank 计算 $a$。\n\n \n###  $\\verb!2 L R S T!$\n\nFrank 发现测量数据第 $L$ 组到第 $R$ 组数据有误差，对每个 $i$ 满足 $L \\leq i \\leq R$，$x_i$ 需要加上 $S$，$y_i$ 需要加上 $T$。\n \n###  $\\verb!3 L R S T!$\n\nFrank 发现第 $L$ 组到第 $R$ 组数据需要修改，对于每个 $i$ 满足 $L \\leq i \\leq R$，$x_i$ 需要修改为 $(S+i)$，$y_i$ 需要修改为 $(T+i)$。\n", "inputFormat": "第一行两个数 $n,m$，表示观测数据组数和操作次数。\n\n接下来一行 $n$ 个数，第 $i$ 个数是 $x_i$。\n\n接下来一行 $n$ 个数，第 $i$ 个数是 $y_i$。\n\n接下来 $m$ 行，表示操作，格式见题目描述。\n", "outputFormat": "对于每个 $1$ 操作，输出一行，表示直线斜率 $a$。选手输出与标准输出的绝对误差或相对误差不超过 $10^{-5}$ 即为正确。\n", "hint": "### 数据范围及约定\n\n- 对于 $20\\%$ 的数据 $1 \\leq n,m \\leq 1000$；\n- 另有 $20\\%$ 的数据，没有 $3$ 操作，且 $2$ 操作中 $S=0$；\n- 另有 $30\\%$ 的数据，没有 $3$ 操作。\n\n对于 $100\\%$ 的数据，$1 \\leq n,m \\leq 10^5$，$0 \\leq |S|,|T| \\leq 10^5$，$0 \\leq |x_i|,|y_i| \\leq 10^5$。\n\n保证 $1$ 操作不会出现分母为 $0$ 的情况。\n", "locale": "zh-CN"}}}
{"pid": "P3708", "type": "P", "difficulty": 5, "samples": [["10\n", "9 16 22 25 29 27 29 24 21 13\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["递推", "洛谷原创", "枚举", "前缀和", "洛谷月赛"], "title": "koishi的数学题", "background": "", "description": "Koishi 在 Flandre 的指导下成为了一名数学大师，她想了一道简单的数学题。\n\n输入一个整数 $n$，设 $\\displaystyle f(x) = \\sum_{i=1}^n x \\bmod i$，你需要输出 $f(1), f(2), \\ldots , f(n)$。\n\n按照套路，Koishi 假装自己并不会做这道题，就来求你帮忙辣。", "inputFormat": "一个正整数 $n$。\n", "outputFormat": "一行用空格分隔的 $n$ 个整数 $f(1), f(2), \\ldots , f(n)$。\n", "hint": "对于 $20\\%$ 的数据，$n \\le 1000$。  \n对于 $60\\%$ 的数据，$n \\le 10^5$。  \n对于 $100\\%$ 的数据，$1 \\le n \\le 10^6$。\n", "locale": "zh-CN", "translations": {"en": {"title": "Koishi's Math Problem", "background": "", "description": "Under Flandre's guidance, Koishi has become a math master, and she came up with a simple math problem.\n\nGiven an integer $n$, let $\\displaystyle f(x) = \\sum_{i=1}^n x \\bmod i$. You need to output $f(1), f(2), \\ldots, f(n)$.\n\nAs usual, Koishi pretends she cannot solve this problem and asks you for help.", "inputFormat": "A positive integer $n$.", "outputFormat": "One line containing $n$ integers $f(1), f(2), \\ldots, f(n)$ separated by spaces.", "hint": "For $20\\%$ of the testdata, $n \\le 1000$.  \nFor $60\\%$ of the testdata, $n \\le 10^5$.  \nFor $100\\%$ of the testdata, $1 \\le n \\le 10^6$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "koishi的数学题", "background": "", "description": "Koishi 在 Flandre 的指导下成为了一名数学大师，她想了一道简单的数学题。\n\n输入一个整数 $n$，设 $\\displaystyle f(x) = \\sum_{i=1}^n x \\bmod i$，你需要输出 $f(1), f(2), \\ldots , f(n)$。\n\n按照套路，Koishi 假装自己并不会做这道题，就来求你帮忙辣。", "inputFormat": "一个正整数 $n$。\n", "outputFormat": "一行用空格分隔的 $n$ 个整数 $f(1), f(2), \\ldots , f(n)$。\n", "hint": "对于 $20\\%$ 的数据，$n \\le 1000$。  \n对于 $60\\%$ 的数据，$n \\le 10^5$。  \n对于 $100\\%$ 的数据，$1 \\le n \\le 10^6$。\n", "locale": "zh-CN"}}}
{"pid": "P3709", "type": "P", "difficulty": 5, "samples": [["3 3\n3 3 3\n3 3\n3 3\n3 3", "-1\n-1\n-1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["莫队", "离散化", "洛谷原创", "O2优化", "洛谷月赛"], "title": "大爷的字符串题", "background": "在那遥远的西南有一所学校，\n\n/\\*被和谐部分\\*/\n\n然后去参加该省省选虐场，\n\n然后某蒟蒻不会做，所以也出了一个字符串题：", "description": "给你一个字符串 $a$，每次询问一段区间的贡献。\n\n贡献定义：\n\n每次从这个区间中拿出一个字符 $x$ ，然后把 $x$ 从这个区间中删除，直到区间为空。你要维护一个集合 $S$。\n\n- 如果 $S$ 为空，你 rp 减 $1$。 \n- 如果 $S$ 中有一个元素不小于 $x$，则你 rp 减 $1$，清空 $S$。\n- 之后将 $x$ 插入 $S$。\n\n由于你是大爷，平时做过的题考试都会考到，所以每次询问你搞完这段区间的字符之后最多还有多少 rp？rp 初始为 $0$。\n\n询问之间不互相影响~", "inputFormat": "第一行两个整数 $n$，$m$，表示字符串长度与询问次数。\n\n之后一行 $n$ 个数，第 $i$ 个整数表示给出的字符串的第 $i$ 个字符 $a_i$。\n\n接下来 $m$ 行，每行两个整数 $l, r$，表示一次询问的区间。", "outputFormat": "对于每次询问，输出一行一个整数表示答案。", "hint": "#### 数据规模与约定\n\n- 对于 $10\\%$ 的数据，是样例。\n- 对于另外 $10\\%$ 的数据，保证 $n,m \\le 100$；\n- 对于另外 $10\\%$ 的数据，保证 $n,m \\le 10^3$；\n- 对于另外 $10\\%$ 的数据，保证 $n,m \\le 10^4$；\n- 对于另外 $10\\%$ 的数据，保证 $n,m \\le 10^5$；\n- 对于 $100\\%$ 的数据，$1 \\leq n,m \\le 2 \\times10^5$，$1 \\leq a_i \\leq 10^9$，$1 \\leq l, r \\leq n$。\n\n保证数据像某省省选 day1T2 一样 sb，大家尽情用暴力水过题吧！\n\n没事，你只要在一个好学校，就算这题只能拿到 10 分，也可以进队了。", "locale": "zh-CN", "translations": {"en": {"title": "The Boss's String Problem", "background": "In the distant southwest, there is a school.\n\n/* censored part */\n\nThen they went to that province's NOI Qualifier and crushed the contest.\n\nA newbie (juruo) could not solve it, so they made a string problem.", "description": "You are given a string $a$. For each query, you are asked about the contribution of a sub-interval.\n\nDefinition of contribution:\n\nEach time, pick a character $x$ from this interval (the order is up to you), then delete $x$ from the interval. Repeat until the interval is empty. You need to maintain a set $S$.\n\n- If $S$ is empty, your rp decreases by $1$.\n- If there exists an element in $S$ that is not less than $x$, then your rp decreases by $1$, and you clear $S$.\n- After that, insert $x$ into $S$.\n\nSince you are the boss, problems you have done usually appear in exams. After you process all characters in this interval, what is the maximum rp you can still have? The initial rp is $0$.\n\nQueries are independent.", "inputFormat": "The first line contains two integers $n, m$, the length of the string and the number of queries.\n\nThe next line contains $n$ numbers. The $i$-th integer is the $i$-th character $a_i$ of the given string.\n\nThen $m$ lines follow. Each line contains two integers $l, r$, meaning a query interval.", "outputFormat": "For each query, output a single integer on one line representing the answer.", "hint": "#### Constraints\n\n- For $10\\%$ of the testdata, they are the sample.\n- For another $10\\%$ of the testdata, $n, m \\le 100$.\n- For another $10\\%$ of the testdata, $n, m \\le 10^3$.\n- For another $10\\%$ of the testdata, $n, m \\le 10^4$.\n- For another $10\\%$ of the testdata, $n, m \\le 10^5$.\n- For $100\\%$ of the testdata, $1 \\leq n, m \\le 2 \\times 10^5$, $1 \\leq a_i \\leq 10^9$, $1 \\leq l, r \\leq n$.\n\nThe testdata is as easy as a certain province’s NOI Qualifier Day 1 T2. Feel free to pass it with brute force.\n\nIt’s okay. As long as you are in a good school, even if you can only get 10 points on this problem, you can still make the team.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "大爷的字符串题", "background": "在那遥远的西南有一所学校，\n\n/\\*被和谐部分\\*/\n\n然后去参加该省省选虐场，\n\n然后某蒟蒻不会做，所以也出了一个字符串题：", "description": "给你一个字符串 $a$，每次询问一段区间的贡献。\n\n贡献定义：\n\n每次从这个区间中拿出一个字符 $x$ ，然后把 $x$ 从这个区间中删除，直到区间为空。你要维护一个集合 $S$。\n\n- 如果 $S$ 为空，你 rp 减 $1$。 \n- 如果 $S$ 中有一个元素不小于 $x$，则你 rp 减 $1$，清空 $S$。\n- 之后将 $x$ 插入 $S$。\n\n由于你是大爷，平时做过的题考试都会考到，所以每次询问你搞完这段区间的字符之后最多还有多少 rp？rp 初始为 $0$。\n\n询问之间不互相影响~", "inputFormat": "第一行两个整数 $n$，$m$，表示字符串长度与询问次数。\n\n之后一行 $n$ 个数，第 $i$ 个整数表示给出的字符串的第 $i$ 个字符 $a_i$。\n\n接下来 $m$ 行，每行两个整数 $l, r$，表示一次询问的区间。", "outputFormat": "对于每次询问，输出一行一个整数表示答案。", "hint": "#### 数据规模与约定\n\n- 对于 $10\\%$ 的数据，是样例。\n- 对于另外 $10\\%$ 的数据，保证 $n,m \\le 100$；\n- 对于另外 $10\\%$ 的数据，保证 $n,m \\le 10^3$；\n- 对于另外 $10\\%$ 的数据，保证 $n,m \\le 10^4$；\n- 对于另外 $10\\%$ 的数据，保证 $n,m \\le 10^5$；\n- 对于 $100\\%$ 的数据，$1 \\leq n,m \\le 2 \\times10^5$，$1 \\leq a_i \\leq 10^9$，$1 \\leq l, r \\leq n$。\n\n保证数据像某省省选 day1T2 一样 sb，大家尽情用暴力水过题吧！\n\n没事，你只要在一个好学校，就算这题只能拿到 10 分，也可以进队了。", "locale": "zh-CN"}}}
{"pid": "P3710", "type": "P", "difficulty": 6, "samples": [["6 14\n1 1 5 1\n2 2 4 3\n1 2 6 5\n3 2\n4 1\n3 3\n2 1 3 4\n3 3\n1 2 2 3\n3 2\n4 7\n3 1\n3 2\n3 3", "8\n5\n20\n23\n0\n8\n5"]], "limits": {"time": [4500, 4500, 4500, 4500, 4500, 4500, 4500, 4500, 4500, 4500], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["线段树", "平衡树", "洛谷原创", "O2优化", "枚举", "分块", "K-D Tree", "洛谷月赛"], "title": "方方方的数据结构", "background": "", "description": "在很久很久以前，有一个长度为 $n$ 的数列，一开始数列全是 $0$。\n\n方方方觉得这个数列太单调了，打算对它进行 $m$ 次操作，每次操作为区间加法或者区间乘法。\n\n方方方进行一些操作之后，还可能会对某个数进行询问。\n\n但是进行过一些操作之后，方方方可能会发现之前某次操作失误了，需要撤销这次操作，其它操作和其它操作的前后顺序保持不变。\n\n方方方想好这些操作之后，马上想到了一个优秀的数据结构可以维护这些东西，可是他懒得写标程了，就生成了 $10$ 个**随机数据**，就把这道题扔给了你。\n\n**数据全是随机的，生成方式见最下方的提示。**\n", "inputFormat": "第一行两个数 $n,m$，表示数列的长度和操作个数。\n\n接下来 $m$ 行每行 $2$ 或 $4$ 个数。\n\n1. 如果第一个数为 $1$，接下来跟三个数 $l,r,d$，表示把区间 $[l,r]$ 中的数加上 $d$。\n2. 如果第一个数为 $2$，接下来跟三个数 $l,r,d$，表示把区间 $[l,r]$ 中的数乘上 $d$。\n3. 如果第一个数为 $3$，接下来跟一个数 $p$，表示询问 $p$ 位置的数 $\\bmod\\ 998244353$。\n4. 如果第一个数为 $4$，接下来跟一个数 $p$，表示将第 $p$ 行输入的操作撤销（保证为加或者乘操作，一个操作不会被撤销两次）。\n", "outputFormat": "对于每个 $3$ 操作输出一行表示答案。\n", "hint": "对于 $20\\%$ 的数据，$n,m \\leq 500$，时限 1s。\n\n对于 $50\\%$ 的数据，$n,m \\leq 30000$，时限 1s。\n\n对于 $100\\%$ 的数据，$1 \\leq n,m \\leq 150000$，$1 \\le l \\le r \\le n$，$3$ 操作的 $p$ 满足 $1 \\le p \\le n$，$4$ 操作的 $p$ 满足 $1 \\le p \\le m$，$0 \\leq d \\leq 1073741823$（原因见数据生成器），时限 4.5s。\n\n\n数据生成器：\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nint rand_() {return rand()&32767;} \nint br() {return rand_()*32768+rand_();}\nvector<int> cs;\nint main()\n{\n    srand(...); //这里要填一个种子 \n    int n=...,m=...; //这里要填n、m\n    cout<<n<<\" \"<<m<<\"\\n\";\n    for(int i=1;i<=m;i++)\n    {\n        int o=rand()%4+1;\n        if(o<=2)\n        {\n            cout<<o<<\" \";\n            int l=br()%n+1,r=br()%n+1;\n            if(l>r) swap(l,r); cs.push_back(i);\n            cout<<l<<\" \"<<r<<\" \"<<br()<<\"\\n\";\n        }\n        else if(o==3) cout<<o<<\" \"<<br()%n+1<<\"\\n\";\n        else\n        {\n            if(!cs.size()) {--i; continue;}\n            int s=br()%cs.size(),g=cs[s];\n            cs.erase(cs.begin()+s);\n            cout<<o<<\" \"<<g<<\"\\n\";\n        }\n    }\n}\n```", "locale": "zh-CN", "translations": {"en": {"title": "Fangfangfang's Data Structure", "background": "", "description": "A long time ago, there was a sequence of length $n$, initially all zeros.\n\nFangfangfang thought the sequence was too monotonous and planned to perform $m$ operations on it. Each operation is either a range addition or a range multiplication.\n\nAfter performing some operations, Fangfangfang might also query a certain number.\n\nHowever, after some operations, Fangfangfang might find that a previous operation was mistaken and needs to undo that operation. The other operations and their relative order remain unchanged.\n\nAfter planning these operations, Fangfangfang immediately thought of an excellent data structure to maintain them. But he was too lazy to write the solution, so he generated $10$ random testdata and threw this problem to you.\n\nAll the testdata are random; see the generator in the hint below.", "inputFormat": "The first line contains two integers $n, m$, the length of the sequence and the number of operations.\n\nEach of the next $m$ lines contains $2$ or $4$ integers.\n\n1. If the first integer is $1$, then three integers $l, r, d$ follow, meaning add $d$ to every number in the range $[l, r]$.\n2. If the first integer is $2$, then three integers $l, r, d$ follow, meaning multiply every number in the range $[l, r]$ by $d$.\n3. If the first integer is $3$, then one integer $p$ follows, meaning query the number at position $p$ $\\bmod\\ 998244353$.\n4. If the first integer is $4$, then one integer $p$ follows, meaning undo the operation given on input line $p$ (guaranteed to be an addition or multiplication; no operation will be undone twice).", "outputFormat": "For each type $3$ operation, output one line with the answer.", "hint": "For $20\\%$ of the testdata, $n, m \\leq 500$, time limit $1$ s.\n\nFor $50\\%$ of the testdata, $n, m \\leq 30000$, time limit $1$ s.\n\nFor $100\\%$ of the testdata, $1 \\leq n, m \\leq 150000$, $1 \\le l \\le r \\le n$, for type $3$ operations $1 \\le p \\le n$, for type $4$ operations $1 \\le p \\le m$, $0 \\leq d \\leq 1073741823$ (reason shown in the data generator), time limit $4.5$ s.\n\nData generator:\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nint rand_() {return rand()&32767;} \nint br() {return rand_()*32768+rand_();}\nvector<int> cs;\nint main()\n{\n    srand(...); //这里要填一个种子 \n    int n=...,m=...; //这里要填n、m\n    cout<<n<<\" \"<<m<<\"\\n\";\n    for(int i=1;i<=m;i++)\n    {\n        int o=rand()%4+1;\n        if(o<=2)\n        {\n            cout<<o<<\" \";\n            int l=br()%n+1,r=br()%n+1;\n            if(l>r) swap(l,r); cs.push_back(i);\n            cout<<l<<\" \"<<r<<\" \"<<br()<<\"\\n\";\n        }\n        else if(o==3) cout<<o<<\" \"<<br()%n+1<<\"\\n\";\n        else\n        {\n            if(!cs.size()) {--i; continue;}\n            int s=br()%cs.size(),g=cs[s];\n            cs.erase(cs.begin()+s);\n            cout<<o<<\" \"<<g<<\"\\n\";\n        }\n    }\n}\n```\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "方方方的数据结构", "background": "", "description": "在很久很久以前，有一个长度为 $n$ 的数列，一开始数列全是 $0$。\n\n方方方觉得这个数列太单调了，打算对它进行 $m$ 次操作，每次操作为区间加法或者区间乘法。\n\n方方方进行一些操作之后，还可能会对某个数进行询问。\n\n但是进行过一些操作之后，方方方可能会发现之前某次操作失误了，需要撤销这次操作，其它操作和其它操作的前后顺序保持不变。\n\n方方方想好这些操作之后，马上想到了一个优秀的数据结构可以维护这些东西，可是他懒得写标程了，就生成了 $10$ 个**随机数据**，就把这道题扔给了你。\n\n**数据全是随机的，生成方式见最下方的提示。**\n", "inputFormat": "第一行两个数 $n,m$，表示数列的长度和操作个数。\n\n接下来 $m$ 行每行 $2$ 或 $4$ 个数。\n\n1. 如果第一个数为 $1$，接下来跟三个数 $l,r,d$，表示把区间 $[l,r]$ 中的数加上 $d$。\n2. 如果第一个数为 $2$，接下来跟三个数 $l,r,d$，表示把区间 $[l,r]$ 中的数乘上 $d$。\n3. 如果第一个数为 $3$，接下来跟一个数 $p$，表示询问 $p$ 位置的数 $\\bmod\\ 998244353$。\n4. 如果第一个数为 $4$，接下来跟一个数 $p$，表示将第 $p$ 行输入的操作撤销（保证为加或者乘操作，一个操作不会被撤销两次）。\n", "outputFormat": "对于每个 $3$ 操作输出一行表示答案。\n", "hint": "对于 $20\\%$ 的数据，$n,m \\leq 500$，时限 1s。\n\n对于 $50\\%$ 的数据，$n,m \\leq 30000$，时限 1s。\n\n对于 $100\\%$ 的数据，$1 \\leq n,m \\leq 150000$，$1 \\le l \\le r \\le n$，$3$ 操作的 $p$ 满足 $1 \\le p \\le n$，$4$ 操作的 $p$ 满足 $1 \\le p \\le m$，$0 \\leq d \\leq 1073741823$（原因见数据生成器），时限 4.5s。\n\n\n数据生成器：\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nint rand_() {return rand()&32767;} \nint br() {return rand_()*32768+rand_();}\nvector<int> cs;\nint main()\n{\n    srand(...); //这里要填一个种子 \n    int n=...,m=...; //这里要填n、m\n    cout<<n<<\" \"<<m<<\"\\n\";\n    for(int i=1;i<=m;i++)\n    {\n        int o=rand()%4+1;\n        if(o<=2)\n        {\n            cout<<o<<\" \";\n            int l=br()%n+1,r=br()%n+1;\n            if(l>r) swap(l,r); cs.push_back(i);\n            cout<<l<<\" \"<<r<<\" \"<<br()<<\"\\n\";\n        }\n        else if(o==3) cout<<o<<\" \"<<br()%n+1<<\"\\n\";\n        else\n        {\n            if(!cs.size()) {--i; continue;}\n            int s=br()%cs.size(),g=cs[s];\n            cs.erase(cs.begin()+s);\n            cout<<o<<\" \"<<g<<\"\\n\";\n        }\n    }\n}\n```", "locale": "zh-CN"}}}
{"pid": "P3711", "type": "P", "difficulty": 7, "samples": [["2\n3 3 3", "3 5 3 1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["多项式", "洛谷原创", "O2优化", "生成函数", "逆元", "快速数论变换 NTT", "洛谷月赛"], "title": "仓鼠的数学题", "background": "请注意本题时限 1s，开启 O2 优化，你可能需要输入输出优化。\n", "description": "仓鼠在某 oj 上看到了一个问题，设 $S_k(x)=\\sum_{i=0}^x i^k$，这个题输入 $a_0,a_1...a_n$，假设 $0^0=1$，要求计算 $\\sum_{k=0}^{n}S_k(x)a_k$。\n\n仓鼠想了两秒就秒了这个题，他发现数据范围居然只有 $1000$，就顺手加了两个 $0$。\n\n但是仓鼠懒得造数据了，就把这道题丢给了你。\n", "inputFormat": "第一行输入一个整数 $n$。\n\n第一行输入 $n+1$ 个空格分隔的非负整数。分别是 $a_0, \\cdots, a_n$。\n", "outputFormat": "输出 $n+2$ 个空格分隔的整数，表示答案多项式的各项系数 $c_0,\\cdots,c_{n+1}$，表示答案多项式为 $\\sum_{i=0}^{n+1}c_ix^i$。多项式的系数对 $998244353$ 取模。\n\n可以证明多项式的次数 $\\leq n+1$。\n", "hint": "对于 $10\\%$ 的数据，$n \\leq 500$。\n\n对于 $30\\%$ 的数据，$n \\leq 3000$。\n\n对于 $70\\%$ 的数据，$n \\leq 100000$。\n\n对于 $100\\%$ 的数据，$1 \\leq n \\leq 250000$。\n\n输入和输出多项式系数均为模 $998244353$ 意义下，为 $[0,998244352]$ 的非负整数。\n", "locale": "zh-CN", "translations": {"en": {"title": "Hamster's Math Problem", "background": "Please note that the time limit is 1 s and O2 optimization is enabled. You may need fast I/O.", "description": "A hamster saw a problem on some OJ. Let $S_k(x)=\\sum_{i=0}^x i^k$. This problem inputs $a_0, a_1 \\ldots a_n$. Suppose $0^0=1$. You are asked to compute $\\sum_{k=0}^{n} S_k(x) a_k$.\n\nThe hamster thought for two seconds and solved it in a flash. He found the constraints were only $1000$, so he casually added two zeros.\n\nBut the hamster was too lazy to make testdata, so he threw this problem to you.", "inputFormat": "The first line contains an integer $n$.\n\nThe second line contains $n+1$ space-separated non-negative integers: $a_0, \\cdots, a_n$.", "outputFormat": "Output $n+2$ space-separated integers, the coefficients $c_0, \\cdots, c_{n+1}$ of the answer polynomial, meaning the polynomial is $\\sum_{i=0}^{n+1} c_i x^i$. The coefficients are taken modulo $998244353$.\n\nIt can be proved that the degree of the polynomial is $\\leq n+1$.", "hint": "For $10\\%$ of the testdata, $n \\leq 500$.\n\nFor $30\\%$ of the testdata, $n \\leq 3000$.\n\nFor $70\\%$ of the testdata, $n \\leq 100000$.\n\nFor $100\\%$ of the testdata, $1 \\leq n \\leq 250000$.\n\nBoth the input and output polynomial coefficients are taken modulo $998244353$ and are non-negative integers in $[0, 998244352]$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "仓鼠的数学题", "background": "请注意本题时限 1s，开启 O2 优化，你可能需要输入输出优化。\n", "description": "仓鼠在某 oj 上看到了一个问题，设 $S_k(x)=\\sum_{i=0}^x i^k$，这个题输入 $a_0,a_1...a_n$，假设 $0^0=1$，要求计算 $\\sum_{k=0}^{n}S_k(x)a_k$。\n\n仓鼠想了两秒就秒了这个题，他发现数据范围居然只有 $1000$，就顺手加了两个 $0$。\n\n但是仓鼠懒得造数据了，就把这道题丢给了你。\n", "inputFormat": "第一行输入一个整数 $n$。\n\n第一行输入 $n+1$ 个空格分隔的非负整数。分别是 $a_0, \\cdots, a_n$。\n", "outputFormat": "输出 $n+2$ 个空格分隔的整数，表示答案多项式的各项系数 $c_0,\\cdots,c_{n+1}$，表示答案多项式为 $\\sum_{i=0}^{n+1}c_ix^i$。多项式的系数对 $998244353$ 取模。\n\n可以证明多项式的次数 $\\leq n+1$。\n", "hint": "对于 $10\\%$ 的数据，$n \\leq 500$。\n\n对于 $30\\%$ 的数据，$n \\leq 3000$。\n\n对于 $70\\%$ 的数据，$n \\leq 100000$。\n\n对于 $100\\%$ 的数据，$1 \\leq n \\leq 250000$。\n\n输入和输出多项式系数均为模 $998244353$ 意义下，为 $[0,998244352]$ 的非负整数。\n", "locale": "zh-CN"}}}
{"pid": "P3712", "type": "P", "difficulty": 6, "samples": [["3 5 3\n1 3\n2 3\n1 1 3\n2 3 3\n1 1 3\n2 1 2\n1 1 3", "6\n9\n11"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["洛谷原创", "O2优化"], "title": "少女与战车", "background": "如果你对山口丁和 G&P 没有兴趣，可以无视题目背景，因为你估计看不懂 ……\n\n\n ![](https://cdn.luogu.com.cn/upload/pic/4760.png) \n\n在第 63 回战车道全国高中生大赛中，军神西住美穗带领大洗女子学院的大家打败了其他所有高中，取得了胜利，当然也就不用废校了。\n\n然而一群战车道的领导表示他们是口胡的，废校还是要废的。\n\n军神的母亲西住志穗怒斥废校男，为了不造个大新闻，废校男承诺如果大洗学院可以打败大学队，就不用废校。\n\n（有种 OI 选手 PK ACM 选手的感觉呀）\n\n然而实力差距太大了，大洗女子学院最强的车是虎式 P 型，而大学队清一色的 M26 潘兴，M24 霞飞，还有能跑到 20 的 T95 和卡尔臼炮，感觉根本没法打呀。\n\n这时候一个光头的胖子谢尔盖 • 布尔卡托夫斯基和一个身患癌症急需钱来治病的王姓 CEO 来帮助她们了。\n\n他们把一堆真实性堪忧的坦克图纸给了大洗学院的妹子们，并说这些图纸是真的，而且还原了历史。\n\n大洗学院汽车部的大家看到了这些图纸后非常高兴，开始膜改她们的战车。\n\n\n虎式P型 -> 蟋蟀17\n\n四号D型 -> 四号坦克武器运载车\n\n38(t)型 -> 莱茵金属公司武器运载车\n\nB1-bis  -> 105leFH18B2\n\n即使这样，只有 8 辆战车的大洗女子学院仍然无法打败有 30 辆战车的大学队。\n\n这时候按照剧本其他高中的小伙伴要来帮忙了，然而她们最近正在学习 OI，碰到了一道很神奇的数据结构题，不会做所以来不了。\n\n你作为一个三次元的国家队选手，当然能秒杀二次元的 OI 题啦。\n\n请帮帮她们吧！\n", "description": " ![](https://cdn.luogu.com.cn/upload/pic/4761.png) \n\n给你一个 $n$ 个点的有根树， $1$ 为根，带边权，有 $m$ 次操作。\n\n\n1、求 $x$ 的子树中第 $k$ 小的深度的值，如果子树中没有 $k$ 个点则输出 $-1$；\n\n2、将 $x$ 与 $x$ 父亲的边权加上 $k$。\n\n保证每次操作 2 的 $k$ 以及原树的边权小于等于一个数 $len$。\n\n\n如果操作 2 中 $x$ 为 $1$，那么视为将 $x$ 的基础深度加上了 $k$。\n", "inputFormat": " ![](https://cdn.luogu.com.cn/upload/pic/4763.png) \n\n第一行三个数 $n$、 $m$、$len$。\n\n之后 $n - 1$ 行每行两个数表示 $2$~$n$ 每个点的父亲编号，以及他们到父亲的边权。\n\n之后 $m$ 行每行三个数 $opt$、 $x$、$k$， $opt$ 表示操作种类， $x$、 $k$ 意义如题所述。\n", "outputFormat": "对于每个操作 1，输出一个数表示答案。\n", "hint": "数据范围与提示\n\n对于 10% 的数据， $n, m \\leq 1000$；\n\n对于 30% 的数据， $n, m \\leq 30000$；\n\n对于 100% 的数据，$ n, m \\leq 100000,len \\leq 10$。\n\n\n本水题采用捆绑测试，你只有通过该部分分的所有数据才可以得到该部分分的分数。\n\n\n如果你对山口丁和 G&P 没有兴趣，可以无视结局。\n\n\n\n如果你做出来了这个题\n\n\n妹子们看了你的 STD 之后都 A 了这个题，然后去帮助军神。\n\n她们找了 30 个 183 射了对面一脸。\n\n\n如果你没做出来这个题\n\n\n妹子们虽然很想帮助军神，但是也爱莫能助，毕竟学战车道不能保送。\n\n没有办法，只能 8 打 30 了。\n\n莱茵蹲在草里，大学队没有人发现它，成功击杀五辆敌方坦克后因为车体无法承受火炮后坐力而解体。\n\n三突也蹲在草里，大学队没有人发现它，它也没有发现任何人，最后蹲不住了去突击，击毁一辆潘兴后被击毁。\n\n四运文艺倒车，大学队看到之后目瞪口呆，成功击杀八辆敌方坦克后因为车体无法承受火炮后坐力而解体。\n\n虎P炮一发带走了 95，然后因为转场的时候发动机故障而烧毁。\n\n最后法五金刺刀了 15 个，成功翻盘。\n\n![](https://cdn.luogu.com.cn/upload/pic/4762.png)\n", "locale": "zh-CN", "translations": {"en": {"title": "Girls und Panzer", "background": "If you are not interested in Shankouding (pinyin) and G&P, you can ignore the background, because you probably won’t understand it anyway.\n\n![](https://cdn.luogu.com.cn/upload/pic/4760.png)\n\nIn the 63rd National High School Sensha-dō Tournament, the war goddess Miho Nishizumi led the Ōarai Girls’ Academy to defeat all other high schools and win the championship, which meant the school would not be shut down.\n\nHowever, a group of Sensha-dō officials said they were just kidding, and the shutdown would still proceed.\n\nMiho’s mother, Shiho Nishizumi, scolded the shutdown guy. To avoid making big news, the shutdown guy promised that if Ōarai could defeat the University Team, the school would not be shut down.\n\n(It feels like an OI contestant versus an ACM contestant.)\n\nBut the strength gap was huge. Ōarai’s strongest tank was the Tiger (P), while the University Team fielded all M26 Pershings, M24 Chaffees, plus a T95 that could go 20 and the Karl-Gerät mortar. It felt unwinnable.\n\nAt this moment, a bald fat man named Sergei • Burkatovsky and a CEO surnamed Wang, who was suffering from cancer and urgently needed money for treatment, came to help them.\n\nThey gave the Ōarai girls a pile of tank blueprints of dubious authenticity and claimed they were real and historically accurate.\n\nThe Ōarai Automotive Club was thrilled upon seeing these blueprints and began modding their tanks.\n\nTiger (P) -> Grille 17\n\nPanzer IV Ausf. D -> Panzer IV Waffenträger\n\n38(t) -> Rheinmetall Waffenträger\n\nB1-bis -> 105 leFH18B2\n\nEven so, with only 8 tanks, Ōarai still couldn’t defeat the University Team with 30 tanks.\n\nAccording to the script, friends from other high schools were supposed to help, but they were currently studying OI and had stumbled upon a very magical data structure problem. They couldn’t solve it, so they couldn’t come.\n\nAs a real-world national team member, you can certainly crush a 2D OI problem in seconds.\n\nPlease help them!", "description": "![](https://cdn.luogu.com.cn/upload/pic/4761.png)\n\nYou are given a rooted tree with $n$ nodes, rooted at $1$, with edge weights, and there are $m$ operations.\n\n1. Query the $k$-th smallest depth value among nodes in the subtree of $x$. If the subtree has fewer than $k$ nodes, output $-1$.\n2. Add $k$ to the weight of the edge between $x$ and its parent.\n\nIt is guaranteed that in every operation 2, the value $k$ and all original edge weights in the tree are less than or equal to a number $len$.\n\nIf $x$ is $1$ in operation 2, then it is treated as adding $k$ to the base depth of $x$.", "inputFormat": "![](https://cdn.luogu.com.cn/upload/pic/4763.png)\n\nThe first line contains three integers $n$, $m$, and $len$.\n\nThe next $n - 1$ lines each contain two integers, describing for nodes $2$~$n$ the parent of each node and the weight of the edge to its parent.\n\nThe next $m$ lines each contain three integers $opt$, $x$, and $k$. Here $opt$ denotes the operation type, and $x$, $k$ have the meanings described above.", "outputFormat": "For each operation of type 1, output a single integer representing the answer.", "hint": "Constraints and Hints\n\nFor 10% of the testdata, $n, m \\leq 1000$.\n\nFor 30% of the testdata, $n, m \\leq 30000$.\n\nFor 100% of the testdata, $n, m \\leq 100000, len \\leq 10$.\n\nThis easy problem uses bundled testdata. You can only receive the points for a subtask if you pass all testdata in that subtask.\n\nIf you are not interested in Shankouding (pinyin) and G&P, you can ignore the ending.\n\nIf you solved this problem:\n\nThe girls read your STD and all got AC on this problem, then went to help the war goddess.\n\nThey found 30 “183”s and blasted the enemy in the face.\n\nIf you didn’t solve this problem:\n\nAlthough the girls really wanted to help the war goddess, they couldn’t. After all, learning Sensha-dō doesn’t grant direct admissions.\n\nThere was no other way; they had to fight 8 versus 30.\n\nThe Rheinmetall camped in the bushes. No one on the University Team spotted it. After it destroyed five enemy tanks, its hull couldn’t withstand the gun’s recoil and it fell apart.\n\nThe StuG III also camped in the bushes. No one on the University Team spotted it, and it didn’t spot anyone either. In the end it couldn’t sit still, charged forward, destroyed a Pershing, and was then destroyed.\n\nThe Waffenträger reversed artistically. The University Team was dumbfounded when they saw it. After it destroyed eight enemy tanks, its hull couldn’t withstand the gun’s recoil and it fell apart.\n\nThe Tiger (P) took out the 95 with a single shot, then burned down due to an engine failure during repositioning.\n\nFinally, the French B1 fixed bayonets and stabbed 15 of them, turning the game around.\n\n![](https://cdn.luogu.com.cn/upload/pic/4762.png)\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "少女与战车", "background": "如果你对山口丁和 G&P 没有兴趣，可以无视题目背景，因为你估计看不懂 ……\n\n\n ![](https://cdn.luogu.com.cn/upload/pic/4760.png) \n\n在第 63 回战车道全国高中生大赛中，军神西住美穗带领大洗女子学院的大家打败了其他所有高中，取得了胜利，当然也就不用废校了。\n\n然而一群战车道的领导表示他们是口胡的，废校还是要废的。\n\n军神的母亲西住志穗怒斥废校男，为了不造个大新闻，废校男承诺如果大洗学院可以打败大学队，就不用废校。\n\n（有种 OI 选手 PK ACM 选手的感觉呀）\n\n然而实力差距太大了，大洗女子学院最强的车是虎式 P 型，而大学队清一色的 M26 潘兴，M24 霞飞，还有能跑到 20 的 T95 和卡尔臼炮，感觉根本没法打呀。\n\n这时候一个光头的胖子谢尔盖 • 布尔卡托夫斯基和一个身患癌症急需钱来治病的王姓 CEO 来帮助她们了。\n\n他们把一堆真实性堪忧的坦克图纸给了大洗学院的妹子们，并说这些图纸是真的，而且还原了历史。\n\n大洗学院汽车部的大家看到了这些图纸后非常高兴，开始膜改她们的战车。\n\n\n虎式P型 -> 蟋蟀17\n\n四号D型 -> 四号坦克武器运载车\n\n38(t)型 -> 莱茵金属公司武器运载车\n\nB1-bis  -> 105leFH18B2\n\n即使这样，只有 8 辆战车的大洗女子学院仍然无法打败有 30 辆战车的大学队。\n\n这时候按照剧本其他高中的小伙伴要来帮忙了，然而她们最近正在学习 OI，碰到了一道很神奇的数据结构题，不会做所以来不了。\n\n你作为一个三次元的国家队选手，当然能秒杀二次元的 OI 题啦。\n\n请帮帮她们吧！\n", "description": " ![](https://cdn.luogu.com.cn/upload/pic/4761.png) \n\n给你一个 $n$ 个点的有根树， $1$ 为根，带边权，有 $m$ 次操作。\n\n\n1、求 $x$ 的子树中第 $k$ 小的深度的值，如果子树中没有 $k$ 个点则输出 $-1$；\n\n2、将 $x$ 与 $x$ 父亲的边权加上 $k$。\n\n保证每次操作 2 的 $k$ 以及原树的边权小于等于一个数 $len$。\n\n\n如果操作 2 中 $x$ 为 $1$，那么视为将 $x$ 的基础深度加上了 $k$。\n", "inputFormat": " ![](https://cdn.luogu.com.cn/upload/pic/4763.png) \n\n第一行三个数 $n$、 $m$、$len$。\n\n之后 $n - 1$ 行每行两个数表示 $2$~$n$ 每个点的父亲编号，以及他们到父亲的边权。\n\n之后 $m$ 行每行三个数 $opt$、 $x$、$k$， $opt$ 表示操作种类， $x$、 $k$ 意义如题所述。\n", "outputFormat": "对于每个操作 1，输出一个数表示答案。\n", "hint": "数据范围与提示\n\n对于 10% 的数据， $n, m \\leq 1000$；\n\n对于 30% 的数据， $n, m \\leq 30000$；\n\n对于 100% 的数据，$ n, m \\leq 100000,len \\leq 10$。\n\n\n本水题采用捆绑测试，你只有通过该部分分的所有数据才可以得到该部分分的分数。\n\n\n如果你对山口丁和 G&P 没有兴趣，可以无视结局。\n\n\n\n如果你做出来了这个题\n\n\n妹子们看了你的 STD 之后都 A 了这个题，然后去帮助军神。\n\n她们找了 30 个 183 射了对面一脸。\n\n\n如果你没做出来这个题\n\n\n妹子们虽然很想帮助军神，但是也爱莫能助，毕竟学战车道不能保送。\n\n没有办法，只能 8 打 30 了。\n\n莱茵蹲在草里，大学队没有人发现它，成功击杀五辆敌方坦克后因为车体无法承受火炮后坐力而解体。\n\n三突也蹲在草里，大学队没有人发现它，它也没有发现任何人，最后蹲不住了去突击，击毁一辆潘兴后被击毁。\n\n四运文艺倒车，大学队看到之后目瞪口呆，成功击杀八辆敌方坦克后因为车体无法承受火炮后坐力而解体。\n\n虎P炮一发带走了 95，然后因为转场的时候发动机故障而烧毁。\n\n最后法五金刺刀了 15 个，成功翻盘。\n\n![](https://cdn.luogu.com.cn/upload/pic/4762.png)\n", "locale": "zh-CN"}}}
{"pid": "P3713", "type": "P", "difficulty": 6, "samples": [["2 2\n.*\n*.", "72"], ["2 3\n.*.\n*.*", "418"], ["4 4\nabba\nbaab\nbaab\nabba", "44512"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["动态规划 DP", "搜索", "2017", "各省省选", "北京", "记忆化搜索"], "title": "[BJOI2017] 机动训练", "background": "> AM 4:45\n>\n> 又是晴朗的好天气。\n>\n> AM 5:00\n>\n> 不要嘛，再睡一会\n>\n> AM 5:05\n>\n> 呜……欺负人", "description": "睡眼朦胧的菜酱 (?) 已经被二爷拉起来晨跑了。而这个时间你在做什么呢？\n\n咳咳，言归正传，最近菜酱的训练遇到了点小麻烦。\n\n凌晨绕格瑞赛亚岛跑一圈是基本，在那之后，菜酱还要接受严格的机动训练。所谓机动训练，就是在紧急情况 (?) 下，高速且隐蔽地从位置 $s$ 移动到位置 $t$ 的训练。一般来说，$s$ 和 $t$ 是根据二爷的心情随机决定的，但是由于菜酱已经熟悉了地形，每次总是能找到不太费劲的路径，二爷决定增大难度。所谓增大难度，其实就是指定整条路径，这样菜酱就没办法抄近道了。当然，由于是为了实战而进行的训练，二爷也不会随便乱指定路径，至少不会故意绕路。然后发生的问题就是，如何才能「随机」一整条路径出来？二爷统计了全岛所有的合法路径，打算每次在这个表格里随机抽一条出来。但是很快二爷发现，许多路径所经过的地形是完全相同的，这类路径的训练会更加有用。于是二爷修改了随机策略，地形较为常见的路径权重会变得更大。\n\n一次偶然的机会，菜酱看到了二爷的随机策略，并发动技能「过目不忘 (?)」记了下来。现在你要帮菜酱分析数据。\n\n为什么是你？当然是因为否则就会被菜酱爆头 (并不)。\n\n整个岛可以看作一片 $m\\times n$ 的区域，每个格子有自己的地形。\n\n一条路径由一系列八连通的格子组成，两个格子八连通当且仅当这两个格子拥有公共的顶点。\n\n定义一条“机动路径”如下：\n\n1. 它是一条不自交的路径，即路径上任意两个格子都不是同一个。\n2. 它的起点和终点处于不同位置，换言之这条路径至少包含 $2$ 个格子。\n3. 从起点开始，任何一步只能向不远离终点的方向移动，这里不远离指的是 $x$ 和 $y$ 两个方向都不远离。\n\n举例说明：\n\n```plain\n.....t    ......    .---.\n-++...    ---...    .-s-.\n-s+...    -s+..t    .-+-.\n---...    ---...    ..t..\n```\n\n图中加号和减号标明了与 $s$ 八连通的所有格子，其中加号是“不远离 $t$”的方向。\n\n因此可以看出，如下路径是机动路径：\n\n```plain\n++++++t    ......+t    .......t\n+......    .....++.    ......+.\n+......    ..++++..    ...+++..\ns......    s++.....    s+++....\n```\n\n而如下路径不是机动路径：\n\n```plain\n\\../---t    .......t    .s.\n|--.....    ....../.    /..\n|.......    s..../..    \\..\ns.......    .\\--/...    .t.\n```\n\n需要注意的是，某些不合法的路径甚至比机动路径还要短，这是因为机动路径不是按照长度来定义的。\n\n接下来定义一条机动路径的地形，岛上的地形由一个矩阵给出，如：\n\n```plain\n.**.\n*..*\n*..*\n.**.\n```\n\n那么，一条机动路径的地形序列就是它所经过的地形排成一列，如：\n\n```plain\ns-\\.\n...\\\n...|\n...t\n```\n\n地形序列就是 `.****.`。\n\n每条机动路径的权重就是与之拥有相同地形序列的机动路径数量之和，例如与这条路径拥有相同地形序列的路径有\n\n```plain\n./-t    t...    ...s    s-\\.    ./-s    s...    ...t    t-\\.\n/...    |...    ...|    ...\\    /...    |...    ...|    ...\\\n|...    \\...    .../    ...|    |...    \\...    .../    ...|\ns...    .\\-s    t-/.    ...t    t...    .\\-t    s-/.    ...s\n```\n\n共 $8$ 条，注意回文时正反算两条，以及自己也算一条。\n\n所以这条机动路径的权重是 $8$，同时所有这 $8$ 条机动路径的权重都是 $8$。\n\n现在你需要统计所有的机动路径权重之和。\n\n如果对这种统计方式没有直观的感受，可以查看样例说明。\n", "inputFormat": "第一行两个整数 $m,n$，表示岛的大小。\n\n接下来 $m$ 行，每行 $n$ 个字符，表示岛的地形。", "outputFormat": "仅一个数，表示所有机动路径的权重之和。\n\n由于这个数可能很大，你只需要输出它对 $10^9+9$ 取模的结果。", "hint": "### 样例解释 1\n用中括号括起来的一些数对表示一条机动路径，坐标先行后列：\n\n- 地形序列 `.*`：$[(1, 1), (1, 2)],\\ [(1, 1), (2, 1)],\\ [(2, 2), (2, 1)],\\ [(2, 2), (1, 2)]$，共 $4$ 条，每条权重为 $4$，计 $16$。\n- 地形序列 `*.`：$[(1, 2), (1, 1)],\\ [(2, 1), (1, 1)],\\ [(2, 1), (2, 2)],\\ [(1, 2), (2, 2)]$，共 $4$ 条，每条权重为 $4$，计 $16$。\n- 地形序列 `..`：$[(1, 1), (2, 2)],\\ [(2, 2), (1, 1)]$，共 $2$ 条，每条权重为 $2$，计 $4$。\n- 地形序列 `**`：$[(1, 2), (2, 1)],\\ [(2, 1), (1, 2)]$，共 $2$ 条，每条权重为 $2$，计 $4$。\n- 地形序列 `.*.`：$[(1, 1), (1, 2), (2, 2)],\\ [(1, 1), (2, 1), (2, 2)],\\ [(2, 2), (2, 1), (1, 1)],\\ [(2, 2), (1, 2), (1, 1)]$，共 $4$ 条，每条权重为 $4$，计 $16$。\n- 地形序列 `*.*`：$[(1, 2), (1, 1), (2, 1)],\\ [(2, 1), (1, 1), (1, 2)],\\ [(1, 2), (2, 2), (2, 1)],\\ [(2, 1), (2, 2), (1, 2)]$，共 $4$ 条，每条权重为 $4$，计 $16$。\n\n共计 $16+16+4+4+16+16=72$。\n\n### 样例解释 2\n- 地形序列 `.*`：$7$ 条，每条权重为 $7$，计 $49$。\n- 地形序列 `*.`：$7$ 条，每条权重为 $7$，计 $49$。\n- 地形序列 `..`：$4$ 条，每条权重为 $4$，计 $16$。\n- 地形序列 `**`：$4$ 条，每条权重为 $4$，计 $16$。\n- 地形序列 `..*`：$2$ 条，每条权重为 $2$，计 $4$。\n- 地形序列 `.*.`：$10$ 条，每条权重为 $10$，计 $100$。\n- 地形序列 `.**`：$2$ 条，每条权重为 $2$，计 $4$。\n- 地形序列 `*..`：$2$ 条，每条权重为 $2$，计 $4$。\n- 地形序列 `*.*`：$10$ 条，每条权重为 $10$，计 $100$。\n- 地形序列 `**.`：$2$ 条，每条权重为 $2$，计 $4$。\n- 地形序列 `.*.*`：$6$ 条，每条权重为 $6$，计 $36$。\n- 地形序列 `*.*.`：$6$ 条，每条权重为 $6$，计 $36$。\n\n共计 $49+49+16+16+4+100+4+4+100+4+36+36=418$。\n\n### 数据范围\n\n- 对于 $10\\%$ 的数据，$m\\times n \\le 4$。\n- 对于 $30\\%$ 的数据，$m, n \\le 5$。\n- 对于 $60\\%$ 的数据，$m, n \\le 10$。\n- 另有 $20\\%$ 的数据，所有地形均相同。\n- 对于 $100\\%$ 的数据，$1 \\le m, n \\le 30$，字符集由大小写字母，数字和 `.` `*` 构成。", "locale": "zh-CN", "translations": {"en": {"title": "[BJOI2017] Mobility Training", "background": "> AM 4:45\n>\n> Another clear, sunny day.\n>\n> AM 5:00\n>\n> Nooo, let me sleep a bit more.\n>\n> AM 5:05\n>\n> Ugh... bullying me.\n\nSleepy Caijiang (?) has already been dragged out by Er-ye for a morning run. And what are you doing at this time?\n\nAhem, back to the topic. Caijiang’s recent training has run into a small problem.\n\nRunning one lap around Grisaia Island before dawn is basic. After that, Caijiang must also undergo strict mobility training. “Mobility training” means, under an emergency situation (?), moving quickly and covertly from position $s$ to position $t$. In general, $s$ and $t$ are chosen at random according to Er-ye’s mood. But since Caijiang has already learned the terrain, she always finds a not-so-hard path, so Er-ye decided to increase the difficulty. Increasing the difficulty basically means specifying the entire path so that Caijiang cannot take shortcuts. Of course, because this is training for real combat, Er-ye will not assign paths arbitrarily, at least not deliberately detouring. The problem that arises is: how to “randomly” pick an entire path? Er-ye counted all legal paths on the whole island and planned to randomly draw one each time from this table. But he soon found that many paths go through exactly the same terrains, and such paths are more useful for training. So he changed the random strategy: paths with more common terrain sequences get larger weights.\n\nBy chance, Caijiang saw Er-ye’s random strategy and used the skill “photographic memory (?)” to memorize it. Now you need to help Caijiang analyze the data.\n\nWhy you? Because otherwise Caijiang will headshot you (not really).\n\nThe entire island can be seen as an $m\\times n$ area, each cell with its own terrain.\n\nA path is a sequence of 8-connected cells; two cells are 8-connected if and only if the two cells share a common corner.\n\nDefine a “mobility path” as follows:\n\n1. It is a simple path, that is, no two cells on the path are the same.\n2. Its start and end are in different positions; in other words, the path contains at least $2$ cells.\n3. Starting from the beginning, each step can only move in a direction that does not move away from the destination; here “not moving away” means that in both the $x$ and $y$ directions you do not move away.\n\nIllustration:\n\n```plain\n.....t    ......    .---.\n-++...    ---...    .-s-.\n-s+...    -s+..t    .-+-.\n---...    ---...    ..t..\n```\n\nIn the figure, plus and minus signs mark all cells that are 8-connected to $s$, where plus signs indicate directions that are “not moving away from $t$.”\n\nTherefore, the following paths are mobility paths:\n\n```plain\n++++++t    ......+t    .......t\n+......    .....++.    ......+.\n+......    ..++++..    ...+++..\ns......    s++.....    s+++....\n```\n\nAnd the following are not mobility paths:\n\n```plain\n\\../---t    .......t    .s.\n|--.....    ....../.    /..\n|.......    s..../..    \\..\ns.......    .\\--/...    .t.\n```\n\nNote that some illegal paths can even be shorter than mobility paths, because mobility paths are not defined by their length.\n\nNext, define the terrain of a mobility path. The island’s terrain is given by a matrix, for example:\n\n```plain\n.**.\n*..*\n*..*\n.**.\n```\n\nThen the terrain sequence of a mobility path is the terrains it passes through listed in order, such as:\n\n```plain\ns-\\.\n...\\\n...|\n...t\n```\n\nThe terrain sequence is `.****.`.\n\nThe weight of each mobility path is the total number of mobility paths that have the same terrain sequence. For example, the paths that have the same terrain sequence as this path are\n\n```plain\n./-t    t...    ...s    s-\\.    ./-s    s...    ...t    t-\\.\n/...    |...    ...|    ...\\    /...    |...    ...|    ...\\\n|...    \\...    .../    ...|    |...    \\...    .../    ...|\ns...    .\\-s    t-/.    ...t    t...    .\\-t    s-/.    ...s\n```\n\nThere are $8$ of them. Note that when the sequence is a palindrome, forward and reverse still count as two, and the path itself also counts.\n\nSo the weight of this mobility path is $8$, and all these $8$ mobility paths have weight $8$ as well.\n\nNow you need to sum the weights of all mobility paths.\n\nIf this counting method is not intuitive, see the sample explanations.", "description": "Input the island’s terrain grid and compute the sum of weights over all mobility paths, where the weight of a mobility path is the number of mobility paths sharing the same terrain sequence. Output the result modulo $10^9+9$.", "inputFormat": "The first line contains two integers $m, n$, the size of the island.\n\nThen follow $m$ lines, each containing $n$ characters, describing the island’s terrain.", "outputFormat": "Output a single number, the sum of weights over all mobility paths, modulo $10^9+9$.", "hint": "### Sample Explanation 1\nPairs in square brackets denote a mobility path, with coordinates in the order row, column:\n\n- Terrain sequence `.*`: $[(1, 1), (1, 2)],\\ [(1, 1), (2, 1)],\\ [(2, 2), (2, 1)],\\ [(2, 2), (1, 2)]$, $4$ paths in total, each with weight $4$, contributing $16$.\n- Terrain sequence `*.`: $[(1, 2), (1, 1)],\\ [(2, 1), (1, 1)],\\ [(2, 1), (2, 2)],\\ [(1, 2), (2, 2)]$, $4$ paths in total, each with weight $4$, contributing $16$.\n- Terrain sequence `..`: $[(1, 1), (2, 2)],\\ [(2, 2), (1, 1)]$, $2$ paths in total, each with weight $2$, contributing $4$.\n- Terrain sequence `**`: $[(1, 2), (2, 1)],\\ [(2, 1), (1, 2)]$, $2$ paths in total, each with weight $2$, contributing $4$.\n- Terrain sequence `.*.`: $[(1, 1), (1, 2), (2, 2)],\\ [(1, 1), (2, 1), (2, 2)],\\ [(2, 2), (2, 1), (1, 1)],\\ [(2, 2), (1, 2), (1, 1)]$, $4$ paths in total, each with weight $4$, contributing $16$.\n- Terrain sequence `*.*`: $[(1, 2), (1, 1), (2, 1)],\\ [(2, 1), (1, 1), (1, 2)],\\ [(1, 2), (2, 2), (2, 1)],\\ [(2, 1), (2, 2), (1, 2)]$, $4$ paths in total, each with weight $4$, contributing $16$.\n\nTotal: $16+16+4+4+16+16=72$.\n\n### Sample Explanation 2\n- Terrain sequence `.*`: $7$ paths, each with weight $7$, contributing $49$.\n- Terrain sequence `*.`: $7$ paths, each with weight $7$, contributing $49$.\n- Terrain sequence `..`: $4$ paths, each with weight $4$, contributing $16$.\n- Terrain sequence `**`: $4$ paths, each with weight $4$, contributing $16$.\n- Terrain sequence `..*`: $2$ paths, each with weight $2$, contributing $4$.\n- Terrain sequence `.*.`: $10$ paths, each with weight $10$, contributing $100$.\n- Terrain sequence `.**`: $2$ paths, each with weight $2$, contributing $4$.\n- Terrain sequence `*..`: $2$ paths, each with weight $2$, contributing $4$.\n- Terrain sequence `*.*`: $10$ paths, each with weight $10$, contributing $100$.\n- Terrain sequence `**.`: $2$ paths, each with weight $2$, contributing $4$.\n- Terrain sequence `.*.*`: $6$ paths, each with weight $6$, contributing $36$.\n- Terrain sequence `*.*.`: $6$ paths, each with weight $6$, contributing $36$.\n\nTotal: $49+49+16+16+4+100+4+4+100+4+36+36=418$.\n\n### Constraints\n\n- For $10\\%$ of the testdata, $m\\times n \\le 4$.\n- For $30\\%$ of the testdata, $m, n \\le 5$.\n- For $60\\%$ of the testdata, $m, n \\le 10$.\n- In an additional $20\\%$ of the testdata, all terrains are the same.\n- For $100\\%$ of the testdata, $1 \\le m, n \\le 30$, and the character set consists of uppercase letters, lowercase letters, digits, and `.` `*`.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[BJOI2017] 机动训练", "background": "> AM 4:45\n>\n> 又是晴朗的好天气。\n>\n> AM 5:00\n>\n> 不要嘛，再睡一会\n>\n> AM 5:05\n>\n> 呜……欺负人", "description": "睡眼朦胧的菜酱 (?) 已经被二爷拉起来晨跑了。而这个时间你在做什么呢？\n\n咳咳，言归正传，最近菜酱的训练遇到了点小麻烦。\n\n凌晨绕格瑞赛亚岛跑一圈是基本，在那之后，菜酱还要接受严格的机动训练。所谓机动训练，就是在紧急情况 (?) 下，高速且隐蔽地从位置 $s$ 移动到位置 $t$ 的训练。一般来说，$s$ 和 $t$ 是根据二爷的心情随机决定的，但是由于菜酱已经熟悉了地形，每次总是能找到不太费劲的路径，二爷决定增大难度。所谓增大难度，其实就是指定整条路径，这样菜酱就没办法抄近道了。当然，由于是为了实战而进行的训练，二爷也不会随便乱指定路径，至少不会故意绕路。然后发生的问题就是，如何才能「随机」一整条路径出来？二爷统计了全岛所有的合法路径，打算每次在这个表格里随机抽一条出来。但是很快二爷发现，许多路径所经过的地形是完全相同的，这类路径的训练会更加有用。于是二爷修改了随机策略，地形较为常见的路径权重会变得更大。\n\n一次偶然的机会，菜酱看到了二爷的随机策略，并发动技能「过目不忘 (?)」记了下来。现在你要帮菜酱分析数据。\n\n为什么是你？当然是因为否则就会被菜酱爆头 (并不)。\n\n整个岛可以看作一片 $m\\times n$ 的区域，每个格子有自己的地形。\n\n一条路径由一系列八连通的格子组成，两个格子八连通当且仅当这两个格子拥有公共的顶点。\n\n定义一条“机动路径”如下：\n\n1. 它是一条不自交的路径，即路径上任意两个格子都不是同一个。\n2. 它的起点和终点处于不同位置，换言之这条路径至少包含 $2$ 个格子。\n3. 从起点开始，任何一步只能向不远离终点的方向移动，这里不远离指的是 $x$ 和 $y$ 两个方向都不远离。\n\n举例说明：\n\n```plain\n.....t    ......    .---.\n-++...    ---...    .-s-.\n-s+...    -s+..t    .-+-.\n---...    ---...    ..t..\n```\n\n图中加号和减号标明了与 $s$ 八连通的所有格子，其中加号是“不远离 $t$”的方向。\n\n因此可以看出，如下路径是机动路径：\n\n```plain\n++++++t    ......+t    .......t\n+......    .....++.    ......+.\n+......    ..++++..    ...+++..\ns......    s++.....    s+++....\n```\n\n而如下路径不是机动路径：\n\n```plain\n\\../---t    .......t    .s.\n|--.....    ....../.    /..\n|.......    s..../..    \\..\ns.......    .\\--/...    .t.\n```\n\n需要注意的是，某些不合法的路径甚至比机动路径还要短，这是因为机动路径不是按照长度来定义的。\n\n接下来定义一条机动路径的地形，岛上的地形由一个矩阵给出，如：\n\n```plain\n.**.\n*..*\n*..*\n.**.\n```\n\n那么，一条机动路径的地形序列就是它所经过的地形排成一列，如：\n\n```plain\ns-\\.\n...\\\n...|\n...t\n```\n\n地形序列就是 `.****.`。\n\n每条机动路径的权重就是与之拥有相同地形序列的机动路径数量之和，例如与这条路径拥有相同地形序列的路径有\n\n```plain\n./-t    t...    ...s    s-\\.    ./-s    s...    ...t    t-\\.\n/...    |...    ...|    ...\\    /...    |...    ...|    ...\\\n|...    \\...    .../    ...|    |...    \\...    .../    ...|\ns...    .\\-s    t-/.    ...t    t...    .\\-t    s-/.    ...s\n```\n\n共 $8$ 条，注意回文时正反算两条，以及自己也算一条。\n\n所以这条机动路径的权重是 $8$，同时所有这 $8$ 条机动路径的权重都是 $8$。\n\n现在你需要统计所有的机动路径权重之和。\n\n如果对这种统计方式没有直观的感受，可以查看样例说明。\n", "inputFormat": "第一行两个整数 $m,n$，表示岛的大小。\n\n接下来 $m$ 行，每行 $n$ 个字符，表示岛的地形。", "outputFormat": "仅一个数，表示所有机动路径的权重之和。\n\n由于这个数可能很大，你只需要输出它对 $10^9+9$ 取模的结果。", "hint": "### 样例解释 1\n用中括号括起来的一些数对表示一条机动路径，坐标先行后列：\n\n- 地形序列 `.*`：$[(1, 1), (1, 2)],\\ [(1, 1), (2, 1)],\\ [(2, 2), (2, 1)],\\ [(2, 2), (1, 2)]$，共 $4$ 条，每条权重为 $4$，计 $16$。\n- 地形序列 `*.`：$[(1, 2), (1, 1)],\\ [(2, 1), (1, 1)],\\ [(2, 1), (2, 2)],\\ [(1, 2), (2, 2)]$，共 $4$ 条，每条权重为 $4$，计 $16$。\n- 地形序列 `..`：$[(1, 1), (2, 2)],\\ [(2, 2), (1, 1)]$，共 $2$ 条，每条权重为 $2$，计 $4$。\n- 地形序列 `**`：$[(1, 2), (2, 1)],\\ [(2, 1), (1, 2)]$，共 $2$ 条，每条权重为 $2$，计 $4$。\n- 地形序列 `.*.`：$[(1, 1), (1, 2), (2, 2)],\\ [(1, 1), (2, 1), (2, 2)],\\ [(2, 2), (2, 1), (1, 1)],\\ [(2, 2), (1, 2), (1, 1)]$，共 $4$ 条，每条权重为 $4$，计 $16$。\n- 地形序列 `*.*`：$[(1, 2), (1, 1), (2, 1)],\\ [(2, 1), (1, 1), (1, 2)],\\ [(1, 2), (2, 2), (2, 1)],\\ [(2, 1), (2, 2), (1, 2)]$，共 $4$ 条，每条权重为 $4$，计 $16$。\n\n共计 $16+16+4+4+16+16=72$。\n\n### 样例解释 2\n- 地形序列 `.*`：$7$ 条，每条权重为 $7$，计 $49$。\n- 地形序列 `*.`：$7$ 条，每条权重为 $7$，计 $49$。\n- 地形序列 `..`：$4$ 条，每条权重为 $4$，计 $16$。\n- 地形序列 `**`：$4$ 条，每条权重为 $4$，计 $16$。\n- 地形序列 `..*`：$2$ 条，每条权重为 $2$，计 $4$。\n- 地形序列 `.*.`：$10$ 条，每条权重为 $10$，计 $100$。\n- 地形序列 `.**`：$2$ 条，每条权重为 $2$，计 $4$。\n- 地形序列 `*..`：$2$ 条，每条权重为 $2$，计 $4$。\n- 地形序列 `*.*`：$10$ 条，每条权重为 $10$，计 $100$。\n- 地形序列 `**.`：$2$ 条，每条权重为 $2$，计 $4$。\n- 地形序列 `.*.*`：$6$ 条，每条权重为 $6$，计 $36$。\n- 地形序列 `*.*.`：$6$ 条，每条权重为 $6$，计 $36$。\n\n共计 $49+49+16+16+4+100+4+4+100+4+36+36=418$。\n\n### 数据范围\n\n- 对于 $10\\%$ 的数据，$m\\times n \\le 4$。\n- 对于 $30\\%$ 的数据，$m, n \\le 5$。\n- 对于 $60\\%$ 的数据，$m, n \\le 10$。\n- 另有 $20\\%$ 的数据，所有地形均相同。\n- 对于 $100\\%$ 的数据，$1 \\le m, n \\le 30$，字符集由大小写字母，数字和 `.` `*` 构成。", "locale": "zh-CN"}}}
{"pid": "P3714", "type": "P", "difficulty": 6, "samples": [["5 3 1 4\n-1 -5 -2\n1 2 1\n1 3 1\n2 4 2\n2 5 3", "-1"], ["8 4 3 4\n-7 9 6 1\n1 2 1\n1 3 2\n1 4 1\n2 5 1\n5 6 2\n3 7 1\n3 8 3", "11"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["2017", "各省省选", "点分治", "单调队列", "北京", "分治", "深度优先搜索 DFS"], "title": "[BJOI2017] 树的难题", "background": "", "description": "给你一棵 $n$ 个点的无根树。\n\n树上的每条边具有颜色。一共有 $m$ 种颜色，编号为 $1$ 到 $m$，第 $i$ 种颜色的权值为 $c_i$。\n\n对于一条树上的简单路径，路径上经过的所有边按顺序组成一个颜色序列，序列可以划分成若干个相同颜色段。定义路径权值为颜色序列上每个同颜色段的颜色权值之和。\n\n请你计算，经过边数在 $l$ 到 $r$ 之间的所有简单路径中，路径权值的最大值。", "inputFormat": "第一行，四个整数 $n, m, l, r$。\n\n第二行，$m$ 个整数 $c_1, c_2, \\ldots, c_m$，由空格隔开，依次表示每个颜色的权值。\n\n接下来 $n-1$ 行，每行三个整数 $u, v, c$，表示点 $u$ 和点 $v$ 之间有一条颜色为 $c$ 的边。", "outputFormat": "输出一行，一个整数，表示答案。\n", "hint": "### 样例解释 1\n颜色权值均为负，最优路径为 $(1, 2)$ 或 $(1, 3)$。\n\n### 样例解释 2\n最优路径为 $(3, 1, 2, 5, 6)$，其颜色序列为 $(2, 1, 1, 2)$。\n\n### 数据范围\n| 测试点编号 | $n$ | $m$ | 特殊限制 |\n|-|-|-|-|\n| $1$ | $=10^3$ | $\\le n$ | 无特殊限制 |\n| $2$ | $=10^4$ | $=2$ | 无特殊限制 |\n| $3$ | $=10^5$ | $\\le n$ | 所有点的度数不超过 $2$ |\n| $4$ | $=2\\times10^5$ | $\\le n$ | 所有点的度数不超过 $2$ |\n| $5$ | $=10^5$ | $=10$ | $l=1$，$r=n-1$ |\n| $6$ | $=2\\times10^5$ | $\\le n$ | $l=1$，$r=n-1$ |\n| $7$ | $=10^5$ | $=50$ | 无特殊限制 |\n| $8$ | $=10^5$ | $\\le n$ | 无特殊限制 |\n| $9$ | $=2\\times 10^5$ | $=100$ | 无特殊限制 |\n| $10$ | $=2\\times 10^5$ | $\\le n$ | 无特殊限制 |\n\n对于 $100\\%$ 的数据，$1 \\leq n, m \\leq 2 \\times 10^5$，$1 \\leq l \\leq r \\leq n$，$\\mid c_i \\mid \\leq 10^4$。保证树上至少存在一条经过边数在 $l$ 到 $r$ 之间的路径。", "locale": "zh-CN", "translations": {"en": {"title": "[BJOI2017] A Hard Problem on Trees", "background": "", "description": "You are given an unrooted tree with $n$ nodes.\n\nEach edge of the tree has a color. There are $m$ colors, numbered from $1$ to $m$, and the weight of the $i$-th color is $c_i$.\n\nFor a simple path on the tree, the edges along the path form a color sequence in order, which can be split into several segments of the same color. Define the path value as the sum of the color weights of each same-color segment in the sequence.\n\nPlease compute the maximum path value among all simple paths whose number of edges is between $l$ and $r$.", "inputFormat": "The first line contains four integers $n, m, l, r$.\n\nThe second line contains $m$ integers $c_1, c_2, \\ldots, c_m$, separated by spaces, representing the weight of each color in order.\n\nThe next $n-1$ lines each contain three integers $u, v, c$, indicating that there is an edge between node $u$ and node $v$ with color $c$.", "outputFormat": "Output one line with a single integer, the answer.", "hint": "Sample explanation 1:\nAll color weights are negative, and the optimal path is $(1, 2)$ or $(1, 3)$.\n\nSample explanation 2:\nThe optimal path is $(3, 1, 2, 5, 6)$, and its color sequence is $(2, 1, 1, 2)$.\n\nConstraints\n| Testpoint ID | $n$ | $m$ | Special constraints |\n|-|-|-|-|\n| $1$ | $=10^3$ | $\\le n$ | None |\n| $2$ | $=10^4$ | $=2$ | None |\n| $3$ | $=10^5$ | $\\le n$ | The degree of every node is at most $2$ |\n| $4$ | $=2\\times10^5$ | $\\le n$ | The degree of every node is at most $2$ |\n| $5$ | $=10^5$ | $=10$ | $l=1$, $r=n-1$ |\n| $6$ | $=2\\times10^5$ | $\\le n$ | $l=1$, $r=n-1$ |\n| $7$ | $=10^5$ | $=50$ | None |\n| $8$ | $=10^5$ | $\\le n$ | None |\n| $9$ | $=2\\times 10^5$ | $=100$ | None |\n| $10$ | $=2\\times 10^5$ | $\\le n$ | None |\n\nFor $100\\%$ of the testdata, $1 \\leq n, m \\leq 2 \\times 10^5$, $1 \\leq l \\leq r \\leq n$, and $\\lvert c_i \\rvert \\leq 10^4$. It is guaranteed that there exists at least one path whose number of edges is between $l$ and $r$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[BJOI2017] 树的难题", "background": "", "description": "给你一棵 $n$ 个点的无根树。\n\n树上的每条边具有颜色。一共有 $m$ 种颜色，编号为 $1$ 到 $m$，第 $i$ 种颜色的权值为 $c_i$。\n\n对于一条树上的简单路径，路径上经过的所有边按顺序组成一个颜色序列，序列可以划分成若干个相同颜色段。定义路径权值为颜色序列上每个同颜色段的颜色权值之和。\n\n请你计算，经过边数在 $l$ 到 $r$ 之间的所有简单路径中，路径权值的最大值。", "inputFormat": "第一行，四个整数 $n, m, l, r$。\n\n第二行，$m$ 个整数 $c_1, c_2, \\ldots, c_m$，由空格隔开，依次表示每个颜色的权值。\n\n接下来 $n-1$ 行，每行三个整数 $u, v, c$，表示点 $u$ 和点 $v$ 之间有一条颜色为 $c$ 的边。", "outputFormat": "输出一行，一个整数，表示答案。\n", "hint": "### 样例解释 1\n颜色权值均为负，最优路径为 $(1, 2)$ 或 $(1, 3)$。\n\n### 样例解释 2\n最优路径为 $(3, 1, 2, 5, 6)$，其颜色序列为 $(2, 1, 1, 2)$。\n\n### 数据范围\n| 测试点编号 | $n$ | $m$ | 特殊限制 |\n|-|-|-|-|\n| $1$ | $=10^3$ | $\\le n$ | 无特殊限制 |\n| $2$ | $=10^4$ | $=2$ | 无特殊限制 |\n| $3$ | $=10^5$ | $\\le n$ | 所有点的度数不超过 $2$ |\n| $4$ | $=2\\times10^5$ | $\\le n$ | 所有点的度数不超过 $2$ |\n| $5$ | $=10^5$ | $=10$ | $l=1$，$r=n-1$ |\n| $6$ | $=2\\times10^5$ | $\\le n$ | $l=1$，$r=n-1$ |\n| $7$ | $=10^5$ | $=50$ | 无特殊限制 |\n| $8$ | $=10^5$ | $\\le n$ | 无特殊限制 |\n| $9$ | $=2\\times 10^5$ | $=100$ | 无特殊限制 |\n| $10$ | $=2\\times 10^5$ | $\\le n$ | 无特殊限制 |\n\n对于 $100\\%$ 的数据，$1 \\leq n, m \\leq 2 \\times 10^5$，$1 \\leq l \\leq r \\leq n$，$\\mid c_i \\mid \\leq 10^4$。保证树上至少存在一条经过边数在 $l$ 到 $r$ 之间的路径。", "locale": "zh-CN"}}}
