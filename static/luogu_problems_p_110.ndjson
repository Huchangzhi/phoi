{"pid": "P3229", "type": "P", "difficulty": 7, "samples": [["8  3\n2  0\n3  1\n4  1\n1  0\n5  0\n6  1\n7  1\n8  0", "1 6 8"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["动态规划 DP", "2013", "各省省选", "单调队列", "湖南"], "title": "[HNOI2013] 旅行", "background": "", "description": "在遥远的 HX 国，住着一个旅行家小 L，他希望骑着他的自行车游遍全国。在这个国家中，每个城市都有一个编号，共有 $n$ 个城市，编号从 $1$ 到 $n$。\n\n有的城市没有小 L 想去的景点，而有的城市有且仅有一个小 L 想去的景点，所有的城市都是这两种情况之一，小 L 非常热爱信息学，他编写程序给他的旅行安排了一条最短路线以到达所有他想去的景点（所有的通知旅行线路上城市编号是乱序的）：他第 $1$ 个到达的城市编号为 $a_1$，第 $i$ 个到达的城市编号为 $a_i$，最后到达城市 $a_n$ 结束这次旅行。小L希望用恰好的 $m$ 个月（$m<n$）的时间完成这次旅行，所以他需要制定一个理性的旅游计划。\n\n当他抵达一个城市时，如果这个城市有他想要去的景点，他会因此获得 $1$ 点快乐值；但是若到达的城市没有他想去的景点，他会因旅途的疲惫得到 $1$ 点的疲劳值：一个月的时间足够他游玩任意多个城市，但他也希望拿出一点时间来休息。他每个月总是在本月所到达的最后一个城市休息（但如果这个城市有景点，那么小 L 总会游玩这个景点再休息）。当然，小 L 希望每个月都能有一定的旅行任务。即便这个月他所到达的城市中并没有他想去的的景点，换句话说，每个月他都会至少到达一个新的城市。\n\n小 L 无法自己安排旅行计划，所以求助于你。你需要告诉他一个序列：$x_1,x_2,\\ldots,x_m$，其中 $x_i$ 表示小 L 第 $i$ 个月休息时。他所在的城市编号：由于他最后一个月必须完成他的旅行，所以 $x_m$ 肯定等于 $a_n$，例如，设 $n=5$，$m=3$，$(a_1,a_2,a_3,a_4,a_5)=(3,2,4,1,5)$，$(x_1,x_2,x_3)=(2,1,5)$，这意味着：第 $1$ 个月先后到达 $3$ 号和 $2$ 号城市，并在 $2$ 号城市休息：第 $2$ 个月先后到达 $4$ 号和 $1$ 号城市，并在 $1$ 号城市休息：第 $3$ 个月到达 $5$ 号城市，并在 $5$ 号城市休息。\n\n这样的方案序列有很多种，设每种方案序列中第 $i$ 个月旅行中当月获得的快乐值与疲劳值的差绝对值为 $d_i$，设第 $k$ 种方案序列中求出的 $d_1,d_2,\\ldots,d_m$ 这个 $m$ 值的最大值为 $c_k$，小 L 希望所选择的方案序列的 $c_k$ 在所有方案序列中是最小的。\n\n事实上，可能有多个方案序列的 $c_k$ 达到并列最小值。由于小 L 喜爱编程，他患上了一定的强迫症（虽然他自己认为他的强迫症让他炫的发黄），他希望给他的序列是这多个方案中字典序最小的。\n\nTips：比较两个序列字典序即比较第一个不相同数字的大小，如 $(1,2,3,4)<(1,2,4,3)$。", "inputFormat": "第一行为两个空格隔开的正整数 $n, m$，表示旅行的城市数与旅行所花的月数。\n\n接下来 $n$ 行，其中第 $i$ 行包含两个空格隔开的整数 $A_i$ 和 $B_i$，$A_i$ 表示他第 $i$ 个去的城市编号，$B_i$ 为 $0$ 或 $1$。如果 $B_i=0$ 则表示城市 $A_i$ 没有小 L 想去的景点，如果 $B_i=1$ 则表示城市 $A_i$ 有小 L 想去的景点，$A_i$ 两两不同且有 $1\\leq  A_i\\leq N$，即 $\\{A_i\\}$ 为 $1,2,\\ldots,N$ 的一个排列。", "outputFormat": "输出仅包含一行，包含 $m$ 个空格隔开的正整数 $X_1,X_2,\\ldots,X_m$，即给小 L 安排的旅行计划对应的路线。\n", "hint": "第 $1$ 个月得到 $2$ 点快乐值与 $2$ 点疲劳值，第 $2$ 个月得到 $1$ 点快乐值与 $1$ 点疲劳值，第 $3$ 个月得到 $1$ 点快乐值与 $1$ 点疲劳值。$3$ 个月中疲劳值与快乐值差的最大值为 $0$，达到所有方案最小值。\n\n可行方案有：\n\n- 1 6 8\n- 3 6 8\n- 3 1 8\n\n其中 1 6 8 字典序最小。\n\n$N \\leq 5 \\times 10^5$，$M \\leq 2 \\times 10^5$。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2013] Travel", "background": "", "description": "In the distant country of HX, there lives a traveler named Xiao L. He wants to ride his bicycle across the entire country. There are $n$ cities in this country, numbered from $1$ to $n$.\n\nSome cities have no attraction that Xiao L wants to visit, while some cities have exactly one such attraction. Every city is one of these two types. As an information science enthusiast, he wrote a program that arranged a shortest route to reach all the attractions he wants to visit (the city numbers along the route are in an arbitrary order). He reaches city $a_1$ first, city $a_i$ as the $i$-th city, and finally ends the trip at city $a_n$. Xiao L wants to finish this trip in exactly $m$ months ($m < n$), so he needs a sensible plan.\n\nWhen he arrives at a city, if that city has an attraction he wants to visit, he gains $1$ point of happiness; otherwise, he gains $1$ point of fatigue due to the tiring journey. One month is enough for him to travel through any number of cities, but he also wants to take some time to rest. He always rests in the last city he reaches in that month (if this city has an attraction, Xiao L will always visit the attraction before resting). Of course, Xiao L wants to have some travel tasks every month. Even if none of the cities he reaches that month has an attraction, he will still arrive at least one new city in that month.\n\nXiao L cannot arrange the travel plan by himself, so he asks for your help. You need to provide a sequence $x_1, x_2, \\ldots, x_m$, where $x_i$ is the city number where Xiao L rests in the $i$-th month. Since he must finish his trip in the last month, $x_m$ must equal $a_n$. For example, let $n = 5$, $m = 3$, $(a_1, a_2, a_3, a_4, a_5) = (3, 2, 4, 1, 5)$, and $(x_1, x_2, x_3) = (2, 1, 5)$. This means: in month $1$ he reaches cities $3$ and $2$ in order and rests in city $2$; in month $2$ he reaches cities $4$ and $1$ in order and rests in city $1$; in month $3$ he reaches city $5$ and rests in city $5$.\n\nThere are many such feasible sequences. Let $d_i$ be the absolute value of the difference between the happiness and fatigue obtained in month $i$ for a given plan. For the $k$-th feasible plan, let $c_k$ be the maximum of $d_1, d_2, \\ldots, d_m$. Xiao L wants to choose a plan that minimizes $c_k$ among all feasible plans.\n\nIn fact, there may be multiple plans achieving the same minimal $c_k$. Since Xiao L loves programming, he has a bit of OCD (and believes that it makes him look cool). Among all the plans with minimal $c_k$, he wants the lexicographically smallest sequence.\n\nTips: To compare two sequences lexicographically, compare the first position where they differ, e.g., $(1, 2, 3, 4) < (1, 2, 4, 3)$.", "inputFormat": "The first line contains two space-separated positive integers $n, m$, denoting the number of cities and the number of months.\n\nThe next $n$ lines each contain two space-separated integers $A_i$ and $B_i$. Here $A_i$ is the city number he reaches in the $i$-th step, and $B_i$ is $0$ or $1$. If $B_i = 0$, then city $A_i$ has no attraction Xiao L wants to visit; if $B_i = 1$, then city $A_i$ has such an attraction. The $A_i$ are pairwise distinct and satisfy $1 \\leq A_i \\leq n$, i.e., $\\{A_i\\}$ is a permutation of $1, 2, \\ldots, n$.", "outputFormat": "Output exactly one line containing $m$ space-separated positive integers $X_1, X_2, \\ldots, X_m$, which is the planned sequence of rest-city numbers for Xiao L’s trip.", "hint": "In the first month, he gains $2$ points of happiness and $2$ points of fatigue. In the second month, he gains $1$ point of happiness and $1$ point of fatigue. In the third month, he gains $1$ point of happiness and $1$ point of fatigue. The maximum difference between fatigue and happiness over the $3$ months is $0$, which is the minimal possible value among all plans.\n\nFeasible plans include:\n- 1 6 8\n- 3 6 8\n- 3 1 8\n\nAmong these, 1 6 8 is lexicographically smallest.\n\nConstraints: $n \\leq 5 \\times 10^5$, $m \\leq 2 \\times 10^5$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2013] 旅行", "background": "", "description": "在遥远的 HX 国，住着一个旅行家小 L，他希望骑着他的自行车游遍全国。在这个国家中，每个城市都有一个编号，共有 $n$ 个城市，编号从 $1$ 到 $n$。\n\n有的城市没有小 L 想去的景点，而有的城市有且仅有一个小 L 想去的景点，所有的城市都是这两种情况之一，小 L 非常热爱信息学，他编写程序给他的旅行安排了一条最短路线以到达所有他想去的景点（所有的通知旅行线路上城市编号是乱序的）：他第 $1$ 个到达的城市编号为 $a_1$，第 $i$ 个到达的城市编号为 $a_i$，最后到达城市 $a_n$ 结束这次旅行。小L希望用恰好的 $m$ 个月（$m<n$）的时间完成这次旅行，所以他需要制定一个理性的旅游计划。\n\n当他抵达一个城市时，如果这个城市有他想要去的景点，他会因此获得 $1$ 点快乐值；但是若到达的城市没有他想去的景点，他会因旅途的疲惫得到 $1$ 点的疲劳值：一个月的时间足够他游玩任意多个城市，但他也希望拿出一点时间来休息。他每个月总是在本月所到达的最后一个城市休息（但如果这个城市有景点，那么小 L 总会游玩这个景点再休息）。当然，小 L 希望每个月都能有一定的旅行任务。即便这个月他所到达的城市中并没有他想去的的景点，换句话说，每个月他都会至少到达一个新的城市。\n\n小 L 无法自己安排旅行计划，所以求助于你。你需要告诉他一个序列：$x_1,x_2,\\ldots,x_m$，其中 $x_i$ 表示小 L 第 $i$ 个月休息时。他所在的城市编号：由于他最后一个月必须完成他的旅行，所以 $x_m$ 肯定等于 $a_n$，例如，设 $n=5$，$m=3$，$(a_1,a_2,a_3,a_4,a_5)=(3,2,4,1,5)$，$(x_1,x_2,x_3)=(2,1,5)$，这意味着：第 $1$ 个月先后到达 $3$ 号和 $2$ 号城市，并在 $2$ 号城市休息：第 $2$ 个月先后到达 $4$ 号和 $1$ 号城市，并在 $1$ 号城市休息：第 $3$ 个月到达 $5$ 号城市，并在 $5$ 号城市休息。\n\n这样的方案序列有很多种，设每种方案序列中第 $i$ 个月旅行中当月获得的快乐值与疲劳值的差绝对值为 $d_i$，设第 $k$ 种方案序列中求出的 $d_1,d_2,\\ldots,d_m$ 这个 $m$ 值的最大值为 $c_k$，小 L 希望所选择的方案序列的 $c_k$ 在所有方案序列中是最小的。\n\n事实上，可能有多个方案序列的 $c_k$ 达到并列最小值。由于小 L 喜爱编程，他患上了一定的强迫症（虽然他自己认为他的强迫症让他炫的发黄），他希望给他的序列是这多个方案中字典序最小的。\n\nTips：比较两个序列字典序即比较第一个不相同数字的大小，如 $(1,2,3,4)<(1,2,4,3)$。", "inputFormat": "第一行为两个空格隔开的正整数 $n, m$，表示旅行的城市数与旅行所花的月数。\n\n接下来 $n$ 行，其中第 $i$ 行包含两个空格隔开的整数 $A_i$ 和 $B_i$，$A_i$ 表示他第 $i$ 个去的城市编号，$B_i$ 为 $0$ 或 $1$。如果 $B_i=0$ 则表示城市 $A_i$ 没有小 L 想去的景点，如果 $B_i=1$ 则表示城市 $A_i$ 有小 L 想去的景点，$A_i$ 两两不同且有 $1\\leq  A_i\\leq N$，即 $\\{A_i\\}$ 为 $1,2,\\ldots,N$ 的一个排列。", "outputFormat": "输出仅包含一行，包含 $m$ 个空格隔开的正整数 $X_1,X_2,\\ldots,X_m$，即给小 L 安排的旅行计划对应的路线。\n", "hint": "第 $1$ 个月得到 $2$ 点快乐值与 $2$ 点疲劳值，第 $2$ 个月得到 $1$ 点快乐值与 $1$ 点疲劳值，第 $3$ 个月得到 $1$ 点快乐值与 $1$ 点疲劳值。$3$ 个月中疲劳值与快乐值差的最大值为 $0$，达到所有方案最小值。\n\n可行方案有：\n\n- 1 6 8\n- 3 6 8\n- 3 1 8\n\n其中 1 6 8 字典序最小。\n\n$N \\leq 5 \\times 10^5$，$M \\leq 2 \\times 10^5$。", "locale": "zh-CN"}}}
{"pid": "P3230", "type": "P", "difficulty": 5, "samples": [["4\n4 3 6 4", "3"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2013", "各省省选", "湖南", "深度优先搜索 DFS", "记忆化搜索", "哈希 hashing"], "title": "[HNOI2013] 比赛", "background": "", "description": "沫沫非常喜欢看足球赛，但因为沉迷于射箭游戏，错过了最近的一次足球联赛。此次联赛共 $N$ 支球队参加，比赛规则如下：\n\n1. 每两支球队之间踢一场比赛；\n\n2. 若平局，两支球队各得 $1$ 分；\n\n3. 否则胜利的球队得 $3$ 分，败者不得分。 尽管非常遗憾没有观赏到精彩的比赛，但沫沫通过新闻知道了每只球队的最后总得分， 然后聪明的她想计算出有多少种可能的比赛过程。\n\n譬如有 $3$ 支球队，每支球队最后均积 $3$ 分，那么有两种可能的情况：\n\n可能性 $1$ and 可能性 $2$\n\n| 球队 | $A$ | $B$ | $C$ | 得分 | 球队 | $A$ | $B$ | $C$ | 得分 |\n| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |\n| $A$ | - | $3$ | $0$ | $3$ | $A$ | - | $0$ | $3$ | $3$ |\n| $B$ | $0$ | - | $3$ | $3$ | $B$ | $3$ | - | $0$ | $3$ |\n| $C$ | $3$ | $0$ | - | $3$ | $C$ | $0$ | $3$ | - | $3$ |\n\n但沫沫发现当球队较多时，计算工作量将非常大，所以这个任务就交给你了。请你计算出可能的比赛过程的数目，由于答案可能很大，你只需要输出答案对 $10^9+7$ 取模的结果。", "inputFormat": "第一行是一个正整数 $N$，表示一共有 $N$ 支球队。 接下来一行 $N$ 个非负整数，依次表示各队的最后总得分。 输入保证 $20\\%$ 的数据满足 $N\\leq4$，$40\\%$ 的数据满足 $N\\leq6$，$60\\%$ 的数据满足 $N\\leq8$，$100\\%$ 的数据满足 $3\\leq N\\leq10$ 且至少存在一组解。\n", "outputFormat": "仅包含一个整数，表示答案对 $10^9+7$ 取模的结果。", "hint": "$20\\%$ 的数据满足 $N≤4$;\n\n$40\\%$ 的数据满足 $N≤6$;\n\n$60\\%$ 的数据满足 $N≤8$;\n\n$100\\%$ 的数据满足 $3≤N≤10$ 且至少存在一组解。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2013] Competition", "background": "", "description": "Momo loves watching soccer matches, but she missed the latest league because she was addicted to an archery game. There are $N$ teams in the league, and the rules are as follows:\n1. Every pair of teams plays exactly one match.\n2. If a match ends in a draw, each team gets $1$ point.\n3. Otherwise, the winner gets $3$ points and the loser gets $0$ points.\n\nAlthough she could not watch the exciting matches, Momo learned from the news the final total points of each team. Now she wants to compute how many possible tournament outcomes are consistent with these totals.\n\nFor example, if there are $3$ teams and each team finishes with $3$ points, then there are two possibilities:\n\nPossibility $1$ and Possibility $2$\n\n| Team | $A$ | $B$ | $C$ | Points | Team | $A$ | $B$ | $C$ | Points |\n| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |\n| $A$ | - | $3$ | $0$ | $3$ | $A$ | - | $0$ | $3$ | $3$ |\n| $B$ | $0$ | - | $3$ | $3$ | $B$ | $3$ | - | $0$ | $3$ |\n| $C$ | $3$ | $0$ | - | $3$ | $C$ | $0$ | $3$ | - | $3$ |\n\nSince the answer can be large, output it modulo $10^9+7$.", "inputFormat": "The first line contains a positive integer $N$, the number of teams.  \nThe second line contains $N$ non-negative integers, giving the final total points of each team in order.", "outputFormat": "Output a single integer, the answer modulo $10^9+7$.", "hint": "- $20\\%$ of the testdata satisfies $N \\le 4$.\n- $40\\%$ of the testdata satisfies $N \\le 6$.\n- $60\\%$ of the testdata satisfies $N \\le 8$.\n- $100\\%$ of the testdata satisfies $3 \\le N \\le 10$, and there exists at least one solution.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2013] 比赛", "background": "", "description": "沫沫非常喜欢看足球赛，但因为沉迷于射箭游戏，错过了最近的一次足球联赛。此次联赛共 $N$ 支球队参加，比赛规则如下：\n\n1. 每两支球队之间踢一场比赛；\n\n2. 若平局，两支球队各得 $1$ 分；\n\n3. 否则胜利的球队得 $3$ 分，败者不得分。 尽管非常遗憾没有观赏到精彩的比赛，但沫沫通过新闻知道了每只球队的最后总得分， 然后聪明的她想计算出有多少种可能的比赛过程。\n\n譬如有 $3$ 支球队，每支球队最后均积 $3$ 分，那么有两种可能的情况：\n\n可能性 $1$ and 可能性 $2$\n\n| 球队 | $A$ | $B$ | $C$ | 得分 | 球队 | $A$ | $B$ | $C$ | 得分 |\n| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |\n| $A$ | - | $3$ | $0$ | $3$ | $A$ | - | $0$ | $3$ | $3$ |\n| $B$ | $0$ | - | $3$ | $3$ | $B$ | $3$ | - | $0$ | $3$ |\n| $C$ | $3$ | $0$ | - | $3$ | $C$ | $0$ | $3$ | - | $3$ |\n\n但沫沫发现当球队较多时，计算工作量将非常大，所以这个任务就交给你了。请你计算出可能的比赛过程的数目，由于答案可能很大，你只需要输出答案对 $10^9+7$ 取模的结果。", "inputFormat": "第一行是一个正整数 $N$，表示一共有 $N$ 支球队。 接下来一行 $N$ 个非负整数，依次表示各队的最后总得分。 输入保证 $20\\%$ 的数据满足 $N\\leq4$，$40\\%$ 的数据满足 $N\\leq6$，$60\\%$ 的数据满足 $N\\leq8$，$100\\%$ 的数据满足 $3\\leq N\\leq10$ 且至少存在一组解。\n", "outputFormat": "仅包含一个整数，表示答案对 $10^9+7$ 取模的结果。", "hint": "$20\\%$ 的数据满足 $N≤4$;\n\n$40\\%$ 的数据满足 $N≤6$;\n\n$60\\%$ 的数据满足 $N≤8$;\n\n$100\\%$ 的数据满足 $3≤N≤10$ 且至少存在一组解。", "locale": "zh-CN"}}}
{"pid": "P3231", "type": "P", "difficulty": 6, "samples": [["1\n4  4 4\n1  0 1 1\n0  0 1 1\n0  0 0 0\n0  0 0 0\n0  0 1 1\n1  0 1 1\n0  0 0 0\n0  0 0 0\n0  0 0 0\n0  0 0 0\n1  0 0 0\n0  0 0 0\n0  0 0 0\n0  0 0 0\n0  0 0 0\n1  0 0 0", "3"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["搜索", "2013", "各省省选", "湖南", "枚举", "二分图"], "title": "[HNOI2013] 消毒", "background": "", "description": "\n最近在生物实验室工作的小 T 遇到了大麻烦。 由于实验室最近升级的缘故，他的分格实验皿是一个长方体，其尺寸为 $a\\times b\\times c$。为了实验的方便，它被划分为 $a\\times b\\times c$ 个单位立方体区域，每个单位立方体尺寸为 $1\\times 1\\times 1$，并用 $(i,j,k)$ 标识一个单位立方体。这个实验皿已经很久没有人用了。现在，小 T 被导师要求将其中一些单位立方体区域进行消毒操作（每个区域可以被重复消毒）。\n\n而由于严格的实验要求，他被要求使用一种特定的 F 试剂来进行消毒。 这种 F 试剂特别奇怪，每次对尺寸为 $x\\times y\\times z$ 的长方体区域（它由 $x\\times y\\times z$ 个单位立方体组成）进行消毒时，只需要使用 $\\min(x,y,z)$ 单位的 F 试剂。F 试剂的价格不菲，这可难倒了小 T。\n\n现在请你告诉他，最少要用多少单位的 F 试剂。", "inputFormat": "**本题有多组数据。**\n\n第一行是一个正整数 $D$，表示数据组数。\n\n接下来是 $D$ 组数据，每组数据第一行是三个正整数 $a,b,c$ 表示实验皿的尺寸。\n\n接下来会出现 $a$ 个 $b$ 行 $c$ 列的用空格隔开的 `01` 矩阵，`0` 表示对应的单位立方体不要求消毒，`1` 表示对应的单位立方体需要消毒：如，如果第 $1$ 个 `01` 矩阵的第 $2$ 行第 $3$ 列为 `1`，则表示单位立方体 $(1,2,3)$ 需要被消毒。", "outputFormat": "$D$ 行，每行一个整数，表示对应实验皿最少要用多少单位的 F 试剂。", "hint": "#### 样例 1 解释\n对于区域 $(1,1,3)-(2,2,4)$ 和 $(1,1,1)-(4,4,1)$ 消毒，分别花费 $2$ 个单位和 $1$ 个单位的 F 试剂。\n\n#### 数据规模与约定\n\n对于 $100\\%$ 的数据，保证 $1\\le a,b,c\\le 5\\times 10^3$，$abc\\le 5\\times 10^3$，且 $1\\le D\\le 3$。\n", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2013] Disinfection", "background": "", "description": "Xiao T has run into big trouble while working in a biology lab. Due to a recent upgrade, his compartmentalized dish is a rectangular box with dimensions $a\\times b\\times c$. For convenience, it is partitioned into $a\\times b\\times c$ unit cubes, each of size $1\\times 1\\times 1$, and a unit cube is denoted by $(i, j, k)$. The dish has not been used for a long time. Now, Xiao T is required by his advisor to disinfect some of the unit cubes (each unit cube may be disinfected multiple times).\n\nDue to strict experimental requirements, he must use a specific reagent F. This reagent F is peculiar: each time he disinfects a rectangular box of size $x\\times y\\times z$ (consisting of $x\\times y\\times z$ unit cubes), it costs only $\\min(x, y, z)$ units of reagent F. Since reagent F is expensive, Xiao T wants to minimize the total amount used.\n\nPlease tell him the minimum total units of reagent F required.", "inputFormat": "This problem contains multiple testcases.\n\n- The first line contains a positive integer $D$, the number of testcases.\n- For each testcase, the first line contains three positive integers $a, b, c$, the dimensions of the dish.\n- Then follow $a$ blocks. For each $i=1,2,\\dots,a$, read a $b$-row, $c$-column `01` matrix with entries separated by spaces. `0` means the corresponding unit cube does not need disinfection, and `1` means it needs disinfection. For example, if the $(2, 3)$ entry of the first `01` matrix is `1`, then unit cube $(1, 2, 3)$ must be disinfected.", "outputFormat": "Output $D$ lines. For each testcase, output one integer: the minimum total units of reagent F required.", "hint": "Sample 1 explanation:\nDisinfecting regions $(1,1,3)-(2,2,4)$ and $(1,1,1)-(4,4,1)$ costs $2$ units and $1$ unit of reagent F, respectively.\n\nConstraints:\nFor $100\\%$ of the testdata, it is guaranteed that $1\\le a,b,c\\le 5\\times 10^3$, $abc\\le 5\\times 10^3$, and $1\\le D\\le 3$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2013] 消毒", "background": "", "description": "\n最近在生物实验室工作的小 T 遇到了大麻烦。 由于实验室最近升级的缘故，他的分格实验皿是一个长方体，其尺寸为 $a\\times b\\times c$。为了实验的方便，它被划分为 $a\\times b\\times c$ 个单位立方体区域，每个单位立方体尺寸为 $1\\times 1\\times 1$，并用 $(i,j,k)$ 标识一个单位立方体。这个实验皿已经很久没有人用了。现在，小 T 被导师要求将其中一些单位立方体区域进行消毒操作（每个区域可以被重复消毒）。\n\n而由于严格的实验要求，他被要求使用一种特定的 F 试剂来进行消毒。 这种 F 试剂特别奇怪，每次对尺寸为 $x\\times y\\times z$ 的长方体区域（它由 $x\\times y\\times z$ 个单位立方体组成）进行消毒时，只需要使用 $\\min(x,y,z)$ 单位的 F 试剂。F 试剂的价格不菲，这可难倒了小 T。\n\n现在请你告诉他，最少要用多少单位的 F 试剂。", "inputFormat": "**本题有多组数据。**\n\n第一行是一个正整数 $D$，表示数据组数。\n\n接下来是 $D$ 组数据，每组数据第一行是三个正整数 $a,b,c$ 表示实验皿的尺寸。\n\n接下来会出现 $a$ 个 $b$ 行 $c$ 列的用空格隔开的 `01` 矩阵，`0` 表示对应的单位立方体不要求消毒，`1` 表示对应的单位立方体需要消毒：如，如果第 $1$ 个 `01` 矩阵的第 $2$ 行第 $3$ 列为 `1`，则表示单位立方体 $(1,2,3)$ 需要被消毒。", "outputFormat": "$D$ 行，每行一个整数，表示对应实验皿最少要用多少单位的 F 试剂。", "hint": "#### 样例 1 解释\n对于区域 $(1,1,3)-(2,2,4)$ 和 $(1,1,1)-(4,4,1)$ 消毒，分别花费 $2$ 个单位和 $1$ 个单位的 F 试剂。\n\n#### 数据规模与约定\n\n对于 $100\\%$ 的数据，保证 $1\\le a,b,c\\le 5\\times 10^3$，$abc\\le 5\\times 10^3$，且 $1\\le D\\le 3$。\n", "locale": "zh-CN"}}}
{"pid": "P3232", "type": "P", "difficulty": 6, "samples": [["3 3\n2 3\n1 2\n1 3", "3.333"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2013", "各省省选", "江苏", "湖南", "期望", "高斯消元"], "title": "[HNOI2013 / JSOI2013] 游走", "background": null, "description": "给定一个 $n$ 个点 $m$ 条边的无向连通图，顶点从 $1$ 编号到 $n$，边从 $1$ 编号到 $m$。 \n\n小 Z 在该图上进行随机游走，初始时小 Z 在 $1$ 号顶点，每一步小 Z 以相等的概率随机选择当前顶点的某条边，沿着这条边走到下一个顶点，获得等于这条边的编号的分数。当小 Z 到达 $n$ 号顶点时游走结束，总分为所有获得的分数之和。 现在，请你对这 $m$ 条边进行编号，使得小 Z 获得的总分的期望值最小。", "inputFormat": "第一行是两个整数，分别表示该图的顶点数 $n$ 和边数 $m$。\n\n接下来 $m$ 行每行两个整数 $u,v$，表示顶点 $u$ 与顶点 $v$ 之间存在一条边。", "outputFormat": "输出一行一个实数表示答案，保留三位小数。", "hint": "#### 样例输入输出 1 解释\n\n边 $(1,2)$ 编号为 $1$，边 $(1,3)$ 编号 $2$，边 $(2,3)$ 编号为 $3$。\n\n---\n\n#### 数据规模与约定\n\n- 对于 $30\\%$ 的数据，保证 $n\\leq 10$。\n- 对于 $100\\%$ 的数据，保证 $2\\leq n \\leq 500$， $1 \\leq m \\leq 125000$，$1 \\leq u, v \\leq n$，给出的图无重边和自环，且从 $1$ 出发可以到达所有的节点。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2013] Random Walk", "background": "", "description": "Given an undirected connected graph with $n$ vertices and $m$ edges. The vertices are numbered from $1$ to $n$, and the edges are to be numbered from $1$ to $m$.\n\nXiao Z performs a random walk on this graph. Initially, Xiao Z is at vertex $1$. At each step, Xiao Z chooses one incident edge of the current vertex uniformly at random, traverses it to the next vertex, and obtains a score equal to the label of that edge. The walk ends when Xiao Z reaches vertex $n$. The total score is the sum of all scores obtained. Now, please assign labels to the $m$ edges so that the expected value of Xiao Z’s total score is minimized.", "inputFormat": "The first line contains two integers, representing the number of vertices $n$ and the number of edges $m$.\n\nThe next $m$ lines each contain two integers $u, v$, indicating that there is an edge between vertices $u$ and $v$.", "outputFormat": "Output one real number: the answer, rounded to three decimal places.", "hint": "#### Explanation for Sample 1\n\nEdge $(1, 2)$ is labeled $1$, edge $(1, 3)$ is labeled $2$, and edge $(2, 3)$ is labeled $3$.\n\n---\n\n#### Constraints\n\n- For $30\\%$ of the testdata, it is guaranteed that $n \\leq 10$.\n- For $100\\%$ of the testdata, it is guaranteed that $2 \\leq n \\leq 500$, $1 \\leq m \\leq 125000$, $1 \\leq u, v \\leq n$; the given graph has no multiple edges and no self-loops, and every node is reachable from $1$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2013 / JSOI2013] 游走", "background": null, "description": "给定一个 $n$ 个点 $m$ 条边的无向连通图，顶点从 $1$ 编号到 $n$，边从 $1$ 编号到 $m$。 \n\n小 Z 在该图上进行随机游走，初始时小 Z 在 $1$ 号顶点，每一步小 Z 以相等的概率随机选择当前顶点的某条边，沿着这条边走到下一个顶点，获得等于这条边的编号的分数。当小 Z 到达 $n$ 号顶点时游走结束，总分为所有获得的分数之和。 现在，请你对这 $m$ 条边进行编号，使得小 Z 获得的总分的期望值最小。", "inputFormat": "第一行是两个整数，分别表示该图的顶点数 $n$ 和边数 $m$。\n\n接下来 $m$ 行每行两个整数 $u,v$，表示顶点 $u$ 与顶点 $v$ 之间存在一条边。", "outputFormat": "输出一行一个实数表示答案，保留三位小数。", "hint": "#### 样例输入输出 1 解释\n\n边 $(1,2)$ 编号为 $1$，边 $(1,3)$ 编号 $2$，边 $(2,3)$ 编号为 $3$。\n\n---\n\n#### 数据规模与约定\n\n- 对于 $30\\%$ 的数据，保证 $n\\leq 10$。\n- 对于 $100\\%$ 的数据，保证 $2\\leq n \\leq 500$， $1 \\leq m \\leq 125000$，$1 \\leq u, v \\leq n$，给出的图无重边和自环，且从 $1$ 出发可以到达所有的节点。", "locale": "zh-CN"}}}
{"pid": "P3233", "type": "P", "difficulty": 6, "samples": [["10\n2 1\n3 2\n4 3\n5 4\n6 1\n7 3\n8 3\n9 4\n10 1\n5\n2\n6 1\n5\n2 7 3 6 9\n1\n8\n4\n8 7 10 3\n5\n2 9 3 5 8", "1 9   \n3 1 4 1 1   \n10  \n1 1 3 5   \n4 1 3 1 1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["动态规划 DP", "2014", "倍增", "各省省选", "湖南", "最近公共祖先 LCA", "虚树"], "title": "[HNOI2014] 世界树", "background": "", "description": "世界树是一棵无比巨大的树，它伸出的枝干构成了整个世界。在这里，生存着各种各样的种族和生灵，他们共同信奉着绝对公正公平的女神艾莉森，在他们的信条里，公平是使世界树能够生生不息、持续运转的根本基石。\n\n世界树的形态可以用一个数学模型来描述：世界树中有 $n$ 个种族，种族的编号分别从 $1$ 到 $n$，分别生活在编号为 $1$ 到 $n$ 的聚居地上，种族的编号与其聚居地的编号相同。有的聚居地之间有双向的道路相连，道路的长度为 $1$。保证连接的方式会形成一棵树结构，即所有的聚居地之间可以互相到达，并且不会出现环。定义两个聚居地之间的距离为连接他们的道路的长度；例如，若聚居地 $a$ 和 $b$ 之间有道路，$b$ 和 $c$ 之间有道路，因为每条道路长度为 $1$ 而且又不可能出现环，所以 $a$ 与 $c$ 之间的距离为 $2$。\n\n出于对公平的考虑，第 $i$ 年，世界树的国王需要授权 $m_i$ 个种族的聚居地为临时议事处。对于某个种族 $x$（$x$ 为种族的编号），如果距离该种族最近的临时议事处为 $y$（$y$ 为议事处所在聚居地的编号），则种族 $x$ 将接受 $y$ 议事处的管辖（如果有多个临时议事处到该聚居地的距离一样，则 $y$ 为其中编号最小的临时议事处）。\n\n现在国王想知道，在 $q$ 年的时间里，每一年完成授权后，当年每个临时议事处将会管理多少个种族（议事处所在的聚居地也将接受该议事处管理）。 现在这个任务交给了以智慧著称的灵长类的你：程序猿。请帮国王完成这个任务吧。", "inputFormat": "第一行为一个正整数 $n$，表示世界树中种族的个数。接下来 $n-1$ 行，每行两个正整数 $x，y$，表示 $x$ 聚居地与 $y$ 聚居地之间有一条长度为 $1$ 的双向道路。接下来一行为一个正整数 $q$，表示国王询问的年数。接下来 $q$ 块，每块两行：第 $i$ 块的第一行为 $1$ 个正整数 $m_i$，表示第 $i$ 年授权的临时议事处的个数。第 $i$ 块的第二行为 $m_i$ 个正整数 $h_1, h_2,\\ldots,h_{m_i}$，表示被授权为临时议事处的聚居地编号（保证互不相同）。\n", "outputFormat": "输出包含 $q$ 行，第 $i$ 行为 $m_i$ 个整数，该行的第 $j$ ($j=1, 2,\\ldots, m_i$) 个数表示第 $i$ 年被授权的聚居地 $h_j$ 的临时议事处管理的种族个数。\n", "hint": "对于 $100\\%$ 的数据，$N\\leq 300000$, $q\\leq 300000$, $\\sum^q_{i=1}m_i \\leq 300000$。\n", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2014] World Tree", "background": "", "description": "The World Tree is an unimaginably huge tree whose sprawling branches form the entire world. Here live various races and beings. They all worship the goddess Alison, who stands for absolute justice and fairness. In their creed, fairness is the fundamental cornerstone that allows the World Tree to thrive and keep running.\n\nThe shape of the World Tree can be modeled mathematically: there are $n$ races in the World Tree, numbered from $1$ to $n$, each living in a settlement also numbered from $1$ to $n$, and a race’s number equals its settlement’s number. Some settlements are connected by bidirectional roads, each of length $1$. It is guaranteed that the connections form a tree, that is, every settlement is reachable from every other, and there are no cycles. The distance between two settlements is defined as the length of the unique path connecting them. For example, if there is a road between settlements $a$ and $b$, and a road between $b$ and $c$, then since each road has length $1$ and cycles are impossible, the distance between $a$ and $c$ is $2$.\n\nFor fairness, in year $i$, the king of the World Tree authorizes $m_i$ settlements as temporary offices. For a race $x$ (where $x$ is the race’s number), if the nearest temporary office to race $x$ is at settlement $y$ (where $y$ is the settlement number of the office), then race $x$ accepts the administration of the office at $y$ (if multiple temporary offices are at the same minimum distance to that settlement, then $y$ is the office with the smallest number among them).\n\nNow the king wants to know, over $q$ years, after the authorizations in each year are completed, how many races each temporary office will administer that year (the settlement where an office is located also accepts that office’s administration). This task is handed to you, the wise primate: the programmer. Please help the king complete this task.", "inputFormat": "The first line contains a positive integer $n$, the number of races in the World Tree. The next $n-1$ lines each contain two positive integers $x, y$, indicating that there is a bidirectional road of length $1$ between settlements $x$ and $y$. The next line contains a positive integer $q$, the number of years the king queries. Then follow $q$ blocks, each consisting of two lines: in the $i$-th block, the first line contains one positive integer $m_i$, the number of temporary offices authorized in year $i$. The second line contains $m_i$ positive integers $h_1, h_2, \\ldots, h_{m_i}$, the settlement numbers authorized as temporary offices (guaranteed to be all distinct).", "outputFormat": "Output $q$ lines. In the $i$-th line, output $m_i$ integers, where the $j$-th number ($j = 1, 2, \\ldots, m_i$) is the number of races administered by the temporary office at settlement $h_j$ authorized in year $i$.", "hint": "For $100\\%$ of the testdata, $N\\leq 300000$, $q\\leq 300000$, $\\sum^q_{i=1}m_i \\leq 300000$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2014] 世界树", "background": "", "description": "世界树是一棵无比巨大的树，它伸出的枝干构成了整个世界。在这里，生存着各种各样的种族和生灵，他们共同信奉着绝对公正公平的女神艾莉森，在他们的信条里，公平是使世界树能够生生不息、持续运转的根本基石。\n\n世界树的形态可以用一个数学模型来描述：世界树中有 $n$ 个种族，种族的编号分别从 $1$ 到 $n$，分别生活在编号为 $1$ 到 $n$ 的聚居地上，种族的编号与其聚居地的编号相同。有的聚居地之间有双向的道路相连，道路的长度为 $1$。保证连接的方式会形成一棵树结构，即所有的聚居地之间可以互相到达，并且不会出现环。定义两个聚居地之间的距离为连接他们的道路的长度；例如，若聚居地 $a$ 和 $b$ 之间有道路，$b$ 和 $c$ 之间有道路，因为每条道路长度为 $1$ 而且又不可能出现环，所以 $a$ 与 $c$ 之间的距离为 $2$。\n\n出于对公平的考虑，第 $i$ 年，世界树的国王需要授权 $m_i$ 个种族的聚居地为临时议事处。对于某个种族 $x$（$x$ 为种族的编号），如果距离该种族最近的临时议事处为 $y$（$y$ 为议事处所在聚居地的编号），则种族 $x$ 将接受 $y$ 议事处的管辖（如果有多个临时议事处到该聚居地的距离一样，则 $y$ 为其中编号最小的临时议事处）。\n\n现在国王想知道，在 $q$ 年的时间里，每一年完成授权后，当年每个临时议事处将会管理多少个种族（议事处所在的聚居地也将接受该议事处管理）。 现在这个任务交给了以智慧著称的灵长类的你：程序猿。请帮国王完成这个任务吧。", "inputFormat": "第一行为一个正整数 $n$，表示世界树中种族的个数。接下来 $n-1$ 行，每行两个正整数 $x，y$，表示 $x$ 聚居地与 $y$ 聚居地之间有一条长度为 $1$ 的双向道路。接下来一行为一个正整数 $q$，表示国王询问的年数。接下来 $q$ 块，每块两行：第 $i$ 块的第一行为 $1$ 个正整数 $m_i$，表示第 $i$ 年授权的临时议事处的个数。第 $i$ 块的第二行为 $m_i$ 个正整数 $h_1, h_2,\\ldots,h_{m_i}$，表示被授权为临时议事处的聚居地编号（保证互不相同）。\n", "outputFormat": "输出包含 $q$ 行，第 $i$ 行为 $m_i$ 个整数，该行的第 $j$ ($j=1, 2,\\ldots, m_i$) 个数表示第 $i$ 年被授权的聚居地 $h_j$ 的临时议事处管理的种族个数。\n", "hint": "对于 $100\\%$ 的数据，$N\\leq 300000$, $q\\leq 300000$, $\\sum^q_{i=1}m_i \\leq 300000$。\n", "locale": "zh-CN"}}}
{"pid": "P3234", "type": "P", "difficulty": 6, "samples": [["10\n2\n1234567890*1234567890\n1234567890a1234567890\n2\n1234567890*1234567890\n1234567890*1234567890\n2\n1234*67890a1234567890\n1234567890*1234567890\n2\n1234567890*1234567890\n1234567890a12345*7890\n2\n1234567890*1234567890\n*12345\n2\n12345*67890\n1234567890*1234567890\n2\n1234567890*1234567890\n12345*\n2\n1234567890*1234567890\n*67890\n2\n67890*\n1234567890*1234567890\n2\n1234567890*a*1234567890\n1234567890*1234567890", "Y\r\nY\r\nY\r\nY\r\nN\r\nY\r\nY\r\nY\r\nN\r\nY"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["字符串", "2014", "各省省选", "湖南", "哈希 hashing", "前缀和"], "title": "[HNOI2014] 抄卡组", "background": null, "description": "一天闲着无聊的小 L 找来了当前正火爆的游戏《炉石传说》来玩，但是怎么打怎么输，于是他大喊一声“我要抄卡组！”就找来了游戏传说组第一名的游戏高手小 H 的直播来看。\n\n但是小 L 家的网络技术还停留在拨号，看着直播画面又是卡顿又是花屏，他不给力的网络让他完全无法记录小 H 展示的给力的卡组。小 L 周围都是学霸没有人玩游戏想去帮他这个忙，但是学霸们热衷于讨论各种信息学问题。\n\n于是他想到了一个方法：由于每次花屏的屏幕位置不一样，于是小 H 每次总能记录下卡组的一些部分，如果这样记录多次，不就有可能还原出小 L 想要的一个卡组么？\n\n但是存在的一个问题是，小 H 每次展示的卡组有可能不一样，所以他想知道他每次看直播抄下来几次的卡组碎片是否一致。\n\n这样一来小 H 将他遇到的游戏问题抽象成这样一个学术问题让学霸（你）解决：`*`可以匹配任意长度个的字符 （包含 $0$ 个），问所有字符串是否两两匹配。", "inputFormat": "第一行包含一个正整数 $T$，表示了数据组数。  \n\n接下来包含 $T$ 组数据：  \n每组数据的第一行是一个正整数 $N$，表示该组数据酌字符串个数。  \n接下来 $N$ 行，每行一个字符串，字符串仅包含小写字母、数字、通配符术。\n\n**注意：** 数据为 UNIX 格式，中间包含空行，你可以采用逐字符读入的方式。", "outputFormat": "输出包含 $T$ 行，每行一个字母 `Y` 或者 `N`，`Y` 表示这组数据中所有字符串两两匹配，`N` 表示这组数据中至少有一对字符串不匹配。", "hint": "对于 $100\\%$ 的数据，满足 $N \\leq 100000，T = 10$，输入文件不超过 $10\\text{M}$，$N\\times$ 最长字符串长度不超过 $2\\times 10^8$。\n\n目前有且仅有 hack 数据中 $T = 1$。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2014] Copying Decklists", "background": "", "description": "One day, a bored Xiao L started playing the currently popular game Hearthstone, but he kept losing. He shouted, “I’m going to copy a decklist!” and went to watch the livestream of top Legend player Xiao H.\n\nHowever, Xiao L’s internet is still stuck in the dial-up era. The livestream is laggy and garbled, and his poor connection makes it impossible to record the full powerful decklist Xiao H shows. No one around Xiao L plays games, but they are all top students who love discussing informatics problems.\n\nSo he came up with an idea: since each garbled frame appears in different positions on the screen, Xiao L can record some parts of the decklist each time. If he records many times, maybe he can reconstruct a decklist Xiao L wants.\n\nBut there’s a problem: the decklist Xiao H shows each time might be different. So he wants to know whether the decklist fragments he copied each time are consistent.\n\nAbstracted as an academic problem for you to solve: the wildcard `*` matches a string of any length (including $0$). Determine whether all the strings are pairwise matching.", "inputFormat": "The first line contains a positive integer $T$, the number of test cases.\n\nThen follow $T$ test cases:  \nFor each test case, the first line contains a positive integer $N$, the number of strings in this test case.  \nThen follow $N$ lines, each containing one string. Each string consists only of lowercase letters, digits, and the wildcard symbol `*`.\n\nNote: The testdata is in UNIX format and may contain blank lines. You may read the input character by character.", "outputFormat": "Output $T$ lines, each containing a single letter `Y` or `N`. `Y` means all strings in this test case are pairwise matching, and `N` means there exists at least one pair of strings that do not match.", "hint": "For $100\\%$ of the testdata, $N \\leq 100000$, $T = 10$, the input file size does not exceed $10\\text{M}$, and $N \\times$ the longest string length does not exceed $2 \\times 10^8$.\n\nCurrently, only in hack testdata, $T = 1$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2014] 抄卡组", "background": null, "description": "一天闲着无聊的小 L 找来了当前正火爆的游戏《炉石传说》来玩，但是怎么打怎么输，于是他大喊一声“我要抄卡组！”就找来了游戏传说组第一名的游戏高手小 H 的直播来看。\n\n但是小 L 家的网络技术还停留在拨号，看着直播画面又是卡顿又是花屏，他不给力的网络让他完全无法记录小 H 展示的给力的卡组。小 L 周围都是学霸没有人玩游戏想去帮他这个忙，但是学霸们热衷于讨论各种信息学问题。\n\n于是他想到了一个方法：由于每次花屏的屏幕位置不一样，于是小 H 每次总能记录下卡组的一些部分，如果这样记录多次，不就有可能还原出小 L 想要的一个卡组么？\n\n但是存在的一个问题是，小 H 每次展示的卡组有可能不一样，所以他想知道他每次看直播抄下来几次的卡组碎片是否一致。\n\n这样一来小 H 将他遇到的游戏问题抽象成这样一个学术问题让学霸（你）解决：`*`可以匹配任意长度个的字符 （包含 $0$ 个），问所有字符串是否两两匹配。", "inputFormat": "第一行包含一个正整数 $T$，表示了数据组数。  \n\n接下来包含 $T$ 组数据：  \n每组数据的第一行是一个正整数 $N$，表示该组数据酌字符串个数。  \n接下来 $N$ 行，每行一个字符串，字符串仅包含小写字母、数字、通配符术。\n\n**注意：** 数据为 UNIX 格式，中间包含空行，你可以采用逐字符读入的方式。", "outputFormat": "输出包含 $T$ 行，每行一个字母 `Y` 或者 `N`，`Y` 表示这组数据中所有字符串两两匹配，`N` 表示这组数据中至少有一对字符串不匹配。", "hint": "对于 $100\\%$ 的数据，满足 $N \\leq 100000，T = 10$，输入文件不超过 $10\\text{M}$，$N\\times$ 最长字符串长度不超过 $2\\times 10^8$。\n\n目前有且仅有 hack 数据中 $T = 1$。", "locale": "zh-CN"}}}
{"pid": "P3235", "type": "P", "difficulty": 6, "samples": [["4 3\n1 1\n1 2\n1 3\n1 5", "0 0 1 1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["递推", "2014", "各省省选", "湖南", "O2优化", "SG 函数"], "title": "[HNOI2014] 江南乐", "background": null, "description": "小 A 是一个名副其实的狂热的回合制游戏玩家。在获得了许多回合制游戏的世界级奖项之后，小 A 有一天突然想起了他小时候在江南玩过的一个回合制游戏。\n\n游戏的规则是这样的，首先给定一个数 $F$，然后游戏系统会产生 $T$ 组游戏。每一组游戏包含 $N$ 堆石子，小 A 和他的对手轮流操作。每次操作时，操作者先选定一个不小于 $2$ 的正整数 $M$（$M$ 是操作者自行选定的，而且每次操作时可不一样，但是 $M$ 不能大于选中的堆中的石子数量），然后将任意一堆数量不小于 $F$ 的石子分成 $M$ 堆，并且满足这 $M$ 堆石子中石子数最多的一堆至多比石子数最少的一堆多 $1$（即分的尽量平均，事实上按照这样的分石子万法，选定 $M$ 和一堆石子后，它分出来的状态是固定的）。当一个玩家不能操作的时候，也就是当每一堆石子的数量都严格小于 $F$ 时，他就输掉。补充：先手从 $N$ 堆石子中选择一堆数量不小于 $F$ 的石子分成 $M$ 堆后，此时共有 $N+M-1$ 堆石子，接下来小 A 从这 $N+M-1$ 堆石子中选择一堆数量不小于 $F$ 的石子，依此类推。\n\n小 A 从小就是个有风度的男生，他邀请他的对手作为先手。小 A 现在想要知道，面对给定的一组游戏，而且他的对手也和他一样聪明绝顶的话，究竟谁能够获得胜利？", "inputFormat": "输入第一行包含两个正整数 $T$ 和 $F$，分别表示游戏组数与给定的数。\n\n接下来 $T$ 行，每行第一个数 $N$ 表示该组游戏初始状态下有多少堆石子。之后 $N$ 个正整数，表示这 $N$ 堆石子分别有多少个。", "outputFormat": "输出一行，包含 $T$ 个用空格隔开的 $0$ 或 $1$ 的数，其中 $0$ 代表此时小 A（后手）会胜利，而 $1$ 代表小 A 的对手（先手）会胜利。", "hint": "对于 $100\\%$ 的数据，$T \\lt 100$，$N \\lt 100$，$F \\lt 100000$，每堆石子数量${}\\lt 100000$。\n\n以上所有数均为正整数。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2014] Jiangnan Le", "background": "", "description": "Xiao A is a true enthusiast of turn-based games. After winning many world-class awards in turn-based games, one day he suddenly remembered a turn-based game he played in Jiangnan when he was a child.\n\nThe rules are as follows. First, a number $F$ is given. Then the game system generates $T$ game instances. Each game instance contains $N$ heaps of stones. Xiao A and his opponent take turns. On each turn, the player first chooses a positive integer $M \\ge 2$ ($M$ is chosen by the player, and can differ from turn to turn, but $M$ cannot exceed the number of stones in the chosen heap). Then the player selects any heap with at least $F$ stones and splits it into $M$ heaps, such that among these $M$ heaps, the largest size is at most $1$ greater than the smallest size (i.e., as evenly as possible; in fact, under this splitting rule, once $M$ and a heap are fixed, the resulting state is determined). A player who cannot move, that is, when every heap has strictly fewer than $F$ stones, loses. Supplement: After the first player chooses one of the $N$ heaps with at least $F$ stones and splits it into $M$ heaps, there are $N + M - 1$ heaps in total. Next, Xiao A chooses one of these $N + M - 1$ heaps with at least $F$ stones, and so on.\n\nXiao A has always been a courteous boy, and he invites his opponent to move first. Now Xiao A wants to know, given each game instance and assuming his opponent is just as clever as he is, who will win.", "inputFormat": "The first line contains two positive integers $T$ and $F$, denoting the number of game instances and the given number, respectively.\n\nEach of the next $T$ lines describes one game instance. In each line, the first number $N$ is the number of initial heaps. Then follow $N$ positive integers, giving the sizes of these $N$ heaps.", "outputFormat": "Output one line containing $T$ numbers separated by single spaces. For each game instance, output $0$ if Xiao A (the second player) will win, and $1$ if Xiao A’s opponent (the first player) will win.", "hint": "For $100\\%$ of the testdata, $T < 100$, $N < 100$, $F < 100000$, and each heap size $< 100000$.\n\nAll the above numbers are positive integers.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2014] 江南乐", "background": null, "description": "小 A 是一个名副其实的狂热的回合制游戏玩家。在获得了许多回合制游戏的世界级奖项之后，小 A 有一天突然想起了他小时候在江南玩过的一个回合制游戏。\n\n游戏的规则是这样的，首先给定一个数 $F$，然后游戏系统会产生 $T$ 组游戏。每一组游戏包含 $N$ 堆石子，小 A 和他的对手轮流操作。每次操作时，操作者先选定一个不小于 $2$ 的正整数 $M$（$M$ 是操作者自行选定的，而且每次操作时可不一样，但是 $M$ 不能大于选中的堆中的石子数量），然后将任意一堆数量不小于 $F$ 的石子分成 $M$ 堆，并且满足这 $M$ 堆石子中石子数最多的一堆至多比石子数最少的一堆多 $1$（即分的尽量平均，事实上按照这样的分石子万法，选定 $M$ 和一堆石子后，它分出来的状态是固定的）。当一个玩家不能操作的时候，也就是当每一堆石子的数量都严格小于 $F$ 时，他就输掉。补充：先手从 $N$ 堆石子中选择一堆数量不小于 $F$ 的石子分成 $M$ 堆后，此时共有 $N+M-1$ 堆石子，接下来小 A 从这 $N+M-1$ 堆石子中选择一堆数量不小于 $F$ 的石子，依此类推。\n\n小 A 从小就是个有风度的男生，他邀请他的对手作为先手。小 A 现在想要知道，面对给定的一组游戏，而且他的对手也和他一样聪明绝顶的话，究竟谁能够获得胜利？", "inputFormat": "输入第一行包含两个正整数 $T$ 和 $F$，分别表示游戏组数与给定的数。\n\n接下来 $T$ 行，每行第一个数 $N$ 表示该组游戏初始状态下有多少堆石子。之后 $N$ 个正整数，表示这 $N$ 堆石子分别有多少个。", "outputFormat": "输出一行，包含 $T$ 个用空格隔开的 $0$ 或 $1$ 的数，其中 $0$ 代表此时小 A（后手）会胜利，而 $1$ 代表小 A 的对手（先手）会胜利。", "hint": "对于 $100\\%$ 的数据，$T \\lt 100$，$N \\lt 100$，$F \\lt 100000$，每堆石子数量${}\\lt 100000$。\n\n以上所有数均为正整数。", "locale": "zh-CN"}}}
{"pid": "P3236", "type": "P", "difficulty": 7, "samples": [["1\n3\n4 3 2\n2 3 4\n3 2 1\n2 3 2\n2 2 4\n1 1 3", "30"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2014", "各省省选", "湖南", "分治", "二分图", "叉积"], "title": "[HNOI2014] 画框", "background": "", "description": "小 T 准备在家里摆放几幅画，为此他买来了 $N$ 幅画和 $N$ 个画框。为了体现他的品味，小 T 希望能合理地搭配画与画框，使得其显得既不过于平庸也不太违和。\n\n对于第 $i$ 幅画与第 $j$ 个画框的配对，小 T 都给出了这个配对的平凡度 $A_{i, j}$ 与违和度 $B_{i, j}$ 。整个搭配方案的总体不和谐度为每对画与画框平凡度之和与每对画与画框违和度的乘积。具体来说，设搭配方案中第 $i$ 幅画与第 $P_i$ 个画框配对，则总体不和谐度为\n\n$$\\mathrm{disharmony}=\\sum_{i=1}^{N}A_{i,p_i}\\times \\sum_{i=1}^{N}B_{i,p_i}$$\n小 T 希望知道通过搭配能得到的最小的总体不和谐度是多少。\n", "inputFormat": "输入文件第 $1$ 行是一个正整数 $T$，表示数据组数，接下来是 $T$ 组数据。对于每组数据，第 $1$ 行是一个正整数 $N$，表示有 $N$ 对画和画框。第 $2$ 到第 $N+1$ 行，每行有 $N$ 个非负整数，第 $i+1$ 行第 $j$ 个数表示 $A_{i,  j}$。第 $N+2$ 到第 $2N+1$ 行，每行有 $N$ 个非负整数，第 $i+N+1$ 行第 $j$ 个数表示 $B_{i, j}$ 。\n", "outputFormat": "包含 $T$ 行，每行一个整数，表示最小的总体不和谐度。\n", "hint": "第 $1$ 幅画搭配第 $3$ 个画框，第 $2$ 幅画搭配第 $1$ 个画框，第 $3$ 幅画搭配第 $2$ 个画框，则总体不和谐度为 $30$。\n\n对于 $100\\%$ 的数据，$N\\leq 70$，$T\\leq 3$，$A_{i, j}\\leq 200$，$B_{i, j}\\leq 200$。\n", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2014] Picture Frames", "background": "", "description": "Xiao T (小 T) plans to place several paintings at home. He has bought $N$ paintings and $N$ frames. To show his taste, he wants to match paintings with frames so that the result is neither too plain nor too jarring.\n\nFor the pairing of painting $i$ with frame $j$, Xiao T assigns a plainness value $A_{i, j}$ and an incompatibility value $B_{i, j}$. The overall disharmony of a complete matching is defined as the product of the sum of plainness values over all matched pairs and the sum of incompatibility values over all matched pairs. Specifically, let painting $i$ be matched with frame $p_i$; then the overall disharmony is\n$$\\mathrm{disharmony}=\\sum_{i=1}^{N}A_{i,p_i}\\times \\sum_{i=1}^{N}B_{i,p_i}.$$\nXiao T wants to know the minimum possible overall disharmony.", "inputFormat": "The first line contains a positive integer $T$, the number of test cases. For each test case:\n- The first line contains a positive integer $N$, the number of paintings and frames.\n- Lines $2$ through $N+1$ each contain $N$ non-negative integers; on line $i+1$, the $j$-th number is $A_{i, j}$.\n- Lines $N+2$ through $2N+1$ each contain $N$ non-negative integers; on line $i+N+1$, the $j$-th number is $B_{i, j}$.", "outputFormat": "Output $T$ lines, each containing one integer: the minimum overall disharmony.", "hint": "If painting $1$ is matched with frame $3$, painting $2$ with frame $1$, and painting $3$ with frame $2$, then the overall disharmony is $30$.\n\nConstraints: For $100\\%$ of the testdata, $N \\leq 70$, $T \\leq 3$, $A_{i, j} \\leq 200$, $B_{i, j} \\leq 200$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2014] 画框", "background": "", "description": "小 T 准备在家里摆放几幅画，为此他买来了 $N$ 幅画和 $N$ 个画框。为了体现他的品味，小 T 希望能合理地搭配画与画框，使得其显得既不过于平庸也不太违和。\n\n对于第 $i$ 幅画与第 $j$ 个画框的配对，小 T 都给出了这个配对的平凡度 $A_{i, j}$ 与违和度 $B_{i, j}$ 。整个搭配方案的总体不和谐度为每对画与画框平凡度之和与每对画与画框违和度的乘积。具体来说，设搭配方案中第 $i$ 幅画与第 $P_i$ 个画框配对，则总体不和谐度为\n\n$$\\mathrm{disharmony}=\\sum_{i=1}^{N}A_{i,p_i}\\times \\sum_{i=1}^{N}B_{i,p_i}$$\n小 T 希望知道通过搭配能得到的最小的总体不和谐度是多少。\n", "inputFormat": "输入文件第 $1$ 行是一个正整数 $T$，表示数据组数，接下来是 $T$ 组数据。对于每组数据，第 $1$ 行是一个正整数 $N$，表示有 $N$ 对画和画框。第 $2$ 到第 $N+1$ 行，每行有 $N$ 个非负整数，第 $i+1$ 行第 $j$ 个数表示 $A_{i,  j}$。第 $N+2$ 到第 $2N+1$ 行，每行有 $N$ 个非负整数，第 $i+N+1$ 行第 $j$ 个数表示 $B_{i, j}$ 。\n", "outputFormat": "包含 $T$ 行，每行一个整数，表示最小的总体不和谐度。\n", "hint": "第 $1$ 幅画搭配第 $3$ 个画框，第 $2$ 幅画搭配第 $1$ 个画框，第 $3$ 幅画搭配第 $2$ 个画框，则总体不和谐度为 $30$。\n\n对于 $100\\%$ 的数据，$N\\leq 70$，$T\\leq 3$，$A_{i, j}\\leq 200$，$B_{i, j}\\leq 200$。\n", "locale": "zh-CN"}}}
{"pid": "P3237", "type": "P", "difficulty": 5, "samples": [["5\n5\n4\n3\n2\n1\n1 2\n1 3\n2 4\n2 5", "3"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["数学", "2014", "各省省选", "湖南", "树形 DP", "哈希 hashing"], "title": "[HNOI2014] 米特运输", "background": null, "description": "米特是 D 星球上一种非常神秘的物质，蕴含着巨大的能量。在以米特为主要能源的 D 星上，这种米特能源的运输和储存一直是一个大问题。\n\nD 星上有 $N$ 个城市，我们将其顺序编号为 $1$ 到 $N$，$1$ 号城市为首都。这 $N$ 个城市由 $N-1$ 条单向高速通道连接起来，构成一棵以 $1$ 号城市（首部）为根的树，高速通道的方向由树中的儿子指向父亲。树按深度分层：根结点深度为 $0$，属于第 $1$ 层；根结点的子节点深度为 $1$，属于第 $2$ 层；依此类推，深度为 $i$ 的结点属于第 $i+1$ 层。\n\n建好高速通道之后，D 星人开始考虑如何具体地储存和传输米特资源。由于发展程度不同，每个城市储存米特的能力不尽相同，其中第 $i$ 个城市建有一个容量为 $A_i$ 的米特储存器。这个米特储存器除了具有储存的功能，还具有自动收集米特的能力。\n\n如果到了晚上六点，有某个储存器处于未满的状态，它就会自动收集大气中蕴含的米特能源，在早上六点之前就能收集满；但是，只有在储存器完全空的状态下启动自动收集程序才是安全的，未满而又非空时启动可能有安全隐患。\n\n早上六点到七点间，根节点城市（$1$ 号城市）会将其储存器里的米特消耗殆尽。根节点不会自动搜集米特，它只接受子节点传输来的米特。\n\n早上七点，城市之间启动米特传输过程，传输过程逐层递进：先是第 $2$ 层节点城市向第 $1$ 层（根节点城市，即 $1$ 号城市）传输，直到第 $1$ 层的储存器满或第 $2$ 层的储存器全为空；然后是第 $3$ 层向第 $2$ 层传输，直到对于第 $2$ 层的每个节点，其储存器满或其子节点（位于第 $3$ 层）的储存器全为空；依此类推，直到最后一层传输完成。传输过程一定会在晚上六点前完成。\n\n由于技术原因，运输方案需要满足以下条件：\n\n1. 不能让某个储存器到了晚上六点传输结束时还处于非空但又未满的状态，这个时候储存器仍然会启动自动收集米特的程序，而给已经储存有米特的储存器启动收集程序可能导致危险，也就是说要让储存器到了晚上六点时要么空要么满；\n\n2. 关于首都——即 $1$ 号城市的特殊情况，  每天早上六点到七点间 $1$ 号城市中的米特储存器里的米特会自动被消耗殆尽，即运输方案不需要考虑首都的米特怎么运走；\n\n3. 除了 $1$ 号城市，每个节点必须在其子节点城市向它运输米特之前将这座城市的米特储存器中原本存有的米特全部运出去给父节点，不允许储存器中残存的米特与外来的米特发生混合；\n\n4. 运向某一个城市的若干个来源的米特数量必须完全相同，不然，这些来源不同的米特按不同比例混合之后可能发生危险。\n\n现在 D 星人已经建立好高速通道，每个城市也有了一定储存容量的米特储存器。为了满足上面的限制条件，可能需要重建一些城市中的米特储存器。你可以，也只能，将某一座城市（包括首都）中原来存在的米特储存器摧毁，再新建一座任意容量的新的米特储存器，其容量可以是小数（在输入数据中，储存器原始容量是正整数，但重建后可以是小数），不能是负数或零，使得需要被重建的米特储存器的数目尽量少。\n\n**形式化题面**：\n\n给定一棵有 $n$ 个结点的树，每个点有正整数权值 $a_i$，\n\n称一个权值方案 $w$ 是好的，当且仅当：\n\n对于所有非叶结点 $u$，$u$ 的所有儿子的 $w_v$ 均相等，且 $\\sum_vw_v=w_u$。\n\n请改动一些 $a_i$，使得方案是好的。请注意，你可以将 $a_i$ 修改为任意**正实数**。\n\n求出最小的改动数。", "inputFormat": "第一行是一个正整数 $N$，表示城市的数目。    \n接下来 $N$ 行，每行一个正整数，其中的第 $i$ 行表示第 $i$ 个城市原来存在的米特储存器的容量。    \n再接下来是 $N-1$ 行，每行两个正整数 $a，b$ 表示城市 $b$ 到城市 $a$ 有一条高速通道 $(a≠b)$。", "outputFormat": "输出文件仅包含一行，一个整数，表示最少的被重建（即修改储存器容量）的米特储存器的数目。", "hint": "【样例解释】\n\n一个最优解是将 $A_1$ 改成 $8$，$A_3$ 改成 $4$，$A_5$ 改成 $2$。这样，$2$ 和 $3$ 运给 $1$ 的量相等，$4$ 和 $5$ 运给 $2$ 的量相等，且每天晚上六点的时候，$1$，$2$ 满，$3$，$4$，$5$ 空，满足所有限制条件。\n\n对于 $100\\%$ 的数据满足 $N<500000，A_j<10^8$。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2014] Mite Transportation", "background": "", "description": "Mite (mi te) is a very mysterious substance on planet D, containing huge amounts of energy. On planet D, which uses mite as its main energy source, transporting and storing this mite energy has always been a major problem.\n\nThere are $N$ cities on planet D, numbered $1$ through $N$, with city $1$ being the capital. These $N$ cities are connected by $N-1$ one-way expressways, forming a directed tree rooted at city $1$ (the capital). The direction of each expressway is from a child to its parent. The tree is layered by depth: the root has depth $0$ and belongs to layer $1$; a child of the root has depth $1$ and belongs to layer $2$; and so on, a node of depth $i$ belongs to layer $i+1$.\n\nAfter building the expressways, the D people began to consider how to store and transmit mite. Due to differing levels of development, each city has a different storage capacity. City $i$ has a mite storage unit with capacity $A_i$. Besides storing, a storage unit can also automatically collect mite from the atmosphere.\n\nIf, at 6 pm, some storage unit is not full, it will automatically collect mite from the atmosphere and will be filled before 6 am the next day; however, it is only safe to start this auto-collection when the storage unit is completely empty. Starting auto-collection when a storage unit is non-empty but not full may cause safety hazards.\n\nBetween 6 am and 7 am, the capital (city $1$) consumes all mite in its storage unit. The root does not auto-collect mite; it only accepts mite transmitted from its children.\n\nAt 7 am, cities start the transmission process, proceeding layer by layer: first, cities in layer $2$ transmit to layer $1$ (the root, city $1$), until the root’s storage is full or all layer-$2$ storage units are empty; then layer $3$ transmits to layer $2$, ensuring that for every node in layer $2$, its storage becomes full or all of its children’s (in layer $3$) storage units become empty; and so on, until the last layer completes transmission. The transmission process will certainly finish before 6 pm.\n\nDue to technical reasons, the transportation plan must satisfy the following conditions:\n1. No storage unit may remain non-empty but not full at 6 pm when transmission ends. Otherwise, it would start auto-collection while already containing mite, which is dangerous. In other words, by 6 pm, every storage unit must be either empty or full.\n2. For the capital (city $1$), every day between 6 am and 7 am its storage unit is automatically emptied. The transportation plan does not need to consider how to move mite out of the capital.\n3. Except for city $1$, each node must first send out all the mite originally stored in its own storage unit to its parent before its children transmit mite to it. Mixing locally stored mite with incoming mite is not allowed.\n4. For any city, the amounts of mite sent to it from its multiple sources must be exactly the same. Otherwise, mixing different sources in different proportions may be dangerous.\n\nNow that the expressways are built and each city has a storage unit with some capacity, to meet the above constraints, it may be necessary to rebuild some storage units. You may, and only may, destroy the existing storage unit in a city (including the capital) and build a new one with any positive capacity. The new capacity may be a real number (in the input, original capacities are positive integers, but rebuilt capacities may be fractional), and it cannot be negative or zero. Your goal is to minimize the number of storage units that need to be rebuilt.", "inputFormat": "The first line contains a positive integer $N$, the number of cities.  \nThe next $N$ lines each contain a positive integer; line $i$ gives the original capacity of the storage unit in city $i$.  \nThen follow $N-1$ lines, each containing two positive integers $a, b$, indicating there is a one-way expressway from city $b$ to city $a$ ($a \\ne b$).", "outputFormat": "Output a single line with one integer: the minimum number of storage units that must be rebuilt (i.e., whose capacities are modified).", "hint": "Sample explanation:\nOne optimal solution is to change $A_1$ to $8$, $A_3$ to $4$, and $A_5$ to $2$. Then the amounts sent from $2$ and $3$ to $1$ are equal, the amounts sent from $4$ and $5$ to $2$ are equal, and at 6 pm every day, $1$ and $2$ are full while $3$, $4$, and $5$ are empty, satisfying all constraints.\n\nConstraints:\nFor $100\\%$ of the testdata, $N < 500000$, $A_j < 10^8$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2014] 米特运输", "background": null, "description": "米特是 D 星球上一种非常神秘的物质，蕴含着巨大的能量。在以米特为主要能源的 D 星上，这种米特能源的运输和储存一直是一个大问题。\n\nD 星上有 $N$ 个城市，我们将其顺序编号为 $1$ 到 $N$，$1$ 号城市为首都。这 $N$ 个城市由 $N-1$ 条单向高速通道连接起来，构成一棵以 $1$ 号城市（首部）为根的树，高速通道的方向由树中的儿子指向父亲。树按深度分层：根结点深度为 $0$，属于第 $1$ 层；根结点的子节点深度为 $1$，属于第 $2$ 层；依此类推，深度为 $i$ 的结点属于第 $i+1$ 层。\n\n建好高速通道之后，D 星人开始考虑如何具体地储存和传输米特资源。由于发展程度不同，每个城市储存米特的能力不尽相同，其中第 $i$ 个城市建有一个容量为 $A_i$ 的米特储存器。这个米特储存器除了具有储存的功能，还具有自动收集米特的能力。\n\n如果到了晚上六点，有某个储存器处于未满的状态，它就会自动收集大气中蕴含的米特能源，在早上六点之前就能收集满；但是，只有在储存器完全空的状态下启动自动收集程序才是安全的，未满而又非空时启动可能有安全隐患。\n\n早上六点到七点间，根节点城市（$1$ 号城市）会将其储存器里的米特消耗殆尽。根节点不会自动搜集米特，它只接受子节点传输来的米特。\n\n早上七点，城市之间启动米特传输过程，传输过程逐层递进：先是第 $2$ 层节点城市向第 $1$ 层（根节点城市，即 $1$ 号城市）传输，直到第 $1$ 层的储存器满或第 $2$ 层的储存器全为空；然后是第 $3$ 层向第 $2$ 层传输，直到对于第 $2$ 层的每个节点，其储存器满或其子节点（位于第 $3$ 层）的储存器全为空；依此类推，直到最后一层传输完成。传输过程一定会在晚上六点前完成。\n\n由于技术原因，运输方案需要满足以下条件：\n\n1. 不能让某个储存器到了晚上六点传输结束时还处于非空但又未满的状态，这个时候储存器仍然会启动自动收集米特的程序，而给已经储存有米特的储存器启动收集程序可能导致危险，也就是说要让储存器到了晚上六点时要么空要么满；\n\n2. 关于首都——即 $1$ 号城市的特殊情况，  每天早上六点到七点间 $1$ 号城市中的米特储存器里的米特会自动被消耗殆尽，即运输方案不需要考虑首都的米特怎么运走；\n\n3. 除了 $1$ 号城市，每个节点必须在其子节点城市向它运输米特之前将这座城市的米特储存器中原本存有的米特全部运出去给父节点，不允许储存器中残存的米特与外来的米特发生混合；\n\n4. 运向某一个城市的若干个来源的米特数量必须完全相同，不然，这些来源不同的米特按不同比例混合之后可能发生危险。\n\n现在 D 星人已经建立好高速通道，每个城市也有了一定储存容量的米特储存器。为了满足上面的限制条件，可能需要重建一些城市中的米特储存器。你可以，也只能，将某一座城市（包括首都）中原来存在的米特储存器摧毁，再新建一座任意容量的新的米特储存器，其容量可以是小数（在输入数据中，储存器原始容量是正整数，但重建后可以是小数），不能是负数或零，使得需要被重建的米特储存器的数目尽量少。\n\n**形式化题面**：\n\n给定一棵有 $n$ 个结点的树，每个点有正整数权值 $a_i$，\n\n称一个权值方案 $w$ 是好的，当且仅当：\n\n对于所有非叶结点 $u$，$u$ 的所有儿子的 $w_v$ 均相等，且 $\\sum_vw_v=w_u$。\n\n请改动一些 $a_i$，使得方案是好的。请注意，你可以将 $a_i$ 修改为任意**正实数**。\n\n求出最小的改动数。", "inputFormat": "第一行是一个正整数 $N$，表示城市的数目。    \n接下来 $N$ 行，每行一个正整数，其中的第 $i$ 行表示第 $i$ 个城市原来存在的米特储存器的容量。    \n再接下来是 $N-1$ 行，每行两个正整数 $a，b$ 表示城市 $b$ 到城市 $a$ 有一条高速通道 $(a≠b)$。", "outputFormat": "输出文件仅包含一行，一个整数，表示最少的被重建（即修改储存器容量）的米特储存器的数目。", "hint": "【样例解释】\n\n一个最优解是将 $A_1$ 改成 $8$，$A_3$ 改成 $4$，$A_5$ 改成 $2$。这样，$2$ 和 $3$ 运给 $1$ 的量相等，$4$ 和 $5$ 运给 $2$ 的量相等，且每天晚上六点的时候，$1$，$2$ 满，$3$，$4$，$5$ 空，满足所有限制条件。\n\n对于 $100\\%$ 的数据满足 $N<500000，A_j<10^8$。", "locale": "zh-CN"}}}
{"pid": "P3238", "type": "P", "difficulty": 7, "samples": [["4 5 2\n1 2 2\n1 3 2\n3 4 4\n3 2 1\n2 4 3\n1 5", "6\r\n6"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["2014", "各省省选", "平衡树", "湖南", "最短路"], "title": "[HNOI2014] 道路堵塞", "background": "### 本题可能不存在正确解法，题解均已被 hack。", "description": "A 国有 $N$ 座城市，依次标为 $1$ 到 $N$。同时，在这 $N$ 座城市间有 $M$ 条单向道路，每条道路的长度是一个正整数。现在，A 国交通部指定了一条从城市 $1$ 到城市 $N$ 的路径，并且保证这条路径的长度是所有从城市 $1$ 到城市 $N$ 的路径中最短的。不幸的是，因为从城市 $1$ 到城市 $N$ 旅行的人越来越多，这条由交通部指定的路径经常发生堵塞。现在 A 国想知道，这条路径中的任意一条道路无法通行时，由城市 $1$ 到 $N$ 的最短路径长度是多少。", "inputFormat": "输入文件第一行是三个用空格分开的正整数 $N$、$M$ 和 $L$，分别表示城市数目、单向道路数目和交通部指定的最短路径包含多少条道路。按下来 $M$ 行，每行三个用空格分开的整数 $a$、$b$ 和 $c$，表示存在一条由城市 $a$ 到城市 $b$ 的长度为 $c$ 的单向道路。这 $M$ 行的行号也是对应道路的编号，即其中第 $1$ 行对应的道路编号为 $1$，第 $2$ 行对应的道路编号为 $2$，......，第 $M$ 行对应的道路编号为 $M$。最后一行为 $L$ 个用空格分开的整数 $\\operatorname{sp}(1),\\ldots,\\operatorname{sp}(L)$，依次表示从城市 $1$ 到城市 $N$ 的由交通部指定的最短路径上的道路的编号。", "outputFormat": "输出文件包含 $L$ 行，每行为一个整数，第 $i$ 行（$i = 1,2,\\ldots,L$）的整数表示删去编号为 $\\operatorname{sp}(i)$ 的道路后从城市 $1$ 到城市 $N$ 的最短路径长度。如果去掉后没有从城市 $1$ 到城市 $N$ 的路径，则输出 $-1$。", "hint": "$100\\%$ 的数据满足 $2 < N < 100000$，$1 < M < 200000$，$c \\in [0, 10000] \\cap \\mathbb{Z}$。\n\n数据已加强 By Vfleaking。\n\n2023.4.8 添加两组 hack 数据。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2014] Roadblock", "background": "This problem may not have a correct solution; all posted solutions have been hacked.", "description": "Country A has $N$ cities, numbered $1$ to $N$. There are $M$ directed roads between these $N$ cities, and the length of each road is a positive integer. The Ministry of Transport of Country A has designated a path from city $1$ to city $N$, and it is guaranteed that this path has the shortest length among all paths from city $1$ to city $N$. Unfortunately, as more and more people travel from city $1$ to city $N$, this designated path often gets congested. Now Country A wants to know, for each road on this path, what the shortest path length from city $1$ to city $N$ would be if that road becomes impassable.", "inputFormat": "The first line contains three space-separated positive integers $N$, $M$, and $L$, denoting the number of cities, the number of directed roads, and how many roads are on the designated shortest path, respectively.  \nThe next $M$ lines each contain three space-separated integers $a$, $b$, and $c$, indicating there is a directed road from city $a$ to city $b$ with length $c$. The line numbers of these $M$ lines are also the corresponding road IDs; that is, the $1$-st of these lines corresponds to road ID $1$, the $2$-nd corresponds to road ID $2$, ..., and the $M$-th corresponds to road ID $M$.  \nThe last line contains $L$ space-separated integers $\\operatorname{sp}(1), \\ldots, \\operatorname{sp}(L)$, which in order denote the IDs of the roads on the designated shortest path from city $1$ to city $N$.", "outputFormat": "Output $L$ lines, each containing one integer. The integer on the $i$-th line ($i = 1, 2, \\ldots, L$) is the length of the shortest path from city $1$ to city $N$ after removing the road with ID $\\operatorname{sp}(i)$. If there is no path from city $1$ to city $N$ after the removal, output $-1$.", "hint": "$100\\%$ of the testdata satisfies $2 < N < 100000$, $1 < M < 200000$, $c \\in [0, 10000] \\cap \\mathbb{Z}$.\n\nTestdata has been strengthened by Vfleaking.\n\nTwo sets of hack testdata were added on 2023-04-08.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2014] 道路堵塞", "background": "### 本题可能不存在正确解法，题解均已被 hack。", "description": "A 国有 $N$ 座城市，依次标为 $1$ 到 $N$。同时，在这 $N$ 座城市间有 $M$ 条单向道路，每条道路的长度是一个正整数。现在，A 国交通部指定了一条从城市 $1$ 到城市 $N$ 的路径，并且保证这条路径的长度是所有从城市 $1$ 到城市 $N$ 的路径中最短的。不幸的是，因为从城市 $1$ 到城市 $N$ 旅行的人越来越多，这条由交通部指定的路径经常发生堵塞。现在 A 国想知道，这条路径中的任意一条道路无法通行时，由城市 $1$ 到 $N$ 的最短路径长度是多少。", "inputFormat": "输入文件第一行是三个用空格分开的正整数 $N$、$M$ 和 $L$，分别表示城市数目、单向道路数目和交通部指定的最短路径包含多少条道路。按下来 $M$ 行，每行三个用空格分开的整数 $a$、$b$ 和 $c$，表示存在一条由城市 $a$ 到城市 $b$ 的长度为 $c$ 的单向道路。这 $M$ 行的行号也是对应道路的编号，即其中第 $1$ 行对应的道路编号为 $1$，第 $2$ 行对应的道路编号为 $2$，......，第 $M$ 行对应的道路编号为 $M$。最后一行为 $L$ 个用空格分开的整数 $\\operatorname{sp}(1),\\ldots,\\operatorname{sp}(L)$，依次表示从城市 $1$ 到城市 $N$ 的由交通部指定的最短路径上的道路的编号。", "outputFormat": "输出文件包含 $L$ 行，每行为一个整数，第 $i$ 行（$i = 1,2,\\ldots,L$）的整数表示删去编号为 $\\operatorname{sp}(i)$ 的道路后从城市 $1$ 到城市 $N$ 的最短路径长度。如果去掉后没有从城市 $1$ 到城市 $N$ 的路径，则输出 $-1$。", "hint": "$100\\%$ 的数据满足 $2 < N < 100000$，$1 < M < 200000$，$c \\in [0, 10000] \\cap \\mathbb{Z}$。\n\n数据已加强 By Vfleaking。\n\n2023.4.8 添加两组 hack 数据。", "locale": "zh-CN"}}}
{"pid": "P3239", "type": "P", "difficulty": 6, "samples": [["1\n3 2\n0.5000 2\n0.3000 3\n0.9000 1", "3.2660250000"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 2000, 2000, 2000, 2000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["动态规划 DP", "2015", "各省省选", "湖南", "Special Judge", "期望"], "title": "[HNOI2015] 亚瑟王", "background": "", "description": "小 K 不慎被 LL 邪教洗脑了，洗脑程度深到他甚至想要从亚瑟王邪教中脱坑。他决定，在脱坑之前，最后再来打一盘亚瑟王。既然是最后一战，就一定要打得漂亮。众所周知，亚瑟王是一个看脸的游戏，技能的发动都是看概率的。\n\n作为一个非洲人，同时作为一个前 OIer，小 K 自然是希望最大化造成伤害的期望值。但他已经多年没写过代码，连 Spaly都敲不对了，因此，希望你能帮帮小 K，让他感受一下当欧洲人是怎样的体验。\n\n本题中我们将考虑游戏的一个简化版模型。 玩家有一套卡牌，共 $n$ 张。游戏时，玩家将 $n$ 张卡牌排列成某种顺序，排列后将卡牌按从前往后依次编号为 $1 -  n$。本题中，顺序已经确定，即为输入的顺序。每张卡牌都有一个技能。第 $i$ 张卡牌的技能发动概率为 $p_i$，如果成功发动，则会对敌方造成 $d_i$ 点伤害。也只有通过发动技能，卡牌才能对敌方造成伤害。基于现实因素以及小 K 非洲血统的考虑，$p_i$ 不会为 $0$，也不会为 $1$，即 $0 < p_i < 1$。 一局游戏一共有 $r$ 轮。在每一轮中，系统将从第一张卡牌开始，按照顺序依次考虑每张卡牌。在一轮中，对于依次考虑的每一张卡牌：\n\n1. 如果这张卡牌在这一局游戏中已经发动过技能，则\n\n1.1. 如果这张卡牌不是最后一张，则跳过之（考虑下一张卡牌）； 否则（是最后一张），结束这一轮游戏。\n\n2. 否则（这张卡牌在这一局游戏中没有发动过技能），设这张卡牌为第 $i$ 张\n\n2.1. 将其以 $p_i$ 的概率发动技能。\n\n2.2. 如果技能发动，则对敌方造成 $d_i$ 点伤害，并结束这一轮。\n\n2.3. 如果这张卡牌已经是最后一张（即 $i$ 等于 $n$），则结束这一轮；否则，考虑下一张卡牌。\n\n请帮助小 K 求出这一套卡牌在一局游戏中能造成的伤害的期望值。\n", "inputFormat": "输入文件的第一行包含一个整数 $T$，代表测试数据组数。 \n\n接下来一共 $T$ 组数据。 \n\n每组数据的第一行包含两个用空格分开的整数 $n$ 和 $r$，分别代表卡牌的张数和游戏的轮数。\n\n接下来 $n$ 行，每行包含一个实数和一个整数，由空格隔开，描述一张卡牌。第$i$ 行的两个数为 $p_i$ 和 $d_i$，分别代表第 $i$ 张卡牌技能发动的概率（实数）和技能发动造成的伤害（整数）。保证 $p_i$ 最多包含 $4$ 位小数，且为一个合法的概率。\n", "outputFormat": "对于每组数据，输出一行，包含一个实数，为这套卡牌在这一局游戏中造成的伤害的期望值。对于每一行输出，只有当你的输出和标准答案的相对误差不超过 $10^{-8}$ 时——即 $\\frac{|a-o|}{a} \\leq 10^{-8}$ 时(其中 $a$ 是标准答案， $o$ 是输出)，你的输出才会被判为正确。建议输出 $10$ 位小数。\n", "hint": "一共有 $13$ 种可能的情况：\n\n1.  第一轮中，第 $1$ 张卡牌发动技能；第二轮中，第 $2$ 张卡牌发动技能；\n\n概率为 $0.15$，伤害为 $5$。\n\n2.  第一轮中，第 $1$ 张卡牌发动技能；第二轮中，第 $3$ 张卡牌发动技能；\n\n概率为 $0.315$，伤害为 $3$。\n\n3.  第一轮中，第 $1$ 张卡牌发动技能；第二轮不发动技能；\n\n概率为 $0.035$，伤害为 $2$。\n\n4.  第一轮中，第 $2$ 张卡牌发动技能；第二轮中，第 $1$ 张卡牌发动技能；\n\n概率为 $0.075$，伤害为 $5$。\n\n5.  第一轮中，第 $2$ 张卡牌发动技能；第二轮中，第 $3$ 张卡牌发动技能；\n\n概率为 $0.0675$，伤害为 $4$。\n\n6.  第一轮中，第 $2$ 张卡牌发动技能；第二轮不发动技能；\n\n概率为 $0.0075$，伤害为 $3$。\n\n7.  第一轮中，第 $3$ 张卡牌发动技能；第二轮中，第 $1$ 张卡牌发动技能；\n\n概率为 $0.1575$，伤害为 $3$。\n\n8.  第一轮中，第 $3$ 张卡牌发动技能；第二轮中，第 $2$ 张卡牌发动技能；\n\n概率为 $0.04725$，伤害为 $4$。\n\n9.  第一轮中，第 $3$ 张卡牌发动技能；第二轮不发动技能；\n\n概率为 $0.11025$，伤害为 $1$。\n\n10.  第一轮不发动技能；第二轮中，第 $1$ 张卡牌发动技能；\n\n概率为 $0.0175$，伤害为 $2$。\n\n11.  第一轮不发动技能；第二轮中，第 $2$ 张卡牌发动技能；\n\n概率为 $0.00525$，伤害为 $3$。\n\n12.  第一轮不发动技能；第二轮中，第 $3$ 张卡牌发动技能；\n\n概率为 $0.011025$，伤害为 $1$。\n\n13.  第一轮不发动技能；第二轮亦不发动技能；\n\n概率为 $0.001225$，伤害为 $0$。\n\n造成伤害的期望值为概率与对应伤害乘积之和，为 $3.266025$。\n\n\n对于所有测试数据， $1 \\leq T \\leq 444， 1 \\leq n \\leq 220， 0 \\leq r \\leq 132， 0 < p_i < 1， 0 \\leq d_i \\leq 1000$。\n\n除非备注中有特殊说明，数据中 $p_i$ 与 $d_i$ 均为随机生成。\n\n请注意可能存在的实数精度问题，并采取适当措施。\n\n本题使用 `special_judge`。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2015] King Arthur", "background": "", "description": "Xiao K was accidentally brainwashed by the LL cult, to the extent that he even wants to quit the King Arthur cult. He decides to play one last game of King Arthur before quitting. Since it is the final battle, it must look good. As is well known, King Arthur is a game of luck, and the activation of skills is probabilistic.\n\nAs an unlucky player (slang “African”), and also a former OIer, Xiao K naturally wants to maximize the expected damage dealt. But he has not coded for many years and cannot even code Splay correctly, so he hopes you can help him experience what it is like to be “European” (i.e., lucky).\n\nIn this problem we consider a simplified model of the game. The player has a deck of $n$ cards. During the game, the player arranges the $n$ cards in some order, and after arranging, numbers the cards from front to back as $1 -  n$. In this problem, the order is already fixed, which is the input order. Each card has a skill. The activation probability of the $i$-th card’s skill is $p_i$, and if it successfully activates, it deals $d_i$ damage to the opponent. Only by activating the skill can a card deal damage to the opponent. Considering practical factors and Xiao K’s “African” luck, $p_i$ is neither $0$ nor $1$, i.e., $0 < p_i < 1$. A game consists of $r$ rounds. In each round, the system starts from the first card and considers each card in order. In one round, for each card considered in order:\n\n1. If this card has already activated its skill in this game, then\n\n1.1. If this card is not the last one, skip it (consider the next card); otherwise (it is the last one), end this round.\n\n2. Otherwise (this card has not activated its skill in this game), let this card be the $i$-th card.\n\n2.1. Attempt to activate its skill with probability $p_i$.\n\n2.2. If the skill activates, deal $d_i$ damage to the opponent and end this round.\n\n2.3. If this card is already the last one (i.e., $i$ equals $n$), end this round; otherwise, consider the next card.\n\nPlease help Xiao K compute the expected damage this deck can deal in one game.", "inputFormat": "The first line of the input file contains an integer $T$, representing the number of testdata groups.\n\nThen there are $T$ groups of data.\n\nThe first line of each group contains two space-separated integers $n$ and $r$, representing the number of cards and the number of rounds in the game, respectively.\n\nThen follow $n$ lines, each containing a real number and an integer separated by a space, describing one card. The two numbers on the $i$-th line are $p_i$ and $d_i$, representing the activation probability (real number) of the $i$-th card’s skill and the damage (integer) dealt when the skill activates. It is guaranteed that $p_i$ has at most $4$ decimal places and is a valid probability.", "outputFormat": "For each group of data, output one line containing a real number, which is the expected damage dealt by this deck in one game. For each output line, your output will be judged correct only if its relative error with the standard answer does not exceed $10^{-8}$—i.e., $\\frac{|a-o|}{a} \\leq 10^{-8}$ (where $a$ is the standard answer and $o$ is your output). It is recommended to output $10$ decimal places.", "hint": "There are $13$ possible cases:\n\n1. In round $1$, card $1$ activates; in round $2$, card $2$ activates.\n\nProbability is $0.15$, damage is $5$.\n\n2. In round $1$, card $1$ activates; in round $2$, card $3$ activates.\n\nProbability is $0.315$, damage is $3$.\n\n3. In round $1$, card $1$ activates; in round $2$ no skill activates.\n\nProbability is $0.035$, damage is $2$.\n\n4. In round $1$, card $2$ activates; in round $2$, card $1$ activates.\n\nProbability is $0.075$, damage is $5$.\n\n5. In round $1$, card $2$ activates; in round $2$, card $3$ activates.\n\nProbability is $0.0675$, damage is $4$.\n\n6. In round $1$, card $2$ activates; in round $2$ no skill activates.\n\nProbability is $0.0075$, damage is $3$.\n\n7. In round $1$, card $3$ activates; in round $2$, card $1$ activates.\n\nProbability is $0.1575$, damage is $3$.\n\n8. In round $1$, card $3$ activates; in round $2$, card $2$ activates.\n\nProbability is $0.04725$, damage is $4$.\n\n9. In round $1$, card $3$ activates; in round $2$ no skill activates.\n\nProbability is $0.11025$, damage is $1$.\n\n10. In round $1$ no skill activates; in round $2$, card $1$ activates.\n\nProbability is $0.0175$, damage is $2$.\n\n11. In round $1$ no skill activates; in round $2$, card $2$ activates.\n\nProbability is $0.00525$, damage is $3$.\n\n12. In round $1$ no skill activates; in round $2$, card $3$ activates.\n\nProbability is $0.011025$, damage is $1$.\n\n13. In round $1$ no skill activates; in round $2$ no skill activates.\n\nProbability is $0.001225$, damage is $0$.\n\nThe expected damage is the sum of the products of probabilities and corresponding damages, which is $3.266025$.\n\nConstraints: For all testdata, $1 \\leq T \\leq 444， 1 \\leq n \\leq 220， 0 \\leq r \\leq 132， 0 < p_i < 1， 0 \\leq d_i \\leq 1000$.\n\nUnless otherwise specified in the remarks, the $p_i$ and $d_i$ in the testdata are randomly generated.\n\nPlease be aware of possible floating-point precision issues and take appropriate measures.\n\nThis problem uses `special_judge`.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2015] 亚瑟王", "background": "", "description": "小 K 不慎被 LL 邪教洗脑了，洗脑程度深到他甚至想要从亚瑟王邪教中脱坑。他决定，在脱坑之前，最后再来打一盘亚瑟王。既然是最后一战，就一定要打得漂亮。众所周知，亚瑟王是一个看脸的游戏，技能的发动都是看概率的。\n\n作为一个非洲人，同时作为一个前 OIer，小 K 自然是希望最大化造成伤害的期望值。但他已经多年没写过代码，连 Spaly都敲不对了，因此，希望你能帮帮小 K，让他感受一下当欧洲人是怎样的体验。\n\n本题中我们将考虑游戏的一个简化版模型。 玩家有一套卡牌，共 $n$ 张。游戏时，玩家将 $n$ 张卡牌排列成某种顺序，排列后将卡牌按从前往后依次编号为 $1 -  n$。本题中，顺序已经确定，即为输入的顺序。每张卡牌都有一个技能。第 $i$ 张卡牌的技能发动概率为 $p_i$，如果成功发动，则会对敌方造成 $d_i$ 点伤害。也只有通过发动技能，卡牌才能对敌方造成伤害。基于现实因素以及小 K 非洲血统的考虑，$p_i$ 不会为 $0$，也不会为 $1$，即 $0 < p_i < 1$。 一局游戏一共有 $r$ 轮。在每一轮中，系统将从第一张卡牌开始，按照顺序依次考虑每张卡牌。在一轮中，对于依次考虑的每一张卡牌：\n\n1. 如果这张卡牌在这一局游戏中已经发动过技能，则\n\n1.1. 如果这张卡牌不是最后一张，则跳过之（考虑下一张卡牌）； 否则（是最后一张），结束这一轮游戏。\n\n2. 否则（这张卡牌在这一局游戏中没有发动过技能），设这张卡牌为第 $i$ 张\n\n2.1. 将其以 $p_i$ 的概率发动技能。\n\n2.2. 如果技能发动，则对敌方造成 $d_i$ 点伤害，并结束这一轮。\n\n2.3. 如果这张卡牌已经是最后一张（即 $i$ 等于 $n$），则结束这一轮；否则，考虑下一张卡牌。\n\n请帮助小 K 求出这一套卡牌在一局游戏中能造成的伤害的期望值。\n", "inputFormat": "输入文件的第一行包含一个整数 $T$，代表测试数据组数。 \n\n接下来一共 $T$ 组数据。 \n\n每组数据的第一行包含两个用空格分开的整数 $n$ 和 $r$，分别代表卡牌的张数和游戏的轮数。\n\n接下来 $n$ 行，每行包含一个实数和一个整数，由空格隔开，描述一张卡牌。第$i$ 行的两个数为 $p_i$ 和 $d_i$，分别代表第 $i$ 张卡牌技能发动的概率（实数）和技能发动造成的伤害（整数）。保证 $p_i$ 最多包含 $4$ 位小数，且为一个合法的概率。\n", "outputFormat": "对于每组数据，输出一行，包含一个实数，为这套卡牌在这一局游戏中造成的伤害的期望值。对于每一行输出，只有当你的输出和标准答案的相对误差不超过 $10^{-8}$ 时——即 $\\frac{|a-o|}{a} \\leq 10^{-8}$ 时(其中 $a$ 是标准答案， $o$ 是输出)，你的输出才会被判为正确。建议输出 $10$ 位小数。\n", "hint": "一共有 $13$ 种可能的情况：\n\n1.  第一轮中，第 $1$ 张卡牌发动技能；第二轮中，第 $2$ 张卡牌发动技能；\n\n概率为 $0.15$，伤害为 $5$。\n\n2.  第一轮中，第 $1$ 张卡牌发动技能；第二轮中，第 $3$ 张卡牌发动技能；\n\n概率为 $0.315$，伤害为 $3$。\n\n3.  第一轮中，第 $1$ 张卡牌发动技能；第二轮不发动技能；\n\n概率为 $0.035$，伤害为 $2$。\n\n4.  第一轮中，第 $2$ 张卡牌发动技能；第二轮中，第 $1$ 张卡牌发动技能；\n\n概率为 $0.075$，伤害为 $5$。\n\n5.  第一轮中，第 $2$ 张卡牌发动技能；第二轮中，第 $3$ 张卡牌发动技能；\n\n概率为 $0.0675$，伤害为 $4$。\n\n6.  第一轮中，第 $2$ 张卡牌发动技能；第二轮不发动技能；\n\n概率为 $0.0075$，伤害为 $3$。\n\n7.  第一轮中，第 $3$ 张卡牌发动技能；第二轮中，第 $1$ 张卡牌发动技能；\n\n概率为 $0.1575$，伤害为 $3$。\n\n8.  第一轮中，第 $3$ 张卡牌发动技能；第二轮中，第 $2$ 张卡牌发动技能；\n\n概率为 $0.04725$，伤害为 $4$。\n\n9.  第一轮中，第 $3$ 张卡牌发动技能；第二轮不发动技能；\n\n概率为 $0.11025$，伤害为 $1$。\n\n10.  第一轮不发动技能；第二轮中，第 $1$ 张卡牌发动技能；\n\n概率为 $0.0175$，伤害为 $2$。\n\n11.  第一轮不发动技能；第二轮中，第 $2$ 张卡牌发动技能；\n\n概率为 $0.00525$，伤害为 $3$。\n\n12.  第一轮不发动技能；第二轮中，第 $3$ 张卡牌发动技能；\n\n概率为 $0.011025$，伤害为 $1$。\n\n13.  第一轮不发动技能；第二轮亦不发动技能；\n\n概率为 $0.001225$，伤害为 $0$。\n\n造成伤害的期望值为概率与对应伤害乘积之和，为 $3.266025$。\n\n\n对于所有测试数据， $1 \\leq T \\leq 444， 1 \\leq n \\leq 220， 0 \\leq r \\leq 132， 0 < p_i < 1， 0 \\leq d_i \\leq 1000$。\n\n除非备注中有特殊说明，数据中 $p_i$ 与 $d_i$ 均为随机生成。\n\n请注意可能存在的实数精度问题，并采取适当措施。\n\n本题使用 `special_judge`。", "locale": "zh-CN"}}}
{"pid": "P3240", "type": "P", "difficulty": 6, "samples": [["5 4\n1 < 2\n1 < 3\n2 < 4\n1 = 5", "5"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["动态规划 DP", "数学", "2015", "并查集", "各省省选", "湖南"], "title": "[HNOI2015] 实验比较", "background": "", "description": "小 D 被邀请到实验室，做一个跟图片质量评价相关的主观实验。\n\n实验用到的图片集一共有 $N$ 张图片，编号为 $1$ 到 $N$。实验分若干轮进行，在每轮实验中，小 D 会被要求观看某两张随机选取的图片， 然后小 D 需要根据他自己主观上的判断确定这两张图片谁好谁坏，或者这两张图片质量差不多。 \n\n用符号 ”$<$”、“$>$” 和 “$=$” 表示图片 $x$ 和 $y$（$x$、$y$ 为图片编号）之间的比较：如果上下文中 $x$ 和 $y$ 是图片编号，则 $x<y$ 表示图片 $x$「质量优于」$y$，$x>y$ 表示图片 $x$「质量差于」$y$，$x=y$ 表示图片 $x$ 和 $y$ 「质量相同」；也就是说，这种上下文中，“$<$”、“$>$”、“$=$” 分别是质量优于、质量差于、质量相同的意思；在其他上下文中，这三个符号分别是小于、大于、等于的含义。\n\n图片质量比较的推理规则（在 $x$ 和 $y$ 是图片编号的上下文中）：\n1. $x < y$ 等价于 $y > x$。\n2. 若 $x < y$ 且 $y = z$，则 $x < z$。\n3. 若 $x < y$ 且 $x = z$，则 $z < y$。\n4. $x=y$ 等价于 $y=x$。\n5. 若 $x=y$ 且 $y=z$，则 $x=z$。 \n\n实验中，小 D 需要对一些图片对 $(x, y)$，给出 $x < y$ 或 $x = y$ 或 $x > y$ 的主观判断。小 D 在做完实验后， 忽然对这个基于局部比较的实验的一些全局性质产生了兴趣。\n\n在主观实验数据给定的情形下，定义这 $N$ 张图片的一个合法质量序列为形如 “$x_1 R_1 x_2 R_2 x_3 R_3 …x_{N-1} R_{N-1} x_N$” 的串，也可看作是集合 $\\{ x_i R_i x_{i+1}|1 \\leq i \\leq N-1 \\}$，其中  $x_i$ 为图片编号，$x_1,x_2, \\ldots ,x_N$ 两两互不相同（即不存在重复编号），$R_i$ 为 $<$ 或 $=$，「合法」是指这个图片质量序列与任何一对主观实验给出的判断不冲突。 \n\n例如： 质量序列 $3 < 1 = 2$ 与主观判断 “$3 > 1$，$3 = 2$” 冲突（因为质量序列中 $3<1$ 且 $1=2$，从而 $3<2$，这与主观判断中的 $3=2$ 冲突；同时质量序列中的 $3<1$ 与主观判断中的 $3>1$ 冲突） ，但与主观判断 “$2 = 1$，$3 < 2$”  不冲突；因此给定主观判断 “$3>1$，$3=2$” 时，$1<3=2$ 和 $1<2=3$ 都是合法的质量序列，$3<1=2$ 和 $1<2<3$ 都是非法的质量序列。\n\n由于实验已经做完一段时间了，小 D 已经忘了一部分主观实验的数据。对每张图片 $X_i$，小 D 都**最多**只记住了某一张质量不比 $X_i$ 好的另一张图片 $K_{X_i}$。这些小 D 仍然记得的质量判断一共有 $M$ 条（$0 \\leq M \\leq N$），其中第 $i$ 条涉及的图片对为 $(K_{X_i}, X_i)$，判断要么是 $K_{X_i} < X_i$，要么是 $K_{X_i} = X_i$，而且所有的 $X_i$ 互不相同。小 D 打算就以这 M 条自己还记得的质量判断作为他的所有主观数据。\n\n现在，基于这些主观数据，我们希望你帮小 D 求出这 $N$ 张图片一共有多少个不同的合法质量序列。我们规定：如果质量序列中出现 “$x = y$”，那么序列中交换 $x$ 和 $y$ 的位置后仍是同一个序列。因此： $1<2=3=4<5$ 和 $1<4=2=3<5$ 是同一个序列， $1 < 2 = 3$ 和 $1 < 3 = 2$ 是同一个序列，而 $1 < 2 < 3$ 与 $1 < 2 = 3$ 是不同的序列，$1<2<3$ 和 $2<1<3$ 是不同的序列。\n\n由于合法的图片质量序列可能很多， 所以你需要输出答案对 $10^9 + 7$ 取模的结果。", "inputFormat": "第一行两个正整数 $N,M$，分别代表图片总数和小 $D$ 仍然记得的判断的条数；\n\n接下来 $M$ 行，每行一条判断，每条判断形如「$x < y$」或者「$x = y$」。", "outputFormat": "输出仅一行，包含一个正整数，表示合法质量序列的数目对 $10^9+7$ 取模的结果。", "hint": "不同的合法序列共5个，如下所示：\n\n- $1 = 5 < 2 < 3 < 4$ \n- $1 = 5 < 2 < 4 < 3$\n- $1 = 5 < 2 < 3 = 4$ \n- $1 = 5 < 3 < 2 < 4$ \n- $1 = 5 < 2 = 3 < 4$\n\n$100\\%$ 的数据满足 $N \\leq 100$。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2015] Experimental Comparison", "background": "", "description": "Little D was invited to a lab to participate in a subjective experiment related to image quality assessment.\n\nThe dataset contains $N$ images, numbered $1$ to $N$. The experiment is conducted in several rounds. In each round, Little D is asked to look at two randomly selected images, and then, based on his subjective judgment, decide which image is better, or that their qualities are about the same.\n\nWe use the symbols “$<$”, “$>$”, and “$=$” to denote comparisons between images $x$ and $y$ ($x$, $y$ are image indices): if within the context $x$ and $y$ are image indices, then $x < y$ means “the quality of image $x$ is better than that of $y$,” $x > y$ means “the quality of image $x$ is worse than that of $y$,” and $x = y$ means “images $x$ and $y$ have equal quality.” That is, in such contexts, “$<$”, “$>$”, and “$=$” respectively mean better quality, worse quality, and equal quality; in other contexts, these three symbols retain their usual meanings of less than, greater than, and equal to.\n\nReasoning rules for image quality comparisons (in the context where $x$ and $y$ are image indices):\n1. $x < y$ is equivalent to $y > x$.\n2. If $x < y$ and $y = z$, then $x < z$.\n3. If $x < y$ and $x = z$, then $z < y$.\n4. $x = y$ is equivalent to $y = x$.\n5. If $x = y$ and $y = z$, then $x = z$.\n\nIn the experiment, Little D needs to provide a subjective judgment for some image pairs $(x, y)$: either $x < y$, or $x = y$, or $x > y$. After the experiment, Little D became interested in some global properties of this locally compared experiment.\n\nGiven the subjective experiment data, we define a legal quality sequence of these $N$ images as a string of the form “$x_1 R_1 x_2 R_2 x_3 R_3 \\dots x_{N-1} R_{N-1} x_N$,” which can also be regarded as the set $\\{ x_i R_i x_{i+1} \\mid 1 \\leq i \\leq N - 1 \\}$, where $x_i$ are image indices, $x_1, x_2, \\ldots, x_N$ are pairwise distinct (i.e., no duplicate indices), $R_i$ is either $<$ or $=$, and “legal” means that this quality sequence does not conflict with any of the subjective judgments.\n\nFor example: the quality sequence $3 < 1 = 2$ conflicts with the subjective judgments “$3 > 1$, $3 = 2$” (because in the sequence $3 < 1$ and $1 = 2$, hence $3 < 2$, which conflicts with $3 = 2$ in the judgments; meanwhile $3 < 1$ conflicts with $3 > 1$), but it does not conflict with the judgments “$2 = 1$, $3 < 2$.” Therefore, given the judgments “$3 > 1$, $3 = 2$,” both $1 < 3 = 2$ and $1 < 2 = 3$ are legal quality sequences, while $3 < 1 = 2$ and $1 < 2 < 3$ are illegal quality sequences.\n\nSince some time has passed since the experiment, Little D has forgotten part of the subjective data. For each image $X_i$, Little D remembers at most one other image $K_{X_i}$ whose quality is not better than $X_i$. Altogether there are $M$ remembered judgments ($0 \\leq M \\leq N$). The $i$-th judgment involves the pair $(K_{X_i}, X_i)$ and is either $K_{X_i} < X_i$ or $K_{X_i} = X_i$, and all $X_i$ are pairwise distinct. Little D decides to use precisely these $M$ remembered judgments as all his subjective data.\n\nNow, based on these subjective data, we ask you to help Little D compute how many different legal quality sequences there are for the $N$ images. We stipulate: if “$x = y$” appears in a sequence, then swapping the positions of $x$ and $y$ results in the same sequence. Therefore: $1 < 2 = 3 = 4 < 5$ and $1 < 4 = 2 = 3 < 5$ are the same sequence, $1 < 2 = 3$ and $1 < 3 = 2$ are the same sequence, whereas $1 < 2 < 3$ and $1 < 2 = 3$ are different sequences, and $1 < 2 < 3$ and $2 < 1 < 3$ are different sequences.\n\nAs the number of legal quality sequences can be large, you must output the answer modulo $10^9 + 7$.", "inputFormat": "The first line contains two positive integers $N, M$, the total number of images and the number of judgments that Little D still remembers.\n\nThe following $M$ lines each contain one judgment, in the form “$x < y$” or “$x = y$”.", "outputFormat": "Output a single line containing one positive integer, the number of legal quality sequences modulo $10^9 + 7$.", "hint": "There are 5 different legal sequences, as listed below:\n- $1 = 5 < 2 < 3 < 4$\n- $1 = 5 < 2 < 4 < 3$\n- $1 = 5 < 2 < 3 = 4$\n- $1 = 5 < 3 < 2 < 4$\n- $1 = 5 < 2 = 3 < 4$\n\nFor $100\\%$ of the testdata, $N \\leq 100$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2015] 实验比较", "background": "", "description": "小 D 被邀请到实验室，做一个跟图片质量评价相关的主观实验。\n\n实验用到的图片集一共有 $N$ 张图片，编号为 $1$ 到 $N$。实验分若干轮进行，在每轮实验中，小 D 会被要求观看某两张随机选取的图片， 然后小 D 需要根据他自己主观上的判断确定这两张图片谁好谁坏，或者这两张图片质量差不多。 \n\n用符号 ”$<$”、“$>$” 和 “$=$” 表示图片 $x$ 和 $y$（$x$、$y$ 为图片编号）之间的比较：如果上下文中 $x$ 和 $y$ 是图片编号，则 $x<y$ 表示图片 $x$「质量优于」$y$，$x>y$ 表示图片 $x$「质量差于」$y$，$x=y$ 表示图片 $x$ 和 $y$ 「质量相同」；也就是说，这种上下文中，“$<$”、“$>$”、“$=$” 分别是质量优于、质量差于、质量相同的意思；在其他上下文中，这三个符号分别是小于、大于、等于的含义。\n\n图片质量比较的推理规则（在 $x$ 和 $y$ 是图片编号的上下文中）：\n1. $x < y$ 等价于 $y > x$。\n2. 若 $x < y$ 且 $y = z$，则 $x < z$。\n3. 若 $x < y$ 且 $x = z$，则 $z < y$。\n4. $x=y$ 等价于 $y=x$。\n5. 若 $x=y$ 且 $y=z$，则 $x=z$。 \n\n实验中，小 D 需要对一些图片对 $(x, y)$，给出 $x < y$ 或 $x = y$ 或 $x > y$ 的主观判断。小 D 在做完实验后， 忽然对这个基于局部比较的实验的一些全局性质产生了兴趣。\n\n在主观实验数据给定的情形下，定义这 $N$ 张图片的一个合法质量序列为形如 “$x_1 R_1 x_2 R_2 x_3 R_3 …x_{N-1} R_{N-1} x_N$” 的串，也可看作是集合 $\\{ x_i R_i x_{i+1}|1 \\leq i \\leq N-1 \\}$，其中  $x_i$ 为图片编号，$x_1,x_2, \\ldots ,x_N$ 两两互不相同（即不存在重复编号），$R_i$ 为 $<$ 或 $=$，「合法」是指这个图片质量序列与任何一对主观实验给出的判断不冲突。 \n\n例如： 质量序列 $3 < 1 = 2$ 与主观判断 “$3 > 1$，$3 = 2$” 冲突（因为质量序列中 $3<1$ 且 $1=2$，从而 $3<2$，这与主观判断中的 $3=2$ 冲突；同时质量序列中的 $3<1$ 与主观判断中的 $3>1$ 冲突） ，但与主观判断 “$2 = 1$，$3 < 2$”  不冲突；因此给定主观判断 “$3>1$，$3=2$” 时，$1<3=2$ 和 $1<2=3$ 都是合法的质量序列，$3<1=2$ 和 $1<2<3$ 都是非法的质量序列。\n\n由于实验已经做完一段时间了，小 D 已经忘了一部分主观实验的数据。对每张图片 $X_i$，小 D 都**最多**只记住了某一张质量不比 $X_i$ 好的另一张图片 $K_{X_i}$。这些小 D 仍然记得的质量判断一共有 $M$ 条（$0 \\leq M \\leq N$），其中第 $i$ 条涉及的图片对为 $(K_{X_i}, X_i)$，判断要么是 $K_{X_i} < X_i$，要么是 $K_{X_i} = X_i$，而且所有的 $X_i$ 互不相同。小 D 打算就以这 M 条自己还记得的质量判断作为他的所有主观数据。\n\n现在，基于这些主观数据，我们希望你帮小 D 求出这 $N$ 张图片一共有多少个不同的合法质量序列。我们规定：如果质量序列中出现 “$x = y$”，那么序列中交换 $x$ 和 $y$ 的位置后仍是同一个序列。因此： $1<2=3=4<5$ 和 $1<4=2=3<5$ 是同一个序列， $1 < 2 = 3$ 和 $1 < 3 = 2$ 是同一个序列，而 $1 < 2 < 3$ 与 $1 < 2 = 3$ 是不同的序列，$1<2<3$ 和 $2<1<3$ 是不同的序列。\n\n由于合法的图片质量序列可能很多， 所以你需要输出答案对 $10^9 + 7$ 取模的结果。", "inputFormat": "第一行两个正整数 $N,M$，分别代表图片总数和小 $D$ 仍然记得的判断的条数；\n\n接下来 $M$ 行，每行一条判断，每条判断形如「$x < y$」或者「$x = y$」。", "outputFormat": "输出仅一行，包含一个正整数，表示合法质量序列的数目对 $10^9+7$ 取模的结果。", "hint": "不同的合法序列共5个，如下所示：\n\n- $1 = 5 < 2 < 3 < 4$ \n- $1 = 5 < 2 < 4 < 3$\n- $1 = 5 < 2 < 3 = 4$ \n- $1 = 5 < 3 < 2 < 4$ \n- $1 = 5 < 2 = 3 < 4$\n\n$100\\%$ 的数据满足 $N \\leq 100$。", "locale": "zh-CN"}}}
{"pid": "P3241", "type": "P", "difficulty": 6, "samples": [["10 10 10\n0 0 7 2 1 4 7 7 7 9\n1 2 270\n2 3 217\n1 4 326\n2 5 361\n4 6 116\n3 7 38\n1 8 800\n6 9 210\n7 10 278\n8 9 8\n2 8 0\n9 3 1\n8 0 8\n4 2 7\n9 7 3\n4 7 0\n2 2 7\n3 2 1\n2 3 4", "1603 \n957 \n7161 \n9466 \n3232 \n5223 \n1879 \n1669 \n1282 \n0"]], "limits": {"time": [6000, 6000, 6000, 6000, 6000], "memory": [512000, 512000, 512000, 512000, 512000]}, "tags": ["2015", "各省省选", "点分治", "湖南", "最近公共祖先 LCA", "树链剖分", "动态树 LCT", "可持久化线段树"], "title": "[HNOI2015] 开店", "background": "", "description": "风见幽香有一个好朋友叫八云紫，她们经常一起看星星看月亮从诗词歌赋谈到人生哲学。最近她们灵机一动，打算在幻想乡开一家小店来做生意赚点钱。\n\n这样的想法当然非常好啦，但是她们也发现她们面临着一个问题，那就是店开在哪里，面向什么样的人群。很神奇的是，幻想乡的地图是一个树形结构，幻想乡一共有 $n$ 个地方，编号为 $1$ 到 $n$，被 $n-1$ 条带权的边连接起来。每个地方都住着一个妖怪，其中第 $i$ 个地方的妖怪年龄是 $x_i$。\n\n妖怪都是些比较喜欢安静的家伙，所以它们并不希望和很多妖怪相邻。所以这个树所有顶点的度数都小于或等于 $3$。妖怪和人一样，兴趣点随着年龄的变化自然就会变化，比如我们的 $18$ 岁少女幽香和八云紫就比较喜欢可爱的东西。幽香通过研究发现，基本上妖怪的兴趣只跟年龄有关，所以幽香打算选择一个地方 $u$（$u$ 为编号），然后在 $u$ 开一家面向年龄在 $L$ 到 $R$ 之间（即年龄大于等于 $L$ 小于等于 $R$）的妖怪的店。\n\n也有可能 $u$ 这个地方离这些妖怪比较远，于是幽香就想要知道所有年龄在 $L$ 到 $R$ 之间的妖怪，到点 $u$ 的距离的和是多少（妖怪到 $u$ 的距离是该妖怪所在地方到 $u$ 的路径上的边的权之和），幽香把这个称为这个开店方案的方便值。\n\n幽香她们还没有决定要把店开在哪里，八云紫倒是准备了很多方案，于是幽香想要知道，对于每个方案，方便值是多少呢。\n", "inputFormat": "第一行三个用空格分开的数 $n,Q$ 和 $A$，表示树的大小、开店的方案个数和妖怪的年龄上限。\n\n第二行 $n$ 个用空格分开的数 $x_1,x_2,\\ldots,x_n$；$x_i$ 表示第 $i$ 个地点妖怪的年龄，满足 $0\\le x_i\\lt A$。(年龄是可以为 $0$ 的，例如刚出生的妖怪的年龄为 $0$。) \n\n接下来 $n-1$  行，每行三个用空格分开的数 $a$、$b$、$c$，表示树上的顶点 $a$ 和 $b$ 之间有一条权为 $c(1\\le c\\le1000)$ 的边，$a$ 和 $b$ 是顶点编号。 \n\n接下来 $Q$ 行，每行三个用空格分开的数 $u,a,b$。\n\n对于这 $Q$ 行的每一行，用 $a,b,A$ 计算出 $L$ 和 $R$，表示询问”在地方 $u$ 开店，面向妖怪的年龄区间为 $[L,R]$ 的方案的方便值是多少“。\n\n对于其中第 $1$ 行，$L$ 和 $R$ 的计算方法为：$L=\\min(a\\bmod A,b\\bmod A),R=\\max(a\\bmod A,b\\bmod A)$ 。\n\n对于第 $2$ 到第 $Q$ 行，假设前一行得到的方便值为 $ans$，那么当前行的 $L$ 和 $R$ 计算方法为： $L=\\min((a+ans)\\bmod A,(b+ans)\\bmod A), R=\\max((a+ans)\\bmod A,(b+ans)\\bmod A)$ 。", "outputFormat": "对于每个方案，输出一行表示方便值。\n", "hint": "满足 $n\\le1.5 \\times 10^5,Q\\le2 \\times 10^5$。对于所有数据，满足 $A\\le 10^9$。 ", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2015] Opening a Shop", "background": "", "description": "Kazami Yuuka has a good friend named Yakumo Yukari. They often watch the stars and the moon together, chatting from poetry and songs to life philosophy. Recently, they had a sudden idea to open a small shop in Gensokyo to do business and make some money.\n\nThis idea is certainly great, but they also found a problem: where to open the shop and which group of customers to target. Interestingly, the map of Gensokyo is a tree. There are $n$ places in total, numbered from $1$ to $n$, connected by $n-1$ weighted edges. Each place is inhabited by a youkai, and the age of the youkai at place $i$ is $x_i$.\n\nYoukai are relatively quiet, so they do not want to be adjacent to too many youkai. Therefore, the degree of every vertex in this tree is at most $3$. Interests change naturally with age. For example, our $18$-year-old girls Yuuka and Yukari may prefer cute things. Yuuka discovered through research that a youkai’s interests basically depend only on age. So Yuuka plans to choose a place $u$ (a vertex id), and open a shop at $u$ targeting youkai whose ages are between $L$ and $R$ (that is, ages greater than or equal to $L$ and less than or equal to $R$).\n\nIt is possible that place $u$ is far from these youkai. Thus, Yuuka wants to know the sum of distances from all youkai with ages in $[L, R]$ to $u$ (the distance from a youkai to $u$ is the sum of edge weights along the path from its place to $u$). Yuuka calls this the convenience value of the shop plan.\n\nThey have not yet decided where to open the shop, and Yukari has prepared many plans. For each plan, what is the convenience value?", "inputFormat": "- The first line contains three space-separated integers $n$, $Q$, and $A$, representing the size of the tree, the number of shop plans (queries), and the upper bound of youkai ages.\n- The second line contains $n$ space-separated integers $x_1, x_2, \\ldots, x_n$. Here $x_i$ is the age of the youkai at place $i$, satisfying $0 \\le x_i \\lt A$. (Age can be $0$, for example, a newborn youkai has age $0$.)\n- The next $n-1$ lines each contain three space-separated integers $a$, $b$, and $c$, indicating that there is an edge of weight $c$ ($1 \\le c \\le 1000$) between vertices $a$ and $b$, where $a$ and $b$ are vertex ids.\n- The next $Q$ lines each contain three space-separated integers $u$, $a$, and $b$.\n\nFor each of these $Q$ lines, compute $L$ and $R$ from $a$, $b$, and $A$. This specifies the query “open a shop at place $u$, targeting youkai with ages in $[L, R]$, and ask for the convenience value.”\n\n- For the first query (the $1$-st line), compute:\n  $L=\\min(a \\bmod A, b \\bmod A)$, $R=\\max(a \\bmod A, b \\bmod A)$.\n- For the $2$-nd to the $Q$-th queries, suppose the convenience value obtained from the previous query is $ans$. Then compute:\n  $L=\\min((a+ans) \\bmod A, (b+ans) \\bmod A)$, $R=\\max((a+ans) \\bmod A, (b+ans) \\bmod A)$.", "outputFormat": "For each plan, output one line containing the convenience value.", "hint": "Constraints: $n \\le 1.5 \\times 10^5$, $Q \\le 2 \\times 10^5$. For all testdata, $A \\le 10^9$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2015] 开店", "background": "", "description": "风见幽香有一个好朋友叫八云紫，她们经常一起看星星看月亮从诗词歌赋谈到人生哲学。最近她们灵机一动，打算在幻想乡开一家小店来做生意赚点钱。\n\n这样的想法当然非常好啦，但是她们也发现她们面临着一个问题，那就是店开在哪里，面向什么样的人群。很神奇的是，幻想乡的地图是一个树形结构，幻想乡一共有 $n$ 个地方，编号为 $1$ 到 $n$，被 $n-1$ 条带权的边连接起来。每个地方都住着一个妖怪，其中第 $i$ 个地方的妖怪年龄是 $x_i$。\n\n妖怪都是些比较喜欢安静的家伙，所以它们并不希望和很多妖怪相邻。所以这个树所有顶点的度数都小于或等于 $3$。妖怪和人一样，兴趣点随着年龄的变化自然就会变化，比如我们的 $18$ 岁少女幽香和八云紫就比较喜欢可爱的东西。幽香通过研究发现，基本上妖怪的兴趣只跟年龄有关，所以幽香打算选择一个地方 $u$（$u$ 为编号），然后在 $u$ 开一家面向年龄在 $L$ 到 $R$ 之间（即年龄大于等于 $L$ 小于等于 $R$）的妖怪的店。\n\n也有可能 $u$ 这个地方离这些妖怪比较远，于是幽香就想要知道所有年龄在 $L$ 到 $R$ 之间的妖怪，到点 $u$ 的距离的和是多少（妖怪到 $u$ 的距离是该妖怪所在地方到 $u$ 的路径上的边的权之和），幽香把这个称为这个开店方案的方便值。\n\n幽香她们还没有决定要把店开在哪里，八云紫倒是准备了很多方案，于是幽香想要知道，对于每个方案，方便值是多少呢。\n", "inputFormat": "第一行三个用空格分开的数 $n,Q$ 和 $A$，表示树的大小、开店的方案个数和妖怪的年龄上限。\n\n第二行 $n$ 个用空格分开的数 $x_1,x_2,\\ldots,x_n$；$x_i$ 表示第 $i$ 个地点妖怪的年龄，满足 $0\\le x_i\\lt A$。(年龄是可以为 $0$ 的，例如刚出生的妖怪的年龄为 $0$。) \n\n接下来 $n-1$  行，每行三个用空格分开的数 $a$、$b$、$c$，表示树上的顶点 $a$ 和 $b$ 之间有一条权为 $c(1\\le c\\le1000)$ 的边，$a$ 和 $b$ 是顶点编号。 \n\n接下来 $Q$ 行，每行三个用空格分开的数 $u,a,b$。\n\n对于这 $Q$ 行的每一行，用 $a,b,A$ 计算出 $L$ 和 $R$，表示询问”在地方 $u$ 开店，面向妖怪的年龄区间为 $[L,R]$ 的方案的方便值是多少“。\n\n对于其中第 $1$ 行，$L$ 和 $R$ 的计算方法为：$L=\\min(a\\bmod A,b\\bmod A),R=\\max(a\\bmod A,b\\bmod A)$ 。\n\n对于第 $2$ 到第 $Q$ 行，假设前一行得到的方便值为 $ans$，那么当前行的 $L$ 和 $R$ 计算方法为： $L=\\min((a+ans)\\bmod A,(b+ans)\\bmod A), R=\\max((a+ans)\\bmod A,(b+ans)\\bmod A)$ 。", "outputFormat": "对于每个方案，输出一行表示方便值。\n", "hint": "满足 $n\\le1.5 \\times 10^5,Q\\le2 \\times 10^5$。对于所有数据，满足 $A\\le 10^9$。 ", "locale": "zh-CN"}}}
{"pid": "P3242", "type": "P", "difficulty": 6, "samples": [["10 10 10\n1 2\n2 3\n3 4\n4 5\n5 6\n6 7\n7 8\n8 9\n9 10\n3 2 217394434\n10 7 13022269\n6 7 283254485\n6 8 333042360\n4 6 442139372\n8 3 225045590\n10 4 922205209\n10 8 808296330\n9 2 486331361\n4 9 551176338\n1 8 5\n3 8 3\n3 8 4\n1 8 3\n4 8 1\n2 3 1\n2 3 1\n2 3 1\n2 4 1\n1 4 1", "442139372 \n333042360 \n442139372 \n283254485 \n283254485 \n217394434 \n217394434 \n217394434 \n217394434 \n217394434"]], "limits": {"time": [6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2015", "各省省选", "湖南", "深度优先搜索 DFS", "最近公共祖先 LCA", "树套树", "整体二分"], "title": "[HNOI2015] 接水果", "background": "", "description": "风见幽香非常喜欢玩一个叫做 osu! 的游戏，其中她最喜欢玩的模式就是接水果。由于她已经 DT FC 了 The big black，她觉得这个游戏太简单了，于是发明了一个更加难的版本。\n\n首先有一个地图，是一棵由 $n$ 个顶点，$n-1$ 条边组成的树。\n\n这颗树上有 $p$ 个盘子，每个盘子实际上是一条路径，并且每个盘子还有一个权值。第 $i$ 个盘子就是顶点 $a_i$ 到顶点 $b_i$ 的路径（由于是树，所以从 $a_i$ 到 $b_i$ 的路径是唯一的），权值为 $c_i$。\n\n接下来依次会有 $q$ 个水果掉下来，每个水果本质上也是一条路径，第 $i$ 个水果是从顶点 $u_i$ 到顶点 $v_i$ 的路径。\n\n幽香每次需要选择一个盘子去接当前的水果：一个盘子能接住一个水果，当且仅当盘子的路径是水果的路径的子路径。这里规定：从 $a$ 到 $b$ 的路径与从 $b$ 到 $a$ 的路径是同一条路径。\n\n当然为了提高难度，对于第 $i$ 个水果，你需要选择能接住它的所有盘子中，权值第 $k_i$ 小的那个盘子，每个盘子可重复使用（没有使用次数的上限：一个盘子接完一个水果后，后面还可继续接其他水果，只要它是水果路径的子路径）。幽香认为这个游戏很难，你能轻松解决给她看吗？\n", "inputFormat": "第一行三个数 $n$ 和 $p$ 和 $q$，表示树的大小和盘子的个数和水果的个数。\n\n接下来 $n-1$ 行，每行两个数 $a,b$，表示树上的 $a$ 和 $b$ 之间有一条边。树中顶点按 $1$ 到 $n$ 标号。\n\n接下来 $p$ 行，每行三个数 $a,b,c$，表示路径为 $a$ 到 $b$、权值为 $c$ 的盘子，其中 $a \\neq b$。\n\n接下来 $q$ 行，每行三个数 $u,v,k$，表示路径为 $u$ 到 $v$ 的水果，其中 $u \\neq v$，你需要选择第 $k$ 小的盘子，第 $k$ 小一定存在。\n", "outputFormat": "对于每个果子，输出一行表示选择的盘子的权值。\n", "hint": "对于 $100\\%$ 的数据，$1\\leq n,p,q \\leq4\\times 10^4$，$0 \\le c \\le 10^9$。\n", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2015] Catching Fruits", "background": "", "description": "Kazami Yuuka really enjoys playing a game called osu!, and her favorite mode is catching fruits. Since she has already DT FC’d The Big Black, she thinks the game is too easy, so she invented a harder version.\n\nFirst, there is a map that is a tree with $n$ vertices and $n-1$ edges.\n\nThere are $p$ plates on this tree. Each plate is actually a path, and each plate also has a weight. The $i$-th plate is the path from vertex $a_i$ to vertex $b_i$ (since it is a tree, the path from $a_i$ to $b_i$ is unique), with weight $c_i$.\n\nNext, $q$ fruits will fall one by one; each fruit is essentially also a path. The $i$-th fruit is the path from vertex $u_i$ to vertex $v_i$.\n\nEach time, Yuuka needs to choose one plate to catch the current fruit: a plate can catch a fruit if and only if the plate’s path is a subpath of the fruit’s path. By convention, the path from $a$ to $b$ is considered the same as the path from $b$ to $a$.\n\nTo increase the difficulty, for the $i$-th fruit, among all plates that can catch it, you must choose the one with the $k_i$-th smallest weight. Each plate can be reused without limit: after catching one fruit, it can continue to catch other fruits as long as it is a subpath of the fruit’s path. Yuuka thinks this game is hard; can you solve it easily for her?", "inputFormat": "- The first line contains three integers $n$, $p$, and $q$, denoting the size of the tree, the number of plates, and the number of fruits.\n- The next $n-1$ lines each contain two integers $a$ and $b$, indicating that there is an edge between $a$ and $b$ in the tree. The vertices are labeled from $1$ to $n$.\n- The next $p$ lines each contain three integers $a$, $b$, and $c$, describing a plate whose path is from $a$ to $b$ with weight $c$, where $a \\ne b$.\n- The next $q$ lines each contain three integers $u$, $v$, and $k$, describing a fruit whose path is from $u$ to $v$, where $u \\ne v$. You need to choose the $k$-th smallest plate, and the $k$-th smallest is guaranteed to exist.", "outputFormat": "For each fruit, output one line containing the weight of the chosen plate.", "hint": "For $100\\%$ of the testdata, $1 \\le n, p, q \\le 4 \\times 10^4$, $0 \\le c \\le 10^9$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2015] 接水果", "background": "", "description": "风见幽香非常喜欢玩一个叫做 osu! 的游戏，其中她最喜欢玩的模式就是接水果。由于她已经 DT FC 了 The big black，她觉得这个游戏太简单了，于是发明了一个更加难的版本。\n\n首先有一个地图，是一棵由 $n$ 个顶点，$n-1$ 条边组成的树。\n\n这颗树上有 $p$ 个盘子，每个盘子实际上是一条路径，并且每个盘子还有一个权值。第 $i$ 个盘子就是顶点 $a_i$ 到顶点 $b_i$ 的路径（由于是树，所以从 $a_i$ 到 $b_i$ 的路径是唯一的），权值为 $c_i$。\n\n接下来依次会有 $q$ 个水果掉下来，每个水果本质上也是一条路径，第 $i$ 个水果是从顶点 $u_i$ 到顶点 $v_i$ 的路径。\n\n幽香每次需要选择一个盘子去接当前的水果：一个盘子能接住一个水果，当且仅当盘子的路径是水果的路径的子路径。这里规定：从 $a$ 到 $b$ 的路径与从 $b$ 到 $a$ 的路径是同一条路径。\n\n当然为了提高难度，对于第 $i$ 个水果，你需要选择能接住它的所有盘子中，权值第 $k_i$ 小的那个盘子，每个盘子可重复使用（没有使用次数的上限：一个盘子接完一个水果后，后面还可继续接其他水果，只要它是水果路径的子路径）。幽香认为这个游戏很难，你能轻松解决给她看吗？\n", "inputFormat": "第一行三个数 $n$ 和 $p$ 和 $q$，表示树的大小和盘子的个数和水果的个数。\n\n接下来 $n-1$ 行，每行两个数 $a,b$，表示树上的 $a$ 和 $b$ 之间有一条边。树中顶点按 $1$ 到 $n$ 标号。\n\n接下来 $p$ 行，每行三个数 $a,b,c$，表示路径为 $a$ 到 $b$、权值为 $c$ 的盘子，其中 $a \\neq b$。\n\n接下来 $q$ 行，每行三个数 $u,v,k$，表示路径为 $u$ 到 $v$ 的水果，其中 $u \\neq v$，你需要选择第 $k$ 小的盘子，第 $k$ 小一定存在。\n", "outputFormat": "对于每个果子，输出一行表示选择的盘子的权值。\n", "hint": "对于 $100\\%$ 的数据，$1\\leq n,p,q \\leq4\\times 10^4$，$0 \\le c \\le 10^9$。\n", "locale": "zh-CN"}}}
{"pid": "P3243", "type": "P", "difficulty": 4, "samples": [["3\n5 4\n5 4\n5 3\n4 2\n3 2\n3 3\n1 2\n2 3\n3 1\n5 2\n5 2\n4 3", "1 5 3 4 2 \r\nImpossible! \r\n1 5 2 4 3"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["贪心", "2015", "各省省选", "湖南", "排序", "拓扑排序"], "title": "[HNOI2015] 菜肴制作", "background": "", "description": "知名美食家小 A 被邀请至 ATM 大酒店，为其品评菜肴。ATM 酒店为小 A 准备了 $n$ 道菜肴，酒店按照为菜肴预估的质量从高到低给予 $1$ 到 $n$ 的顺序编号，预估质量最高的菜肴编号为 $1$。\n\n由于菜肴之间口味搭配的问题，某些菜肴必须在另一些菜肴之前制作，具体的，一共有 $m$ 条形如 $i$ 号菜肴必须先于 $j$ 号菜肴制作的限制，我们将这样的限制简写为 $(i,j)$。\n\n现在，酒店希望能求出一个最优的菜肴的制作顺序，使得小 A 能尽量先吃到质量高的菜肴：\n\n也就是说，\n\n1. 在满足所有限制的前提下，$1$ 号菜肴尽量优先制作。\n\n2. 在满足所有限制，$1$ 号菜肴尽量优先制作的前提下，$2$ 号菜肴尽量优先制作。\n\n3. 在满足所有限制，$1$ 号和 $2$ 号菜肴尽量优先的前提下，$3$ 号菜肴尽量优先制作。\n\n4. 在满足所有限制，$1$ 号和 $2$ 号和 $3$ 号菜肴尽量优先的前提下，$4$ 号菜肴尽量优先制作。\n\n5. 以此类推。\n\n例 1：共 $4$ 道菜肴，两条限制 $(3,1)$、$(4,1)$，那么制作顺序是 $3,4,1,2$。\n\n例 2：共 $5$ 道菜肴，两条限制 $(5,2)$、$(4,3)$，那么制作顺序是 $1,5,2,4,3$。\n\n例 1 里，首先考虑 $1$，因为有限制 $(3,1)$ 和 $(4,1)$，所以只有制作完 $3$ 和 $4$ 后才能制作 $1$，而根据 3，$3$ 号又应尽量比 $4$ 号优先，所以当前可确定前三道菜的制作顺序是 $3,4,1$；接下来考虑 $2$，确定最终的制作顺序是 $3,4,1,2$。\n\n例 $2$ 里，首先制作 $1$ 是不违背限制的；接下来考虑 $2$ 时有 $(5,2)$ 的限制，所以接下来先制作 $5$ 再制作 $2$；接下来考虑 $3$ 时有 $(4,3)$ 的限制，所以接下来先制作 $4$ 再制作 $3$，从而最终的顺序是 $1,5,2,4,3$。现在你需要求出这个最优的菜肴制作顺序。无解输出 `Impossible!`（首字母大写，其余字母小写）", "inputFormat": "第一行是一个正整数 $t$，表示数据组数。接下来是 $t$ 组数据。对于每组数据：第一行两个用空格分开的正整数 $n$ 和 $m$，分别表示菜肴数目和制作顺序限制的条目数。接下来 $m$ 行，每行两个正整数 $x,y$，表示 $x$ 号菜肴必须先于 $y$ 号菜肴制作的限制。", "outputFormat": "输出文件仅包含 $t$ 行，每行 $n$ 个整数，表示最优的菜肴制作顺序，或者 `Impossible!` 表示无解。\n", "hint": "**【样例解释】**\n\n第二组数据同时要求菜肴 $1$ 先于菜肴 $2$ 制作，菜肴 $2$ 先于菜肴 $3$ 制作，菜肴 $3$ 先于菜肴 $1$ 制作，而这是无论如何也不可能满足的，从而导致无解。\n\n**【数据范围】**\n\n$100\\%$ 的数据满足 $n,m\\le 10^5$，$1\\le t\\le 3$。\n\n$m$ 条限制中可能存在完全相同的限制。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2015] Dish Preparation", "background": "", "description": "The famous gourmet Xiao A is invited to the ATM Grand Hotel to evaluate dishes. The hotel prepares $n$ dishes and numbers them from $1$ to $n$ in decreasing order of estimated quality; dish $1$ has the highest estimated quality.\n\nDue to flavor pairing, some dishes must be prepared before others. Specifically, there are $m$ constraints of the form “dish $i$ must be prepared before dish $j$,” which we abbreviate as $(i, j)$.\n\nNow, the hotel wants to find an optimal preparation order so that Xiao A can eat higher-quality dishes as early as possible:\n\nThat is,\n\n1. Subject to all constraints, dish $1$ should be prepared as early as possible.\n2. Subject to all constraints and dish $1$ being as early as possible, dish $2$ should be as early as possible.\n3. Subject to all constraints and dishes $1$ and $2$ being as early as possible, dish $3$ should be as early as possible.\n4. Subject to all constraints and dishes $1$, $2$, and $3$ being as early as possible, dish $4$ should be as early as possible.\n5. And so on.\n\nExample 1: There are $4$ dishes with two constraints $(3, 1)$ and $(4, 1)$. Then the preparation order is $3, 4, 1, 2$.\n\nExample 2: There are $5$ dishes with two constraints $(5, 2)$ and $(4, 3)$. Then the preparation order is $1, 5, 2, 4, 3$.\n\nIn Example 1, consider dish $1$ first. Because of $(3, 1)$ and $(4, 1)$, dish $1$ can only be prepared after dishes $3$ and $4$ are finished. According to item 3, dish $3$ should be prioritized over dish $4$, so the first three dishes are $3, 4, 1$. Next, consider dish $2$, and the final order is $3, 4, 1, 2$.\n\nIn Example $2$, preparing dish $1$ first does not violate any constraints. Next, when considering dish $2$, there is the constraint $(5, 2)$, so prepare $5$ first and then $2$. Next, when considering dish $3$, there is the constraint $(4, 3)$, so prepare $4$ first and then $3$, resulting in the final order $1, 5, 2, 4, 3$. Now you need to compute this optimal preparation order. If there is no solution, output `Impossible!`.", "inputFormat": "The first line contains a positive integer $t$, the number of test cases. Then follow $t$ test cases. For each test case: The first line contains two space-separated positive integers $n$ and $m$, the number of dishes and the number of precedence constraints. The next $m$ lines each contain two positive integers $x, y$, meaning dish $x$ must be prepared before dish $y$.", "outputFormat": "Output exactly $t$ lines. Each line contains $n$ integers representing the optimal preparation order, or `Impossible!` if there is no solution.", "hint": "- Sample Explanation:\n\n  In the second test case, it simultaneously requires dish $1$ before dish $2$, dish $2$ before dish $3$, and dish $3$ before dish $1$, which is impossible to satisfy, so there is no solution.\n\n- Constraints:\n\n  For $100\\%$ of the testdata, $n, m \\le 10^5$, $1 \\le t \\le 3$.\n\n  There may be completely identical constraints among the $m$ constraints.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2015] 菜肴制作", "background": "", "description": "知名美食家小 A 被邀请至 ATM 大酒店，为其品评菜肴。ATM 酒店为小 A 准备了 $n$ 道菜肴，酒店按照为菜肴预估的质量从高到低给予 $1$ 到 $n$ 的顺序编号，预估质量最高的菜肴编号为 $1$。\n\n由于菜肴之间口味搭配的问题，某些菜肴必须在另一些菜肴之前制作，具体的，一共有 $m$ 条形如 $i$ 号菜肴必须先于 $j$ 号菜肴制作的限制，我们将这样的限制简写为 $(i,j)$。\n\n现在，酒店希望能求出一个最优的菜肴的制作顺序，使得小 A 能尽量先吃到质量高的菜肴：\n\n也就是说，\n\n1. 在满足所有限制的前提下，$1$ 号菜肴尽量优先制作。\n\n2. 在满足所有限制，$1$ 号菜肴尽量优先制作的前提下，$2$ 号菜肴尽量优先制作。\n\n3. 在满足所有限制，$1$ 号和 $2$ 号菜肴尽量优先的前提下，$3$ 号菜肴尽量优先制作。\n\n4. 在满足所有限制，$1$ 号和 $2$ 号和 $3$ 号菜肴尽量优先的前提下，$4$ 号菜肴尽量优先制作。\n\n5. 以此类推。\n\n例 1：共 $4$ 道菜肴，两条限制 $(3,1)$、$(4,1)$，那么制作顺序是 $3,4,1,2$。\n\n例 2：共 $5$ 道菜肴，两条限制 $(5,2)$、$(4,3)$，那么制作顺序是 $1,5,2,4,3$。\n\n例 1 里，首先考虑 $1$，因为有限制 $(3,1)$ 和 $(4,1)$，所以只有制作完 $3$ 和 $4$ 后才能制作 $1$，而根据 3，$3$ 号又应尽量比 $4$ 号优先，所以当前可确定前三道菜的制作顺序是 $3,4,1$；接下来考虑 $2$，确定最终的制作顺序是 $3,4,1,2$。\n\n例 $2$ 里，首先制作 $1$ 是不违背限制的；接下来考虑 $2$ 时有 $(5,2)$ 的限制，所以接下来先制作 $5$ 再制作 $2$；接下来考虑 $3$ 时有 $(4,3)$ 的限制，所以接下来先制作 $4$ 再制作 $3$，从而最终的顺序是 $1,5,2,4,3$。现在你需要求出这个最优的菜肴制作顺序。无解输出 `Impossible!`（首字母大写，其余字母小写）", "inputFormat": "第一行是一个正整数 $t$，表示数据组数。接下来是 $t$ 组数据。对于每组数据：第一行两个用空格分开的正整数 $n$ 和 $m$，分别表示菜肴数目和制作顺序限制的条目数。接下来 $m$ 行，每行两个正整数 $x,y$，表示 $x$ 号菜肴必须先于 $y$ 号菜肴制作的限制。", "outputFormat": "输出文件仅包含 $t$ 行，每行 $n$ 个整数，表示最优的菜肴制作顺序，或者 `Impossible!` 表示无解。\n", "hint": "**【样例解释】**\n\n第二组数据同时要求菜肴 $1$ 先于菜肴 $2$ 制作，菜肴 $2$ 先于菜肴 $3$ 制作，菜肴 $3$ 先于菜肴 $1$ 制作，而这是无论如何也不可能满足的，从而导致无解。\n\n**【数据范围】**\n\n$100\\%$ 的数据满足 $n,m\\le 10^5$，$1\\le t\\le 3$。\n\n$m$ 条限制中可能存在完全相同的限制。", "locale": "zh-CN"}}}
{"pid": "P3244", "type": "P", "difficulty": 6, "samples": [["4 4 4 3\n1 2\n1 3\n2 4\n3 2", "3"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["动态规划 DP", "递推", "2015", "各省省选", "湖南", "拓扑排序"], "title": "[HNOI2015] 落忆枫音", "background": "「恒逸，你相信灵魂的存在吗？」 郭恒逸和姚枫茜漫步在枫音乡的街道上。望着漫天飞舞的红枫，枫茜突然问出这样一个问题。\n\n「相信吧。不然我们是什么，一团肉吗？要不是有灵魂......我们也不可能再见到你姐姐吧。」 恒逸给出了一个略微无厘头的回答。枫茜听后笑了笑。 「那你仔细观察过枫叶吗？」 说罢，枫茜伸手，接住了一片飘落的枫叶。\n\n「其实每一片枫叶都是有灵魂的。你看，枫叶上不是有这么多脉络吗？我听说，枫叶上有一些特殊的位置，就和人的穴位一样。脉络都是连接在这些穴位之间的。枫树的灵魂流过每片枫叶的根部，沿着这些脉络，慢慢漫进穴位，沁入整片枫叶。也是因为这个原因，脉络才都是单向的，灵魂可不能倒着溜回来呢。」 恒逸似懂非懂地点了点头。枫茜接着说了下去。\n\n「正是因为有了灵魂，每片枫叶才会与众不同。也正是因为有了灵魂，每片枫叶也都神似其源本的枫树，就连脉络也形成了一棵树的样子。但如果仔细看的话，会发现，在脉络树之外，还存在其它的非常细的脉络。虽然这些脉络并不在树上，但他们的方向也同样顺着灵魂流淌的方向，绝不会出现可能使灵魂倒流的回路。」  恒逸好像突然想到了什么。 「那这些脉络岂不是可以取代已有的脉络，出现在脉络树上？」 枫茜闭上了眼睛。\n\n「是啊，就是这样。脉络树并不是唯一的。只要有一些微小的偏差，脉络树就可能差之万里，哪怕是在这同一片枫叶上。就像我们的故事，结局也不是唯一的。只要改变一个小小的选项，故事流程可能就会被彻底扭转。」\n\n「真是深奥啊......」 恒逸盯着这片红枫，若有所思地说。枫茜继续说道。\n\n「还不止如此呢。所有的脉络都不会永恒存在，也不会永恒消失。不管是脉络树上的脉络，还是之外的细小脉络，都是如此。存在的脉络可能断开消失，消失的脉络也可能再次连接。万物皆处在永恒的变化之中，人与人之间的羁绊也是。或许有一天，我们与大家的羁绊也会如同脉络一样，被无情地斩断。或许我们也终将成为”枫音乡的过客“。或许这一切都会是必然，是枫树的灵魂所决定的......」\n\n枫茜的眼角泛起了几滴晶莹剔透的泪珠。恒逸看着这样的枫茜，将她抱入怀中。\n\n「别这样想，枫茜。就算脉络断开，也有可能还会有新的脉络树，也还会与枫树的根相连。这样的话，我们的羁绊仍然存在，只是稍微绕了一些远路而已。无论如何，我都不会离开你的。因为你是我穷尽一生所寻找的，我的真恋啊！」\n\n两人的目光对上了。枫茜幸福地笑了，把头埋进了恒逸的怀抱。从远方山上的枫林中，传来了枫的声音。", "description": "不妨假设枫叶上有 $n$ 个穴位，穴位的编号为 $1\\sim n$。有若干条有向的脉络连接着这些穴位。\n\n穴位和脉络组成一个有向无环图——称之为**脉络图**（例如图 $1$），穴位的编号使得穴位 $1$ 没有从其他穴位连向它的脉络，即穴位 $1$ 只有连出去的脉络；由上面的故事可知，这个有向无环图存在一个树形子图，它是以穴位 $1$ 为根的包含全部 $n$ 个穴位的一棵树——称之为**脉络树**（例如图 $2$ 和图 $3$ 给出的树都是图 $1$ 给出的脉络图的子图）。\n\n值得注意的是，脉络图中的脉络树方案可能有多种可能性，例如图 $2$ 和图 $3$ 就是图 $1$ 给出的脉络图的两个脉络树方案。\n\n ![](https://cdn.luogu.com.cn/upload/pic/11330.png) \n\n脉络树的形式化定义为：以穴位 $r$ 为根的脉络树由枫叶上全部 $n$ 个穴位以及 $(n-1)$ 条脉络组成，脉络树里没有环，亦不存在从一个穴位连向自身的脉络，且对于枫叶上的每个穴位 $s$，都存在一条唯一的包含于脉络树内的脉络路径，使得从穴位 $r$ 出发沿着这条路径可以到达穴位  $s$。 \n\n现在向脉络图添加一条与已有脉络不同的脉络（**注意：连接 $2$ 个穴位但方向不同的脉络是不同的脉络**，例如从穴位 $3$ 到 $4$ 的脉络与从 $4$ 到 $3$ 的脉络是不同的脉络，因此，图 $1$ 中不能添加从 $3$ 到 $4$ 的脉络，但可添加从 $4$ 到 $3$ 的脉络）。这条新脉络**可以是从一个穴位连向自身的**（例如，图 1 中可添加从 $4$ 到 $4$ 的脉络）。\n\n原脉络图添加这条新脉络后得到的新脉络图可能会出现脉络构成的环。 请你求出添加了这一条脉络之后的新脉络图的以穴位 $1$ 为根的脉络树方案数。\n\n由于方案可能有太多太多，请输出方案数对 $(10^9+7)$ 取模后得到的结果。", "inputFormat": "输入文件的第一行包含四个整数 $n,m,x,y$，依次代表枫叶上的穴位数、脉络数，以及要添加的脉络是从穴位 $x$ 连向穴位 $y$ 的。 \n\n接下来 $m$ 行，每行两个整数，由空格隔开，代表一条脉络。\n\n第 $i$ 行的两个整数为 $u_i$ 和 $v_i$，代表第 $i$ 条脉络是从穴位 $u_i$ 连向穴位 $v_i$ 的。", "outputFormat": "输出一行，为添加了从穴位 $x$ 连向穴位 $y$ 的脉络后，枫叶上以穴位 $1$ 为根的脉络树的方案数对 $(10^9+7)$ 取模得到的结果。\n", "hint": "对于所有测试数据，保证：\n\n- $1 \\leq n \\leq 100000$；\n- $n - 1 \\leq m \\leq \\min(200000, n(n -1)/2)$；\n- $1 \\leq x, y, u_i, v_i \\leq n$。\n\nFixed by Starrykiller.", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2015] Fallen Memories of Maple Echo", "background": "“Hengyi, do you believe that souls exist?” Guo Hengyi and Yao Fengqian were strolling along the street in Maple Echo Village. Watching the fluttering red maple leaves, Fengqian suddenly asked this question.\n\n“I guess I do. Otherwise, what are we—just a lump of flesh? Without souls... we couldn’t have seen your sister again, right?” Hengyi gave a slightly offbeat answer. Fengqian smiled. “Then have you carefully observed maple leaves?” With that, Fengqian reached out and caught a falling maple leaf.\n\n“In fact, every maple leaf has a soul. Look, aren’t there many veins on a maple leaf? I’ve heard that there are some special points on a leaf, just like acupoints on a human body. The veins connect these acupoints. The maple tree’s soul flows through the root of each leaf, along these veins, slowly soaking into the acupoints and permeating the entire leaf. This is also why the veins are all one-way—souls can’t flow backward.” Hengyi nodded, half understanding. Fengqian continued.\n\n“Because of the soul, every maple leaf is unique. Also because of the soul, every leaf resembles its source—the maple tree itself. Even the vein pattern forms the shape of a tree. But if you look carefully, you’ll find that beyond the vein-tree there are other very fine veins. Although these veins are not on the tree, their directions still follow the direction of the soul’s flow, and there will never be a cycle that could cause reverse flow.” Hengyi suddenly thought of something. “So these veins could replace existing ones and appear on the vein-tree, right?” Fengqian closed her eyes.\n\n“Yes, exactly. The vein-tree is not unique. With slight deviations, the vein-tree might differ greatly, even on the very same leaf. Just like our story—the ending is not unique. Change a small choice, and the entire storyline may be completely altered.”\n\n“That’s so profound...” Hengyi stared at the red maple leaf, contemplating. Fengqian went on.\n\n“And that’s not all. No vein exists forever, nor disappears forever. This is true for both veins on the vein-tree and the fine veins outside it. Existing veins may break and vanish; vanished veins may reconnect. Everything is in eternal change, including the bonds between people. Perhaps one day, our bonds with everyone will be ruthlessly severed like veins. Perhaps we, too, will become ‘passersby in Maple Echo Village.’ Perhaps all this is inevitable—decided by the soul of the maple tree...”\n\nTears shimmered in the corner of Fengqian’s eyes. Seeing this, Hengyi held her in his arms.\n\n“Don’t think like that, Fengqian. Even if some veins break, a new vein-tree may still form and still connect to the tree’s root. If so, our bond still exists—it only takes a slightly longer path. No matter what, I won’t leave you. Because you are the one I’ve sought my entire life—my true love!”\n\nTheir eyes met. Fengqian smiled happily and buried her head in Hengyi’s embrace. From the maple forest on the distant mountain came the sound of the maples.", "description": "Assume there are $n$ acupoints on a maple leaf, numbered $1 \\sim n$. Several directed veins connect these acupoints.\n\nThe acupoints and veins form a directed acyclic graph—called the vein graph (for example, Figure $1$). The numbering of the acupoints ensures that acupoint $1$ has no incoming veins from other acupoints, that is, acupoint $1$ only has outgoing veins. As the story above suggests, this directed acyclic graph contains a tree-shaped subgraph: a tree rooted at acupoint $1$ that spans all $n$ acupoints—called a vein-tree (for example, the trees in Figure $2$ and Figure $3$ are both vein-trees of the vein graph given by Figure $1$).\n\nNote that there may be multiple vein-tree schemes in the vein graph. For example, Figure $2$ and Figure $3$ are two different vein-tree schemes for the vein graph in Figure $1$.\n\n![](https://cdn.luogu.com.cn/upload/pic/11330.png)\n\nA formal definition of a vein-tree is as follows: a vein-tree rooted at acupoint $r$ consists of all $n$ acupoints and $(n-1)$ veins. There are no cycles in the vein-tree, nor self-loops. Moreover, for every acupoint $s$ on the leaf, there exists a unique vein path contained in the vein-tree such that starting from acupoint $r$ and following this path you can reach acupoint $s$.\n\nNow we add one new vein, different from all existing veins, to the vein graph (note: veins connecting the same two acupoints but in opposite directions are considered different. For example, the vein from acupoint $3$ to $4$ is different from the vein from $4$ to $3$. Therefore, in Figure $1$, you cannot add a vein from $3$ to $4$, but you may add a vein from $4$ to $3$). This new vein may be a self-loop (for example, in Figure 1, a vein from $4$ to $4$ can be added).\n\nAfter adding this new vein, cycles formed by veins may appear in the new vein graph. Please compute the number of vein-tree schemes rooted at acupoint $1$ in the new vein graph after adding this vein.\n\nSince the number of schemes may be very large, output it modulo $(10^9+7)$.", "inputFormat": "The first line contains four integers $n, m, x, y$, representing the number of acupoints on the leaf, the number of veins, and that the vein to be added goes from acupoint $x$ to acupoint $y$.\n\nThe next $m$ lines each contain two integers separated by a space, representing one existing vein.\n\nIn line $i$, the two integers are $u_i$ and $v_i$, meaning the $i$-th vein goes from acupoint $u_i$ to acupoint $v_i$.", "outputFormat": "Output one line: the number of vein-tree schemes rooted at acupoint $1$ on the leaf after adding the vein from $x$ to $y$, modulo $(10^9+7)$.", "hint": "For all testdata, it is guaranteed that:\n- $1 \\leq n \\leq 100000$.\n- $n - 1 \\leq m \\leq \\min(200000, n(n - 1)/2)$.\n- $1 \\leq x, y, u_i, v_i \\leq n$.\n\nFixed by Starrykiller.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2015] 落忆枫音", "background": "「恒逸，你相信灵魂的存在吗？」 郭恒逸和姚枫茜漫步在枫音乡的街道上。望着漫天飞舞的红枫，枫茜突然问出这样一个问题。\n\n「相信吧。不然我们是什么，一团肉吗？要不是有灵魂......我们也不可能再见到你姐姐吧。」 恒逸给出了一个略微无厘头的回答。枫茜听后笑了笑。 「那你仔细观察过枫叶吗？」 说罢，枫茜伸手，接住了一片飘落的枫叶。\n\n「其实每一片枫叶都是有灵魂的。你看，枫叶上不是有这么多脉络吗？我听说，枫叶上有一些特殊的位置，就和人的穴位一样。脉络都是连接在这些穴位之间的。枫树的灵魂流过每片枫叶的根部，沿着这些脉络，慢慢漫进穴位，沁入整片枫叶。也是因为这个原因，脉络才都是单向的，灵魂可不能倒着溜回来呢。」 恒逸似懂非懂地点了点头。枫茜接着说了下去。\n\n「正是因为有了灵魂，每片枫叶才会与众不同。也正是因为有了灵魂，每片枫叶也都神似其源本的枫树，就连脉络也形成了一棵树的样子。但如果仔细看的话，会发现，在脉络树之外，还存在其它的非常细的脉络。虽然这些脉络并不在树上，但他们的方向也同样顺着灵魂流淌的方向，绝不会出现可能使灵魂倒流的回路。」  恒逸好像突然想到了什么。 「那这些脉络岂不是可以取代已有的脉络，出现在脉络树上？」 枫茜闭上了眼睛。\n\n「是啊，就是这样。脉络树并不是唯一的。只要有一些微小的偏差，脉络树就可能差之万里，哪怕是在这同一片枫叶上。就像我们的故事，结局也不是唯一的。只要改变一个小小的选项，故事流程可能就会被彻底扭转。」\n\n「真是深奥啊......」 恒逸盯着这片红枫，若有所思地说。枫茜继续说道。\n\n「还不止如此呢。所有的脉络都不会永恒存在，也不会永恒消失。不管是脉络树上的脉络，还是之外的细小脉络，都是如此。存在的脉络可能断开消失，消失的脉络也可能再次连接。万物皆处在永恒的变化之中，人与人之间的羁绊也是。或许有一天，我们与大家的羁绊也会如同脉络一样，被无情地斩断。或许我们也终将成为”枫音乡的过客“。或许这一切都会是必然，是枫树的灵魂所决定的......」\n\n枫茜的眼角泛起了几滴晶莹剔透的泪珠。恒逸看着这样的枫茜，将她抱入怀中。\n\n「别这样想，枫茜。就算脉络断开，也有可能还会有新的脉络树，也还会与枫树的根相连。这样的话，我们的羁绊仍然存在，只是稍微绕了一些远路而已。无论如何，我都不会离开你的。因为你是我穷尽一生所寻找的，我的真恋啊！」\n\n两人的目光对上了。枫茜幸福地笑了，把头埋进了恒逸的怀抱。从远方山上的枫林中，传来了枫的声音。", "description": "不妨假设枫叶上有 $n$ 个穴位，穴位的编号为 $1\\sim n$。有若干条有向的脉络连接着这些穴位。\n\n穴位和脉络组成一个有向无环图——称之为**脉络图**（例如图 $1$），穴位的编号使得穴位 $1$ 没有从其他穴位连向它的脉络，即穴位 $1$ 只有连出去的脉络；由上面的故事可知，这个有向无环图存在一个树形子图，它是以穴位 $1$ 为根的包含全部 $n$ 个穴位的一棵树——称之为**脉络树**（例如图 $2$ 和图 $3$ 给出的树都是图 $1$ 给出的脉络图的子图）。\n\n值得注意的是，脉络图中的脉络树方案可能有多种可能性，例如图 $2$ 和图 $3$ 就是图 $1$ 给出的脉络图的两个脉络树方案。\n\n ![](https://cdn.luogu.com.cn/upload/pic/11330.png) \n\n脉络树的形式化定义为：以穴位 $r$ 为根的脉络树由枫叶上全部 $n$ 个穴位以及 $(n-1)$ 条脉络组成，脉络树里没有环，亦不存在从一个穴位连向自身的脉络，且对于枫叶上的每个穴位 $s$，都存在一条唯一的包含于脉络树内的脉络路径，使得从穴位 $r$ 出发沿着这条路径可以到达穴位  $s$。 \n\n现在向脉络图添加一条与已有脉络不同的脉络（**注意：连接 $2$ 个穴位但方向不同的脉络是不同的脉络**，例如从穴位 $3$ 到 $4$ 的脉络与从 $4$ 到 $3$ 的脉络是不同的脉络，因此，图 $1$ 中不能添加从 $3$ 到 $4$ 的脉络，但可添加从 $4$ 到 $3$ 的脉络）。这条新脉络**可以是从一个穴位连向自身的**（例如，图 1 中可添加从 $4$ 到 $4$ 的脉络）。\n\n原脉络图添加这条新脉络后得到的新脉络图可能会出现脉络构成的环。 请你求出添加了这一条脉络之后的新脉络图的以穴位 $1$ 为根的脉络树方案数。\n\n由于方案可能有太多太多，请输出方案数对 $(10^9+7)$ 取模后得到的结果。", "inputFormat": "输入文件的第一行包含四个整数 $n,m,x,y$，依次代表枫叶上的穴位数、脉络数，以及要添加的脉络是从穴位 $x$ 连向穴位 $y$ 的。 \n\n接下来 $m$ 行，每行两个整数，由空格隔开，代表一条脉络。\n\n第 $i$ 行的两个整数为 $u_i$ 和 $v_i$，代表第 $i$ 条脉络是从穴位 $u_i$ 连向穴位 $v_i$ 的。", "outputFormat": "输出一行，为添加了从穴位 $x$ 连向穴位 $y$ 的脉络后，枫叶上以穴位 $1$ 为根的脉络树的方案数对 $(10^9+7)$ 取模得到的结果。\n", "hint": "对于所有测试数据，保证：\n\n- $1 \\leq n \\leq 100000$；\n- $n - 1 \\leq m \\leq \\min(200000, n(n -1)/2)$；\n- $1 \\leq x, y, u_i, v_i \\leq n$。\n\nFixed by Starrykiller.", "locale": "zh-CN"}}}
{"pid": "P3245", "type": "P", "difficulty": 6, "samples": [["11\n121121\n3\n1 6\n1 5\n1 4", "5\n3\n2"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["字符串", "2016", "莫队", "各省省选", "湖南"], "title": "[HNOI2016] 大数", "background": "", "description": "小 B 有一个很大的数 $S$，长度达到了 $n$ 位；这个数可以看成是一个数字串，它可能有前导 $0$，例如 `00009312345`。小 B 还有一个素数 $p$。现在，小 B 提出了 $m$ 个询问，每个询问求 $S$ 的一个子串中有多少子串是 $p$ 的倍数（$0$ 也是 $p$ 的倍数）。例如 $S$ 为 `0077` 时，其子串 `007` 有 $6$ 个子串：`0,0,7,00,07,007`；显然 `0077` 的子串 `007` 有 $6$ 个子串都是素数 $7$ 的倍数。", "inputFormat": "第一行一个整数：$p$。\n\n第二行一个数字串：$S$。\n\n第三行一个整数：$m$。接下来 $m$ 行，每行两个整数 $fr,to$，表示对 $S$ 的子串 $S[fr\\dots to]$ 的一次询问。注意：$S$ 的最左端的数字的位置序号为 $1$；例如 $S$ 为 `213567`，则 $S[1\\dots 3]$ 为 `213`。\n", "outputFormat": "输出 $m$ 行，每行一个整数，第 $i$ 行是第 $i$ 个询问的答案。", "hint": "#### 样例 1 解释\n\n第一个询问问的是整个串，满足条件的子串分别有：`121121,2112,11,121,121`。\n\n#### 数据范围\n\n对于 $100\\%$ 的数据，$1\\le n,m\\le 2\\times 10^5$，$2\\le p\\le 10^9$，$S$ 中只有数字字符，$p$ 为素数。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2016] Large Number", "background": "", "description": "Xiao B has a very large number $S$ of length $n$; this number can be regarded as a string of digits and may have leading $0$s, for example, `00009312345`. Xiao B also has a prime $p$. Now, Xiao B proposes $m$ queries. For each query, within a substring of $S$, count how many of its substrings are multiples of $p$ ($0$ is also considered a multiple of $p$). For example, when $S$ is `0077`, its substring `007` has $6$ substrings: `0,0,7,00,07,007`; clearly, all $6$ substrings of `007` are multiples of the prime $7$.", "inputFormat": "The first line contains an integer $p$.\n\nThe second line contains a digit string $S$.\n\nThe third line contains an integer $m$. Then $m$ lines follow, each containing two integers $fr, to$, representing a query on the substring $S[fr\\dots to]$ of $S$. Note: the leftmost digit of $S$ has index $1$; for example, if $S$ is `213567`, then $S[1\\dots 3]$ is `213`.", "outputFormat": "Output $m$ lines, each containing one integer. The $i$-th line is the answer to the $i$-th query.", "hint": "Sample 1 Explanation\n\nThe first query asks about the entire string. The substrings that satisfy the condition are: `121121,2112,11,121,121`.\n\nConstraints\n\nFor $100\\%$ of the testdata, $1\\le n,m\\le 2\\times 10^5$, $2\\le p\\le 10^9$, $S$ contains only digit characters, and $p$ is prime.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2016] 大数", "background": "", "description": "小 B 有一个很大的数 $S$，长度达到了 $n$ 位；这个数可以看成是一个数字串，它可能有前导 $0$，例如 `00009312345`。小 B 还有一个素数 $p$。现在，小 B 提出了 $m$ 个询问，每个询问求 $S$ 的一个子串中有多少子串是 $p$ 的倍数（$0$ 也是 $p$ 的倍数）。例如 $S$ 为 `0077` 时，其子串 `007` 有 $6$ 个子串：`0,0,7,00,07,007`；显然 `0077` 的子串 `007` 有 $6$ 个子串都是素数 $7$ 的倍数。", "inputFormat": "第一行一个整数：$p$。\n\n第二行一个数字串：$S$。\n\n第三行一个整数：$m$。接下来 $m$ 行，每行两个整数 $fr,to$，表示对 $S$ 的子串 $S[fr\\dots to]$ 的一次询问。注意：$S$ 的最左端的数字的位置序号为 $1$；例如 $S$ 为 `213567`，则 $S[1\\dots 3]$ 为 `213`。\n", "outputFormat": "输出 $m$ 行，每行一个整数，第 $i$ 行是第 $i$ 个询问的答案。", "hint": "#### 样例 1 解释\n\n第一个询问问的是整个串，满足条件的子串分别有：`121121,2112,11,121,121`。\n\n#### 数据范围\n\n对于 $100\\%$ 的数据，$1\\le n,m\\le 2\\times 10^5$，$2\\le p\\le 10^9$，$S$ 中只有数字字符，$p$ 为素数。", "locale": "zh-CN"}}}
{"pid": "P3246", "type": "P", "difficulty": 6, "samples": [["5 5\n5 2 4 1 3\n1 5\n1 3\n2 4\n3 5\n2 5", "28 \n17 \n11 \n11 \n17"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2016", "莫队", "线段树", "各省省选", "湖南", "前缀和", "栈", "ST 表", "扫描线", "单调栈"], "title": "[HNOI2016] 序列", "background": "", "description": "给定长度为 $ n $ 的序列：$ a_1, a_2, \\cdots , a_n $，记为 $ a[1 \\colon n] $。类似地，$ a[l \\colon r] $（$ 1 \\leq l \\leq r \\leq N$）是指序列：$ a_{l}, a_{l+1}, \\cdots ,a_{r-1}, a_r$。若 $1\\leq l \\leq s \\leq t \\leq r \\leq n$，则称 $ a[s \\colon t] $ 是 $ a[l \\colon r] $ 的子序列。\n\n现在有 $ q $ 个询问，每个询问给定两个数 $ l $ 和 $ r $，$ 1 \\leq l \\leq r \\leq n $，求 $ a[l \\colon r] $ 的不同子序列的最小值之和。例如，给定序列\n $ 5, 2, 4, 1, 3 $，询问给定的两个数为 $ 1 $ 和 $ 3 $，那么 $ a[1 \\colon 3] $ 有 $ 6 $ 个子序列 $a[1 \\colon 1], a[2 \\colon 2], a[3 \\colon 3], a[1 \\colon 2],a[2 \\colon 3], a[1 \\colon 3] $，这 $6 $ 个子序列的最小值之和为 $5+2+4+2+2+2=17$。", "inputFormat": "输入文件的第一行包含两个整数 $ n $ 和 $ q $，分别代表序列长度和询问数。\n\n接下来一行，包含 $ n $ 个整数，以空格隔开，第 $ i $ 个整数为 $ a_i $，即序列第 $i$ 个元素的值。\n\n接下来 $ q $ 行，每行包含两个整数 $ l $ 和 $ r $，代表一次询问。", "outputFormat": "对于每次询问，输出一行，代表询问的答案。\n", "hint": "对于 $100\\%$ 的数据，$ 1 \\leq n,q \\leq 100000$，$|a_i| \\leq 10^9$。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2016] Sequence", "background": "", "description": "Given a sequence of length $n$: $a_1, a_2, \\cdots, a_n$, denoted by $a[1 \\colon n]$. Similarly, $a[l \\colon r]$ ($1 \\leq l \\leq r \\leq n$) denotes the sequence $a_l, a_{l+1}, \\cdots, a_{r-1}, a_r$. If $1 \\leq l \\leq s \\leq t \\leq r \\leq n$, then $a[s \\colon t]$ is called a subarray of $a[l \\colon r]$.\n\nNow there are $q$ queries. Each query gives two numbers $l$ and $r$, where $1 \\leq l \\leq r \\leq n$. For each query, find the sum of the minimum values over all subarrays of $a[l \\colon r]$. For example, given the sequence $5, 2, 4, 1, 3$ and the query $l = 1$, $r = 3$, the subarrays of $a[1 \\colon 3]$ are $a[1 \\colon 1], a[2 \\colon 2], a[3 \\colon 3], a[1 \\colon 2], a[2 \\colon 3], a[1 \\colon 3]$. The sum of their minimum values is $5 + 2 + 4 + 2 + 2 + 2 = 17$.", "inputFormat": "The first line contains two integers $n$ and $q$, the sequence length and the number of queries.\n\nThe second line contains $n$ integers separated by spaces. The $i$-th integer is $a_i$, the value of the $i$-th element of the sequence.\n\nEach of the next $q$ lines contains two integers $l$ and $r$, describing a query.", "outputFormat": "For each query, output one line containing the answer.", "hint": "Constraints: For $100\\%$ of the testdata, $1 \\leq n, q \\leq 100000$, $|a_i| \\leq 10^9$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2016] 序列", "background": "", "description": "给定长度为 $ n $ 的序列：$ a_1, a_2, \\cdots , a_n $，记为 $ a[1 \\colon n] $。类似地，$ a[l \\colon r] $（$ 1 \\leq l \\leq r \\leq N$）是指序列：$ a_{l}, a_{l+1}, \\cdots ,a_{r-1}, a_r$。若 $1\\leq l \\leq s \\leq t \\leq r \\leq n$，则称 $ a[s \\colon t] $ 是 $ a[l \\colon r] $ 的子序列。\n\n现在有 $ q $ 个询问，每个询问给定两个数 $ l $ 和 $ r $，$ 1 \\leq l \\leq r \\leq n $，求 $ a[l \\colon r] $ 的不同子序列的最小值之和。例如，给定序列\n $ 5, 2, 4, 1, 3 $，询问给定的两个数为 $ 1 $ 和 $ 3 $，那么 $ a[1 \\colon 3] $ 有 $ 6 $ 个子序列 $a[1 \\colon 1], a[2 \\colon 2], a[3 \\colon 3], a[1 \\colon 2],a[2 \\colon 3], a[1 \\colon 3] $，这 $6 $ 个子序列的最小值之和为 $5+2+4+2+2+2=17$。", "inputFormat": "输入文件的第一行包含两个整数 $ n $ 和 $ q $，分别代表序列长度和询问数。\n\n接下来一行，包含 $ n $ 个整数，以空格隔开，第 $ i $ 个整数为 $ a_i $，即序列第 $i$ 个元素的值。\n\n接下来 $ q $ 行，每行包含两个整数 $ l $ 和 $ r $，代表一次询问。", "outputFormat": "对于每次询问，输出一行，代表询问的答案。\n", "hint": "对于 $100\\%$ 的数据，$ 1 \\leq n,q \\leq 100000$，$|a_i| \\leq 10^9$。", "locale": "zh-CN"}}}
{"pid": "P3247", "type": "P", "difficulty": 6, "samples": [["4 5\n1 2 1 3\n1 3 1 2\n1 4 2 1\n2 4 3 2\n3 4 2 2\n5\n1 4 3 3\n4 2 2 3\n1 3 2 2\n2 3 2 2\n1 3 4 4", "Yes \nYes \nYes \nNo \nNo"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144]}, "tags": ["数学", "2016", "并查集", "各省省选", "湖南", "分块"], "title": "[HNOI2016] 最小公倍数", "background": "", "description": "给定一张 $N$ 个顶点 $M$ 条边的无向图(顶点编号为 $1,2,\\ldots,n$)，每条边上带有权值。所有权值都可以分解成 $2^a\\times 3^b$ 的形式。\n\n现在有 $q$ 个询问，每次询问给定四个参数 $u,v,a$ 和 $b$，请你求出是否存在一条顶点 $u$ 到 $v$ 之间的路径，使得路径依次经过的边上的权值的最小公倍数为 $2^a\\times 3^b$。\n\n注意：路径可以不是简单路径。\n\n下面是一些可能有用的定义，如果与其它地方定义不同，在本题中以下面的定义为准：  \n\n最小公倍数： $ k $ 个数 $ a_1 , a_2, \\ldots, a_k $ 的最小公倍数是能被每个 $a_i$ 整除的最小正整数。\n\n路径：顶点序列 $ P \\colon P_1,P_2,\\ldots,P_k $ 是一条路径，当且仅当 $k \\geq 2$，且对于任意 $ 1 \\leq i < k $ ，节点 $ P_i $ 和 $ P_{i+1} $ 之间都有边相连。 \n\n简单路径：如果路径 $ P \\colon P_1,P_2,\\ldots,P_k $ 中，对于任意 $ 1 \\leq s \\neq t \\leq k $ 都有 $ P_s \\neq P_t $ ，那么称 $P$ 为简单路径。\n", "inputFormat": "输入文件的第一行包含两个整数 $N$ 和 $M$，分别代表图的顶点数和边数。\n\n接下来 $M$ 行，每行包含四个整数 $u,v,a,b$ 代表一条顶点 $u$ 和 $v$ 之间、权值为 $2^a\\times 3^b$ 的边。\n\n接下来一行包含一个整数 $q$，代表询问数。\n\n接下来 $q$ 行，每行包含四个整数 $u,v,a$ 和 $b$，代表一次询问。询问内容请参见问题描述。\n", "outputFormat": "对于每次询问，如果存在满足条件的路径，则输出一行 `Yes`，否则输出一行 `No`（注意：第一个字母大写，其余字母小写）。\n", "hint": "$1\\le n,q\\le 5\\times 10^4$，$1\\leq m\\leq 10^5$，$0\\leq a,b\\leq 10^9$。", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2016] Least Common Multiple", "background": "", "description": "Given an undirected graph with $N$ vertices and $M$ edges (the vertices are numbered $1, 2, \\ldots, N$). Each edge has a weight, and every weight can be factorized as $2^a \\times 3^b$.\n\nThere are $q$ queries. In each query, you are given four parameters $u, v, a$, and $b$. Please determine whether there exists a path from vertex $u$ to vertex $v$ such that the least common multiple of the weights of the edges traversed along the path is exactly $2^a \\times 3^b$.\n\nNote: The path does not have to be simple.\n\nBelow are some definitions that may be useful. If they differ from other sources, use the definitions below for this problem:  \nLeast common multiple: The least common multiple of $k$ numbers $a_1, a_2, \\ldots, a_k$ is the smallest positive integer that is divisible by each $a_i$.\n\nPath: A vertex sequence $P \\colon P_1, P_2, \\ldots, P_k$ is a path if and only if $k \\geq 2$, and for any $1 \\leq i < k$, there is an edge between $P_i$ and $P_{i+1}$.\n\nSimple path: If in a path $P \\colon P_1, P_2, \\ldots, P_k$, it holds that $P_s \\neq P_t$ for any $1 \\leq s \\neq t \\leq k$, then $P$ is called a simple path.", "inputFormat": "The first line contains two integers $N$ and $M$, the number of vertices and edges of the graph.\n\nEach of the next $M$ lines contains four integers $u, v, a, b$, representing an edge between vertices $u$ and $v$ with weight $2^a \\times 3^b$.\n\nThe next line contains an integer $q$, the number of queries.\n\nEach of the next $q$ lines contains four integers $u, v, a$, and $b$, representing one query. See the problem description for details.", "outputFormat": "For each query, output one line: `Yes` if such a path exists, otherwise output `No` (note: the first letter is uppercase, the rest are lowercase).", "hint": "Constraints: $1 \\leq N, q \\leq 5 \\times 10^4$, $1 \\leq M \\leq 10^5$, $0 \\leq a, b \\leq 10^9$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2016] 最小公倍数", "background": "", "description": "给定一张 $N$ 个顶点 $M$ 条边的无向图(顶点编号为 $1,2,\\ldots,n$)，每条边上带有权值。所有权值都可以分解成 $2^a\\times 3^b$ 的形式。\n\n现在有 $q$ 个询问，每次询问给定四个参数 $u,v,a$ 和 $b$，请你求出是否存在一条顶点 $u$ 到 $v$ 之间的路径，使得路径依次经过的边上的权值的最小公倍数为 $2^a\\times 3^b$。\n\n注意：路径可以不是简单路径。\n\n下面是一些可能有用的定义，如果与其它地方定义不同，在本题中以下面的定义为准：  \n\n最小公倍数： $ k $ 个数 $ a_1 , a_2, \\ldots, a_k $ 的最小公倍数是能被每个 $a_i$ 整除的最小正整数。\n\n路径：顶点序列 $ P \\colon P_1,P_2,\\ldots,P_k $ 是一条路径，当且仅当 $k \\geq 2$，且对于任意 $ 1 \\leq i < k $ ，节点 $ P_i $ 和 $ P_{i+1} $ 之间都有边相连。 \n\n简单路径：如果路径 $ P \\colon P_1,P_2,\\ldots,P_k $ 中，对于任意 $ 1 \\leq s \\neq t \\leq k $ 都有 $ P_s \\neq P_t $ ，那么称 $P$ 为简单路径。\n", "inputFormat": "输入文件的第一行包含两个整数 $N$ 和 $M$，分别代表图的顶点数和边数。\n\n接下来 $M$ 行，每行包含四个整数 $u,v,a,b$ 代表一条顶点 $u$ 和 $v$ 之间、权值为 $2^a\\times 3^b$ 的边。\n\n接下来一行包含一个整数 $q$，代表询问数。\n\n接下来 $q$ 行，每行包含四个整数 $u,v,a$ 和 $b$，代表一次询问。询问内容请参见问题描述。\n", "outputFormat": "对于每次询问，如果存在满足条件的路径，则输出一行 `Yes`，否则输出一行 `No`（注意：第一个字母大写，其余字母小写）。\n", "hint": "$1\\le n,q\\le 5\\times 10^4$，$1\\leq m\\leq 10^5$，$0\\leq a,b\\leq 10^9$。", "locale": "zh-CN"}}}
{"pid": "P3248", "type": "P", "difficulty": 6, "samples": [["5 2 3\n1 4\n1 3\n4 2\n4 5\n4 3\n3 2\n6 9\n1 8\n5 3", "6\n3\n3"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000], "memory": [256000, 256000, 256000, 256000, 256000]}, "tags": ["2016", "各省省选", "湖南", "最近公共祖先 LCA", "树套树", "可持久化线段树"], "title": "[HNOI2016] 树", "background": "", "description": "小A想做一棵很大的树，但是他手上的材料有限，只好用点小技巧了。开始，小A只有一棵结点数为 $N$ 的树，结点的编号为 $1,2,...,N$，其中结点 $1$ 为根；我们称这颗树为模板树。小A决定通过这棵模板树来构建一颗大树。构建过程如下：\n\n1. 将模板树复制为初始的大树。\n\n2. 以下(2.1)(2.2)(2.3)步循环执行 $M$ 次\n\n（2.1）选择两个数字 $a,b$，其中 $1 \\leq a \\leq N, 1 \\leq b \\leq \\text{当前大树的结点数}$。\n\n（2.2）将模板树中以结点 $a$ 为根的子树复制一遍，挂到大树中结点 $b$ 的下方(也就是说，模板树中的结点 $a$ 为根的子树复制到大树中后，将成为大树中结点 $b$ 的子树)。\n\n（2.3）将新加入大树的结点按照在模板树中编号的顺序重新编号。例如，假设在进行2.2步之前大树有 $L$ 个结点，模板树中以 $a$ 为根的子树共有 $C$ 个结点，那么新加入模板树的 $C$ 个结点在大树中的编号将是 $L+1,L+2,...,L+C$ ；大树中这C个结点编号的大小顺序和模板树中对应的 $C$ 个结点的大小顺序是一致的。下面给出一个实例。假设模板树如下图：![](https://cdn.luogu.com.cn/upload/image_hosting/mchs3i55.png)\n\n根据第(1)步，初始的大树与模板树是相同的。\n\n在(2.1)步，假设选择了 $a=4, b=3$。运行(2.2)和(2.3)后，得到新的大树如下图所示\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ey2lqez8.png)\n\n现在他想问你，树中一些结点对的距离是多少。\n", "inputFormat": "第一行三个整数：$N,M,Q$，以空格隔开，$N$ 表示模板树结点数，$M$ 表示第(2)中的循环操作的次数，$Q$ 表示询问数量。\n\n接下来 $N-1$ 行，每行两个整数 $fr,to$，表示模板树中的一条树边。\n\n再接下来$M$行，每行两个整数$x,to$，表示将模板树中 $x$ 为根的子树复制到大树中成为结点 $to$ 的子树的一次操作。\n\n再接下来 $Q$ 行，每行两个整数 $fr,to$，表示询问大树中结点 $fr$ 和 $to$ 之间的距离是多少。\n\n$N,M,Q \\leq 100000$\n", "outputFormat": "输出 $Q$ 行，每行一个整数，第 $i$ 行是第 $i$ 个询问的答案。\n", "hint": "经过两次操作后，大树变成了下图所示的形状：\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/370xfnn2.png)\n\n结点6到9之间经过了6条边，所以距离为6；类似地，结点1到8之间经过了3条边；结点5到3之间也经过了3条边。\n", "locale": "zh-CN", "translations": {"en": {"title": "[HNOI2016] Tree", "background": "", "description": "Little A wants to build a very large tree, but his materials are limited, so he uses a small trick. Initially, Little A has a tree with $N$ nodes, numbered $1, 2, ..., N$, where node $1$ is the root; we call this the \"template tree\". Little A decides to construct a large tree based on this template tree. The construction proceeds as follows:\n\n1. Copy the template tree as the initial large tree.\n\n2. Repeat steps (2.1)–(2.3) $M$ times.\n\n(2.1) Choose two integers $a, b$, where $1 \\leq a \\leq N$, $1 \\leq b \\leq$ the current number of nodes in the large tree.\n\n(2.2) Copy the subtree of the template tree rooted at node $a$, and attach it under node $b$ in the large tree (that is, after copying, the subtree rooted at node $a$ from the template tree becomes a subtree of node $b$ in the large tree).\n\n(2.3) Renumber the newly added nodes in the large tree according to their order in the template tree. For example, suppose the large tree has $L$ nodes before step (2.2), and the subtree rooted at $a$ in the template tree has $C$ nodes. Then the $C$ newly added nodes will be numbered $L+1, L+2, ..., L+C$ in the large tree; the relative order of these $C$ node numbers in the large tree is consistent with the order of the corresponding $C$ nodes in the template tree. An example is given below. Suppose the template tree is as follows: ![](https://cdn.luogu.com.cn/upload/image_hosting/mchs3i55.png)\n\nAccording to step (1), the initial large tree is the same as the template tree.\n\nIn step (2.1), suppose we choose $a=4, b=3$. After performing steps (2.2) and (2.3), the new large tree is as shown below:\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ey2lqez8.png)\n\nNow he asks you for the distances between some pairs of nodes in the tree.", "inputFormat": "The first line contains three integers $N, M, Q$, separated by spaces, where $N$ is the number of nodes in the template tree, $M$ is the number of repetitions of the operation in step (2), and $Q$ is the number of queries.\n\nThe next $N-1$ lines each contain two integers $fr, to$, representing an edge in the template tree.\n\nThen there are $M$ lines, each containing two integers $x, to$, representing one operation that copies the subtree rooted at $x$ in the template tree and attaches it as a subtree of node $to$ in the large tree.\n\nThen there are $Q$ lines, each containing two integers $fr, to$, asking for the distance between nodes $fr$ and $to$ in the large tree.\n\n$N, M, Q \\leq 100000$.", "outputFormat": "Output $Q$ lines, each containing one integer. The $i$-th line is the answer to the $i$-th query.", "hint": "After two operations, the large tree becomes the shape shown below:\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/370xfnn2.png)\n\nThere are $6$ edges between nodes $6$ and $9$, so the distance is $6$. Similarly, there are $3$ edges between nodes $1$ and $8$. There are also $3$ edges between nodes $5$ and $3$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[HNOI2016] 树", "background": "", "description": "小A想做一棵很大的树，但是他手上的材料有限，只好用点小技巧了。开始，小A只有一棵结点数为 $N$ 的树，结点的编号为 $1,2,...,N$，其中结点 $1$ 为根；我们称这颗树为模板树。小A决定通过这棵模板树来构建一颗大树。构建过程如下：\n\n1. 将模板树复制为初始的大树。\n\n2. 以下(2.1)(2.2)(2.3)步循环执行 $M$ 次\n\n（2.1）选择两个数字 $a,b$，其中 $1 \\leq a \\leq N, 1 \\leq b \\leq \\text{当前大树的结点数}$。\n\n（2.2）将模板树中以结点 $a$ 为根的子树复制一遍，挂到大树中结点 $b$ 的下方(也就是说，模板树中的结点 $a$ 为根的子树复制到大树中后，将成为大树中结点 $b$ 的子树)。\n\n（2.3）将新加入大树的结点按照在模板树中编号的顺序重新编号。例如，假设在进行2.2步之前大树有 $L$ 个结点，模板树中以 $a$ 为根的子树共有 $C$ 个结点，那么新加入模板树的 $C$ 个结点在大树中的编号将是 $L+1,L+2,...,L+C$ ；大树中这C个结点编号的大小顺序和模板树中对应的 $C$ 个结点的大小顺序是一致的。下面给出一个实例。假设模板树如下图：![](https://cdn.luogu.com.cn/upload/image_hosting/mchs3i55.png)\n\n根据第(1)步，初始的大树与模板树是相同的。\n\n在(2.1)步，假设选择了 $a=4, b=3$。运行(2.2)和(2.3)后，得到新的大树如下图所示\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ey2lqez8.png)\n\n现在他想问你，树中一些结点对的距离是多少。\n", "inputFormat": "第一行三个整数：$N,M,Q$，以空格隔开，$N$ 表示模板树结点数，$M$ 表示第(2)中的循环操作的次数，$Q$ 表示询问数量。\n\n接下来 $N-1$ 行，每行两个整数 $fr,to$，表示模板树中的一条树边。\n\n再接下来$M$行，每行两个整数$x,to$，表示将模板树中 $x$ 为根的子树复制到大树中成为结点 $to$ 的子树的一次操作。\n\n再接下来 $Q$ 行，每行两个整数 $fr,to$，表示询问大树中结点 $fr$ 和 $to$ 之间的距离是多少。\n\n$N,M,Q \\leq 100000$\n", "outputFormat": "输出 $Q$ 行，每行一个整数，第 $i$ 行是第 $i$ 个询问的答案。\n", "hint": "经过两次操作后，大树变成了下图所示的形状：\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/370xfnn2.png)\n\n结点6到9之间经过了6条边，所以距离为6；类似地，结点1到8之间经过了3条边；结点5到3之间也经过了3条边。\n", "locale": "zh-CN"}}}
