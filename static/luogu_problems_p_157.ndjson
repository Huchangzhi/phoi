{"pid": "P4179", "type": "P", "difficulty": 6, "samples": [["5 30", "190.803848"], ["3 45", "15.500000"], ["4 10", "91.573592\n"], ["3 0", "26.000000\n\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2010", "重庆", "各省省选"], "title": "[CQOI2010] 鼹鼠", "background": "", "description": "Hilbert鼹鼠住在Hilbert地洞里——地洞的边界是一条$n$阶Hilbert曲线${H_n}$。Hilbert曲线的定义如下：${H_1}$是一个上端缺口的单位正方形；$H_n$由四份${H_n}-1$组成，其中左下和右下两份没有任何变化，而左上的那一份逆时针旋转了90度，而右上的那一份顺时针旋转了90度。这四份$H_n-1$用三条单位长度的线段连接起来构成了$H_n$。$H_1$~$H_4$如下图所示：\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/0vif0fh6.png)\n\n你想捉一只Hilbert鼹鼠来玩，所以往地洞里使劲倒水想把它们赶出来。不过，由于地洞里有空气，无论你怎么倒水，有些地方总是淹不到的（假设水和空气都不可压缩）。输入Hilbert曲线\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/aaj85oki.png)\n\n的阶数 $n$ 和地面的倾斜角 $α$ ，你的任务是计算能淹没到的面积。\n\n注意，只有当水位严格高于一个障碍物时，水才能越过它往下流。更多细节可以参考下面的例子。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/bbvmrpvd.png)\n", "inputFormat": "输入仅包含两个整数$n$，$α$。\n", "outputFormat": "输出仅一行，即被淹没的面积，输出保留小数点后6位。\n", "hint": "$rt,n<=12,0<=alpha<=90$", "locale": "zh-CN", "translations": {"en": {"title": "[CQOI2010] Mole", "background": "", "description": "The Hilbert mole lives in a Hilbert burrow — the burrow’s boundary is an order-$n$ Hilbert curve $H_n$. The Hilbert curve is defined as follows: $H_1$ is a unit square with an opening at the top; $H_n$ is composed of four copies of $H_{n-1}$, where the lower-left and lower-right copies remain unchanged, the upper-left copy is rotated 90 degrees counterclockwise, and the upper-right copy is rotated 90 degrees clockwise. These four copies of $H_{n-1}$ are connected by three unit-length segments to form $H_n$. $H_1$–$H_4$ are shown below.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/0vif0fh6.png)\n\nYou want to catch a Hilbert mole, so you pour water into the burrow to flush it out. However, because there is air inside the burrow and both water and air are incompressible, some places can never be flooded no matter how much water you pour. Given the order $n$ of the Hilbert curve\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/aaj85oki.png)\n\nand the ground tilt angle $\\alpha$, your task is to compute the area that can be flooded.\n\nNote that water can flow past an obstacle only when the water level is strictly higher than the obstacle. See the example below for more details.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/bbvmrpvd.png)", "inputFormat": "The input contains two integers $n$ and $\\alpha$.", "outputFormat": "Output a single line with the flooded area, with 6 digits after the decimal point.", "hint": "Constraints: $n \\le 12$, $0 \\le \\alpha \\le 90$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[CQOI2010] 鼹鼠", "background": "", "description": "Hilbert鼹鼠住在Hilbert地洞里——地洞的边界是一条$n$阶Hilbert曲线${H_n}$。Hilbert曲线的定义如下：${H_1}$是一个上端缺口的单位正方形；$H_n$由四份${H_n}-1$组成，其中左下和右下两份没有任何变化，而左上的那一份逆时针旋转了90度，而右上的那一份顺时针旋转了90度。这四份$H_n-1$用三条单位长度的线段连接起来构成了$H_n$。$H_1$~$H_4$如下图所示：\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/0vif0fh6.png)\n\n你想捉一只Hilbert鼹鼠来玩，所以往地洞里使劲倒水想把它们赶出来。不过，由于地洞里有空气，无论你怎么倒水，有些地方总是淹不到的（假设水和空气都不可压缩）。输入Hilbert曲线\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/aaj85oki.png)\n\n的阶数 $n$ 和地面的倾斜角 $α$ ，你的任务是计算能淹没到的面积。\n\n注意，只有当水位严格高于一个障碍物时，水才能越过它往下流。更多细节可以参考下面的例子。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/bbvmrpvd.png)\n", "inputFormat": "输入仅包含两个整数$n$，$α$。\n", "outputFormat": "输出仅一行，即被淹没的面积，输出保留小数点后6位。\n", "hint": "$rt,n<=12,0<=alpha<=90$", "locale": "zh-CN"}}}
{"pid": "P4180", "type": "P", "difficulty": 6, "samples": [["5 6\n1 2 1 \n1 3 2 \n2 4 3 \n3 5 4 \n3 4 3 \n4 5 6 ", "11"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["2010", "倍增", "北京", "O2优化", "生成树", "最近公共祖先 LCA"], "title": "[BJWC2010] 严格次小生成树", "background": "", "description": "小 C 最近学了很多最小生成树的算法，Prim 算法、Kruskal 算法、消圈算法等等。正当小 C 洋洋得意之时，小 P 又来泼小 C 冷水了。小 P 说，让小 C 求出一个无向图的次小生成树，而且这个次小生成树还得是严格次小的，也就是说：如果最小生成树选择的边集是 $E_M$，严格次小生成树选择的边集是 $E_S$，那么需要满足：($value(e)$ 表示边 $e$ 的权值) $\\sum_{e \\in E_M}value(e)<\\sum_{e \\in E_S}value(e)$。\n\n这下小 C 蒙了，他找到了你，希望你帮他解决这个问题。\n", "inputFormat": "第一行包含两个整数 $N$ 和 $M$，表示无向图的点数与边数。\n\n接下来 $M$ 行，每行 $3$ 个数 $x,y,z$ 表示，点 $x$ 和点 $y$ 之间有一条边，边的权值为 $z$。\n", "outputFormat": "包含一行，仅一个数，表示严格次小生成树的边权和。\n", "hint": "数据中无向图**不保证无自环**。\n\n对于 $50\\%$ 的数据， $N\\le 2000$，$M\\le 3000$。\n\n对于 $80\\%$ 的数据， $N\\le 5\\times 10^4$，$M\\le 10^5$。\n\n对于 $100\\%$ 的数据， $N\\le 10^5$，$M\\le 3\\times10^5$，边权  $\\in [0,10^9]$，数据保证必定存在严格次小生成树。", "locale": "zh-CN", "translations": {"en": {"title": "[BJWC2010] Strictly Second Minimum Spanning Tree", "background": "", "description": "Xiao C recently learned many algorithms for the minimum spanning tree, such as Prim, Kruskal, and cycle-canceling, etc. Just as Xiao C was feeling proud, Xiao P poured cold water on him. Xiao P asked Xiao C to find the second minimum spanning tree of an undirected graph, and it must be strictly second, that is: if the edge set chosen by the minimum spanning tree is $E_M$, and the edge set chosen by the strictly second minimum spanning tree is $E_S$, then it must satisfy: (here $value(e)$ denotes the weight of edge $e$) $\\sum_{e \\in E_M}value(e)<\\sum_{e \\in E_S}value(e)$.\n\nXiao C was stumped and came to you for help to solve this problem.", "inputFormat": "The first line contains two integers $N$ and $M$, denoting the number of vertices and edges of the undirected graph.\n\nThe next $M$ lines each contain three numbers $x, y, z$, indicating that there is an edge between vertex $x$ and vertex $y$ with weight $z$.", "outputFormat": "Output one line with a single number, the sum of edge weights of the strictly second minimum spanning tree.", "hint": "- The undirected graph may contain self-loops.\n\nConstraints:\n- For 50% of the testdata, $N \\le 2000$, $M \\le 3000$.\n- For 80% of the testdata, $N \\le 5 \\times 10^4$, $M \\le 10^5$.\n- For 100% of the testdata, $N \\le 10^5$, $M \\le 3 \\times 10^5$, edge weights $\\in [0,10^9]$, and the testdata guarantees that a strictly second minimum spanning tree exists.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[BJWC2010] 严格次小生成树", "background": "", "description": "小 C 最近学了很多最小生成树的算法，Prim 算法、Kruskal 算法、消圈算法等等。正当小 C 洋洋得意之时，小 P 又来泼小 C 冷水了。小 P 说，让小 C 求出一个无向图的次小生成树，而且这个次小生成树还得是严格次小的，也就是说：如果最小生成树选择的边集是 $E_M$，严格次小生成树选择的边集是 $E_S$，那么需要满足：($value(e)$ 表示边 $e$ 的权值) $\\sum_{e \\in E_M}value(e)<\\sum_{e \\in E_S}value(e)$。\n\n这下小 C 蒙了，他找到了你，希望你帮他解决这个问题。\n", "inputFormat": "第一行包含两个整数 $N$ 和 $M$，表示无向图的点数与边数。\n\n接下来 $M$ 行，每行 $3$ 个数 $x,y,z$ 表示，点 $x$ 和点 $y$ 之间有一条边，边的权值为 $z$。\n", "outputFormat": "包含一行，仅一个数，表示严格次小生成树的边权和。\n", "hint": "数据中无向图**不保证无自环**。\n\n对于 $50\\%$ 的数据， $N\\le 2000$，$M\\le 3000$。\n\n对于 $80\\%$ 的数据， $N\\le 5\\times 10^4$，$M\\le 10^5$。\n\n对于 $100\\%$ 的数据， $N\\le 10^5$，$M\\le 3\\times10^5$，边权  $\\in [0,10^9]$，数据保证必定存在严格次小生成树。", "locale": "zh-CN"}}}
{"pid": "P4181", "type": "P", "difficulty": 4, "samples": [["5 3 4\n6\n2\n4\n7\n1\n10 25\n2 10\n15 15\n250\n80\n100\n40", "725\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["贪心", "2018", "USACO", "排序"], "title": "[USACO18JAN] Rental Service S", "background": "", "description": "Farmer John realizes that the income he receives from milk production is insufficient to fund the growth of his farm, so to earn some extra money, he launches a cow-rental service, which he calls \"USACOW\" (pronounced \"Use-a-cow\").\n\nFarmer John has $N$ cows ($1 \\leq N \\leq 100,000$), each capable of producing some amount of milk every day. The $M$ stores near FJ's farm ($1 \\leq M \\leq 100,000$) each offer to buy a certain amount of milk at a certain price. Moreover, Farmer John's $R$ ($1 \\leq R \\leq 100,000$) neighboring farmers are each interested in renting a cow at a certain price.\n\n\nFarmer John has to choose whether each cow should be milked or rented to a nearby farmer. Help him find the maximum amount of money he can make per day.\n", "inputFormat": "The first line in the input contains $N$, $M$, and $R$. The next $N$ lines each contain an integer $c_i$ ($1 \\leq c_i \\leq 1,000,000$), indicating that Farmer John's $i$th cow can produce $c_i$ gallons of milk every day. The next $M$ lines each contain two integers $q_i$ and $p_i$ ($1 \\leq q_i, p_i \\leq 1,000,000$), indicating that the $i$th store is willing to buy up to $q_i$ gallons of milk for $p_i$ cents per gallon. Keep in mind that Farmer John can sell any amount of milk between zero and $q_i$ gallons to a given store. The next $R$ lines each contain an integer $r_i$ ($1 \\leq r_i \\leq 1,000,000$), indicating that one of Farmer John's neighbors wants to rent a cow for $r_i$ cents per day.\n", "outputFormat": "The output should consist of one line containing the maximum profit Farmer John can make per day by milking or renting out each of his cows. Note that the output might be too large to fit into a standard 32-bit integer, so you may need to use a larger integer type like a \"long long\" in C/C++.\n", "hint": "Farmer John should milk cows #1 and #4, to produce 13 gallons of milk. He should completely fill the order for 10 gallons, earning 250 cents, and sell the remaining three gallons at 15 cents each, for a total of 295 cents of milk profits.\n\n\nThen, he should rent out the other three cows for 250, 80, and 100 cents, to earn 430 more cents. (He should leave the request for a 40-cent rental unfilled.) This is a total of 725 cents of daily profit.\n", "locale": "en", "translations": {"en": {"title": "[USACO18JAN] Rental Service S", "background": "", "description": "Farmer John realizes that the income he receives from milk production is insufficient to fund the growth of his farm, so to earn some extra money, he launches a cow-rental service, which he calls \"USACOW\" (pronounced \"Use-a-cow\").\n\nFarmer John has $N$ cows ($1 \\leq N \\leq 100,000$), each capable of producing some amount of milk every day. The $M$ stores near FJ's farm ($1 \\leq M \\leq 100,000$) each offer to buy a certain amount of milk at a certain price. Moreover, Farmer John's $R$ ($1 \\leq R \\leq 100,000$) neighboring farmers are each interested in renting a cow at a certain price.\n\n\nFarmer John has to choose whether each cow should be milked or rented to a nearby farmer. Help him find the maximum amount of money he can make per day.\n", "inputFormat": "The first line in the input contains $N$, $M$, and $R$. The next $N$ lines each contain an integer $c_i$ ($1 \\leq c_i \\leq 1,000,000$), indicating that Farmer John's $i$th cow can produce $c_i$ gallons of milk every day. The next $M$ lines each contain two integers $q_i$ and $p_i$ ($1 \\leq q_i, p_i \\leq 1,000,000$), indicating that the $i$th store is willing to buy up to $q_i$ gallons of milk for $p_i$ cents per gallon. Keep in mind that Farmer John can sell any amount of milk between zero and $q_i$ gallons to a given store. The next $R$ lines each contain an integer $r_i$ ($1 \\leq r_i \\leq 1,000,000$), indicating that one of Farmer John's neighbors wants to rent a cow for $r_i$ cents per day.\n", "outputFormat": "The output should consist of one line containing the maximum profit Farmer John can make per day by milking or renting out each of his cows. Note that the output might be too large to fit into a standard 32-bit integer, so you may need to use a larger integer type like a \"long long\" in C/C++.\n", "hint": "Farmer John should milk cows #1 and #4, to produce 13 gallons of milk. He should completely fill the order for 10 gallons, earning 250 cents, and sell the remaining three gallons at 15 cents each, for a total of 295 cents of milk profits.\n\n\nThen, he should rent out the other three cows for 250, 80, and 100 cents, to earn 430 more cents. (He should leave the request for a 40-cent rental unfilled.) This is a total of 725 cents of daily profit.\n", "locale": "en"}, "zh-CN": {"title": "[USACO18JAN] Rental Service S", "background": null, "description": "Farmer John 意识到牛奶生产的收入不足以支持农场的扩展，因此为了赚取额外收入，他推出了一项奶牛租赁服务，称为“USACOW”（发音为“Use-a-cow”）。\n\nFarmer John 有 $N$ 头奶牛（$1 \\leq N \\leq 100,000$），每头奶牛每天可以生产一定量的牛奶。附近的 $M$ 家商店（$1 \\leq M \\leq 100,000$）每家都愿意以一定价格购买一定量的牛奶。此外，Farmer John 的 $R$ 个邻居（$1 \\leq R \\leq 100,000$）每家都愿意以一定价格租赁一头奶牛。\n\nFarmer John 需要决定每头奶牛是用于产奶还是租给附近的农民。请帮助他计算每天可以赚取的最大金额。", "inputFormat": "输入的第一行包含 $N$、$M$ 和 $R$。\n\n接下来的 $N$ 行每行包含一个整数 $c_i$（$1 \\leq c_i \\leq 1,000,000$），表示 Farmer John 的第 $i$ 头奶牛每天可以生产 $c_i$ 加仑牛奶。\n\n接下来的 $M$ 行每行包含两个整数 $q_i$ 和 $p_i$（$1 \\leq q_i, p_i \\leq 1,000,000$），表示第 $i$ 家商店愿意以每加仑 $p_i$ 美分的价格购买最多 $q_i$ 加仑牛奶。**请注意，Farmer John 可以向每家商店出售任意数量的牛奶，范围从 $0$ 到 $q_i$ 加仑。**\n\n接下来的 $R$ 行每行包含一个整数 $r_i$（$1 \\leq r_i \\leq 1,000,000$），表示 Farmer John 的一个邻居愿意以每天 $r_i$ 美分的价格租赁一头奶牛。", "outputFormat": "输出应包含一行，表示 Farmer John 通过产奶或租赁奶牛每天可以获得的最大利润。\n\n请注意，输出可能超过标准 32 位整数的范围，因此可能需要使用更大的整数类型，例如 C/C++ 中的 long long", "hint": "Farmer John 应该让奶牛 #1 和 #4 产奶，每天生产 $13$ 加仑牛奶。他应该完全满足 $10$ 加仑的订单，赚取 $250$ 美分，并以每加仑 $15$ 美分的价格出售剩余的 $3$ 加仑，总共赚取 $295$ 美分的牛奶利润。\n\n然后，他应该将其他三头奶牛分别以 $250$、$80$ 和 $100$ 美分的价格租出，赚取额外的 $430$ 美分。（他应该忽略 $40$ 美分的租赁请求。）这样，他每天的总利润为 $725$ 美分。", "locale": "zh-CN"}}}
{"pid": "P4182", "type": "P", "difficulty": 6, "samples": [["3 2\n1 8\n7 15\n2 14", "12\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["动态规划 DP", "2018", "USACO", "单调队列", "枚举", "队列"], "title": "[USACO18JAN] Lifeguards P", "background": "", "description": "Farmer John has opened a swimming pool for his cows, figuring it will help them relax and produce more milk.\n\nTo ensure safety, he hires $N$ cows as lifeguards, each of which has a shift that covers some contiguous interval of time during the day. For simplicity, the pool is open from time $0$ until time $10^9$ on a daily basis, so each shift can be described by two integers, giving the time at which a cow starts and ends her shift. For example, a lifeguard starting at time $t = 4$ and ending at time $t = 7$ covers three units of time (note that the endpoints are \"points\" in time).\n\n\nUnfortunately, Farmer John hired $K$ more lifeguards than he has the funds to support. Given that he must fire exactly $K$ lifeguards, what is the maximum amount of time that can still be covered by the shifts of the remaining lifeguards? An interval of time is covered if at least one lifeguard is present.\n", "inputFormat": "The first line of input contains $N$ and $K$ ($K \\leq N \\leq 100,000, 1 \\leq K \\leq 100$). Each of the next $N$ lines describes a lifeguard in terms of two integers in the range $0 \\ldots 10^9$, giving the starting and ending point of a lifeguard's shift. All such endpoints are distinct. Shifts of different lifeguards might overlap.\n", "outputFormat": "Please write a single number, giving the maximum amount of time that can still be covered if Farmer John fires $K$ lifeguards.\n", "hint": "In this example, FJ should fire the lifeguards covering $1 \\ldots 8$ and $7 \\ldots 15$.\n\n", "locale": "en", "translations": {"en": {"title": "[USACO18JAN] Lifeguards P", "background": "", "description": "Farmer John has opened a swimming pool for his cows, figuring it will help them relax and produce more milk.\n\nTo ensure safety, he hires $N$ cows as lifeguards, each of which has a shift that covers some contiguous interval of time during the day. For simplicity, the pool is open from time $0$ until time $10^9$ on a daily basis, so each shift can be described by two integers, giving the time at which a cow starts and ends her shift. For example, a lifeguard starting at time $t = 4$ and ending at time $t = 7$ covers three units of time (note that the endpoints are \"points\" in time).\n\n\nUnfortunately, Farmer John hired $K$ more lifeguards than he has the funds to support. Given that he must fire exactly $K$ lifeguards, what is the maximum amount of time that can still be covered by the shifts of the remaining lifeguards? An interval of time is covered if at least one lifeguard is present.\n", "inputFormat": "The first line of input contains $N$ and $K$ ($K \\leq N \\leq 100,000, 1 \\leq K \\leq 100$). Each of the next $N$ lines describes a lifeguard in terms of two integers in the range $0 \\ldots 10^9$, giving the starting and ending point of a lifeguard's shift. All such endpoints are distinct. Shifts of different lifeguards might overlap.\n", "outputFormat": "Please write a single number, giving the maximum amount of time that can still be covered if Farmer John fires $K$ lifeguards.\n", "hint": "In this example, FJ should fire the lifeguards covering $1 \\ldots 8$ and $7 \\ldots 15$.\n\n", "locale": "en"}, "zh-CN": {"title": "[USACO18JAN] Lifeguards P", "background": "", "description": "Farmer John 为他的奶牛们开设了一个游泳池，认为这将帮助它们放松并产更多的奶。\n\n为了确保安全，他雇佣了 $N$ 头奶牛作为救生员，每头奶牛的班次覆盖一天中的某个连续时间段。为简单起见，游泳池每天从时间 $0$ 开放到时间 $10^9$，因此每个班次可以用两个整数描述，分别表示奶牛开始和结束其班次的时间。例如，一头救生员从时间 $t = 4$ 开始到时间 $t = 7$ 结束，覆盖了 $3$ 个单位的时间（注意端点表示时间点）。\n\n不幸的是，Farmer John 多雇佣了 $K$ 名救生员，超出了他的资金支持范围。鉴于他必须解雇恰好 $K$ 名救生员，剩下的救生员的班次能够覆盖的最长时间是多少？如果至少有一名救生员在场，则某个时间段被视为被覆盖。", "inputFormat": "输入的第一行包含 $N$ 和 $K$（$K \\leq N \\leq 100,000$，$1 \\leq K \\leq 100$）。接下来的 $N$ 行每行描述一名救生员，用两个范围在 $0 \\ldots 10^9$ 的整数表示该救生员班次的开始和结束时间。所有端点都是唯一的。不同救生员的班次可能会重叠。", "outputFormat": "请输出一个数字，表示如果 Farmer John 解雇 $K$ 名救生员后，剩下的救生员的班次能够覆盖的最长时间。", "hint": "在这个例子中，Farmer John 应该解雇覆盖 $1 \\ldots 8$ 和 $7 \\ldots 15$ 的救生员。", "locale": "zh-CN"}}}
{"pid": "P4183", "type": "P", "difficulty": 6, "samples": [["7\n1 2\n1 3\n3 4\n3 5\n4 6\n5 7", "3\n1\n3\n3\n3\n1\n1"]], "limits": {"time": [4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000], "memory": [262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144]}, "tags": ["2018", "USACO", "点分治", "分治"], "title": "[USACO18JAN] Cow at Large P", "background": "", "description": "Cornered at last, Bessie has gone to ground in a remote farm. The farm consists of $N$ barns ($2 \\leq N \\leq 7 \\cdot 10^4$) and $N-1$ bidirectional tunnels between barns, so that there is a unique path between every pair of barns. Every barn which has only one tunnel is an exit. When morning comes, Bessie will surface at some barn and attempt to reach an exit.\n\nBut the moment Bessie surfaces at some barn, the law will be able to pinpoint her location. Some farmers will then start at various exit barns, and attempt to catch Bessie. The farmers move at the same speed as Bessie (so in each time step, each farmer can move from one barn to an adjacent barn). The farmers know where Bessie is at all times, and Bessie knows where the farmers are at all times. The farmers catch Bessie if at any instant a farmer is in the same barn as Bessie, or crossing the same tunnel as Bessie. Conversely, Bessie escapes if she reaches an exit barn strictly before any farmers catch her.\n\n\nBessie is unsure at which barn she should surface. For each of the $N$ barns, help Bessie determine the minimum number of farmers who would be needed to catch Bessie if she surfaced there, assuming that the farmers distribute themselves optimally among the exit barns.\n\n\nNote that the time limit for this problem is slightly larger than the default: 4 seconds for C/C++/Pascal, and 8 seconds for Java/Python.\n", "inputFormat": "The first line of the input contains $N$. Each of the following $N-1$ lines specify two integers, each in the range $1 \\ldots N$, describing a tunnel between two barns.\n", "outputFormat": "Please output $N$ lines, where the $i$th line of output tells the minimum number of farmers necessary to catch Bessie if she surfaced at the $i$th barn.\n", "hint": "", "locale": "en", "translations": {"en": {"title": "[USACO18JAN] Cow at Large P", "background": "", "description": "Cornered at last, Bessie has gone to ground in a remote farm. The farm consists of $N$ barns ($2 \\leq N \\leq 7 \\cdot 10^4$) and $N-1$ bidirectional tunnels between barns, so that there is a unique path between every pair of barns. Every barn which has only one tunnel is an exit. When morning comes, Bessie will surface at some barn and attempt to reach an exit.\n\nBut the moment Bessie surfaces at some barn, the law will be able to pinpoint her location. Some farmers will then start at various exit barns, and attempt to catch Bessie. The farmers move at the same speed as Bessie (so in each time step, each farmer can move from one barn to an adjacent barn). The farmers know where Bessie is at all times, and Bessie knows where the farmers are at all times. The farmers catch Bessie if at any instant a farmer is in the same barn as Bessie, or crossing the same tunnel as Bessie. Conversely, Bessie escapes if she reaches an exit barn strictly before any farmers catch her.\n\n\nBessie is unsure at which barn she should surface. For each of the $N$ barns, help Bessie determine the minimum number of farmers who would be needed to catch Bessie if she surfaced there, assuming that the farmers distribute themselves optimally among the exit barns.\n\n\nNote that the time limit for this problem is slightly larger than the default: 4 seconds for C/C++/Pascal, and 8 seconds for Java/Python.\n", "inputFormat": "The first line of the input contains $N$. Each of the following $N-1$ lines specify two integers, each in the range $1 \\ldots N$, describing a tunnel between two barns.\n", "outputFormat": "Please output $N$ lines, where the $i$th line of output tells the minimum number of farmers necessary to catch Bessie if she surfaced at the $i$th barn.\n", "hint": "", "locale": "en"}, "zh-CN": {"title": "[USACO18JAN] Cow at Large P", "background": "", "description": "Bessie 被逼到了绝境，躲进了一个偏远的农场。这个农场由 $N$ 个谷仓（$2 \\leq N \\leq 7 \\cdot 10^4$）和 $N-1$ 条双向隧道组成，因此每对谷仓之间都有一条唯一的路径。每个只有一个隧道的谷仓都是一个出口。当早晨来临时，Bessie 会从某个谷仓出现，并试图到达一个出口。\n\n但是，当 Bessie 从某个谷仓出现时，执法人员会立即定位到她的位置。一些农民会从各个出口谷仓出发，试图抓住 Bessie。农民和 Bessie 的移动速度相同（因此在每个时间步中，每个农民可以从一个谷仓移动到相邻的谷仓）。农民们始终知道 Bessie 的位置，而 Bessie 也始终知道农民们的位置。如果农民和 Bessie 在同一谷仓或同时穿过同一条隧道，农民就会抓住 Bessie。相反，如果 Bessie 在农民抓住她之前严格地到达一个出口谷仓，她就能逃脱。\n\nBessie 不确定她应该从哪个谷仓出现。对于每个谷仓，请帮助 Bessie 确定如果她从该谷仓出现，假设农民们最优地分布在出口谷仓中，抓住她所需的最少农民数量。\n\n请注意，本题的时间限制略高于默认值：C/C++/Pascal 为 4 秒，Java/Python 为 8 秒。", "inputFormat": "输入的第一行包含 $N$。接下来的 $N-1$ 行每行包含两个整数，范围在 $1 \\ldots N$ 之间，描述一条连接两个谷仓的隧道。", "outputFormat": "请输出 $N$ 行，其中第 $i$ 行表示如果 Bessie 从第 $i$ 个谷仓出现，抓住她所需的最少农民数量。", "hint": "", "locale": "zh-CN"}}}
{"pid": "P4184", "type": "P", "difficulty": 6, "samples": [["5\n0 4\n1 1\n2 2\n3 0\n4 3", "21"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2018", "线段树", "USACO", "前缀和"], "title": "[USACO18JAN] Sprinklers P", "background": "", "description": "Farmer John has a large field, and he is thinking of planting sweet corn in some part of it. After surveying his field, FJ found that it forms an $(N-1) \\times (N-1)$ square. The southwest corner is at coordinates $(0,0)$, and the northeast corner is at $(N-1,N-1)$.\n\nAt some integer coordinates there are double-headed sprinklers, each one sprinkling both water and fertilizer. A double-heading sprinkler at coordinates $(i,j)$ sprinkles water on the part of the field north and east of it, and sprinkles fertilizer on the part of the field south and west of it. Formally, it waters all real coordinates $(x,y)$ for which $N \\geq x \\geq i$ and $N \\geq y \\geq j$, and it fertilizes all real coordinates $(x,y)$ for which $0 \\leq x \\leq i$ and $0 \\leq y \\leq j$.\n\n\nFarmer John wants to plant sweet corn in some axis-aligned rectangle in his field with integer-valued corner coordinates. However, for the sweet corn to grow, all points in the rectangle must be both watered and fertilized by the double-headed sprinklers. And of course the rectangle must have positive area, or Farmer John wouldn't be able to grow any corn in it!\n\n\nHelp Farmer John determine the number of rectangles of positive area in which he could grow sweet corn. Since this number may be large, output the remainder of this number modulo $10^9 + 7$.\n", "inputFormat": "The first line of the input consists of a single integer $N$, the size of the field ($1 \\leq N \\leq 10^5$).\n\nThe next $N$ lines each contain two space-separated integers. If these integers are $i$ and $j$, where $0 \\leq i,j \\leq N-1$, they denote a sprinkler located at $(i,j)$.\n\n\nIt is guaranteed that there is exactly one sprinkler in each column and exactly one sprinkler in each row. That is, no two sprinklers have the same $x$-coordinate, and no two sprinklers have the same $y$-coordinate.\n", "outputFormat": "The output should consist of a single integer: the number of rectangles of positive area which are fully watered and fully fertilized, modulo $10^9 + 7$.\n", "hint": "", "locale": "en", "translations": {"en": {"title": "[USACO18JAN] Sprinklers P", "background": "", "description": "Farmer John has a large field, and he is thinking of planting sweet corn in some part of it. After surveying his field, FJ found that it forms an $(N-1) \\times (N-1)$ square. The southwest corner is at coordinates $(0,0)$, and the northeast corner is at $(N-1,N-1)$.\n\nAt some integer coordinates there are double-headed sprinklers, each one sprinkling both water and fertilizer. A double-heading sprinkler at coordinates $(i,j)$ sprinkles water on the part of the field north and east of it, and sprinkles fertilizer on the part of the field south and west of it. Formally, it waters all real coordinates $(x,y)$ for which $N \\geq x \\geq i$ and $N \\geq y \\geq j$, and it fertilizes all real coordinates $(x,y)$ for which $0 \\leq x \\leq i$ and $0 \\leq y \\leq j$.\n\n\nFarmer John wants to plant sweet corn in some axis-aligned rectangle in his field with integer-valued corner coordinates. However, for the sweet corn to grow, all points in the rectangle must be both watered and fertilized by the double-headed sprinklers. And of course the rectangle must have positive area, or Farmer John wouldn't be able to grow any corn in it!\n\n\nHelp Farmer John determine the number of rectangles of positive area in which he could grow sweet corn. Since this number may be large, output the remainder of this number modulo $10^9 + 7$.\n", "inputFormat": "The first line of the input consists of a single integer $N$, the size of the field ($1 \\leq N \\leq 10^5$).\n\nThe next $N$ lines each contain two space-separated integers. If these integers are $i$ and $j$, where $0 \\leq i,j \\leq N-1$, they denote a sprinkler located at $(i,j)$.\n\n\nIt is guaranteed that there is exactly one sprinkler in each column and exactly one sprinkler in each row. That is, no two sprinklers have the same $x$-coordinate, and no two sprinklers have the same $y$-coordinate.\n", "outputFormat": "The output should consist of a single integer: the number of rectangles of positive area which are fully watered and fully fertilized, modulo $10^9 + 7$.\n", "hint": "", "locale": "en"}, "zh-CN": {"title": "[USACO18JAN] Sprinklers P", "background": null, "description": "农夫约翰有块田，这块田可视为一个 $N\\times N$ 的正方形网格。西南角为 $(0,0)$，东北角为 $(N-1, N-1)$。  \n在某些坐标点上有双头喷头，每一个都能够同时喷洒水和肥料。一个位于 $(i,j)$ 的双头喷头会\n* 将水洒在所有满足 $N\\ge x\\ge i$，$N\\ge y\\ge j$ 的坐标 $(x,y)$ 上；\n* 将肥料洒在所有满足 $0\\le x\\le i$，$0\\le y\\le j$ 的坐标 $(x,y)$ 上。\n\n农民约翰想在这块田里切割出一个矩形种甜玉米。矩形的顶点坐标需为整数。矩形内的所有点都必须能由双头喷头灌溉和施肥。  \n求切割矩形的方案数。由于这个数字可能很大，所以输出对 $10^9+7$ 取模。", "inputFormat": "第一行包含一个整数 $N$，表示农场的大小。  \n接下来的 $N$ 行，每行有两个由空格分隔的整数 $i, j$。这表示有一个双头喷头位于 $(i, j)$。  \n保证每列都有一台喷头，每排正好有一台喷头。换句话说，没有两个喷头有相同的横坐标或纵坐标。", "outputFormat": "输出包含一行，表示方案数，对 $10^9+7$ 取模。", "hint": "$1\\le N\\le 10^5$", "locale": "zh-CN"}}}
{"pid": "P4185", "type": "P", "difficulty": 4, "samples": [["4 3\n1 2 3\n2 3 2\n2 4 4\n1 2\n4 1\n3 1", "3\n0\n2\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2018", "USACO", "并查集", "连通块"], "title": "[USACO18JAN] MooTube G", "background": "*本题与 [银组同名题目](/problem/P6111) 在题意上一致，唯一的差别是数据范围。*", "description": "在业余时间，Farmer John 创建了一个新的视频共享服务，他将其命名为 MooTube。在 MooTube 上，Farmer John 的奶牛可以录制，分享和发现许多有趣的视频。他的奶牛已经发布了 $N$ 个视频（$1 \\leq N \\leq 10^5$），为了方便将其编号为  $1 \\ldots N$。然而，FJ 无法弄清楚如何帮助他的奶牛找到他们可能喜欢的新视频。\n\nFJ 希望为每个 MooTube 视频创建一个“推荐视频”列表。这样，奶牛将被推荐与他们已经观看过的视频最相关的视频。\n\nFJ 设计了一个“相关性”度量标准，顾名思义，它确定了两个视频相互之间的相关值。FJ 将他的视频建成一棵树（其中每个节点代表一条视频），并且计算了所有 $N-1$ 对相邻视频的相关值。这样任意视频都可以通过一条连通路径到达任意其他视频。FJ 决定将任意一对视频的相关值定义为沿此路径的任何连接的最小相关值。\n\nFarmer John 想要选择一个 $K$ 值，以便在任何给定的 MooTube 视频旁边，推荐所有其他与该视频相关值至少为 $K$ 的视频。然而，FJ 担心会向他的奶牛推荐太多的视频，这可能会分散他们对产奶的注意力！因此，他想设定适当的 $K$ 值。Farmer John 希望得到您的帮助，回答有关 $K$ 值的推荐视频的一些问题。", "inputFormat": "第一行输入包含 $N$ 和 $Q$（$1 \\leq Q \\leq 10^5$）。\n\n接下来的 $N-1$ 行描述了 FJ 手动比较的一对视频。 每行包括三个整数 $p_i$，$q_i$ 和 $r_i$（$1 \\leq p_i, q_i \\leq N$，$1 \\leq r_i \\leq 10^9$），表示视频 $p_i$ 和 $q_i$ 已连接并且相关值为 $r_i$。\n\n接下来的 $Q$ 行描述了 Farmer John 的 $Q$ 个问题。每行包含两个整数，$k_i$ 和 $v_i$（$1 \\leq k_i \\leq 10^9$，$1 \\leq v_i \\leq N$），表示 FJ 的第 $i$ 个问题询问中当 $K = k_i$ 时，第 $v_i$ 个视频推荐列表中将推荐的视频数。", "outputFormat": "输出 $Q$ 行。在第 $i$ 行，输出 FJ 的第 $i$ 个问题的答案。", "hint": null, "locale": "zh-CN", "translations": {"en": {"title": "[USACO18JAN] MooTube G", "background": "This problem has the same statement as the [Silver version](/problem/P6111); the only difference is the constraints.", "description": "In his spare time, Farmer John created a new video sharing service, which he named MooTube. On MooTube, Farmer John’s cows can record, share, and discover many interesting videos. His cows have posted $N$ videos ($1 \\leq N \\leq 10^5$), conveniently numbered $1 \\ldots N$. However, FJ cannot figure out how to help his cows find new videos they might like.\n\nFJ wants to create a “recommended videos” list for each MooTube video. This way, cows will be recommended videos that are most related to the videos they have already watched.\n\nFJ designed a “relevance” metric that, as the name suggests, measures how related two videos are. FJ models his videos as a tree (where each node represents a video) and computes the relevance for all $N-1$ pairs of adjacent videos. In this way, any video can reach any other video via a connected path. FJ defines the relevance of any pair of videos as the minimum relevance along the edges on the path between them.\n\nFarmer John wants to choose a value $K$ so that, next to any given MooTube video, he will recommend all other videos whose relevance to that video is at least $K$. However, FJ worries about recommending too many videos, which might distract the cows from producing milk. Therefore, he wants to set an appropriate value of $K$. Farmer John needs your help to answer some questions about the recommended videos for given $K$ values.", "inputFormat": "The first line contains $N$ and $Q$ ($1 \\leq Q \\leq 10^5$).\n\nEach of the next $N-1$ lines describes a pair of videos that FJ compared manually. Each line contains three integers $p_i$, $q_i$, and $r_i$ ($1 \\leq p_i, q_i \\leq N$, $1 \\leq r_i \\leq 10^9$), indicating that videos $p_i$ and $q_i$ are connected and have relevance $r_i$.\n\nEach of the next $Q$ lines describes one of Farmer John’s $Q$ queries. Each line contains two integers, $k_i$ and $v_i$ ($1 \\leq k_i \\leq 10^9$, $1 \\leq v_i \\leq N$), meaning that in FJ’s $i$-th query, when $K = k_i$, you should report how many videos would be recommended in the list for video $v_i$.", "outputFormat": "Output $Q$ lines. On the $i$-th line, output the answer to FJ’s $i$-th query.", "hint": "\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[USACO18JAN] MooTube G", "background": "*本题与 [银组同名题目](/problem/P6111) 在题意上一致，唯一的差别是数据范围。*", "description": "在业余时间，Farmer John 创建了一个新的视频共享服务，他将其命名为 MooTube。在 MooTube 上，Farmer John 的奶牛可以录制，分享和发现许多有趣的视频。他的奶牛已经发布了 $N$ 个视频（$1 \\leq N \\leq 10^5$），为了方便将其编号为  $1 \\ldots N$。然而，FJ 无法弄清楚如何帮助他的奶牛找到他们可能喜欢的新视频。\n\nFJ 希望为每个 MooTube 视频创建一个“推荐视频”列表。这样，奶牛将被推荐与他们已经观看过的视频最相关的视频。\n\nFJ 设计了一个“相关性”度量标准，顾名思义，它确定了两个视频相互之间的相关值。FJ 将他的视频建成一棵树（其中每个节点代表一条视频），并且计算了所有 $N-1$ 对相邻视频的相关值。这样任意视频都可以通过一条连通路径到达任意其他视频。FJ 决定将任意一对视频的相关值定义为沿此路径的任何连接的最小相关值。\n\nFarmer John 想要选择一个 $K$ 值，以便在任何给定的 MooTube 视频旁边，推荐所有其他与该视频相关值至少为 $K$ 的视频。然而，FJ 担心会向他的奶牛推荐太多的视频，这可能会分散他们对产奶的注意力！因此，他想设定适当的 $K$ 值。Farmer John 希望得到您的帮助，回答有关 $K$ 值的推荐视频的一些问题。", "inputFormat": "第一行输入包含 $N$ 和 $Q$（$1 \\leq Q \\leq 10^5$）。\n\n接下来的 $N-1$ 行描述了 FJ 手动比较的一对视频。 每行包括三个整数 $p_i$，$q_i$ 和 $r_i$（$1 \\leq p_i, q_i \\leq N$，$1 \\leq r_i \\leq 10^9$），表示视频 $p_i$ 和 $q_i$ 已连接并且相关值为 $r_i$。\n\n接下来的 $Q$ 行描述了 Farmer John 的 $Q$ 个问题。每行包含两个整数，$k_i$ 和 $v_i$（$1 \\leq k_i \\leq 10^9$，$1 \\leq v_i \\leq N$），表示 FJ 的第 $i$ 个问题询问中当 $K = k_i$ 时，第 $v_i$ 个视频推荐列表中将推荐的视频数。", "outputFormat": "输出 $Q$ 行。在第 $i$ 行，输出 FJ 的第 $i$ 个问题的答案。", "hint": null, "locale": "zh-CN"}}}
{"pid": "P4186", "type": "P", "difficulty": 5, "samples": [["7 1\n1 2\n1 3\n3 4\n3 5\n4 6\n5 7", "3"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2018", "USACO", "深度优先搜索 DFS"], "title": "[USACO18JAN] Cow at Large G", "background": "", "description": "Cornered at last, Bessie has gone to ground in a remote farm. The farm consists of $N$ barns ($2 \\leq N \\leq 10^5$) and $N-1$ bidirectional tunnels between barns, so that there is a unique path between every pair of barns. Every barn which has only one tunnel is an exit. When morning comes, Bessie will surface at some barn and attempt to reach an exit.\n\nBut the moment Bessie surfaces, the law will be able to pinpoint her location. Some farmers will then start at various exit barns, and attempt to catch Bessie. The farmers move at the same speed as Bessie (so in each time step, each farmer can move from one barn to an adjacent barn). The farmers know where Bessie is at all times, and Bessie knows where the farmers are at all times. The farmers catch Bessie if at any instant a farmer is in the same barn as Bessie, or crossing the same tunnel as Bessie. Conversely, Bessie escapes if she reaches an exit barn before any farms catch her.\n\n\nBessie is unsure about her chances of success, which depends on the number of farmers that the law is able to deploy. Given that Bessie surfaces at barn $K$, help Bessie determine the minimum number of farmers who would be needed to catch Bessie, assuming that the farmers distribute themselves optimally among the exit barns.\n", "inputFormat": "The first line of the input contains $N$ and $K$. Each of the following $N-1$ lines specify two integers, each in the range $1 \\ldots N$, describing a tunnel between two barns.\n", "outputFormat": "Please output the minimum number of farmers needed to ensure catching Bessie.\n", "hint": "", "locale": "en", "translations": {"en": {"title": "[USACO18JAN] Cow at Large G", "background": "", "description": "Cornered at last, Bessie has gone to ground in a remote farm. The farm consists of $N$ barns ($2 \\leq N \\leq 10^5$) and $N-1$ bidirectional tunnels between barns, so that there is a unique path between every pair of barns. Every barn which has only one tunnel is an exit. When morning comes, Bessie will surface at some barn and attempt to reach an exit.\n\nBut the moment Bessie surfaces, the law will be able to pinpoint her location. Some farmers will then start at various exit barns, and attempt to catch Bessie. The farmers move at the same speed as Bessie (so in each time step, each farmer can move from one barn to an adjacent barn). The farmers know where Bessie is at all times, and Bessie knows where the farmers are at all times. The farmers catch Bessie if at any instant a farmer is in the same barn as Bessie, or crossing the same tunnel as Bessie. Conversely, Bessie escapes if she reaches an exit barn before any farms catch her.\n\n\nBessie is unsure about her chances of success, which depends on the number of farmers that the law is able to deploy. Given that Bessie surfaces at barn $K$, help Bessie determine the minimum number of farmers who would be needed to catch Bessie, assuming that the farmers distribute themselves optimally among the exit barns.\n", "inputFormat": "The first line of the input contains $N$ and $K$. Each of the following $N-1$ lines specify two integers, each in the range $1 \\ldots N$, describing a tunnel between two barns.\n", "outputFormat": "Please output the minimum number of farmers needed to ensure catching Bessie.\n", "hint": "", "locale": "en"}, "zh-CN": {"title": "[USACO18JAN] Cow at Large G", "background": "", "description": "最后，Bessie 被迫去了一个远方的农场。这个农场包含 $N$ 个谷仓（$2 \\le N \\le 10^5$）和 $N-1$ 条连接两个谷仓的双向隧道，所以每两个谷仓之间都有唯一的路径。每个只与一条隧道相连的谷仓都是农场的出口。当早晨来临的时候，Bessie 将在某个谷仓露面，然后试图到达一个出口。\n\n但当 Bessie 露面的时候，她的位置就会暴露。一些农民在那时将从不同的出口谷仓出发尝试抓住 Bessie。农民和 Bessie 的移动速度相同（在每个单位时间内，每个农民都可以从一个谷仓移动到相邻的一个谷仓，同时 Bessie 也可以这么做）。农民们和 Bessie 总是知道对方在哪里。如果在任意时刻，某个农民和 Bessie 处于同一个谷仓或在穿过同一个隧道，农民就可以抓住 Bessie。反过来，如果 Bessie 在农民们抓住她之前到达一个出口谷仓，Bessie 就可以逃走。\n\nBessie 不确定她成功的机会，这取决于被雇佣的农民的数量。给定 Bessie 露面的谷仓K，帮助 Bessie 确定为了抓住她所需要的农民的最小数量。假定农民们会自己选择最佳的方案来安排他们出发的出口谷仓。", "inputFormat": "输入的第一行包含 $N$ 和 $K$。接下来的 $N - 1$ 行，每行有两个整数（在 $1\\sim N$ 范围内）描述连接两个谷仓的一条隧道。", "outputFormat": "输出为了确保抓住 Bessie 所需的农民的最小数量。\n\n由 @Marser 提供翻译", "hint": "", "locale": "zh-CN"}}}
{"pid": "P4187", "type": "P", "difficulty": 5, "samples": [["3 2 2", "6\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["动态规划 DP", "数学", "2018", "USACO", "排列组合"], "title": "[USACO18JAN] Stamp Painting G", "background": "", "description": "Bessie has found herself in possession of an $N$-unit long strip of canvas ($1 \\leq N \\leq 10^6$), and she intends to paint it. However, she has been unable to acquire paint brushes. In their place she has $M$ rubber stamps of different colors ($1 \\leq M \\leq 10^6$), each stamp $K$ units wide ($1 \\leq K \\leq 10^6$). Astounded by the possibilities that lie before her, she wishes to know exactly how many different paintings she could conceivably create, by stamping her stamps in some order on the canvas.\n\nTo use a stamp, it must first be aligned with exactly $K$ neighboring units on the canvas. The stamp cannot extend beyond the ends of the canvas, nor can it cover fractions of units. Once placed, the stamp paints the $K$ covered units with its color. Any given stamp may be used multiple times, once, or even never at all. But by the time Bessie is finished, every unit of canvas must have been painted at least once.\n\n\nHelp Bessie find the number of different paintings that she could paint, modulo $10^9 + 7$. Two paintings that look identical but were painted by different sequences of stamping operations are counted as the same.\n\n\nFor at least 75% of the input cases, $N,K \\leq 10^3$.\n", "inputFormat": "The first and only line of input has three integers, $N$, $M$, and $K$. It is guaranteed that $K \\leq N$.\n", "outputFormat": "A single integer: the number of possible paintings, modulo $10^9 + 7$.\n", "hint": "If the two stamps have colors A and B, the possible paintings are AAA, AAB, ABB, BAA, BBA, and BBB.\n", "locale": "en", "translations": {"en": {"title": "[USACO18JAN] Stamp Painting G", "background": "", "description": "Bessie has found herself in possession of an $N$-unit long strip of canvas ($1 \\leq N \\leq 10^6$), and she intends to paint it. However, she has been unable to acquire paint brushes. In their place she has $M$ rubber stamps of different colors ($1 \\leq M \\leq 10^6$), each stamp $K$ units wide ($1 \\leq K \\leq 10^6$). Astounded by the possibilities that lie before her, she wishes to know exactly how many different paintings she could conceivably create, by stamping her stamps in some order on the canvas.\n\nTo use a stamp, it must first be aligned with exactly $K$ neighboring units on the canvas. The stamp cannot extend beyond the ends of the canvas, nor can it cover fractions of units. Once placed, the stamp paints the $K$ covered units with its color. Any given stamp may be used multiple times, once, or even never at all. But by the time Bessie is finished, every unit of canvas must have been painted at least once.\n\n\nHelp Bessie find the number of different paintings that she could paint, modulo $10^9 + 7$. Two paintings that look identical but were painted by different sequences of stamping operations are counted as the same.\n\n\nFor at least 75% of the input cases, $N,K \\leq 10^3$.\n", "inputFormat": "The first and only line of input has three integers, $N$, $M$, and $K$. It is guaranteed that $K \\leq N$.\n", "outputFormat": "A single integer: the number of possible paintings, modulo $10^9 + 7$.\n", "hint": "If the two stamps have colors A and B, the possible paintings are AAA, AAB, ABB, BAA, BBA, and BBB.\n", "locale": "en"}, "zh-CN": {"title": "[USACO18JAN] Stamp Painting G", "background": null, "description": "Bessie 想拿 $M$ 种颜色的长为 $K$ 的图章涂一个长为 $N$ 的迷之画布。假设他选择涂一段区间，则这段区间长度必须为$K$，且涂完后该区间颜色全变成图章颜色。他可以随便涂，但是最后必须把画布画满。问能有多少种最终状态。$N\\leq 10^6,M\\leq 10^6,K\\leq 10^6$ 。\n\n对于 $75\\%$ 的数据，$N,K\\leq 10^3$。", "inputFormat": "一行三个整数 $N,M,K$。", "outputFormat": "一个整数表示答案（对 $10^9+7$ 取模）", "hint": "输入输出样例说明\n\n如果两个图章叫 A,B，合法方案如下:AAB,ABB,BAA,BBA,AAA,BBB。\n\nTranslated by @ComeIntoPower", "locale": "zh-CN"}}}
{"pid": "P4188", "type": "P", "difficulty": 5, "samples": [["3\n5 9\n1 4\n3 7", "7"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2018", "线段树", "USACO", "离散化", "枚举"], "title": "[USACO18JAN] Lifeguards S", "background": "", "description": "Farmer John has opened a swimming pool for his cows, figuring it will help them relax and produce more milk.\n\nTo ensure safety, he hires $N$ cows as lifeguards, each of which has a shift that covers some contiguous interval of time during the day. For simplicity, the pool is open from time $t=0$ until time $t = 1,000,000,000$ on a daily basis, so each shift can be described by two integers, giving the time at which a cow starts and ends her shift. For example, a lifeguard starting at time $t = 4$ and ending at time $t = 7$ covers three units of time (note that the endpoints are \"points\" in time).\n\n\nUnfortunately, Farmer John hired 1 more lifeguard than he has the funds to support. Given that he must fire exactly one lifeguard, what is the maximum amount of time that can still be covered by the shifts of the remaining lifeguards? An interval of time is covered if at least one lifeguard is present.\n", "inputFormat": "The first line of input contains $N$ ($1 \\leq N \\leq 100,000$). Each of the next $N$ lines describes a lifeguard in terms of two integers in the range $0 \\ldots 1,000,000,000$, giving the starting and ending point of a lifeguard's shift. All such endpoints are distinct. Shifts of different lifeguards might overlap.\n", "outputFormat": "Please write a single number, giving the maximum amount of time that can still be covered if Farmer John fires 1 lifeguard.\n", "hint": "", "locale": "en", "translations": {"en": {"title": "[USACO18JAN] Lifeguards S", "background": "", "description": "Farmer John has opened a swimming pool for his cows, figuring it will help them relax and produce more milk.\n\nTo ensure safety, he hires $N$ cows as lifeguards, each of which has a shift that covers some contiguous interval of time during the day. For simplicity, the pool is open from time $t=0$ until time $t = 1,000,000,000$ on a daily basis, so each shift can be described by two integers, giving the time at which a cow starts and ends her shift. For example, a lifeguard starting at time $t = 4$ and ending at time $t = 7$ covers three units of time (note that the endpoints are \"points\" in time).\n\n\nUnfortunately, Farmer John hired 1 more lifeguard than he has the funds to support. Given that he must fire exactly one lifeguard, what is the maximum amount of time that can still be covered by the shifts of the remaining lifeguards? An interval of time is covered if at least one lifeguard is present.\n", "inputFormat": "The first line of input contains $N$ ($1 \\leq N \\leq 100,000$). Each of the next $N$ lines describes a lifeguard in terms of two integers in the range $0 \\ldots 1,000,000,000$, giving the starting and ending point of a lifeguard's shift. All such endpoints are distinct. Shifts of different lifeguards might overlap.\n", "outputFormat": "Please write a single number, giving the maximum amount of time that can still be covered if Farmer John fires 1 lifeguard.\n", "hint": "", "locale": "en"}, "zh-CN": {"title": "[USACO18JAN] Lifeguards S", "background": "", "description": "FJ 为他的奶牛们建造了一个游泳池，FJ 认为这将有助于他们放松身心以及生产更多牛奶。\n\n为了确保奶牛们的安全，FJ 雇佣了 $N$ 头牛，作为泳池的救生员，每一个救生员在一天内都会有一定的事情，并且这些事情都会覆盖一天内的一段时间。为了简单起见，泳池从时间 $t=0$ 时开门，直到时间 $t=10^9$ 关门，所以每个事情都可以用两个整数来描述，给出奶牛救生员开始以及结束事情的时间。例如，一个救生员在时间 $t=4$ 时开始事情并且在时间 $t=7$ 时结束事情，那么这件事情就覆盖了 $3$ 个单位时间。（注意：结束时间是“点”的时间）\n\n不幸的是，FJ 多雇佣了一名的救生员，但他没有足够的资金来雇佣这些救生员。因此他必须解雇一名救生员，求可以覆盖剩余救生员的轮班时间的最大总量是多少？如果当时至少有一名救生员的事情已经开始，则这个时段被覆盖。", "inputFormat": "输入的第一行包括一个整数 $N\\ ( 1 \\le N \\le 100000)$。接下来 $N$ 行中，每行告诉了我们一个救生员在 $0 \\sim 10^9$ 范围内的开始以及结束时间。所有的结束时间都是不同的。不同的救生员的事情覆盖的时间可能会重叠。", "outputFormat": "输出一行一个整数，如果 FJ 解雇一名救生员仍能覆盖的最大时间。", "hint": "", "locale": "zh-CN"}}}
{"pid": "P4189", "type": "P", "difficulty": 7, "samples": [["3\n2 6 2\n0 1\n1 2\n", "8\n7\n8\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["2010", "CTSC/CTS"], "title": "[CTSC2010] 星际旅行", "background": "", "description": "公元$3000$年，地球联盟已经攻占了银河系内的$N$个星球，出于资金的考虑，政府仅仅在星球间建立了$N-1$条双向时空隧道保证任意两个星球之间互相可达。出于管理上的考虑，第$i$个星球的行政长官要求每个公民在一年内不得从该星球利用时空隧道次数超过$H_i$次（这一统计是基于离开次数统计的，如果你已经使用从该星球离开过$H_i$次，那么这一年内你就不能再使用时空隧道离开这个星球了）。Louis Paosen是一个星际旅行家，他希望能使用尽量多次的时空隧道，但又不希望最终被迫定居的星球条件太过恶劣。所以他希望能知道对于每个星球$i$，若从$0$号星球出发，最终以$i$号星球为终点，这样的星际旅行途中最多可以使用多少次时空隧道。\n", "inputFormat": "输入文件galaxy.in的第一行包含一个整数$N$。接下来的一行包含$N$个整数$H_i$，分别表示每个星球的离开次数限制。接下来$N-1$行每行两个整数，表示这两个星球之间有时空隧道连接。星球的编号从$0$开始，Louis Paosen一开始在$0$号星球。\n", "outputFormat": "输出文件为galaxy.out。文件包含$N$行，每行一个整数，表示如果最终旅行结束在这个星球，最多可以使用时空隧道的次数。\n", "hint": "$40 \\%$的数据$N \\leq 500$\n\n$100 \\%$的数据中$N \\leq 50000$。\n\n所有星球的离开次数限制满足$1 \\leq H_i \\leq 40000$，且每个星球的$H_i$大于等于与该星球直接相连的星球数（即度数）。\n", "locale": "zh-CN", "translations": {"en": {"title": "[CTSC2010] Interstellar Travel", "background": "", "description": "In the year $3000$, the Earth Union has conquered $N$ planets in the Milky Way. For budget reasons, the government built only $N-1$ bidirectional spacetime tunnels between planets to ensure that any two planets are mutually reachable. For administrative reasons, the governor of the $i$-th planet requires that each citizen must not use spacetime tunnels to leave that planet more than $H_i$ times within a year (this is counted by the number of departures; if you have already departed from that planet $H_i$ times, then you cannot leave that planet via a spacetime tunnel again within the same year).\n\nLouis Paosen is an interstellar traveler. He hopes to use spacetime tunnels as many times as possible, but he does not want to end up settling on a planet with overly harsh conditions. Therefore, he wants to know, for each planet $i$, if he starts from planet $0$ and finally ends his trip on planet $i$, what is the maximum number of spacetime tunnel uses possible along the journey.", "inputFormat": "The input file galaxy.in contains an integer $N$ on the first line.  \nThe second line contains $N$ integers $H_i$, representing the departure limit for each planet.  \nEach of the next $N-1$ lines contains two integers, indicating that there is a spacetime tunnel between these two planets.  \nPlanets are numbered from $0$, and Louis Paosen starts on planet $0$.", "outputFormat": "The output file is galaxy.out. It contains $N$ lines, each with one integer, where the integer on line $i$ is the maximum possible number of spacetime tunnel uses if the trip ends on planet $i$.", "hint": "For $40\\%$ of the testdata, $N \\leq 500$.  \n\nFor $100\\%$ of the testdata, $N \\leq 50000$.  \n\nAll departure limits satisfy $1 \\leq H_i \\leq 40000$, and each planet’s $H_i$ is greater than or equal to the number of planets directly connected to it (i.e., its degree).\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[CTSC2010] 星际旅行", "background": "", "description": "公元$3000$年，地球联盟已经攻占了银河系内的$N$个星球，出于资金的考虑，政府仅仅在星球间建立了$N-1$条双向时空隧道保证任意两个星球之间互相可达。出于管理上的考虑，第$i$个星球的行政长官要求每个公民在一年内不得从该星球利用时空隧道次数超过$H_i$次（这一统计是基于离开次数统计的，如果你已经使用从该星球离开过$H_i$次，那么这一年内你就不能再使用时空隧道离开这个星球了）。Louis Paosen是一个星际旅行家，他希望能使用尽量多次的时空隧道，但又不希望最终被迫定居的星球条件太过恶劣。所以他希望能知道对于每个星球$i$，若从$0$号星球出发，最终以$i$号星球为终点，这样的星际旅行途中最多可以使用多少次时空隧道。\n", "inputFormat": "输入文件galaxy.in的第一行包含一个整数$N$。接下来的一行包含$N$个整数$H_i$，分别表示每个星球的离开次数限制。接下来$N-1$行每行两个整数，表示这两个星球之间有时空隧道连接。星球的编号从$0$开始，Louis Paosen一开始在$0$号星球。\n", "outputFormat": "输出文件为galaxy.out。文件包含$N$行，每行一个整数，表示如果最终旅行结束在这个星球，最多可以使用时空隧道的次数。\n", "hint": "$40 \\%$的数据$N \\leq 500$\n\n$100 \\%$的数据中$N \\leq 50000$。\n\n所有星球的离开次数限制满足$1 \\leq H_i \\leq 40000$，且每个星球的$H_i$大于等于与该星球直接相连的星球数（即度数）。\n", "locale": "zh-CN"}}}
{"pid": "P4190", "type": "P", "difficulty": 5, "samples": [["3\n1.0 0.0 0.5\n0.5 1.0 1.0\n0.5 0.5 0.5\n\n0.5 0.5 1.0\n0.5 0.0 0.5\n0.5 0.5 0.5\n\n0.5 0.0 1.0\n0.5 0.5 0.5\n0.5 0.5 0.5 \n", "0.273438"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["2010", "CTSC/CTS"], "title": "[CTSC2010] 三国围棋擂台赛", "background": "", "description": "一年一度的“农心杯”三国围棋擂台赛是世界上最高水平的围棋比赛，也是中日韩三国围棋界最激动人心的较量。本题就是建立在这一比赛的规则之上。\n\n三国围棋擂台赛是三个国家的代表队之间的比赛，下面简要介绍一下比赛的规则：\n\n1. 不妨设三个国家分别为 $A$、$B$ 和 $C$，每个国家各有$n$名选手（在上述的实际比赛中$n = 5$），分别称其为$A_1$，$A_2$，…，$A_n$，$B_1$，$B_2$，…，$B_n$，$C_1$，$C_2$，…，$C_n$。\n\n2. 每场比赛都能分出胜负。每场比赛的负者遭到淘汰。\n\n3. 每队第一位出场的选手都已经确定为每队的第$n$位选手，即 $A_n$、$B_n$ 和 $C_n$。\n\n4. 通过抽签等概率地选出一支队伍。该队将在第一轮中轮空，而剩下的两支队伍的第 $n$ 位选手将进行第一场比赛。\n\n5. 第一场比赛的胜者（这里的胜者是指赢得该局比赛的选手，下同）与轮空队伍的第 $n$ 位选手进行第二场比赛。比如在第一场比赛中 $C_n$ 战胜了 $A_n$，则第二场则由$C_n$对阵$B_n$。\n\n6. 从第三场比赛开始，前一场比赛未参加的队伍将选出一个未被淘汰的选手与上一场比赛的胜者进行下一场比赛。\n\n7. 这个过程将一直进行，直到某个队伍的全部参赛选手都被淘汰为止。\n\n8. 当只有两支队伍的时候，每场比赛后，由负方选择一位未被淘汰的选手与胜者进行下一场比赛。\n\n9. 当两支队伍中的任意一队的全部选手均被淘汰后比赛结束，余下的那支队伍将获得农心杯。\n\n新一届的比赛就要开始了。你作为 $A$ 队的领队，在比赛开始前已经统计了这 $3n$ 位选手之间的胜率——即对于来自不同队伍的两个选手 $Q$ 和 $R$，我们已知 $Q$ 战胜 $R$ 的概率为 $p$（$0 \\leq p \\leq 1$），且$R$战胜 $Q$ 的概率为 $1-p$。\n\n由于你所在的国家实力超群，可以认为剩下的两只队伍都将矛头对准了你。$B$、$C$ 队的每个决策，即派出选手的顺序的目的都是使你所在的国家（$A$ 队）夺冠的概率尽可能小，而$A$队的决策的目的必然是使最后夺冠的概率尽可能大。你要做的事情就是计算出在这种极为不利的情况下，在三方都做出最优决策的前提下，$A$ 队夺冠的期望 $E_A$。\n\n关于期望的计算：设现在在场上比赛的人是 $Q$ 和 $R$，$Q$ 胜 $R$的概率为 $p$，则此时 $A$ 队胜率的期望\n\n$E_A = p$ × $E_1 + (1 - p)$ × $E_2$\n\n其中 $E_1$ 为 $Q$ 胜 $R$ 后 $A$ 队夺冠的期望，$E_2$ 为 $R$ 胜 $Q$ 后 $A$ 队夺冠的期望。$E_1$、$E_2$ 则同样使用上式递归计算。\n\n$A$ 队的决策会尽可能使这个期望尽可能大，而 $B$、$C$ 队则会使这个期望尽可能小。当 $B$、$C$ 队的全部选手都被淘汰后夺冠期望为 $1$，$A$ 队所有队员被淘汰后期望为 $0$。\n\n例如当每队有 $3$ 位参赛选手时，相互之间的胜率由如下的$3$ 个 $3\\times 3$ 的矩阵给出，其中矩阵中的每个数值$p$ 为所在行选手对于所在列选手的胜率，所在列选手对于所在行选手的胜率为 $1-p$。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/db2s8dim.png)\n\n三支队的第三位选手的水平相同，在第两局比赛后，三支队的选手获胜的概率是相同的。假设第二局获胜的是 $B_3$，第三局轮到 $A$ 队出场。这时我们可以派出 $A_1$ 和 $A_2$ 两种选择。\n\n如果派出 $A_2$，虽然第三局一定可以战胜 $B_3$（胜率为$100 \\%$），但是 $C$ 队会在第四场比赛中派出 $C_2$，$A_2$ 对于 $C_2$ 必败（胜率为 $0$），第五场中 $B$ 队会让 $B_1$ 出场，第六场 $A_1$ 只能出场，这时对 $A_1$ 必胜的 $B_2$ 还未登场，因此 $A_1$ 迟早会遭到淘汰，$A$ 队夺冠的概率就为 $0$。\n\n如果派出$A_1$，虽然本局对于 $B_3$ 比赛只有 $50 \\%$ 的胜率，但是夺冠的概率为 $6.25 \\%$；因此在第三场应该派出 $A_1$。\n\n根据第三场比赛的参赛选手的六种情况，最后夺冠的期望为：\n\n$$ \\dfrac{(6.25\\%+3.125\\%+18.75\\%+25\\%+60.9375\\%+50\\%)}{6} = 27.34375\\%$$\n", "inputFormat": "输入文件为 go.in。\n\n第一行包括一个整数 $n$，表示每队的选手数。\n\n第二行到第 $n + 1$ 行每行包含 $n$ 个实数，整体为一个$n\\times n$ 的矩阵，表示 $A$ 队对 $B$ 队的胜率。其中第$i + 1$ 行的第 $j$ 个数表示选手 $A_i$ 对选手 $B_j$ 时的胜率。\n\n第 $n + 2$ 行为空行。\n\n第 $n + 3$ 行到第 $2n + 2$ 行每行包含 $n$ 个实数，同样为一个 $n\\times n$ 的矩阵，表示 $A$ 队对 $C$ 队的胜率。其中第 $i + n + 2$ 行的第 $j$ 个数表示选手 $A_i$ 对选手 $C_j$ 时的胜率。\n\n第 $2n + 3$ 行为空行。\n\n第 $2n + 4$ 行到第 $3n + 3$ 行每行包含 $n$ 个实数，整体为一个 $n\\times n$ 的矩阵，表示 $B$ 队对 $C$ 队的胜率。其中第 $i + 2n + 3$ 行的第 $j$ 个数表示选手 $B_i$ 对选手 $C_j$ 时的胜率。\n", "outputFormat": "输出文件 go.out 仅包含一个实数，保留 $6$ 位小数，表示$A$队获得冠军的概率。\n", "hint": "$30\\%$ 的数据中，$n \\leq 4$。\n\n$40\\%$ 的数据中，$n \\leq 5$。\n\n$100\\%$ 的数据中，$n \\leq 7$。\n\n对于 $10\\%$ 的数据有三个胜率矩阵中，每个矩阵的元素都相同，但不同矩阵的数字可能不同。\n", "locale": "zh-CN", "translations": {"en": {"title": "[CTSC2010] Three-Nation Go Relay Tournament", "background": "", "description": "The annual “Nongshim Cup” three-nation Go relay tournament is the highest-level Go competition in the world and the most exciting contest among China, Japan, and Korea. This problem is based on the rules of that event.\n\nThe three-nation Go relay tournament is a match among national teams of three countries. The rules are briefly as follows:\n\n1. Let the three countries be $A$, $B$, and $C$. Each country has $n$ players (in the real event above, $n = 5$), named $A_1, A_2, \\ldots, A_n$, $B_1, B_2, \\ldots, B_n$, and $C_1, C_2, \\ldots, C_n$.\n\n2. Every game has a winner and a loser. The loser of a game is eliminated.\n\n3. The first player to appear for each team is fixed to be that team’s $n$-th player, i.e., $A_n$, $B_n$, and $C_n$.\n\n4. One team is drawn uniformly at random. That team has a bye in round 1, and the $n$-th players of the other two teams play the first game.\n\n5. The winner of the first game (the “winner” here always means the player who wins that game) plays the $n$-th player of the team that had the bye in the second game. For example, if $C_n$ defeats $A_n$ in the first game, then the second game is $C_n$ vs. $B_n$.\n\n6. From the third game onward, the team that did not participate in the previous game selects one not-yet-eliminated player to play against the previous game’s winner.\n\n7. This process continues until all players of some team have been eliminated.\n\n8. When only two teams remain, after each game, the losing side chooses one not-yet-eliminated player to play the next game against the winner.\n\n9. When all players of either of the two remaining teams are eliminated, the match ends, and the remaining team wins the Nongshim Cup.\n\nA new edition of the tournament is about to begin. As the leader of Team $A$, you have computed the win probabilities among all $3n$ players — that is, for any two players $Q$ and $R$ from different teams, we know that the probability that $Q$ defeats $R$ is $p$ ($0 \\leq p \\leq 1$), and the probability that $R$ defeats $Q$ is $1 - p$.\n\nSince your country is overwhelmingly strong, assume the other two teams will both target you. Every decision by Teams $B$ and $C$ — i.e., the order in which they send players — aims to minimize the probability that Team $A$ wins the title, while Team $A$’s decisions aim to maximize that probability. Your task is to compute, under this highly unfavorable scenario and assuming all three sides play optimally, the expected probability $E_A$ that Team $A$ wins the championship.\n\nAbout the expectation: suppose the current game is between players $Q$ and $R$, and $Q$ defeats $R$ with probability $p$. Then Team $A$’s winning expectation at this moment is\n$E_A = p \\times E_1 + (1 - p) \\times E_2$,\nwhere $E_1$ is the expectation that Team $A$ wins the title after $Q$ defeats $R$, and $E_2$ is the expectation after $R$ defeats $Q$. $E_1$ and $E_2$ are computed recursively using the same formula.\n\nTeam $A$’s decisions will maximize this expectation, while Teams $B$ and $C$ will minimize it. If all players of Teams $B$ and $C$ are eliminated, the expectation is $1$; if all players of Team $A$ are eliminated, the expectation is $0$.\n\nFor example, when each team has $3$ players, the head-to-head win probabilities are given by the following three $3\\times 3$ matrices. In each matrix, every value $p$ is the row player’s probability of defeating the column player, and the column player’s probability of defeating the row player is $1 - p$.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/db2s8dim.png)\n\nThe third players of the three teams are of equal strength. After the first two games, the probability that the current winner comes from any of the three teams is the same. Suppose the winner of the second game is $B_3$, and in the third game it is Team $A$’s turn to send a player. Team $A$ can choose between $A_1$ and $A_2$.\n\nIf we send $A_2$, although the third game is guaranteed to defeat $B_3$ (win probability $100 \\%$), Team $C$ will send $C_2$ in the fourth game, against whom $A_2$ surely loses (win probability $0$). In the fifth game, Team $B$ will send $B_1$, and in the sixth game only $A_1$ can be sent. Since $B_2$, who surely defeats $A_1$, has not yet appeared, $A_1$ will be eliminated sooner or later, and Team $A$’s winning probability is $0$.\n\nIf we send $A_1$, although the win probability against $B_3$ in this game is only $50 \\%$, the probability of winning the championship is $6.25 \\%$. Therefore, in the third game we should send $A_1$.\n\nConsidering the six possible pairs of players in the third game, the final expected championship probability is:\n$$ \\dfrac{(6.25\\%+3.125\\%+18.75\\%+25\\%+60.9375\\%+50\\%)}{6} = 27.34375\\%.$$", "inputFormat": "The input file is go.in.\n\nThe first line contains an integer $n$, the number of players on each team.\n\nLines $2$ to $n + 1$ each contain $n$ real numbers, forming an $n \\times n$ matrix that gives Team $A$’s win probabilities against Team $B$. In particular, on line $i + 1$, the $j$-th number is the probability that player $A_i$ defeats player $B_j$.\n\nLine $n + 2$ is a blank line.\n\nLines $n + 3$ to $2n + 2$ each contain $n$ real numbers, forming an $n \\times n$ matrix that gives Team $A$’s win probabilities against Team $C$. In particular, on line $i + n + 2$, the $j$-th number is the probability that player $A_i$ defeats player $C_j$.\n\nLine $2n + 3$ is a blank line.\n\nLines $2n + 4$ to $3n + 3$ each contain $n$ real numbers, forming an $n \\times n$ matrix that gives Team $B$’s win probabilities against Team $C$. In particular, on line $i + 2n + 3$, the $j$-th number is the probability that player $B_i$ defeats player $C_j$.", "outputFormat": "The output file go.out contains a single real number with $6$ decimal places, the probability that Team $A$ wins the championship.", "hint": "- For $30\\%$ of the testdata, $n \\leq 4$.\n- For $40\\%$ of the testdata, $n \\leq 5$.\n- For $100\\%$ of the testdata, $n \\leq 7$.\n- For $10\\%$ of the testdata, in each of the three win-probability matrices, every matrix has constant entries (all elements in a given matrix are the same), but different matrices may have different values.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[CTSC2010] 三国围棋擂台赛", "background": "", "description": "一年一度的“农心杯”三国围棋擂台赛是世界上最高水平的围棋比赛，也是中日韩三国围棋界最激动人心的较量。本题就是建立在这一比赛的规则之上。\n\n三国围棋擂台赛是三个国家的代表队之间的比赛，下面简要介绍一下比赛的规则：\n\n1. 不妨设三个国家分别为 $A$、$B$ 和 $C$，每个国家各有$n$名选手（在上述的实际比赛中$n = 5$），分别称其为$A_1$，$A_2$，…，$A_n$，$B_1$，$B_2$，…，$B_n$，$C_1$，$C_2$，…，$C_n$。\n\n2. 每场比赛都能分出胜负。每场比赛的负者遭到淘汰。\n\n3. 每队第一位出场的选手都已经确定为每队的第$n$位选手，即 $A_n$、$B_n$ 和 $C_n$。\n\n4. 通过抽签等概率地选出一支队伍。该队将在第一轮中轮空，而剩下的两支队伍的第 $n$ 位选手将进行第一场比赛。\n\n5. 第一场比赛的胜者（这里的胜者是指赢得该局比赛的选手，下同）与轮空队伍的第 $n$ 位选手进行第二场比赛。比如在第一场比赛中 $C_n$ 战胜了 $A_n$，则第二场则由$C_n$对阵$B_n$。\n\n6. 从第三场比赛开始，前一场比赛未参加的队伍将选出一个未被淘汰的选手与上一场比赛的胜者进行下一场比赛。\n\n7. 这个过程将一直进行，直到某个队伍的全部参赛选手都被淘汰为止。\n\n8. 当只有两支队伍的时候，每场比赛后，由负方选择一位未被淘汰的选手与胜者进行下一场比赛。\n\n9. 当两支队伍中的任意一队的全部选手均被淘汰后比赛结束，余下的那支队伍将获得农心杯。\n\n新一届的比赛就要开始了。你作为 $A$ 队的领队，在比赛开始前已经统计了这 $3n$ 位选手之间的胜率——即对于来自不同队伍的两个选手 $Q$ 和 $R$，我们已知 $Q$ 战胜 $R$ 的概率为 $p$（$0 \\leq p \\leq 1$），且$R$战胜 $Q$ 的概率为 $1-p$。\n\n由于你所在的国家实力超群，可以认为剩下的两只队伍都将矛头对准了你。$B$、$C$ 队的每个决策，即派出选手的顺序的目的都是使你所在的国家（$A$ 队）夺冠的概率尽可能小，而$A$队的决策的目的必然是使最后夺冠的概率尽可能大。你要做的事情就是计算出在这种极为不利的情况下，在三方都做出最优决策的前提下，$A$ 队夺冠的期望 $E_A$。\n\n关于期望的计算：设现在在场上比赛的人是 $Q$ 和 $R$，$Q$ 胜 $R$的概率为 $p$，则此时 $A$ 队胜率的期望\n\n$E_A = p$ × $E_1 + (1 - p)$ × $E_2$\n\n其中 $E_1$ 为 $Q$ 胜 $R$ 后 $A$ 队夺冠的期望，$E_2$ 为 $R$ 胜 $Q$ 后 $A$ 队夺冠的期望。$E_1$、$E_2$ 则同样使用上式递归计算。\n\n$A$ 队的决策会尽可能使这个期望尽可能大，而 $B$、$C$ 队则会使这个期望尽可能小。当 $B$、$C$ 队的全部选手都被淘汰后夺冠期望为 $1$，$A$ 队所有队员被淘汰后期望为 $0$。\n\n例如当每队有 $3$ 位参赛选手时，相互之间的胜率由如下的$3$ 个 $3\\times 3$ 的矩阵给出，其中矩阵中的每个数值$p$ 为所在行选手对于所在列选手的胜率，所在列选手对于所在行选手的胜率为 $1-p$。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/db2s8dim.png)\n\n三支队的第三位选手的水平相同，在第两局比赛后，三支队的选手获胜的概率是相同的。假设第二局获胜的是 $B_3$，第三局轮到 $A$ 队出场。这时我们可以派出 $A_1$ 和 $A_2$ 两种选择。\n\n如果派出 $A_2$，虽然第三局一定可以战胜 $B_3$（胜率为$100 \\%$），但是 $C$ 队会在第四场比赛中派出 $C_2$，$A_2$ 对于 $C_2$ 必败（胜率为 $0$），第五场中 $B$ 队会让 $B_1$ 出场，第六场 $A_1$ 只能出场，这时对 $A_1$ 必胜的 $B_2$ 还未登场，因此 $A_1$ 迟早会遭到淘汰，$A$ 队夺冠的概率就为 $0$。\n\n如果派出$A_1$，虽然本局对于 $B_3$ 比赛只有 $50 \\%$ 的胜率，但是夺冠的概率为 $6.25 \\%$；因此在第三场应该派出 $A_1$。\n\n根据第三场比赛的参赛选手的六种情况，最后夺冠的期望为：\n\n$$ \\dfrac{(6.25\\%+3.125\\%+18.75\\%+25\\%+60.9375\\%+50\\%)}{6} = 27.34375\\%$$\n", "inputFormat": "输入文件为 go.in。\n\n第一行包括一个整数 $n$，表示每队的选手数。\n\n第二行到第 $n + 1$ 行每行包含 $n$ 个实数，整体为一个$n\\times n$ 的矩阵，表示 $A$ 队对 $B$ 队的胜率。其中第$i + 1$ 行的第 $j$ 个数表示选手 $A_i$ 对选手 $B_j$ 时的胜率。\n\n第 $n + 2$ 行为空行。\n\n第 $n + 3$ 行到第 $2n + 2$ 行每行包含 $n$ 个实数，同样为一个 $n\\times n$ 的矩阵，表示 $A$ 队对 $C$ 队的胜率。其中第 $i + n + 2$ 行的第 $j$ 个数表示选手 $A_i$ 对选手 $C_j$ 时的胜率。\n\n第 $2n + 3$ 行为空行。\n\n第 $2n + 4$ 行到第 $3n + 3$ 行每行包含 $n$ 个实数，整体为一个 $n\\times n$ 的矩阵，表示 $B$ 队对 $C$ 队的胜率。其中第 $i + 2n + 3$ 行的第 $j$ 个数表示选手 $B_i$ 对选手 $C_j$ 时的胜率。\n", "outputFormat": "输出文件 go.out 仅包含一个实数，保留 $6$ 位小数，表示$A$队获得冠军的概率。\n", "hint": "$30\\%$ 的数据中，$n \\leq 4$。\n\n$40\\%$ 的数据中，$n \\leq 5$。\n\n$100\\%$ 的数据中，$n \\leq 7$。\n\n对于 $10\\%$ 的数据有三个胜率矩阵中，每个矩阵的元素都相同，但不同矩阵的数字可能不同。\n", "locale": "zh-CN"}}}
{"pid": "P4191", "type": "P", "difficulty": 7, "samples": [["4 1\n1 2 3 4\n4 3 3 1\n", "2\n1\n0\n2\n"]], "limits": {"time": [6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["2010", "分治", "素数判断,质数,筛法", "快速傅里叶变换 FFT", "CTSC/CTS"], "title": "[CTSC2010] 性能优化", "background": "", "description": "程序员小明正在开发一套大型软件，软件中有一段核心程序，用伪代码描述如下（假设所有变量初值均为 $0$，并且假定其中的数据类型均不会出现溢出）： \n\n~~~cpp\nInput a[0], a[1], ... , a[n - 1], b[0], b[1], ... , b[n - 1], C\nFor i: 0 to n - 1\n\tx[0, i] = a[i]\nFor i: 0 to C - 1\n\tFor j: 0 to n - 1\n\t\tFor k: 0 to n - 1\n\t\t\tx[i + 1, (j + k) mod n] = x[i + 1, (j + k) mod n] + b[k]x[i, j]\nOutput x[C, 0] mod (n + 1), x[C, 1] mod (n + 1), ... , x[C, n - 1] mod (n + 1)\n~~~\n\n但是，这段程序的效率非常低，它的时间复杂度高达 $\\Theta(n^2C)$。他想让你帮忙优化一下这个程序，当然要求输出相同的结果。为了使问题更简单，他保证输入的 $n$ 能表示成若干个不超过 $10$ 的正整数的乘积，并且 $n + 1$ 是质数。", "inputFormat": "规范起见，以下将下标统一写到数组名称的右下角。例如： $a_1$ 对应伪代码中的 `a[1]`，$x_{C, 0}$ 对应伪代码中的 `x[C, 0]`。\n\n输入的第一行包含两个非负整数 $n, C$。\n\n接下来一行包含 $n$ 个非负整数 $a_0, a_1, \\cdots , a_{n - 1}$。\n\n接下来一行包含 $n$ 个非负整数 $b_0, b_1, \\cdots , b_{n - 1}$。", "outputFormat": "输出包含 $n$ 行，每行包含一个数。第 $i$ 行为 $x_{C, i}\\bmod (n + 1)$ 的值。你需要保证输出的数在 $0 \\sim n$ 之间。", "hint": "总共 $10$ 个测试点，数据范围满足：\n\n| 测试点 |         $n$          |     $C$     |\n| :----: | :------------------: | :---------: |\n|   1    |      $\\leq 100$      | $\\leq 100$  |\n|   2    |      $\\leq 100$      | $\\leq 10^9$ |\n|   3    |      $\\leq 700$      | $\\leq 10^9$ |\n|   4    |      $\\leq 700$      | $\\leq 10^9$ |\n|   5    |     $\\leq 10^4$      |   $ = 1$    |\n|   6    |     $\\leq 10^5$      |    $= 1$    |\n|   7    |     $\\leq 10^5$      |    $= 1$    |\n|   8    | $\\leq 5 \\times 10^5$ | $\\leq 10^9$ |\n|   9    | $\\leq 5 \\times 10^5$ | $\\leq 10^9$ |\n|   10   | $\\leq 5 \\times 10^5$ | $\\leq 10^9$ |\n\n在所有输入数据中，$a_i$ 和 $b_i$ 均不超过 $10^9$。", "locale": "zh-CN", "translations": {"en": {"title": "[CTSC2010] Performance Optimization", "background": "# Description\n\nProgrammer Xiao Ming is developing a large software system. There is a core routine described by the following pseudocode (assume all variables are initially $0$, and that none of the data types will overflow):\n\n~~~cpp\nInput a[0], a[1], ... , a[n - 1], b[0], b[1], ... , b[n - 1], C\nFor i: 0 to n - 1\n\tx[0, i] = a[i]\nFor i: 0 to C - 1\n\tFor j: 0 to n - 1\n\t\tFor k: 0 to n - 1\n\t\t\tx[i + 1, (j + k) mod n] = x[i + 1, (j + k) mod n] + b[k]x[i, j]\nOutput x[C, 0] mod (n + 1), x[C, 1] mod (n + 1), ... , x[C, n - 1] mod (n + 1)\n~~~\n\nHowever, this program is very inefficient; its time complexity is $\\Theta(n^2 C)$. He wants you to optimize this program while producing the same output. To make the problem easier, he guarantees that the input $n$ can be written as a product of some positive integers, each no greater than $10$, and that $n + 1$ is prime.", "description": "", "inputFormat": "", "outputFormat": "Output contains $n$ lines, one number per line. The $i$-th line is the value of $x_{C, i} \\bmod (n + 1)$. You should ensure each printed number is between $0$ and $n$ inclusive.", "hint": "There are $10$ test points in total. Constraints:\n\n| Test Point |         $n$          |     $C$     |\n| :--------: | :------------------: | :---------: |\n|     1      |      $\\leq 100$      | $\\leq 100$  |\n|     2      |      $\\leq 100$      | $\\leq 10^9$ |\n|     3      |      $\\leq 700$      | $\\leq 10^9$ |\n|     4      |      $\\leq 700$      | $\\leq 10^9$ |\n|     5      |     $\\leq 10^4$      |   $ = 1$    |\n|     6      |     $\\leq 10^5$      |    $= 1$    |\n|     7      |     $\\leq 10^5$      |    $= 1$    |\n|     8      | $\\leq 5 \\times 10^5$ | $\\leq 10^9$ |\n|     9      | $\\leq 5 \\times 10^5$ | $\\leq 10^9$ |\n|     10     | $\\leq 5 \\times 10^5$ | $\\leq 10^9$ |\n\nIn all testdata, $a_i$ and $b_i$ do not exceed $10^9$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[CTSC2010] 性能优化", "background": "", "description": "程序员小明正在开发一套大型软件，软件中有一段核心程序，用伪代码描述如下（假设所有变量初值均为 $0$，并且假定其中的数据类型均不会出现溢出）： \n\n~~~cpp\nInput a[0], a[1], ... , a[n - 1], b[0], b[1], ... , b[n - 1], C\nFor i: 0 to n - 1\n\tx[0, i] = a[i]\nFor i: 0 to C - 1\n\tFor j: 0 to n - 1\n\t\tFor k: 0 to n - 1\n\t\t\tx[i + 1, (j + k) mod n] = x[i + 1, (j + k) mod n] + b[k]x[i, j]\nOutput x[C, 0] mod (n + 1), x[C, 1] mod (n + 1), ... , x[C, n - 1] mod (n + 1)\n~~~\n\n但是，这段程序的效率非常低，它的时间复杂度高达 $\\Theta(n^2C)$。他想让你帮忙优化一下这个程序，当然要求输出相同的结果。为了使问题更简单，他保证输入的 $n$ 能表示成若干个不超过 $10$ 的正整数的乘积，并且 $n + 1$ 是质数。", "inputFormat": "规范起见，以下将下标统一写到数组名称的右下角。例如： $a_1$ 对应伪代码中的 `a[1]`，$x_{C, 0}$ 对应伪代码中的 `x[C, 0]`。\n\n输入的第一行包含两个非负整数 $n, C$。\n\n接下来一行包含 $n$ 个非负整数 $a_0, a_1, \\cdots , a_{n - 1}$。\n\n接下来一行包含 $n$ 个非负整数 $b_0, b_1, \\cdots , b_{n - 1}$。", "outputFormat": "输出包含 $n$ 行，每行包含一个数。第 $i$ 行为 $x_{C, i}\\bmod (n + 1)$ 的值。你需要保证输出的数在 $0 \\sim n$ 之间。", "hint": "总共 $10$ 个测试点，数据范围满足：\n\n| 测试点 |         $n$          |     $C$     |\n| :----: | :------------------: | :---------: |\n|   1    |      $\\leq 100$      | $\\leq 100$  |\n|   2    |      $\\leq 100$      | $\\leq 10^9$ |\n|   3    |      $\\leq 700$      | $\\leq 10^9$ |\n|   4    |      $\\leq 700$      | $\\leq 10^9$ |\n|   5    |     $\\leq 10^4$      |   $ = 1$    |\n|   6    |     $\\leq 10^5$      |    $= 1$    |\n|   7    |     $\\leq 10^5$      |    $= 1$    |\n|   8    | $\\leq 5 \\times 10^5$ | $\\leq 10^9$ |\n|   9    | $\\leq 5 \\times 10^5$ | $\\leq 10^9$ |\n|   10   | $\\leq 5 \\times 10^5$ | $\\leq 10^9$ |\n\n在所有输入数据中，$a_i$ 和 $b_i$ 均不超过 $10^9$。", "locale": "zh-CN"}}}
{"pid": "P4192", "type": "P", "difficulty": 6, "samples": [["5\n1 8 -8 3 -7\n3\n1 1 5\n0 1 3 6\n1 2 4", "9\n22"]], "limits": {"time": [4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["树状数组", "前缀和", "分块"], "title": "旅行规划", "background": null, "description": "OIVillage 是一个风景秀美的乡村，为了更好的利用当地的旅游资源，吸引游客，推动经济发展，xkszltl 决定修建了一条铁路将当地 $n$ 个最著名的景点连接起来，让游客可以通过火车从铁路起点（1 号景点）出发，依次游览每个景区。为了更好的评价这条铁路，xkszltl 为每一个景区都赋予了一个美观度，而一条旅行路径的价值就是它所经过的景区的美观度之和。不过，随着天气与季节的变化，某些景点的美观度也会发生变化。\n\nxkszltl 希望为每位旅客提供最佳的旅行指导，但是由于游客的时间有限，不一定能游览全部景区，然而他们也不希望旅途过于短暂，所以每个游客都希望能在某一个区间内的车站结束旅程，而 xkszltl 的任务就是为他们选择一个终点使得旅行线路的价值最大。可是当地的景点与前来观光的旅客实在是太多了，xkszltl 无法及时完成任务，于是找到了准备虐杀 NOI2011 的你，希望你能帮助他完成这个艰巨的任务。", "inputFormat": "第一行给出一个整数 $n$，接下来一行给出 $n$ 个景区的初始美观度。\n\n第三行给出一个整数 $m$，接下来 $m$ 行每行为一条指令：\n\n1. `0 x y k`：表示将 $x$ 到 $y$ 这段铁路边上的景区的美观度加上k；\n\n2. `1 x y`：表示有一名旅客想要在 $x$ 到 $y$ 这段（含 $x$ 与 $y$）中的某一站下车，你需要告诉他最大的旅行价值。", "outputFormat": "对于每个询问，输出一个整数表示最大的旅行价值。", "hint": "$1\\le n,m \\le 100000$\n\n$1\\le x\\le y\\le n$\n\n$|a_i|,|k|\\le 10^9$", "locale": "zh-CN", "translations": {"en": {"title": "Travel Planning", "background": "", "description": "OIVillage is a beautiful village. To better use its tourism resources, attract visitors, and boost the economy, xkszltl decided to build a railway connecting the $n$ most famous scenic spots so that tourists can take the train from the railway’s starting point (scenic spot 1) and visit each spot in order. To better evaluate this railway, xkszltl assigns each scenic spot a beauty value, and the value of a travel route is the sum of the beauty values of the scenic spots it passes through. However, as weather and seasons change, the beauty of some spots may change as well.\n\nxkszltl hopes to provide the best travel guidance for every tourist. Because tourists have limited time, they may not be able to visit all spots, but they also do not want the trip to be too short. Therefore, each tourist wants to end their trip at some station within a certain interval, and xkszltl’s task is to choose an endpoint for them so that the travel route’s value is maximized. However, there are simply too many scenic spots and too many tourists, so xkszltl cannot finish in time and turns to you—who is aiming to ace NOI 2011—for help with this challenging task.", "inputFormat": "- The first line contains an integer $n$. The next line contains $n$ integers, the initial beauty of each scenic spot.\n- The third line contains an integer $m$. The next $m$ lines each describe one instruction:\n  1. `0 x y k`: Add $k$ to the beauty of every scenic spot from $x$ to $y$.\n  2. `1 x y`: One tourist wants to get off at some station in the interval $[x, y]$ (inclusive). You must tell them the maximum travel value.\n\nThe traveler always starts from scenic spot 1 and visits spots in order.", "outputFormat": "For each query, output one integer: the maximum travel value.", "hint": "$1 \\le n, m \\le 100000$.\n\n$1 \\le x \\le y \\le n$.\n\n$|a_i|, |k| \\le 10^9$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "旅行规划", "background": null, "description": "OIVillage 是一个风景秀美的乡村，为了更好的利用当地的旅游资源，吸引游客，推动经济发展，xkszltl 决定修建了一条铁路将当地 $n$ 个最著名的景点连接起来，让游客可以通过火车从铁路起点（1 号景点）出发，依次游览每个景区。为了更好的评价这条铁路，xkszltl 为每一个景区都赋予了一个美观度，而一条旅行路径的价值就是它所经过的景区的美观度之和。不过，随着天气与季节的变化，某些景点的美观度也会发生变化。\n\nxkszltl 希望为每位旅客提供最佳的旅行指导，但是由于游客的时间有限，不一定能游览全部景区，然而他们也不希望旅途过于短暂，所以每个游客都希望能在某一个区间内的车站结束旅程，而 xkszltl 的任务就是为他们选择一个终点使得旅行线路的价值最大。可是当地的景点与前来观光的旅客实在是太多了，xkszltl 无法及时完成任务，于是找到了准备虐杀 NOI2011 的你，希望你能帮助他完成这个艰巨的任务。", "inputFormat": "第一行给出一个整数 $n$，接下来一行给出 $n$ 个景区的初始美观度。\n\n第三行给出一个整数 $m$，接下来 $m$ 行每行为一条指令：\n\n1. `0 x y k`：表示将 $x$ 到 $y$ 这段铁路边上的景区的美观度加上k；\n\n2. `1 x y`：表示有一名旅客想要在 $x$ 到 $y$ 这段（含 $x$ 与 $y$）中的某一站下车，你需要告诉他最大的旅行价值。", "outputFormat": "对于每个询问，输出一个整数表示最大的旅行价值。", "hint": "$1\\le n,m \\le 100000$\n\n$1\\le x\\le y\\le n$\n\n$|a_i|,|k|\\le 10^9$", "locale": "zh-CN"}}}
{"pid": "P4193", "type": "P", "difficulty": 4, "samples": [["3\n1 5\n3 9\n8 8", "2\n2\n0"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["数论"], "title": "数字", "background": null, "description": "小 D 喜欢的数有这样的性质：\n\n令 $n$ 为正整数，$S(n)$ 为 $n$ 的各位数字之和，令\n\n$$D(n)\\begin{cases}\\displaystyle S(n) \\quad S(n)<10 \\\\\\displaystyle D(S(n)) \\quad S(n)>10\\end{cases}$$\n\n小 D 喜欢的数一定能表示成 $x \\times D(x)$ 这种形式（即若一个数 $A$ 是被喜欢的，则存在一个数 $x$，使得 $A = x \\times D(x)$）。\n\n小 D 想知道在区间 $[L, R]$ 中，有多少个数是他喜欢的。", "inputFormat": "第一行一个整数 $T$，表示数据组数。\n\n接下来 $T$ 行，每行两个数 $L$、$R$（保证区间合法），代表询问 $[L, R]$。", "outputFormat": "输出 $T$ 行，每行一个数，表示在这个区间内小 D 喜欢的数出现了多少次。\n\n你的输出当且仅当和标准输出一样才能得该测试点满分。", "hint": "对于 $100 \\%$ 的数据，$L,R \\le 10^{18}$，$T \\le 20$。", "locale": "zh-CN", "translations": {"en": {"title": "Numbers", "background": "", "description": "Xiao D's favorite numbers have the following property.\n\nLet $n$ be a positive integer, let $S(n)$ be the sum of the digits of $n$, and define $D(n)$ as follows.\n$$\nD(n) = \\begin{cases}\n\\displaystyle S(n) & S(n) < 10 \\\\\n\\displaystyle D(S(n)) & S(n) > 10\n\\end{cases}\n$$\nEvery number that Xiao D likes can be written in the form $x \\times D(x)$ (that is, if a number $A$ is liked, then there exists a number $x$ such that $A = x \\times D(x)$).\n\nXiao D wants to know how many numbers he likes in the interval $[L, R]$.", "inputFormat": "The first line contains an integer $T$, the number of test cases.\n\nThe next $T$ lines each contain two numbers $L$ and $R$ (the interval is guaranteed to be valid), representing the query $[L, R]$.", "outputFormat": "Output $T$ lines, each with a single number, indicating how many numbers Xiao D likes appear in this interval.\n\nYou will receive full score for a test point if and only if your output exactly matches the standard output.", "hint": "For $100\\%$ of the testdata, $L, R \\le 10^{18}$ and $T \\le 20$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "数字", "background": null, "description": "小 D 喜欢的数有这样的性质：\n\n令 $n$ 为正整数，$S(n)$ 为 $n$ 的各位数字之和，令\n\n$$D(n)\\begin{cases}\\displaystyle S(n) \\quad S(n)<10 \\\\\\displaystyle D(S(n)) \\quad S(n)>10\\end{cases}$$\n\n小 D 喜欢的数一定能表示成 $x \\times D(x)$ 这种形式（即若一个数 $A$ 是被喜欢的，则存在一个数 $x$，使得 $A = x \\times D(x)$）。\n\n小 D 想知道在区间 $[L, R]$ 中，有多少个数是他喜欢的。", "inputFormat": "第一行一个整数 $T$，表示数据组数。\n\n接下来 $T$ 行，每行两个数 $L$、$R$（保证区间合法），代表询问 $[L, R]$。", "outputFormat": "输出 $T$ 行，每行一个数，表示在这个区间内小 D 喜欢的数出现了多少次。\n\n你的输出当且仅当和标准输出一样才能得该测试点满分。", "hint": "对于 $100 \\%$ 的数据，$L,R \\le 10^{18}$，$T \\le 20$。", "locale": "zh-CN"}}}
{"pid": "P4194", "type": "P", "difficulty": 6, "samples": [["2 2\n0 1\n2 1\n0 1", "1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": [], "title": "矩阵", "background": "", "description": "给定一个整数矩阵 $A[n\\times m]$，求一个矩阵 $B[n\\times m]$，满足 $\\forall 1\\le i\\le n,1\\le j\\le m,B_{i,j}\\in[L,R]$，且使下式值最小：\n\n$$\\max\\begin{cases}\\displaystyle\\max_{1\\le j\\le m}\\left\\{\\left|\\sum_{i=1}^n\\left(A_{i,j}-B_{i,j}\\right)\\right|\\right\\}\\\\\\displaystyle\\max_{1\\le i\\le n}\\left\\{\\left|\\sum_{j=1}^m\\left(A_{i,j}-B_{i,j}\\right)\\right|\\right\\}\\end{cases}$$", "inputFormat": "第一行两个整数 $n$，$m$，表示矩阵的大小。\n\n接下来 $n$ 行，每行 $m$ 个整数，描述矩阵 $A$。\n\n最后一行有两个整数 $L$，$R$。", "outputFormat": "输出一行一个整数代表答案。", "hint": "对于 $100\\%$ 的数据满足 $n,m\\le200$，$0\\le L\\le R\\le1000$，$0\\le A_{i,j}\\le1000$。", "locale": "zh-CN", "translations": {"en": {"title": "Matrix", "background": "", "description": "Given an integer matrix $A[n\\times m]$, find a matrix $B[n\\times m]$ such that $\\forall 1\\le i\\le n,1\\le j\\le m,B_{i,j}\\in[L,R]$, and minimize the following value.\n\n$$\\max\\begin{cases}\\displaystyle\\max_{1\\le j\\le m}\\left\\{\\left|\\sum_{i=1}^n\\left(A_{i,j}-B_{i,j}\\right)\\right|\\right\\}\\\\\\displaystyle\\max_{1\\le i\\le n}\\left\\{\\left|\\sum_{j=1}^m\\left(A_{i,j}-B_{i,j}\\right)\\right|\\right\\}\\end{cases}$$", "inputFormat": "The first line contains two integers $n$ and $m$, the size of the matrix.\n\nEach of the next $n$ lines contains $m$ integers, describing matrix $A$.\n\nThe last line contains two integers $L$ and $R$.", "outputFormat": "Output one line with a single integer representing the answer.", "hint": "Constraints: For 100% of the testdata, $n, m \\le 200$, $0 \\le L \\le R \\le 1000$, $0 \\le A_{i,j} \\le 1000$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "矩阵", "background": "", "description": "给定一个整数矩阵 $A[n\\times m]$，求一个矩阵 $B[n\\times m]$，满足 $\\forall 1\\le i\\le n,1\\le j\\le m,B_{i,j}\\in[L,R]$，且使下式值最小：\n\n$$\\max\\begin{cases}\\displaystyle\\max_{1\\le j\\le m}\\left\\{\\left|\\sum_{i=1}^n\\left(A_{i,j}-B_{i,j}\\right)\\right|\\right\\}\\\\\\displaystyle\\max_{1\\le i\\le n}\\left\\{\\left|\\sum_{j=1}^m\\left(A_{i,j}-B_{i,j}\\right)\\right|\\right\\}\\end{cases}$$", "inputFormat": "第一行两个整数 $n$，$m$，表示矩阵的大小。\n\n接下来 $n$ 行，每行 $m$ 个整数，描述矩阵 $A$。\n\n最后一行有两个整数 $L$，$R$。", "outputFormat": "输出一行一个整数代表答案。", "hint": "对于 $100\\%$ 的数据满足 $n,m\\le200$，$0\\le L\\le R\\le1000$，$0\\le A_{i,j}\\le1000$。", "locale": "zh-CN"}}}
{"pid": "P4195", "type": "P", "difficulty": 6, "samples": [["5 58 33\n2 4 3\n0 0 0", "9\nNo Solution"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["O2优化", "枚举", "素数判断,质数,筛法", "分块", "大步小步算法 BSGS", "模板题"], "title": "【模板】扩展 BSGS / exBSGS", "background": "题目来源：SPOJ3105 Mod", "description": "给定 $a,p,b$，求满足 $a^x≡b \\pmod p$ 的最小自然数 $x$ 。\n", "inputFormat": "每个测试文件中包含若干组测试数据，保证 $\\sum \\sqrt p\\le 5\\times 10^6$。\n\n每组数据中，每行包含 $3$ 个正整数 $a,p,b$ 。\n\n当 $a=p=b=0$ 时，表示测试数据读入完全。\n", "outputFormat": "对于每组数据，输出一行。\n\n如果无解，输出 `No Solution`，否则输出最小自然数解。\n", "hint": "对于 $100\\%$ 的数据，$1\\le a,p,b≤10^9$ 或 $a=p=b=0$。\n\n2021/5/14 加强 by [SSerxhs](https://www.luogu.com.cn/user/29826)。  \n2021/7/1 新添加[一组 Hack 数据](https://www.luogu.com.cn/discuss/391666)。", "locale": "zh-CN", "translations": {"en": {"title": "[Template] Extended BSGS / exBSGS", "background": "Source: SPOJ3105 Mod.", "description": "Given $a,p,b$, find the smallest non-negative integer $x$ such that $a^x≡b \\pmod p$.", "inputFormat": "Each test file contains several test cases, with the guarantee that $\\sum \\sqrt p\\le 5\\times 10^6$.\n\nEach test case consists of one line with $3$ positive integers $a,p,b$.\n\nWhen $a=p=b=0$, it indicates the end of input.", "outputFormat": "For each test case, output one line.\n\nIf there is no solution, output `No Solution`. Otherwise, output the smallest non-negative integer solution.", "hint": "For $100\\%$ of the testdata, $1\\le a,p,b\\le 10^9$ or $a=p=b=0$.\n\n2021/5/14 strengthened by [SSerxhs](https://www.luogu.com.cn/user/29826).  \n2021/7/1 added [a set of hack testdata](https://www.luogu.com.cn/discuss/391666).\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】扩展 BSGS / exBSGS", "background": "题目来源：SPOJ3105 Mod", "description": "给定 $a,p,b$，求满足 $a^x≡b \\pmod p$ 的最小自然数 $x$ 。\n", "inputFormat": "每个测试文件中包含若干组测试数据，保证 $\\sum \\sqrt p\\le 5\\times 10^6$。\n\n每组数据中，每行包含 $3$ 个正整数 $a,p,b$ 。\n\n当 $a=p=b=0$ 时，表示测试数据读入完全。\n", "outputFormat": "对于每组数据，输出一行。\n\n如果无解，输出 `No Solution`，否则输出最小自然数解。\n", "hint": "对于 $100\\%$ 的数据，$1\\le a,p,b≤10^9$ 或 $a=p=b=0$。\n\n2021/5/14 加强 by [SSerxhs](https://www.luogu.com.cn/user/29826)。  \n2021/7/1 新添加[一组 Hack 数据](https://www.luogu.com.cn/discuss/391666)。", "locale": "zh-CN"}}}
{"pid": "P4196", "type": "P", "difficulty": 6, "samples": [["2\n6\n-2 0\n-1 -2\n1 -2\n2 0\n1 2\n-1 2\n4\n0 -3\n1 -1\n2 2\n-1 0", "5.233"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2006", "重庆", "各省省选", "排序", "向量", "栈", "队列", "半平面交", "模板题"], "title": "【模板】半平面交 / [CQOI2006] 凸多边形", "background": "", "description": "逆时针给出 $n$ 个凸多边形的顶点坐标，求它们交的面积。例如 $n=2$ 时，两个凸多边形如下图：\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/7ieux7g3.png)\n\n则相交部分的面积为 $5.233$。", "inputFormat": "第一行有一个整数 $n$，表示凸多边形的个数，以下依次描述各个多边形。第 $i$ 个多边形的第一行包含一个整数 $m_i$，表示多边形的边数，以下 $m_i$ 行每行两个整数，逆时针给出各个顶点的坐标。", "outputFormat": "输出文件仅包含一个实数，表示相交部分的面积，保留三位小数。", "hint": "对于 $100\\%$ 的数据：$2 \\leq n \\leq 10$，$3 \\leq m_i \\leq 50$，每维坐标为 $[-1000,1000]$ 内的整数。", "locale": "zh-CN", "translations": {"en": {"title": "【Template】Half-Plane Intersection / [CQOI2006] Convex Polygon", "background": "", "description": "Given $n$ convex polygons with vertices listed in counterclockwise order, find the area of their intersection. For example, when $n = 2$, the two convex polygons are shown below:\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/7ieux7g3.png)\n\nThe area of the intersection is $5.233$.", "inputFormat": "The first line contains an integer $n$, the number of convex polygons. Each polygon is then described in order. For the $i$-th polygon, the first line contains an integer $m_i$, the number of edges. The next $m_i$ lines each contain two integers, giving the coordinates of the vertices in counterclockwise order.", "outputFormat": "Output a single real number, the area of the intersection, rounded to three decimal places.", "hint": "Constraints: For $100\\%$ of the testdata: $2 \\leq n \\leq 10$, $3 \\leq m_i \\leq 50$, and each coordinate is an integer in $[-1000, 1000]$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】半平面交 / [CQOI2006] 凸多边形", "background": "", "description": "逆时针给出 $n$ 个凸多边形的顶点坐标，求它们交的面积。例如 $n=2$ 时，两个凸多边形如下图：\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/7ieux7g3.png)\n\n则相交部分的面积为 $5.233$。", "inputFormat": "第一行有一个整数 $n$，表示凸多边形的个数，以下依次描述各个多边形。第 $i$ 个多边形的第一行包含一个整数 $m_i$，表示多边形的边数，以下 $m_i$ 行每行两个整数，逆时针给出各个顶点的坐标。", "outputFormat": "输出文件仅包含一个实数，表示相交部分的面积，保留三位小数。", "hint": "对于 $100\\%$ 的数据：$2 \\leq n \\leq 10$，$3 \\leq m_i \\leq 50$，每维坐标为 $[-1000,1000]$ 内的整数。", "locale": "zh-CN"}}}
{"pid": "P4197", "type": "P", "difficulty": 6, "samples": [["10 11 4\n1 2 3 4 5 6 7 8 9 10\n1 4 4\n2 5 3\n9 8 2\n7 8 10\n7 1 4\n6 7 1\n6 4 8\n2 1 5\n10 8 10\n3 4 7\n3 4 6\n1 5 2\n1 5 6\n1 5 8\n8 9 2", "6\n1\n-1\n8\n"]], "limits": {"time": [2000, 2000, 2000, 2000], "memory": [2097152, 2097152, 2097152, 2097152]}, "tags": ["2010", "倍增", "Kruskal 重构树", "生成树", "可持久化线段树"], "title": "[ONTAK2010] Peaks", "background": null, "description": "在 Bytemountains 有 $n$ 座山峰，每座山峰有他的高度 $h_i$。有些山峰之间有双向道路相连，共 $m$ 条路径，每条路径有一个困难值，这个值越大表示越难走。\n\n现在有 $q$ 组询问，每组询问询问从点 $v$ 开始只经过困难值小于等于 $x$ 的路径所能到达的山峰中第 $k$ 高的山峰，如果无解输出 $-1$。", "inputFormat": "第一行三个数 $n,m,q$。第二行 $n$ 个数，第 $i$ 个数为 $h_i$。\n\n接下来 $m$ 行，每行三个整数 $a,b,c$，表示从 $a \\to b$ 有一条困难值为 $c$ 的双向路径。\n\n接下来 $q$ 行，每行三个数 $v,x,k$，表示一组询问。", "outputFormat": "对于每组询问，输出一个整数表示能到达的山峰中第 $k$ 高的山峰的高度。", "hint": "### 数据规模与约定\n对于 $100\\%$ 的数据，$1 \\le v,k \\le n \\le 10^5$，$1 \\le m,q \\le 5\\times 10^5$，$1 \\le h_i,c,x \\le 10^9$。", "locale": "zh-CN", "translations": {"en": {"title": "[ONTAK2010] Peaks", "background": "", "description": "In Bytemountains, there are $n$ peaks, and each peak has its height $h_i$. Some pairs of peaks are connected by bidirectional roads; there are $m$ roads in total. Each road has a difficulty value, and a larger value means it is harder to traverse.\n\nThere are $q$ queries. For each query, starting from vertex $v$, you may only traverse roads whose difficulty is less than or equal to $x$. Among all peaks reachable this way, find the $k$-th highest peak. If there is no such peak, output $-1$.", "inputFormat": "The first line contains three integers $n, m, q$. The second line contains $n$ integers, where the $i$-th is $h_i$.\n\nThe next $m$ lines each contain three integers $a, b, c$, indicating there is a bidirectional road between $a$ and $b$ with difficulty $c$.\n\nThe next $q$ lines each contain three integers $v, x, k$, describing a query.", "outputFormat": "For each query, output a single integer: the height of the $k$-th highest reachable peak.", "hint": "Constraints  \nFor $100\\%$ of the testdata, $1 \\le v, k \\le n \\le 10^5$, $1 \\le m, q \\le 5 \\times 10^5$, $1 \\le h_i, c, x \\le 10^9$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[ONTAK2010] Peaks", "background": null, "description": "在 Bytemountains 有 $n$ 座山峰，每座山峰有他的高度 $h_i$。有些山峰之间有双向道路相连，共 $m$ 条路径，每条路径有一个困难值，这个值越大表示越难走。\n\n现在有 $q$ 组询问，每组询问询问从点 $v$ 开始只经过困难值小于等于 $x$ 的路径所能到达的山峰中第 $k$ 高的山峰，如果无解输出 $-1$。", "inputFormat": "第一行三个数 $n,m,q$。第二行 $n$ 个数，第 $i$ 个数为 $h_i$。\n\n接下来 $m$ 行，每行三个整数 $a,b,c$，表示从 $a \\to b$ 有一条困难值为 $c$ 的双向路径。\n\n接下来 $q$ 行，每行三个数 $v,x,k$，表示一组询问。", "outputFormat": "对于每组询问，输出一个整数表示能到达的山峰中第 $k$ 高的山峰的高度。", "hint": "### 数据规模与约定\n对于 $100\\%$ 的数据，$1 \\le v,k \\le n \\le 10^5$，$1 \\le m,q \\le 5\\times 10^5$，$1 \\le h_i,c,x \\le 10^9$。", "locale": "zh-CN"}}}
{"pid": "P4198", "type": "P", "difficulty": 6, "samples": [["3 4\n2 4\n3 6\n1 1000000000\n1 1", "1\n1\n1\n2"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["线段树", "递归", "分块"], "title": "楼房重建", "background": "", "description": "小 A 的楼房外有一大片施工工地，工地上有 $N$ 栋待建的楼房。每天，这片工地上的房子拆了又建、建了又拆。他经常无聊地看着窗外发呆，数自己能够看到多少栋房子。\n\n为了简化问题，我们考虑这些事件发生在一个二维平面上。小 A 在平面上 $(0,0)$ 点的位置，第 $i$ 栋楼房可以用一条连接 $(i,0)$ 和 $(i,H_i)$ 的线段表示，其中 $H_i$ 为第 $i$ 栋楼房的高度。如果这栋楼房上存在一个高度大于 $0$ 的点与 $(0,0)$ 的连线没有与之前的线段相交，那么这栋楼房就被认为是可见的。\n\n施工队的建造总共进行了 $M$ 天。初始时，所有楼房都还没有开始建造，它们的高度均为 $0$。在第 $i$ 天，建筑队将会将横坐标为 $X_i$ 的房屋的高度变为 $Y_i$（高度可以比原来大—修建，也可以比原来小—拆除，甚至可以保持不变—建筑队这天什么事也没做）。请你帮小 A 数数每天在建筑队完工之后，他能看到多少栋楼房？", "inputFormat": "第一行两个正整数 $N,M$。\n\n接下来 $M$ 行，每行两个正整数 $X_i,Y_i$。", "outputFormat": "$M$ 行，第 $i$ 行一个整数表示第 $i$ 天过后小 A 能看到的楼房有多少栋。", "hint": "对于 $100\\%$ 的数据，$1 \\le X_i \\le N$，$1 \\le Y_i \\le 10^9$，$1\\le N,M \\le 10^5$。", "locale": "zh-CN", "translations": {"en": {"title": "Building Reconstruction", "background": "", "description": "Outside Xiao A’s building is a large construction site with $N$ buildings under construction. Every day, buildings on this site are torn down and rebuilt, over and over. He often stares out the window, counting how many buildings he can see.\n\nTo simplify, we consider the events in a 2D plane. Xiao A is at point $(0, 0)$. The $i$-th building is represented by a line segment connecting $(i, 0)$ and $(i, H_i)$, where $H_i$ is the height of the $i$-th building. A building is considered visible if there exists a point on it with height greater than $0$ such that the line segment from $(0, 0)$ to that point does not intersect any of the segments of buildings $1, 2, \\dots, i-1$.\n\nThe construction lasts for $M$ days. Initially, all buildings have height $0$. On day $i$, the crew sets the height of the building with $x$-coordinate $X_i$ to $Y_i$ (the height may increase — construction, decrease — demolition, or remain unchanged — meaning the crew effectively did nothing that day). After the crew finishes each day, please tell how many buildings Xiao A can see.", "inputFormat": "The first line contains two positive integers $N, M$.\n\nThe next $M$ lines each contain two positive integers $X_i, Y_i$.", "outputFormat": "Output $M$ lines. On the $i$-th line, output one integer denoting the number of buildings visible to Xiao A after day $i$.", "hint": "For $100\\%$ of the testdata, $1 \\le X_i \\le N$, $1 \\le Y_i \\le 10^9$, $1 \\le N, M \\le 10^5$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "楼房重建", "background": "", "description": "小 A 的楼房外有一大片施工工地，工地上有 $N$ 栋待建的楼房。每天，这片工地上的房子拆了又建、建了又拆。他经常无聊地看着窗外发呆，数自己能够看到多少栋房子。\n\n为了简化问题，我们考虑这些事件发生在一个二维平面上。小 A 在平面上 $(0,0)$ 点的位置，第 $i$ 栋楼房可以用一条连接 $(i,0)$ 和 $(i,H_i)$ 的线段表示，其中 $H_i$ 为第 $i$ 栋楼房的高度。如果这栋楼房上存在一个高度大于 $0$ 的点与 $(0,0)$ 的连线没有与之前的线段相交，那么这栋楼房就被认为是可见的。\n\n施工队的建造总共进行了 $M$ 天。初始时，所有楼房都还没有开始建造，它们的高度均为 $0$。在第 $i$ 天，建筑队将会将横坐标为 $X_i$ 的房屋的高度变为 $Y_i$（高度可以比原来大—修建，也可以比原来小—拆除，甚至可以保持不变—建筑队这天什么事也没做）。请你帮小 A 数数每天在建筑队完工之后，他能看到多少栋楼房？", "inputFormat": "第一行两个正整数 $N,M$。\n\n接下来 $M$ 行，每行两个正整数 $X_i,Y_i$。", "outputFormat": "$M$ 行，第 $i$ 行一个整数表示第 $i$ 天过后小 A 能看到的楼房有多少栋。", "hint": "对于 $100\\%$ 的数据，$1 \\le X_i \\le N$，$1 \\le Y_i \\le 10^9$，$1\\le N,M \\le 10^5$。", "locale": "zh-CN"}}}
