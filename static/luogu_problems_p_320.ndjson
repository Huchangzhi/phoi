{"pid": "P7480", "type": "P", "difficulty": 5, "samples": [["3 5 10\n10 5\n2 4\n1 7", "19\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["O2优化"], "title": "Reboot from Blue", "background": "YSGHYYDS", "description": "数轴上有 $n$ 个加油站，第 $i$ 个位于 $x_i$，油价是每升 $c_i$ 元。\n\nYSGH 和他的车一开始位于坐标 $s$，它想去坐标 $t$（$s < t$），车的油箱一开始是空的，保证坐标 $s$ 有加油站。\n\n假设车的油箱容量无限大，一升油能走距离 $1$。\n\n他想知道他需要花费的最小费用。", "inputFormat": "第一行，三个整数 $n, s, t$，意义同题面描述。\n\n接下来 $n$ 行，每行两个整数 $c_i, x_i$，分别表示第 $i$ 个加油站的油价和坐标。", "outputFormat": "仅一行，一个整数，表示答案。", "hint": "**【样例解释】**\n\n最优方案是在第一个加油站加 $1$ 升油到第二个加油站。\n\n在第二个加油站加 $3$ 升油到第三个加油站。\n\n在第三个加油站加 $3$ 升油到终点。\n\n答案是 $10 + 2 \\times 3 + 1 \\times 3 = 19$。\n\n---\n\n**【数据范围】**\n\n**本题采用捆绑测试。**\n\n对于 $100 \\%$ 的数据，$1 \\le n \\le {10}^5$，$-{10}^9 \\le x_i, s, t \\le {10}^9$，$1 \\le c_i \\le {10}^9$，$s < t$，保证坐标 $s$ 有加油站。\n\n- Subtask 1（10 points）：$n \\le 20$。\n- Subtask 2（30 points）：$n \\le 5000$。\n- Subtask 3（20 points）：$c_i$ 在 $[1, {10}^9]$ 中等概率随机。\n- Subtask 4（40 points）：无特殊限制。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "Reboot from Blue", "background": "YSGHYYDS", "description": "数轴上有 $n$ 个加油站，第 $i$ 个位于 $x_i$，油价是每升 $c_i$ 元。\n\nYSGH 和他的车一开始位于坐标 $s$，它想去坐标 $t$（$s < t$），车的油箱一开始是空的，保证坐标 $s$ 有加油站。\n\n假设车的油箱容量无限大，一升油能走距离 $1$。\n\n他想知道他需要花费的最小费用。", "inputFormat": "第一行，三个整数 $n, s, t$，意义同题面描述。\n\n接下来 $n$ 行，每行两个整数 $c_i, x_i$，分别表示第 $i$ 个加油站的油价和坐标。", "outputFormat": "仅一行，一个整数，表示答案。", "hint": "**【样例解释】**\n\n最优方案是在第一个加油站加 $1$ 升油到第二个加油站。\n\n在第二个加油站加 $3$ 升油到第三个加油站。\n\n在第三个加油站加 $3$ 升油到终点。\n\n答案是 $10 + 2 \\times 3 + 1 \\times 3 = 19$。\n\n---\n\n**【数据范围】**\n\n**本题采用捆绑测试。**\n\n对于 $100 \\%$ 的数据，$1 \\le n \\le {10}^5$，$-{10}^9 \\le x_i, s, t \\le {10}^9$，$1 \\le c_i \\le {10}^9$，$s < t$，保证坐标 $s$ 有加油站。\n\n- Subtask 1（10 points）：$n \\le 20$。\n- Subtask 2（30 points）：$n \\le 5000$。\n- Subtask 3（20 points）：$c_i$ 在 $[1, {10}^9]$ 中等概率随机。\n- Subtask 4（40 points）：无特殊限制。", "locale": "zh-CN"}}}
{"pid": "P7481", "type": "P", "difficulty": 6, "samples": [["3 3", "7"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["O2优化"], "title": "梦现时刻", "background": "", "description": "给定 $n,m$ ，保证 $m\\le n$，令 $F(a,b)=\\sum_{i=0}^{b}\\binom{b}{i}\\binom{n-i}{a}$。\n\n求 $\\bigoplus_{a=1}^{m}\\bigoplus_{b=1}^{m}(F(a,b) \\bmod 998244353)$。\n\n其中 $\\oplus$ 表示异或运算。", "inputFormat": "第一行两个整数 $n,m$，意义同题面描述。", "outputFormat": "一行一个整数表示答案。", "hint": "**【数据范围】**\n\n**本题采用捆绑测试。**\n\n对于 $100 \\%$ 的数据，$1 \\le n \\le {10}^9$，$1\\le m\\le 5000$，保证 $m\\le n$\n\n- Subtask 1（20 points）：$n \\le 500$。\n- Subtask 2（30 points）：$n \\le 5000$。\n- Subtask 3（50 points）：无特殊限制。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "梦现时刻", "background": "", "description": "给定 $n,m$ ，保证 $m\\le n$，令 $F(a,b)=\\sum_{i=0}^{b}\\binom{b}{i}\\binom{n-i}{a}$。\n\n求 $\\bigoplus_{a=1}^{m}\\bigoplus_{b=1}^{m}(F(a,b) \\bmod 998244353)$。\n\n其中 $\\oplus$ 表示异或运算。", "inputFormat": "第一行两个整数 $n,m$，意义同题面描述。", "outputFormat": "一行一个整数表示答案。", "hint": "**【数据范围】**\n\n**本题采用捆绑测试。**\n\n对于 $100 \\%$ 的数据，$1 \\le n \\le {10}^9$，$1\\le m\\le 5000$，保证 $m\\le n$\n\n- Subtask 1（20 points）：$n \\le 500$。\n- Subtask 2（30 points）：$n \\le 5000$。\n- Subtask 3（50 points）：无特殊限制。", "locale": "zh-CN"}}}
{"pid": "P7482", "type": "P", "difficulty": 6, "samples": [["3\n1 2 4", "18"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["O2优化"], "title": "不条理狂诗曲", "background": "YSGHYYDS", "description": "YSGH 有一个长度为 $n$ 的非负整数序列 $a$，定义 $f(l, r)$ 表示从 $a$ 序列的区间 $[l, r]$ 选择若干不相邻的数的和的最大值。 \n\nYSGH 想知道 $\\displaystyle \\left[ \\sum_{l = 1}^{n} \\sum_{r = l}^{n} f(l, r) \\right] \\bmod ({10}^9 + 7)$ 。", "inputFormat": "第一行，一个正整数 $n$，表示序列长度。\n\n第二行，$n$ 个非负整数 $a_1, a_2, \\ldots , a_n$。", "outputFormat": "仅一行，一个整数，表示答案。", "hint": "**【样例解释】**\n\n$f(1, 1)=1$，$f(1, 2)=2$，$f(1, 3)=5$，$f(2, 2)=2$，$f(2, 3)=4$，$f(3, 3)=4$。\n\n答案为 $1 + 2 + 5 + 2 + 4 + 4 = 18$。\n\n---\n\n**【数据范围】**\n\n对于 $100 \\%$ 的数据，$1 \\le n \\le {10}^5$，$0 \\le a_i \\le {10}^9$。\n\n- Subtask 1（10 points）：$n \\le 500$。\n- Subtask 2（20 points）：$n \\le 5000$。\n- Subtask 3（20 points）：$a_i \\in \\{ 0, 1 \\}$。\n- Subtask 4（20 points）：$a_i \\in \\{ 1, x \\}$，$x$ 是大于 $1$ 的整数。\n- Subtask 5（30 points）：无特殊限制。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "不条理狂诗曲", "background": "YSGHYYDS", "description": "YSGH 有一个长度为 $n$ 的非负整数序列 $a$，定义 $f(l, r)$ 表示从 $a$ 序列的区间 $[l, r]$ 选择若干不相邻的数的和的最大值。 \n\nYSGH 想知道 $\\displaystyle \\left[ \\sum_{l = 1}^{n} \\sum_{r = l}^{n} f(l, r) \\right] \\bmod ({10}^9 + 7)$ 。", "inputFormat": "第一行，一个正整数 $n$，表示序列长度。\n\n第二行，$n$ 个非负整数 $a_1, a_2, \\ldots , a_n$。", "outputFormat": "仅一行，一个整数，表示答案。", "hint": "**【样例解释】**\n\n$f(1, 1)=1$，$f(1, 2)=2$，$f(1, 3)=5$，$f(2, 2)=2$，$f(2, 3)=4$，$f(3, 3)=4$。\n\n答案为 $1 + 2 + 5 + 2 + 4 + 4 = 18$。\n\n---\n\n**【数据范围】**\n\n对于 $100 \\%$ 的数据，$1 \\le n \\le {10}^5$，$0 \\le a_i \\le {10}^9$。\n\n- Subtask 1（10 points）：$n \\le 500$。\n- Subtask 2（20 points）：$n \\le 5000$。\n- Subtask 3（20 points）：$a_i \\in \\{ 0, 1 \\}$。\n- Subtask 4（20 points）：$a_i \\in \\{ 1, x \\}$，$x$ 是大于 $1$ 的整数。\n- Subtask 5（30 points）：无特殊限制。", "locale": "zh-CN"}}}
{"pid": "P7483", "type": "P", "difficulty": 6, "samples": [["5 2 1\n346 412\n464 685\n895 544\n976 322\n612 121\n346 712 2\n850 932 3\n", "4068\n"], ["5 2 2\n346 412\n464 685\n895 544\n976 322\n612 121\n233 749 798465123\n698 985 151455772\n", "105133973"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["动态规划 DP", "O2优化", "动态规划优化", "组合数学", "二项式定理", "容斥原理"], "title": "50 年后的我们", "background": "YSGHYYDS", "description": "YSGH 给一场比赛出了 $n$ 道题，第 $i$ 道题的难度为 $d_i$，价值为 $c_i$。\n\n有 $m$ 个可能参赛的选手。第 $i$ 个选手有 $p_i$ 的概率会参加比赛。若第 $i$ 个选手参加比赛，则该选手会恰好通过难度在 $l_i$ 到 $r_i$ 之间（包括 $l_i$ 和 $r_i$）的所有题目。\n\n比赛组委会最终给 YSGH 的奖金为所有题中，有选手通过的题的价值之和的 $k$ 次幂。特别地，我们定义 $0$ 的 $0$ 次幂等于 $1$。\n\nYSGH 想让你帮他求出奖金的期望。\n\n令 $P=998244353$，设一个有理数 $x$ 表示成最简分数的形式为 $\\frac{a}{b}$，若 $\\gcd(b,P)=1$，则存在唯一的整数 $c$（$0 \\le c < P$）满足 $b c \\equiv a \\pmod{P}$，我们称 $x$ 在模 $P$ 意义下的值为 $c$。\n\n可以证明，在仅给出 $p_i$ 模 $P$ 意义下的值时，答案仍然在模 $P$ 意义下唯一存在。", "inputFormat": "第一行，三个整数 $n,m,k$，表示题目数量，可能参赛的人数，以及计算奖金需要的参数。\n\n接下来 $n$ 行，第 $i$ 行两个整数 $d_i, c_i$，分别表示第 $i$ 道题的难度和价值。\n\n接下来 $m$ 行，第 $i$ 行三个整数 $l_i, r_i, p_i$，分别表示第 $i$ 个选手通过的题的难度区间，以及来参加比赛的概率在模 $P$ 意义下的值。", "outputFormat": "一行，一个整数，表示奖金的期望在模 $P$ 意义下的值。", "hint": "**【样例解释 \\#1】**\n\n该样例满足特殊性质 A。\n\n第一个人若参赛，可以通过第 $1,2,5$ 题。\n\n第二个人若参赛，可以通过第 $3$ 题。\n\n所以 YSGH 的奖金期望为 $(412+685+121)\\times 2\\times (1-3)+544\\times (1-2)\\times 3+(412+685+121+544)\\times 2\\times 3\\equiv 4068\\pmod{P}$。\n\n---\n\n**【数据范围】**\n\n**本题采用捆绑测试。**\n\n对于 $100\\%$ 的数据，$1\\le n\\le 400$，$0\\le k\\le 400$，$1\\le m\\le 10^5$，$1\\le d_i\\le 10^9$，$1\\le l_i\\le r_i\\le 10^9$，$0\\le c_i,p_i < 998244353$。\n\n各 Subtask 的特殊限制与分值如下：\n\n| 测试包编号 | $n\\le $ | $k\\le $ | 其他限制 | 分值 |\n| :----------: | :----------: | :----------: | :----------: | :----------: |\n| $1$ | $400$ | $1$ | 特殊性质 A | $5$ |\n| $2$ | $400$ | $1$ | 无 | $6$ |\n| $3$ | $400$ | $2$ | 特殊性质 A | $7$ |\n| $4$ | $400$ | $2$ | 无 | $8$ |\n| $6$ | $18$ | $100$ | 特殊性质 A | $3$ |\n| $5$ | $18$ | $100$ | 无 | $15$ |\n| $7$ | $100$ | $100$ | 特殊性质 A | $9$ |\n| $8$ | $100$ | $100$ | 无 | $16$ |\n| $9$ | $400$ | $400$ | 特殊性质 A | $10$ |\n| $10$ | $400$ | $400$ | 无 | $21$ |\n\n特殊性质 A：对于任意 $1\\le i < j\\le M$，都有 $[l_i,r_i]\\cap [l_j,r_j]=\\varnothing$。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "50 年后的我们", "background": "YSGHYYDS", "description": "YSGH 给一场比赛出了 $n$ 道题，第 $i$ 道题的难度为 $d_i$，价值为 $c_i$。\n\n有 $m$ 个可能参赛的选手。第 $i$ 个选手有 $p_i$ 的概率会参加比赛。若第 $i$ 个选手参加比赛，则该选手会恰好通过难度在 $l_i$ 到 $r_i$ 之间（包括 $l_i$ 和 $r_i$）的所有题目。\n\n比赛组委会最终给 YSGH 的奖金为所有题中，有选手通过的题的价值之和的 $k$ 次幂。特别地，我们定义 $0$ 的 $0$ 次幂等于 $1$。\n\nYSGH 想让你帮他求出奖金的期望。\n\n令 $P=998244353$，设一个有理数 $x$ 表示成最简分数的形式为 $\\frac{a}{b}$，若 $\\gcd(b,P)=1$，则存在唯一的整数 $c$（$0 \\le c < P$）满足 $b c \\equiv a \\pmod{P}$，我们称 $x$ 在模 $P$ 意义下的值为 $c$。\n\n可以证明，在仅给出 $p_i$ 模 $P$ 意义下的值时，答案仍然在模 $P$ 意义下唯一存在。", "inputFormat": "第一行，三个整数 $n,m,k$，表示题目数量，可能参赛的人数，以及计算奖金需要的参数。\n\n接下来 $n$ 行，第 $i$ 行两个整数 $d_i, c_i$，分别表示第 $i$ 道题的难度和价值。\n\n接下来 $m$ 行，第 $i$ 行三个整数 $l_i, r_i, p_i$，分别表示第 $i$ 个选手通过的题的难度区间，以及来参加比赛的概率在模 $P$ 意义下的值。", "outputFormat": "一行，一个整数，表示奖金的期望在模 $P$ 意义下的值。", "hint": "**【样例解释 \\#1】**\n\n该样例满足特殊性质 A。\n\n第一个人若参赛，可以通过第 $1,2,5$ 题。\n\n第二个人若参赛，可以通过第 $3$ 题。\n\n所以 YSGH 的奖金期望为 $(412+685+121)\\times 2\\times (1-3)+544\\times (1-2)\\times 3+(412+685+121+544)\\times 2\\times 3\\equiv 4068\\pmod{P}$。\n\n---\n\n**【数据范围】**\n\n**本题采用捆绑测试。**\n\n对于 $100\\%$ 的数据，$1\\le n\\le 400$，$0\\le k\\le 400$，$1\\le m\\le 10^5$，$1\\le d_i\\le 10^9$，$1\\le l_i\\le r_i\\le 10^9$，$0\\le c_i,p_i < 998244353$。\n\n各 Subtask 的特殊限制与分值如下：\n\n| 测试包编号 | $n\\le $ | $k\\le $ | 其他限制 | 分值 |\n| :----------: | :----------: | :----------: | :----------: | :----------: |\n| $1$ | $400$ | $1$ | 特殊性质 A | $5$ |\n| $2$ | $400$ | $1$ | 无 | $6$ |\n| $3$ | $400$ | $2$ | 特殊性质 A | $7$ |\n| $4$ | $400$ | $2$ | 无 | $8$ |\n| $6$ | $18$ | $100$ | 特殊性质 A | $3$ |\n| $5$ | $18$ | $100$ | 无 | $15$ |\n| $7$ | $100$ | $100$ | 特殊性质 A | $9$ |\n| $8$ | $100$ | $100$ | 无 | $16$ |\n| $9$ | $400$ | $400$ | 特殊性质 A | $10$ |\n| $10$ | $400$ | $400$ | 无 | $21$ |\n\n特殊性质 A：对于任意 $1\\le i < j\\le M$，都有 $[l_i,r_i]\\cap [l_j,r_j]=\\varnothing$。", "locale": "zh-CN"}}}
{"pid": "P7484", "type": "P", "difficulty": 7, "samples": [["4 4\n1 2\n2 3\n3 4\n1 2 3 4\n10 2 3 7\n2 5 6 1\n5 1 7 2", "30\n"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["O2优化"], "title": "再生之青", "background": "YSGHYYDS", "description": "YSGH 有一个大小为 $n$ 的树和一个长度为 $m$ 的序列。\n\n树上每个点 $i$ 有颜色 $c_i$ 和价值 $a_i$，颜色两两不同，**保证叶子个数不超过** $\\boldsymbol{20}$。\n\n序列第 $i$ 个位置也有一个颜色 $d_i$ 和价值 $b_i$，颜色也两两不同（但树和序列颜色可能会相同）。\n\nYSGH 想从树上选一条链和序列的一个区间满足一个颜色最多只能出现一次，他想知道他能选出来的最大的价值和。", "inputFormat": "第一行，两个正整数 $n, m$，分别表示树的大小和序列长度。\n\n接下来 $n - 1$ 行，每行两个正整数 $x, y$，表示树上的一条边。\n\n接下来一行，每行 $n$ 个正整数，第 $i$ 个表示 $c_i$。\n\n接下来一行，每行 $n$ 个正整数，第 $i$ 个表示 $a_i$。\n\n接下来一行，每行 $m$ 个正整数，第 $i$ 个表示 $d_i$。\n\n接下来一行，每行 $m$ 个正整数，第 $i$ 个表示 $b_i$。", "outputFormat": "仅一行，一个整数，表示答案。", "hint": "**【样例解释】**\n\n最优方案是选择树的 $1, 2, 3, 4$ 号节点和序列的第 $2, 3$ 个位置。\n\n价值和是 $10 + 2 + 3 + 7 + 1 + 7 = 30$。\n\n---\n\n**【数据范围】**\n\n**本题采用捆绑测试。**\n\n对于 $100 \\%$ 的数据，$1 \\le n \\le 5 \\times {10}^4$，$1 \\le m \\le 5 \\times {10}^5$，$1 \\le c_i, d_i \\le n + m$，$1 \\le a_i, b_i \\le {10}^9$，保证树的叶子个数不超过 $20$。\n\n+ Subtask 1（10 points）: $n, m \\le 500$。 \n+ Subtask 2（10 points）: $n, m \\le 1000$。 \n+ Subtask 3（10 points）: $n, m \\le 5000$。 \n+ Subtask 4（20 points）: 满足树的第 $i$ 条边连接的是 $i$ 和 $i + 1$。 \n+ Subtask 5（15 points）: $m \\le {10}^5$。\n+ Subtask 6（35 points）: 无特殊限制。 ", "locale": "zh-CN", "translations": {"zh-CN": {"title": "再生之青", "background": "YSGHYYDS", "description": "YSGH 有一个大小为 $n$ 的树和一个长度为 $m$ 的序列。\n\n树上每个点 $i$ 有颜色 $c_i$ 和价值 $a_i$，颜色两两不同，**保证叶子个数不超过** $\\boldsymbol{20}$。\n\n序列第 $i$ 个位置也有一个颜色 $d_i$ 和价值 $b_i$，颜色也两两不同（但树和序列颜色可能会相同）。\n\nYSGH 想从树上选一条链和序列的一个区间满足一个颜色最多只能出现一次，他想知道他能选出来的最大的价值和。", "inputFormat": "第一行，两个正整数 $n, m$，分别表示树的大小和序列长度。\n\n接下来 $n - 1$ 行，每行两个正整数 $x, y$，表示树上的一条边。\n\n接下来一行，每行 $n$ 个正整数，第 $i$ 个表示 $c_i$。\n\n接下来一行，每行 $n$ 个正整数，第 $i$ 个表示 $a_i$。\n\n接下来一行，每行 $m$ 个正整数，第 $i$ 个表示 $d_i$。\n\n接下来一行，每行 $m$ 个正整数，第 $i$ 个表示 $b_i$。", "outputFormat": "仅一行，一个整数，表示答案。", "hint": "**【样例解释】**\n\n最优方案是选择树的 $1, 2, 3, 4$ 号节点和序列的第 $2, 3$ 个位置。\n\n价值和是 $10 + 2 + 3 + 7 + 1 + 7 = 30$。\n\n---\n\n**【数据范围】**\n\n**本题采用捆绑测试。**\n\n对于 $100 \\%$ 的数据，$1 \\le n \\le 5 \\times {10}^4$，$1 \\le m \\le 5 \\times {10}^5$，$1 \\le c_i, d_i \\le n + m$，$1 \\le a_i, b_i \\le {10}^9$，保证树的叶子个数不超过 $20$。\n\n+ Subtask 1（10 points）: $n, m \\le 500$。 \n+ Subtask 2（10 points）: $n, m \\le 1000$。 \n+ Subtask 3（10 points）: $n, m \\le 5000$。 \n+ Subtask 4（20 points）: 满足树的第 $i$ 条边连接的是 $i$ 和 $i + 1$。 \n+ Subtask 5（15 points）: $m \\le {10}^5$。\n+ Subtask 6（35 points）: 无特殊限制。 ", "locale": "zh-CN"}}}
{"pid": "P7485", "type": "P", "difficulty": 4, "samples": [["1\n2 3 1 3\n", "1 2\n"], ["2\n2 3 1 3\n3 7 2 4 7\n", "1 2\n2 2 5\n"], ["3\n2 3 1 3\n3 7 2 4 7\n7 10 1 2 3 6 7 8 10\n", "1 2\n2 2 5\n1 2 2 3 4 6 6\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["数学", "递推"], "title": "「Stoi2031」枫", "background": "> 缓缓飘落的枫叶像思念 为何挽回要赶在冬天来之前 爱你穿越时间 两行来自秋末的眼泪 让爱渗透了地面 我要的只是你在我身边 ——《枫》", "description": "冬很喜欢枫叶。她家门前有一棵枫树，树上落下了 $n$ 片叶子。冬将它们编号为 $1$ 到 $n$。她希望这些枫叶不要这样被人踩碎后烂在地里，所以决定把它们捡起来。她称将剩余未捡起来的枫叶按编号从小到大或从大到小的顺序排序后，先捡起第一片枫叶，然后每隔 $k$ 片捡起一片称为一次 **挽回**。她会一直进行 **挽回**，第一次 **挽回** 从小到大，之后每次 **挽回** 的顺序都和上次不同（即上次从小到大这次就从大到小，反之亦然），直到最后一片枫叶也被捡起。她认为最后一片捡起的枫叶代表了 **思念**，能带来幸福。她希望获得更多的幸福，所以她会很多次地问你 $n$ 和 $k$ 取某两个值时她得到的 **思念** 的编号。", "inputFormat": "第一行为数据组数 $t$，满足 $t=i$，$i$ 为数据点编号。\n\n第 $2$ 到 $t+1$ 行，每行开头两个数 $q,m$，表示她要取 $q$ 次，每次的枫叶数 $n$ 不超过 $m$。接着输入 $q$ 个数表示每次的枫叶数 $n$。第 $x$ 行的所有询问中 $k=x-1$。", "outputFormat": "对于每行输出 $q$ 个数，表示每次询问的答案。", "hint": "#### 简述版题意：\n\n给定 $n,k$，对 $1,2,\\dots,n$ 一直操作，每次操作交替从小到大或从大到小的顺序取走当前的第 $(k+1)x+1$ 个数（$x \\in \\mathbb{Z_{\\ge 0}}$ 且 $(k+1)x+1$ 不超过剩余数总数），求最后一个取走的数的编号。多次询问。\n\n#### 样例解释：\n\n限于篇幅，只对样例 $2$ 作解释。\n\n对于第 $2$ 行：\n\n对于第一次询问，地上只有 $1$ 片枫叶，此即 **思念**。\n\n对于第二次询问，冬第一次 **挽回** 时依次捡起了 $1,3$ 两片枫叶，转身后只剩下 $2$，即 **思念**。\n\n对于第 $3$ 行：\n\n对于第一次询问，冬第一次 **挽回** 时捡起了 $1$ 号枫叶，转身后剩下 $2$，即 **思念**。\n\n对于第二次询问，冬第一次 **挽回** 时捡起了 $1,4$ 两片枫叶，第二次 **挽回** 捡起了 $3$，剩下 $2$，即 **思念**。\n\n对于第三次询问，冬第一次捡起了 $1,4,7$，第二次捡起了 $6,2$，第三次捡起了 $3$，此时剩下 $5$，即 **思念**。\n\n#### 数据范围：\n\n**本题每个数据点（除第 $1$ 个外）输入数据除数据组数 $t$ 以及最后一行（第 $t+1$ 行）外与前一个数据点输入数据完全相同。各个数据点的数据范围及特殊限制如下。**\n\n| Testdata No. | $q \\le$ | $m \\le$ | 特殊限制 | 分值 |\n| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |\n| $1$ | $2$ | $3$ | 为样例 $1$ | $3$ |\n| $2$ | $3$ | $7$ | 为样例 $2$ | $7$ |\n| $3$ | $7$ | $10$ | 为样例 $3$ | $3$ |\n| $4$ | $10$ | $30$ | 无 | $3$ |\n| $5$ | $30$ | $70$ | 无 | $7$ |\n| $6$ | $70$ | $100$ | 无 | $7$ |\n| $7$ | $100$ | $300$ | 无 | $7$ |\n| $8$ | $300$ | $700$ | 无 | $10$ |\n| $9$ | $700$ | $10^3$ | 无 | $3$ |\n| $10$ | $10^3$ | $3 \\times 10^3$ | 无 | $3$ |\n| $11$ | $3 \\times 10^3$ | $7 \\times 10^3$ | 无 | $1$ |\n| $12$ | $7 \\times 10^3$ | $10^4$ | 无 | $13$ |\n| $13$ | $10^4$ | $3 \\times 10^4$ | 无 | $3$ |\n| $14$ | $3 \\times 10^4$ | $7 \\times 10^4$ | 无 | $3$ |\n| $15$ | $7 \\times 10^4$ | $10^5$ | 无 | $10$ |\n| $16$ | $10^5$ | $3 \\times 10^5$ | 无 | $13$ |\n| $17$ | $3 \\times 10^5$ | $7 \\times 10^5$ | 无 | $1$ |\n| $18$ | $7 \\times 10^5$ | $10^6$ | 无 | $3$ |\n\n**本题读入量较大，可以选择使用比赛描述中的快速读入模板以加快读入速度。**", "locale": "zh-CN", "translations": {"zh-CN": {"title": "「Stoi2031」枫", "background": "> 缓缓飘落的枫叶像思念 为何挽回要赶在冬天来之前 爱你穿越时间 两行来自秋末的眼泪 让爱渗透了地面 我要的只是你在我身边 ——《枫》", "description": "冬很喜欢枫叶。她家门前有一棵枫树，树上落下了 $n$ 片叶子。冬将它们编号为 $1$ 到 $n$。她希望这些枫叶不要这样被人踩碎后烂在地里，所以决定把它们捡起来。她称将剩余未捡起来的枫叶按编号从小到大或从大到小的顺序排序后，先捡起第一片枫叶，然后每隔 $k$ 片捡起一片称为一次 **挽回**。她会一直进行 **挽回**，第一次 **挽回** 从小到大，之后每次 **挽回** 的顺序都和上次不同（即上次从小到大这次就从大到小，反之亦然），直到最后一片枫叶也被捡起。她认为最后一片捡起的枫叶代表了 **思念**，能带来幸福。她希望获得更多的幸福，所以她会很多次地问你 $n$ 和 $k$ 取某两个值时她得到的 **思念** 的编号。", "inputFormat": "第一行为数据组数 $t$，满足 $t=i$，$i$ 为数据点编号。\n\n第 $2$ 到 $t+1$ 行，每行开头两个数 $q,m$，表示她要取 $q$ 次，每次的枫叶数 $n$ 不超过 $m$。接着输入 $q$ 个数表示每次的枫叶数 $n$。第 $x$ 行的所有询问中 $k=x-1$。", "outputFormat": "对于每行输出 $q$ 个数，表示每次询问的答案。", "hint": "#### 简述版题意：\n\n给定 $n,k$，对 $1,2,\\dots,n$ 一直操作，每次操作交替从小到大或从大到小的顺序取走当前的第 $(k+1)x+1$ 个数（$x \\in \\mathbb{Z_{\\ge 0}}$ 且 $(k+1)x+1$ 不超过剩余数总数），求最后一个取走的数的编号。多次询问。\n\n#### 样例解释：\n\n限于篇幅，只对样例 $2$ 作解释。\n\n对于第 $2$ 行：\n\n对于第一次询问，地上只有 $1$ 片枫叶，此即 **思念**。\n\n对于第二次询问，冬第一次 **挽回** 时依次捡起了 $1,3$ 两片枫叶，转身后只剩下 $2$，即 **思念**。\n\n对于第 $3$ 行：\n\n对于第一次询问，冬第一次 **挽回** 时捡起了 $1$ 号枫叶，转身后剩下 $2$，即 **思念**。\n\n对于第二次询问，冬第一次 **挽回** 时捡起了 $1,4$ 两片枫叶，第二次 **挽回** 捡起了 $3$，剩下 $2$，即 **思念**。\n\n对于第三次询问，冬第一次捡起了 $1,4,7$，第二次捡起了 $6,2$，第三次捡起了 $3$，此时剩下 $5$，即 **思念**。\n\n#### 数据范围：\n\n**本题每个数据点（除第 $1$ 个外）输入数据除数据组数 $t$ 以及最后一行（第 $t+1$ 行）外与前一个数据点输入数据完全相同。各个数据点的数据范围及特殊限制如下。**\n\n| Testdata No. | $q \\le$ | $m \\le$ | 特殊限制 | 分值 |\n| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |\n| $1$ | $2$ | $3$ | 为样例 $1$ | $3$ |\n| $2$ | $3$ | $7$ | 为样例 $2$ | $7$ |\n| $3$ | $7$ | $10$ | 为样例 $3$ | $3$ |\n| $4$ | $10$ | $30$ | 无 | $3$ |\n| $5$ | $30$ | $70$ | 无 | $7$ |\n| $6$ | $70$ | $100$ | 无 | $7$ |\n| $7$ | $100$ | $300$ | 无 | $7$ |\n| $8$ | $300$ | $700$ | 无 | $10$ |\n| $9$ | $700$ | $10^3$ | 无 | $3$ |\n| $10$ | $10^3$ | $3 \\times 10^3$ | 无 | $3$ |\n| $11$ | $3 \\times 10^3$ | $7 \\times 10^3$ | 无 | $1$ |\n| $12$ | $7 \\times 10^3$ | $10^4$ | 无 | $13$ |\n| $13$ | $10^4$ | $3 \\times 10^4$ | 无 | $3$ |\n| $14$ | $3 \\times 10^4$ | $7 \\times 10^4$ | 无 | $3$ |\n| $15$ | $7 \\times 10^4$ | $10^5$ | 无 | $10$ |\n| $16$ | $10^5$ | $3 \\times 10^5$ | 无 | $13$ |\n| $17$ | $3 \\times 10^5$ | $7 \\times 10^5$ | 无 | $1$ |\n| $18$ | $7 \\times 10^5$ | $10^6$ | 无 | $3$ |\n\n**本题读入量较大，可以选择使用比赛描述中的快速读入模板以加快读入速度。**", "locale": "zh-CN"}}}
{"pid": "P7486", "type": "P", "difficulty": 7, "samples": [["3 7\n1 3\n2 3\n7 7\n", "21072733\n12145631\n823543\n"]], "limits": {"time": [1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["数学", "O2优化", "莫比乌斯反演"], "title": "「Stoi2031」彩虹", "background": "> 你要离开 我知道很简单 你说依赖 是我们的阻碍 就算放开 但能不能别没收我的爱 就当我最后才明白 ——《彩虹》", "description": "虹是一个喜欢幻想的女孩子。她认为两个正整数 $i,j$ 的 **依赖值** 为 $\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}$。她定义所有满足 $l \\le i \\le r,l \\le j \\le r$ 的 $i,j$ 的 **依赖值** 之积为两个正整数 $l,r$ 的 **阻碍值**。现在她给了你一个正整数 $n$，并 $t$ 次询问你两个满足 $1 \\le l \\le r \\le n$ 的正整数 $l,r$ 的 **阻碍值** $ans\\bmod{32465177}$。", "inputFormat": "第一行两个正整数 $t,n$。\n\n接下来 $t$ 行，每行两个正整数 $l_i,r_i$，表示一次询问。", "outputFormat": "对于每组询问输出一个整数表示答案。", "hint": "#### 简述版题意：\n\n给定 $l,r$，求 $\\prod\\limits_{i=l}^{r}\\prod\\limits_{j=l}^{r}\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)} \\bmod{32465177}$。多次询问。\n\n#### 样例解释：\n\n对于第 $1$ 次询问，$ans=1^1 \\times (2^2)^3 \\times (3^3)^3 \\times (6^6)^2$，$ans \\bmod{32465177}=21072733$；\n\n对于第 $2$ 次询问，$ans=2^2 \\times 3^3 \\times (6^6)^2$，$ans \\bmod{32465177}=12145631$；\n\n对于第 $3$ 次询问，$ans=7^7=823543$。\n\n#### 数据范围：\n\n对于 $30\\%$ 的数据，$1 \\le n \\le 10^3,t=1$；\n\n对于 $60\\%$ 的数据，$1 \\le n \\le 10^5,t=1$；\n\n对于 $100\\%$ 的数据，$1 \\le n \\le 10^6,1 \\le t \\le 10,1 \\le l_i \\le r_i \\le n$。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "「Stoi2031」彩虹", "background": "> 你要离开 我知道很简单 你说依赖 是我们的阻碍 就算放开 但能不能别没收我的爱 就当我最后才明白 ——《彩虹》", "description": "虹是一个喜欢幻想的女孩子。她认为两个正整数 $i,j$ 的 **依赖值** 为 $\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}$。她定义所有满足 $l \\le i \\le r,l \\le j \\le r$ 的 $i,j$ 的 **依赖值** 之积为两个正整数 $l,r$ 的 **阻碍值**。现在她给了你一个正整数 $n$，并 $t$ 次询问你两个满足 $1 \\le l \\le r \\le n$ 的正整数 $l,r$ 的 **阻碍值** $ans\\bmod{32465177}$。", "inputFormat": "第一行两个正整数 $t,n$。\n\n接下来 $t$ 行，每行两个正整数 $l_i,r_i$，表示一次询问。", "outputFormat": "对于每组询问输出一个整数表示答案。", "hint": "#### 简述版题意：\n\n给定 $l,r$，求 $\\prod\\limits_{i=l}^{r}\\prod\\limits_{j=l}^{r}\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)} \\bmod{32465177}$。多次询问。\n\n#### 样例解释：\n\n对于第 $1$ 次询问，$ans=1^1 \\times (2^2)^3 \\times (3^3)^3 \\times (6^6)^2$，$ans \\bmod{32465177}=21072733$；\n\n对于第 $2$ 次询问，$ans=2^2 \\times 3^3 \\times (6^6)^2$，$ans \\bmod{32465177}=12145631$；\n\n对于第 $3$ 次询问，$ans=7^7=823543$。\n\n#### 数据范围：\n\n对于 $30\\%$ 的数据，$1 \\le n \\le 10^3,t=1$；\n\n对于 $60\\%$ 的数据，$1 \\le n \\le 10^5,t=1$；\n\n对于 $100\\%$ 的数据，$1 \\le n \\le 10^6,1 \\le t \\le 10,1 \\le l_i \\le r_i \\le n$。", "locale": "zh-CN"}}}
{"pid": "P7487", "type": "P", "difficulty": 6, "samples": [["15 2\n", "201012023\n"], ["1 3\n", "2\n"], ["521 6\n", "262795752\n"], ["6546546546546543 22211\n", "388124125\n"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["数学", "递推", "递归", "O2优化", "素数判断,质数,筛法"], "title": "「Stoi2031」兰亭序", "background": "> 无关风月 我题序等你回 悬笔一绝 那岸边浪千叠 情字何解 怎落笔都不对 而我独缺 你一生的了解 ——《兰亭序》", "description": "月非常喜欢复数，尤其喜欢形如 $e^{2\\pi it}$ 的复数。她选择了两个正整数 $n,k$，并将 $1+e^{\\frac{2\\pi i x_1 \\dots x_k}{n}}$ 称为 $(x_1,\\dots,x_k)$ 的 **绝对度**，所有满足 $1 \\le x_i \\le n$ $(i \\in \\{1,2,\\dots,k\\})$ 的 $(x_1,\\dots,x_k)$ 的 **绝对度** 之积称为 $(n,k)$ 的 **无关度**。现在她想请你帮她对 $t \\in \\{1,2,\\dots,k\\}$ 求出 $(n,t)$ 的 **无关度** $ans \\bmod{335544323}$。由于回答太多的数太麻烦，你只要回答她所有答案进行异或运算后的结果。", "inputFormat": "一行两个正整数 $n,k$。", "outputFormat": "一行一个自然数表示答案。", "hint": "#### 简述版题意：\n\n给定 $n,k$，对 $1 \\le t \\le k$ 求\n\n$$\\prod_{x_1=1}^{n}\\prod_{x_2=1}^{n}\\dots\\prod_{x_t=1}^{n}\\left( 1+e^{\\frac{2\\pi ix_1x_2\\dots x_t}{n}} \\right) \\bmod{335544323}$$\n\n输出所有 $k$ 个答案的异或和。\n\n其中 $e^{it}=\\cos{t}+i\\sin{t}$ 对所有 $t \\in \\mathbb{R}$ 成立，$i$ 为虚数单位，满足 $i^2=-1$。\n\n#### 样例解释：\n\n对于第一组样例，$t=1,2$ 时答案分别为 $2,35184372088832$，取模后为 $2,201012021$，异或和为 $201012023$。\n\n对于第二组样例，$t=1,2,3$ 时答案均为 $2$，异或和为 $2$。\n\n限于篇幅，剩下的样例不作解释说明。\n\n#### 数据范围：\n\n**本题采用捆绑测试，各个 Subtask 的限制与分值如下：**\n\n| Subtask No. | $n \\le$ | $k \\le$ | 特殊限制 | 分值 |\n| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |\n| $1$ | $10$ | $1$ | 无 | $7$ |\n| $2$ | $1$ | $10$ | 无 | $7$ |\n| $3$ | $10$ | $2$ | 无 | $7$ |\n| $4$ | $10^{18}$ | $10^5$ | $n$ 为偶数 | $7$ |\n| $5$ | $10$ | $10$ | $n^k \\le 730$ | $16$ |\n| $6$ | $10^9$ | $10^3$ | 无 | $19$ |\n| $7$ | $10^{18}$ | $10^5$ | 无 | $37$ |\n\n对于 $100\\%$ 的数据，$1 \\le n \\le 10^{18},1 \\le k \\le 10^5$。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "「Stoi2031」兰亭序", "background": "> 无关风月 我题序等你回 悬笔一绝 那岸边浪千叠 情字何解 怎落笔都不对 而我独缺 你一生的了解 ——《兰亭序》", "description": "月非常喜欢复数，尤其喜欢形如 $e^{2\\pi it}$ 的复数。她选择了两个正整数 $n,k$，并将 $1+e^{\\frac{2\\pi i x_1 \\dots x_k}{n}}$ 称为 $(x_1,\\dots,x_k)$ 的 **绝对度**，所有满足 $1 \\le x_i \\le n$ $(i \\in \\{1,2,\\dots,k\\})$ 的 $(x_1,\\dots,x_k)$ 的 **绝对度** 之积称为 $(n,k)$ 的 **无关度**。现在她想请你帮她对 $t \\in \\{1,2,\\dots,k\\}$ 求出 $(n,t)$ 的 **无关度** $ans \\bmod{335544323}$。由于回答太多的数太麻烦，你只要回答她所有答案进行异或运算后的结果。", "inputFormat": "一行两个正整数 $n,k$。", "outputFormat": "一行一个自然数表示答案。", "hint": "#### 简述版题意：\n\n给定 $n,k$，对 $1 \\le t \\le k$ 求\n\n$$\\prod_{x_1=1}^{n}\\prod_{x_2=1}^{n}\\dots\\prod_{x_t=1}^{n}\\left( 1+e^{\\frac{2\\pi ix_1x_2\\dots x_t}{n}} \\right) \\bmod{335544323}$$\n\n输出所有 $k$ 个答案的异或和。\n\n其中 $e^{it}=\\cos{t}+i\\sin{t}$ 对所有 $t \\in \\mathbb{R}$ 成立，$i$ 为虚数单位，满足 $i^2=-1$。\n\n#### 样例解释：\n\n对于第一组样例，$t=1,2$ 时答案分别为 $2,35184372088832$，取模后为 $2,201012021$，异或和为 $201012023$。\n\n对于第二组样例，$t=1,2,3$ 时答案均为 $2$，异或和为 $2$。\n\n限于篇幅，剩下的样例不作解释说明。\n\n#### 数据范围：\n\n**本题采用捆绑测试，各个 Subtask 的限制与分值如下：**\n\n| Subtask No. | $n \\le$ | $k \\le$ | 特殊限制 | 分值 |\n| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |\n| $1$ | $10$ | $1$ | 无 | $7$ |\n| $2$ | $1$ | $10$ | 无 | $7$ |\n| $3$ | $10$ | $2$ | 无 | $7$ |\n| $4$ | $10^{18}$ | $10^5$ | $n$ 为偶数 | $7$ |\n| $5$ | $10$ | $10$ | $n^k \\le 730$ | $16$ |\n| $6$ | $10^9$ | $10^3$ | 无 | $19$ |\n| $7$ | $10^{18}$ | $10^5$ | 无 | $37$ |\n\n对于 $100\\%$ 的数据，$1 \\le n \\le 10^{18},1 \\le k \\le 10^5$。", "locale": "zh-CN"}}}
{"pid": "P7488", "type": "P", "difficulty": 6, "samples": [["32 2 47\n", "36\n"], ["233 223 1926817\n", "620162\n"], ["3 1 7", "2"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["数学", "组合数学", "Lucas 定理"], "title": "「Stoi2031」黑色毛衣", "background": "> 看着那白色的蜻蜓 在空中忘了前进 还能不能 重新编织 脑海中起毛球的记忆 再说我爱你 可能雨也不会停 黑色毛衣 藏在哪里 就让回忆永远停在那里 ——《黑色毛衣》", "description": "让想起了和雨在一起的时候。由于雨是一个爱玩的女孩子，所以他们有很多玩具，其中就有一种像 **白色蜻蜓** 一样的玩具，现在留在了让的身边，共有 $n$ 只。每只 **白色蜻蜓** 的翅膀长度分别是 $1,2,\\dots,n$，并且可以张开成 $(0,\\pi)$ 之间的任意角度。让认为使其中 $m$ 只 **白色蜻蜓** 分别张开翅膀使双翅末端的距离都为整数且互不相同的场景是在 **编织** 一份 **记忆**。他认为两份 **记忆** 相同当且仅当可以将 $m$ 只 **白色蜻蜓** 按某种方式重排后一一对应使对应的蜻蜓翅膀长度和双翅距离都相等。他想请你告诉他能编织出多少份不同的记忆。你只需要求出答案 $ans\\bmod{p}$ 的值。", "inputFormat": "一行三个正整数 $n,m,p$。", "outputFormat": "一行一个数，表示答案。", "hint": "#### 简述版题意\n\n求不同的腰长 $1 \\le a \\le n$，底长 $1 \\le b \\le 2a-1$ 且都为整数，腰长互不相同，底长也互不相同的 $m$ 个等腰三角形构成的不同组数。两组相同当且仅当可以使 $m$ 个三角形按某种方式重排后一一对应全等。\n\n#### 样例解释：\n\n限于篇幅，只对样例 $3$ 作解释。\n\n可以 **编织** 出 $1,1,1$，$2,2,1$，$2,2,2$，$2,2,3$，$3,3,1$，$3,3,2$，$3,3,3$，$3,3,4$，$3,3,5$ 共 $9$ 种 **记忆**，取模 $7$ 后为 $2$。\n\n**本题采用捆绑测试，每个 Subtask 的分数与限制如下。**\n\n| Subtask No. | $m \\le n \\le$ | 特殊限制 | 分值 |\n| :-----------: | :-----------: | :-----------: | :-----------: |\n| $1$ | $10^3$ | 无 | $13$ |\n| $2$ | $10^6$ | 无 | $37$ |\n| $3$ | $10^{18}$ | 无 | $37$ |\n| $4$ | $10^{18}$ | $p$是质数 | $13$ |\n\n对于所有数据， $1 \\le m \\le n \\le 10^{18},1 \\le p \\le 10^5$，不保证 $p$ 是质数。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "「Stoi2031」黑色毛衣", "background": "> 看着那白色的蜻蜓 在空中忘了前进 还能不能 重新编织 脑海中起毛球的记忆 再说我爱你 可能雨也不会停 黑色毛衣 藏在哪里 就让回忆永远停在那里 ——《黑色毛衣》", "description": "让想起了和雨在一起的时候。由于雨是一个爱玩的女孩子，所以他们有很多玩具，其中就有一种像 **白色蜻蜓** 一样的玩具，现在留在了让的身边，共有 $n$ 只。每只 **白色蜻蜓** 的翅膀长度分别是 $1,2,\\dots,n$，并且可以张开成 $(0,\\pi)$ 之间的任意角度。让认为使其中 $m$ 只 **白色蜻蜓** 分别张开翅膀使双翅末端的距离都为整数且互不相同的场景是在 **编织** 一份 **记忆**。他认为两份 **记忆** 相同当且仅当可以将 $m$ 只 **白色蜻蜓** 按某种方式重排后一一对应使对应的蜻蜓翅膀长度和双翅距离都相等。他想请你告诉他能编织出多少份不同的记忆。你只需要求出答案 $ans\\bmod{p}$ 的值。", "inputFormat": "一行三个正整数 $n,m,p$。", "outputFormat": "一行一个数，表示答案。", "hint": "#### 简述版题意\n\n求不同的腰长 $1 \\le a \\le n$，底长 $1 \\le b \\le 2a-1$ 且都为整数，腰长互不相同，底长也互不相同的 $m$ 个等腰三角形构成的不同组数。两组相同当且仅当可以使 $m$ 个三角形按某种方式重排后一一对应全等。\n\n#### 样例解释：\n\n限于篇幅，只对样例 $3$ 作解释。\n\n可以 **编织** 出 $1,1,1$，$2,2,1$，$2,2,2$，$2,2,3$，$3,3,1$，$3,3,2$，$3,3,3$，$3,3,4$，$3,3,5$ 共 $9$ 种 **记忆**，取模 $7$ 后为 $2$。\n\n**本题采用捆绑测试，每个 Subtask 的分数与限制如下。**\n\n| Subtask No. | $m \\le n \\le$ | 特殊限制 | 分值 |\n| :-----------: | :-----------: | :-----------: | :-----------: |\n| $1$ | $10^3$ | 无 | $13$ |\n| $2$ | $10^6$ | 无 | $37$ |\n| $3$ | $10^{18}$ | 无 | $37$ |\n| $4$ | $10^{18}$ | $p$是质数 | $13$ |\n\n对于所有数据， $1 \\le m \\le n \\le 10^{18},1 \\le p \\le 10^5$，不保证 $p$ 是质数。", "locale": "zh-CN"}}}
{"pid": "P7489", "type": "P", "difficulty": 5, "samples": [["3 1 7\n1 2 3\n", "3\n"], ["3 10 7\n1 2 3\n", "4\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144]}, "tags": ["数学", "O2优化", "逆元"], "title": "「Stoi2031」手写的从前", "background": "> 我看着你的脸 轻刷着和弦 情人节卡片 手写的永远 还记得广场公园 一起表演 学校旁糖果店 记忆里在微甜 ——《手写的从前》", "description": "远定义一个集合 $S$ 的 **权值** 为 $\\dfrac{\\sigma(S)}{\\pi(S)}$，其中 $\\sigma(S)=\\sum\\limits_{x \\in S}x$ 为 $S$ 中所有元素之和， $\\pi(S)=\\prod\\limits_{x \\in S}x$ 为 $S$ 中所有元素之积。甜问他，一个集合 $S$ 的 **所有子集** 的 **权值** 和是多少？远很快就算出了答案。甜又问，那 **所有子集** 的 **所有子集** 的 **权值** 和之和是多少？远又很快就算了出来。于是甜又问了一个问题，问题中总共有 $k$ 个 **所有子集**，这下远算不完了，所以他找你帮忙。远不需要回答一个太大的数，所以答案只要取模 $p$。", "inputFormat": "第一行 $3$ 个正整数 $n,k,p$，其中 $n$ 为 $S$ 中元素的个数。\n\n第二行 $n$ 个正整数，表示 $S$ 中的元素。", "outputFormat": "输出一个正整数表示答案，保证答案在模 $p$ 时有意义。", "hint": "#### 简述版题意：\n\n令 $f_0(S)=\\dfrac{\\sigma(S)}{\\pi(S)}$，$f_k(S)=\\sum\\limits_{T \\subseteq S}f_{k-1}(T)$。其中 $\\sigma(S)=\\sum\\limits_{x \\in S}x$ 为 $S$ 中所有元素之和， $\\pi(S)=\\prod\\limits_{x \\in S}x$ 为 $S$ 中所有元素之积。给定 $n,k,p$ 和集合 $S$，求 $f_k(S) \\bmod{p}$ 的值。\n\n#### 样例解释：\n\n限于篇幅，只解释样例 $1$。\n\n枚举子集：\n\n$\\emptyset$，$f_0$ 值为 $0$；\n\n$\\{1\\}$，$f_0$ 值为 $1$；\n\n$\\{2\\}$，$f_0$ 值为 $1$；\n\n$\\{3\\}$，$f_0$ 值为 $1$；\n\n$\\{1,2\\}$，$f_0$ 值为 $\\dfrac{3}{2}$；\n\n$\\{1,3\\}$，$f_0$ 值为 $\\dfrac{4}{3}$；\n\n$\\{2,3\\}$，$f_0$ 值为 $\\dfrac{5}{6}$；\n\n$\\{1,2,3\\}$，$f_0$ 值为 $1$；\n\n总和为 $\\dfrac{23}{3}$，模 $7$ 后为 $3$。\n\n#### 数据范围：\n\n对于 $30\\%$ 的数据，$n \\le 13,k=1$。\n\n对于 $70\\%$ 的数据，$n \\le 10^3$。\n\n对于 $100\\%$ 的数据，$1 \\le n \\le 7 \\times 10^6,1 \\le k \\le 10^{18},1 \\le x_i<p,1<p<2^{31},p$ 是质数，$x_i$ 互不相同。\n\n**本题读入量较大，可以选择使用比赛描述中的快速读入模板以加快读入速度。**", "locale": "zh-CN", "translations": {"zh-CN": {"title": "「Stoi2031」手写的从前", "background": "> 我看着你的脸 轻刷着和弦 情人节卡片 手写的永远 还记得广场公园 一起表演 学校旁糖果店 记忆里在微甜 ——《手写的从前》", "description": "远定义一个集合 $S$ 的 **权值** 为 $\\dfrac{\\sigma(S)}{\\pi(S)}$，其中 $\\sigma(S)=\\sum\\limits_{x \\in S}x$ 为 $S$ 中所有元素之和， $\\pi(S)=\\prod\\limits_{x \\in S}x$ 为 $S$ 中所有元素之积。甜问他，一个集合 $S$ 的 **所有子集** 的 **权值** 和是多少？远很快就算出了答案。甜又问，那 **所有子集** 的 **所有子集** 的 **权值** 和之和是多少？远又很快就算了出来。于是甜又问了一个问题，问题中总共有 $k$ 个 **所有子集**，这下远算不完了，所以他找你帮忙。远不需要回答一个太大的数，所以答案只要取模 $p$。", "inputFormat": "第一行 $3$ 个正整数 $n,k,p$，其中 $n$ 为 $S$ 中元素的个数。\n\n第二行 $n$ 个正整数，表示 $S$ 中的元素。", "outputFormat": "输出一个正整数表示答案，保证答案在模 $p$ 时有意义。", "hint": "#### 简述版题意：\n\n令 $f_0(S)=\\dfrac{\\sigma(S)}{\\pi(S)}$，$f_k(S)=\\sum\\limits_{T \\subseteq S}f_{k-1}(T)$。其中 $\\sigma(S)=\\sum\\limits_{x \\in S}x$ 为 $S$ 中所有元素之和， $\\pi(S)=\\prod\\limits_{x \\in S}x$ 为 $S$ 中所有元素之积。给定 $n,k,p$ 和集合 $S$，求 $f_k(S) \\bmod{p}$ 的值。\n\n#### 样例解释：\n\n限于篇幅，只解释样例 $1$。\n\n枚举子集：\n\n$\\emptyset$，$f_0$ 值为 $0$；\n\n$\\{1\\}$，$f_0$ 值为 $1$；\n\n$\\{2\\}$，$f_0$ 值为 $1$；\n\n$\\{3\\}$，$f_0$ 值为 $1$；\n\n$\\{1,2\\}$，$f_0$ 值为 $\\dfrac{3}{2}$；\n\n$\\{1,3\\}$，$f_0$ 值为 $\\dfrac{4}{3}$；\n\n$\\{2,3\\}$，$f_0$ 值为 $\\dfrac{5}{6}$；\n\n$\\{1,2,3\\}$，$f_0$ 值为 $1$；\n\n总和为 $\\dfrac{23}{3}$，模 $7$ 后为 $3$。\n\n#### 数据范围：\n\n对于 $30\\%$ 的数据，$n \\le 13,k=1$。\n\n对于 $70\\%$ 的数据，$n \\le 10^3$。\n\n对于 $100\\%$ 的数据，$1 \\le n \\le 7 \\times 10^6,1 \\le k \\le 10^{18},1 \\le x_i<p,1<p<2^{31},p$ 是质数，$x_i$ 互不相同。\n\n**本题读入量较大，可以选择使用比赛描述中的快速读入模板以加快读入速度。**", "locale": "zh-CN"}}}
{"pid": "P7490", "type": "P", "difficulty": 6, "samples": [["4 3\n1 1 1\n1 6\n", "0\n"], ["6 3\n1 7 3\n1 3\n", "5047704042563\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["数学", "博弈论", "期望", "SG 函数"], "title": "「Stoi2031」蒲公英的约定（vol.1）", "background": "> 一起长大的约定 那样清晰 拉过勾的我相信 说好要一起旅行 是你如今 唯一坚持的任性 ——《蒲公英的约定》", "description": "清和如在玩游戏。她们有 $n$ 丛 **蒲公英**，每丛分别有 $s_i$ 朵。这些 **蒲公英** 有一个神奇的性质：有一个给定的常数 $\\sigma \\in (0,1)$，$x$ 朵 **蒲公英** 会分出 $\\lfloor \\sigma x \\rfloor$ 朵为一组，剩下 $x-\\lfloor \\sigma x \\rfloor$ 朵继续分组，直到分出的组没有 **蒲公英** 即 $\\lfloor \\sigma x \\rfloor=0$ 为止。她们称这种现象为 **任性**。现在她们的每丛 **蒲公英** 都有 **任性** 的现象。她们的游戏规则如下：从清开始，两人轮流进行 **旅行**。一次 **旅行** 为选择一丛 **蒲公英** 并吹散这一丛的第一组中的若干朵 **蒲公英**，至少要吹一朵，至多吹的朵数为第一组的朵数，即不能吹散除第一组外的 **蒲公英**。当第一组为空时，其下一组成为第一组。若这一丛只剩下一组 **蒲公英**，这一丛不能再被选定。每丛 **蒲公英** 都不能被选定时，游戏结束，当前轮到的人落败。她们想知道如果清第一次 **旅行** 时等概率选择其中一丛可吹散的 **蒲公英** 再等概率选择吹散的朵数后两人都按最优策略操作，那么清的胜率 $x \\bmod 20190816170251$ 的值将会是多少。\n\n与 vol.2 的区别是，**蒲公英** 在被吹散一部分后 **不会** 重新分组。", "inputFormat": "第一行两个正整数 $id,n$，其中 $id$ 表示 Subtask 编号。\n\n第二行 $n$ 个正整数，第 $i$ 个表示 $s_i$。\n\n若 $id>3$，第三行输入两个正整数 $p,q$ 表示 $\\sigma=\\dfrac{p}{q}$。", "outputFormat": "一行一个整数，表示清的胜率 $x \\bmod{20190816170251}$。", "hint": "#### 简述版题意：\n\n有 $n$ 丛 **蒲公英**，第 $i$ 丛有 $s_i$ 朵。给定实数 $\\sigma$，每丛会分为若干组，第 $j$ 组有 $t_j$ 朵，且满足 $t_j=\\left\\lfloor \\sigma\\left(s_i - \\sum\\limits_{k=1}^{j-1}t_k\\right) \\right\\rfloor$，当 $t_j=0$ 时不再分组。两人轮流操作，每次操作可以选择一丛 **蒲公英**，并选择一个整数 $c \\in t_j$，从这丛 **蒲公英** 中吹散 $c$ 朵，将 $t_j$ 变为 $t_j-c$，其中 $j$ 为操作之前这丛 **蒲公英** 中满足 $t_j \\neq 0$ 的最小正整数。必须至少吹一朵，不能操作者败。求先手第一步等概率选择任意一丛可操作的 **蒲公英** 再等概率选择吹散的朵数后两人都采取最优策略时先手的胜率 $x \\bmod{20190816170251}$ 的值。\n\n#### 样例解释：\n\n对于样例 $1$，清无法操作，胜率为 $0$。\n\n对于样例 $2$，初始局面为 $\\{0;1\\},\\{2,1,1,1,0;2\\},\\{1,0;2\\}$，清可以选择第 $2$ 丛并在两种操作中选择吹散 $2$ 朵变成 $\\{0;1\\},\\{1,1,1,0;2\\},\\{1,0;2\\}$，选择第 $3$ 丛没有可取胜的策略，且第 $1$ 丛不能选择，总胜率为 $\\dfrac{\\frac{1}{2}+0}{2}=\\dfrac{1}{4}$。\n\n#### 数据范围：\n\n**本题采用捆绑测试，各个 Subtask 的分数与限制如下。**\n\n| Subtask No. | $n \\le$ | $s_i \\le$ | $\\sigma$ 限制 | 分值 |\n| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |\n| $1$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma=\\dfrac{\\sqrt{2}+1}{3}$ | $10$ |\n| $2$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma=\\dfrac{\\sqrt{3}+1}{5}$ | $10$ |\n| $3$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma=\\dfrac{\\sqrt{5}-1}{2}$ | $10$ |\n| $4$ | $100$ | $1$ | 无 | $3$ |\n| $5$ | $100$ | $100$ | $\\sigma=\\dfrac{1}{2}$ | $7$ |\n| $6$ | $100$ | $10^6$ | 无 | $13$ |\n| $7$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma \\ge \\dfrac{1}{2}$ | $47$ |\n\n对于 $100\\%$ 的数据，$1 \\le n \\le 3 \\times 10^5,1 \\le s_i \\le 10^{10},1 \\le p<q \\le 10^9$。\n\n**本题读入量较大，可以选择使用比赛描述中的快速读入模板以加快读入速度。**", "locale": "zh-CN", "translations": {"zh-CN": {"title": "「Stoi2031」蒲公英的约定（vol.1）", "background": "> 一起长大的约定 那样清晰 拉过勾的我相信 说好要一起旅行 是你如今 唯一坚持的任性 ——《蒲公英的约定》", "description": "清和如在玩游戏。她们有 $n$ 丛 **蒲公英**，每丛分别有 $s_i$ 朵。这些 **蒲公英** 有一个神奇的性质：有一个给定的常数 $\\sigma \\in (0,1)$，$x$ 朵 **蒲公英** 会分出 $\\lfloor \\sigma x \\rfloor$ 朵为一组，剩下 $x-\\lfloor \\sigma x \\rfloor$ 朵继续分组，直到分出的组没有 **蒲公英** 即 $\\lfloor \\sigma x \\rfloor=0$ 为止。她们称这种现象为 **任性**。现在她们的每丛 **蒲公英** 都有 **任性** 的现象。她们的游戏规则如下：从清开始，两人轮流进行 **旅行**。一次 **旅行** 为选择一丛 **蒲公英** 并吹散这一丛的第一组中的若干朵 **蒲公英**，至少要吹一朵，至多吹的朵数为第一组的朵数，即不能吹散除第一组外的 **蒲公英**。当第一组为空时，其下一组成为第一组。若这一丛只剩下一组 **蒲公英**，这一丛不能再被选定。每丛 **蒲公英** 都不能被选定时，游戏结束，当前轮到的人落败。她们想知道如果清第一次 **旅行** 时等概率选择其中一丛可吹散的 **蒲公英** 再等概率选择吹散的朵数后两人都按最优策略操作，那么清的胜率 $x \\bmod 20190816170251$ 的值将会是多少。\n\n与 vol.2 的区别是，**蒲公英** 在被吹散一部分后 **不会** 重新分组。", "inputFormat": "第一行两个正整数 $id,n$，其中 $id$ 表示 Subtask 编号。\n\n第二行 $n$ 个正整数，第 $i$ 个表示 $s_i$。\n\n若 $id>3$，第三行输入两个正整数 $p,q$ 表示 $\\sigma=\\dfrac{p}{q}$。", "outputFormat": "一行一个整数，表示清的胜率 $x \\bmod{20190816170251}$。", "hint": "#### 简述版题意：\n\n有 $n$ 丛 **蒲公英**，第 $i$ 丛有 $s_i$ 朵。给定实数 $\\sigma$，每丛会分为若干组，第 $j$ 组有 $t_j$ 朵，且满足 $t_j=\\left\\lfloor \\sigma\\left(s_i - \\sum\\limits_{k=1}^{j-1}t_k\\right) \\right\\rfloor$，当 $t_j=0$ 时不再分组。两人轮流操作，每次操作可以选择一丛 **蒲公英**，并选择一个整数 $c \\in t_j$，从这丛 **蒲公英** 中吹散 $c$ 朵，将 $t_j$ 变为 $t_j-c$，其中 $j$ 为操作之前这丛 **蒲公英** 中满足 $t_j \\neq 0$ 的最小正整数。必须至少吹一朵，不能操作者败。求先手第一步等概率选择任意一丛可操作的 **蒲公英** 再等概率选择吹散的朵数后两人都采取最优策略时先手的胜率 $x \\bmod{20190816170251}$ 的值。\n\n#### 样例解释：\n\n对于样例 $1$，清无法操作，胜率为 $0$。\n\n对于样例 $2$，初始局面为 $\\{0;1\\},\\{2,1,1,1,0;2\\},\\{1,0;2\\}$，清可以选择第 $2$ 丛并在两种操作中选择吹散 $2$ 朵变成 $\\{0;1\\},\\{1,1,1,0;2\\},\\{1,0;2\\}$，选择第 $3$ 丛没有可取胜的策略，且第 $1$ 丛不能选择，总胜率为 $\\dfrac{\\frac{1}{2}+0}{2}=\\dfrac{1}{4}$。\n\n#### 数据范围：\n\n**本题采用捆绑测试，各个 Subtask 的分数与限制如下。**\n\n| Subtask No. | $n \\le$ | $s_i \\le$ | $\\sigma$ 限制 | 分值 |\n| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |\n| $1$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma=\\dfrac{\\sqrt{2}+1}{3}$ | $10$ |\n| $2$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma=\\dfrac{\\sqrt{3}+1}{5}$ | $10$ |\n| $3$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma=\\dfrac{\\sqrt{5}-1}{2}$ | $10$ |\n| $4$ | $100$ | $1$ | 无 | $3$ |\n| $5$ | $100$ | $100$ | $\\sigma=\\dfrac{1}{2}$ | $7$ |\n| $6$ | $100$ | $10^6$ | 无 | $13$ |\n| $7$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma \\ge \\dfrac{1}{2}$ | $47$ |\n\n对于 $100\\%$ 的数据，$1 \\le n \\le 3 \\times 10^5,1 \\le s_i \\le 10^{10},1 \\le p<q \\le 10^9$。\n\n**本题读入量较大，可以选择使用比赛描述中的快速读入模板以加快读入速度。**", "locale": "zh-CN"}}}
{"pid": "P7491", "type": "P", "difficulty": 6, "samples": [["4 3\n1 1 1\n1 6\n", "0\n"], ["6 3\n1 7 3\n1 3\n", "15143112127689\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["数学", "博弈论", "期望", "SG 函数"], "title": "「Stoi2031」蒲公英的约定（vol.2）", "background": "> 一起长大的约定 那样清晰 拉过勾的我相信 说好要一起旅行 是你如今 唯一坚持的任性 ——《蒲公英的约定》", "description": "清和如在玩游戏。她们有 $n$ 丛 **蒲公英**，每丛分别有 $s_i$ 朵。这些 **蒲公英** 有一个神奇的性质：有一个给定的常数 $\\sigma \\in (0,1)$，$x$ 朵 **蒲公英** 会分出 $\\lfloor \\sigma x \\rfloor$ 朵为一组，剩下 $x-\\lfloor \\sigma x \\rfloor$ 朵继续分组，直到分出的组没有 **蒲公英** 即 $\\lfloor \\sigma x \\rfloor=0$ 为止。她们称这种现象为 **任性**。现在她们的每丛 **蒲公英** 都有 **任性** 的现象。她们的游戏规则如下：从清开始，两人轮流进行 **旅行**。一次 **旅行** 为选择一丛 **蒲公英** 并吹散这一丛的第一组中的若干朵 **蒲公英**，至少要吹一朵，至多吹的朵数为第一组的朵数，即不能吹散除第一组外的 **蒲公英**。当第一组为空时，其下一组成为第一组。若这一丛只剩下一组 **蒲公英**，这一丛不能再被选定。每丛 **蒲公英** 都不能被选定时，游戏结束，当前轮到的人落败。她们想知道如果清第一次 **旅行** 时等概率选择其中一丛可吹散的 **蒲公英** 再等概率选择吹散的朵数后两人都按最优策略操作，那么清的胜率 $x \\bmod{20190816170251}$ 的值将会是多少。\n\n与 vol.1 的区别是，**蒲公英** 在被吹散一部分后 **会** 重新分组。", "inputFormat": "第一行两个正整数 $id,n$，其中 $id$ 表示 Subtask 编号。\n\n第二行 $n$ 个正整数，第 $i$ 个表示 $s_i$。\n\n若 $id>3$，第三行输入两个正整数 $p,q$ 表示 $\\sigma=\\dfrac{p}{q}$。", "outputFormat": "一行一个整数，表示清的胜率 $x \\bmod{20190816170251}$。", "hint": "#### 简述版题意：\n\n有 $n$ 丛 **蒲公英**，第 $i$ 丛有 $s_i$ 朵。给定实数 $\\sigma$，两人轮流操作，每次操作可以选择一丛 **蒲公英**，并选择一个整数 $c \\in (0,\\sigma s]$，从这丛 **蒲公英** 中吹散 $c$ 朵，其中 $s$ 为操作之前这丛 **蒲公英** 的朵数。必须至少吹一朵，不能操作者败。求先手第一步等概率选择任意一丛可操作的 **蒲公英** 再等概率选择吹散的朵数后两人都采取最优策略时先手的胜率 $x \\bmod{20190816170251}$ 的值。\n\n#### 样例解释：\n\n对于样例 $1$，清无法操作，胜率为 $0$。\n\n对于样例 $2$，清可以选择第 $2$ 丛并在两种操作中选择吹散 $2$ 朵变成 $1,5,3$，或选择第 $3$ 丛并选择唯一的操作变成 $1,7,2$，且第 $1$ 丛不能选择，总胜率为 $\\dfrac{\\frac{1}{2}+1}{2}=\\dfrac{3}{4}$。\n\n#### 数据范围：\n\n**本题采用捆绑测试，各个 Subtask 的分数与限制如下。**\n\n| Subtask No. | $n \\le$ | $s_i \\le$ | $\\sigma$ 限制 | 分值 |\n| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |\n| $1$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma=\\dfrac{\\sqrt{2}+1}{3}$ | $10$ |\n| $2$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma=\\dfrac{\\sqrt{3}+1}{5}$ | $10$ |\n| $3$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma=\\dfrac{\\sqrt{5}-1}{2}$ | $10$ |\n| $4$ | $100$ | $1$ | 无 | $3$ |\n| $5$ | $100$ | $100$ | $\\sigma=\\dfrac{1}{2}$ | $7$ |\n| $6$ | $100$ | $10^6$ | 无 | $13$ |\n| $7$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma \\ge \\dfrac{1}{2}$ | $47$ |\n\n对于 $100\\%$ 的数据，$1 \\le n \\le 3 \\times 10^5,1 \\le s_i \\le 10^{10},1 \\le p<q \\le 10^9$。\n\n**本题读入量较大，可以选择使用比赛描述中的快速读入模板以加快读入速度。**", "locale": "zh-CN", "translations": {"zh-CN": {"title": "「Stoi2031」蒲公英的约定（vol.2）", "background": "> 一起长大的约定 那样清晰 拉过勾的我相信 说好要一起旅行 是你如今 唯一坚持的任性 ——《蒲公英的约定》", "description": "清和如在玩游戏。她们有 $n$ 丛 **蒲公英**，每丛分别有 $s_i$ 朵。这些 **蒲公英** 有一个神奇的性质：有一个给定的常数 $\\sigma \\in (0,1)$，$x$ 朵 **蒲公英** 会分出 $\\lfloor \\sigma x \\rfloor$ 朵为一组，剩下 $x-\\lfloor \\sigma x \\rfloor$ 朵继续分组，直到分出的组没有 **蒲公英** 即 $\\lfloor \\sigma x \\rfloor=0$ 为止。她们称这种现象为 **任性**。现在她们的每丛 **蒲公英** 都有 **任性** 的现象。她们的游戏规则如下：从清开始，两人轮流进行 **旅行**。一次 **旅行** 为选择一丛 **蒲公英** 并吹散这一丛的第一组中的若干朵 **蒲公英**，至少要吹一朵，至多吹的朵数为第一组的朵数，即不能吹散除第一组外的 **蒲公英**。当第一组为空时，其下一组成为第一组。若这一丛只剩下一组 **蒲公英**，这一丛不能再被选定。每丛 **蒲公英** 都不能被选定时，游戏结束，当前轮到的人落败。她们想知道如果清第一次 **旅行** 时等概率选择其中一丛可吹散的 **蒲公英** 再等概率选择吹散的朵数后两人都按最优策略操作，那么清的胜率 $x \\bmod{20190816170251}$ 的值将会是多少。\n\n与 vol.1 的区别是，**蒲公英** 在被吹散一部分后 **会** 重新分组。", "inputFormat": "第一行两个正整数 $id,n$，其中 $id$ 表示 Subtask 编号。\n\n第二行 $n$ 个正整数，第 $i$ 个表示 $s_i$。\n\n若 $id>3$，第三行输入两个正整数 $p,q$ 表示 $\\sigma=\\dfrac{p}{q}$。", "outputFormat": "一行一个整数，表示清的胜率 $x \\bmod{20190816170251}$。", "hint": "#### 简述版题意：\n\n有 $n$ 丛 **蒲公英**，第 $i$ 丛有 $s_i$ 朵。给定实数 $\\sigma$，两人轮流操作，每次操作可以选择一丛 **蒲公英**，并选择一个整数 $c \\in (0,\\sigma s]$，从这丛 **蒲公英** 中吹散 $c$ 朵，其中 $s$ 为操作之前这丛 **蒲公英** 的朵数。必须至少吹一朵，不能操作者败。求先手第一步等概率选择任意一丛可操作的 **蒲公英** 再等概率选择吹散的朵数后两人都采取最优策略时先手的胜率 $x \\bmod{20190816170251}$ 的值。\n\n#### 样例解释：\n\n对于样例 $1$，清无法操作，胜率为 $0$。\n\n对于样例 $2$，清可以选择第 $2$ 丛并在两种操作中选择吹散 $2$ 朵变成 $1,5,3$，或选择第 $3$ 丛并选择唯一的操作变成 $1,7,2$，且第 $1$ 丛不能选择，总胜率为 $\\dfrac{\\frac{1}{2}+1}{2}=\\dfrac{3}{4}$。\n\n#### 数据范围：\n\n**本题采用捆绑测试，各个 Subtask 的分数与限制如下。**\n\n| Subtask No. | $n \\le$ | $s_i \\le$ | $\\sigma$ 限制 | 分值 |\n| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |\n| $1$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma=\\dfrac{\\sqrt{2}+1}{3}$ | $10$ |\n| $2$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma=\\dfrac{\\sqrt{3}+1}{5}$ | $10$ |\n| $3$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma=\\dfrac{\\sqrt{5}-1}{2}$ | $10$ |\n| $4$ | $100$ | $1$ | 无 | $3$ |\n| $5$ | $100$ | $100$ | $\\sigma=\\dfrac{1}{2}$ | $7$ |\n| $6$ | $100$ | $10^6$ | 无 | $13$ |\n| $7$ | $3 \\times 10^5$ | $10^{10}$ | $\\sigma \\ge \\dfrac{1}{2}$ | $47$ |\n\n对于 $100\\%$ 的数据，$1 \\le n \\le 3 \\times 10^5,1 \\le s_i \\le 10^{10},1 \\le p<q \\le 10^9$。\n\n**本题读入量较大，可以选择使用比赛描述中的快速读入模板以加快读入速度。**", "locale": "zh-CN"}}}
{"pid": "P7492", "type": "P", "difficulty": 5, "samples": [["15 15\n512 -65 33554432 32 8194 13 16 2 67108872 131072 -8192 8194 16 2048 4096 \n1 3 5\n1 10 10\n2 1 7 671367424\n1 8 14\n1 5 11\n2 13 13 335579137\n2 2 13 5376\n1 2 5\n2 5 6 8392768\n1 1 2\n2 2 14 201335872\n2 1 14 0\n1 11 12\n1 8 12\n1 4 9", "33562658\n131072\n67242012\n2081350441\n2047680290\n671367936\n201340226\n805489228\n3373416393"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["线段树", "分块", "位运算", "传智杯"], "title": "[传智杯 #3 决赛] 序列", "background": "disangan233 正在数数，他希望你帮他记录数数的序列，并完成一些操作。", "description": "你有一个长为 $n$ 的序列 $a$，现在要对其进行 $m$ 次操作。操作分为两种：\n\n1. 给定两个整数 $l,r$，表示询问 $l$ 到 $r$ 的最大连续子段和。\n2. 给定三个整数 $l,r,k$，表示将 $l$ 到 $r$ 的 $a_i$ 都按位或上一个 $k$。\n\n对于所有数据，$n,m\\leq 10^5$，$-2^{30}\\leq a_i,k<2^{30}$，$1\\leq l\\leq r\\leq n$。\t \n\n注意：负数按照 32 位补码取按位或。", "inputFormat": "输入共 $m+2$ 行。\n\n第 $1$ 行输入 $2$ 个正整数 $n,m$。\n\n第 $2$ 行输入 $n$ 个整数 $a_1\\ldots a_n$。\n\n接下来 $m$ 行，每行先输入 $1$ 个正整数 $op$，$op=1$ 输入 $2$ 个整数 $l,r$ 表示一次询问，否则输入 $3$ 个整数 $l,r,k$ 表示一次修改。", "outputFormat": "输出共若干行，每行共 $1$ 个整数，表示询问的答案。", "hint": "", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[传智杯 #3 决赛] 序列", "background": "disangan233 正在数数，他希望你帮他记录数数的序列，并完成一些操作。", "description": "你有一个长为 $n$ 的序列 $a$，现在要对其进行 $m$ 次操作。操作分为两种：\n\n1. 给定两个整数 $l,r$，表示询问 $l$ 到 $r$ 的最大连续子段和。\n2. 给定三个整数 $l,r,k$，表示将 $l$ 到 $r$ 的 $a_i$ 都按位或上一个 $k$。\n\n对于所有数据，$n,m\\leq 10^5$，$-2^{30}\\leq a_i,k<2^{30}$，$1\\leq l\\leq r\\leq n$。\t \n\n注意：负数按照 32 位补码取按位或。", "inputFormat": "输入共 $m+2$ 行。\n\n第 $1$ 行输入 $2$ 个正整数 $n,m$。\n\n第 $2$ 行输入 $n$ 个整数 $a_1\\ldots a_n$。\n\n接下来 $m$ 行，每行先输入 $1$ 个正整数 $op$，$op=1$ 输入 $2$ 个整数 $l,r$ 表示一次询问，否则输入 $3$ 个整数 $l,r,k$ 表示一次修改。", "outputFormat": "输出共若干行，每行共 $1$ 个整数，表示询问的答案。", "hint": "", "locale": "zh-CN"}}}
{"pid": "P7493", "type": "P", "difficulty": 6, "samples": [["3 2 2 2\n1 3\n2 3", "2\n1"], ["2077 30 200 3\n1949 2021\n1969 2077\n1970 2004\n", "360658315\n804081653\n603979748"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144]}, "tags": ["动态规划 DP", "多项式", "O2优化", "快速数论变换 NTT", "传智杯"], "title": "[传智杯 #3 决赛] 旅人1969", "background": "在被称为未来的二十一世纪里，只残留着不安与少许的幻想。\n\n永远与须臾的罪人啊，二十世纪的诺亚方舟，承载着期待与不安向着天空飞去呢！\n\n而作为希望的你，在这并不永恒的旅途中，会怎样地前行呢？", "description": "一条笔直的公路上有 $n$ 个旅店，第 $i$ 个旅店的坐标是 $i$，每一天早上从旅店出发走最多 $m$ 个距离，同时固定给你一个常数 $k$。\n\n给定 $q$ 组询问，每次给定 $u,v$，求早上从旅店 $u$ 出发到旅店 $v$，途径不超过 $k$ 个旅店（不含起点 $u$）且行走方向不变的方案数。两种方案不同当且仅当存在一个不同的旅店选择，答案对 $998244353$ 取模。\n\n对于所有数据，$n,q\\leq 10^5$，$m,k\\leq 10^4$，$mk\\leq 10^5$，$u,v\\leq n$。", "inputFormat": "输入共 $q+1$ 行。\n\n第一行输入 $4$ 个正整数 $n,m,k,q$。\n\n接下来 $q$ 行，每行输入 $2$ 个正整数 $u,v$，表示一组询问。", "outputFormat": "输出共 $q$ 行，每行输入 $1$ 个整数表示答案。", "hint": "", "locale": "zh-CN", "translations": {"zh-CN": {"title": "[传智杯 #3 决赛] 旅人1969", "background": "在被称为未来的二十一世纪里，只残留着不安与少许的幻想。\n\n永远与须臾的罪人啊，二十世纪的诺亚方舟，承载着期待与不安向着天空飞去呢！\n\n而作为希望的你，在这并不永恒的旅途中，会怎样地前行呢？", "description": "一条笔直的公路上有 $n$ 个旅店，第 $i$ 个旅店的坐标是 $i$，每一天早上从旅店出发走最多 $m$ 个距离，同时固定给你一个常数 $k$。\n\n给定 $q$ 组询问，每次给定 $u,v$，求早上从旅店 $u$ 出发到旅店 $v$，途径不超过 $k$ 个旅店（不含起点 $u$）且行走方向不变的方案数。两种方案不同当且仅当存在一个不同的旅店选择，答案对 $998244353$ 取模。\n\n对于所有数据，$n,q\\leq 10^5$，$m,k\\leq 10^4$，$mk\\leq 10^5$，$u,v\\leq n$。", "inputFormat": "输入共 $q+1$ 行。\n\n第一行输入 $4$ 个正整数 $n,m,k,q$。\n\n接下来 $q$ 行，每行输入 $2$ 个正整数 $u,v$，表示一组询问。", "outputFormat": "输出共 $q$ 行，每行输入 $1$ 个整数表示答案。", "hint": "", "locale": "zh-CN"}}}
{"pid": "P7494", "type": "P", "difficulty": 2, "samples": [["4 5", "2"], ["13 6", "3"], ["8 2", "3"], ["114 514", "5"], ["19198 10", "962"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["递推", "2021"], "title": "三遣救援", "background": ">就像第一块多米诺骨牌，那个人的出现开启了后面的故事。\n\n穆罗在家里养了许多猪。在他的训练下，这些猪都十分乖巧。当然，有的时候这些猪也会变得十分调皮……", "description": "一天早上，穆罗发现自己私存的一块蛋糕被偷吃了！他立即猜到某只猪吃了这块蛋糕，于是迅速赶到猪圈决定找出这只猪进行惩罚。\n\n猪圈里有 $n$ 只猪，猪的序号是 $1$ 到 $n$ 之间的整数。除了偷吃了蛋糕的那只猪，其他所有猪**一样重**，而那只偷吃了蛋糕的猪会比其他猪**略重一些**（你可以假设原本猪是 $5\\text{kg}$ 的，那只吃了蛋糕的猪是 $5.1\\text{kg}$ 的）。穆罗无法肉眼判断是哪只猪吃了蛋糕。\n\n幸运的是穆罗有一个天平，可以将猪赶上天平两侧，从而比较出哪边的猪更重。不过这个天平不是很大，每侧最多只能有 $m$ 只猪，否则天平就会损坏导致无法使用（偷吃蛋糕的猪**不会使天平一侧可放置的猪的数目减少**，即**无论猪是否偷吃，每侧都最多只能有 $m$ 只猪**）。\n\n穆罗不想花费太多的时间，所以他希望知道在**天平不损坏**的前提下，**至少需要使用几次天平称量才能保证找出这只偷吃了的猪**。他希望你能求出这个数。", "inputFormat": "一行，两个正整数 $n,m$。", "outputFormat": "一行，一个正整数表示答案。", "hint": "#### 样例一解释：\n\n穆罗先让 $1$ 号猪和 $2$ 号猪分别上天平两侧，再让 $3$ 号猪和 $4$ 号猪分别上天平两侧，此时一定能找出偷吃了的猪，使用天平次数为 $2$。显然只使用一次天平无法保证能找出那只偷吃了的猪。\n\n#### 样例三解释：\n\n天平两侧最多都只能放两只猪，所以至少需要三次才能保证找出。\n\n------------\n#### 数据范围\n\n**本题采用捆绑测试。**\n\n+ Subtask 1 ( $10\\%$ )：$n,m\\leq10$。\n+ Subtask 2 ( $25\\%$ )：$n,m\\leq10^6$。\n+ Subtask 3 ( $15\\%$ )：$n\\leq m$。\n+ Subtask 4 ( $50\\%$ )：无特殊限制。\n\n对于所有数据，$1\\leq n,m\\leq10^{15}$。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "三遣救援", "background": ">就像第一块多米诺骨牌，那个人的出现开启了后面的故事。\n\n穆罗在家里养了许多猪。在他的训练下，这些猪都十分乖巧。当然，有的时候这些猪也会变得十分调皮……", "description": "一天早上，穆罗发现自己私存的一块蛋糕被偷吃了！他立即猜到某只猪吃了这块蛋糕，于是迅速赶到猪圈决定找出这只猪进行惩罚。\n\n猪圈里有 $n$ 只猪，猪的序号是 $1$ 到 $n$ 之间的整数。除了偷吃了蛋糕的那只猪，其他所有猪**一样重**，而那只偷吃了蛋糕的猪会比其他猪**略重一些**（你可以假设原本猪是 $5\\text{kg}$ 的，那只吃了蛋糕的猪是 $5.1\\text{kg}$ 的）。穆罗无法肉眼判断是哪只猪吃了蛋糕。\n\n幸运的是穆罗有一个天平，可以将猪赶上天平两侧，从而比较出哪边的猪更重。不过这个天平不是很大，每侧最多只能有 $m$ 只猪，否则天平就会损坏导致无法使用（偷吃蛋糕的猪**不会使天平一侧可放置的猪的数目减少**，即**无论猪是否偷吃，每侧都最多只能有 $m$ 只猪**）。\n\n穆罗不想花费太多的时间，所以他希望知道在**天平不损坏**的前提下，**至少需要使用几次天平称量才能保证找出这只偷吃了的猪**。他希望你能求出这个数。", "inputFormat": "一行，两个正整数 $n,m$。", "outputFormat": "一行，一个正整数表示答案。", "hint": "#### 样例一解释：\n\n穆罗先让 $1$ 号猪和 $2$ 号猪分别上天平两侧，再让 $3$ 号猪和 $4$ 号猪分别上天平两侧，此时一定能找出偷吃了的猪，使用天平次数为 $2$。显然只使用一次天平无法保证能找出那只偷吃了的猪。\n\n#### 样例三解释：\n\n天平两侧最多都只能放两只猪，所以至少需要三次才能保证找出。\n\n------------\n#### 数据范围\n\n**本题采用捆绑测试。**\n\n+ Subtask 1 ( $10\\%$ )：$n,m\\leq10$。\n+ Subtask 2 ( $25\\%$ )：$n,m\\leq10^6$。\n+ Subtask 3 ( $15\\%$ )：$n\\leq m$。\n+ Subtask 4 ( $50\\%$ )：无特殊限制。\n\n对于所有数据，$1\\leq n,m\\leq10^{15}$。", "locale": "zh-CN"}}}
{"pid": "P7495", "type": "P", "difficulty": 5, "samples": [["5 2 3\n01101\n", "338690049"], ["17 4 13\n10101110100101101\n", "512357021"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["递推", "2021", "矩阵运算", "概率论", "矩阵乘法"], "title": "异位坍缩", "background": ">自然的法则隐藏在黑暗之中。\n\n月光之下，菲欧娜和一群与她有着同样信仰的信徒们聚集在一起，等待着他们所信仰的神明降临。\n\n「神明大人，我们愿意永远追随您。」", "description": "神明想要测试他的信徒们是否忠诚，他决定用运气来进行测试。\n\n神明事先准备了 $n$ 个问题，每个问题都有两种选择：**「相对激进的」** 和 **「相对保守的」**。神明已经定好了自己的选择。\n\n为了考验他的信徒们，神明会在所有可行的问题选择方式中**等概率选出一种**（可行的选择方式指选出**连续的** $k$ 个问题，满足 $l\\leq k\\leq r$，其中 $l,r$ 给定），然后信徒们会依次对这 $k$ 个问题中的每个问题回答「相对激进的」或「相对保守的」。神明会根据自己的选择以及某个信徒的回答来判定这名信徒是否忠诚。\n\n神明的判定方式是这样的：\n\n+ 这是第一个问题：无论回答如何，神明都愿意相信这名信徒是忠诚的。\n+ 这不是第一个问题：如果这名信徒的上一个回答与神明的选择相同，那么神明会需要他去对更先进的选择进行探索，因此这名信徒在这个问题的回答**不能比神明的选择更保守**；否则，神明会要求这名信徒服从于自己，在这个问题的回答**不能比神明的选择更激进**。\n\n如果这名信徒的回答满足上述要求，那么这名信徒就是忠诚的。\n\n现在，神明想要知道，如果信徒对每个问题都会**等概率回答「相对激进的」或「相对保守的」**，那么一名信徒有多大的概率会是忠诚的。他通过菲欧娜向你提出了这个问题，并要求你将结果对 $998244353$ 取模。如果你无法及时回答出，那么你就会失去神明的信任。\n\n------------\n\n#### 简要题意：\n\n给定一个长度为 $n$ 的 01 串 $a$ 以及 $l,r(l\\leq r)$。\n\n对于两个长度均为 $k$ 的 01 串 $p,q$，我们认为 $q$ 对于 $p$ 是「忠诚的」，当且仅当 $p$ 和 $q$ 满足如下要求：\n\n+ 对于任意 $1<i\\leq k$，如果 $q_{i-1}=p_{i-1}$，那么 $q_i\\geq p_i$，否则 $q_i\\leq p_i$。\n\n你需要求出如果**先等概率随机选出一个长度 $k$ 满足 $l\\leq k\\leq r$ 的 $a$ 的子串**，然后**再等概率随机出一个长度为 $k$ 的 01 串 $b$**，有多大的概率使得 $b$ 对于这个子串是「忠诚的」，结果对 $998244353$ 取模。", "inputFormat": "第一行三个整数 $n,l,r$，意义如上。\n\n第二行有一个长度为 $n$ 的字符串，表示 $a$。保证字符串只含字符 `0` 和 `1`。", "outputFormat": "一行一个整数，表示结果。", "hint": "#### 样例一解释：\n\n我们用 $\\left[l,r\\right]$ 表示所选择的子串所在区间。\n\n+ 选择 $\\left[1,2\\right]$，子串为 `01`，长度为 $2$，有 $3$ 个 01 串对这个子串是「忠诚的」，概率为 $\\dfrac{3}{4}$。\n+ 选择 $\\left[1,3\\right]$，子串为 `011`，长度为 $3$，有 $4$ 个 01 串对这个子串是「忠诚的」，概率为 $\\dfrac{1}{2}$。\n+ 选择 $\\left[2,3\\right]$，概率为 $\\dfrac{3}{4}$。\n\n+ 选择 $\\left[2,4\\right]$，概率为 $\\dfrac{5}{8}$。\n+ 选择 $\\left[3,4\\right]$，概率为 $\\dfrac{3}{4}$。\n+ 选择 $\\left[3,5\\right]$，概率为 $\\dfrac{1}{2}$。\n+ 选择 $\\left[4,5\\right]$，概率为 $\\dfrac{3}{4}$。\n\n结果为 $\\dfrac{\\dfrac{3}{4}+\\dfrac{1}{2}+\\dfrac{3}{4}+\\dfrac{5}{8}+\\dfrac{3}{4}+\\dfrac{1}{2}+\\dfrac{3}{4}}{7}=\\dfrac{37}{56}$，取模意义下为 $338690049$。\n\n------------\n\n**本题采用捆绑测试**\n\n+ Subtask 1 ( $1\\%$ )：$n=1$。\n+ Subtask 2 ( $13\\%$ )：$n\\leq100$。\n+ Subtask 3 ( $3\\%$ )：保证 $\\forall1\\leq i\\leq n,a_i=0$。\n+ Subtask 4 ( $3\\%$ )：保证 $\\forall1\\leq i\\leq n,a_i=1$。\n+ Subtask 5 ( $20\\%$ )：$n\\leq10^3$。\n+ Subtask 6 ( $15\\%$ )：$l=r$。\n+ Subtask 7 ( $20\\%$ )：$n\\leq 5\\times 10^5$。\n+ Subtask 8 ( $25\\%$ )：无特殊限制。\n\n对于所有数据，$1\\leq n\\leq5\\times 10^6,1\\leq l\\leq r\\leq n$。", "locale": "zh-CN", "translations": {"en": {"title": "Anagram Collapse", "background": "> The laws of nature are hidden in the darkness.\n\nUnder the moonlight, Fiona and a group of believers who share the same faith gather together, waiting for the god they believe in to arrive.\n\n“Dear God, we are willing to follow you forever.”", "description": "The god wants to test whether his believers are loyal, and he decides to use luck as the test.\n\nThe god has prepared $n$ questions in advance. Each question has two choices: **“relatively radical”** and **“relatively conservative”**. The god has already fixed his own choices.\n\nTo test his believers, the god will **uniformly choose one** from all feasible ways of selecting questions (a feasible way means choosing **a consecutive** $k$ questions, with $l\\leq k\\leq r$, where $l,r$ are given). Then the believers will answer each of the $k$ questions in order with either “relatively radical” or “relatively conservative”. The god will judge whether a believer is loyal based on his own choices and that believer’s answers.\n\nThe judging rules are:\n\n+ This is the first question: no matter what the answer is, the god is willing to believe the believer is loyal.\n+ This is not the first question: if the believer’s previous answer is the same as the god’s choice, then the god will require them to explore more advanced choices, so the believer’s answer to this question **cannot be more conservative than the god’s choice**; otherwise, the god will require the believer to obey him, so the believer’s answer to this question **cannot be more radical than the god’s choice**.\n\nIf the believer’s answers satisfy the above requirements, then the believer is loyal.\n\nNow, the god wants to know: if a believer answers each question **uniformly at random with “relatively radical” or “relatively conservative”**, what is the probability that the believer is loyal? He asks you this question through Fiona, and requires you to output the result modulo $998244353$. If you cannot answer in time, you will lose the god’s trust.\n\n------------\n\n#### Simplified statement:\n\nGiven a binary string $a$ of length $n$ and $l,r(l\\leq r)$.\n\nFor two binary strings $p,q$ of the same length $k$, we say that $q$ is “loyal” to $p$ if and only if $p$ and $q$ satisfy:\n\n+ For any $1<i\\leq k$, if $q_{i-1}=p_{i-1}$, then $q_i\\geq p_i$, otherwise $q_i\\leq p_i$.\n\nYou need to compute the probability that: **first, uniformly choose a substring of $a$ whose length $k$ satisfies $l\\leq k\\leq r$**, and then **uniformly choose a binary string $b$ of length $k$**, such that $b$ is “loyal” to that substring. Output the result modulo $998244353$.", "inputFormat": "The first line contains three integers $n,l,r$, as described above.\n\nThe second line contains a string of length $n$, representing $a$. It is guaranteed that the string contains only characters `0` and `1`.", "outputFormat": "Output one integer in one line, representing the answer.", "hint": "#### Explanation for Sample 1:\n\nWe use $\\left[l,r\\right]$ to denote the interval where the chosen substring lies.\n\n+ Choose $\\left[1,2\\right]$. The substring is `01`, with length $2$. There are $3$ binary strings that are “loyal” to this substring, so the probability is $\\dfrac{3}{4}$.\n+ Choose $\\left[1,3\\right]$. The substring is `011`, with length $3$. There are $4$ binary strings that are “loyal” to this substring, so the probability is $\\dfrac{1}{2}$.\n+ Choose $\\left[2,3\\right]$. The probability is $\\dfrac{3}{4}$.\n\n+ Choose $\\left[2,4\\right]$. The probability is $\\dfrac{5}{8}$.\n+ Choose $\\left[3,4\\right]$. The probability is $\\dfrac{3}{4}$.\n+ Choose $\\left[3,5\\right]$. The probability is $\\dfrac{1}{2}$.\n+ Choose $\\left[4,5\\right]$. The probability is $\\dfrac{3}{4}$.\n\nSo the result is $\\dfrac{\\dfrac{3}{4}+\\dfrac{1}{2}+\\dfrac{3}{4}+\\dfrac{5}{8}+\\dfrac{3}{4}+\\dfrac{1}{2}+\\dfrac{3}{4}}{7}=\\dfrac{37}{56}$, which is $338690049$ modulo $998244353$.\n\n------------\n\n**This problem uses bundled testdata.**\n\n+ Subtask 1 ( $1\\%$ ): $n=1$.\n+ Subtask 2 ( $13\\%$ ): $n\\leq100$.\n+ Subtask 3 ( $3\\%$ ): Guaranteed that $\\forall1\\leq i\\leq n,a_i=0$.\n+ Subtask 4 ( $3\\%$ ): Guaranteed that $\\forall1\\leq i\\leq n,a_i=1$.\n+ Subtask 5 ( $20\\%$ ): $n\\leq10^3$.\n+ Subtask 6 ( $15\\%$ ): $l=r$.\n+ Subtask 7 ( $20\\%$ ): $n\\leq 5\\times 10^5$.\n+ Subtask 8 ( $25\\%$ ): No special constraints.\n\nConstraints: for all testdata, $1\\leq n\\leq5\\times 10^6,1\\leq l\\leq r\\leq n$。\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "异位坍缩", "background": ">自然的法则隐藏在黑暗之中。\n\n月光之下，菲欧娜和一群与她有着同样信仰的信徒们聚集在一起，等待着他们所信仰的神明降临。\n\n「神明大人，我们愿意永远追随您。」", "description": "神明想要测试他的信徒们是否忠诚，他决定用运气来进行测试。\n\n神明事先准备了 $n$ 个问题，每个问题都有两种选择：**「相对激进的」** 和 **「相对保守的」**。神明已经定好了自己的选择。\n\n为了考验他的信徒们，神明会在所有可行的问题选择方式中**等概率选出一种**（可行的选择方式指选出**连续的** $k$ 个问题，满足 $l\\leq k\\leq r$，其中 $l,r$ 给定），然后信徒们会依次对这 $k$ 个问题中的每个问题回答「相对激进的」或「相对保守的」。神明会根据自己的选择以及某个信徒的回答来判定这名信徒是否忠诚。\n\n神明的判定方式是这样的：\n\n+ 这是第一个问题：无论回答如何，神明都愿意相信这名信徒是忠诚的。\n+ 这不是第一个问题：如果这名信徒的上一个回答与神明的选择相同，那么神明会需要他去对更先进的选择进行探索，因此这名信徒在这个问题的回答**不能比神明的选择更保守**；否则，神明会要求这名信徒服从于自己，在这个问题的回答**不能比神明的选择更激进**。\n\n如果这名信徒的回答满足上述要求，那么这名信徒就是忠诚的。\n\n现在，神明想要知道，如果信徒对每个问题都会**等概率回答「相对激进的」或「相对保守的」**，那么一名信徒有多大的概率会是忠诚的。他通过菲欧娜向你提出了这个问题，并要求你将结果对 $998244353$ 取模。如果你无法及时回答出，那么你就会失去神明的信任。\n\n------------\n\n#### 简要题意：\n\n给定一个长度为 $n$ 的 01 串 $a$ 以及 $l,r(l\\leq r)$。\n\n对于两个长度均为 $k$ 的 01 串 $p,q$，我们认为 $q$ 对于 $p$ 是「忠诚的」，当且仅当 $p$ 和 $q$ 满足如下要求：\n\n+ 对于任意 $1<i\\leq k$，如果 $q_{i-1}=p_{i-1}$，那么 $q_i\\geq p_i$，否则 $q_i\\leq p_i$。\n\n你需要求出如果**先等概率随机选出一个长度 $k$ 满足 $l\\leq k\\leq r$ 的 $a$ 的子串**，然后**再等概率随机出一个长度为 $k$ 的 01 串 $b$**，有多大的概率使得 $b$ 对于这个子串是「忠诚的」，结果对 $998244353$ 取模。", "inputFormat": "第一行三个整数 $n,l,r$，意义如上。\n\n第二行有一个长度为 $n$ 的字符串，表示 $a$。保证字符串只含字符 `0` 和 `1`。", "outputFormat": "一行一个整数，表示结果。", "hint": "#### 样例一解释：\n\n我们用 $\\left[l,r\\right]$ 表示所选择的子串所在区间。\n\n+ 选择 $\\left[1,2\\right]$，子串为 `01`，长度为 $2$，有 $3$ 个 01 串对这个子串是「忠诚的」，概率为 $\\dfrac{3}{4}$。\n+ 选择 $\\left[1,3\\right]$，子串为 `011`，长度为 $3$，有 $4$ 个 01 串对这个子串是「忠诚的」，概率为 $\\dfrac{1}{2}$。\n+ 选择 $\\left[2,3\\right]$，概率为 $\\dfrac{3}{4}$。\n\n+ 选择 $\\left[2,4\\right]$，概率为 $\\dfrac{5}{8}$。\n+ 选择 $\\left[3,4\\right]$，概率为 $\\dfrac{3}{4}$。\n+ 选择 $\\left[3,5\\right]$，概率为 $\\dfrac{1}{2}$。\n+ 选择 $\\left[4,5\\right]$，概率为 $\\dfrac{3}{4}$。\n\n结果为 $\\dfrac{\\dfrac{3}{4}+\\dfrac{1}{2}+\\dfrac{3}{4}+\\dfrac{5}{8}+\\dfrac{3}{4}+\\dfrac{1}{2}+\\dfrac{3}{4}}{7}=\\dfrac{37}{56}$，取模意义下为 $338690049$。\n\n------------\n\n**本题采用捆绑测试**\n\n+ Subtask 1 ( $1\\%$ )：$n=1$。\n+ Subtask 2 ( $13\\%$ )：$n\\leq100$。\n+ Subtask 3 ( $3\\%$ )：保证 $\\forall1\\leq i\\leq n,a_i=0$。\n+ Subtask 4 ( $3\\%$ )：保证 $\\forall1\\leq i\\leq n,a_i=1$。\n+ Subtask 5 ( $20\\%$ )：$n\\leq10^3$。\n+ Subtask 6 ( $15\\%$ )：$l=r$。\n+ Subtask 7 ( $20\\%$ )：$n\\leq 5\\times 10^5$。\n+ Subtask 8 ( $25\\%$ )：无特殊限制。\n\n对于所有数据，$1\\leq n\\leq5\\times 10^6,1\\leq l\\leq r\\leq n$。", "locale": "zh-CN"}}}
{"pid": "P7496", "type": "P", "difficulty": 6, "samples": [["3\n1 2 3\n1 2 3\n", "777777785"], ["12\n1 3 4 2 3 5 7 3 5 6 8 9\n4 3 10 2 5 6 4 8 2 9 12 5\n", "931089600"]], "limits": {"time": [1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500, 1500], "memory": [262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144]}, "tags": ["数学", "2021", "O2优化", "最大公约数 gcd", "莫比乌斯反演"], "title": "干杯！再会！", "background": ">酒酣之时，等待你的会是……\n\n黛米和哥哥在一个小城镇里经营着一家小酒吧。靠着哥哥调制的多夫林酒，这间小酒吧的生意也逐渐兴隆起来。", "description": "这家小店有 $n$ 位常驻顾客。第 $i$ 位顾客来到这家小店时都会带上一瓶美味度为 $a_i$ 的底酒和一份美味度为 $b_i$ 的调料。这些顾客会让黛米帮忙调酒。对于一瓶美味度为 $x$ 的底酒和一份美味度为 $y$ 的调料，如果黛米将它们调制在一起，就能得到一瓶美味度为 $\\gcd(x,y)$ 的美酒（我们认为美味度数值越低代表酒越好喝）。\n\n这一天，这些顾客同时来到了这家小店想要黛米帮忙调酒。然而黛米在前一天喝了太多的酒导致意识错乱了，这导致她将调料加入到了错误的底酒里。不过好在这些顾客并不在意，他们只想知道对于**所有**黛米加入调料的情况下，他们将会拿到的酒的美味度的**方差**的**和**在对 $10^9+7$ 取模意义下是多少。如果你能回答出他们的问题，那么他们会很愿意帮你支付酒钱。\n\n------------\n#### 简要题意：\n给定 $n$ 以及两个长度为 $n$ 的序列 $a,b$。对于一个 $1$ 到 $n$ 的排列 $p$，记 $c_i=\\gcd(a_i,b_{p_i})$，$\\sigma(c)$ 表示序列 $c$ 中所有元素的**方差**（方差公式详见提示），求：\n\n$$\\sum\\limits_{p}\\sigma(c)$$\n\n对 $10^9+7$ 取模。", "inputFormat": "第一行一个整数 $n$，意义如上。\n\n第二行有 $n$ 个整数，第 $i$ 个整数表示 $a_i$。\n\n第三行有 $n$ 个整数，第 $i$ 个整数表示 $b_i$。", "outputFormat": "一行一个整数，表示答案。", "hint": "#### 样例一解释\n+ $p=\\{1,2,3\\},c=\\{1,2,3\\},\\sigma(c)=\\dfrac{2}{3}$。\n+ $p=\\{1,3,2\\},c=\\{1,1,1\\},\\sigma(c)=0$。\n+ $p=\\{2,1,3\\},c=\\{1,1,3\\},\\sigma(c)=\\dfrac{8}{9}$。\n+ $p=\\{2,3,1\\},c=\\{1,1,1\\},\\sigma(c)=0$。\n+ $p=\\{3,1,2\\},c=\\{1,1,1\\},\\sigma(c)=0$。\n+ $p=\\{3,2,1\\},c=\\{1,2,1\\},\\sigma(c)=\\dfrac{2}{9}$。\n\n总和为 $\\dfrac{16}{9}$，对 $10^9+7$ 取模意义下为 $777777785$。\n\n------------\n#### 数据范围\n\n**本题采用捆绑测试**。\n\n+ Subtask 1 ( $5\\%$ )：$n\\leq8$。\n+ Subtask 2 ( $15\\%$ )：$n,a_i,b_i\\leq100$。\n+ Subtask 3 ( $25\\%$ )：$a_i,b_i\\leq10^3$。\n+ Subtask 4 ( $25\\%$ )：$n,a_i,b_i\\leq 10^5$。\n+ Subtask 5 ( $30\\%$ )：无特殊限制。\n\n对于所有数据，$2\\leq n\\leq 10^6,1\\leq a_i,b_i\\leq 10^6$。\n\n------------\n对于一个长度为 $n$ 的序列 $x$，方差 $\\sigma(x)=\\sum\\limits_{i=1}^n\\dfrac{1}{n}(x_i-\\bar{x})^2$，其中 $\\bar{x}$ 表示所有元素的平均数（$\\bar{x}=\\dfrac{1}{n}\\sum\\limits_{i=1}^nx_i$）。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "干杯！再会！", "background": ">酒酣之时，等待你的会是……\n\n黛米和哥哥在一个小城镇里经营着一家小酒吧。靠着哥哥调制的多夫林酒，这间小酒吧的生意也逐渐兴隆起来。", "description": "这家小店有 $n$ 位常驻顾客。第 $i$ 位顾客来到这家小店时都会带上一瓶美味度为 $a_i$ 的底酒和一份美味度为 $b_i$ 的调料。这些顾客会让黛米帮忙调酒。对于一瓶美味度为 $x$ 的底酒和一份美味度为 $y$ 的调料，如果黛米将它们调制在一起，就能得到一瓶美味度为 $\\gcd(x,y)$ 的美酒（我们认为美味度数值越低代表酒越好喝）。\n\n这一天，这些顾客同时来到了这家小店想要黛米帮忙调酒。然而黛米在前一天喝了太多的酒导致意识错乱了，这导致她将调料加入到了错误的底酒里。不过好在这些顾客并不在意，他们只想知道对于**所有**黛米加入调料的情况下，他们将会拿到的酒的美味度的**方差**的**和**在对 $10^9+7$ 取模意义下是多少。如果你能回答出他们的问题，那么他们会很愿意帮你支付酒钱。\n\n------------\n#### 简要题意：\n给定 $n$ 以及两个长度为 $n$ 的序列 $a,b$。对于一个 $1$ 到 $n$ 的排列 $p$，记 $c_i=\\gcd(a_i,b_{p_i})$，$\\sigma(c)$ 表示序列 $c$ 中所有元素的**方差**（方差公式详见提示），求：\n\n$$\\sum\\limits_{p}\\sigma(c)$$\n\n对 $10^9+7$ 取模。", "inputFormat": "第一行一个整数 $n$，意义如上。\n\n第二行有 $n$ 个整数，第 $i$ 个整数表示 $a_i$。\n\n第三行有 $n$ 个整数，第 $i$ 个整数表示 $b_i$。", "outputFormat": "一行一个整数，表示答案。", "hint": "#### 样例一解释\n+ $p=\\{1,2,3\\},c=\\{1,2,3\\},\\sigma(c)=\\dfrac{2}{3}$。\n+ $p=\\{1,3,2\\},c=\\{1,1,1\\},\\sigma(c)=0$。\n+ $p=\\{2,1,3\\},c=\\{1,1,3\\},\\sigma(c)=\\dfrac{8}{9}$。\n+ $p=\\{2,3,1\\},c=\\{1,1,1\\},\\sigma(c)=0$。\n+ $p=\\{3,1,2\\},c=\\{1,1,1\\},\\sigma(c)=0$。\n+ $p=\\{3,2,1\\},c=\\{1,2,1\\},\\sigma(c)=\\dfrac{2}{9}$。\n\n总和为 $\\dfrac{16}{9}$，对 $10^9+7$ 取模意义下为 $777777785$。\n\n------------\n#### 数据范围\n\n**本题采用捆绑测试**。\n\n+ Subtask 1 ( $5\\%$ )：$n\\leq8$。\n+ Subtask 2 ( $15\\%$ )：$n,a_i,b_i\\leq100$。\n+ Subtask 3 ( $25\\%$ )：$a_i,b_i\\leq10^3$。\n+ Subtask 4 ( $25\\%$ )：$n,a_i,b_i\\leq 10^5$。\n+ Subtask 5 ( $30\\%$ )：无特殊限制。\n\n对于所有数据，$2\\leq n\\leq 10^6,1\\leq a_i,b_i\\leq 10^6$。\n\n------------\n对于一个长度为 $n$ 的序列 $x$，方差 $\\sigma(x)=\\sum\\limits_{i=1}^n\\dfrac{1}{n}(x_i-\\bar{x})^2$，其中 $\\bar{x}$ 表示所有元素的平均数（$\\bar{x}=\\dfrac{1}{n}\\sum\\limits_{i=1}^nx_i$）。", "locale": "zh-CN"}}}
{"pid": "P7497", "type": "P", "difficulty": 6, "samples": [["5 5\n1 5 4 3 6\n1 2 4 3\n3 1 2 2\n4 2 5\n2 2 3 4\n4 1 3", "27\n37"], ["10 12\n4 2 1 5 10 3 2 4 6 7\n2 3 7 4\n1 2 9 5\n3 2 4 5\n3 4 7 2\n4 3 9\n1 1 8 2\n2 4 5 2\n3 6 8 2\n4 2 3\n1 2 10 6\n2 7 9 3\n4 1 10", "129\n16\n314"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["线段树", "2021"], "title": "四方喝彩", "background": ">念出他们的名字，让他们，再次回到舞台。\n\n麦克要在月亮河马戏团表演全新的杂技节目了！", "description": "麦克一共有 $n$ 个新节目，每个节目的惊险值为 $a_i$。\n\n接下来麦克可以通过若干次操作来对每个节目的惊险值进行变换：\n\n+ 麦克使用冰球，对于所有的 $l\\leq i\\leq r$，第 $i$ 个节目的惊险值会增加 $x$。\n\n+ 麦克使用土球，对于所有的 $l\\leq i\\leq r$，第 $i$ 个节目的惊险值会乘以 $x$。\n\n+ 麦克使用火球，对于所有的 $l\\leq i\\leq r$，第 $i$ 个节目的惊险值在接下来的 $x$ 个操作中**不会受到冰球和土球的影响**。火球效果**不会被替换**。\n\n当然观众对每个节目的惊险值也很好奇，所以你需要在操作过程中帮麦克回答对于所有 $l\\leq i\\leq r$，第 $i$ 个节目的惊险值之和。当然观众不希望惊险值过大，所以你需要将结果对 $10^9+7$ 取模。\n\n------------\n#### 简要题意：\n\n给你一个长度为 $n$ 的数组 $a$，你需要支持如下几个操作：\n\n1. `l r x`：对所有 $l\\leq i\\leq r$，令 $a_i$ 增加 $x$。\n2. `l r x`：对所有 $l\\leq i\\leq r$，令 $a_i$ 乘上 $x$。\n3. `l r x`：对所有 $l\\leq i\\leq r$，在接下来的 $x$ 个操作内，$a_i$ 将会被封锁，**不会受到操作 1 和操作 2 的影响**（设本次操作为第 $k$ 次操作，则第 $k+1,k+2,\\cdots,k+x$ 次操作中的所有操作 1和操作 2 不会对区间 $\\left[l,r\\right]$ 产生影响）。已有的封锁效果**不会被替换**（即假设第 $3$ 次有一个操作 3 对某个位置进行封锁，封锁时间为 $5$，第 $5$ 次操作同样对这个位置进行封锁，封锁时间为 $2$ 那么实际上这个位置在第 $4$ 次操作到第 $8$ 次操作的时间内都会被封锁）（感性理解就是后面时间短的封锁不会使前面时间长的封锁失效）。\n4. `l r`：询问 $\\sum\\limits_{l\\leq i\\leq r}a_i$，对 $10^9+7$ 取模。", "inputFormat": "第一行有两个正整数 $n,m$，分别表示数组长度和操作数。\n\n第二行会有 $n$ 个整数 $a_i$，表示数组 $a$。\n\n接下来 $m$ 行，每行有三个整数 $opt,l,r$ 表示操作编号以及这次操作的 $l,r$，如果 $opt\\leq 3$，那么还会有一个整数 $x$，表示这次操作的 $x$。", "outputFormat": "对于所有的操作 4，一行一个整数表示结果，对 $10^9+7$ 取模。", "hint": "#### 样例一解释\n一开始数组为 $\\{1,5,4,3,6\\}$。\n\n+ 执行第 $1$ 次操作，此时数组变为 $\\{1,8,7,6,6\\}$。\n+ 执行第 $2$ 次操作，此时数组不变。\n+ 执行第 $3$ 次操作，询问结果为 $27$。\n+ 执行第 $4$ 次操作，因为此时 $a_2$ 在第 $2$ 次操作中被封锁还未解除，所以这次操作只对 $a_3$ 产生影响，数组变为 $\\{1,8,28,6,6\\}$。\n+ 执行第 $5$ 次操作，询问结果为 $37$。\n\n------------\n#### 数据范围\n\n**本题采用捆绑测试**。\n\n+ Subtask 1 ( $25\\%$ )：$n,m\\leq2\\times10^3$。\n+ Subtask 2 ( $8\\%$ )：没有操作 3。\n+ Subtask 3 ( $17\\%$ )：对于所有操作 4，保证 $l=r$。\n+ Subtask 4 ( $50\\%$ )：无特殊限制。\n\n对于所有数据，$1\\leq n,m\\leq 2\\times 10^5,0\\leq a_i<10^9+7,1\\leq l\\leq r\\leq n$，对于所有操作 1 和操作 2，保证 $0\\leq x<10^9+7$，对于所有操作 3，设其为第 $k$ 次操作，保证 $0\\leq x\\leq m-k$。", "locale": "zh-CN", "translations": {"zh-CN": {"title": "四方喝彩", "background": ">念出他们的名字，让他们，再次回到舞台。\n\n麦克要在月亮河马戏团表演全新的杂技节目了！", "description": "麦克一共有 $n$ 个新节目，每个节目的惊险值为 $a_i$。\n\n接下来麦克可以通过若干次操作来对每个节目的惊险值进行变换：\n\n+ 麦克使用冰球，对于所有的 $l\\leq i\\leq r$，第 $i$ 个节目的惊险值会增加 $x$。\n\n+ 麦克使用土球，对于所有的 $l\\leq i\\leq r$，第 $i$ 个节目的惊险值会乘以 $x$。\n\n+ 麦克使用火球，对于所有的 $l\\leq i\\leq r$，第 $i$ 个节目的惊险值在接下来的 $x$ 个操作中**不会受到冰球和土球的影响**。火球效果**不会被替换**。\n\n当然观众对每个节目的惊险值也很好奇，所以你需要在操作过程中帮麦克回答对于所有 $l\\leq i\\leq r$，第 $i$ 个节目的惊险值之和。当然观众不希望惊险值过大，所以你需要将结果对 $10^9+7$ 取模。\n\n------------\n#### 简要题意：\n\n给你一个长度为 $n$ 的数组 $a$，你需要支持如下几个操作：\n\n1. `l r x`：对所有 $l\\leq i\\leq r$，令 $a_i$ 增加 $x$。\n2. `l r x`：对所有 $l\\leq i\\leq r$，令 $a_i$ 乘上 $x$。\n3. `l r x`：对所有 $l\\leq i\\leq r$，在接下来的 $x$ 个操作内，$a_i$ 将会被封锁，**不会受到操作 1 和操作 2 的影响**（设本次操作为第 $k$ 次操作，则第 $k+1,k+2,\\cdots,k+x$ 次操作中的所有操作 1和操作 2 不会对区间 $\\left[l,r\\right]$ 产生影响）。已有的封锁效果**不会被替换**（即假设第 $3$ 次有一个操作 3 对某个位置进行封锁，封锁时间为 $5$，第 $5$ 次操作同样对这个位置进行封锁，封锁时间为 $2$ 那么实际上这个位置在第 $4$ 次操作到第 $8$ 次操作的时间内都会被封锁）（感性理解就是后面时间短的封锁不会使前面时间长的封锁失效）。\n4. `l r`：询问 $\\sum\\limits_{l\\leq i\\leq r}a_i$，对 $10^9+7$ 取模。", "inputFormat": "第一行有两个正整数 $n,m$，分别表示数组长度和操作数。\n\n第二行会有 $n$ 个整数 $a_i$，表示数组 $a$。\n\n接下来 $m$ 行，每行有三个整数 $opt,l,r$ 表示操作编号以及这次操作的 $l,r$，如果 $opt\\leq 3$，那么还会有一个整数 $x$，表示这次操作的 $x$。", "outputFormat": "对于所有的操作 4，一行一个整数表示结果，对 $10^9+7$ 取模。", "hint": "#### 样例一解释\n一开始数组为 $\\{1,5,4,3,6\\}$。\n\n+ 执行第 $1$ 次操作，此时数组变为 $\\{1,8,7,6,6\\}$。\n+ 执行第 $2$ 次操作，此时数组不变。\n+ 执行第 $3$ 次操作，询问结果为 $27$。\n+ 执行第 $4$ 次操作，因为此时 $a_2$ 在第 $2$ 次操作中被封锁还未解除，所以这次操作只对 $a_3$ 产生影响，数组变为 $\\{1,8,28,6,6\\}$。\n+ 执行第 $5$ 次操作，询问结果为 $37$。\n\n------------\n#### 数据范围\n\n**本题采用捆绑测试**。\n\n+ Subtask 1 ( $25\\%$ )：$n,m\\leq2\\times10^3$。\n+ Subtask 2 ( $8\\%$ )：没有操作 3。\n+ Subtask 3 ( $17\\%$ )：对于所有操作 4，保证 $l=r$。\n+ Subtask 4 ( $50\\%$ )：无特殊限制。\n\n对于所有数据，$1\\leq n,m\\leq 2\\times 10^5,0\\leq a_i<10^9+7,1\\leq l\\leq r\\leq n$，对于所有操作 1 和操作 2，保证 $0\\leq x<10^9+7$，对于所有操作 3，设其为第 $k$ 次操作，保证 $0\\leq x\\leq m-k$。", "locale": "zh-CN"}}}
{"pid": "P7498", "type": "P", "difficulty": 7, "samples": [["6 4 499122177\n1 2\n1 3\n5 3\n4 6\n4 3\n2 N 1 S\n3 S 1 S\n5 N 6 N\n1 S 4 N", "3\n6\n17\n11"], ["10 6 199648871\n3 7\n4 9\n2 3\n5 6\n7 10\n5 7\n5 9\n8 2\n1 3\n10 S 5 S\n1 N 7 S\n1 N 4 N\n1 S 4 N\n4 N 3 S\n7 N 4 N", "332748127\n8\n665496262\n665496261\n665496253\n831870314"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["2021", "O2优化", "树形 DP", "期望"], "title": "磁控法则", "background": ">那只不过是别人的不幸。\n\n诺顿进入了一个结构复杂的洞穴。在之前的勘察中，他已经得知了这个洞穴里有他梦寐以求的宝藏。\n\n然而这个洞穴是如此的黑暗与复杂，以至于他探索了许久都没有找到宝藏的所在地。但宝藏强大的吸引力仍驱使着他继续搜寻。然而很快他就意识到了不对劲，因为那股吸引力不仅作用在他脑海中，也作用在他身体上——宝藏的防御机关正释放巨大的磁力试图驱逐外来者。\n\n「果然，这就是它自带的保护机制吗？」诺顿笑了笑，拿出了一小块散发着奇特光芒的金属。\n\n「不过，我也是有准备的。」", "description": "诺顿所在的洞穴可以看作是由 $n$ 个洞窟和 $n-1$ 条通道形成的树状结构，诺顿在石窟 $s$，宝藏在石窟 $t$。在宝藏所在的石窟里有一块拥有强大磁场的特殊的磁铁，诺顿身上也有一块小型的同样材质的磁铁。宝藏石窟里的磁铁**只有一个磁极**（N 或 S），并且**磁极不会发生变化**。诺顿身上的磁铁也**只有一个磁极**（N 或 S），但**每个时刻开始时会有 $p$ 的概率切换磁极**（N 变成 S，S 变成 N）。\n\n每个时刻诺顿的移动方式由宝藏石窟磁铁的磁极和诺顿身上磁铁的磁极决定：\n\n1. 两块磁铁磁极不同。此时两块磁铁会触发「吸引」效果。诺顿会因为磁铁间的吸引力移动到与 $s$ 相连的石窟中到 $t$ 距离 $-1$ 的石窟中（即**以 $t$ 为根时 $s$ 的父亲**）。\n\n2. 两块磁铁磁极相同。此时两块磁铁会触发「弹射」效果。诺顿会因为磁铁间的排斥力**等概率**移动到与 $s$ 相连的石窟中到 $t$ 距离 $+1$ 的石窟（即**以 $t$ 为根时 $s$ 的任意一个儿子**）。如果没有满足的石窟，将触发「眩晕」效果，下个时刻诺顿将**不进行任何的移动，也不会进行任何的磁极切换**。\n\n经过一段时间的勘察，诺顿已经知道了整个洞穴的结构以及磁极切换的概率 $p$。为了更好的寻找宝藏，他每次会向你提出询问，你需要回答他如果一开始诺顿在石窟 $x$，身上磁铁磁极为 $c_1$，宝藏在石窟 $y$，石窟内磁铁磁极为 $c_2$，期望在多少时刻后诺顿可以找到宝藏。", "inputFormat": "第一行三个整数 $n,q,p$，分别表示石窟数，询问数和磁极切换概率。其中磁极切换概率为在 $998244353$ 取模意义下的概率。\n\n接下来 $n-1$ 行，每行两个正整数 $u,v$，表示石窟 $u$ 和石窟 $v$ 之间存在一条通道。保证最后结构为一棵树。\n\n接下来 $q$ 行，每行**依次**有一个正整数 $x$，一个字符 $c_1$，一个正整数 $y$，一个字符 $c_2$，表示一个询问，各自意义如上。保证 $c_1,c_2$ 为 `N` 或 `S`。", "outputFormat": "$q$ 行，每行一个非负整数，表示询问答案对 $998244353$ 取模后的结果。", "hint": "#### 样例一解释\n每个时刻磁极切换概率为 $\\dfrac{1}{2}$。\n\n洞窟结构如下：  \n![](https://cdn.luogu.com.cn/upload/image_hosting/od4ixuog.png)\n\n对于询问 $1$，诺顿在第 $1$ 个时刻有 $\\dfrac{1}{2}$ 的概率移动到 $1$，有 $\\dfrac{1}{2}$ 的概率触发「眩晕」进入第 $3$ 个时刻。在第 $3$ 个时刻同样有 $\\dfrac{1}{2}$ 的概率移动到 $1$，有 $\\dfrac{1}{2}$ 的概率触发「眩晕」进入第 $5$ 个时刻……期望结果为 $1\\times\\dfrac{1}{2}+3\\times\\left(\\dfrac{1}{2}\\right)^2+5\\times\\left(\\dfrac{1}{2}\\right)^3+\\ldots=3$。\n\n------------\n#### 数据范围\n\n**本题采用捆绑测试**。\n\n+ Subtask 1 ( $10\\%$ )：$n,q\\leq15$。\n+ Subtask 2 ( $20\\%$ )：$n\\leq10^3$。\n+ Subtask 3 ( $25\\%$ )：对于所有询问，保证 $y=1$。\n+ Subtask 4 ( $45\\%$ )：无特殊限制。\n\n对于所有数据，$2\\leq n\\leq5\\times 10^5,1\\leq q\\leq5\\times10^5,1\\leq u,v,x,y\\leq n,x\\neq y,2\\leq p\\leq998244352$。\n\n------------\n**本题读入量较大，请使用较快的读入方式。**", "locale": "zh-CN", "translations": {"zh-CN": {"title": "磁控法则", "background": ">那只不过是别人的不幸。\n\n诺顿进入了一个结构复杂的洞穴。在之前的勘察中，他已经得知了这个洞穴里有他梦寐以求的宝藏。\n\n然而这个洞穴是如此的黑暗与复杂，以至于他探索了许久都没有找到宝藏的所在地。但宝藏强大的吸引力仍驱使着他继续搜寻。然而很快他就意识到了不对劲，因为那股吸引力不仅作用在他脑海中，也作用在他身体上——宝藏的防御机关正释放巨大的磁力试图驱逐外来者。\n\n「果然，这就是它自带的保护机制吗？」诺顿笑了笑，拿出了一小块散发着奇特光芒的金属。\n\n「不过，我也是有准备的。」", "description": "诺顿所在的洞穴可以看作是由 $n$ 个洞窟和 $n-1$ 条通道形成的树状结构，诺顿在石窟 $s$，宝藏在石窟 $t$。在宝藏所在的石窟里有一块拥有强大磁场的特殊的磁铁，诺顿身上也有一块小型的同样材质的磁铁。宝藏石窟里的磁铁**只有一个磁极**（N 或 S），并且**磁极不会发生变化**。诺顿身上的磁铁也**只有一个磁极**（N 或 S），但**每个时刻开始时会有 $p$ 的概率切换磁极**（N 变成 S，S 变成 N）。\n\n每个时刻诺顿的移动方式由宝藏石窟磁铁的磁极和诺顿身上磁铁的磁极决定：\n\n1. 两块磁铁磁极不同。此时两块磁铁会触发「吸引」效果。诺顿会因为磁铁间的吸引力移动到与 $s$ 相连的石窟中到 $t$ 距离 $-1$ 的石窟中（即**以 $t$ 为根时 $s$ 的父亲**）。\n\n2. 两块磁铁磁极相同。此时两块磁铁会触发「弹射」效果。诺顿会因为磁铁间的排斥力**等概率**移动到与 $s$ 相连的石窟中到 $t$ 距离 $+1$ 的石窟（即**以 $t$ 为根时 $s$ 的任意一个儿子**）。如果没有满足的石窟，将触发「眩晕」效果，下个时刻诺顿将**不进行任何的移动，也不会进行任何的磁极切换**。\n\n经过一段时间的勘察，诺顿已经知道了整个洞穴的结构以及磁极切换的概率 $p$。为了更好的寻找宝藏，他每次会向你提出询问，你需要回答他如果一开始诺顿在石窟 $x$，身上磁铁磁极为 $c_1$，宝藏在石窟 $y$，石窟内磁铁磁极为 $c_2$，期望在多少时刻后诺顿可以找到宝藏。", "inputFormat": "第一行三个整数 $n,q,p$，分别表示石窟数，询问数和磁极切换概率。其中磁极切换概率为在 $998244353$ 取模意义下的概率。\n\n接下来 $n-1$ 行，每行两个正整数 $u,v$，表示石窟 $u$ 和石窟 $v$ 之间存在一条通道。保证最后结构为一棵树。\n\n接下来 $q$ 行，每行**依次**有一个正整数 $x$，一个字符 $c_1$，一个正整数 $y$，一个字符 $c_2$，表示一个询问，各自意义如上。保证 $c_1,c_2$ 为 `N` 或 `S`。", "outputFormat": "$q$ 行，每行一个非负整数，表示询问答案对 $998244353$ 取模后的结果。", "hint": "#### 样例一解释\n每个时刻磁极切换概率为 $\\dfrac{1}{2}$。\n\n洞窟结构如下：  \n![](https://cdn.luogu.com.cn/upload/image_hosting/od4ixuog.png)\n\n对于询问 $1$，诺顿在第 $1$ 个时刻有 $\\dfrac{1}{2}$ 的概率移动到 $1$，有 $\\dfrac{1}{2}$ 的概率触发「眩晕」进入第 $3$ 个时刻。在第 $3$ 个时刻同样有 $\\dfrac{1}{2}$ 的概率移动到 $1$，有 $\\dfrac{1}{2}$ 的概率触发「眩晕」进入第 $5$ 个时刻……期望结果为 $1\\times\\dfrac{1}{2}+3\\times\\left(\\dfrac{1}{2}\\right)^2+5\\times\\left(\\dfrac{1}{2}\\right)^3+\\ldots=3$。\n\n------------\n#### 数据范围\n\n**本题采用捆绑测试**。\n\n+ Subtask 1 ( $10\\%$ )：$n,q\\leq15$。\n+ Subtask 2 ( $20\\%$ )：$n\\leq10^3$。\n+ Subtask 3 ( $25\\%$ )：对于所有询问，保证 $y=1$。\n+ Subtask 4 ( $45\\%$ )：无特殊限制。\n\n对于所有数据，$2\\leq n\\leq5\\times 10^5,1\\leq q\\leq5\\times10^5,1\\leq u,v,x,y\\leq n,x\\neq y,2\\leq p\\leq998244352$。\n\n------------\n**本题读入量较大，请使用较快的读入方式。**", "locale": "zh-CN"}}}
{"pid": "P7499", "type": "P", "difficulty": 1, "samples": [["1\n1 2 3 4 5\n", "2"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": [], "title": "「HMOI R1」概率", "background": "“傻子才相信概率。”", "description": "fz 退役之后正在学文化课。\n\nfz 见到一个题，这个题是这样的：\n\n给定区间 $[a, b]$ 和 $[c, d]$，求从其中各等概率选择一个整数，和等于 $e$ 的概率。\n\nfz 本来想把 “等于 $e$” 改成 “$\\in [e,f]$”，但是这样他就会变成辣鸡分类讨论出题人，所以他决定不改。\n\n为了方便，你只需输出答案乘 $(b-a+1)(d-c+1)$ 的结果。可以证明这个数是一个整数。", "inputFormat": "第一行一个整数 $T$，代表共有 $T$ 组数据。\n\n接下来 $T$ 行，每行五个整数 $a, b, c, d, e$。", "outputFormat": "共 $T$ 行，每组数据一行一个自然数，表示对应的答案。", "hint": "样例解释：\n\n对于样例的第一组数据，从 $[1,2]$ 和 $[3,4]$ 中各随机选出一个整数的方案共有 $4$ 种，其中只有 $\\{1,4\\}$ 和 $\\{2,3\\}$ 两种方案和为 $5$，故概率为 $\\dfrac12$。\n\n---------\n\n令 $N=\\max\\{|a|,|b|,|c|,|d|,|e|\\}$。\n\n对于所有数据：\n\n- $1 \\le T \\le 1000$；\n\n- $0 \\le N \\le 10^{18}$。\n\n-----------------\n\n**本题不采用捆绑测试。**\n\n| No.  | Constraints            | Score |\n| ---- | ---------------------- | ----- |\n| $1$  | 与样例相同             | $10$  |\n| $2$  | $N \\le 300$            | $10$  |\n| $3$  | $N \\le 5000$           | $30$  |\n| $4$  | $N \\le 10^9$           | $20$  |\n| $5$  | No further constraints | $30$  |\n\n---------\n\n- Idea: FZzzz  \n- Solution: FZzzz  \n- Code: FZzzz  \n- Data: FZzzz", "locale": "zh-CN", "translations": {"zh-CN": {"title": "「HMOI R1」概率", "background": "“傻子才相信概率。”", "description": "fz 退役之后正在学文化课。\n\nfz 见到一个题，这个题是这样的：\n\n给定区间 $[a, b]$ 和 $[c, d]$，求从其中各等概率选择一个整数，和等于 $e$ 的概率。\n\nfz 本来想把 “等于 $e$” 改成 “$\\in [e,f]$”，但是这样他就会变成辣鸡分类讨论出题人，所以他决定不改。\n\n为了方便，你只需输出答案乘 $(b-a+1)(d-c+1)$ 的结果。可以证明这个数是一个整数。", "inputFormat": "第一行一个整数 $T$，代表共有 $T$ 组数据。\n\n接下来 $T$ 行，每行五个整数 $a, b, c, d, e$。", "outputFormat": "共 $T$ 行，每组数据一行一个自然数，表示对应的答案。", "hint": "样例解释：\n\n对于样例的第一组数据，从 $[1,2]$ 和 $[3,4]$ 中各随机选出一个整数的方案共有 $4$ 种，其中只有 $\\{1,4\\}$ 和 $\\{2,3\\}$ 两种方案和为 $5$，故概率为 $\\dfrac12$。\n\n---------\n\n令 $N=\\max\\{|a|,|b|,|c|,|d|,|e|\\}$。\n\n对于所有数据：\n\n- $1 \\le T \\le 1000$；\n\n- $0 \\le N \\le 10^{18}$。\n\n-----------------\n\n**本题不采用捆绑测试。**\n\n| No.  | Constraints            | Score |\n| ---- | ---------------------- | ----- |\n| $1$  | 与样例相同             | $10$  |\n| $2$  | $N \\le 300$            | $10$  |\n| $3$  | $N \\le 5000$           | $30$  |\n| $4$  | $N \\le 10^9$           | $20$  |\n| $5$  | No further constraints | $30$  |\n\n---------\n\n- Idea: FZzzz  \n- Solution: FZzzz  \n- Code: FZzzz  \n- Data: FZzzz", "locale": "zh-CN"}}}
