{"pid": "P3796", "type": "P", "difficulty": 5, "samples": [["2\naba\nbab\nababababac\n6\nbeta\nalpha\nhaha\ndelta\ndede\ntata\ndedeltalphahahahototatalpha\n0", "4\naba\n2\nalpha\nhaha"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["字符串", "字典树 Trie", "AC 自动机"], "title": "AC 自动机（简单版 II）", "background": "", "description": "有 $N$ 个由小写字母组成的模式串以及一个文本串 $T$。每个模式串可能会在文本串中出现多次。你需要找出**哪些**模式串在文本串 $T$ 中出现的次数最多。\n", "inputFormat": "输入含多组数据。保证输入数据不超过 $50$ 组。\n\n每组数据的第一行为一个正整数 $N$，表示共有 $N$ 个模式串，$1 \\leq N \\leq 150$。\n\n接下去 $N$ 行，每行一个长度小于等于 $70$ 的模式串。下一行是一个长度小于等于 $10^6$ 的文本串 $T$。保证不存在两个相同的模式串。\n\n输入结束标志为 $N=0$。", "outputFormat": "对于每组数据，第一行输出模式串最多出现的次数，接下去若干行每行输出一个出现次数最多的模式串，按输入顺序排列。\n", "hint": "", "locale": "zh-CN", "translations": {"en": {"title": "AC Automaton (Simple Version II)", "background": "", "description": "There are $N$ pattern strings consisting of lowercase letters and a text string $T$. Each pattern may appear multiple times in the text. You need to find out **which** pattern strings appear the most times in the text $T$.", "inputFormat": "The input contains multiple test cases. There are at most $50$ test cases.\nThe first line of each test case contains a positive integer $N$, indicating the number of pattern strings, where $1 \\leq N \\leq 150$.\nThe next $N$ lines each contain a pattern string of length at most $70$. The next line contains a text string $T$ of length at most $10^6$. It is guaranteed that there are no duplicate pattern strings.\nThe input ends with $N = 0$.", "outputFormat": "For each test case, output on the first line the maximum number of occurrences among all pattern strings. Then output several lines, each containing one pattern string that achieves this maximum, in the same order as in the input.", "hint": "\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "AC 自动机（简单版 II）", "background": "", "description": "有 $N$ 个由小写字母组成的模式串以及一个文本串 $T$。每个模式串可能会在文本串中出现多次。你需要找出**哪些**模式串在文本串 $T$ 中出现的次数最多。\n", "inputFormat": "输入含多组数据。保证输入数据不超过 $50$ 组。\n\n每组数据的第一行为一个正整数 $N$，表示共有 $N$ 个模式串，$1 \\leq N \\leq 150$。\n\n接下去 $N$ 行，每行一个长度小于等于 $70$ 的模式串。下一行是一个长度小于等于 $10^6$ 的文本串 $T$。保证不存在两个相同的模式串。\n\n输入结束标志为 $N=0$。", "outputFormat": "对于每组数据，第一行输出模式串最多出现的次数，接下去若干行每行输出一个出现次数最多的模式串，按输入顺序排列。\n", "hint": "", "locale": "zh-CN"}}}
{"pid": "P3797", "type": "P", "difficulty": 5, "samples": [["4 4\n2 1 4\n2 2 4\n1 2 (\n2 2 4", "1\n0\n1"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["模拟", "线段树", "洛谷原创", "洛谷比赛"], "title": "妖梦斩木棒", "background": "![](https://cdn.luogu.com.cn/upload/pic/5848.png) \n\n妖梦是住在白玉楼的半人半灵，拥有使用剑术程度的能力。", "description": "有一天，妖梦正在练习剑术。地面上摆放着一根非常长的木棒，妖梦把它切成了等长的 $n$ 段。\n现在这根木棒可以看作由三种小段构成：中间的 $n - 2$ 段都是左右都被切断的断头，我们记作 `X`；最左边的一段和最右边的一段各有一个圆头，分别记作 `(` 和 `)`。\n\n幽幽子吃饱后闲来无事，决定戏弄一下妖梦。她拿来了许多这样的三种小段木棒，来替换掉妖梦切下来的 $n$ 段中的一部分，然后问妖梦一些问题。\n\n这些操作可以这样描述：\n\n- `1 x C` 将第 $x$ 个小段的木棒替换成 $C$ 型，$C$ 只会是 `X`, `(`, `)` 中的一种\n\n- `2 l r` 询问在区间 $[l, r]$ 中（包含两端），有多少个完整的木棒。\n\n完整的木棒左右两端必须分别为 `(` 和 `)`，并且中间要么什么都没有，要么只能有 `X`。\n\n虽然妖梦能够数清楚这些问题，但幽幽子觉得她回答得太慢了，你能教给妖梦一个更快的办法吗？", "inputFormat": "第一行包含两个整数 $n, m$，分别表示共有 $n$ 段木棒，以及有 $m$ 次操作。\n\n木棒的初始形状为 `(XXXX...XXXX)`\n\n接下来 $m$ 行，每行三个整数/字符，用空格隔开。\n\n第一个整数为 $1$ 或 $2$，表示操作的类型，若类型为 $1$，则接下来一个整数 $x$，一个字符 $C$。若类型为 $2$，接下来两个整数 $l,r$。含义见题目描述。", "outputFormat": "对于每一个操作二，输出一行一个整数，表示该询问的答案。", "hint": "对于 $30\\%$ 的数据，$2 \\leq n,m \\leq 1 \\times 10^3$。\n\n对于 $100\\%$ 的数据，$2 \\leq n,m \\leq 2 \\times 10^5$。\n\nby-orangebird。", "locale": "zh-CN", "translations": {"en": {"title": "Youmu Chops the Wooden Rod", "background": "![](https://cdn.luogu.com.cn/upload/pic/5848.png) \n\nYoumu is a half-human, half-phantom living in Hakugyokurou, and she has the ability to wield sword techniques.", "description": "One day, Youmu was practicing swordsmanship. There was an extremely long wooden rod on the ground, and Youmu cut it into $n$ equal segments. Now this rod can be regarded as composed of three kinds of small segments: the middle $n - 2$ segments are stumps cut on both sides, denoted by `X`; the leftmost segment and the rightmost segment each have a rounded end, denoted by `(` and `)` respectively.\n\nAfter eating her fill and feeling bored, Yuyuko decided to play a prank on Youmu. She brought many small wooden segments of these three types to replace part of the $n$ segments Youmu had cut, and then asked Youmu some questions.\n\nThese operations are described as follows:\n\n- `1 x C` Replace the $x$-th small segment with type $C$, where $C$ is one of `X`, `(`, `)`.\n- `2 l r` Query how many complete rods are in the interval $[l, r]$ (inclusive).\n\nA complete rod must have `(` on the left end and `)` on the right end, and between them there may be zero or more `X` only.\n\nAlthough Youmu can count the answers to these questions, Yuyuko thinks she answers too slowly. Can you teach Youmu a faster method?", "inputFormat": "The first line contains two integers $n, m$, representing that there are $n$ segments and $m$ operations.\n\nThe initial shape of the rod is `(XXXX...XXXX)`.\n\nThen follow $m$ lines, each describing one operation in one of the following forms, separated by spaces:\n- Type 1: `1 x C` — an integer $x$ and a character $C$.\n- Type 2: `2 l r` — two integers $l, r$.\n\nThe meanings are as described above.", "outputFormat": "For each type 2 operation, output one line with one integer, representing the answer to that query.", "hint": "For 30% of the testdata, $2 \\leq n, m \\leq 1 \\times 10^3$.\n\nFor 100% of the testdata, $2 \\leq n, m \\leq 2 \\times 10^5$.\n\nby-orangebird.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "妖梦斩木棒", "background": "![](https://cdn.luogu.com.cn/upload/pic/5848.png) \n\n妖梦是住在白玉楼的半人半灵，拥有使用剑术程度的能力。", "description": "有一天，妖梦正在练习剑术。地面上摆放着一根非常长的木棒，妖梦把它切成了等长的 $n$ 段。\n现在这根木棒可以看作由三种小段构成：中间的 $n - 2$ 段都是左右都被切断的断头，我们记作 `X`；最左边的一段和最右边的一段各有一个圆头，分别记作 `(` 和 `)`。\n\n幽幽子吃饱后闲来无事，决定戏弄一下妖梦。她拿来了许多这样的三种小段木棒，来替换掉妖梦切下来的 $n$ 段中的一部分，然后问妖梦一些问题。\n\n这些操作可以这样描述：\n\n- `1 x C` 将第 $x$ 个小段的木棒替换成 $C$ 型，$C$ 只会是 `X`, `(`, `)` 中的一种\n\n- `2 l r` 询问在区间 $[l, r]$ 中（包含两端），有多少个完整的木棒。\n\n完整的木棒左右两端必须分别为 `(` 和 `)`，并且中间要么什么都没有，要么只能有 `X`。\n\n虽然妖梦能够数清楚这些问题，但幽幽子觉得她回答得太慢了，你能教给妖梦一个更快的办法吗？", "inputFormat": "第一行包含两个整数 $n, m$，分别表示共有 $n$ 段木棒，以及有 $m$ 次操作。\n\n木棒的初始形状为 `(XXXX...XXXX)`\n\n接下来 $m$ 行，每行三个整数/字符，用空格隔开。\n\n第一个整数为 $1$ 或 $2$，表示操作的类型，若类型为 $1$，则接下来一个整数 $x$，一个字符 $C$。若类型为 $2$，接下来两个整数 $l,r$。含义见题目描述。", "outputFormat": "对于每一个操作二，输出一行一个整数，表示该询问的答案。", "hint": "对于 $30\\%$ 的数据，$2 \\leq n,m \\leq 1 \\times 10^3$。\n\n对于 $100\\%$ 的数据，$2 \\leq n,m \\leq 2 \\times 10^5$。\n\nby-orangebird。", "locale": "zh-CN"}}}
{"pid": "P3798", "type": "P", "difficulty": 7, "samples": [["样例任务（无需提交）:\n n=2,m=2。 玩家C行动时只可以放置2。请输出一个整数，表示棋盘上可能出现的最大数字。\n", "16"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["模拟", "动态规划 DP", "搜索", "贪心", "洛谷原创", "提交答案", "剪枝", "记忆化搜索", "洛谷比赛"], "title": "辉夜姬的十道难题", "background": "妹红最近玩了一款叫 $2048$ 的小游戏。\n\n![](https://cdn.luogu.com.cn/upload/pic/5857.png)\n\n(图为个人无撤销最高纪录~ 纯手玩)。", "description": "$2048$ 是一个非常简单的数字游戏，它在 $4\\times 4$ 的棋盘上进行，通过移动来合并数字，达到 $2048$ 即算胜利。妹红最近沉迷上了这个游戏，事情传到辉夜那里后，辉夜决定用曾经无人破解的十道难题来考考妹红。\n\n游戏规则：\n\n1. 游戏在 $n\\times m$ 的方格棋盘上进行。\n\n2. 两个玩家，其中一个可以移动棋盘上的数字，记做 M，另外一个可以向棋盘上放数字，记做 C。\n\n3. 移动数字的规则如下：可以向上/下/左/右四个方向的其中之一移动。选定好方向后，所有数字都会向该方向靠拢，相同的两个数字相撞时会合并成一个新数字，这个数字是它们的和。在一次移动中，每个数字最多只能合并一次，优先合并靠近移动方向棋盘边缘的数字。\n\n以 $n=2,m=4$ 的情况举例如下（$0$ 表示该位置为空）：\n\n```\n2 2 2 2\n2 2 0 2\n```\n\n向左移动后变为：\n\n```\n4 4 0 0\n4 2 0 0\n```\n\n每次合并后，将会获得一定的分数，获得的分数等于所有合并后数字相加之和。若无任何合并发生，则不得分。在上例中，得分为 $12$。\n\n移动前后，若棋盘上的所有数字大小和位置均没有变化，则不算做有效移动，否则即是有效移动。\n\n4. 向棋盘放置数字的规则如下：只能选择棋盘上没有数字的位置放置一个数字，可以放置的数字和放置方法在每个子任务中会具体描述。\n\n5. 游戏开始时棋盘为空，分数为 $0$。先由玩家 C 行动两步，接着玩家 M 和 C 轮流行动，中间的每一步都必须是有效的。当轮到玩家 M 时，若不能够进行有效移动，则游戏结束，此时的得分为最终得分。\n\n本题目为提交答案题，共有 $10$ 个子任务需要你来完成。将你的答案写到 $10$ 个文件中，分别命名为 ```gamex.out```，$x$ 表示子任务的编号（$0\\ldots 9$）。\n\n子任务内无部分分，你可以得到该任务的分数当且仅当你的输出和标准答案完全相同。\n\n十道难题如下:\n\n0. $n=1,m=2$。玩家 C 行动时可以放置 $2$ 或 $4$。若用 $x$ 表示在一局游戏中玩家 M 最多可以行动 $x$ 次，那么这个 $x$ 的最值是多少？输出两行，第一行一个整数表示 $x$ 的最小值，第二行一个整数表示 $x$ 的最大值。\n\n1. $n=10738029,m=921023$。玩家 C 行动时可以放置 $2$ 或 $4$。若用 $x$ 表示棋盘上所有数字之和，请问 $x$ 的最大值是多少。因为这个值可能过大，只需要输出它除以 $10^9+7$ 的余数即可。\n\n2. $n=2,m=2$。玩家 C 行动时可以放置 $2,4$。用 $x$ 表示目标数字， $x$ 一定为 $2$ 的正整数幂。玩家 M 的目标是使盘面上出现大于等于数字 $x$ 的数，玩家 C 的目标是在盘面上出现数字 $x$ 之前使游戏结束。在两方均最优决策的情况下，求一个最大的 $x$，使得玩家 M 能达到自己的目标。\n\n3. $n=4,m=4$。玩家 C 行动时可以放置 $2,4$。输出两行，每行一个数字。第一行的数字表示能达到的最大分数。第二行的数字表示当数字总和达到最大时，分数的最小值。\n\n4. $n=7393,m=9133$。玩家 C 可以放置数字 $2$ 共 $6144$ 次。棋盘初始为空，初始分数为 $0$。首先由玩家 C 连续行动，直到用完所有放置机会或中途主动放弃。然后连续向上移动直到向上方向不能构成有效移动。输出一行一个整数，表示最大得分。\n\n5. $n=7,m=233$。初始分数为 $0$,玩家 C 可以放置数字 $2$ 共 $233$ 次，数字 $4$ 共 $66$ 次。棋盘第一行一开始有若干数字，第 $i$ 列的数字为 $\\text{lowbit}(i)\\times 2$，$\\text{lowbit}(i)$ 表示数字 $i$ 的二进制形式只取最后一个 $1$ 构成的数字。如 $\\text{lowbit}(1\\ldots 8)$ 为 $1,2,1,4,1,2,1,8$。棋盘的其他位置均为空。首先由玩家 C 连续行动，直到用完所有放置机会或中途主动放弃。然后连续向上移动直到向上方向不能构成有效移动。输出一行一个整数，表示最大得分。\n\n6. $n=3,m=3$。玩家 C 行动时可以放置 $2,4$。用 $x$ 表示目标数字，$x$ 一定为 $2$ 的正整数幂。玩家 M 的目标是使盘面上出现数字 $x$，玩家 C 的目标是在盘面上出现数字 $x$ 之前使游戏结束。在两方均最优决策的情况下，输出一个最大的 $x$，使得玩家 M 能达到自己的目标。\n\n7. $n=3,m=3$。玩家 C 行动时可以放置 $2,4$。玩家 M 的目标是让得分最大化，玩家 C 的目标是让得分最小化，在两方均最优决策的情况下，输出一个整数，表示最终的分数。\n\n8. $n=3,m=3$。玩家 C 行动时，有 $90\\%$ 的几率放置一个 $2$，$10\\%$ 的几率放置一个 $4$，放置在各个空位的几率均等。用 $x$ 表示目标数字，玩家 M 的目标是使盘面上出现大于等于数字 $x$ 的数。在玩家 M 最优决策的情况下，输出一行，$9$ 个实数，四舍五入到小数点后 $2$ 位，用空格隔开，分别表示 $x=2,4,8,16,32,64,128,256,512$ 时，达成目标数字的概率。\n\n9. $n=3,m=3$。玩家 C 行动时，有 $90\\%$ 的几率放置一个 $2$，$10\\%$ 的几率放置一个 $4$，放置在各个空位的几率均等。玩家 M 的目标是让分数最大化。在玩家 M 最优决策的情况下，输出一个实数，四舍五入保留整数，表示分数的期望值。\n\n妹红虽然对 $2048$ 有一定了解，但她并不能解决全部的问题，于是就交给了学 OI 的你。", "inputFormat": "见题目描述\n", "outputFormat": "见题目描述\n", "hint": "如果对移动规则有疑惑，可以到 $2048$ 网站进行尝试:\n\nhttp://gabrielecirulli.github.io/2048/\n\nby-orangebird\n", "locale": "zh-CN", "translations": {"en": {"title": "Kaguya-hime's Ten Challenges", "background": "Meihong recently started playing a small game called $2048$.\n\n![](https://cdn.luogu.com.cn/upload/pic/5857.png)\n\n(The picture shows a personal best with no undo — hand played.).", "description": "$2048$ is a very simple number game played on a $4 \\times 4$ board. By moving to merge numbers, reaching $2048$ counts as a win. Meihong has become addicted to the game. When the news reached Kaguya, she decided to test Meihong with ten puzzles that no one had solved before.\n\nGame rules:\n\n1. The game is played on an $n \\times m$ grid.\n\n2. There are two players. One can move the numbers on the board, denoted by M, and the other can place numbers on the board, denoted by C.\n\n3. The rules for moving numbers are as follows: you can move in one of the four directions: up/down/left/right. After choosing a direction, all numbers slide toward that direction. When two equal numbers collide, they merge into a new number equal to their sum. In a single move, each tile can merge at most once, and merges prioritize tiles closer to the edge in the movement direction.\n\nFor example, when $n=2, m=4$ ($0$ denotes an empty cell):\n\n```\n2 2 2 2\n2 2 0 2\n```\n\nAfter moving left, it becomes:\n\n```\n4 4 0 0\n4 2 0 0\n```\n\nAfter each merge, you gain score equal to the sum of all newly created numbers from merges in that move. If no merges occur, you gain no score. In the example above, the score is $12$.\n\nIf, before and after a move, all numbers on the board have the same values and positions, the move is not valid; otherwise, it is a valid move.\n\n4. The rules for placing numbers are as follows: you may place a number only in an empty cell, and which numbers can be placed and how they are placed are specified in each subtask.\n\n5. The game starts with an empty board and a score of $0$. Player C takes two moves first. Then players M and C alternate moves, and every move in between must be valid. When it is player M’s turn and they cannot make a valid move, the game ends, and the current score is the final score.\n\nThis is an output-only problem with $10$ subtasks for you to complete. Write your answers to $10$ files named ```gamex.out```, where $x$ is the subtask index ($0 \\ldots 9$).\n\nThere are no partial points within a subtask; you receive the subtask’s score if and only if your output exactly matches the reference answer.\n\nThe ten challenges are as follows:\n\n0. $n=1, m=2$. When player C acts, they may place $2$ or $4$. Let $x$ denote the maximum number of moves player M can make in a single game. What are the extremal values of $x$? Output two lines: the first line is an integer for the minimum possible $x$, and the second line is an integer for the maximum possible $x$.\n\n1. $n=10738029, m=921023$. When player C acts, they may place $2$ or $4$. Let $x$ be the sum of all numbers on the board. What is the maximum value of $x$? Because this value may be too large, output it modulo $10^9+7$.\n\n2. $n=2, m=2$. When player C acts, they may place $2, 4$. Let $x$ denote the target number, where $x$ is a positive power of $2$. Player M’s goal is to make a number at least $x$ appear on the board, while player C’s goal is to end the game before a number $x$ appears on the board. Under optimal play by both sides, find the largest $x$ such that player M can achieve their goal.\n\n3. $n=4, m=4$. When player C acts, they may place $2, 4$. Output two lines, each with one number. The first line is the maximum achievable score. The second line is the minimum score when the total sum of numbers on the board reaches its maximum.\n\n4. $n=7393, m=9133$. Player C can place the number $2$ a total of $6144$ times. The board is initially empty and the initial score is $0$. First, player C acts consecutively until they use all placement opportunities or voluntarily stop early. Then move upward repeatedly until an upward move is no longer valid. Output one integer on a single line: the maximum score.\n\n5. $n=7, m=233$. The initial score is $0$. Player C can place the number $2$ a total of $233$ times and the number $4$ a total of $66$ times. The first row initially contains some numbers: the number in column $i$ is $\\text{lowbit}(i) \\times 2$, where $\\text{lowbit}(i)$ denotes the number formed by taking only the last $1$ in the binary representation of $i$. For example, $\\text{lowbit}(1 \\ldots 8)$ are $1, 2, 1, 4, 1, 2, 1, 8$. All other cells are empty. First, player C acts consecutively until they use all placement opportunities or voluntarily stop early. Then move upward repeatedly until an upward move is no longer valid. Output one integer on a single line: the maximum score.\n\n6. $n=3, m=3$. When player C acts, they may place $2, 4$. Let $x$ denote the target number, where $x$ is a positive power of $2$. Player M’s goal is to make a number $x$ appear on the board, while player C’s goal is to end the game before a number $x$ appears. Under optimal play by both sides, output the largest $x$ such that player M can achieve their goal.\n\n7. $n=3, m=3$. When player C acts, they may place $2, 4$. Player M’s goal is to maximize the score, and player C’s goal is to minimize the score. Under optimal play by both sides, output an integer representing the final score.\n\n8. $n=3, m=3$. When player C acts, there is a $90\\%$ chance to place a $2$ and a $10\\%$ chance to place a $4$, with equal probability among all empty cells. Let $x$ denote the target number. Player M’s goal is to make a number at least $x$ appear on the board. Under player M’s optimal strategy, output one line with $9$ real numbers, rounded to $2$ decimal places and separated by spaces, representing the probability of achieving the target for $x=2, 4, 8, 16, 32, 64, 128, 256, 512$.\n\n9. $n=3, m=3$. When player C acts, there is a $90\\%$ chance to place a $2$ and a $10\\%$ chance to place a $4$, with equal probability among all empty cells. Player M’s goal is to maximize the score. Under player M’s optimal strategy, output one real number, rounded to the nearest integer, representing the expected score.\n\nAlthough Meihong has some understanding of $2048$, she cannot solve all the problems, so she turns to you, who studies OI.", "inputFormat": "See the problem statement.", "outputFormat": "See the problem statement.", "hint": "If you are unsure about the movement rules, you can try them on the $2048$ website:\n\nhttp://gabrielecirulli.github.io/2048/\n\nby-orangebird.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "辉夜姬的十道难题", "background": "妹红最近玩了一款叫 $2048$ 的小游戏。\n\n![](https://cdn.luogu.com.cn/upload/pic/5857.png)\n\n(图为个人无撤销最高纪录~ 纯手玩)。", "description": "$2048$ 是一个非常简单的数字游戏，它在 $4\\times 4$ 的棋盘上进行，通过移动来合并数字，达到 $2048$ 即算胜利。妹红最近沉迷上了这个游戏，事情传到辉夜那里后，辉夜决定用曾经无人破解的十道难题来考考妹红。\n\n游戏规则：\n\n1. 游戏在 $n\\times m$ 的方格棋盘上进行。\n\n2. 两个玩家，其中一个可以移动棋盘上的数字，记做 M，另外一个可以向棋盘上放数字，记做 C。\n\n3. 移动数字的规则如下：可以向上/下/左/右四个方向的其中之一移动。选定好方向后，所有数字都会向该方向靠拢，相同的两个数字相撞时会合并成一个新数字，这个数字是它们的和。在一次移动中，每个数字最多只能合并一次，优先合并靠近移动方向棋盘边缘的数字。\n\n以 $n=2,m=4$ 的情况举例如下（$0$ 表示该位置为空）：\n\n```\n2 2 2 2\n2 2 0 2\n```\n\n向左移动后变为：\n\n```\n4 4 0 0\n4 2 0 0\n```\n\n每次合并后，将会获得一定的分数，获得的分数等于所有合并后数字相加之和。若无任何合并发生，则不得分。在上例中，得分为 $12$。\n\n移动前后，若棋盘上的所有数字大小和位置均没有变化，则不算做有效移动，否则即是有效移动。\n\n4. 向棋盘放置数字的规则如下：只能选择棋盘上没有数字的位置放置一个数字，可以放置的数字和放置方法在每个子任务中会具体描述。\n\n5. 游戏开始时棋盘为空，分数为 $0$。先由玩家 C 行动两步，接着玩家 M 和 C 轮流行动，中间的每一步都必须是有效的。当轮到玩家 M 时，若不能够进行有效移动，则游戏结束，此时的得分为最终得分。\n\n本题目为提交答案题，共有 $10$ 个子任务需要你来完成。将你的答案写到 $10$ 个文件中，分别命名为 ```gamex.out```，$x$ 表示子任务的编号（$0\\ldots 9$）。\n\n子任务内无部分分，你可以得到该任务的分数当且仅当你的输出和标准答案完全相同。\n\n十道难题如下:\n\n0. $n=1,m=2$。玩家 C 行动时可以放置 $2$ 或 $4$。若用 $x$ 表示在一局游戏中玩家 M 最多可以行动 $x$ 次，那么这个 $x$ 的最值是多少？输出两行，第一行一个整数表示 $x$ 的最小值，第二行一个整数表示 $x$ 的最大值。\n\n1. $n=10738029,m=921023$。玩家 C 行动时可以放置 $2$ 或 $4$。若用 $x$ 表示棋盘上所有数字之和，请问 $x$ 的最大值是多少。因为这个值可能过大，只需要输出它除以 $10^9+7$ 的余数即可。\n\n2. $n=2,m=2$。玩家 C 行动时可以放置 $2,4$。用 $x$ 表示目标数字， $x$ 一定为 $2$ 的正整数幂。玩家 M 的目标是使盘面上出现大于等于数字 $x$ 的数，玩家 C 的目标是在盘面上出现数字 $x$ 之前使游戏结束。在两方均最优决策的情况下，求一个最大的 $x$，使得玩家 M 能达到自己的目标。\n\n3. $n=4,m=4$。玩家 C 行动时可以放置 $2,4$。输出两行，每行一个数字。第一行的数字表示能达到的最大分数。第二行的数字表示当数字总和达到最大时，分数的最小值。\n\n4. $n=7393,m=9133$。玩家 C 可以放置数字 $2$ 共 $6144$ 次。棋盘初始为空，初始分数为 $0$。首先由玩家 C 连续行动，直到用完所有放置机会或中途主动放弃。然后连续向上移动直到向上方向不能构成有效移动。输出一行一个整数，表示最大得分。\n\n5. $n=7,m=233$。初始分数为 $0$,玩家 C 可以放置数字 $2$ 共 $233$ 次，数字 $4$ 共 $66$ 次。棋盘第一行一开始有若干数字，第 $i$ 列的数字为 $\\text{lowbit}(i)\\times 2$，$\\text{lowbit}(i)$ 表示数字 $i$ 的二进制形式只取最后一个 $1$ 构成的数字。如 $\\text{lowbit}(1\\ldots 8)$ 为 $1,2,1,4,1,2,1,8$。棋盘的其他位置均为空。首先由玩家 C 连续行动，直到用完所有放置机会或中途主动放弃。然后连续向上移动直到向上方向不能构成有效移动。输出一行一个整数，表示最大得分。\n\n6. $n=3,m=3$。玩家 C 行动时可以放置 $2,4$。用 $x$ 表示目标数字，$x$ 一定为 $2$ 的正整数幂。玩家 M 的目标是使盘面上出现数字 $x$，玩家 C 的目标是在盘面上出现数字 $x$ 之前使游戏结束。在两方均最优决策的情况下，输出一个最大的 $x$，使得玩家 M 能达到自己的目标。\n\n7. $n=3,m=3$。玩家 C 行动时可以放置 $2,4$。玩家 M 的目标是让得分最大化，玩家 C 的目标是让得分最小化，在两方均最优决策的情况下，输出一个整数，表示最终的分数。\n\n8. $n=3,m=3$。玩家 C 行动时，有 $90\\%$ 的几率放置一个 $2$，$10\\%$ 的几率放置一个 $4$，放置在各个空位的几率均等。用 $x$ 表示目标数字，玩家 M 的目标是使盘面上出现大于等于数字 $x$ 的数。在玩家 M 最优决策的情况下，输出一行，$9$ 个实数，四舍五入到小数点后 $2$ 位，用空格隔开，分别表示 $x=2,4,8,16,32,64,128,256,512$ 时，达成目标数字的概率。\n\n9. $n=3,m=3$。玩家 C 行动时，有 $90\\%$ 的几率放置一个 $2$，$10\\%$ 的几率放置一个 $4$，放置在各个空位的几率均等。玩家 M 的目标是让分数最大化。在玩家 M 最优决策的情况下，输出一个实数，四舍五入保留整数，表示分数的期望值。\n\n妹红虽然对 $2048$ 有一定了解，但她并不能解决全部的问题，于是就交给了学 OI 的你。", "inputFormat": "见题目描述\n", "outputFormat": "见题目描述\n", "hint": "如果对移动规则有疑惑，可以到 $2048$ 网站进行尝试:\n\nhttp://gabrielecirulli.github.io/2048/\n\nby-orangebird\n", "locale": "zh-CN"}}}
{"pid": "P3799", "type": "P", "difficulty": 3, "samples": [["4 \n1\n1\n2\n2", "1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["洛谷原创", "枚举", "组合数学", "洛谷比赛"], "title": "小 Y 拼木棒", "background": "上道题中，小 Y 斩了一地的木棒，现在她想要将木棒拼起来。", "description": "有 $n$ 根木棒，现在从中选 $4$ 根，想要组成一个正三角形，问有几种选法？\n\n答案对 $10^9+7$ 取模。", "inputFormat": "第一行一个整数 $n$。\n\n第二行往下 $n$ 行，每行 $1$ 个整数，第 $i$ 个整数 $a_i$ 代表第 $i$ 根木棒的长度。", "outputFormat": "一行一个整数代表答案。\n", "hint": "#### 数据规模与约定\n\n- 对于 $30\\%$ 的数据，保证 $n \\le 5 \\times 10^3$。\n- 对于 $100\\%$ 的数据，保证 $1 \\leq n \\le 10^5$，$1 \\le a_i \\le 5 \\times 10^3$。\n\n关于标题：因为一些不可抗力的原因，名称进行了更改。深表歉意。", "locale": "zh-CN", "translations": {"en": {"title": "Xiao Y Assembles Wooden Sticks", "background": "In the previous problem, Xiao Y cut a lot of wooden sticks. Now she wants to put the sticks together.", "description": "There are $n$ wooden sticks. Choose $4$ of them, and you want to be able to form an equilateral triangle. How many such selections are there.\n\nThe answer is taken modulo $10^9+7$.", "inputFormat": "The first line contains an integer $n$.\n\nFrom the second line, there are $n$ lines. Each line contains $1$ integer. The $i$-th integer $a_i$ represents the length of the $i$-th stick.", "outputFormat": "Output a single integer representing the answer.", "hint": "#### Constraints\n\n- For $30\\%$ of the testdata, it is guaranteed that $n \\le 5 \\times 10^3$.\n- For $100\\%$ of the testdata, it is guaranteed that $1 \\leq n \\le 10^5$, $1 \\le a_i \\le 5 \\times 10^3$.\n\nAbout the title: Due to some unforeseen circumstances, the name has been changed. We sincerely apologize.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "小 Y 拼木棒", "background": "上道题中，小 Y 斩了一地的木棒，现在她想要将木棒拼起来。", "description": "有 $n$ 根木棒，现在从中选 $4$ 根，想要组成一个正三角形，问有几种选法？\n\n答案对 $10^9+7$ 取模。", "inputFormat": "第一行一个整数 $n$。\n\n第二行往下 $n$ 行，每行 $1$ 个整数，第 $i$ 个整数 $a_i$ 代表第 $i$ 根木棒的长度。", "outputFormat": "一行一个整数代表答案。\n", "hint": "#### 数据规模与约定\n\n- 对于 $30\\%$ 的数据，保证 $n \\le 5 \\times 10^3$。\n- 对于 $100\\%$ 的数据，保证 $1 \\leq n \\le 10^5$，$1 \\le a_i \\le 5 \\times 10^3$。\n\n关于标题：因为一些不可抗力的原因，名称进行了更改。深表歉意。", "locale": "zh-CN"}}}
{"pid": "P3800", "type": "P", "difficulty": 4, "samples": [["3 3 4 1\n1 1 3\n1 2 1\n2 2 3\n3 3 3\n", "9"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["动态规划 DP", "单调队列", "洛谷原创", "O2优化", "ST 表", "洛谷比赛"], "title": "Power 收集", "background": "据说在红雾异变时，博丽灵梦单身前往红魔馆，用十分强硬的手段将事件解决了。\n\n然而当时灵梦在 Power 达到 MAX 之前，不具有“上线收点”的能力，所以她想要知道她能收集多少 P 点，然而这个问题她答不上来，于是她找到了学 OI 的你。", "description": "可以把游戏界面理解成一个 $N$ 行 $M$ 列的棋盘，有 $K$ 个格子上有 P 点，其价值为 $\\operatorname{val}(i,j)$。\n\n初始灵梦可以选择在第一行的任意一个格子出发，每秒她必须下移一格。\n\n灵梦具有一个左右移动的速度 $T$，可以使她每秒向左或右移动至多 $T$ 格，也可以不移动，并且在单次移动中不能折返。移动可视为瞬间完成，不经过路途上的点，只能获得目标格子的 P 点。\n\n求最终她能获得的所有 P 点的价值总和最大是多少？", "inputFormat": "第一行四个整数，$N,M,K,T$。\n\n接下来 $K$ 行每行 $3$ 个整数 $x,y,v$，代表第 $x$ 行第 $y$ 列有一个 $\\operatorname{val}$ 为 $v$ 的 P 点，数据保证一个格子上最多只有 $1$ 个 P 点。", "outputFormat": "一个整数，表示灵梦能获得的 P 点的价值总和的最大值。", "hint": "对于 $40\\%$ 的测试点，$1 \\le N,M,T,K \\le 200$。\n\n对于 $100\\%$ 的测试点，$1 \\le N,M,T,K \\le 4000$，$0 \\le v \\le 100$，$N,M,K,T$ 均为整数。\n\nby-szc", "locale": "zh-CN", "translations": {"en": {"title": "Power Collection", "background": "It is said that during the Scarlet Mist incident, Reimu Hakurei went alone to the Scarlet Devil Mansion and resolved the incident with very forceful means. However, before her Power reached MAX, Reimu did not have the ability to \"collect at the top line\" (上线收点), so she wanted to know how many P points she could collect. She could not answer this question, so she turned to you, who study OI.", "description": "Treat the game screen as an $N$-row by $M$-column grid. There are P points on $K$ cells, and their values are $\\operatorname{val}(i,j)$.\n\nInitially, Reimu may choose any cell in the first row to start. Each second, she must move down by exactly one row.\n\nReimu has a horizontal speed $T$, allowing her each second to move left or right by at most $T$ columns, or not move horizontally at all, and she cannot reverse direction within a single move. Movement is considered instantaneous: she does not pass through intermediate cells en route and can only obtain the P point on the destination cell.\n\nCompute the maximum possible total value of all P points she can obtain.", "inputFormat": "The first line contains four integers, $N,M,K,T$.\n\nEach of the next $K$ lines contains three integers $x,y,v$, indicating that there is a P point with $\\operatorname{val}=v$ at row $x$, column $y$. It is guaranteed that there is at most $1$ P point on any cell.", "outputFormat": "Output a single integer, the maximum total value of P points Reimu can obtain.", "hint": "For $40\\%$ of the testdata, $1 \\le N,M,T,K \\le 200$.\n\nFor $100\\%$ of the testdata, $1 \\le N,M,T,K \\le 4000$, $0 \\le v \\le 100$, and $N,M,K,T$ are all integers.\n\nby-szc\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "Power 收集", "background": "据说在红雾异变时，博丽灵梦单身前往红魔馆，用十分强硬的手段将事件解决了。\n\n然而当时灵梦在 Power 达到 MAX 之前，不具有“上线收点”的能力，所以她想要知道她能收集多少 P 点，然而这个问题她答不上来，于是她找到了学 OI 的你。", "description": "可以把游戏界面理解成一个 $N$ 行 $M$ 列的棋盘，有 $K$ 个格子上有 P 点，其价值为 $\\operatorname{val}(i,j)$。\n\n初始灵梦可以选择在第一行的任意一个格子出发，每秒她必须下移一格。\n\n灵梦具有一个左右移动的速度 $T$，可以使她每秒向左或右移动至多 $T$ 格，也可以不移动，并且在单次移动中不能折返。移动可视为瞬间完成，不经过路途上的点，只能获得目标格子的 P 点。\n\n求最终她能获得的所有 P 点的价值总和最大是多少？", "inputFormat": "第一行四个整数，$N,M,K,T$。\n\n接下来 $K$ 行每行 $3$ 个整数 $x,y,v$，代表第 $x$ 行第 $y$ 列有一个 $\\operatorname{val}$ 为 $v$ 的 P 点，数据保证一个格子上最多只有 $1$ 个 P 点。", "outputFormat": "一个整数，表示灵梦能获得的 P 点的价值总和的最大值。", "hint": "对于 $40\\%$ 的测试点，$1 \\le N,M,T,K \\le 200$。\n\n对于 $100\\%$ 的测试点，$1 \\le N,M,T,K \\le 4000$，$0 \\le v \\le 100$，$N,M,K,T$ 均为整数。\n\nby-szc", "locale": "zh-CN"}}}
{"pid": "P3801", "type": "P", "difficulty": 4, "samples": [["4 4 3\n1 2 2\n1 4 4\n2 1 1 4 4\n", "8"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["线段树", "树状数组", "洛谷原创", "容斥原理", "洛谷比赛"], "title": "红色的幻想乡", "background": "蕾米莉亚的红雾异变失败后，很不甘心。", "description": "经过上次失败后，蕾米莉亚决定再次发动红雾异变，但为了防止被灵梦退治，她决定将红雾以奇怪的阵势释放。\n\n我们将幻想乡看做是一个 $n \\times m$ 的方格地区，一开始没有任何一个地区被红雾遮盖。蕾米莉亚每次站在某一个地区上，向东南西北四个方向各发出一条无限长的红雾，可以影响到整行/整列，但不会影响到她所站的那个地区。如果两阵红雾碰撞，则会因为密度过大而沉降消失。灵梦察觉到了这次异变，决定去解决它。但在解决之前，灵梦想要了解一片范围红雾的密度。可以简述为两种操作:\n\n``1 x y`` 蕾米莉亚站在坐标 $(x,y)$ 的位置向四个方向释放无限长的红雾。\n\n``2 x1 y1 x2 y2`` 询问左上点为$(x1,y1)$，右下点为 $(x2,y2)$ 的矩形范围内，被红雾遮盖的地区的数量。", "inputFormat": "第一行三个整数 $n,m,q$，表示幻想乡大小为 $n \\times m$，有 $q$ 个询问。\n\n接下来 $q$ 行，每行 $3$ 个或 $5$ 个整数,用空格隔开，含义见题目描述。", "outputFormat": "对于每一个操作 $2$，输出一行一个整数，表示对应询问的答案。", "hint": "#### 样例输入输出 1 解释\n\n用``o``表示没有红雾，``x``表示有红雾，两次释放红雾后幻想乡地图如下:\n\n```\noxox\nxoxo\noxox\nxoxo\n```\n\n---\n\n#### 数据规模与约定\n\n- 对于 $20\\%$ 的数据，$1 \\le n,m,q \\le 200$。\n- 对于 $40\\%$ 的数据，$1 \\le n,m,q \\le 10^3$。\n- 对于 $100\\%$ 的数据，$1 \\le n,m,q \\le 10^5$，$1 \\le x_1,x_2,x \\le n$，$x_1 \\le x_2$，$1 \\le y_1,y_2,y \\le m$，$y_1 \\le y_2$。", "locale": "zh-CN", "translations": {"en": {"title": "Red Gensokyo", "background": "After the failure of Remilia’s Scarlet Mist incident, she was unwilling to accept it.", "description": "After the last failure, Remilia decided to launch the Scarlet Mist incident again. To avoid being exorcised by Reimu, she decided to release the red mist in a strange formation.\n\nWe model Gensokyo as an $n \\times m$ grid. Initially, no cell is covered by red mist. Each time, Remilia stands on some cell and emits one infinitely long red mist in each of the four cardinal directions, affecting the entire row/column, but not the cell she stands on. If two red mists collide, they settle and disappear due to excessive density. Reimu notices this incident and decides to resolve it. Before that, she wants to know the density of red mist in a rectangular region, which can be summarized as two operations:\n\n``1 x y`` Remilia stands at coordinate $(x, y)$ and releases infinitely long red mist in the four directions.\n\n``2 x1 y1 x2 y2`` Query the number of cells covered by red mist within the rectangle with top-left $(x_1, y_1)$ and bottom-right $(x_2, y_2)$.", "inputFormat": "The first line contains three integers $n, m, q$, meaning the size of Gensokyo is $n \\times m$, and there are $q$ operations.\n\nThen follow $q$ lines. Each line contains $3$ or $5$ integers separated by spaces, as described above.", "outputFormat": "For each operation of type $2$, output one line with one integer representing the answer to that query.", "hint": "#### Sample Input/Output 1 Explanation\n\nLet ``o`` denote no red mist, and ``x`` denote red mist. After two releases of red mist, the map of Gensokyo looks like:\n\n```\noxox\nxoxo\noxox\nxoxo\n```\n\n---\n\n#### Constraints\n\n- For $20\\%$ of the testdata, $1 \\le n, m, q \\le 200$.\n- For $40\\%$ of the testdata, $1 \\le n, m, q \\le 10^3$.\n- For $100\\%$ of the testdata, $1 \\le n, m, q \\le 10^5$, $1 \\le x_1, x_2, x \\le n$, $x_1 \\le x_2$, $1 \\le y_1, y_2, y \\le m$, $y_1 \\le y_2$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "红色的幻想乡", "background": "蕾米莉亚的红雾异变失败后，很不甘心。", "description": "经过上次失败后，蕾米莉亚决定再次发动红雾异变，但为了防止被灵梦退治，她决定将红雾以奇怪的阵势释放。\n\n我们将幻想乡看做是一个 $n \\times m$ 的方格地区，一开始没有任何一个地区被红雾遮盖。蕾米莉亚每次站在某一个地区上，向东南西北四个方向各发出一条无限长的红雾，可以影响到整行/整列，但不会影响到她所站的那个地区。如果两阵红雾碰撞，则会因为密度过大而沉降消失。灵梦察觉到了这次异变，决定去解决它。但在解决之前，灵梦想要了解一片范围红雾的密度。可以简述为两种操作:\n\n``1 x y`` 蕾米莉亚站在坐标 $(x,y)$ 的位置向四个方向释放无限长的红雾。\n\n``2 x1 y1 x2 y2`` 询问左上点为$(x1,y1)$，右下点为 $(x2,y2)$ 的矩形范围内，被红雾遮盖的地区的数量。", "inputFormat": "第一行三个整数 $n,m,q$，表示幻想乡大小为 $n \\times m$，有 $q$ 个询问。\n\n接下来 $q$ 行，每行 $3$ 个或 $5$ 个整数,用空格隔开，含义见题目描述。", "outputFormat": "对于每一个操作 $2$，输出一行一个整数，表示对应询问的答案。", "hint": "#### 样例输入输出 1 解释\n\n用``o``表示没有红雾，``x``表示有红雾，两次释放红雾后幻想乡地图如下:\n\n```\noxox\nxoxo\noxox\nxoxo\n```\n\n---\n\n#### 数据规模与约定\n\n- 对于 $20\\%$ 的数据，$1 \\le n,m,q \\le 200$。\n- 对于 $40\\%$ 的数据，$1 \\le n,m,q \\le 10^3$。\n- 对于 $100\\%$ 的数据，$1 \\le n,m,q \\le 10^5$，$1 \\le x_1,x_2,x \\le n$，$x_1 \\le x_2$，$1 \\le y_1,y_2,y \\le m$，$y_1 \\le y_2$。", "locale": "zh-CN"}}}
{"pid": "P3802", "type": "P", "difficulty": 4, "samples": [["1 1 1 1 1 1 1", "1.000"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["洛谷原创", "排列组合", "期望", "洛谷比赛"], "title": "小魔女帕琪", "background": "从前有一个聪明的小魔女帕琪，兴趣是狩猎吸血鬼。\n\n帕琪能熟练使用七种属性（金、木、水、火、土、日、月）的魔法，除了能使用这么多种属性魔法外，她还能将两种以上属性组合，从而唱出强力的魔法。比如说为了加强攻击力而将火和木组合，为了掩盖弱点而将火和土组合等等，变化非常丰富。", "description": "现在帕琪与强大的夜之女王，吸血鬼蕾咪相遇了，夜之女王蕾咪具有非常强大的生命力，普通的魔法难以造成效果，只有终极魔法：帕琪七重奏才能对蕾咪造成伤害。帕琪七重奏的触发条件是：连续施放的 $7$ 个魔法中，如果魔法的属性各不相同，就能触发一次帕琪七重奏。\n\n请注意，无论前 $6$ 个魔法是否已经参与施放终极魔法，只要连续 $7$ 个魔法的属性各不相同，就会再触发一次终极魔法。例如，如果用序号来代表一种魔法，魔法的施放序列为 $1, 2, 3, 4, 5, 6,7, 1$，则前 $7$ 个魔法会触发一次终极魔法，后 $7$ 个魔法会再触发一次终极魔法。\n\n现在帕琪有 $7$ 种属性的能量晶体，第 $i$ 种晶体可以施放出属性为 $i$ 的魔法，共有 $a_i$ 个。每次施放魔法时，会等概率随机消耗一个现有的能量晶体，然后释放一个对应属性的魔法。\n\n现在帕琪想知道，她触发帕琪七重奏的期望次数是多少，可是她并不会算，于是找到了学 OI 的你。", "inputFormat": "输入只有一行 $7$ 个整数，第 $i$ 个整数代表 $a_i$。", "outputFormat": "输出一行一个实数代表答案，四舍五入保留三位小数。", "hint": "#### 样例输入输出 1 解释\n\n显然一定会触发一次帕琪七重奏。\n\n#### 数据规模与约定\n\n- 对于 $30\\%$ 的数据，保证 $\\sum_{i = 1}^7 a_i \\leq 10$。\n- 对于 $100\\%$ 的数据，保证 $0 \\leq a_i \\leq 10^9$，且 $\\sum_{i = 1}^7 a_i \\leq 10^9$。", "locale": "zh-CN", "translations": {"en": {"title": "Little Witch Patchouli", "background": "Once upon a time, there was a clever little witch named Patchouli (Paqi), whose hobby was hunting vampires.\n\nPatchouli can skillfully use seven elemental magics: Metal, Wood, Water, Fire, Earth, Sun, and Moon. Besides using many elements, she can also combine two or more elements to cast powerful spells. For example, combining Fire and Wood to enhance attack power, or combining Fire and Earth to cover weaknesses. The variations are very rich.", "description": "Now Patchouli has encountered the powerful Queen of the Night, the vampire Remi. The Queen of the Night has extremely strong vitality, so ordinary magic has little effect. Only the ultimate spell, Patchouli's Septet, can deal damage to Remi. The trigger condition for Patchouli's Septet is: among any consecutive $7$ spells, if the attributes are all different, Patchouli's Septet is triggered once.\n\nPlease note that regardless of whether the previous $6$ spells have already been part of an ultimate cast, as long as any consecutive $7$ spells have pairwise different attributes, another ultimate is triggered. For example, if we use indices to represent attributes and the casting sequence is $1, 2, 3, 4, 5, 6, 7, 1$, then the first $7$ spells trigger the ultimate once, and the last $7$ spells trigger it once again.\n\nNow Patchouli has energy crystals of $7$ attributes. The $i$-th type of crystal can cast a spell of attribute $i$, and there are $a_i$ crystals in total. Each time a spell is cast, one of the existing energy crystals is consumed uniformly at random, and then a spell of the corresponding attribute is released.\n\nPatchouli wants to know the expected number of times she triggers Patchouli's Septet. She cannot compute it, so she turns to you, an OI student, for help.", "inputFormat": "A single line with $7$ integers. The $i$-th integer is $a_i$.", "outputFormat": "Output a single real number: the answer, rounded to three decimal places.", "hint": "- Sample 1 Explanation:\n  Obviously, Patchouli's Septet will be triggered once.\n\n- Constraints:\n  - For $30\\%$ of the testdata, it is guaranteed that $\\sum_{i = 1}^7 a_i \\leq 10$.\n  - For $100\\%$ of the testdata, it is guaranteed that $0 \\leq a_i \\leq 10^9$ and $\\sum_{i = 1}^7 a_i \\leq 10^9$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "小魔女帕琪", "background": "从前有一个聪明的小魔女帕琪，兴趣是狩猎吸血鬼。\n\n帕琪能熟练使用七种属性（金、木、水、火、土、日、月）的魔法，除了能使用这么多种属性魔法外，她还能将两种以上属性组合，从而唱出强力的魔法。比如说为了加强攻击力而将火和木组合，为了掩盖弱点而将火和土组合等等，变化非常丰富。", "description": "现在帕琪与强大的夜之女王，吸血鬼蕾咪相遇了，夜之女王蕾咪具有非常强大的生命力，普通的魔法难以造成效果，只有终极魔法：帕琪七重奏才能对蕾咪造成伤害。帕琪七重奏的触发条件是：连续施放的 $7$ 个魔法中，如果魔法的属性各不相同，就能触发一次帕琪七重奏。\n\n请注意，无论前 $6$ 个魔法是否已经参与施放终极魔法，只要连续 $7$ 个魔法的属性各不相同，就会再触发一次终极魔法。例如，如果用序号来代表一种魔法，魔法的施放序列为 $1, 2, 3, 4, 5, 6,7, 1$，则前 $7$ 个魔法会触发一次终极魔法，后 $7$ 个魔法会再触发一次终极魔法。\n\n现在帕琪有 $7$ 种属性的能量晶体，第 $i$ 种晶体可以施放出属性为 $i$ 的魔法，共有 $a_i$ 个。每次施放魔法时，会等概率随机消耗一个现有的能量晶体，然后释放一个对应属性的魔法。\n\n现在帕琪想知道，她触发帕琪七重奏的期望次数是多少，可是她并不会算，于是找到了学 OI 的你。", "inputFormat": "输入只有一行 $7$ 个整数，第 $i$ 个整数代表 $a_i$。", "outputFormat": "输出一行一个实数代表答案，四舍五入保留三位小数。", "hint": "#### 样例输入输出 1 解释\n\n显然一定会触发一次帕琪七重奏。\n\n#### 数据规模与约定\n\n- 对于 $30\\%$ 的数据，保证 $\\sum_{i = 1}^7 a_i \\leq 10$。\n- 对于 $100\\%$ 的数据，保证 $0 \\leq a_i \\leq 10^9$，且 $\\sum_{i = 1}^7 a_i \\leq 10^9$。", "locale": "zh-CN"}}}
{"pid": "P3803", "type": "P", "difficulty": 6, "samples": [["1 2\n1 2\n1 2 1", "1 4 5 2"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["递归", "O2优化", "向量", "快速傅里叶变换 FFT", "快速数论变换 NTT", "模板题"], "title": "【模板】多项式乘法（FFT）", "background": "这是一道多项式乘法模板题。\n\n注意：本题并不属于中国计算机学会划定的提高组知识点考察范围。", "description": "给定一个 $n$ 次多项式 $F(x)$，和一个 $m$ 次多项式 $G(x)$。\n\n请求出 $F(x)$ 和 $G(x)$ 的乘积。", "inputFormat": "第一行两个整数 $n,m$。\n\n接下来一行 $n+1$ 个整数，从低到高表示 $F(x)$ 的系数。\n\n接下来一行 $m+1$ 个整数，从低到高表示 $G(x)$ 的系数。", "outputFormat": "一行 $n+m+1$ 个整数，从低到高表示 $F(x) \\cdot G(x)$ 的系数。", "hint": "保证输入中的系数均为大于等于 $0$ 且小于等于 $9$ 的整数。\n\n对于 $100\\%$ 的数据：$1 \\le n, m \\leq {10}^6$。", "locale": "zh-CN", "translations": {"en": {"title": "【Template】Polynomial Multiplication (FFT)", "background": "This is a template problem for polynomial multiplication.\n\nNote: This problem is not within the CCF-defined Senior knowledge points.", "description": "Given a degree $n$ polynomial $F(x)$ and a degree $m$ polynomial $G(x)$, compute the product $F(x)$ and $G(x)$.", "inputFormat": "The first line contains two integers $n, m$.\n\nThe next line contains $n+1$ integers, representing the coefficients of $F(x)$ from lowest degree to highest.\n\nThe next line contains $m+1$ integers, representing the coefficients of $G(x)$ from lowest degree to highest.", "outputFormat": "Output one line containing $n+m+1$ integers, representing the coefficients of $F(x) \\cdot G(x)$ from lowest degree to highest.", "hint": "It is guaranteed that all input coefficients are integers between $0$ and $9$ inclusive.\n\nFor $100\\%$ of the testdata: $1 \\le n, m \\leq {10}^6$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】多项式乘法（FFT）", "background": "这是一道多项式乘法模板题。\n\n注意：本题并不属于中国计算机学会划定的提高组知识点考察范围。", "description": "给定一个 $n$ 次多项式 $F(x)$，和一个 $m$ 次多项式 $G(x)$。\n\n请求出 $F(x)$ 和 $G(x)$ 的乘积。", "inputFormat": "第一行两个整数 $n,m$。\n\n接下来一行 $n+1$ 个整数，从低到高表示 $F(x)$ 的系数。\n\n接下来一行 $m+1$ 个整数，从低到高表示 $G(x)$ 的系数。", "outputFormat": "一行 $n+m+1$ 个整数，从低到高表示 $F(x) \\cdot G(x)$ 的系数。", "hint": "保证输入中的系数均为大于等于 $0$ 且小于等于 $9$ 的整数。\n\n对于 $100\\%$ 的数据：$1 \\le n, m \\leq {10}^6$。", "locale": "zh-CN"}}}
{"pid": "P3804", "type": "P", "difficulty": 6, "samples": [["abab", "4"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["字符串", "后缀自动机 SAM", "O2优化", "后缀数组 SA", "模板题"], "title": "【模板】后缀自动机（SAM）", "background": "", "description": "给定一个只包含小写字母的字符串 $S$。\n\n请你求出 $S$ 的所有出现次数不为 $1$ 的子串的出现次数乘上该子串长度的最大值。\n", "inputFormat": "一行一个仅包含小写字母的字符串 $S$。", "outputFormat": "一个整数，为所求答案。", "hint": "对于 $10 \\%$ 的数据，$\\lvert S \\rvert \\le 1000$。  \n对于 $100\\% $的数据，$1 \\le \\lvert S \\rvert \\le {10}^6$。\n\n- 2023.7.30：添加一组 hack 数据。", "locale": "zh-CN", "translations": {"en": {"title": "【Template】Suffix Automaton (SAM)", "background": "", "description": "Given a string $S$ consisting only of lowercase letters.\n\nPlease find the maximum value of (occurrence count of a substring) multiplied by (the length of that substring) over all substrings of $S$ whose occurrence count is not $1$.", "inputFormat": "One line containing a string $S$ consisting only of lowercase letters.", "outputFormat": "A single integer, the required answer.", "hint": "Constraints:\n- For $10\\%$ of the testdata, $\\lvert S \\rvert \\le 1000$.\n- For $100\\%$ of the testdata, $1 \\le \\lvert S \\rvert \\le {10}^6$.\n\n- 2023.7.30: Added a set of hack testdata.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】后缀自动机（SAM）", "background": "", "description": "给定一个只包含小写字母的字符串 $S$。\n\n请你求出 $S$ 的所有出现次数不为 $1$ 的子串的出现次数乘上该子串长度的最大值。\n", "inputFormat": "一行一个仅包含小写字母的字符串 $S$。", "outputFormat": "一个整数，为所求答案。", "hint": "对于 $10 \\%$ 的数据，$\\lvert S \\rvert \\le 1000$。  \n对于 $100\\% $的数据，$1 \\le \\lvert S \\rvert \\le {10}^6$。\n\n- 2023.7.30：添加一组 hack 数据。", "locale": "zh-CN"}}}
{"pid": "P3805", "type": "P", "difficulty": 5, "samples": [["aaa", "3"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["字符串", "O2优化", "Manacher 算法", "模板题"], "title": "【模板】Manacher", "background": null, "description": "给出一个只由小写英文字符 $\\texttt a,\\texttt b,\\texttt c,\\ldots\\texttt y,\\texttt z$ 组成的字符串 $S$ ,求 $S$ 中最长回文串的长度 。\n\n字符串长度为 $n$。", "inputFormat": "一行小写英文字符 $\\texttt a,\\texttt b,\\texttt c,\\cdots,\\texttt y,\\texttt z$ 组成的字符串 $S$。", "outputFormat": "一个整数表示答案。", "hint": "$1\\le n\\le 1.1\\times 10^7$。", "locale": "zh-CN", "translations": {"en": {"title": "[Template] Manacher", "background": "", "description": "Given a string $S$ consisting only of lowercase English letters $\\texttt a,\\texttt b,\\texttt c,\\ldots\\texttt y,\\texttt z$, find the length of the longest palindromic substring in $S$.\n\nThe length of the string is $n$.", "inputFormat": "One line containing a string $S$ consisting of lowercase English letters $\\texttt a,\\texttt b,\\texttt c,\\cdots,\\texttt y,\\texttt z$.", "outputFormat": "Output a single integer representing the answer.", "hint": "$1 \\le n \\le 1.1 \\times 10^7$。\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】Manacher", "background": null, "description": "给出一个只由小写英文字符 $\\texttt a,\\texttt b,\\texttt c,\\ldots\\texttt y,\\texttt z$ 组成的字符串 $S$ ,求 $S$ 中最长回文串的长度 。\n\n字符串长度为 $n$。", "inputFormat": "一行小写英文字符 $\\texttt a,\\texttt b,\\texttt c,\\cdots,\\texttt y,\\texttt z$ 组成的字符串 $S$。", "outputFormat": "一个整数表示答案。", "hint": "$1\\le n\\le 1.1\\times 10^7$。", "locale": "zh-CN"}}}
{"pid": "P3806", "type": "P", "difficulty": 5, "samples": [["2 1\n1 2 2\n2", "AYE"]], "limits": {"time": [200, 200, 200, 200, 200, 200, 200, 200, 200, 200], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["点分治", "O2优化", "分治", "深度优先搜索 DFS", "模板题"], "title": "【模板】点分治", "background": "感谢 hzwer 的点分治互测。", "description": "给定一棵有 $n$ 个点的树，询问树上距离为 $k$ 的点对是否存在。", "inputFormat": "第一行两个数 $n,m$。\n\n第 $2$ 到第 $n$ 行，每行三个整数 $u, v, w$，代表树上存在一条连接 $u$ 和 $v$ 边权为 $w$ 的路径。\n\n接下来 $m$ 行，每行一个整数 $k$，代表一次询问。", "outputFormat": "对于每次询问输出一行一个字符串代表答案，存在输出 `AYE`，否则输出 `NAY`。", "hint": "#### 数据规模与约定\n\n- 对于 $30\\%$ 的数据，保证 $n\\leq 100$。\n- 对于 $60\\%$ 的数据，保证 $n\\leq 1000$，$m\\leq 50$ 。\n- 对于 $100\\%$ 的数据，保证 $1 \\leq n\\leq 10^4$，$1 \\leq m\\leq 100$，$1 \\leq k \\leq 10^7$，$1 \\leq u, v \\leq n$，$1 \\leq w \\leq 10^4$。\n\n#### 提示\n\n- **本题不卡常**。\n- 如果您 #7 一直 RE/TLE，不妨看看 [这个帖子](https://www.luogu.com.cn/discuss/show/188596)。", "locale": "zh-CN", "translations": {"en": {"title": "[Template] Centroid Decomposition", "background": "Thanks to hzwer for the centroid decomposition cross-testing.", "description": "Given a tree with $n$ nodes, determine for each query whether there exists a pair of nodes whose distance on the tree equals $k$.", "inputFormat": "The first line contains two integers $n, m$.\n\nThe next $n-1$ lines, each contains three integers $u, v, w$, representing an edge between $u$ and $v$ with weight $w$.\n\nThen $m$ lines follow, each containing one integer $k$, representing a query.", "outputFormat": "For each query, output one line with a string representing the answer. Output `AYE` if such a pair exists, otherwise output `NAY`.", "hint": "#### Constraints\n\n- For $30\\%$ of the testdata, $n \\leq 100$ is guaranteed.\n- For $60\\%$ of the testdata, $n \\leq 1000$, $m \\leq 50$ are guaranteed.\n- For $100\\%$ of the testdata, $1 \\leq n \\leq 10^4$, $1 \\leq m \\leq 100$, $1 \\leq k \\leq 10^7$, $1 \\leq u, v \\leq n$, $1 \\leq w \\leq 10^4$ are guaranteed.\n\n#### Notes\n\n- This problem does not stress constant factors.\n- If test point #7 keeps RE/TLE, consider checking this post: https://www.luogu.com.cn/discuss/show/188596.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】点分治", "background": "感谢 hzwer 的点分治互测。", "description": "给定一棵有 $n$ 个点的树，询问树上距离为 $k$ 的点对是否存在。", "inputFormat": "第一行两个数 $n,m$。\n\n第 $2$ 到第 $n$ 行，每行三个整数 $u, v, w$，代表树上存在一条连接 $u$ 和 $v$ 边权为 $w$ 的路径。\n\n接下来 $m$ 行，每行一个整数 $k$，代表一次询问。", "outputFormat": "对于每次询问输出一行一个字符串代表答案，存在输出 `AYE`，否则输出 `NAY`。", "hint": "#### 数据规模与约定\n\n- 对于 $30\\%$ 的数据，保证 $n\\leq 100$。\n- 对于 $60\\%$ 的数据，保证 $n\\leq 1000$，$m\\leq 50$ 。\n- 对于 $100\\%$ 的数据，保证 $1 \\leq n\\leq 10^4$，$1 \\leq m\\leq 100$，$1 \\leq k \\leq 10^7$，$1 \\leq u, v \\leq n$，$1 \\leq w \\leq 10^4$。\n\n#### 提示\n\n- **本题不卡常**。\n- 如果您 #7 一直 RE/TLE，不妨看看 [这个帖子](https://www.luogu.com.cn/discuss/show/188596)。", "locale": "zh-CN"}}}
{"pid": "P3807", "type": "P", "difficulty": 5, "samples": [["2\n1 2 5\n2 1 5", "3\n3"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["递归", "素数判断,质数,筛法", "进制", "组合数学", "逆元", "Lucas 定理", "模板题"], "title": "【模板】卢卡斯定理 / Lucas 定理", "background": "这是一道模板题。\n", "description": "给定整数 $n, m, p$ 的值，求出 $C_{n + m}^n \\bmod p$ 的值。\n\n输入数据保证 $p$ 为质数。\n\n注: $C$ 表示组合数。", "inputFormat": "**本题有多组数据**。\n\n第一行一个整数 $T$，表示数据组数。\n\n对于每组数据: \n\n一行，三个整数 $n, m, p$。", "outputFormat": "对于每组数据，输出一行，一个整数，表示所求的值。", "hint": "对于 $100\\%$ 的数据，$1 \\leq n, m, p \\leq 10^5$，$1 \\leq T \\leq 10$。", "locale": "zh-CN", "translations": {"en": {"title": "[Template] Lucas Theorem", "background": "This is a template problem.", "description": "Given integers $n, m, p$, compute $C_{n + m}^n \\bmod p$.\n\nThe input guarantees that $p$ is prime.\n\nNote: $C$ denotes the binomial coefficient.", "inputFormat": "This problem contains multiple test cases.\n\nThe first line contains an integer $T$, the number of test cases.\n\nFor each test case:\n\nOne line with three integers $n, m, p$.", "outputFormat": "For each test case, output one line with one integer, the required value.", "hint": "For $100\\%$ of the testdata, $1 \\leq n, m, p \\leq 10^5$, $1 \\leq T \\leq 10$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】卢卡斯定理 / Lucas 定理", "background": "这是一道模板题。\n", "description": "给定整数 $n, m, p$ 的值，求出 $C_{n + m}^n \\bmod p$ 的值。\n\n输入数据保证 $p$ 为质数。\n\n注: $C$ 表示组合数。", "inputFormat": "**本题有多组数据**。\n\n第一行一个整数 $T$，表示数据组数。\n\n对于每组数据: \n\n一行，三个整数 $n, m, p$。", "outputFormat": "对于每组数据，输出一行，一个整数，表示所求的值。", "hint": "对于 $100\\%$ 的数据，$1 \\leq n, m, p \\leq 10^5$，$1 \\leq T \\leq 10$。", "locale": "zh-CN"}}}
{"pid": "P3808", "type": "P", "difficulty": 5, "samples": [["3\na\naa\naa\naaa", "3"], ["4\na\nab\nac\nabc\nabcd", "3"], ["2\na\naa\naa", "2"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["字符串", "O2优化", "AC 自动机"], "title": "AC 自动机（简单版）", "background": null, "description": "给定 $n$ 个模式串 $s_i$ 和一个文本串 $t$，求有多少个不同的模式串在文本串里出现过。  \n两个模式串不同当且仅当他们**编号**不同。", "inputFormat": "第一行是一个整数，表示模式串的个数 $n$。  \n第 $2$ 到第 $(n + 1)$ 行，每行一个字符串，第 $(i + 1)$ 行的字符串表示编号为 $i$ 的模式串 $s_i$。  \n最后一行是一个字符串，表示文本串 $t$。", "outputFormat": "输出一行一个整数表示答案。", "hint": "### 样例 1 解释\n\n$s_2$ 与 $s_3$ 编号（下标）不同，因此各自对答案产生了一次贡献。\n\n### 样例 2 解释\n\n$s_1$，$s_2$，$s_4$ 都在串 `abcd` 里出现过。\n\n### 数据规模与约定\n\n- 对于 $10\\%$ 的数据，保证 $n = 1$。\n- 对于 $100\\%$ 的数据，保证 $1 \\leq n \\leq 10^6$，$1 \\leq |t| \\leq 10^6$，$1 \\leq \\sum\\limits_{i = 1}^n |s_i| \\leq 10^6$。$s_i, t$ 中仅包含小写字母。", "locale": "zh-CN", "translations": {"en": {"title": "AC Automaton (Simple Version)", "background": "", "description": "Given $n$ pattern strings $s_i$ and a text string $t$, count how many distinct pattern strings appear in the text. Two pattern strings are different if and only if their indices are different.", "inputFormat": "The first line contains an integer $n$, the number of pattern strings.  \nLines $2$ to $(n + 1)$ each contain one string; the string on line $(i + 1)$ is the pattern string $s_i$ with index $i$.  \nThe last line contains a string, the text string $t$.", "outputFormat": "Output a single integer on one line, which is the answer.", "hint": "### Sample 1 Explanation\n\n$s_2$ and $s_3$ have different indices, so each contributes once to the answer.\n\n### Sample 2 Explanation\n\n$s_1$, $s_2$, and $s_4$ all appear in the string `abcd`.\n\n### Constraints\n\n- For $10\\%$ of the testdata, it is guaranteed that $n = 1$.\n- For $100\\%$ of the testdata, it is guaranteed that $1 \\leq n \\leq 10^6$, $1 \\leq |t| \\leq 10^6$, $1 \\leq \\sum\\limits_{i = 1}^n |s_i| \\leq 10^6$. $s_i, t$ contain only lowercase letters.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "AC 自动机（简单版）", "background": null, "description": "给定 $n$ 个模式串 $s_i$ 和一个文本串 $t$，求有多少个不同的模式串在文本串里出现过。  \n两个模式串不同当且仅当他们**编号**不同。", "inputFormat": "第一行是一个整数，表示模式串的个数 $n$。  \n第 $2$ 到第 $(n + 1)$ 行，每行一个字符串，第 $(i + 1)$ 行的字符串表示编号为 $i$ 的模式串 $s_i$。  \n最后一行是一个字符串，表示文本串 $t$。", "outputFormat": "输出一行一个整数表示答案。", "hint": "### 样例 1 解释\n\n$s_2$ 与 $s_3$ 编号（下标）不同，因此各自对答案产生了一次贡献。\n\n### 样例 2 解释\n\n$s_1$，$s_2$，$s_4$ 都在串 `abcd` 里出现过。\n\n### 数据规模与约定\n\n- 对于 $10\\%$ 的数据，保证 $n = 1$。\n- 对于 $100\\%$ 的数据，保证 $1 \\leq n \\leq 10^6$，$1 \\leq |t| \\leq 10^6$，$1 \\leq \\sum\\limits_{i = 1}^n |s_i| \\leq 10^6$。$s_i, t$ 中仅包含小写字母。", "locale": "zh-CN"}}}
{"pid": "P3809", "type": "P", "difficulty": 6, "samples": [["ababa", "5 3 1 4 2"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144]}, "tags": ["字符串", "O2优化", "排序", "后缀数组 SA", "模板题"], "title": "【模板】后缀排序", "background": "这是一道模板题。\n", "description": "读入一个长度为 $ n $ 的由大小写英文字母或数字组成的字符串，请把这个字符串的所有非空后缀按字典序（用 ASCII 数值比较）从小到大排序，然后按顺序输出后缀的第一个字符在原串中的位置。位置编号为 $ 1 $ 到 $ n $。\n", "inputFormat": "一行一个长度为 $ n $ 的仅包含大小写英文字母或数字的字符串。\n", "outputFormat": "一行，共 $n$ 个整数，表示答案。\n", "hint": "$1\\le n \\le 10^6$。\n", "locale": "zh-CN", "translations": {"en": {"title": "[Template] Suffix Sorting", "background": "This is a template problem.", "description": "Read a string of length $ n $ consisting of uppercase and lowercase English letters or digits. Sort all its non-empty suffixes in ascending lexicographic order (compared by ASCII values), then output, in that order, the position in the original string of the first character of each suffix. Positions are numbered from $ 1 $ to $ n $.", "inputFormat": "A single line containing a string of length $ n $ consisting only of uppercase and lowercase English letters or digits.", "outputFormat": "One line containing $ n $ integers representing the answer.", "hint": "$ 1 \\le n \\le 10^6 $.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】后缀排序", "background": "这是一道模板题。\n", "description": "读入一个长度为 $ n $ 的由大小写英文字母或数字组成的字符串，请把这个字符串的所有非空后缀按字典序（用 ASCII 数值比较）从小到大排序，然后按顺序输出后缀的第一个字符在原串中的位置。位置编号为 $ 1 $ 到 $ n $。\n", "inputFormat": "一行一个长度为 $ n $ 的仅包含大小写英文字母或数字的字符串。\n", "outputFormat": "一行，共 $n$ 个整数，表示答案。\n", "hint": "$1\\le n \\le 10^6$。\n", "locale": "zh-CN"}}}
{"pid": "P3810", "type": "P", "difficulty": 6, "samples": [["10 3\n3 3 3\n2 3 3\n2 3 1\n3 1 1\n3 1 2\n1 3 1\n1 1 2\n1 2 2\n1 3 2\n1 2 1\n", "3\n1\n3\n0\n1\n0\n1\n0\n0\n1\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["线段树", "树状数组", "cdq 分治", "O2优化", "分治", "排序", "树套树", "分块", "K-D Tree", "bitset", "模板题"], "title": "【模板】三维偏序 / 陌上花开", "background": "这是一道模板题，可以使用 bitset，CDQ 分治，树套树，KD-Tree 等方式解决。", "description": "有 $ n $ 个元素，第 $ i $ 个元素有 $ a_i,b_i,c_i $ 三个属性，设 $ f(i) $ 表示满足 $ a_j \\leq a_i $ 且 $ b_j \\leq b_i $ 且 $ c_j \\leq c_i $ 且 $ j \\ne i $ 的 $j$ 的数量。\n\n对于所有 $ d \\in [0, n) $，求 $ f(i) = d $ 的数量。", "inputFormat": "第一行两个整数 $ n,k $，表示元素数量和最大属性值。\n\n接下来 $ n $ 行，每行三个整数 $ a_i ,b_i,c_i $，分别表示三个属性值。", "outputFormat": "共 $ n $ 行，第 $ d + 1 $ 行表示 $ f(i) = d $ 的 $ i $ 的数量。", "hint": "对于所有数据，保证 $ 1 \\leq n \\leq 10^5$，$1 \\leq a_i, b_i, c_i \\le k \\leq 2 \\times 10^5 $。", "locale": "zh-CN", "translations": {"en": {"title": "[Template] Three-Dimensional Partial Order / Mo Shang Hua Kai", "background": "This is a template problem. You can solve it using bitset, CDQ divide-and-conquer, KD-tree, etc.", "description": "There are $ n $ elements. The $ i $-th element has three attributes $ a_i, b_i, c_i $. Let $ f(i) $ be the number of $ j $ such that $ a_j \\leq a_i $, $ b_j \\leq b_i $, $ c_j \\leq c_i $, and $ j \\ne i $.\n\nFor all $ d \\in [0, n) $, find the number of $ i $ such that $ f(i) = d $.", "inputFormat": "The first line contains two integers $ n,k $, denoting the number of elements and the maximum attribute value.\n\nThe next $ n $ lines each contain three integers $ a_i ,b_i,c_i $, representing the three attribute values.", "outputFormat": "Output $ n $ lines. The $ d + 1 $-th line contains the number of $ i $ such that $ f(i) = d $.", "hint": "For all testdata, it is guaranteed that $ 1 \\leq n \\leq 10^5$，$1 \\leq a_i, b_i, c_i \\le k \\leq 2 \\times 10^5 $.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】三维偏序 / 陌上花开", "background": "这是一道模板题，可以使用 bitset，CDQ 分治，树套树，KD-Tree 等方式解决。", "description": "有 $ n $ 个元素，第 $ i $ 个元素有 $ a_i,b_i,c_i $ 三个属性，设 $ f(i) $ 表示满足 $ a_j \\leq a_i $ 且 $ b_j \\leq b_i $ 且 $ c_j \\leq c_i $ 且 $ j \\ne i $ 的 $j$ 的数量。\n\n对于所有 $ d \\in [0, n) $，求 $ f(i) = d $ 的数量。", "inputFormat": "第一行两个整数 $ n,k $，表示元素数量和最大属性值。\n\n接下来 $ n $ 行，每行三个整数 $ a_i ,b_i,c_i $，分别表示三个属性值。", "outputFormat": "共 $ n $ 行，第 $ d + 1 $ 行表示 $ f(i) = d $ 的 $ i $ 的数量。", "hint": "对于所有数据，保证 $ 1 \\leq n \\leq 10^5$，$1 \\leq a_i, b_i, c_i \\le k \\leq 2 \\times 10^5 $。", "locale": "zh-CN"}}}
{"pid": "P3811", "type": "P", "difficulty": 3, "samples": [["10 13", "1\n7\n9\n10\n8\n11\n2\n5\n3\n4"]], "limits": {"time": [500, 500, 500, 500, 500, 500], "memory": [128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["数学", "递推", "O2优化", "素数判断,质数,筛法", "逆元", "模板题"], "title": "【模板】模意义下的乘法逆元", "background": "这是一道模板题。", "description": "给定正整数 $n,p$，求 $[1,n]$ 中所有整数在模 $p$ 意义下的乘法逆元。\n\n$a$ 模 $p$ 的乘法逆元定义为 $ax\\equiv1\\pmod p$ 的解。", "inputFormat": "一行两个正整数 $n,p$。", "outputFormat": "输出 $n$ 行，其中第 $i$ 行表示 $i$ 在模 $p$ 下的乘法逆元。", "hint": "所有数据满足 $ 1 \\leq n \\leq 3 \\times 10 ^ 6$，$n < p < 20000528 $。\n\n输入保证 $ p $ 为质数。", "locale": "zh-CN", "translations": {"en": {"title": "[Template] Modular Multiplicative Inverse", "background": "This is a template problem.", "description": "Given positive integers $n, p$, find the multiplicative inverses modulo $p$ for all integers in $[1, n]$.\n\nThe multiplicative inverse of $a$ modulo $p$ is defined as the solution $x$ to $ax\\equiv1\\pmod p$.", "inputFormat": "One line with two positive integers $n, p$.", "outputFormat": "Output $n$ lines, where the $i$-th line denotes the multiplicative inverse of $i$ modulo $p$.", "hint": "All testdata satisfy $ 1 \\leq n \\leq 3 \\times 10 ^ 6$, $n < p < 20000528 $.\nThe input guarantees that $ p $ is prime.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】模意义下的乘法逆元", "background": "这是一道模板题。", "description": "给定正整数 $n,p$，求 $[1,n]$ 中所有整数在模 $p$ 意义下的乘法逆元。\n\n$a$ 模 $p$ 的乘法逆元定义为 $ax\\equiv1\\pmod p$ 的解。", "inputFormat": "一行两个正整数 $n,p$。", "outputFormat": "输出 $n$ 行，其中第 $i$ 行表示 $i$ 在模 $p$ 下的乘法逆元。", "hint": "所有数据满足 $ 1 \\leq n \\leq 3 \\times 10 ^ 6$，$n < p < 20000528 $。\n\n输入保证 $ p $ 为质数。", "locale": "zh-CN"}}}
{"pid": "P3812", "type": "P", "difficulty": 5, "samples": [["2\n1 1", "1"], ["4\n1 5 9 4\n", "13\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["贪心", "进制", "线性基", "模板题"], "title": "【模板】线性基", "background": "这是一道模板题。", "description": "给定 $n$ 个整数（数字可能重复），求在这些数中选取任意个，使得他们的异或和最大。", "inputFormat": "第一行一个数 $n$，表示元素个数。\n\n接下来一行 $n$ 个数。", "outputFormat": "输出一行一个整数，表示答案。", "hint": "$1\\leq n\\leq 50$，$0\\leq S_i<2^{50}$。", "locale": "zh-CN", "translations": {"en": {"title": "[Template] Linear Basis", "background": "This is a template problem.", "description": "Given $n$ integers (numbers may repeat), choose any subset of them so that their XOR sum is maximized.", "inputFormat": "The first line contains an integer $n$, the number of elements.\nThe next line contains $n$ integers.", "outputFormat": "Output a single integer on one line, the answer.", "hint": "Constraints: $1 \\leq n \\leq 50$, $0 \\leq S_i < 2^{50}$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】线性基", "background": "这是一道模板题。", "description": "给定 $n$ 个整数（数字可能重复），求在这些数中选取任意个，使得他们的异或和最大。", "inputFormat": "第一行一个数 $n$，表示元素个数。\n\n接下来一行 $n$ 个数。", "outputFormat": "输出一行一个整数，表示答案。", "hint": "$1\\leq n\\leq 50$，$0\\leq S_i<2^{50}$。", "locale": "zh-CN"}}}
{"pid": "P3813", "type": "P", "difficulty": 6, "samples": [["2\n3 3 2 2\n1 1 2 2 2\n2 2 3 3 1\n4 4 4 4\n1 1 2 3 3\n2 3 4 4 2\n2 1 4 3 2\n1 2 3 4 4", "28\n76475"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["2017", "各省省选", "离散化", "福建", "枚举", "容斥原理"], "title": "[FJOI2017] 矩阵填数", "background": "", "description": "给定一个 $h \\times w$ 的矩阵，矩阵的行编号从上到下依次为 $1 \\sim h$，列编号从左到右依次 $1 \\sim w$。\n\n在这个矩阵中你需要在每个格子中填入 $1 \\sim m$ 中的某个数。\n\n给这个矩阵填数的时候有一些限制，给定 $n$ 个该矩阵的子矩阵，以及该子矩阵的最大值 $v$，要求你所填的方案满足该子矩阵的最大值为 $v$。\n\n现在，你的任务是求出有多少种填数的方案满足 $n$ 个限制。\n\n两种方案是不一样的当且仅当两个方案至少存在一个格子上有不同的数。由于答案可能很大，你只需要输出答案对 $10 ^ 9 + 7$ 取模后的结果。", "inputFormat": "输入数据的第一行为一个数 $T$，表示数据组数。\n\n对于每组数据，第一行为四个数 $h,w,m,n$。\n\n接下来 $n$ 行，每一行描述一个子矩阵的最大值 v。每行为五个整数 $x1,y1,x2,y2,v$，表示一个左上角为$(x1,y1)$,右下角为$(x2,y2)$的子矩阵的最大值为 $v$。 $1 \\le x1 \\le x2 \\le h$, $1 \\le y1 \\le y2 \\le w$\n", "outputFormat": "对于每组数据输出一行，表示填数方案 mod $1,000,000,007$ 后的值。\n", "hint": "对于 $20\\%$ 的数据，$n \\le 2$。\n\n另有 $20\\%$ 的数据，$1 \\le h, w \\le 50$。\n\n对于 $100\\%$ 的数据，$T \\le 5$，$1 \\le h, w, m \\le 10 ^ 4$，$1 \\le n \\le 10$，$1 \\le v \\le m$。", "locale": "zh-CN", "translations": {"en": {"title": "[FJOI2017] Matrix Filling", "background": "", "description": "Given an $h \\times w$ matrix, the rows are numbered from top to bottom as $1 \\sim h$, and the columns are numbered from left to right as $1 \\sim w$.\n\nYou need to fill each cell in this matrix with a number from $1 \\sim m$.\n\nThere are some restrictions when filling the matrix. You are given $n$ submatrices of this matrix and the maximum value $v$ for each submatrix. Your filling must satisfy that the maximum value of each given submatrix is $v$.\n\nNow, your task is to find how many fillings satisfy the $n$ constraints.\n\nTwo fillings are different if and only if there exists at least one cell where the numbers differ between the two fillings. Since the answer may be large, you only need to output the result modulo $10 ^ 9 + 7$.", "inputFormat": "The first line of the input contains an integer $T$, the number of test cases.\n\nFor each test case, the first line contains four integers $h,w,m,n$.\n\nThen follow $n$ lines, each describing the maximum value $v$ of a submatrix. Each line contains five integers $x1,y1,x2,y2,v$, indicating that the submatrix with top-left corner $(x1,y1)$ and bottom-right corner $(x2,y2)$ has a maximum value of $v$. $1 \\le x1 \\le x2 \\le h$, $1 \\le y1 \\le y2 \\le w$.", "outputFormat": "For each test case, output one line: the number of valid fillings modulo $1,000,000,007$.", "hint": "For $20\\%$ of the testdata, $n \\le 2$.\n\nFor another $20\\%$ of the data, $1 \\le h, w \\le 50$.\n\nFor $100\\%$ of the data, $T \\le 5$, $1 \\le h, w, m \\le 10 ^ 4$, $1 \\le n \\le 10$, $1 \\le v \\le m$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[FJOI2017] 矩阵填数", "background": "", "description": "给定一个 $h \\times w$ 的矩阵，矩阵的行编号从上到下依次为 $1 \\sim h$，列编号从左到右依次 $1 \\sim w$。\n\n在这个矩阵中你需要在每个格子中填入 $1 \\sim m$ 中的某个数。\n\n给这个矩阵填数的时候有一些限制，给定 $n$ 个该矩阵的子矩阵，以及该子矩阵的最大值 $v$，要求你所填的方案满足该子矩阵的最大值为 $v$。\n\n现在，你的任务是求出有多少种填数的方案满足 $n$ 个限制。\n\n两种方案是不一样的当且仅当两个方案至少存在一个格子上有不同的数。由于答案可能很大，你只需要输出答案对 $10 ^ 9 + 7$ 取模后的结果。", "inputFormat": "输入数据的第一行为一个数 $T$，表示数据组数。\n\n对于每组数据，第一行为四个数 $h,w,m,n$。\n\n接下来 $n$ 行，每一行描述一个子矩阵的最大值 v。每行为五个整数 $x1,y1,x2,y2,v$，表示一个左上角为$(x1,y1)$,右下角为$(x2,y2)$的子矩阵的最大值为 $v$。 $1 \\le x1 \\le x2 \\le h$, $1 \\le y1 \\le y2 \\le w$\n", "outputFormat": "对于每组数据输出一行，表示填数方案 mod $1,000,000,007$ 后的值。\n", "hint": "对于 $20\\%$ 的数据，$n \\le 2$。\n\n另有 $20\\%$ 的数据，$1 \\le h, w \\le 50$。\n\n对于 $100\\%$ 的数据，$T \\le 5$，$1 \\le h, w, m \\le 10 ^ 4$，$1 \\le n \\le 10$，$1 \\le v \\le m$。", "locale": "zh-CN"}}}
{"pid": "P3814", "type": "P", "difficulty": 7, "samples": [["10\nI 1 0\nI 2 1\nI 3 1\nQ 1 3\nI 4 3\nQ 1 4\nR 2 4\nQ 1 4\nM 3 4\nQ 2 7", "0\n2\n2\n6"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2017", "各省省选", "福建"], "title": "[FJOI2017] 远古山脉问题", "background": null, "description": "远古山脉可以看作是一个由山脉元素组成的序列，每个元素有一个高度，远古山脉的变化规则如下：\n\n1. `I h x`：在第 $x$ 个山脉元素右边插入高度为 $h$ 的山脉元素。\n\n2. `R l r`：从第 $l$ 个山脉元素到第 $r$ 个山脉元素的高度翻转，例如，$a_1,a_2,a_3,a_4,a_5$，对 $[2,5]$ 翻转就变为 $a_1,a_5,a_4,a_3,a_2$。\n\n3. `M t x`：在第 $x$ 个山脉元素右边插入第 $t$ 个山脉。\n\n山脉元素按从左到右的顺序从 $1$ 开始编号。一开始时没有山脉元素，记为第 $0$ 个山脉。对于第 $i$ 个山脉，经过任意一种变化后就变成第 $i+1$ 个山脉。山脉中会收集山脉能量，假设山脉中最高的山脉元素的编号为 $x$，如果有 $m$ 个相同的高度，取左数第$\\left \\lceil \\dfrac{m}{2} \\right \\rceil$个元素，那么山脉收集的能量为:\n\n$$\\sum_{i=l}^{x-1}\\left\\{\\begin{matrix} x-i & ,\\ h_{i}>h_{i+1}\\\\ 0 & ,\\ h_{i}\\leq h_{i+1} \\end{matrix}\\right.+\\sum_{i=x+1}^{r}\\left\\{\\begin{matrix} i-x & ,\\ h_{i}>h_{i-1}\\\\ 0 & ,\\ h_{i}\\leq h_{i-1} \\end{matrix}\\right.$$\n\n其中 $h_i$ 代表第 $i$ 个山脉元素的高度。\n\n山脉序列问题需要回答的基本询问是：从第 $l$ 个山脉元素到第 $r$ 个山脉元素组成子山脉能收集的能量是多少？", "inputFormat": "文件的第一行有一个正整数 $n$（$n\\le 50000$），表示山脉变化和询问的总次数。\n\n接下来 $n$ 行，每行是四种格式之一：\n\n1. `I h x`: 在第 $x$ 个山脉元素右边插入高度为 $h$ 的山脉元素，$0\\le h\\le 20000$。\n\n2. `R l r`: 从第 $l$ 个山脉元素到第 $r$ 个山脉元素的高度翻转。\n\n3. `M t x`: 在第 $x$ 个山脉元素右边插入第 $t$ 个山脉。\n\n4. `Q l r`: 询问由第 $l$ 个山脉元素到第 $r$ 个山脉元素组成子山脉能收集的能量是多少。\n\n对于第 $i$ 个山脉，经过任意一种变化后就变成第 $i+1$ 个山脉。\n\n保证以上所有输入整数在 C++ 的 `long long` 范围内。", "outputFormat": "对于每个询问，输出一行答案，答案对 $10^9+7$ 取模。", "hint": null, "locale": "zh-CN", "translations": {"en": {"title": "[FJOI2017] Ancient Mountain Range Problem", "background": "", "description": "An ancient mountain range can be regarded as a sequence of mountain elements, each with a height. The evolution rules are as follows:\n\n1. I h x: Insert a mountain element of height $h$ to the right of the $x$-th mountain element.\n2. R l r: Reverse the heights of the mountain elements from the $l$-th to the $r$-th. For example, $a_1,a_2,a_3,a_4,a_5$, reversing $(2,5)$ becomes $a_1,a_5,a_4,a_3,a_2$.\n3. M t x: Insert the $t$-th mountain to the right of the $x$-th mountain element.\n\nMountain elements are numbered from $1$ from left to right. Initially there are no mountain elements, denoted as the $0$-th mountain. For the $i$-th mountain, after applying any one operation it becomes the $(i+1)$-th mountain. The mountain collects energy as follows: suppose the index of the highest mountain element is $x$. If there are $m$ elements with the same maximum height, take the $\\left \\lceil \\frac{m}{2} \\right \\rceil$-th one from the left. Then the collected energy is:\n$$\\sum_{i=l}^{x-1}\\left\\{\\begin{matrix} x-i & if\\ h_{i}>h_{i+1}\\\\ 0 & if\\ h_{i}\\leq h_{i+1} \\end{matrix}\\right.+\\sum_{i=x+1}^{r}\\left\\{\\begin{matrix} i-x & if\\ h_{i}>h_{i-1}\\\\ 0 & if\\ h_{i}\\leq h_{i-1} \\end{matrix}\\right.$$\nHere $h_{i}$ denotes the height of the $i$-th mountain element.\n\nThe basic query to answer is: for the sub-mountain formed by the mountain elements from the $l$-th to the $r$-th, how much energy can be collected?", "inputFormat": "The first line contains a positive integer $n$ ($n\\le 50000$), the total number of operations and queries.\n\nThen follow $n$ lines, each in one of the following four formats:\n\n1. I h x: Insert a mountain element of height $h$ to the right of the $x$-th mountain element, $0\\le h\\le 20000$.\n2. R l r: Reverse the heights from the $l$-th mountain element to the $r$-th mountain element.\n3. M t x: Insert the $t$-th mountain to the right of the $x$-th mountain element.\n4. Q l r: Query the energy collected by the sub-mountain formed by the $l$-th to the $r$-th mountain elements.\n\nFor the $i$-th mountain, after applying any one operation it becomes the $(i+1)$-th mountain.\n\nAll input integers fit in the range of long long.", "outputFormat": "For each query, output the answer on one line, modulo 1000000007.", "hint": "\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[FJOI2017] 远古山脉问题", "background": null, "description": "远古山脉可以看作是一个由山脉元素组成的序列，每个元素有一个高度，远古山脉的变化规则如下：\n\n1. `I h x`：在第 $x$ 个山脉元素右边插入高度为 $h$ 的山脉元素。\n\n2. `R l r`：从第 $l$ 个山脉元素到第 $r$ 个山脉元素的高度翻转，例如，$a_1,a_2,a_3,a_4,a_5$，对 $[2,5]$ 翻转就变为 $a_1,a_5,a_4,a_3,a_2$。\n\n3. `M t x`：在第 $x$ 个山脉元素右边插入第 $t$ 个山脉。\n\n山脉元素按从左到右的顺序从 $1$ 开始编号。一开始时没有山脉元素，记为第 $0$ 个山脉。对于第 $i$ 个山脉，经过任意一种变化后就变成第 $i+1$ 个山脉。山脉中会收集山脉能量，假设山脉中最高的山脉元素的编号为 $x$，如果有 $m$ 个相同的高度，取左数第$\\left \\lceil \\dfrac{m}{2} \\right \\rceil$个元素，那么山脉收集的能量为:\n\n$$\\sum_{i=l}^{x-1}\\left\\{\\begin{matrix} x-i & ,\\ h_{i}>h_{i+1}\\\\ 0 & ,\\ h_{i}\\leq h_{i+1} \\end{matrix}\\right.+\\sum_{i=x+1}^{r}\\left\\{\\begin{matrix} i-x & ,\\ h_{i}>h_{i-1}\\\\ 0 & ,\\ h_{i}\\leq h_{i-1} \\end{matrix}\\right.$$\n\n其中 $h_i$ 代表第 $i$ 个山脉元素的高度。\n\n山脉序列问题需要回答的基本询问是：从第 $l$ 个山脉元素到第 $r$ 个山脉元素组成子山脉能收集的能量是多少？", "inputFormat": "文件的第一行有一个正整数 $n$（$n\\le 50000$），表示山脉变化和询问的总次数。\n\n接下来 $n$ 行，每行是四种格式之一：\n\n1. `I h x`: 在第 $x$ 个山脉元素右边插入高度为 $h$ 的山脉元素，$0\\le h\\le 20000$。\n\n2. `R l r`: 从第 $l$ 个山脉元素到第 $r$ 个山脉元素的高度翻转。\n\n3. `M t x`: 在第 $x$ 个山脉元素右边插入第 $t$ 个山脉。\n\n4. `Q l r`: 询问由第 $l$ 个山脉元素到第 $r$ 个山脉元素组成子山脉能收集的能量是多少。\n\n对于第 $i$ 个山脉，经过任意一种变化后就变成第 $i+1$ 个山脉。\n\n保证以上所有输入整数在 C++ 的 `long long` 范围内。", "outputFormat": "对于每个询问，输出一行答案，答案对 $10^9+7$ 取模。", "hint": null, "locale": "zh-CN"}}}
{"pid": "P3815", "type": "P", "difficulty": 0, "samples": [["5\n1 9 3 9 1\n1 3 9 3 1\n4\n1 9 3 9\n1 3 9 3\n0", "3\n1\n"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["动态规划 DP", "2017", "各省省选", "福建"], "title": "[FJOI2017] 回文子序列问题", "background": "", "description": "设 X 和 Y 是2个给定的正整数序列 $X=( x_1 , x_2 ,\\cdots, x_m )$和$Y=( y_1, y_2 ,\\cdots, y_n )$。\n\nX 和 Y的一个公共子序列是指X 和 Y的一个公共子序列$(x_{i1}=y_{j1},x_{i2}=y_{j2},\\cdots,x_{it}=y_{jt})$, 其中 $i1<i2<\\cdots<it$ 。\n\n当一个序列正读和反读都相同时，称该序列是回文。例如，序列$(1,3,5,3,1)$就是回文。 X 和 Y的一个公共回文子序列是指X 和 Y的一个公共子序列，且该子序列是回文。 在X 和 Y的所有公共回文子序列中，长度最长的就称为X 和 Y的一个最长公共回文子序列。在一般情况下， X 和 Y会有多个最长公共回文子\n\n序列。例如，对于给定的正整数序列$X=(1,9,3,9,1)$ 和 $Y=(1,3,9,3,1)$，其子序列$(1,3,1)$和$(1,9,1)$都是X 和 Y的最长公共回文子序列。\n\n我们的问题是，对于给定的正整数序列X 和 Y，确定其最长公共回文子序列的长度。\n\n对于给定的2个正整数序列$X=( x_1 , x_2 ,\\cdots, x_n )$和$Y=( y_1 , y_2 ,\\cdots, y_n )$，计算出它们的最长公共回文子序列的长度。\n", "inputFormat": "文件有多个测试项（$ \\le 10$）。每个测试项的第一行有1个正整数$n$， ($1\\le n\\le 500$)，表示2个输入序列X和Y的长度均为$n$。接下来的2行分别给出输入正整数序列$X=(x_1,x_2,\\cdots,x_n)$和$Y=(y_1,y_2,\\cdots, y_n)$。其中序列中每个元素均为正整数（ $\\le 20000$）。文件最后以一个0结束。\n", "outputFormat": "将计算出的每个测试项的最长公共回文子序列的长度依次输出到文件中， 每行输出一个长度。\n", "hint": "", "locale": "zh-CN", "translations": {"en": {"title": "[FJOI2017] Palindromic Subsequence Problem", "background": "", "description": "Let X and Y be two given sequences of positive integers $X=( x_1 , x_2 ,\\cdots, x_m )$ and $Y=( y_1, y_2 ,\\cdots, y_n )$.\n\nA common subsequence of X and Y is a sequence $(x_{i1}=y_{j1},x_{i2}=y_{j2},\\cdots,x_{it}=y_{jt})$, where $i1<i2<\\cdots<it$ and $j1<j2<\\cdots<jt$.\n\nA sequence is called a palindrome if it reads the same forward and backward. For example, the sequence (1, 3, 5, 3, 1) is a palindrome. A common palindromic subsequence of X and Y is a common subsequence of X and Y that is also a palindrome. Among all common palindromic subsequences of X and Y, those with the maximum length are called a longest common palindromic subsequence (LCPS) of X and Y. In general, there may be multiple LCPSs. For example, for the given sequences $X=(1,9,3,9,1)$ and $Y=(1,3,9,3,1)$, the subsequences (1, 3, 1) and (1, 9, 1) are both LCPSs of X and Y.\n\nOur task is: given sequences X and Y, determine the length of a longest common palindromic subsequence.\n\nFor the given two sequences $X=( x_1 , x_2 ,\\cdots, x_n )$ and $Y=( y_1 , y_2 ,\\cdots, y_n )$, compute the length of their longest common palindromic subsequence.", "inputFormat": "The file contains multiple test cases ($ \\le 10$). For each test case, the first line contains a positive integer $n$ ($1\\le n\\le 500$), indicating that the lengths of the two input sequences X and Y are both $n$. The next two lines give the input sequences $X=(x_1,x_2,\\cdots,x_n)$ and $Y=(y_1,y_2,\\cdots, y_n)$, respectively. Each element in the sequences is a positive integer ($ \\le 20000$). The file ends with a 0.", "outputFormat": "For each test case, output the computed length of the longest common palindromic subsequence, one length per line.", "hint": "\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[FJOI2017] 回文子序列问题", "background": "", "description": "设 X 和 Y 是2个给定的正整数序列 $X=( x_1 , x_2 ,\\cdots, x_m )$和$Y=( y_1, y_2 ,\\cdots, y_n )$。\n\nX 和 Y的一个公共子序列是指X 和 Y的一个公共子序列$(x_{i1}=y_{j1},x_{i2}=y_{j2},\\cdots,x_{it}=y_{jt})$, 其中 $i1<i2<\\cdots<it$ 。\n\n当一个序列正读和反读都相同时，称该序列是回文。例如，序列$(1,3,5,3,1)$就是回文。 X 和 Y的一个公共回文子序列是指X 和 Y的一个公共子序列，且该子序列是回文。 在X 和 Y的所有公共回文子序列中，长度最长的就称为X 和 Y的一个最长公共回文子序列。在一般情况下， X 和 Y会有多个最长公共回文子\n\n序列。例如，对于给定的正整数序列$X=(1,9,3,9,1)$ 和 $Y=(1,3,9,3,1)$，其子序列$(1,3,1)$和$(1,9,1)$都是X 和 Y的最长公共回文子序列。\n\n我们的问题是，对于给定的正整数序列X 和 Y，确定其最长公共回文子序列的长度。\n\n对于给定的2个正整数序列$X=( x_1 , x_2 ,\\cdots, x_n )$和$Y=( y_1 , y_2 ,\\cdots, y_n )$，计算出它们的最长公共回文子序列的长度。\n", "inputFormat": "文件有多个测试项（$ \\le 10$）。每个测试项的第一行有1个正整数$n$， ($1\\le n\\le 500$)，表示2个输入序列X和Y的长度均为$n$。接下来的2行分别给出输入正整数序列$X=(x_1,x_2,\\cdots,x_n)$和$Y=(y_1,y_2,\\cdots, y_n)$。其中序列中每个元素均为正整数（ $\\le 20000$）。文件最后以一个0结束。\n", "outputFormat": "将计算出的每个测试项的最长公共回文子序列的长度依次输出到文件中， 每行输出一个长度。\n", "hint": "", "locale": "zh-CN"}}}
