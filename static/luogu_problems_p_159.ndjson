{"pid": "P4219", "type": "P", "difficulty": 6, "samples": [["8 6\nA 2 3\nA 3 4\nA 3 8\nA 8 7\nA 6 5\nQ 3 8", "6"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2014", "各省省选", "北京", "树链剖分", "动态树 LCT", "线段树分治"], "title": "[BJOI2014] 大融合", "background": null, "description": "小强要在 $N$ 个孤立的星球上建立起一套通信系统。这套通信系统就是连接 $N$ 个点的一个树。\n\n这个树的边是一条一条添加上去的。\n\n在某个时刻，一条边的负载就是它所在的当前能够联通的树上路过它的简单路径的数量。\n\n![](https://cdn.luogu.com.cn/upload/pic/13969.png)\n\n例如，在上图中，现在一共有了 $5$ 条边。其中，$(3,8)$ 这条边的负载是 $6$，因为有六条简单路径 $2-3-8$,$2-3-8-7$,$3-8,3-8-7$,$4-3-8$,$4-3-8-7$ 路过了 $(3,8)$。\n\n现在，你的任务就是随着边的添加，动态的回答小强对于某些边的负载的询问。", "inputFormat": "第一行包含两个整数  $N, Q$,表示星球的数量和操作的数量。星球从 $1$ 开始编号。\n\n接下来的 $Q$  行，每行是如下两种格式之一：\n\n - ```A x y``` 表示在 $x$ 和 $y$ 之间连一条边。保证之前 $x$ 和 $y$ 是不联通的。\n - ```Q x y```表示询问 $(x,y)$ 这条边上的负载。保证 $x$ 和 $y$ 之间有一条边。", "outputFormat": "输出包含若干行整数，即为所有查询的答案。", "hint": "对于所有数据，$1≤N,Q≤10^5$", "locale": "zh-CN", "translations": {"en": {"title": "[BJOI2014] Great Merge", "background": "", "description": "Xiaoqiang wants to build a communication system across $N$ isolated planets. This communication system is a tree that connects $N$ nodes.\n\nEdges of the tree are added one by one.\n\nAt any given time, the load of an edge is the number of simple paths in its current connected tree that pass through it.\n\n![](https://cdn.luogu.com.cn/upload/pic/13969.png)\n\nFor example, in the figure above, there are $5$ edges in total. The load of edge $(3, 8)$ is $6$, because there are six simple paths $2-3-8$, $2-3-8-7$, $3-8$, $3-8-7$, $4-3-8$, $4-3-8-7$ that pass through $(3, 8)$.\n\nNow, as edges are added, your task is to dynamically answer Xiaoqiang’s queries about the load of certain edges.", "inputFormat": "The first line contains two integers $N, Q$, the number of planets and the number of operations. Planets are numbered starting from $1$.\n\nEach of the next $Q$ lines is in one of the following formats:\n- ```A x y``` Add an edge between $x$ and $y$. It is guaranteed that $x$ and $y$ were previously disconnected.\n- ```Q x y``` Query the load on edge $(x, y)$. It is guaranteed that there is an edge between $x$ and $y$.", "outputFormat": "Output several integers, each being the answer to a query, one per line.", "hint": "For all testdata, $1 \\le N, Q \\le 10^5$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[BJOI2014] 大融合", "background": null, "description": "小强要在 $N$ 个孤立的星球上建立起一套通信系统。这套通信系统就是连接 $N$ 个点的一个树。\n\n这个树的边是一条一条添加上去的。\n\n在某个时刻，一条边的负载就是它所在的当前能够联通的树上路过它的简单路径的数量。\n\n![](https://cdn.luogu.com.cn/upload/pic/13969.png)\n\n例如，在上图中，现在一共有了 $5$ 条边。其中，$(3,8)$ 这条边的负载是 $6$，因为有六条简单路径 $2-3-8$,$2-3-8-7$,$3-8,3-8-7$,$4-3-8$,$4-3-8-7$ 路过了 $(3,8)$。\n\n现在，你的任务就是随着边的添加，动态的回答小强对于某些边的负载的询问。", "inputFormat": "第一行包含两个整数  $N, Q$,表示星球的数量和操作的数量。星球从 $1$ 开始编号。\n\n接下来的 $Q$  行，每行是如下两种格式之一：\n\n - ```A x y``` 表示在 $x$ 和 $y$ 之间连一条边。保证之前 $x$ 和 $y$ 是不联通的。\n - ```Q x y```表示询问 $(x,y)$ 这条边上的负载。保证 $x$ 和 $y$ 之间有一条边。", "outputFormat": "输出包含若干行整数，即为所有查询的答案。", "hint": "对于所有数据，$1≤N,Q≤10^5$", "locale": "zh-CN"}}}
{"pid": "P4220", "type": "P", "difficulty": 7, "samples": [["5\n1 2 2\n1 3 0\n1 4 1\n4 5 7\n1 2 0\n2 3 1\n2 4 1\n2 5 3\n1 5 2\n2 3 8\n3 4 5\n4 5 1", "27"]], "limits": {"time": [4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2018", "并查集", "点分治", "分治", "虚树", "WC"], "title": "[WC2018] 通道", "background": "**滥用本题评测将被封号。**", "description": "11328 年，C 国的科学家们研发了一种高速传送通道，可以在很短的时间内把居民从通道的一端送往另一端，这些通道都是双向的。\n\n美中不足的是，这种传送通道需要进行大量的维护和检修。经过规划，C 国总统决定在 M 城中新建这种通道，在 M 城中，建立了 $n$ 个传送站和 $3\\times(n-1)$ 条传送通道，这些传送通道被分为 $3$ 组，每一组都包含了 $(n-1)$ 条通道。\n\n当任意一组通道运行时，居民都可以通过这组通道从任意一个传送站前往任意的另一个传送站。也就是说，所有的传送站都会被通道所连通。\n\n三组通道按照 $1$、 $2$、 $3$ 的顺序轮流运行，循环反复。在任意一个时刻，都有且只有一组传送通道可以使用。形式化地，在第 $i$ 天中，有且只有第 $((i-1)\\bmod 3+1)$ 组通道运行。\n\nC 国著名科学家 Access Globe 正在进行一项社会调查实验：调查两个传送站之间的传送通道使用者的信息。 Access Globe 的计划是这样的：\n\n- 选定两个传送站 $a, b$\n- 第一天，他从 $a$ 出发，使用正在运行的这组通道沿最短路径到达 $b$，并调查经过的所有通道上使用者的信息\n- 第二天，他从 $b$ 出发，使用正在运行的这组通道沿最短路径到达 $a$，并调查经过的所有通道上使用者的信息\n- 第三天，他从 $a$ 出发，使用正在运行的这组通道沿最短路径到达 $b$，并调查经过的所有通道上使用者的信息\n\nAccess Globe 知道每一条传输线路在运行时的使用者人数。他希望找出一对 $a, b$，使得在整个实验过程中所有经过的通道的使用者数量之和最大。 \n\nAccess Globe 希望参加 CCF NOI 2018 冬令营的你帮他解决这个简单的小问题。如果你成功地解决了这个问题， Access Globe 会送你一份小礼物——$100$ 分！", "inputFormat": "输入文件的第 $1$ 行包含一个正整数 $n$，表示传送站的个数，传送站从 $1$ 到 $n$ 编号；\n\n输入文件的第 $2$ 到第 $n$ 行，每行包含 $3$ 个数 $u,v,w$，表示第一组通道中有一条连接 $u,v$ 的通道，其运行时使用者数量为 $w$ 人；\n\n输入文件的第 $(n+1)$ 到第 $(2n-1)$ 行，每行包含 $3$ 个数 $u,v,w$，表示第二组通道中有一条连接 $u,v$ 的通道，其运行时使用者数量为 $w$ 人；\n\n输入文件的第 $2n$ 到第 $(3n-2)$ 行，每行包含 $3$ 个数 $u,v,w$，表示第三组通道中有一条连接 $u,v$ 的通道，其运行时使用者数量为 $w$ 人。", "outputFormat": "输出文件共 $1$ 行，包含一个整数，表示最大的使用者数量之和。", "hint": "【样例$1$说明】\n\n下图为样例中 $M$ 城的传送站和传输线路情况。其中点和虚线交替的线条、虚线条和实线条分别表示第一组、第二组和第三组通道。\n![](https://cdn.luogu.com.cn/upload/image_hosting/ozwxip1f.png)\n一种可行的方案是选择 $a=2,b=5$，这样的使用者数量之和为 $(3)+(8+5+1)+(2+1+7)=27$。\n\n【子任务】\n\n对于所有数据， $2 \\leq n \\leq 10^5,0 \\leq w \\leq 10^{12}$。\n\n特殊性质 $0$：任意两组通道构成完全相同。\n\n特殊性质 $1$：第二组通道和第三组通道构成完全相同。\n\n特殊性质 $2$：对于第二组的每一个传送站，最多只有两个通道可以到达它，且编号为 $x,y$ 的传送站之间通过一条通道直接连接充要条件是 $|x-y|=1$。\n\n特殊性质 $3$：对于第三组的每一个传送站，最多只有两个通道可以到达它。\n\n特殊性质 $4$： $n \\leq 3000$。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/fapzjyko.png)\n\n本题共 $31$ 个测试点，每个子任务对应测试点如下：\n\n- 子任务 $0$ 对应测试点 $1-7$；\n- 子任务 $1$ 对应测试点 $8$；\n- 子任务 $2$ 对应测试点 $9-11$；\n- 子任务 $3$ 对应测试点 $12-14$；\n- 子任务 $4$ 对应测试点 $15-17$；\n- 子任务 $5$ 对应测试点 $18-21$；\n- 子任务 $6$ 对应测试点 $22-25$；\n- 子任务 $7$ 对应测试点 $26-31$；\n\n【提示】\n\n- 在两组通道中，可能都包含了连接传送站 $x,y$ 的通道，此时我们认为这两条通道是不同的。\n- 特殊性质中，A 组通道和 B 组通道的『构成完全相同』是指：如果在 A 组中 $u,v$ 之间存在一条使用人数为 $w$ 的通道，那么在 B 组中 $u,v$ 之间一定也存在一条使用人数为 $w$ 的通道。是否相同与描述方式与描述顺序均无关。即在构成完全相同的两组通道 A 和 B 中，通道输入的顺序不一定相同，每条通道的端点的输入顺序也不一定相同（对于 A、B 组中一条连接 $u,v$ 的使用人数为 $w$ 的通道，一种可能出现的输入为： A 组通道中输入 $u\\ v\\ w$，而 B 组通道中输入 $v\\ u\\ w$）。", "locale": "zh-CN", "translations": {"en": {"title": "[WC2018] Channels", "background": "Abusing the judge for this problem will result in an account ban.", "description": "In the year 11328, scientists in country C developed a high-speed teleportation channel that can send residents from one end to the other in a very short time. These channels are bidirectional.\n\nThe downside is that such channels require extensive maintenance and inspection. After planning, the president of country C decided to build such channels in City M. In City M, $n$ teleportation stations and $3 \\times (n-1)$ channels were built. These channels are divided into $3$ groups, each containing $(n-1)$ channels.\n\nWhen any one group of channels is operating, residents can travel via this group of channels from any station to any other station. In other words, all stations are connected by channels.\n\nThe three groups of channels operate in a round-robin fashion in the order $1$, $2$, $3$, repeatedly. At any moment, exactly one group of channels is available. Formally, on day $i$, only group $((i-1)\\bmod 3+1)$ is operating.\n\nThe renowned scientist Access Globe is conducting a social survey experiment: collecting information on users of the channels between two stations. Access Globe’s plan is as follows:\n\n- Choose two stations $a, b$.\n- On day one, he starts from $a$, uses the currently operating group of channels to reach $b$ along a shortest path, and surveys the users on all channels he traverses.\n- On day two, he starts from $b$, uses the currently operating group of channels to reach $a$ along a shortest path, and surveys the users on all channels he traverses.\n- On day three, he starts from $a$, uses the currently operating group of channels to reach $b$ along a shortest path, and surveys the users on all channels he traverses.\n\nAccess Globe knows the number of users on each channel when it is operating. He wants to find a pair $a, b$ such that the total number of users over all traversed channels during the entire experiment is maximized.\n\nAccess Globe hopes you, a participant of the CCF NOI 2018 Winter Camp, can help him solve this simple problem. If you succeed, Access Globe will give you a small gift — $100$ points.", "inputFormat": "The first line contains a positive integer $n$, the number of stations, numbered from $1$ to $n$.\n\nLines $2$ to $n$: each line contains three numbers $u, v, w$, indicating that in the first group there is a channel connecting $u$ and $v$, with $w$ users when it is operating.\n\nLines $(n+1)$ to $(2n-1)$: each line contains three numbers $u, v, w$, indicating that in the second group there is a channel connecting $u$ and $v$, with $w$ users when it is operating.\n\nLines $2n$ to $(3n-2)$: each line contains three numbers $u, v, w$, indicating that in the third group there is a channel connecting $u$ and $v$, with $w$ users when it is operating.", "outputFormat": "Output a single line containing an integer: the maximum possible sum of user counts.", "hint": "[Sample 1 Explanation]\n\nThe figure below shows the stations and channels in City $M$ for the sample. The alternating dotted-and-dashed lines, dotted lines, and solid lines denote the first, second, and third groups of channels, respectively.\n![](https://cdn.luogu.com.cn/upload/image_hosting/ozwxip1f.png)\nOne feasible plan is to choose $a=2, b=5$. The total number of users is $(3) + (8+5+1) + (2+1+7) = 27$.\n\n[Subtasks]\n\nConstraints:\n- For all testdata, $2 \\le n \\le 10^5$, $0 \\le w \\le 10^{12}$.\n\nSpecial properties:\n- Special property $0$: Any two groups of channels are structurally identical.\n- Special property $1$: The second and third groups of channels are structurally identical.\n- Special property $2$: In the second group, each station has degree at most $2$, and stations numbered $x, y$ are directly connected by a channel if and only if $|x-y|=1$.\n- Special property $3$: In the third group, each station has degree at most $2$.\n- Special property $4$: $n \\le 3000$.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/fapzjyko.png)\n\nThere are $31$ test points in total, with the following mapping from subtasks to test points:\n- Subtask $0$: test points $1$–$7$.\n- Subtask $1$: test point $8$.\n- Subtask $2$: test points $9$–$11$.\n- Subtask $3$: test points $12$–$14$.\n- Subtask $4$: test points $15$–$17$.\n- Subtask $5$: test points $18$–$21$.\n- Subtask $6$: test points $22$–$25$.\n- Subtask $7$: test points $26$–$31$.\n\n[Notes]\n- It is possible that two groups both contain a channel connecting stations $x$ and $y$. In that case, we consider these as two distinct channels.\n- In the special properties, “structurally identical” between groups A and B means: if there is a channel between $u$ and $v$ with user count $w$ in group A, then there must also be a channel between $u$ and $v$ with user count $w$ in group B. Whether they are considered identical is independent of the description format and the input order. That is, in two structurally identical groups A and B, the order of channel inputs may differ, and the order of endpoints in each channel’s input may also differ (for a channel connecting $u, v$ with user count $w$ in groups A and B, one possible input is $u\\ v\\ w$ for group A and $v\\ u\\ w$ for group B).\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[WC2018] 通道", "background": "**滥用本题评测将被封号。**", "description": "11328 年，C 国的科学家们研发了一种高速传送通道，可以在很短的时间内把居民从通道的一端送往另一端，这些通道都是双向的。\n\n美中不足的是，这种传送通道需要进行大量的维护和检修。经过规划，C 国总统决定在 M 城中新建这种通道，在 M 城中，建立了 $n$ 个传送站和 $3\\times(n-1)$ 条传送通道，这些传送通道被分为 $3$ 组，每一组都包含了 $(n-1)$ 条通道。\n\n当任意一组通道运行时，居民都可以通过这组通道从任意一个传送站前往任意的另一个传送站。也就是说，所有的传送站都会被通道所连通。\n\n三组通道按照 $1$、 $2$、 $3$ 的顺序轮流运行，循环反复。在任意一个时刻，都有且只有一组传送通道可以使用。形式化地，在第 $i$ 天中，有且只有第 $((i-1)\\bmod 3+1)$ 组通道运行。\n\nC 国著名科学家 Access Globe 正在进行一项社会调查实验：调查两个传送站之间的传送通道使用者的信息。 Access Globe 的计划是这样的：\n\n- 选定两个传送站 $a, b$\n- 第一天，他从 $a$ 出发，使用正在运行的这组通道沿最短路径到达 $b$，并调查经过的所有通道上使用者的信息\n- 第二天，他从 $b$ 出发，使用正在运行的这组通道沿最短路径到达 $a$，并调查经过的所有通道上使用者的信息\n- 第三天，他从 $a$ 出发，使用正在运行的这组通道沿最短路径到达 $b$，并调查经过的所有通道上使用者的信息\n\nAccess Globe 知道每一条传输线路在运行时的使用者人数。他希望找出一对 $a, b$，使得在整个实验过程中所有经过的通道的使用者数量之和最大。 \n\nAccess Globe 希望参加 CCF NOI 2018 冬令营的你帮他解决这个简单的小问题。如果你成功地解决了这个问题， Access Globe 会送你一份小礼物——$100$ 分！", "inputFormat": "输入文件的第 $1$ 行包含一个正整数 $n$，表示传送站的个数，传送站从 $1$ 到 $n$ 编号；\n\n输入文件的第 $2$ 到第 $n$ 行，每行包含 $3$ 个数 $u,v,w$，表示第一组通道中有一条连接 $u,v$ 的通道，其运行时使用者数量为 $w$ 人；\n\n输入文件的第 $(n+1)$ 到第 $(2n-1)$ 行，每行包含 $3$ 个数 $u,v,w$，表示第二组通道中有一条连接 $u,v$ 的通道，其运行时使用者数量为 $w$ 人；\n\n输入文件的第 $2n$ 到第 $(3n-2)$ 行，每行包含 $3$ 个数 $u,v,w$，表示第三组通道中有一条连接 $u,v$ 的通道，其运行时使用者数量为 $w$ 人。", "outputFormat": "输出文件共 $1$ 行，包含一个整数，表示最大的使用者数量之和。", "hint": "【样例$1$说明】\n\n下图为样例中 $M$ 城的传送站和传输线路情况。其中点和虚线交替的线条、虚线条和实线条分别表示第一组、第二组和第三组通道。\n![](https://cdn.luogu.com.cn/upload/image_hosting/ozwxip1f.png)\n一种可行的方案是选择 $a=2,b=5$，这样的使用者数量之和为 $(3)+(8+5+1)+(2+1+7)=27$。\n\n【子任务】\n\n对于所有数据， $2 \\leq n \\leq 10^5,0 \\leq w \\leq 10^{12}$。\n\n特殊性质 $0$：任意两组通道构成完全相同。\n\n特殊性质 $1$：第二组通道和第三组通道构成完全相同。\n\n特殊性质 $2$：对于第二组的每一个传送站，最多只有两个通道可以到达它，且编号为 $x,y$ 的传送站之间通过一条通道直接连接充要条件是 $|x-y|=1$。\n\n特殊性质 $3$：对于第三组的每一个传送站，最多只有两个通道可以到达它。\n\n特殊性质 $4$： $n \\leq 3000$。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/fapzjyko.png)\n\n本题共 $31$ 个测试点，每个子任务对应测试点如下：\n\n- 子任务 $0$ 对应测试点 $1-7$；\n- 子任务 $1$ 对应测试点 $8$；\n- 子任务 $2$ 对应测试点 $9-11$；\n- 子任务 $3$ 对应测试点 $12-14$；\n- 子任务 $4$ 对应测试点 $15-17$；\n- 子任务 $5$ 对应测试点 $18-21$；\n- 子任务 $6$ 对应测试点 $22-25$；\n- 子任务 $7$ 对应测试点 $26-31$；\n\n【提示】\n\n- 在两组通道中，可能都包含了连接传送站 $x,y$ 的通道，此时我们认为这两条通道是不同的。\n- 特殊性质中，A 组通道和 B 组通道的『构成完全相同』是指：如果在 A 组中 $u,v$ 之间存在一条使用人数为 $w$ 的通道，那么在 B 组中 $u,v$ 之间一定也存在一条使用人数为 $w$ 的通道。是否相同与描述方式与描述顺序均无关。即在构成完全相同的两组通道 A 和 B 中，通道输入的顺序不一定相同，每条通道的端点的输入顺序也不一定相同（对于 A、B 组中一条连接 $u,v$ 的使用人数为 $w$ 的通道，一种可能出现的输入为： A 组通道中输入 $u\\ v\\ w$，而 B 组通道中输入 $v\\ u\\ w$）。", "locale": "zh-CN"}}}
{"pid": "P4221", "type": "P", "difficulty": 6, "samples": [["3 2 1\n1 2\n2 3\n1 1 1", "1"]], "limits": {"time": [15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 10000, 10000, 10000, 10000, 10000, 10000], "memory": [1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000]}, "tags": ["数学", "2018", "WC", "状压 DP"], "title": "[WC2018] 州区划分", "background": "**滥用本题评测将被封号！**", "description": "小 S 现在拥有 $n$ 座城市，第 $i$ 座城市的人口为 $w_i$，城市与城市之间可能有双向道路相连。\n\n现在小 S 要将这 $n$ 座城市划分成若干个州，每个州由至少一个城市组成，每个城市在恰好一个州内。\n\n假设小 S 将这些城市划分成了 $k$ 个州，设 $V_i$ 是第 $i$ 个州包含的所有城市组成的集合。定义一条道路是一个州的内部道路，当且仅当这条道路的两个端点城市都在这个州内。如果一个州内部存在一条起点终点相同，不经过任何不属于这个州的城市，且经过这个州的所有内部道路都恰好一次并且经过这个州的所有城市至少一次的路径（路径长度可以为 $0$），则称这个州是不合法的。\n\n定义第 $i$ 个州的满意度为：第 $i$ 个州的人口在前 $i$ 个州的人口中所占比例的 $p$ 次幂，即：\n\n$$\\left(\\dfrac{\\sum _ {x \\in V _ i} w _ x}{\\sum _ {j = 1} ^ i \\sum _ {x \\in V _ j} w _ x}\\right) ^ p$$\n\n\n定义一个划分的满意度为所有州的满意度的乘积。\n\n求所有合法的划分方案的满意度之和。\n\n答案对 $998244353$ 取模。\n两个划分 $\\{V_1, V _ 2, \\cdots, V_k\\}$ 和 $\\{C_1, C _ 2, \\cdots, C_s\\}$ 是不同的，当且仅当 $k \\neq s$，或存在某个 $1 \\leq i \\leq k$，使得 $V_i \\neq C_i$。", "inputFormat": "\n输入第一行包含三个整数 $n,m,p$，表示城市个数、城市之间的道路个数以及题目描述中的常数 $p$。\n\n接下来 $m$ 行，每行两个正整数 $u,v$，描述一条无向的道路，保证无重边无自环。\n\n输入第 $m+2$ 行有 $n$ 个正整数，第 $i$ 个正整数表示 $w_i$。", "outputFormat": "\n输出一行一个整数表示答案在模 $998244353$ 意义下的取值。\n\n即设答案化为最简分式后的形式为 $a/b$ ，其中 $a$ 和 $b$ 互质。输出整数 $x$ 使得 $bx \\equiv a \\pmod{ 998244353}$ 且 $0 \\leq x < 998244353$。可以证明这样的整数 $x$ 是唯一的。", "hint": "\n\n【提示】\n\n$x^{p-1} \\equiv 1 \\pmod p$，其中 $p$ 为质数， $x \\in [1,p)$。\n\n保证对于所有数据有：$0 \\leq n \\leq 21$， $0 \\leq m \\leq \\dfrac{n\\times (n-1)}{2}$ ， $0 \\leq p \\leq 2$， $1 \\leq w_i \\leq 100$。\n", "locale": "zh-CN", "translations": {"en": {"title": "[WC2018] State Partition", "background": "**Abusing the judge for this problem will result in a ban!**", "description": "Xiao S currently has $n$ cities. The population of the $i$-th city is $w_i$, and there may be bidirectional roads between cities.\n\nNow Xiao S will partition these $n$ cities into several states. Each state contains at least one city, and each city belongs to exactly one state.\n\nSuppose Xiao S partitions the cities into $k$ states. Let $V_i$ be the set of all cities contained in the $i$-th state. A road is defined to be an internal road of a state if and only if both of its endpoint cities are within that state. A state is called illegal if and only if there exists a path within this state that starts and ends at the same city, does not pass through any city outside this state, traverses every internal road of this state exactly once, and visits every city of this state at least once (the path length may be $0$).\n\nDefine the satisfaction of the $i$-th state as the $p$-th power of the proportion of the $i$-th state's population in the total population of the first $i$ states, that is:\n$$\\left(\\dfrac{\\sum _ {x \\in V _ i} w _ x}{\\sum _ {j = 1} ^ i \\sum _ {x \\in V _ j} w _ x}\\right) ^ p$$\n\nDefine the satisfaction of a partition as the product of the satisfactions of all states.\n\nCompute the sum of the satisfactions of all legal partitions.\n\nTake the answer modulo $998244353$. Two partitions $\\{V_1, V _ 2, \\cdots, V_k\\}$ and $\\{C_1, C _ 2, \\cdots, C_s\\}$ are different if and only if $k \\neq s$, or there exists some $1 \\leq i \\leq k$ such that $V_i \\neq C_i$.", "inputFormat": "The first line contains three integers $n, m, p$, denoting the number of cities, the number of roads between cities, and the constant $p$ in the statement.\n\nThe next $m$ lines each contain two positive integers $u, v$, describing an undirected road. There are no multiple edges and no self-loops.\n\nLine $m+2$ contains $n$ positive integers, where the $i$-th integer is $w_i$.", "outputFormat": "Output a single integer, which is the value of the answer modulo $998244353$.\n\nThat is, let the answer in lowest terms be $a/b$, where $a$ and $b$ are coprime. Output an integer $x$ such that $b x \\equiv a \\pmod{ 998244353}$ and $0 \\leq x < 998244353$. It can be proven that such an integer $x$ is unique.", "hint": "$[ \\text{Hint} ]$\n\n$x^{p-1} \\equiv 1 \\pmod p$, where $p$ is a prime and $x \\in [1, p)$.\n\nConstraints (guaranteed for all testdata):\n$0 \\leq n \\leq 21$, $0 \\leq m \\leq \\dfrac{n \\times (n-1)}{2}$, $0 \\leq p \\leq 2$, $1 \\leq w_i \\leq 100$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[WC2018] 州区划分", "background": "**滥用本题评测将被封号！**", "description": "小 S 现在拥有 $n$ 座城市，第 $i$ 座城市的人口为 $w_i$，城市与城市之间可能有双向道路相连。\n\n现在小 S 要将这 $n$ 座城市划分成若干个州，每个州由至少一个城市组成，每个城市在恰好一个州内。\n\n假设小 S 将这些城市划分成了 $k$ 个州，设 $V_i$ 是第 $i$ 个州包含的所有城市组成的集合。定义一条道路是一个州的内部道路，当且仅当这条道路的两个端点城市都在这个州内。如果一个州内部存在一条起点终点相同，不经过任何不属于这个州的城市，且经过这个州的所有内部道路都恰好一次并且经过这个州的所有城市至少一次的路径（路径长度可以为 $0$），则称这个州是不合法的。\n\n定义第 $i$ 个州的满意度为：第 $i$ 个州的人口在前 $i$ 个州的人口中所占比例的 $p$ 次幂，即：\n\n$$\\left(\\dfrac{\\sum _ {x \\in V _ i} w _ x}{\\sum _ {j = 1} ^ i \\sum _ {x \\in V _ j} w _ x}\\right) ^ p$$\n\n\n定义一个划分的满意度为所有州的满意度的乘积。\n\n求所有合法的划分方案的满意度之和。\n\n答案对 $998244353$ 取模。\n两个划分 $\\{V_1, V _ 2, \\cdots, V_k\\}$ 和 $\\{C_1, C _ 2, \\cdots, C_s\\}$ 是不同的，当且仅当 $k \\neq s$，或存在某个 $1 \\leq i \\leq k$，使得 $V_i \\neq C_i$。", "inputFormat": "\n输入第一行包含三个整数 $n,m,p$，表示城市个数、城市之间的道路个数以及题目描述中的常数 $p$。\n\n接下来 $m$ 行，每行两个正整数 $u,v$，描述一条无向的道路，保证无重边无自环。\n\n输入第 $m+2$ 行有 $n$ 个正整数，第 $i$ 个正整数表示 $w_i$。", "outputFormat": "\n输出一行一个整数表示答案在模 $998244353$ 意义下的取值。\n\n即设答案化为最简分式后的形式为 $a/b$ ，其中 $a$ 和 $b$ 互质。输出整数 $x$ 使得 $bx \\equiv a \\pmod{ 998244353}$ 且 $0 \\leq x < 998244353$。可以证明这样的整数 $x$ 是唯一的。", "hint": "\n\n【提示】\n\n$x^{p-1} \\equiv 1 \\pmod p$，其中 $p$ 为质数， $x \\in [1,p)$。\n\n保证对于所有数据有：$0 \\leq n \\leq 21$， $0 \\leq m \\leq \\dfrac{n\\times (n-1)}{2}$ ， $0 \\leq p \\leq 2$， $1 \\leq w_i \\leq 100$。\n", "locale": "zh-CN"}}}
{"pid": "P4222", "type": "P", "difficulty": 5, "samples": [["20", "0001321"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["2012", "重庆", "各省省选", "O2优化"], "title": "[CQOI2012] 编号", "background": "", "description": "你需要给一批商品编号，其中每个编号都是一个 $7$ 位 $16$ 进制\n数（由 $0$ 至 $9$, $a$ 至 $f$ 组成）。\n\n为了防止在人工处理时不小心把编号弄错，要求任意两个编号至少有三个位置对应的数字不相同。\n\n第一个编号为 $0000000$，第二个编号为不违反上述规定的前提下最小的编号，…，每次分配一个新编号时，总是选择不和前面编号冲突的最小编号（注意到编号都是 $16$ 进制数，可以比较大小）。\n\n按此规律，前面若干编号分别是：\n\n$$0000000,0000111,0000222,…,0000fff,0001012,0001103,0001230,00\n01321,0001456,…$$\n\n输入 $k$，你的任务是求出第 $k$ 小的编号。", "inputFormat": "一行一个数，为整数 $k$。", "outputFormat": "输出第 $k$ 小的编号（字母均为小写）。输入保证这个编号存在。", "hint": "对于 15% 的数据，$k \\leq 200$；\n\n对于 35% 的数据，$k \\leq 10000$；\n\n对于 60% 的数据，$k \\leq 200000$。\n\n对于 100% 的数据，$k \\leq 1048576$。", "locale": "zh-CN", "translations": {"en": {"title": "[CQOI2012] Numbering", "background": "", "description": "You need to assign numbers to a batch of products, where each number is a $7$-digit hexadecimal number (composed of $0$ to $9$, $a$ to $f$).\n\nTo prevent mistakes during manual processing, any two numbers must differ in at least three corresponding positions.\n\nThe first number is $0000000$, the second is the smallest number that does not violate the above rule, … Each time a new number is assigned, always choose the smallest number that does not conflict with the previous numbers (note that the numbers are hexadecimal, so they can be compared by value).\n\nFollowing this rule, the first few numbers are:\n$$0000000,0000111,0000222,…,0000fff,0001012,0001103,0001230,0001321,0001456,…$$\n\nGiven $k$, your task is to find the $k$-th smallest number.", "inputFormat": "One integer $k$ on a single line.", "outputFormat": "Output the $k$-th smallest number (letters must be lowercase). The input guarantees that this number exists.", "hint": "For 15% of the testdata, $k \\leq 200$;\n\nFor 35% of the testdata, $k \\leq 10000$;\n\nFor 60% of the testdata, $k \\leq 200000$.\n\nFor 100% of the testdata, $k \\leq 1048576$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[CQOI2012] 编号", "background": "", "description": "你需要给一批商品编号，其中每个编号都是一个 $7$ 位 $16$ 进制\n数（由 $0$ 至 $9$, $a$ 至 $f$ 组成）。\n\n为了防止在人工处理时不小心把编号弄错，要求任意两个编号至少有三个位置对应的数字不相同。\n\n第一个编号为 $0000000$，第二个编号为不违反上述规定的前提下最小的编号，…，每次分配一个新编号时，总是选择不和前面编号冲突的最小编号（注意到编号都是 $16$ 进制数，可以比较大小）。\n\n按此规律，前面若干编号分别是：\n\n$$0000000,0000111,0000222,…,0000fff,0001012,0001103,0001230,00\n01321,0001456,…$$\n\n输入 $k$，你的任务是求出第 $k$ 小的编号。", "inputFormat": "一行一个数，为整数 $k$。", "outputFormat": "输出第 $k$ 小的编号（字母均为小写）。输入保证这个编号存在。", "hint": "对于 15% 的数据，$k \\leq 200$；\n\n对于 35% 的数据，$k \\leq 10000$；\n\n对于 60% 的数据，$k \\leq 200000$。\n\n对于 100% 的数据，$k \\leq 1048576$。", "locale": "zh-CN"}}}
{"pid": "P4223", "type": "P", "difficulty": 7, "samples": [["5 4 \n1 5 4 3 2", "50000"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["树状数组", "枚举", "期望", "矩阵乘法"], "title": "期望逆序对", "background": "WXH大定理定律n", "description": "mcfx领导的修道院试图通过古老的膜法阵召唤出传说中的膜法处佬WXH。在他把召唤用具准备齐全后，mcfx在众人的键盘声中启动了召唤阵。\n\n这时，天地突然暗了下来，膜法阵中心电闪雷鸣。一道金光从天而降，金色的代码飘在了半空中。不一会，一个登陆界面显现了出来。mcfx仔细观察后发现上面有如下文字：\n\n\"WXHCoder是过去到未来所有的题目都有的题库。如果想要登陆它，你们必须解决接下来这道题。\"\n\n这道题目是这样子的：给你一个长为$n$的排列，有$k$次操作，每次随机选择两个不同的数交换，问期望逆序对数乘${{n}\\choose{2}}^k$的结果。\n\nmcfx发现数据范围是$n,k≤10^{20010910}$，他打算先探究更小的$n,k$。\n\n${n}\\choose{2}$表示在$n$个球中选两个的方案数", "inputFormat": "第一行两个整数$n,k$\n\n第二行一个$1$到$n$的排列", "outputFormat": "输出期望逆序对数乘${{n}\\choose{2}}^k$的结果模$10^9+7$", "hint": "$n≤500000,k≤10^9$", "locale": "zh-CN", "translations": {"en": {"title": "Expected Inversions", "background": "WXH Grand Theorem Law n.", "description": "The monastery led by mcfx attempts to summon the legendary “memetic master” WXH through an ancient ritual array. After preparing all the summoning tools, mcfx activates the array to the clatter of many keyboards.\n\nSuddenly, heaven and earth darken, and lightning strikes the center of the array. A golden beam descends from the sky, with golden code drifting in midair. Soon, a login interface appears. Upon careful inspection, mcfx sees the following text:\n\n\"WXHCoder is a problem bank that contains every problem from the past to the future. If you want to log into it, you must solve the following problem.\"\n\nThe problem is as follows: You are given a permutation of length $n$. There are $k$ operations. In each operation, two distinct numbers are chosen uniformly at random and swapped. Find the expected number of inversions multiplied by ${{n}\\choose{2}}^k$.\n\nmcfx discovered that the Constraints are $n, k \\le 10^{20010910}$, so he decides to first explore smaller $n, k$.\n\n${n}\\choose{2}$ denotes the number of ways to choose two from $n$ balls.", "inputFormat": "The first line contains two integers $n, k$.\n\nThe second line contains a permutation of $1$ through $n$.", "outputFormat": "Output the expected number of inversions multiplied by ${{n}\\choose{2}}^k$ modulo $10^9+7$.", "hint": "$n \\le 500000, k \\le 10^9$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "期望逆序对", "background": "WXH大定理定律n", "description": "mcfx领导的修道院试图通过古老的膜法阵召唤出传说中的膜法处佬WXH。在他把召唤用具准备齐全后，mcfx在众人的键盘声中启动了召唤阵。\n\n这时，天地突然暗了下来，膜法阵中心电闪雷鸣。一道金光从天而降，金色的代码飘在了半空中。不一会，一个登陆界面显现了出来。mcfx仔细观察后发现上面有如下文字：\n\n\"WXHCoder是过去到未来所有的题目都有的题库。如果想要登陆它，你们必须解决接下来这道题。\"\n\n这道题目是这样子的：给你一个长为$n$的排列，有$k$次操作，每次随机选择两个不同的数交换，问期望逆序对数乘${{n}\\choose{2}}^k$的结果。\n\nmcfx发现数据范围是$n,k≤10^{20010910}$，他打算先探究更小的$n,k$。\n\n${n}\\choose{2}$表示在$n$个球中选两个的方案数", "inputFormat": "第一行两个整数$n,k$\n\n第二行一个$1$到$n$的排列", "outputFormat": "输出期望逆序对数乘${{n}\\choose{2}}^k$的结果模$10^9+7$", "hint": "$n≤500000,k≤10^9$", "locale": "zh-CN"}}}
{"pid": "P4224", "type": "P", "difficulty": 7, "samples": [["5 10 10\n1 2 5 9 10\n2\n1 7\n3\n3\n0 8\n3\n2\n1 8\n3\n0 3", "3 1\n2 2\n2 2\n2 2\n1 3\n1 4\n1 3\n1 2\n2 1\n1 2\n1 3"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000, 1024000]}, "tags": ["2017", "枚举", "排序", "CTT（清华集训/北大集训）"], "title": "[清华集训 2017] 简单数据结构", "background": "", "description": "参加完IOI2018之后就是姚班面试。而你，由于讨厌物理、并且想成为乔布斯一样的创业家，被成功踢回贵系。\n\n转眼，时间的指针被指向2019，大二，12月初，考试周。\n\n你早听学长说，数据结构期中考很难，对竞赛生不友好，集训队选手做不完卷子。\n\n你冷笑。哼，堂堂国际金，这点难度的考试算什么。\n\n两小时，你看完习题解析前五章所有内容，并且倒背如流；\n\n一小时，你看了500页的讲义，并且记忆犹新；\n\n十分钟，你骑车到考场，自信的你只带了一把水笔，虽然考试让带资料；\n\n现在，摊开传说中神级卷子，你定神一看——\n\n给出一个长度为 $N$ 的序列 $A_1,A_2,\\cdots,A_N$，如果 $A$ 中的一个子序列         $B_1,B_2,\\cdots,B_M$，满足条件：\n\n$1 \\le M \\le N$\n\n∀$1 \\le i \\le M$，$B_i$|$B_{i+1}$\n\n那么称 $B$ 为 $A$ 的上升倍数子序列。\n\n现在有一个长度为 $N$ 的序列 $A$ 被初始化为 $A_{1},A_{2},\\cdots,A_{N}$，以及 $Q$ 次对序列 $A$ 的操作。此处要求实现如下四种操作：\n\n0 x：在序列 $A$ 的最左端插入一个数字 $x$；\n\n1 x：在序列 $A$ 的最右端插入一个数字 $x$；\n\n2：移除序列 $A$ 最左端的一个数字；\n\n3：移除序列 $A$ 最右端的一个数字；\n\n在初始化序列 $A$ 和每次操作之后，请计算此时序列 $A$ 中最长上升倍数子序列的长度 $\\mathrm{MaxLen}$，以及所有长度为 $\\mathrm{MaxLen}$ 的上升倍数子序列的不同的开头数 $\\mathrm{Cnt}$，输出 $\\mathrm{MaxLen}$ 和 $\\mathrm{Cnt}$。\n\n为了大幅度降低题目难度，保证在任意时刻序列 $A$ 非空，其中的元素互不相等，并且均为 $1\\sim M$ 之间的正整数；同一个数字最多只会被插入 $C$ 次。\n", "inputFormat": "输入第一行包含三个正整数 $N,M,Q$，具体含义见上，保证 $1\\le N \\le 10^5$，$N \\le M \\le 10^6$，$0\\le Q \\le 10^5$；\n\n\n输入第二行包含 $N$ 个正整数，为 $A_1,A_2,\\cdots,A_N$，保证 $1\\le A_i\\le M$，并且序列 $A$ 中的元素互不相等；\n\n\n接下来共 $Q$ 行输入，每行输入格式形如0 x或者1 x或者2或者3，具体含义见上。\n", "outputFormat": "输出共 $Q+1$ 行，在初始化和每次对序列 $A$ 操作后，输出 $A$ 中最长上升倍数子序列的长度 $\\mathrm{MaxLen}$ 和所有长度为 $\\mathrm{MaxLen}$ 的上升倍数子序列的不同的开头数 $\\mathrm{Cnt}$，用一个空格隔开。\n", "hint": "**样例解释**\n\n表格中以//隔开不同开头的最长上升子序列。\n\n ![](https://cdn.luogu.com.cn/upload/pic/13370.png) \n\n对于所有的数据，有 $1\\le N \\le 10^5$，$N\\le M \\le 10^6$，$0\\le Q \\le 10^5$，$1\\le A_i\\le M$，$C=10$。\n\n\n下表展示了某些数据点的一些特殊约束，其中只有1表示只有形如1 x的操作，其他表述同理。\n\n![](https://cdn.luogu.com.cn/upload/pic/13371.png)\n\n后记\n\n“奋战两小时，考个四五十”的表情包占领了你的朋友圈：\n\n    “啊，感觉自己人生完全了”\n    “但愿……我真的能拿到四五十”\n    “我考完了……考完了……完了”\n    “曾经以为是开玩笑的，原来我还是naïve了”\n\n你冷笑。提前半小时交卷，你自然觉得，数据结构，满分，正常。", "locale": "zh-CN", "translations": {"en": {"title": "[Tsinghua Training Camp 2017] Simple Data Structure", "background": "", "description": "After IOI 2018 comes the interview for the \"Yao Class\". But you, because you dislike physics and want to become an entrepreneur like Steve Jobs, are successfully kicked back to the CS Department.\n\nIn the blink of an eye, the clock points to 2019, sophomore year, early December, finals week.\n\nYou had long heard seniors say that the midterm exam for Data Structures is hard, unfriendly to competitive programmers, and even training team members cannot finish the paper.\n\nYou sneer. Hmph, as an IOI gold medalist, what’s so hard about this exam.\n\nIn two hours, you read all content of the first five chapters of the solution manual and can recite it backwards.\n\nIn one hour, you read a 500-page handout and remember it vividly.\n\nIn ten minutes, you bike to the exam room. Confidently, you bring only a pen, even though it’s an open-book exam.\n\nNow, you unfold the legendary god-tier paper, take a deep breath, and see—\n\nGiven a sequence of length $N$, $A_1, A_2, \\cdots, A_N$. If a subsequence $B_1, B_2, \\cdots, B_M$ of $A$ satisfies:\n\n$1 \\le M \\le N$\n\n∀$1 \\le i \\le M$，$B_i$|$B_{i+1}$\n\nthen we call $B$ an \"increasing multiple subsequence\" of $A$.\n\nNow there is a sequence $A$ of length $N$ initialized as $A_{1}, A_{2}, \\cdots, A_{N}$, and there are $Q$ operations on $A$. You are required to implement the following four operations:\n\n0 x: Insert a number $x$ at the left end of sequence $A$.\n\n1 x: Insert a number $x$ at the right end of sequence $A$.\n\n2: Remove one number from the left end of sequence $A$.\n\n3: Remove one number from the right end of sequence $A$.\n\nAfter initializing sequence $A$ and after each operation, compute the length $\\mathrm{MaxLen}$ of the longest increasing multiple subsequence in the current $A$, and the number $\\mathrm{Cnt}$ of distinct starting numbers among all increasing multiple subsequences of length $\\mathrm{MaxLen}$. Output $\\mathrm{MaxLen}$ and $\\mathrm{Cnt}$.\n\nTo drastically reduce the difficulty, it is guaranteed that the sequence $A$ is non-empty at any time, its elements are all distinct, and all elements are positive integers between $1 \\sim M$. Each same number will be inserted at most $C$ times.", "inputFormat": "The first line of input contains three positive integers $N, M, Q$ as described above. It is guaranteed that $1 \\le N \\le 10^5$, $N \\le M \\le 10^6$, $0 \\le Q \\le 10^5$.\n\nThe second line contains $N$ positive integers, which are $A_1, A_2, \\cdots, A_N$. It is guaranteed that $1 \\le A_i \\le M$, and all elements in sequence $A$ are distinct.\n\nThen there are $Q$ lines. Each line is in one of the following formats: 0 x, or 1 x, or 2, or 3, with meanings as described above.", "outputFormat": "Output $Q+1$ lines. After initialization and after each operation on sequence $A$, output the length $\\mathrm{MaxLen}$ of the longest increasing multiple subsequence in $A$ and the number $\\mathrm{Cnt}$ of distinct starting numbers among all increasing multiple subsequences of length $\\mathrm{MaxLen}$, separated by a single space.", "hint": "Sample explanation.\n\nIn the table, different longest increasing subsequences are separated by //.\n\n ![](https://cdn.luogu.com.cn/upload/pic/13370.png) \n\nFor all testdata, $1 \\le N \\le 10^5$, $N \\le M \\le 10^6$, $0 \\le Q \\le 10^5$, $1 \\le A_i \\le M$, $C = 10$.\n\nThe table below shows some special constraints for certain data points. Here, “only 1” means only operations of the form 1 x; similar statements apply to the others.\n\n![](https://cdn.luogu.com.cn/upload/pic/13371.png)\n\nPostscript.\n\nThe meme “fight for two hours, score forty or fifty” has taken over your social feed:\n\n    “Ah, I feel like my life is complete.”\n    “I hope... I can really get forty or fifty.”\n    “I finished the exam... Finished... Doomed.”\n    “I used to think it was a joke, turns out I was still naïve.”\n\nYou sneer. You hand in the paper half an hour early, naturally thinking: Data Structures, full score, as expected.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[清华集训 2017] 简单数据结构", "background": "", "description": "参加完IOI2018之后就是姚班面试。而你，由于讨厌物理、并且想成为乔布斯一样的创业家，被成功踢回贵系。\n\n转眼，时间的指针被指向2019，大二，12月初，考试周。\n\n你早听学长说，数据结构期中考很难，对竞赛生不友好，集训队选手做不完卷子。\n\n你冷笑。哼，堂堂国际金，这点难度的考试算什么。\n\n两小时，你看完习题解析前五章所有内容，并且倒背如流；\n\n一小时，你看了500页的讲义，并且记忆犹新；\n\n十分钟，你骑车到考场，自信的你只带了一把水笔，虽然考试让带资料；\n\n现在，摊开传说中神级卷子，你定神一看——\n\n给出一个长度为 $N$ 的序列 $A_1,A_2,\\cdots,A_N$，如果 $A$ 中的一个子序列         $B_1,B_2,\\cdots,B_M$，满足条件：\n\n$1 \\le M \\le N$\n\n∀$1 \\le i \\le M$，$B_i$|$B_{i+1}$\n\n那么称 $B$ 为 $A$ 的上升倍数子序列。\n\n现在有一个长度为 $N$ 的序列 $A$ 被初始化为 $A_{1},A_{2},\\cdots,A_{N}$，以及 $Q$ 次对序列 $A$ 的操作。此处要求实现如下四种操作：\n\n0 x：在序列 $A$ 的最左端插入一个数字 $x$；\n\n1 x：在序列 $A$ 的最右端插入一个数字 $x$；\n\n2：移除序列 $A$ 最左端的一个数字；\n\n3：移除序列 $A$ 最右端的一个数字；\n\n在初始化序列 $A$ 和每次操作之后，请计算此时序列 $A$ 中最长上升倍数子序列的长度 $\\mathrm{MaxLen}$，以及所有长度为 $\\mathrm{MaxLen}$ 的上升倍数子序列的不同的开头数 $\\mathrm{Cnt}$，输出 $\\mathrm{MaxLen}$ 和 $\\mathrm{Cnt}$。\n\n为了大幅度降低题目难度，保证在任意时刻序列 $A$ 非空，其中的元素互不相等，并且均为 $1\\sim M$ 之间的正整数；同一个数字最多只会被插入 $C$ 次。\n", "inputFormat": "输入第一行包含三个正整数 $N,M,Q$，具体含义见上，保证 $1\\le N \\le 10^5$，$N \\le M \\le 10^6$，$0\\le Q \\le 10^5$；\n\n\n输入第二行包含 $N$ 个正整数，为 $A_1,A_2,\\cdots,A_N$，保证 $1\\le A_i\\le M$，并且序列 $A$ 中的元素互不相等；\n\n\n接下来共 $Q$ 行输入，每行输入格式形如0 x或者1 x或者2或者3，具体含义见上。\n", "outputFormat": "输出共 $Q+1$ 行，在初始化和每次对序列 $A$ 操作后，输出 $A$ 中最长上升倍数子序列的长度 $\\mathrm{MaxLen}$ 和所有长度为 $\\mathrm{MaxLen}$ 的上升倍数子序列的不同的开头数 $\\mathrm{Cnt}$，用一个空格隔开。\n", "hint": "**样例解释**\n\n表格中以//隔开不同开头的最长上升子序列。\n\n ![](https://cdn.luogu.com.cn/upload/pic/13370.png) \n\n对于所有的数据，有 $1\\le N \\le 10^5$，$N\\le M \\le 10^6$，$0\\le Q \\le 10^5$，$1\\le A_i\\le M$，$C=10$。\n\n\n下表展示了某些数据点的一些特殊约束，其中只有1表示只有形如1 x的操作，其他表述同理。\n\n![](https://cdn.luogu.com.cn/upload/pic/13371.png)\n\n后记\n\n“奋战两小时，考个四五十”的表情包占领了你的朋友圈：\n\n    “啊，感觉自己人生完全了”\n    “但愿……我真的能拿到四五十”\n    “我考完了……考完了……完了”\n    “曾经以为是开玩笑的，原来我还是naïve了”\n\n你冷笑。提前半小时交卷，你自然觉得，数据结构，满分，正常。", "locale": "zh-CN"}}}
{"pid": "P4225", "type": "P", "difficulty": 7, "samples": [["0 1\n1\nLL_RR 1", "0 0 1 1"], ["0 1\n3\nLRRL_ 1\nLRR_L 1\nLLR_R 1", "4 2 0 2"], ["0 1\n1\nLRRL_ 1000000", "421273116 0 0 1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["2017", "O2优化", "CTT（清华集训/北大集训）"], "title": "[清华集训 2017] 福若格斯", "background": "小d是4xx9小游戏高手。", "description": "有一天，小d发现了一个很经典的小游戏：跳青蛙。\n\n游戏在一个5个格子的棋盘上进行。在游戏的一开始，最左边的两个格子上各有一个向右的青蛙，最右边的两个格子上各有一个向左的青蛙。\n\n![0](https://i.loli.net/2017/12/14/5a32622508ea9.png)\n\n每次移动可以选取一个青蛙，向这只青蛙的前方移动一格到空格子中或跳过前方的一个不同朝向的青蛙并移动到空格子中。\n\n![1](https://i.loli.net/2017/12/14/5a3262250ca07.png)\n\n![2](https://i.loli.net/2017/12/14/5a3262250e38a.png)\n\n为了使你更好地理解这个游戏，我们下发了一个游戏demo作为参考（注意：这个demo中的棋盘大小和题目中并不相同）。\n\n这个游戏本身当然难不倒小d，小d轻松地就解决了这个游戏。但是一个人玩游戏实在是太寂寞了，于是小d找到了小m和他一起玩耍。小d规定，自己只能操控向右的青蛙，小m只能操控向左的青蛙。\n\n小d很快发现，这个游戏想要做到双方轮流行动，就无法达到交换所有青蛙的游戏结局。于是，小d打开了m个游戏，并规定双方轮流行动，每次选择其中一个游戏并控制自己的青蛙行动一步（不能不动）。小d发现，这么做的话就能够使大部分的游戏最终都交换所有的青蛙了。\n\n由于小d是坑队友高手，所以他们玩了一会之后，就开始互相坑害对方，都希望使对方无法行动。他们约定，当轮到一方行动时，若其所有的青蛙都无法行动，则对方获得游戏的胜利。正当博弈论大师小d计算着谁会成为最后的胜者时，电脑卡死了。小d发现，只能kill掉一些游戏才能使剩下的游戏进行下去了。由于电脑已经卡死了，小d无法自由选择kill掉哪些游戏，只能运行系统自带的随机kill小程序。具体来说，小d运行这个随机kill小程序之后，每个游戏有 1/2 ​​的概率被kill掉，有 1/2 ​​的概率能够继续下去。游戏之间被kill掉的概率是独立的。\n\n小d思考了一番，决定如果运行小程序之后他的胜率过低，就直接重启电脑。这时，小d突然发现自己已经不记得刚才轮到谁行动了，于是他决定综合考虑自己先手和后手的胜率。\n\n小d并不擅长概率论，他想让你告诉他运行小程序后，剩下的局面为小d必胜、小m必胜、先手必胜、后手必胜的概率各为多少，这样他才能更好地决定是否重启电脑。\n\n为了避免精度问题，输出答案乘$2^m$​​之后对$998244353$取模的结果。\n\n注意：题目并不保证输入的所有m个状态中小m和小d之前的总行动步数相差不超过1，但是保证不会出现起始状态无法到达的状态。", "inputFormat": "从标准输入读入数据。\n\n我们使用一个长度为5的字符串来表示一个状态，其中，L表示面朝右的青蛙，R表示面朝左的青蛙，_（下划线）表示空格子。例如，初始状态为LL_RR。\n\n本题含有多组数据，第一行两个整数$T,C$($1\\leq C\\leq 100$)分别表示测试点编号和数据组数。\n\n对于每组数据，第一行一个整数$n$($1\\leq n\\leq 23$)表示不同状态的棋盘个数，接下来n行每行一个长度为5的字符串$s_i$​​和一个正整数$a_i$​​($1\\leq a_i\\leq 10^6$​​)，分别表示棋盘的状态和在该状态下的棋盘的个数。\n\n保证输入的字符串合法且不重复。\n", "outputFormat": "输出到标准输出。\n\n定义$m=\\sum a_i$​​。\n\n对于每组数据，输出一行四个整数，分别表示小d必胜（即L的控制方必胜）、小m必胜（即R的控制方必胜）、先手必胜、后手必胜的概率乘$2^m$​​之后对$998244353$取模的结果。\n", "hint": "**样例1解释**\n对于样例1，若该游戏没有被kill，双方唯一可能的操作序列为LL_RR -> L_LRR -> LRL_R -> LR_LR -> LRRL_ -> LRR_L -> L胜，小m先手时同理，故该情况为先手必胜。若该游戏被kill了，双方都没有合法行动，后手必胜。\n\n**样例2解释**\n对于样例2，令这三个棋盘的状态从上到下为A,B,C，则$\\{A,B,C\\},\\{A,B\\},\\{A,C\\},\\{A\\}$,$\\{A\\}$为小d必胜，$\\{C\\},\\{B,C\\}$为小m必胜，$\\{B\\},\\{\\}$为后手必胜。\n\n保证数据中不会出现从LL_RR状态无法到达的状态（如RLLR_），故合法的状态共有23种。\n\n定义 $k-$不可达点 为从LL_RR操作$k$次（双方加起来一共操作$k$次，顺序任意）后依然无法到达的合法状态，如 1-不可达点 为 ：全集{LL_RR,L_LRR,LLR_R} 共20个， 5-不可达点 为{RLR_L,RRL_L,RR_LL,R_LRL,R_RLL}。\n\n对于100%的数据，$1\\leq n\\leq 23,1\\leq m\\leq 10^6,1\\leq C\\leq 100$，所有可能出现在该数据点的状态均为等概率出现（也就是说你可以认为最后一个点中每种状态的$a_i$之和大约为$10^8/23$。\n\n![12](https://cdn.luogu.com.cn/upload/pic/14334.png)\n![13](https://cdn.luogu.com.cn/upload/pic/14335.png)\n", "locale": "zh-CN", "translations": {"en": {"title": "[Tsinghua Training 2017] Froggers", "background": "Little d is a 4xx9 mini‑game expert.", "description": "One day, little d found a classic mini‑game: frog jumping.\n\nThe game is played on a board with 5 cells. At the beginning, there is one frog facing right on each of the two leftmost cells, and one frog facing left on each of the two rightmost cells.\n\n![0](https://i.loli.net/2017/12/14/5a32622508ea9.png)\n\nIn each move, you can choose a frog and either move it one cell forward into an empty cell, or jump over one frog in front of it that faces the opposite direction and land in an empty cell.\n\n![1](https://i.loli.net/2017/12/14/5a3262250ca07.png)\n\n![2](https://i.loli.net/2017/12/14/5a3262250e38a.png)\n\nTo help you better understand the game, we provide a demo as a reference (note: the board size in the demo is not the same as in the problem).\n\nThis game itself is of course easy for little d, and he quickly solved it. But playing alone is too lonely, so little d asked little m to play together. They agreed that little d can only control frogs facing right, and little m can only control frogs facing left.\n\nLittle d soon found that if the two players strictly alternate turns, then it is impossible to reach the end state where all frogs swap sides. So, little d opened m parallel games and stipulated that the two players alternate turns; on each turn they must choose exactly one of the games and move one of their own frogs in that game (they cannot pass). Little d found that with this setup, in most of the games the frogs can eventually swap sides.\n\nSince little d is good at trolling teammates, after a while they started trying to trap each other, both hoping to make the other unable to move. They agreed that when it is a player's turn, if none of that player's frogs in any remaining game can move, then the opponent wins the match. Just as the game theory master little d was calculating who would be the final winner, the computer froze. Little d realized he had to kill some games to let the rest proceed. Since the computer had already frozen, he could not freely choose which games to kill, and could only run the system’s built‑in random kill program. Specifically, after running this random kill program, each game is killed independently with probability 1/2 and survives with probability 1/2.\n\nAfter thinking for a while, little d decided that if his winning probability after running the program was too low, he would just reboot the computer. At this moment, little d suddenly realized he no longer remembered whose turn it was, so he decided to consider both the first‑move and second‑move winning probabilities.\n\nLittle d is not good at probability, and he wants you to tell him, after running the program, the probabilities that the remaining overall position is: d must win, m must win, first player must win, or second player must win. This will help him decide whether to reboot.\n\nTo avoid precision issues, output each probability multiplied by $2^m$ and then taken modulo $998244353$.\n\nNote: The problem does not guarantee that the total number of moves previously made by little m and little d across all m games differs by at most 1, but it guarantees that no state that is unreachable from the initial state appears.", "inputFormat": "Read from standard input.\n\nWe use a string of length 5 to represent a state. L denotes a frog facing right, R denotes a frog facing left, and _ (underscore) denotes an empty cell. For example, the initial state is LL_RR.\n\nThis problem contains multiple datasets. The first line contains two integers $T, C$ ($1 \\leq C \\leq 100$), denoting the testset ID and the number of datasets, respectively.\n\nFor each dataset, the first line contains an integer $n$ ($1 \\leq n \\leq 23$) denoting the number of distinct board states. Then follow $n$ lines, each containing a length‑5 string $s_i$ and a positive integer $a_i$ ($1 \\leq a_i \\leq 10^6$), representing a state and the number of boards in that state.\n\nAll input strings are valid and pairwise distinct.", "outputFormat": "Output to standard output.\n\nLet $m = \\sum a_i$.\n\nFor each dataset, output one line with four integers, denoting the probabilities that little d must win (i.e., the controller of L must win), little m must win (i.e., the controller of R must win), the first player must win, and the second player must win, respectively, each multiplied by $2^m$ and then taken modulo $998244353$.", "hint": "Sample 1 explanation:\nFor Sample 1, if that game is not killed, the only possible move sequence is LL_RR -> L_LRR -> LRL_R -> LR_LR -> LRRL_ -> LRR_L -> L wins; similarly when little m moves first, so in this case the first player must win. If that game is killed, neither player has a legal move, and the second player must win.\n\nSample 2 explanation:\nFor Sample 2, let the three board states from top to bottom be A, B, C. Then $\\{A,B,C\\}, \\{A,B\\}, \\{A,C\\}, \\{A\\}$ are d‑must‑win; $\\{C\\}, \\{B,C\\}$ are m‑must‑win; $\\{B\\}, \\{\\}$ are second‑player‑must‑win.\n\nIt is guaranteed that no state that is unreachable from LL_RR (such as RLLR_) appears in the data, so there are 23 legal states in total.\n\nDefine a k‑unreachable state as a legal state that is still unreachable after making $k$ moves in total from LL_RR (the two players together make $k$ moves in any order). For example, the 1‑unreachable set is the universal set excluding {LL_RR, L_LRR, LLR_R}, which has 20 states; the 5‑unreachable set is {RLR_L, RRL_L, RR_LL, R_LRL, R_RLL}.\n\nFor 100% of the testdata, $1 \\leq n \\leq 23$, $1 \\leq m \\leq 10^6$, $1 \\leq C \\leq 100$, and all states that may appear in that testset are equally likely (that is, you may assume that in the last testset the sum of $a_i$ over each state is about $10^8 / 23$).\n\n![12](https://cdn.luogu.com.cn/upload/pic/14334.png)\n![13](https://cdn.luogu.com.cn/upload/pic/14335.png)\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[清华集训 2017] 福若格斯", "background": "小d是4xx9小游戏高手。", "description": "有一天，小d发现了一个很经典的小游戏：跳青蛙。\n\n游戏在一个5个格子的棋盘上进行。在游戏的一开始，最左边的两个格子上各有一个向右的青蛙，最右边的两个格子上各有一个向左的青蛙。\n\n![0](https://i.loli.net/2017/12/14/5a32622508ea9.png)\n\n每次移动可以选取一个青蛙，向这只青蛙的前方移动一格到空格子中或跳过前方的一个不同朝向的青蛙并移动到空格子中。\n\n![1](https://i.loli.net/2017/12/14/5a3262250ca07.png)\n\n![2](https://i.loli.net/2017/12/14/5a3262250e38a.png)\n\n为了使你更好地理解这个游戏，我们下发了一个游戏demo作为参考（注意：这个demo中的棋盘大小和题目中并不相同）。\n\n这个游戏本身当然难不倒小d，小d轻松地就解决了这个游戏。但是一个人玩游戏实在是太寂寞了，于是小d找到了小m和他一起玩耍。小d规定，自己只能操控向右的青蛙，小m只能操控向左的青蛙。\n\n小d很快发现，这个游戏想要做到双方轮流行动，就无法达到交换所有青蛙的游戏结局。于是，小d打开了m个游戏，并规定双方轮流行动，每次选择其中一个游戏并控制自己的青蛙行动一步（不能不动）。小d发现，这么做的话就能够使大部分的游戏最终都交换所有的青蛙了。\n\n由于小d是坑队友高手，所以他们玩了一会之后，就开始互相坑害对方，都希望使对方无法行动。他们约定，当轮到一方行动时，若其所有的青蛙都无法行动，则对方获得游戏的胜利。正当博弈论大师小d计算着谁会成为最后的胜者时，电脑卡死了。小d发现，只能kill掉一些游戏才能使剩下的游戏进行下去了。由于电脑已经卡死了，小d无法自由选择kill掉哪些游戏，只能运行系统自带的随机kill小程序。具体来说，小d运行这个随机kill小程序之后，每个游戏有 1/2 ​​的概率被kill掉，有 1/2 ​​的概率能够继续下去。游戏之间被kill掉的概率是独立的。\n\n小d思考了一番，决定如果运行小程序之后他的胜率过低，就直接重启电脑。这时，小d突然发现自己已经不记得刚才轮到谁行动了，于是他决定综合考虑自己先手和后手的胜率。\n\n小d并不擅长概率论，他想让你告诉他运行小程序后，剩下的局面为小d必胜、小m必胜、先手必胜、后手必胜的概率各为多少，这样他才能更好地决定是否重启电脑。\n\n为了避免精度问题，输出答案乘$2^m$​​之后对$998244353$取模的结果。\n\n注意：题目并不保证输入的所有m个状态中小m和小d之前的总行动步数相差不超过1，但是保证不会出现起始状态无法到达的状态。", "inputFormat": "从标准输入读入数据。\n\n我们使用一个长度为5的字符串来表示一个状态，其中，L表示面朝右的青蛙，R表示面朝左的青蛙，_（下划线）表示空格子。例如，初始状态为LL_RR。\n\n本题含有多组数据，第一行两个整数$T,C$($1\\leq C\\leq 100$)分别表示测试点编号和数据组数。\n\n对于每组数据，第一行一个整数$n$($1\\leq n\\leq 23$)表示不同状态的棋盘个数，接下来n行每行一个长度为5的字符串$s_i$​​和一个正整数$a_i$​​($1\\leq a_i\\leq 10^6$​​)，分别表示棋盘的状态和在该状态下的棋盘的个数。\n\n保证输入的字符串合法且不重复。\n", "outputFormat": "输出到标准输出。\n\n定义$m=\\sum a_i$​​。\n\n对于每组数据，输出一行四个整数，分别表示小d必胜（即L的控制方必胜）、小m必胜（即R的控制方必胜）、先手必胜、后手必胜的概率乘$2^m$​​之后对$998244353$取模的结果。\n", "hint": "**样例1解释**\n对于样例1，若该游戏没有被kill，双方唯一可能的操作序列为LL_RR -> L_LRR -> LRL_R -> LR_LR -> LRRL_ -> LRR_L -> L胜，小m先手时同理，故该情况为先手必胜。若该游戏被kill了，双方都没有合法行动，后手必胜。\n\n**样例2解释**\n对于样例2，令这三个棋盘的状态从上到下为A,B,C，则$\\{A,B,C\\},\\{A,B\\},\\{A,C\\},\\{A\\}$,$\\{A\\}$为小d必胜，$\\{C\\},\\{B,C\\}$为小m必胜，$\\{B\\},\\{\\}$为后手必胜。\n\n保证数据中不会出现从LL_RR状态无法到达的状态（如RLLR_），故合法的状态共有23种。\n\n定义 $k-$不可达点 为从LL_RR操作$k$次（双方加起来一共操作$k$次，顺序任意）后依然无法到达的合法状态，如 1-不可达点 为 ：全集{LL_RR,L_LRR,LLR_R} 共20个， 5-不可达点 为{RLR_L,RRL_L,RR_LL,R_LRL,R_RLL}。\n\n对于100%的数据，$1\\leq n\\leq 23,1\\leq m\\leq 10^6,1\\leq C\\leq 100$，所有可能出现在该数据点的状态均为等概率出现（也就是说你可以认为最后一个点中每种状态的$a_i$之和大约为$10^8/23$。\n\n![12](https://cdn.luogu.com.cn/upload/pic/14334.png)\n![13](https://cdn.luogu.com.cn/upload/pic/14335.png)\n", "locale": "zh-CN"}}}
{"pid": "P4226", "type": "P", "difficulty": 6, "samples": [["3\n8\n9\n10", "-1\n3 6 6 6\n-1"]], "limits": {"time": [1000, 1000, 1000], "memory": [256000, 256000, 256000]}, "tags": ["贪心", "2017", "Special Judge", "构造", "CTT（清华集训/北大集训）"], "title": "[清华集训 2017] 避难所", "background": "“B君啊，你当年的伙伴都不在北京了，为什么你还在北京呢？”\n\n“大概是因为出了一些事故吧，否则这道题就不叫避难所了。”\n\n“唔，那你之后会去哪呢？”\n\n“去一个没有冬天的地方。”", "description": "对于一个正整数 $n$，我们定义他在 $b$ 进制下，各个位上的数的乘积为 $p=F(n,b)$。\n\n比如 $F(3338,10)=216$。\n\n考虑这样一个问题，已知 $p$ 和 $b$，求最小的 $n$ 满足 $p=F(n,b)$。\n\n这是一个非常有趣的问题，对于一些 $b$ 来说，我们可以贪心来做，比如如果 $b=10,p=216$。\n\n我们可以从 $b-1$ 到 $2$ 试除，直到 $p$ 为 $1$ 为止，答案是 $389$，可以验证 $389$ 是满足 $p=F(n,b)$ 最小的 $n$。\n\n但是对于一些进制 $b$，是不能用贪心做的，比如 $b = 9, p = 216$。使用贪心得到的解是 $3338$，而最优解是 $666$。(均为 $9$ 进制下的。)\n\n本题便是在给定进制 $b$ 的情况下，举出一个这样的反例，或指出这样的反例不存在。\n\n由于计算资源所限，反例中所有数字的乘积不能超过 $10^{18}$​​。如果最小的反例中所有数字的乘积超过了 $10^{18}$​​，那么也应该输出 $-1$。", "inputFormat": "从标准输入读入数据。\n\n第一行一个整数 $t$，表示一共有 $t$ 组数据。\n\n接下来每行一个整数 $b$，表示进制。", "outputFormat": "输出到标准输出。\n\n如果不存在反例，输出一行一个整数 $-1$。\n\n如果存在反例，首先输出一个整数 $k$，表示反例 $n$ 的位数，接下来在同一行输出 $k$ 个十进制整数，表示任意一个反例的最优解。", "hint": "对于第 $1$ 个测试点，分值为 $30$，$1 \\leq n \\leq 32$；\n\n对于第 $2$ 个测试点，分值为 $40$，$1 \\leq n \\leq 100$；\n\n对于第 $3$ 个测试点，分值为 $30$，$1 \\leq t \\leq 200, 1 \\leq n \\leq 100000$。", "locale": "zh-CN", "translations": {"en": {"title": "[Tsinghua Training 2017] Shelter", "background": "“B, all your old friends have left Beijing. Why are you still in Beijing?”\n\n“Probably because of some accidents. Otherwise this problem wouldn’t be called ‘Shelter’.”\n\n“Hmm, where will you go next?”\n\n“To a place without winter.”", "description": "For a positive integer $n$, we define the product of its digits in base $b$ as $p = F(n, b)$.\n\nFor example, $F(3338, 10) = 216$.\n\nConsider the following task: given $p$ and $b$, find the smallest $n$ such that $p = F(n, b)$.\n\nThis problem is quite interesting. For some bases $b$, we can solve it greedily. For example, if $b = 10, p = 216$, we can try dividing $p$ by integers from $b - 1$ down to $2$ until $p$ becomes $1$. The answer is $389$, and you can verify that $389$ is the smallest $n$ satisfying $p = F(n, b)$.\n\nHowever, for some bases $b$, this greedy approach does not work. For instance, when $b = 9, p = 216$, the greedy solution is $3338$, while the optimal answer is $666$ (both in base $9$).\n\nIn this problem, for a given base $b$, either produce such a counterexample or state that no such counterexample exists.\n\nDue to limited computing resources, in any counterexample the product of all digits must not exceed $10^{18}$. If in the smallest counterexample the product of all digits exceeds $10^{18}$, you should output $-1$.", "inputFormat": "Read from standard input.\n\nThe first line contains an integer $t$, the number of test cases.\n\nEach of the next $t$ lines contains an integer $b$, the base.", "outputFormat": "Output to standard output.\n\nIf no counterexample exists, output a single integer $-1$.\n\nIf a counterexample exists, first output an integer $k$, the number of digits of $n$ in the counterexample. Then, on the same line, output $k$ decimal integers, which represent any optimal solution (the digits of the smallest $n$ for that counterexample) in base $b$.", "hint": "- For the 1st subtask (30 points), $1 \\leq b \\leq 32$.\n- For the 2nd subtask (40 points), $1 \\leq b \\leq 100$.\n- For the 3rd subtask (30 points), $1 \\leq t \\leq 200, 1 \\leq b \\leq 100000$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[清华集训 2017] 避难所", "background": "“B君啊，你当年的伙伴都不在北京了，为什么你还在北京呢？”\n\n“大概是因为出了一些事故吧，否则这道题就不叫避难所了。”\n\n“唔，那你之后会去哪呢？”\n\n“去一个没有冬天的地方。”", "description": "对于一个正整数 $n$，我们定义他在 $b$ 进制下，各个位上的数的乘积为 $p=F(n,b)$。\n\n比如 $F(3338,10)=216$。\n\n考虑这样一个问题，已知 $p$ 和 $b$，求最小的 $n$ 满足 $p=F(n,b)$。\n\n这是一个非常有趣的问题，对于一些 $b$ 来说，我们可以贪心来做，比如如果 $b=10,p=216$。\n\n我们可以从 $b-1$ 到 $2$ 试除，直到 $p$ 为 $1$ 为止，答案是 $389$，可以验证 $389$ 是满足 $p=F(n,b)$ 最小的 $n$。\n\n但是对于一些进制 $b$，是不能用贪心做的，比如 $b = 9, p = 216$。使用贪心得到的解是 $3338$，而最优解是 $666$。(均为 $9$ 进制下的。)\n\n本题便是在给定进制 $b$ 的情况下，举出一个这样的反例，或指出这样的反例不存在。\n\n由于计算资源所限，反例中所有数字的乘积不能超过 $10^{18}$​​。如果最小的反例中所有数字的乘积超过了 $10^{18}$​​，那么也应该输出 $-1$。", "inputFormat": "从标准输入读入数据。\n\n第一行一个整数 $t$，表示一共有 $t$ 组数据。\n\n接下来每行一个整数 $b$，表示进制。", "outputFormat": "输出到标准输出。\n\n如果不存在反例，输出一行一个整数 $-1$。\n\n如果存在反例，首先输出一个整数 $k$，表示反例 $n$ 的位数，接下来在同一行输出 $k$ 个十进制整数，表示任意一个反例的最优解。", "hint": "对于第 $1$ 个测试点，分值为 $30$，$1 \\leq n \\leq 32$；\n\n对于第 $2$ 个测试点，分值为 $40$，$1 \\leq n \\leq 100$；\n\n对于第 $3$ 个测试点，分值为 $30$，$1 \\leq t \\leq 200, 1 \\leq n \\leq 100000$。", "locale": "zh-CN"}}}
{"pid": "P4227", "type": "P", "difficulty": 7, "samples": [["2\n5 3\n0 0\n2 0\n2 2\n0 2\n1 1\n1 3 10 3 10\n1 3 10 3 20\n1 3 10 3 30\n3 1\n0 0\n100 0\n1000 0\n1 3 10 3 1000000000", "6\n11\n16\n1000001"]], "limits": {"time": [6000, 6000, 6000, 6000, 6000, 6000, 10000, 10000, 10000, 10000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["2017", "O2优化", "枚举", "排序", "CTT（清华集训/北大集训）"], "title": "[清华集训 2017] 我的生命已如风中残烛", "background": "", "description": "九条可怜是一个贪玩的女孩子。\n\n这天她在一堵墙钉了 $n$ 个钉子，第 $i$ 个钉子的坐标是 ($x_i,y_i$)。接着她又在墙上钉上了 $m$ 根绳子，绳子的一端是点 $s_i$($sx_i,sy_i$)，绳子经过点 $t_i$($tx_i,ty_i$)，同时绳子的长度是 $L_i$​​。其中 $s_i$​ 点是粘在墙上的，而另一个端点是可以移动的。初始情况下绳子是紧绷的一条直线段。\n\n接着，对每一根绳子可怜都进行了一次游戏。在第 $i$ 次游戏中，可怜会捏着第 $i$ 根绳子的活动端点进行顺时针移动，移动过程中每时每刻绳子都是紧绷的。\n\n不难发现绳子每时每刻都在以某一个位置为圆心作顺时针的圆周运动。初始情况下圆心是绳子的固定端点 $s$，但是在运动的过程中圆心可能会不断发生变化，如下图所示：\n\n![0](https://i.loli.net/2017/12/14/5a32671628367.png)\n\n图中左侧红点为钉子所在的点，右侧红点为绳子的固定端点，其他颜色的点为虚拟点，活动端点为紫点；绳子从紫点开始运动，在运行到蓝点时绳子绕上左侧红点的钉子，因此活动端点更换了圆心和半径，继续作顺时针的圆周运动。接着活动端点会运行到绿点，并且接下来活动端点会一直绕左侧钉子不停地做圆周运动。\n\n不难发现绳子的运动是不会停止的，因此可怜在她感觉累了之后就会停下来。但是作为一个好奇心满满的女孩子，可怜决定对每一根绳子计算一下如果绳子无限的运行下去，那么它的圆心会切换多少次（包括初始的圆心）。不难发现这个数值一定是有限的。\n\n这里对游戏过程进行一定程度的假设来简化问题：\n\n1.活动端点在运动的过程中距离每一个钉子的欧几里得距离始终大于等于 $9 \\times 10^{-4}$。\n2.钉子的坐标两两不同但可能有**多点共线**。\n3.钉子的体积以及绳子的体积可以忽略不计。在游戏的过程中每一段绳子之间不会互相影响。\n4.初始情况下绳子距离每一个钉子的最近欧几里得距离大于等于 $9 \\times 10^{-4}$。\n5.每一根绳子初始粘着的端点**不会**影响绳子的运动，即**绳子不会绕回端点上**。\n", "inputFormat": "从标准输入读入数据。\n\n第一行输入一个整数 $T$，表示数据组数。\n\n每组数据第一行为两个整数 $n,m$，表示钉子数和绳子数。\n\n接下来 $n$ 行，每行两个整数 $x_i,y_i$​​ 表示钉子的坐标。\n\n接下来 $m$ 行，每行五个整数 $sx_i,sy_i,tx_i,ty_i,L_i$ 表示一段绳子，含义如上所述。\n", "outputFormat": "输出到标准输出。\n\n对于每组数据的每组询问，输出一行一个整数表示运行的过程中圆心变化了多少次。\n\n不同数据组数之间**无需**空行隔开。\n", "hint": "对于前 $10\\%$ 的数据，$n \\leq 2$。\n\n对于前 $20\\%$ 的数据，$n \\leq 3$。\n\n对于前 $30\\%$ 的数据，$n \\leq 10$。\n\n对于前 $60\\%$ 的数据，$n \\leq 100,m \\leq 100$。\n\n对于 $100\\%$ 的数据，$1 \\leq n \\leq 500$，$1 \\leq m \\leq 500$，$1\\leq T \\leq 10$。\n\n对于 $100\\%$ 的数据，$0 \\leq |x_i|,|y_i|,|sx_i|,|sy_i|,|tx_i|,|ty_i| \\leq 10^4$。", "locale": "zh-CN", "translations": {"en": {"title": "[Tsinghua Training 2017] My Life Is Like a Candle in the Wind", "background": "", "description": "Jiutiao Kelian is a playful girl.\n\nOne day she nails $n$ nails into a wall. The $i$-th nail is at $(x_i, y_i)$. Then she nails $m$ ropes onto the wall. One endpoint of the $i$-th rope is the point $s_i (sx_i, sy_i)$, the rope passes through the point $t_i (tx_i, ty_i)$, and the rope length is $L_i$. The point $s_i$ is stuck to the wall, while the other endpoint is movable. Initially, the rope is a taut straight-line segment.\n\nNext, for each rope, Kelian plays a game once. In the $i$-th game, Kelian pinches the moving endpoint of the $i$-th rope and moves it clockwise, keeping the rope taut at every moment.\n\nIt is not hard to see that, at every moment, the rope performs a clockwise circular motion around some center. Initially the center is the fixed endpoint $s$, but during the motion the center may keep changing, as shown below:\n\n![0](https://i.loli.net/2017/12/14/5a32671628367.png)\n\nIn the figure, the red dot on the left is a nail, the red dot on the right is the rope’s fixed endpoint, the other colored dots are virtual points, and the moving endpoint is the purple dot. The rope starts from the purple dot; when it reaches the blue dot, the rope wraps around the left red nail, so the moving endpoint switches its center and radius and continues a clockwise circular motion. Then the moving endpoint reaches the green dot, and thereafter it keeps circling around the left nail indefinitely.\n\nIt is easy to see the rope’s motion never stops, so Kelian stops whenever she feels tired. However, being very curious, she decides to compute, for each rope, if it runs indefinitely, how many times its center will switch (including the initial center). This number is guaranteed to be finite.\n\nTo simplify the problem, we make the following assumptions about the game:\n\n1. During the motion, the Euclidean distance from the moving endpoint to every nail is always greater than or equal to $9 \\times 10^{-4}$.\n2. Nail coordinates are pairwise distinct, but there may be multiple collinear points.\n3. The volumes of the nails and the rope are negligible. During the game, different segments of the rope do not interfere with each other.\n4. Initially, the minimum Euclidean distance from the rope to every nail is greater than or equal to $9 \\times 10^{-4}$.\n5. The initially attached endpoint does not affect the rope’s motion, i.e., the rope will not wrap back onto its fixed endpoint.", "inputFormat": "Read from standard input.\n\nThe first line contains an integer $T$, the number of test cases.\n\nFor each test case, the first line contains two integers $n, m$, the number of nails and the number of ropes.\n\nThe next $n$ lines each contain two integers $x_i, y_i$ giving the coordinates of the nails.\n\nThe next $m$ lines each contain five integers $sx_i, sy_i, tx_i, ty_i, L_i$ describing a rope, as stated above.", "outputFormat": "Output to standard output.\n\nFor each rope in each test case, output a single line with one integer: the number of times the center changes during the motion.\n\nDo not print extra blank lines between test cases.", "hint": "For the first $10\\%$ of the testdata, $n \\leq 2$.\n\nFor the first $20\\%$ of the testdata, $n \\leq 3$.\n\nFor the first $30\\%$ of the testdata, $n \\leq 10$.\n\nFor the first $60\\%$ of the testdata, $n \\leq 100, m \\leq 100$.\n\nFor $100\\%$ of the testdata, $1 \\leq n \\leq 500$, $1 \\leq m \\leq 500$, $1 \\leq T \\leq 10$.\n\nFor $100\\%$ of the testdata, $0 \\leq |x_i|, |y_i|, |sx_i|, |sy_i|, |tx_i|, |ty_i| \\leq 10^4$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[清华集训 2017] 我的生命已如风中残烛", "background": "", "description": "九条可怜是一个贪玩的女孩子。\n\n这天她在一堵墙钉了 $n$ 个钉子，第 $i$ 个钉子的坐标是 ($x_i,y_i$)。接着她又在墙上钉上了 $m$ 根绳子，绳子的一端是点 $s_i$($sx_i,sy_i$)，绳子经过点 $t_i$($tx_i,ty_i$)，同时绳子的长度是 $L_i$​​。其中 $s_i$​ 点是粘在墙上的，而另一个端点是可以移动的。初始情况下绳子是紧绷的一条直线段。\n\n接着，对每一根绳子可怜都进行了一次游戏。在第 $i$ 次游戏中，可怜会捏着第 $i$ 根绳子的活动端点进行顺时针移动，移动过程中每时每刻绳子都是紧绷的。\n\n不难发现绳子每时每刻都在以某一个位置为圆心作顺时针的圆周运动。初始情况下圆心是绳子的固定端点 $s$，但是在运动的过程中圆心可能会不断发生变化，如下图所示：\n\n![0](https://i.loli.net/2017/12/14/5a32671628367.png)\n\n图中左侧红点为钉子所在的点，右侧红点为绳子的固定端点，其他颜色的点为虚拟点，活动端点为紫点；绳子从紫点开始运动，在运行到蓝点时绳子绕上左侧红点的钉子，因此活动端点更换了圆心和半径，继续作顺时针的圆周运动。接着活动端点会运行到绿点，并且接下来活动端点会一直绕左侧钉子不停地做圆周运动。\n\n不难发现绳子的运动是不会停止的，因此可怜在她感觉累了之后就会停下来。但是作为一个好奇心满满的女孩子，可怜决定对每一根绳子计算一下如果绳子无限的运行下去，那么它的圆心会切换多少次（包括初始的圆心）。不难发现这个数值一定是有限的。\n\n这里对游戏过程进行一定程度的假设来简化问题：\n\n1.活动端点在运动的过程中距离每一个钉子的欧几里得距离始终大于等于 $9 \\times 10^{-4}$。\n2.钉子的坐标两两不同但可能有**多点共线**。\n3.钉子的体积以及绳子的体积可以忽略不计。在游戏的过程中每一段绳子之间不会互相影响。\n4.初始情况下绳子距离每一个钉子的最近欧几里得距离大于等于 $9 \\times 10^{-4}$。\n5.每一根绳子初始粘着的端点**不会**影响绳子的运动，即**绳子不会绕回端点上**。\n", "inputFormat": "从标准输入读入数据。\n\n第一行输入一个整数 $T$，表示数据组数。\n\n每组数据第一行为两个整数 $n,m$，表示钉子数和绳子数。\n\n接下来 $n$ 行，每行两个整数 $x_i,y_i$​​ 表示钉子的坐标。\n\n接下来 $m$ 行，每行五个整数 $sx_i,sy_i,tx_i,ty_i,L_i$ 表示一段绳子，含义如上所述。\n", "outputFormat": "输出到标准输出。\n\n对于每组数据的每组询问，输出一行一个整数表示运行的过程中圆心变化了多少次。\n\n不同数据组数之间**无需**空行隔开。\n", "hint": "对于前 $10\\%$ 的数据，$n \\leq 2$。\n\n对于前 $20\\%$ 的数据，$n \\leq 3$。\n\n对于前 $30\\%$ 的数据，$n \\leq 10$。\n\n对于前 $60\\%$ 的数据，$n \\leq 100,m \\leq 100$。\n\n对于 $100\\%$ 的数据，$1 \\leq n \\leq 500$，$1 \\leq m \\leq 500$，$1\\leq T \\leq 10$。\n\n对于 $100\\%$ 的数据，$0 \\leq |x_i|,|y_i|,|sx_i|,|sy_i|,|tx_i|,|ty_i| \\leq 10^4$。", "locale": "zh-CN"}}}
{"pid": "P4228", "type": "P", "difficulty": 7, "samples": [["0 3\n4\n1 2\n1 3\n1 4\n6\n1 2\n1 3\n1 4\n4 5\n5 6\n10\n1 2\n1 3\n3 4\n3 5\n3 6\n4 7\n7 8\n8 9\n9 10", "0111\n000101\n0000001010"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000], "memory": [512000, 512000, 512000, 512000, 512000]}, "tags": ["2017", "O2优化", "CTT（清华集训/北大集训）"], "title": "[清华集训 2017] 榕树之心", "background": "深秋。冷风吹散了最后一丝夏日的暑气，也吹落了榕树脚下灌木丛的叶子。相识数年的Evan和Lyra再次回到了小时候见面的茂盛榕树之下。小溪依旧，石桥依旧，榕树虽是历经荣枯更迭，依旧亭亭如盖，只是Evan和Lyra再也不是七八年前不经世事的少年了。\n\n……\n\n“已经快是严冬了，榕树的叶子还没落呢……”\n\n“榕树是常绿树，是看不到明显的落叶季节的……”\n\n“唉……想不到已经七年了呢。榕树还是当年的榕树，你却不是当年的你了……”\n\n“其实又有什么是一成不变的呢，榕树常绿，翠绿树冠的宏观永恒，是由无数细小树叶的荣枯更迭组成的。在时间的流逝中一切都在不断变化着呢……”\n\n“但你看这榕树，日日如此，季季如此，年年如此，仿佛亘古不变般，盘根错节，郁郁葱葱。我在想，或许成为一棵树更好吧，任时间从枝叶间流过，我只守这一片绿荫就好。”\n\n“榕树固然长久，但在这无限的时光里，终归是要湮灭于尘土的。与其像榕树一般，植根于一方泥土中感受年复一年的四季更替。倒不如在有限的时间里看过尽可能多的世界吧。再说了，榕树虽生长缓慢，却依旧会在每年春天抽出一根新的枝条去向外探索的呢……”\n\n“真的吗，榕树在她漫长的一生里，就是这样往外一步步探索的吗？”\n\n“毕竟就算树冠看起来一成不变，榕树也会随着时间周期变化，春天到了自然就是生长的时候了，她也应当做出对应的表现吧……”\n\n“相比于对季节更替做出本能的生长，我倒宁愿相信，榕树有一颗活跃的的，探索的心。”\n\n“其实榕树是有心的，榕树刚刚种下的时候，心就在根的地方发芽了。以后每年春天榕树长出新枝条的时候，心就会向着新枝条的方向移动一点，这样就能更靠近外面的世界了。你看这头顶上的枝条，纵横交错，其实心已经在这枝杈间，移动了数十载了呢……”\n\n“哇，也就是说，这密密麻麻的树杈中的某个地方，藏着这棵榕树的心吗？”\n\n“没错，可是要知道它在哪，就得另花一番功夫了……”\n\n“呀，这时候想想，一株树还是不如一个人好……比如你，要是这样贴上去的话，就能听到跳动的声音呢……”\n\n……\n", "description": "一棵榕树可以抽象成一棵$n$个结点的有根树，其中结点编号为$1 \\sim n$，而$1$号点就是根节点。初始时，树只有一号点，而心也在一号点。之后每一步，树都会长出一个新结点，即某个和当前已经存在的某个结点相邻的结点被加入了树中，之后，心会沿着心到新加结点的简单路径移动一步。这棵$n$个结点的树有很多种生长的顺序，不同的顺序可能会导致最终心的位置不同。现在，Evan和Lyra想知道，哪些结点可能是心在生长过程结束时停留的位置呢？\n\n例如一棵大小为$4$的树，连边为$\\{<1,2>,<1,3>,<1,4>\\}$，我们有三种不同的生长顺序可以让心分别停留在$2,3,4$号节点上：\n\n最终停留在$2$号点：\n\n    从1生长出3，心从1移动到3,\n    从1生长出4，心从3移动回1,\n    从1生长出2，心从1移动到2.\n\n最终停留在$3$号点：\n\n    从1生长出2，心从1移动到2,\n    从1生长出4，心从2移动回1,\n    从1生长出3，心从1移动到3.\n\n最终停留在$4$号点：\n\n    从1生长出2，心从1移动到2,\n    从1生长出3，心从2移动回1,\n    从1生长出4，心从1移动到4.\n\n而我们可以证明，不存在任何一种可能的生长顺序使得心停留在$1$号点。", "inputFormat": "从标准输入读入数据。\n\n输入第一行一个两个正整数$W,T$，分别表示子任务编号（在样例中$W=0$）和数据组数，接下来是$T$组数据的描述，对于每组数据：\n\n第一行一个正整数$n$表示树上结点的个数。\n\n接下来$n-1$行，每行两个正整数$a_i,b_i$​​，表示编号$a_i,b_i$​​的结点间有一条树边，保证$a_i \\neq b_i$并且输入的$n-1$条边恰好构成了一棵树。\n", "outputFormat": "输出到标准输出。\n\n若输入的$W$不等于$3$，对于每组数据输出一行一个长度为$n$的$01$字符串，表示编号为$1 \\sim n$的结点是否有可能是心最后所在的位置，若$01$字符串对应位是$1$则表示可能，为$0$则表示不可能。\n\n若输入的$W$等于$3$，则对每组数据输出一个字符表示$1$号点的答案。\n", "hint": "**TestPoint 1[10pts]**\n\n$T \\leq 50; n \\leq 15$。\n\n**TestPoint 2[10pts]**\n\n$T \\leq 20; n \\leq 10^5$。除了$1$号点之外，每个点度数（包括父亲）不超过$2$。\n\n**TestPoint 3[10pts]**\n\n$T \\leq 200; n \\leq 100$。只输出一个字符表示$1$号点答案，即保证$1$号点答案正确即可。\n\n**TestPoint 4[35pts]**\n\n$T \\leq 20; n \\leq 10^3$。\n\n**TestPoint 5[35pts]**\n\n$T \\leq 20; n \\leq 10^5$。", "locale": "zh-CN", "translations": {"en": {"title": "[Tsinghua Training 2017] Heart of the Banyan Tree", "background": "Late autumn. The cold wind has blown away the last trace of summer heat and the leaves of the bushes under the banyan tree. Evan and Lyra, who have known each other for years, have returned once again to the lush banyan tree where they met as children. The brook is the same, the stone bridge is the same; though the banyan tree has experienced cycles of thriving and withering, it still stands tall like a green canopy. Only Evan and Lyra are no longer the inexperienced teenagers they were seven or eight years ago.\n\n...\n\n“It’s almost winter, yet the banyan still hasn’t shed its leaves...”\n\n“The banyan is an evergreen; you won’t see a distinct season of leaf fall...”\n\n“Sigh... I didn’t expect it’s already been seven years. The banyan is the same as it was back then, but you are no longer who you were...”\n\n“Is there really anything that never changes? The banyan is evergreen, and its seemingly everlasting green canopy is made up of countless leaves cycling through life and death. In the passage of time, everything is constantly changing...”\n\n“But look at this banyan—day after day, season after season, year after year—it seems unchanged since ancient times, with gnarled roots and lush foliage. I’m thinking, perhaps it would be better to be a tree, letting time flow between my branches and leaves, while I simply keep this patch of shade.”\n\n“The banyan may endure, but in this infinite span of time, it will eventually return to dust. Rather than rooting in one place and experiencing the same seasonal cycle year after year like a banyan, why not see as much of the world as possible in limited time? Besides, although the banyan grows slowly, it still sends out a new branch each spring to explore outward...”\n\n“Really? Over its long life, the banyan explores step by step like that?”\n\n“Even if the canopy appears unchanged, the banyan follows periodic changes over time. When spring comes, it naturally grows; it should show that, shouldn’t it...”\n\n“Compared to instinctive growth in response to the seasons, I’d rather believe the banyan has a lively, exploring heart.”\n\n“In fact, the banyan does have a heart. When it’s first planted, the heart sprouts at the root. Later, each spring when the banyan grows a new branch, its heart moves a little toward the direction of that new branch, getting closer to the outside world. Look at the branches above your head—crisscrossing in all directions—the heart has been moving among these boughs for decades...”\n\n“Wow, so somewhere among this dense network of branches, the banyan’s heart is hidden?”\n\n“Exactly. But to know where it is, you’ll need to put in some extra effort...”\n\n“Ah, thinking about it, a tree still isn’t as good as a person... For example, you—if you lean in like this, you can hear the heartbeat...”\n\n...", "description": "A banyan can be abstracted as a rooted tree with $n$ nodes, numbered $1 \\sim n$, where node $1$ is the root. Initially, the tree has only node $1$, and the heart is at node $1$. After that, at each step, the tree grows a new node: specifically, a node adjacent to some currently existing node is added to the tree. Then, the heart moves one step along the simple path from the heart to the newly added node. This tree with $n$ nodes has many possible growth orders, and different orders may lead to different final positions of the heart. Now Evan and Lyra want to know: which nodes could possibly be the final resting position of the heart when the growth process ends?\n\nFor example, consider a tree of size $4$ with edges $\\{<1,2>,<1,3>,<1,4>\\}$. There are three different growth orders that make the heart end at nodes $2$, $3$, and $4$, respectively:\n\nFinally ending at node $2$:\n- Grow $3$ from $1$, the heart moves from $1$ to $3$,\n- Grow $4$ from $1$, the heart moves from $3$ back to $1$,\n- Grow $2$ from $1$, the heart moves from $1$ to $2$.\n\nFinally ending at node $3$:\n- Grow $2$ from $1$, the heart moves from $1$ to $2$,\n- Grow $4$ from $1$, the heart moves from $2$ back to $1$,\n- Grow $3$ from $1$, the heart moves from $1$ to $3$.\n\nFinally ending at node $4$:\n- Grow $2$ from $1$, the heart moves from $1$ to $2$,\n- Grow $3$ from $1$, the heart moves from $2$ back to $1$,\n- Grow $4$ from $1$, the heart moves from $1$ to $4$.\n\nWe can prove that there is no growth order that makes the heart end at node $1$.", "inputFormat": "Read from standard input.\n\nThe first line contains two positive integers $W, T$, representing the subtask identifier (in the samples $W = 0$) and the number of test cases. Then follow $T$ test cases. For each test case:\n\n- The first line contains a positive integer $n$, the number of nodes in the tree.\n- The next $n - 1$ lines each contain two positive integers $a_i, b_i$, indicating there is a tree edge between nodes numbered $a_i$ and $b_i$. It is guaranteed that $a_i \\neq b_i$ and the $n - 1$ edges form a tree.", "outputFormat": "Output to standard output.\n\nIf the input $W$ is not equal to $3$, for each test case output a line containing a length-$n$ $01$ string. The $i$-th character indicates whether node $i$ could be the final position of the heart. A $1$ means possible, and a $0$ means impossible.\n\nIf the input $W$ equals $3$, then for each test case output a single character indicating the answer for node $1$.", "hint": "TestPoint 1 [10 pts]\n- $T \\leq 50; n \\leq 15$.\n\nTestPoint 2 [10 pts]\n- $T \\leq 20; n \\leq 10^5$. For every node except node $1$, the degree (including its parent) is at most $2$.\n\nTestPoint 3 [10 pts]\n- $T \\leq 200; n \\leq 100$. Only output a single character indicating the answer for node $1$, i.e., it suffices to ensure the correctness for node $1$.\n\nTestPoint 4 [35 pts]\n- $T \\leq 20; n \\leq 10^3$.\n\nTestPoint 5 [35 pts]\n- $T \\leq 20; n \\leq 10^5$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[清华集训 2017] 榕树之心", "background": "深秋。冷风吹散了最后一丝夏日的暑气，也吹落了榕树脚下灌木丛的叶子。相识数年的Evan和Lyra再次回到了小时候见面的茂盛榕树之下。小溪依旧，石桥依旧，榕树虽是历经荣枯更迭，依旧亭亭如盖，只是Evan和Lyra再也不是七八年前不经世事的少年了。\n\n……\n\n“已经快是严冬了，榕树的叶子还没落呢……”\n\n“榕树是常绿树，是看不到明显的落叶季节的……”\n\n“唉……想不到已经七年了呢。榕树还是当年的榕树，你却不是当年的你了……”\n\n“其实又有什么是一成不变的呢，榕树常绿，翠绿树冠的宏观永恒，是由无数细小树叶的荣枯更迭组成的。在时间的流逝中一切都在不断变化着呢……”\n\n“但你看这榕树，日日如此，季季如此，年年如此，仿佛亘古不变般，盘根错节，郁郁葱葱。我在想，或许成为一棵树更好吧，任时间从枝叶间流过，我只守这一片绿荫就好。”\n\n“榕树固然长久，但在这无限的时光里，终归是要湮灭于尘土的。与其像榕树一般，植根于一方泥土中感受年复一年的四季更替。倒不如在有限的时间里看过尽可能多的世界吧。再说了，榕树虽生长缓慢，却依旧会在每年春天抽出一根新的枝条去向外探索的呢……”\n\n“真的吗，榕树在她漫长的一生里，就是这样往外一步步探索的吗？”\n\n“毕竟就算树冠看起来一成不变，榕树也会随着时间周期变化，春天到了自然就是生长的时候了，她也应当做出对应的表现吧……”\n\n“相比于对季节更替做出本能的生长，我倒宁愿相信，榕树有一颗活跃的的，探索的心。”\n\n“其实榕树是有心的，榕树刚刚种下的时候，心就在根的地方发芽了。以后每年春天榕树长出新枝条的时候，心就会向着新枝条的方向移动一点，这样就能更靠近外面的世界了。你看这头顶上的枝条，纵横交错，其实心已经在这枝杈间，移动了数十载了呢……”\n\n“哇，也就是说，这密密麻麻的树杈中的某个地方，藏着这棵榕树的心吗？”\n\n“没错，可是要知道它在哪，就得另花一番功夫了……”\n\n“呀，这时候想想，一株树还是不如一个人好……比如你，要是这样贴上去的话，就能听到跳动的声音呢……”\n\n……\n", "description": "一棵榕树可以抽象成一棵$n$个结点的有根树，其中结点编号为$1 \\sim n$，而$1$号点就是根节点。初始时，树只有一号点，而心也在一号点。之后每一步，树都会长出一个新结点，即某个和当前已经存在的某个结点相邻的结点被加入了树中，之后，心会沿着心到新加结点的简单路径移动一步。这棵$n$个结点的树有很多种生长的顺序，不同的顺序可能会导致最终心的位置不同。现在，Evan和Lyra想知道，哪些结点可能是心在生长过程结束时停留的位置呢？\n\n例如一棵大小为$4$的树，连边为$\\{<1,2>,<1,3>,<1,4>\\}$，我们有三种不同的生长顺序可以让心分别停留在$2,3,4$号节点上：\n\n最终停留在$2$号点：\n\n    从1生长出3，心从1移动到3,\n    从1生长出4，心从3移动回1,\n    从1生长出2，心从1移动到2.\n\n最终停留在$3$号点：\n\n    从1生长出2，心从1移动到2,\n    从1生长出4，心从2移动回1,\n    从1生长出3，心从1移动到3.\n\n最终停留在$4$号点：\n\n    从1生长出2，心从1移动到2,\n    从1生长出3，心从2移动回1,\n    从1生长出4，心从1移动到4.\n\n而我们可以证明，不存在任何一种可能的生长顺序使得心停留在$1$号点。", "inputFormat": "从标准输入读入数据。\n\n输入第一行一个两个正整数$W,T$，分别表示子任务编号（在样例中$W=0$）和数据组数，接下来是$T$组数据的描述，对于每组数据：\n\n第一行一个正整数$n$表示树上结点的个数。\n\n接下来$n-1$行，每行两个正整数$a_i,b_i$​​，表示编号$a_i,b_i$​​的结点间有一条树边，保证$a_i \\neq b_i$并且输入的$n-1$条边恰好构成了一棵树。\n", "outputFormat": "输出到标准输出。\n\n若输入的$W$不等于$3$，对于每组数据输出一行一个长度为$n$的$01$字符串，表示编号为$1 \\sim n$的结点是否有可能是心最后所在的位置，若$01$字符串对应位是$1$则表示可能，为$0$则表示不可能。\n\n若输入的$W$等于$3$，则对每组数据输出一个字符表示$1$号点的答案。\n", "hint": "**TestPoint 1[10pts]**\n\n$T \\leq 50; n \\leq 15$。\n\n**TestPoint 2[10pts]**\n\n$T \\leq 20; n \\leq 10^5$。除了$1$号点之外，每个点度数（包括父亲）不超过$2$。\n\n**TestPoint 3[10pts]**\n\n$T \\leq 200; n \\leq 100$。只输出一个字符表示$1$号点答案，即保证$1$号点答案正确即可。\n\n**TestPoint 4[35pts]**\n\n$T \\leq 20; n \\leq 10^3$。\n\n**TestPoint 5[35pts]**\n\n$T \\leq 20; n \\leq 10^5$。", "locale": "zh-CN"}}}
{"pid": "P4229", "type": "P", "difficulty": 6, "samples": [["1\n3 2 3\n1 2 3\n2 3 2", "3"], ["2\n4 2 4\n1 2 3\n2 3 4\n7 3 74\n3 6 56\n2 5 56\n3 7 70", "20\n160326468"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["2017", "O2优化", "CTT（清华集训/北大集训）"], "title": "[清华集训 2017] 某位歌姬的故事", "background": null, "description": "IA 是一名会唱歌的女孩子。\n\nIOI2018 就要来了，IA 决定给参赛选手们写一首歌，以表达美好的祝愿。这首歌一共有 $n$ 个音符，第 $i$ 个音符的音高为 $h_i$​​。IA 的音域是 $A$，她只能唱出 $1\\sim A$ 中的正整数音高。因此 $1\\le h_i\\le A$。\n\n在写歌之前，IA 需要确定下这首歌的结构，于是她写下了 $Q$ 条限制，其中第 $i$ 条为：编号在 $l_i$ 到 $r_i$ 之间的音符的最高音高为 $m_i$。在确定了结构之后，她就可以开始写歌了。不过她还是想知道，一共有多少种可能的歌曲满足她的所有限制？她听说你还有 9 个月就要去 IOI 了，于是希望你帮她计算一下这个值。", "inputFormat": "从标准输入读入数据。\n\n输入的第一行包含一个整数 $T$($T\\le 20$)，代表测试数据的组数。\n\n每组数据的第一行包含三个正整数 $n,Q,A$。接下来 $Q$ 行，每行三个整数 $l_i,r_i,m_i$​​，表示一条限制。保证 $1\\le l_i\\le r_i\\le n, 1\\le m_i\\le A$。", "outputFormat": "输出到标准输出。\n\n输出文件只有一行，表示可能的歌曲数目。这个数可能很大，请将答案模 $998244353$ 输出。", "hint": "**样例1解释**\n以下是三种可能的歌曲：$(3,1,2),(3,2,1),(3,2,2)$。\n\n![0](https://cdn.luogu.com.cn/upload/pic/14340.png)", "locale": "zh-CN", "translations": {"en": {"title": "[Tsinghua Training 2017] A Certain Songstress's Story", "background": "", "description": "IA is a girl who can sing.\n\nIOI 2018 is coming, and IA decides to write a song for the contestants to express her best wishes. The song has $n$ notes, and the pitch of the $i$-th note is $h_i$. IA's vocal range is $A$, and she can only sing positive integer pitches in $1\\sim A$. Therefore $1\\le h_i\\le A$.\n\nBefore composing, IA needs to decide the structure of the song, so she wrote down $Q$ constraints, where the $i$-th constraint is: among the notes indexed from $l_i$ to $r_i$, the maximum pitch is $m_i$. After the structure is fixed, she can start composing. However, she still wants to know how many possible songs satisfy all her constraints. She heard you will go to IOI in 9 months, so she hopes you can help her compute this value.", "inputFormat": "Read from standard input.\n\nThe first line contains an integer $T$ ($T\\le 20$), the number of testdata groups.\n\nFor each group, the first line contains three positive integers $n, Q, A$. Then follow $Q$ lines, each with three integers $l_i, r_i, m_i$, representing one constraint. It is guaranteed that $1\\le l_i\\le r_i\\le n, 1\\le m_i\\le A$.", "outputFormat": "Write to standard output.\n\nOutput a single line indicating the number of possible songs. Since this number can be large, output the answer modulo $998244353$.", "hint": "Explanation for Sample 1.\nThe following are the three possible songs: $(3, 1, 2)$, $(3, 2, 1)$, $(3, 2, 2)$.\n\n![0](https://cdn.luogu.com.cn/upload/pic/14340.png)\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[清华集训 2017] 某位歌姬的故事", "background": null, "description": "IA 是一名会唱歌的女孩子。\n\nIOI2018 就要来了，IA 决定给参赛选手们写一首歌，以表达美好的祝愿。这首歌一共有 $n$ 个音符，第 $i$ 个音符的音高为 $h_i$​​。IA 的音域是 $A$，她只能唱出 $1\\sim A$ 中的正整数音高。因此 $1\\le h_i\\le A$。\n\n在写歌之前，IA 需要确定下这首歌的结构，于是她写下了 $Q$ 条限制，其中第 $i$ 条为：编号在 $l_i$ 到 $r_i$ 之间的音符的最高音高为 $m_i$。在确定了结构之后，她就可以开始写歌了。不过她还是想知道，一共有多少种可能的歌曲满足她的所有限制？她听说你还有 9 个月就要去 IOI 了，于是希望你帮她计算一下这个值。", "inputFormat": "从标准输入读入数据。\n\n输入的第一行包含一个整数 $T$($T\\le 20$)，代表测试数据的组数。\n\n每组数据的第一行包含三个正整数 $n,Q,A$。接下来 $Q$ 行，每行三个整数 $l_i,r_i,m_i$​​，表示一条限制。保证 $1\\le l_i\\le r_i\\le n, 1\\le m_i\\le A$。", "outputFormat": "输出到标准输出。\n\n输出文件只有一行，表示可能的歌曲数目。这个数可能很大，请将答案模 $998244353$ 输出。", "hint": "**样例1解释**\n以下是三种可能的歌曲：$(3,1,2),(3,2,1),(3,2,2)$。\n\n![0](https://cdn.luogu.com.cn/upload/pic/14340.png)", "locale": "zh-CN"}}}
{"pid": "P4230", "type": "P", "difficulty": 6, "samples": [["5\n1 2\n2 3\n3 4\n1 4\n4 2\n", "2 3 3 3 2"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["深度优先搜索 DFS", "动态树 LCT", "期望", "差分"], "title": "连环病原体", "background": "###（一）洞穴\n\n顺着狭窄倾斜的溶洞向下走，这里，真有一番地心探险的感觉呢。\n\n告诉你啊，地底有一片广阔的大世界，叫做旧地狱。\n\n那里居住着被地面上的人厌恶的妖怪们。\n\n虽然听着比较吓人，但实际上在地狱废弃后，一切都是井井有条的。\n\n前方有一片开阔的空间啊，好像有人。\n\n\"地面上的来客吗,你好啊\"\n\n终于遇到地底的居民了。\n\n眼前的两只妖怪是黑谷山女和琪斯美。\n\n琪斯美呆在一个小桶里，悬挂在空中，和山女讨论着什么。\n\n\"哇，你们在讨论什么啊\"\n\n\"嗯，有关病毒的问题，你们不懂的\"\n\n忘记说了，山女可以操纵疾病，所以谈论这样的话题自然也就很平常了。\n\n不过好奇心很难抵挡啊，那就假装自己能帮上忙，然后接着问下去吧。\n\n\"好吧，你们要是能帮上忙的话就再好不过了\"\n\n\"嗯，主要是，想知道病原体之间的相互作用，会对疾病产生什么影响呢。你看啊，把不同种的病原体看做点，相互作用看成连接这些点的线，如果产生了环，那么病毒的威力就会大幅加强，我把它叫做加强环。\"\n\n\"病原体之间的相互作用也有很多种呢，我想研究的是，每种相互作用在产生加强环的过程中有多么重要。\"\n\n啊，听起来好复杂，不过如果帮了她的忙，地底的妖怪们大概会对我们友善一些吧。\n\n而且，点，边，环？这些名词似乎见过呢，说不定我真的能帮上忙？\n\n那么，继续详细地询问吧。\n\n嗯，问出来的信息已经记录在这张纸上了。\n", "description": "问题摘要:\n\n有n 种病原体，它们之间会产生$m$种无方向性的影响，第$i$种影响发生在$u_i$,$v_i$ **两种**病原体之间。\n\n我们把所有的**影响**按编号顺序排成一个序列，如果某一个区间包含有环，那么这个区间被称作加强区间。\n\n求每种影响分别在多少个加强区间中出现过。\n\n那么，到底怎样做才能高效的得出结果呢？\n\n(后续剧情见本题题解，接下来请看T2)", "inputFormat": "第一行一个数$m$\n接下来$m$行每行两个数$u_i$,$v_i$，用空格分隔", "outputFormat": "一行$m$个数字，第$i$个数字代表第$i$种影响在多少个加强区间内出现过，数字之间用空格分隔", "hint": "###样例解释：\n\n第一种影响在[1,4]和[1,5]两个加强区间内出现\n\n第二种影响在[1,4]、[1,5]和[2,5]三个加强区间内出现\n\n第三种影响在[1,5]、[1,4]和[2,5]三个加强区间内出现\n\n第四种影响在[1,4]、[2,5]和[1,5]三个加强区间内出现\n\n第五种影响在[2,5]和[1,5]两个加强区间内出现\n\n注意：加强区间是由“影响”构成的，而不是由“病原体”构成的\n\n$n\\leqslant2m\\leqslant400000$\n\n测试点1~2总分10分，$m\\leqslant5$\n\n测试点3~6总分20分，$m\\leqslant200$\n\n测试点7~12总分30分，$m\\leqslant5000$\n\n测试点13~15总分15分，$m\\leqslant50000$\n\n测试点16~18总分15分，$m\\leqslant50000$，捆绑测试\n\n测试点19~22总分10分，$m\\leqslant200000$，捆绑测试\n\nby oscar", "locale": "zh-CN", "translations": {"en": {"title": "Cyclic Pathogens", "background": "### (I) Cave\n\nWalking down along a narrow, slanted karst cave, it really feels like a journey to the center of the earth.\n\nLet me tell you, there is a vast underground world called the Former Hell.\n\nIt is home to youkai shunned by people on the surface.\n\nAlthough it sounds scary, after Hell was abandoned, everything became orderly.\n\nThere is an open space ahead; it seems someone is there.\n\n\"A visitor from the surface? Hello.\"\n\nAt last, we met the residents of the underground.\n\nThe two youkai before us are Kurodani Yamame and Kisume.\n\nKisume stays in a small bucket, hanging in the air, discussing something with Yamame.\n\n\"Wow, what are you discussing?\"\n\n\"Mm, it's about viruses. You wouldn’t understand.\"\n\nI forgot to mention, Yamame can manipulate diseases, so discussing such topics is only natural.\n\nBut curiosity is hard to resist. Let's pretend we can help and keep asking.\n\n\"Well then, if you can help, that would be great.\"\n\n\"Mm, what I mainly want to know is how interactions among pathogens affect the disease. Look, if we treat different kinds of pathogens as points, and their interactions as lines connecting the points, then if a cycle is formed, the virus’s power is greatly enhanced. I call this a reinforcement cycle.\"\n\n\"There are many kinds of interactions among pathogens. I want to study how important each interaction is in forming reinforcement cycles.\"\n\nAh, it sounds complicated, but if we help her, the underground youkai might be friendlier to us.\n\nAlso, points, edges, cycles? These terms seem familiar. Maybe I really can help?\n\nLet’s keep asking for details.\n\nMm, the information we got has been written down on this sheet of paper.", "description": "Problem summary:\n\nThere are $n$ types of pathogens, and there are $m$ kinds of undirected influences among them. The $i$-th influence occurs between pathogens $u_i$ and $v_i$, specifically between **two** pathogens.\n\nWe arrange all the **influences** in order by their indices to form a sequence. If an interval contains a cycle, then that interval is called a reinforcement interval.\n\nFor each influence, count in how many reinforcement intervals it appears.\n\nSo, how can we compute the result efficiently?\n\n(For the subsequent story, see the editorial of this problem. Please proceed to T2.)", "inputFormat": "The first line contains a number $m$.\n\nThen $m$ lines follow; each line contains two numbers $u_i$, $v_i$, separated by a space.", "outputFormat": "Output one line with $m$ numbers. The $i$-th number denotes how many reinforcement intervals contain the $i$-th influence. Numbers are separated by spaces.", "hint": "### Sample explanation:\n\nThe first influence appears in two reinforcement intervals: [1,4] and [1,5].\n\nThe second influence appears in three reinforcement intervals: [1,4], [1,5], and [2,5].\n\nThe third influence appears in three reinforcement intervals: [1,5], [1,4], and [2,5].\n\nThe fourth influence appears in three reinforcement intervals: [1,4], [2,5], and [1,5].\n\nThe fifth influence appears in two reinforcement intervals: [2,5] and [1,5].\n\nNote: reinforcement intervals are formed by “influences” (edges), not by “pathogens” (vertices).\n\nConstraints\n\n$n\\leqslant2m\\leqslant400000$\n\nTest points 1–2, total 10 points, $m\\leqslant5$.\n\nTest points 3–6, total 20 points, $m\\leqslant200$.\n\nTest points 7–12, total 30 points, $m\\leqslant5000$.\n\nTest points 13–15, total 15 points, $m\\leqslant50000$.\n\nTest points 16–18, total 15 points, $m\\leqslant50000$, bundled test.\n\nTest points 19–22, total 10 points, $m\\leqslant200000$, bundled test.\n\nby oscar\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "连环病原体", "background": "###（一）洞穴\n\n顺着狭窄倾斜的溶洞向下走，这里，真有一番地心探险的感觉呢。\n\n告诉你啊，地底有一片广阔的大世界，叫做旧地狱。\n\n那里居住着被地面上的人厌恶的妖怪们。\n\n虽然听着比较吓人，但实际上在地狱废弃后，一切都是井井有条的。\n\n前方有一片开阔的空间啊，好像有人。\n\n\"地面上的来客吗,你好啊\"\n\n终于遇到地底的居民了。\n\n眼前的两只妖怪是黑谷山女和琪斯美。\n\n琪斯美呆在一个小桶里，悬挂在空中，和山女讨论着什么。\n\n\"哇，你们在讨论什么啊\"\n\n\"嗯，有关病毒的问题，你们不懂的\"\n\n忘记说了，山女可以操纵疾病，所以谈论这样的话题自然也就很平常了。\n\n不过好奇心很难抵挡啊，那就假装自己能帮上忙，然后接着问下去吧。\n\n\"好吧，你们要是能帮上忙的话就再好不过了\"\n\n\"嗯，主要是，想知道病原体之间的相互作用，会对疾病产生什么影响呢。你看啊，把不同种的病原体看做点，相互作用看成连接这些点的线，如果产生了环，那么病毒的威力就会大幅加强，我把它叫做加强环。\"\n\n\"病原体之间的相互作用也有很多种呢，我想研究的是，每种相互作用在产生加强环的过程中有多么重要。\"\n\n啊，听起来好复杂，不过如果帮了她的忙，地底的妖怪们大概会对我们友善一些吧。\n\n而且，点，边，环？这些名词似乎见过呢，说不定我真的能帮上忙？\n\n那么，继续详细地询问吧。\n\n嗯，问出来的信息已经记录在这张纸上了。\n", "description": "问题摘要:\n\n有n 种病原体，它们之间会产生$m$种无方向性的影响，第$i$种影响发生在$u_i$,$v_i$ **两种**病原体之间。\n\n我们把所有的**影响**按编号顺序排成一个序列，如果某一个区间包含有环，那么这个区间被称作加强区间。\n\n求每种影响分别在多少个加强区间中出现过。\n\n那么，到底怎样做才能高效的得出结果呢？\n\n(后续剧情见本题题解，接下来请看T2)", "inputFormat": "第一行一个数$m$\n接下来$m$行每行两个数$u_i$,$v_i$，用空格分隔", "outputFormat": "一行$m$个数字，第$i$个数字代表第$i$种影响在多少个加强区间内出现过，数字之间用空格分隔", "hint": "###样例解释：\n\n第一种影响在[1,4]和[1,5]两个加强区间内出现\n\n第二种影响在[1,4]、[1,5]和[2,5]三个加强区间内出现\n\n第三种影响在[1,5]、[1,4]和[2,5]三个加强区间内出现\n\n第四种影响在[1,4]、[2,5]和[1,5]三个加强区间内出现\n\n第五种影响在[2,5]和[1,5]两个加强区间内出现\n\n注意：加强区间是由“影响”构成的，而不是由“病原体”构成的\n\n$n\\leqslant2m\\leqslant400000$\n\n测试点1~2总分10分，$m\\leqslant5$\n\n测试点3~6总分20分，$m\\leqslant200$\n\n测试点7~12总分30分，$m\\leqslant5000$\n\n测试点13~15总分15分，$m\\leqslant50000$\n\n测试点16~18总分15分，$m\\leqslant50000$，捆绑测试\n\n测试点19~22总分10分，$m\\leqslant200000$，捆绑测试\n\nby oscar", "locale": "zh-CN"}}}
{"pid": "P4231", "type": "P", "difficulty": 4, "samples": [["5 2\n1 5 2 10\n2 4 1 1\n", "3 10"], ["6 2\n1 5 2 10\n2 4 1 1", "3 10"]], "limits": {"time": [500, 500, 500, 500, 500, 500, 500, 500, 500, 500], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["前缀和", "差分"], "title": "三步必杀", "background": "### （三）旧都\n\n离开狭窄的洞穴，眼前豁然开朗。\n\n天空飘着不寻常的雪花。\n\n一反之前的幽闭，现在面对的，是繁华的街市，可以听见酒碗碰撞的声音。\n\n这是由被人们厌恶的鬼族和其他妖怪们组成的小社会，一片其乐融融的景象。\n\n诶，不远处突然出现了一些密密麻麻的小点，好像大颗粒扬尘一样。\n\n离得近了点，终于看清楚了。\n\n长着角的鬼们聚在一起，围观着另一只鬼的表演。\n\n那”扬尘”，其实都是弹幕。\n\n勇仪的招数之一，三步之内，所到之处弹幕云集，几乎没有生存可能。\n\n为了强化这一技能，勇仪将对着一排柱子进行攻击。\n\n旧地狱的柱子虽然无比坚固，但保险起见还是先要了解一下这样一套攻击对柱子有多少损伤，顺带也能检验练习的效果。\n\n勇仪决定和其它鬼们商量商量...\n\n“我知道妖怪之山的河童一族有一种叫做计算机的神奇道具，说不定可以借来用用”，萃香说道。\n\n于是旧地狱的鬼族就决定请河城荷取来帮忙了。\n\n“要记录【所有柱子的损伤程度】吗”，荷取问道。\n\n经过进一步的询问，荷取发现他们仅仅需要【所有攻击都完成后】柱子的损伤程度。\n\n任务了解地差不多了，荷取将其中的重要部分提取了出来，记录在了她的工作笔记本上：\n\n(记录的内容见题目描述)\n\n那么实验就这样开始了。\n\n在惊天动地的碰撞声中，勇仪每完成一轮攻击，荷取都忠实地记录下对每根柱子产生的伤害。而此时勇仪就在旁边等待着记录完成，然后再进行下一轮的攻击。\n\n地面上，天色渐晚。\n\n“不想在这里留到深夜啊，不然就回不了家了”，荷取这样想着，手中依然在重复地向计算机中输入新产生的信息。\n\n“真的必须一次一次地记录下每轮攻击对每个柱子产生的伤害吗？有没有更高效的方法？”这一念头在荷取的心中闪过...\n\n（后续剧情在题解中，接下来请看T3）", "description": "$N$ 个柱子排成一排，一开始每个柱子损伤度为 $0$。\n\n接下来勇仪会进行 $M$ 次攻击，每次攻击可以用 $4$ 个参数 $l,r,s,e$ 来描述：\n\n表示这次攻击作用范围为第 $l$ 个到第 $r$ 个之间所有的柱子(包含 $l,r$)，对第一个柱子的伤害为 $s$，对最后一个柱子的伤害为 $e$。\n\n攻击产生的伤害值是一个等差数列。若 $l=1,r=5,s=2,e=10$，则对第 $1 \\sim 5$ 个柱子分别产生 $2,4,6,8,10$ 的伤害。\n\n鬼族们需要的是所有攻击完成之后每个柱子的损伤度。", "inputFormat": "第一行 $2$ 个整数 $N,M$，用空格隔开，下同。\n\n接下来 $M$ 行，每行 $4$ 个整数 $l,r,s,e$，含义见题目描述。\n\n数据保证对每个柱子产生的每次伤害值都是整数。", "outputFormat": "由于输出数据可能过大无法全部输出，为了确保你真的能维护所有柱子的损伤度，只要输出它们的异或和与最大值即可。\n\n（异或和就是所有数字按位异或起来的值。）\n\n（异或运算符在 c++ 里为 `^`。）", "hint": "### 样例解释：\n\n样例 $1$：\n\n第一次攻击产生的伤害：$2,4,6,8,10$。\n\n第二次攻击产生的伤害：$0,1,1,1,0$。\n\n所有攻击结束后每个柱子的损伤程度：$2,5,7,9,10$。\n\n输出异或和与最大值，就是 $3,10$。\n\n样例 $2$：\n\n没有打到第六根柱子，答案不变\n\n### 数据范围：\n\n本题满分为 $100$ 分，下面是 $4$ 个子任务。$(x/y)$ 表示(得分/测试点数量)。\n\n妖精级 $(18/3)$：$1 \\le n,m \\le 1000$。这种工作即使像妖精一样玩玩闹闹也能完成吧？\n\n河童级 $(10/1)$：$s=e$，这可以代替我工作吗？\n\n天狗级 $(20/4)$：$1 \\le n,m \\le 10^5$。小打小闹不再可行了呢。\n\n鬼神级 $(52/2)$：没有特殊限制。要真正开始思考了。\n\n以上四部分数据不相交。\n\n对于全部的数据：$1\\le n\\le 10^7$，$1\\le m\\le 3\\times 10^5$，$1\\le l < r \\le n$.\n\n所有输入输出数据以及柱子受损伤程度始终在 $[0,9 \\times 10^{18}]$ 范围内。\n\n### 提示：\n\n由于种种原因，时间限制可能会比较紧，c++ 选手请不要使用 `cin` 读入数据。\n\nby orangebird。", "locale": "zh-CN", "translations": {"en": {"title": "Three-Step Surekill", "background": "(3) The Old Capital\n\nLeaving the narrow cave, the view suddenly opened up.\n\nUnusual snowflakes drifted in the sky.\n\nIn contrast to the previous confinement, there was now a bustling marketplace, with the clinking of wine bowls audible.\n\nThis was a small society made up of the oni, who were disliked by humans, and other youkai, a scene of harmony and joy.\n\nEh? Not far away, some dense tiny dots appeared, like big grains of dust swirling in the air.\n\nGetting closer, it finally became clear.\n\nHorned oni gathered together, watching another oni’s performance.\n\nThat “dust cloud” was actually danmaku.\n\nOne of Yuugi’s moves: within three steps, wherever she passes, danmaku converge, leaving almost no chance of survival.\n\nTo strengthen this skill, Yuugi would attack a row of pillars.\n\nAlthough the pillars of the Old Hell were incredibly sturdy, it was still safer to first figure out how much damage such a sequence of attacks would cause to the pillars, and this could also help evaluate the effectiveness of practice.\n\nYuugi decided to discuss it with the other oni...\n\n“I know the kappa clan on Youkai Mountain has a magical tool called a computer; maybe we can borrow it,” said Suika.\n\nSo the oni of the Old Hell decided to ask Nitori Kawashiro to help.\n\n“Do you want to record the damage levels of all pillars?” Nitori asked.\n\nAfter further inquiries, Nitori found that they only needed the damage levels of the pillars after all attacks were completed.\n\nHaving understood the task, Nitori extracted the important parts and wrote them down in her work notebook:\n\n(See Problem Description for the recorded content.)\n\nThus the experiment began.\n\nAmid earth-shaking collisions, after Yuugi completed each round of attacks, Nitori faithfully recorded the damage inflicted on each pillar. Yuugi, meanwhile, waited for the recording to be completed before proceeding to the next round.\n\nOn the ground, dusk approached.\n\n“I don’t want to stay here until late at night, or I won’t be able to get home,” thought Nitori, her hands still repeatedly entering newly generated information into the computer.\n\n“Do I really have to record, one by one, the damage to each pillar after every round of attacks? Is there a more efficient way?” This thought flashed through Nitori’s mind...\n\n(The rest of the story is in the editorial; next, see T3.)", "description": "There are $N$ pillars in a row, and initially each pillar has damage $0$.\n\nYuugi will perform $M$ attacks. Each attack is described by four parameters $l, r, s, e$:\n\nIt means this attack affects all pillars from the $l$-th to the $r$-th (inclusive), dealing damage $s$ to the first pillar and $e$ to the last pillar within the range.\n\nThe damage values form an arithmetic progression. For example, if $l = 1, r = 5, s = 2, e = 10$, then the damages to pillars $1 \\sim 5$ are $2, 4, 6, 8, 10$ respectively.\n\nThe oni need the final damage of each pillar after all attacks are completed.", "inputFormat": "The first line contains $2$ integers $N, M$, separated by a space; same below.\n\nEach of the next $M$ lines contains $4$ integers $l, r, s, e$, as described above.\n\nIt is guaranteed that every individual damage applied to any pillar is an integer.", "outputFormat": "Because the output might be too large to print in full, to ensure you can indeed maintain all pillars’ damage, output two integers separated by a space: the XOR sum of all pillars’ final damages and the maximum of them.\n\n(The XOR sum is the value obtained by bitwise XOR over all numbers.)\n\n(The XOR operator in C++ is `^`.)", "hint": "Sample explanation:\n\nSample 1:\n\nDamage from the first attack: $2, 4, 6, 8, 10$.\n\nDamage from the second attack: $0, 1, 1, 1, 0$.\n\nFinal damage of each pillar after all attacks: $2, 5, 7, 9, 10$.\n\nOutput the XOR sum and the maximum, which are $3, 10$.\n\nSample 2:\n\nThe sixth pillar is not hit, so the answer remains unchanged.\n\nConstraints:\n\nThis problem is worth $100$ points, split into $4$ subtasks. $(x/y)$ means (score/testcase count).\n\n- Fairy level $(18/3)$: $1 \\le N, M \\le 1000$. Even fairies playing around could finish this job, right?\n- Kappa level $(10/1)$: $s = e$. Can this replace my work?\n- Tengu level $(20/4)$: $1 \\le N, M \\le 10^5$. Small tricks no longer suffice.\n- Oni God level $(52/2)$: No special restrictions. Time to really think.\n\nThese four parts of testdata do not overlap.\n\nFor all data: $1 \\le N \\le 10^7$, $1 \\le M \\le 3 \\times 10^5$, $1 \\le l < r \\le N$.\n\nAll input, output, and pillar damage values are always within $[0, 9 \\times 10^{18}]$.\n\nTip:\n\nDue to various reasons, the time limit may be tight. C++ participants, please do not use `cin` for input.\n\nby orangebird.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "三步必杀", "background": "### （三）旧都\n\n离开狭窄的洞穴，眼前豁然开朗。\n\n天空飘着不寻常的雪花。\n\n一反之前的幽闭，现在面对的，是繁华的街市，可以听见酒碗碰撞的声音。\n\n这是由被人们厌恶的鬼族和其他妖怪们组成的小社会，一片其乐融融的景象。\n\n诶，不远处突然出现了一些密密麻麻的小点，好像大颗粒扬尘一样。\n\n离得近了点，终于看清楚了。\n\n长着角的鬼们聚在一起，围观着另一只鬼的表演。\n\n那”扬尘”，其实都是弹幕。\n\n勇仪的招数之一，三步之内，所到之处弹幕云集，几乎没有生存可能。\n\n为了强化这一技能，勇仪将对着一排柱子进行攻击。\n\n旧地狱的柱子虽然无比坚固，但保险起见还是先要了解一下这样一套攻击对柱子有多少损伤，顺带也能检验练习的效果。\n\n勇仪决定和其它鬼们商量商量...\n\n“我知道妖怪之山的河童一族有一种叫做计算机的神奇道具，说不定可以借来用用”，萃香说道。\n\n于是旧地狱的鬼族就决定请河城荷取来帮忙了。\n\n“要记录【所有柱子的损伤程度】吗”，荷取问道。\n\n经过进一步的询问，荷取发现他们仅仅需要【所有攻击都完成后】柱子的损伤程度。\n\n任务了解地差不多了，荷取将其中的重要部分提取了出来，记录在了她的工作笔记本上：\n\n(记录的内容见题目描述)\n\n那么实验就这样开始了。\n\n在惊天动地的碰撞声中，勇仪每完成一轮攻击，荷取都忠实地记录下对每根柱子产生的伤害。而此时勇仪就在旁边等待着记录完成，然后再进行下一轮的攻击。\n\n地面上，天色渐晚。\n\n“不想在这里留到深夜啊，不然就回不了家了”，荷取这样想着，手中依然在重复地向计算机中输入新产生的信息。\n\n“真的必须一次一次地记录下每轮攻击对每个柱子产生的伤害吗？有没有更高效的方法？”这一念头在荷取的心中闪过...\n\n（后续剧情在题解中，接下来请看T3）", "description": "$N$ 个柱子排成一排，一开始每个柱子损伤度为 $0$。\n\n接下来勇仪会进行 $M$ 次攻击，每次攻击可以用 $4$ 个参数 $l,r,s,e$ 来描述：\n\n表示这次攻击作用范围为第 $l$ 个到第 $r$ 个之间所有的柱子(包含 $l,r$)，对第一个柱子的伤害为 $s$，对最后一个柱子的伤害为 $e$。\n\n攻击产生的伤害值是一个等差数列。若 $l=1,r=5,s=2,e=10$，则对第 $1 \\sim 5$ 个柱子分别产生 $2,4,6,8,10$ 的伤害。\n\n鬼族们需要的是所有攻击完成之后每个柱子的损伤度。", "inputFormat": "第一行 $2$ 个整数 $N,M$，用空格隔开，下同。\n\n接下来 $M$ 行，每行 $4$ 个整数 $l,r,s,e$，含义见题目描述。\n\n数据保证对每个柱子产生的每次伤害值都是整数。", "outputFormat": "由于输出数据可能过大无法全部输出，为了确保你真的能维护所有柱子的损伤度，只要输出它们的异或和与最大值即可。\n\n（异或和就是所有数字按位异或起来的值。）\n\n（异或运算符在 c++ 里为 `^`。）", "hint": "### 样例解释：\n\n样例 $1$：\n\n第一次攻击产生的伤害：$2,4,6,8,10$。\n\n第二次攻击产生的伤害：$0,1,1,1,0$。\n\n所有攻击结束后每个柱子的损伤程度：$2,5,7,9,10$。\n\n输出异或和与最大值，就是 $3,10$。\n\n样例 $2$：\n\n没有打到第六根柱子，答案不变\n\n### 数据范围：\n\n本题满分为 $100$ 分，下面是 $4$ 个子任务。$(x/y)$ 表示(得分/测试点数量)。\n\n妖精级 $(18/3)$：$1 \\le n,m \\le 1000$。这种工作即使像妖精一样玩玩闹闹也能完成吧？\n\n河童级 $(10/1)$：$s=e$，这可以代替我工作吗？\n\n天狗级 $(20/4)$：$1 \\le n,m \\le 10^5$。小打小闹不再可行了呢。\n\n鬼神级 $(52/2)$：没有特殊限制。要真正开始思考了。\n\n以上四部分数据不相交。\n\n对于全部的数据：$1\\le n\\le 10^7$，$1\\le m\\le 3\\times 10^5$，$1\\le l < r \\le n$.\n\n所有输入输出数据以及柱子受损伤程度始终在 $[0,9 \\times 10^{18}]$ 范围内。\n\n### 提示：\n\n由于种种原因，时间限制可能会比较紧，c++ 选手请不要使用 `cin` 读入数据。\n\nby orangebird。", "locale": "zh-CN"}}}
{"pid": "P4232", "type": "P", "difficulty": 7, "samples": [["3 2 1 2 10\n1 3\n2 3\n", "11.000"], ["6 8 2 1 2\n1 2\n1 3\n1 5\n2 3\n3 5\n5 6\n6 4\n2 4\n", "2.333"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["递归", "线性规划", "期望"], "title": "无意识之外的捉迷藏", "background": "### （五）心与心的对话\n\n旧都还在下着雪。\n\n不知道走了多远的路，已经远离街市了。\n\n眼前隐隐约约能看到一座巨大的宫殿。\n\n那就是，地灵殿吗？\n\n心里突然紧张了起来。\n\n这里住着旧地狱最可怕的觉妖怪。\n\n古明地觉，她拥有读心的能力。人类，妖怪，甚至是怨灵，站在她面前的时候都如同赤身裸体，没有任何秘密可言。而且，听说在战斗中，她还会使用催眠术不断激起对手内心深处的恐怖回忆，从心灵上打垮对手。这样的妖怪自然会被人讨厌啦。\n\n不过，此次地底之旅可不能因为要遇到可怕的妖怪而就此结束。\n\n咚咚咚，敲了敲地灵殿的大门。\n\n“来客吗，真是少见呢。”\n\n眼前，站着一个少女，穿着蓝色的衣服，粉红色的裙子，头发也是粉红色的。\n\n在她的胸前，悬着一只红色的大眼睛，通过眼睛周围的六根管子连接着身体。\n\n她看起来很温柔的样子，完全不像听说的那样恐怖。\n\n“来地底旅行的外面世界的人类吗？真是非常少见呢，居然找到了这里”\n\n“看起来没有别的想法，就是想来转转呢，那就进来吧”\n\n走进大门。\n\n不愧是地灵”殿”，真的是好大的一个宫殿，桃红色和黑色相间的地板，印有花纹的窗户。\n\n眼前是一组很宽的台阶，通向二楼，然后分成左右两个通道。\n\n“很漂亮吧，这里空间大，宠物们都很喜欢呢。”\n\n就这样，我跟着觉进入了她工作的房间，我们坐在沙发上聊了很久，虽然我很少说话。\n\n在聊天的过程中，我了解到她还有一个妹妹古明地恋，由于不愿让别人因为自己会读心而讨厌自己，闭上了觉之瞳。觉为了开导妹妹，经常和宠物陪着她玩。\n\n地灵殿，觉和妹妹，宠物们，一直在过着平静又温馨的生活。\n\n“既然来这里了，就和我们一起玩吧。”觉邀请我们参与她们的游戏。\n\n地底的妖怪会玩怎样的游戏呢？\n\n于是，就这样，我就答应参与觉和恋的“无意识的捉迷藏”了。\n\n说是”捉迷藏”，其实和普通的捉迷藏区别很大，更类似于”捉人游戏”。\n\n就是觉和恋一开始分别站在两个地方，觉要捉到恋就算赢了。\n\n但为什么又说是”捉迷藏”呢？\n\n原来恋恋可以无意识地行动，也就是可以让周围人在潜意识里忽略她的存在，类似隐身，但又不是隐身。真是有趣的能力呢，是不是闭上了觉之瞳的缘故？\n\n我们玩得很开心。有时无意识碰到了恋恋的手，还吓了一跳呢。\n\n一段时间后，姐妹俩累了，觉还有工作要处理，就先回去了。\n\n宠物们似乎意犹未尽，她们还想继续。\n\n“可是在这个旧地狱啊，除了主人的妹妹恋以外，哪里又有妖怪能够操纵无意识呢？\n\n算了,干脆玩普通的捉人游戏吧。”阿燐提议道。\n\n于是宠物们很快又忘我地投入了”无意识之外的捉迷藏”中。\n\n不知什么时候，我感到背后一凉，回过头一看，原来是恋恋。\n\n我们就这样站在这里看着宠物们玩。\n\n虽然不知道为什么能耐心地看那么长时间，但几个小时过去了，我们依然站在这里。\n\n恋恋好像有一些疑问，在经过简单的交流后，我把她的疑问做了一个总结。\n\n(见题目描述)\n\n这个问题对无意识的恋恋来说果然无法解决啊。\n\n能和姐妹俩聊得这么开心，真是很感激呢，那就尽自己的努力思考一下这个问题吧。\n\n(后续剧情见题解，接下来请看T4)", "description": "### 问题摘要\n\n在一个有向无环图上，阿燐和阿空第0个时刻分别站在编号为 $s_r$，$s_k$ 的节点，二人都知道双方的初始位置，对地图完全了解。\n\n从第 $1$ 个时刻起，每个时刻阿燐和阿空都可以选择站着不动，也可以选择移动到相邻的节点，二人每时刻的移动是同时开始的，并且不能中途改变方向。\n\n阿燐被阿空捉住时，游戏立即结束。如果阿空一直没有捉住阿燐，第 $t$ 个时刻结束后两人就不能再继续移动了，游戏将在第 $t+1$ 个时刻结束。\n\n阿空的目的是尽快捉住阿燐(捉住的定义是与阿燐同一时刻站在同一节点)，而阿燐的目的是尽可能更长时间不被阿空捉住。具体而言，若一场游戏进行了 $t_0$ 时刻，阿燐的得分是 $t_0$ ，阿空的得分是 $-t_0$，双方都希望自己得分(或得分的期望值)更高。\n\n我们认为在这个过程中阿燐和阿空随时都能知道对方的位置。两人在第 $t$ 个时刻不能看出第 $t+1$ 个时刻对方要走到哪里。\n\n恋恋想知道，在双方最优决策的情况下，游戏结束时刻的期望值是多少。", "inputFormat": "第一行 $5$ 个整数 $n$，$m$，$s_r$，$s_k$，$t$，用空格隔开，下同。$n$ 表示地图点数，$m$ 表示边数。\n\n接下来 $m$ 行，每行两个整数 $a$，$b$，表示从 $a$ 到 $b$ 有一条单向边（不存在重边）。", "outputFormat": "一个实数，四舍五入保留 $3$ 位小数，表示游戏结束时刻的期望值。\n\n你的答案必须和标准答案完全相同才算正确。", "hint": "### 样例解释\n\n样例 $1$：阿燐只要一直不动，阿空在前$t$单位时间内就无法抓到阿燐，答案为 $t+1$，即 ```11.000```。\n\n### 数据范围\n\n**本题采用捆绑测试。**\n\n对于 30% 的数据，$n\\leqslant3$。\n\n对于另外 70% 的数据，$n$，$t\\leqslant20$，其中前 40% 的数据和后 30% 的数据分别捆绑测试。\n\n### 提示\n本题主要考察你能否使用正确的方法算出答案，对算法运行耗时要求不高。\n\nby orangebird", "locale": "zh-CN", "translations": {"en": {"title": "Hide-and-Seek Beyond the Unconscious", "background": "(5) A Conversation from Heart to Heart.\n\nSnow is still falling in the old capital.\n\nI don’t know how far I’ve walked; I’ve already gone far from the marketplace.\n\nAhead, I can vaguely see a huge palace.\n\nIs that the Palace of the Earth Spirits?\n\nI suddenly feel nervous.\n\nHere lives the most fearsome satori youkai in the Old Hell.\n\nKomeiji Satori, who has the power to read minds. Humans, youkai, even vengeful spirits—standing before her is like being stripped bare, with no secrets at all. It’s also said that in battle she uses hypnosis to repeatedly stir up her opponent’s deepest fears, defeating them from within. Of course a youkai like that would be disliked.\n\nStill, this underground trip can’t end just because we’re about to meet someone scary.\n\nKnock, knock—three taps on the palace gate.\n\n“A visitor? How rare.”\n\nIn front of me stands a girl wearing blue clothes and a pink skirt, with pink hair.\n\nOn her chest hangs a large red eye, connected to her body by six tubes radiating from it.\n\nShe looks very gentle—nothing like the terrifying stories I’d heard.\n\n“A human from the surface traveling underground? That’s really rare—you actually found this place.”\n\n“It seems you don’t have any other intention and just want to look around. Come in, then.”\n\nWe step through the gate.\n\nWorthy of the “Palace,” it’s truly vast—checkered floors in peach-pink and black, windows adorned with patterns.\n\nAhead is a broad staircase leading to the second floor, where it splits into left and right corridors.\n\n“Pretty, isn’t it? It’s spacious here; the pets love it.”\n\nI follow Satori into her office. We sit on the sofa and chat for a long time, though I speak very little.\n\nDuring the conversation, I learn that she has a younger sister, Komeiji Koishi. Not wanting to be disliked for reading minds, Koishi closed her satori eye. To guide her sister, Satori often plays with her, accompanied by their pets.\n\nIn the Palace of the Earth Spirits, Satori, her sister, and their pets have lived a peaceful, warm life.\n\n“Since you’re here, play with us,” Satori invites us to join their game.\n\nWhat kind of games do underground youkai play?\n\nAnd so, I agree to join Satori and Koishi’s “unconscious hide-and-seek.”\n\nThey call it “hide-and-seek,” but it’s actually very different from the usual game—more like tag.\n\nSatori and Koishi start in two different places; Satori wins if she tags Koishi.\n\nBut why call it “hide-and-seek”?\n\nIt turns out Koishi can act unconsciously—she can make people around her subconsciously ignore her presence. It’s like invisibility, but not exactly the same. What an interesting ability—maybe it’s because she closed her satori eye?\n\nWe have a blast. Sometimes I accidentally brush Koishi’s hand and jump in surprise.\n\nAfter a while, the sisters get tired. Satori has work to handle and heads back.\n\nThe pets seem unsatisfied and want to continue.\n\n“But down here in the Old Hell, besides the mistress’s sister Koishi, who else can manipulate the unconscious?\n\nForget it, let’s just play ordinary tag,” Orin suggests.\n\nThe pets quickly throw themselves into “hide-and-seek beyond the unconscious.”\n\nAt some point, I feel a chill behind me. I turn around—it’s Koishi.\n\nWe just stand there, watching the pets play.\n\nThough I don’t know why I can patiently watch for so long, even after hours we’re still standing there.\n\nKoishi seems to have some questions. After a brief exchange, I summarize them.\n\n(See Problem Description.)\n\nAs expected, this problem is indeed hard for unconscious Koishi.\n\nI’m grateful to have such a pleasant chat with the sisters, so I’ll do my best to think this problem through.\n\n(For the continuation of the story, see the editorial. Next, please see T4.)", "description": "Problem summary.\n\nOn a directed acyclic graph, A Rin and A Kong stand at time $0$ on nodes numbered $s_r$ and $s_k$, respectively. Both know each other’s initial positions and have full knowledge of the map.\n\nStarting from time $1$, at each time step both A Rin and A Kong may either stay put or move to an adjacent node along a directed edge. Their moves at each time step start simultaneously, and they cannot change direction mid-step.\n\nWhen A Rin is caught by A Kong, the game ends immediately. If A Kong never catches A Rin, then after time $t$ ends, neither can move anymore, and the game ends at time $t+1$.\n\nA Kong’s goal is to catch A Rin as quickly as possible (catching means being on the same node at the same time), while A Rin’s goal is to avoid being caught for as long as possible. Specifically, if a game lasts for $t_0$ time steps, A Rin’s score is $t_0$, and A Kong’s score is $-t_0$. Both aim to maximize their own (expected) scores.\n\nWe assume that throughout the process A Rin and A Kong always know each other’s current positions. At time $t$, neither can tell where the other will choose to move at time $t+1$.\n\nKoishi wants to know: under optimal play by both sides, what is the expected ending time of the game?", "inputFormat": "The first line contains $5$ integers $n$, $m$, $s_r$, $s_k$, $t$, separated by spaces. Here, $n$ is the number of nodes and $m$ is the number of edges.\n\nThe next $m$ lines each contain two integers $a$, $b$, indicating a directed edge from $a$ to $b$ (no multiple edges).", "outputFormat": "Output a real number, rounded to $3$ decimal places, which is the expected ending time of the game.\n\nYour answer must exactly match the standard answer to be accepted.", "hint": "Sample explanation.\n\nSample $1$: If A Rin always stays still, then A Kong cannot catch A Rin within the first $t$ units of time; the answer is $t+1$, i.e.,\n``` \n11.000\n```\n\nConstraints.\n\nThis problem uses bundled testdata.\n\n- For $30\\%$ of the data, $n \\leqslant 3$.\n- For the remaining $70\\%$ of the data, $n, t \\leqslant 20$. Among these, the first $40\\%$ and the last $30\\%$ are bundled and tested separately.\n\nTip: This problem mainly checks whether you can use the correct method to compute the answer; strict time limits on the algorithm are not the focus.\n\nby orangebird.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "无意识之外的捉迷藏", "background": "### （五）心与心的对话\n\n旧都还在下着雪。\n\n不知道走了多远的路，已经远离街市了。\n\n眼前隐隐约约能看到一座巨大的宫殿。\n\n那就是，地灵殿吗？\n\n心里突然紧张了起来。\n\n这里住着旧地狱最可怕的觉妖怪。\n\n古明地觉，她拥有读心的能力。人类，妖怪，甚至是怨灵，站在她面前的时候都如同赤身裸体，没有任何秘密可言。而且，听说在战斗中，她还会使用催眠术不断激起对手内心深处的恐怖回忆，从心灵上打垮对手。这样的妖怪自然会被人讨厌啦。\n\n不过，此次地底之旅可不能因为要遇到可怕的妖怪而就此结束。\n\n咚咚咚，敲了敲地灵殿的大门。\n\n“来客吗，真是少见呢。”\n\n眼前，站着一个少女，穿着蓝色的衣服，粉红色的裙子，头发也是粉红色的。\n\n在她的胸前，悬着一只红色的大眼睛，通过眼睛周围的六根管子连接着身体。\n\n她看起来很温柔的样子，完全不像听说的那样恐怖。\n\n“来地底旅行的外面世界的人类吗？真是非常少见呢，居然找到了这里”\n\n“看起来没有别的想法，就是想来转转呢，那就进来吧”\n\n走进大门。\n\n不愧是地灵”殿”，真的是好大的一个宫殿，桃红色和黑色相间的地板，印有花纹的窗户。\n\n眼前是一组很宽的台阶，通向二楼，然后分成左右两个通道。\n\n“很漂亮吧，这里空间大，宠物们都很喜欢呢。”\n\n就这样，我跟着觉进入了她工作的房间，我们坐在沙发上聊了很久，虽然我很少说话。\n\n在聊天的过程中，我了解到她还有一个妹妹古明地恋，由于不愿让别人因为自己会读心而讨厌自己，闭上了觉之瞳。觉为了开导妹妹，经常和宠物陪着她玩。\n\n地灵殿，觉和妹妹，宠物们，一直在过着平静又温馨的生活。\n\n“既然来这里了，就和我们一起玩吧。”觉邀请我们参与她们的游戏。\n\n地底的妖怪会玩怎样的游戏呢？\n\n于是，就这样，我就答应参与觉和恋的“无意识的捉迷藏”了。\n\n说是”捉迷藏”，其实和普通的捉迷藏区别很大，更类似于”捉人游戏”。\n\n就是觉和恋一开始分别站在两个地方，觉要捉到恋就算赢了。\n\n但为什么又说是”捉迷藏”呢？\n\n原来恋恋可以无意识地行动，也就是可以让周围人在潜意识里忽略她的存在，类似隐身，但又不是隐身。真是有趣的能力呢，是不是闭上了觉之瞳的缘故？\n\n我们玩得很开心。有时无意识碰到了恋恋的手，还吓了一跳呢。\n\n一段时间后，姐妹俩累了，觉还有工作要处理，就先回去了。\n\n宠物们似乎意犹未尽，她们还想继续。\n\n“可是在这个旧地狱啊，除了主人的妹妹恋以外，哪里又有妖怪能够操纵无意识呢？\n\n算了,干脆玩普通的捉人游戏吧。”阿燐提议道。\n\n于是宠物们很快又忘我地投入了”无意识之外的捉迷藏”中。\n\n不知什么时候，我感到背后一凉，回过头一看，原来是恋恋。\n\n我们就这样站在这里看着宠物们玩。\n\n虽然不知道为什么能耐心地看那么长时间，但几个小时过去了，我们依然站在这里。\n\n恋恋好像有一些疑问，在经过简单的交流后，我把她的疑问做了一个总结。\n\n(见题目描述)\n\n这个问题对无意识的恋恋来说果然无法解决啊。\n\n能和姐妹俩聊得这么开心，真是很感激呢，那就尽自己的努力思考一下这个问题吧。\n\n(后续剧情见题解，接下来请看T4)", "description": "### 问题摘要\n\n在一个有向无环图上，阿燐和阿空第0个时刻分别站在编号为 $s_r$，$s_k$ 的节点，二人都知道双方的初始位置，对地图完全了解。\n\n从第 $1$ 个时刻起，每个时刻阿燐和阿空都可以选择站着不动，也可以选择移动到相邻的节点，二人每时刻的移动是同时开始的，并且不能中途改变方向。\n\n阿燐被阿空捉住时，游戏立即结束。如果阿空一直没有捉住阿燐，第 $t$ 个时刻结束后两人就不能再继续移动了，游戏将在第 $t+1$ 个时刻结束。\n\n阿空的目的是尽快捉住阿燐(捉住的定义是与阿燐同一时刻站在同一节点)，而阿燐的目的是尽可能更长时间不被阿空捉住。具体而言，若一场游戏进行了 $t_0$ 时刻，阿燐的得分是 $t_0$ ，阿空的得分是 $-t_0$，双方都希望自己得分(或得分的期望值)更高。\n\n我们认为在这个过程中阿燐和阿空随时都能知道对方的位置。两人在第 $t$ 个时刻不能看出第 $t+1$ 个时刻对方要走到哪里。\n\n恋恋想知道，在双方最优决策的情况下，游戏结束时刻的期望值是多少。", "inputFormat": "第一行 $5$ 个整数 $n$，$m$，$s_r$，$s_k$，$t$，用空格隔开，下同。$n$ 表示地图点数，$m$ 表示边数。\n\n接下来 $m$ 行，每行两个整数 $a$，$b$，表示从 $a$ 到 $b$ 有一条单向边（不存在重边）。", "outputFormat": "一个实数，四舍五入保留 $3$ 位小数，表示游戏结束时刻的期望值。\n\n你的答案必须和标准答案完全相同才算正确。", "hint": "### 样例解释\n\n样例 $1$：阿燐只要一直不动，阿空在前$t$单位时间内就无法抓到阿燐，答案为 $t+1$，即 ```11.000```。\n\n### 数据范围\n\n**本题采用捆绑测试。**\n\n对于 30% 的数据，$n\\leqslant3$。\n\n对于另外 70% 的数据，$n$，$t\\leqslant20$，其中前 40% 的数据和后 30% 的数据分别捆绑测试。\n\n### 提示\n本题主要考察你能否使用正确的方法算出答案，对算法运行耗时要求不高。\n\nby orangebird", "locale": "zh-CN"}}}
{"pid": "P4233", "type": "P", "difficulty": 7, "samples": [["4", "1\n-1\n1\n1"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 2000, 2000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["O2优化", "剪枝", "强连通分量", "概率论", "期望", "快速傅里叶变换 FFT"], "title": "射命丸文的笔记", "background": "### （七）再见，地底世界的朋友们\n\n在地灵殿住了许多天了呢。\n\n这些日子里，觉分享了很多旧地狱的故事。\n\n此次地底旅行，可以说是非常充实了。\n\n虽然仍旧有些不舍，不过人类总是要见太阳的，再说这样麻烦觉姐姐招待我们也有些过意不去呢。\n\n那么，和觉，恋，阿燐，阿空，以及其他宠物们说再见吧。\n\n......\n\n旧地狱的街市，依旧飘着雪。\n\n已经能看到溶洞了。\n\n环境又变得幽闭起来。\n\n诶，前面不是山女吗？\n\n“啊，你们要回地面了吗，玩的怎样？”\n\n“很开心呢，对了，剩下的问题已经解决了”\n\n我们向山女解释了从荷取那里听到的方法。\n\n“谢谢!”\n\n“不客气，那么再见了~”\n\n世界一片白茫茫的...\n\n阳光是那么的刺眼，以至于几分钟后我们才能睁开眼睛看清楚地面的景色。\n\n沿着魔法森林中的小路向神社走去，这次的旅行也在我们的脚步声中走向了尾声。\n\n前方的地面上忽然出现了一页破损的笔记。\n\n捡起来一看，发现是从文文的笔记本上脱落下来的。\n\n射命丸文，作为（不靠谱的）新闻记者，观察到最近地灵殿里的宠物们偶尔会互相打架，于是将每场决斗的胜负关系写在了她的笔记本上。刚刚捡起来的这页笔记，上面就记录着几场“单循环赛”。\n\n每场循环赛被抽象成一张竞赛图，其中顶点代表参加循环赛的宠物，从顶点 $u$ 指向顶点 $v$ 的边代表在一场比赛中宠物 $u$ 战胜了宠物 $v$。\n\n观察到这页笔记上所有的竞赛图中都至少存在一条经过所有顶点的回路，我们猜想文文只会记录这样的循环赛。\n\n可能是因为文文不清楚宠物们谁能打过谁，于是在那页笔记的最下面留下了一个这样的问题...\n\n(见题目描述)\n\n这最后一个问题，就留给你来解决啦。\n\n博丽大结界，已经在我们身后了。\n\n希望这次地底旅行，能给你留下美好的记忆~\n\n(全文完)", "description": "如果一个竞赛图含有哈密顿回路，则称这张竞赛图为值得记录的。\n\n从所有含有 $n$ 个顶点（顶点互不相同）的，值得记录的竞赛图中等概率随机选取一个。\n\n求选取的竞赛图中哈密顿回路数量的期望值。\n\n由于答案可能过大/丢失精度，只需要输出答案除以 $998244353$ 的余数。\n\n即：设答案为 $\\frac{q}{p}$，则你需要输出一个整数 $x$，满足 $px\\equiv q \\mod 998244353$ 且 $0\\leqslant x<998244353$，可以证明恰好存在一个这样的 $x$。\n\n若不存在这样的竞赛图，输出 `-1`。", "inputFormat": "一行一个正整数 $n$。", "outputFormat": "$n$ 行，第 $i$ 行一个数字，代表输入为 $i$ 时的答案", "hint": "### 样例解释：\n\n$n=1$ 时只有一种满足条件的竞赛图，就是一个点。\n\n$n=2$ 时竞赛图中只有一条边，不能形成哈密顿回路。\n\n$n=3$ 时有两种满足条件的竞赛图，分别为 $1\\to2\\to3\\to1$ 和 $1\\to3\\to2\\to1$，都只有 $1$ 条哈密顿回路，随机取出后期望值为 $1$。\n\n$n=4$ 时有很多种满足条件的的竞赛图，这里写不下了，但是所有满足条件的竞赛图都是同构的，所以随机取出后期望值为 $1$。\n\n### 数据范围：\n\n测试点 1~3 中 $n\\leqslant7$。\n\n测试点 4~6 中 $n\\leqslant10$。\n\n测试点 7~10 中 $n\\leqslant1000$。\n\n测试点 11~16 中 $n\\leqslant10000$。\n\n测试点 17~25 中 $n\\leqslant100000$。\n\n数据有梯度，每个测试点 $4$ 分。\n\n为防止卡常，最后两个点开 2s 时限。\n\n### 名词解释：\n\n[竞赛图](https://en.wikipedia.org/wiki/Tournament_(graph_theory))：指任意两个顶点间恰有一条有向边的有向图。\n\n[哈密顿回路](https://en.wikipedia.org/wiki/Hamiltonian_cycle)：指除起点和终点外经过所有顶点恰好一次且起点和终点相同的路径。\n\n\nby oscar\n", "locale": "zh-CN", "translations": {"en": {"title": "Aya Shameimaru's Notes", "background": "(7) Goodbye, friends in the Underworld.\n\nWe have stayed in the Palace of the Earth Spirits for many days.\n\nDuring these days, Satori shared many stories about the Former Hell.\n\nThis trip underground has been very fulfilling.\n\nAlthough we are still a bit reluctant to leave, humans must see the sun after all, and it would be a burden to keep troubling Satori to host us.\n\nWell then, let us say goodbye to Satori, Koishi, Orin, Okuu, and the other pets.\n\n...\n\nSnow is still drifting over the streets of Former Hell.\n\nWe can already see the karst cave.\n\nThe environment is becoming enclosed again.\n\nEh, isn’t that the mountain woman ahead?\n\n“Ah, you are returning to the surface? How was it?”\n\n“It was great. By the way, the remaining problem has been solved.”\n\nWe explained to the mountain woman the method we heard from Nitori.\n\n“Thanks!”\n\n“You’re welcome. See you~”\n\nThe world is a vast white...\n\nThe sunlight is so dazzling that it takes several minutes before we can open our eyes to see the scenery on the surface.\n\nWe follow the path through the Magic Forest toward the shrine. This journey comes to an end with the sound of our footsteps.\n\nSuddenly, a torn page appears on the ground ahead.\n\nPicking it up, we find that it fell out of Aya’s notebook.\n\nAya Shameimaru (Shameimaru Aya), being a (not-so-reliable) reporter, noticed that the pets in the Palace of the Earth Spirits would sometimes fight each other, so she wrote down the win–loss relationships for each duel in her notebook. On the page we just picked up, several “single round-robin tournaments” are recorded.\n\nEach round-robin tournament is abstracted as a tournament graph, where vertices represent pets participating in the round robin, and a directed edge from vertex $u$ to vertex $v$ means that pet $u$ defeated pet $v$ in a match.\n\nObserving that every tournament on this page contains at least one cycle that visits all vertices, we guess Aya records only such tournaments.\n\nPerhaps because Aya was unsure who could beat whom, she left a question at the very bottom of that page...\n\n(See Problem Description.)\n\nThis last question is for you to solve.\n\nThe Great Hakurei Barrier is already behind us.\n\nWe hope this trip underground leaves you with warm memories.\n\n(The End.)", "description": "If a tournament contains a Hamiltonian cycle, then we call this tournament “worth recording.”\n\nChoose uniformly at random from all “worth recording” tournaments with $n$ pairwise distinct vertices.\n\nFind the expected number of Hamiltonian cycles in the chosen tournament.\n\nSince the answer may be too large or lose precision, you only need to output the answer modulo $998244353$.\n\nThat is: let the answer be $\\frac{q}{p}$. You must output an integer $x$ such that $p x \\equiv q \\bmod 998244353$ and $0 \\leqslant x < 998244353$. It can be proved that such an $x$ exists and is unique.\n\nIf no such tournament exists, output `-1`.", "inputFormat": "One line with a positive integer $n$.", "outputFormat": "Output $n$ lines. On line $i$, print the answer for input $i$.", "hint": "Sample explanations:\n\n- When $n=1$, there is only one tournament, which is a single vertex.\n- When $n=2$, the tournament has only one edge and cannot form a Hamiltonian cycle.\n- When $n=3$, there are two “worth recording” tournaments, namely $1\\to2\\to3\\to1$ and $1\\to3\\to2\\to1$, each having exactly $1$ Hamiltonian cycle, so the expected value is $1$.\n- When $n=4$, there are many “worth recording” tournaments (too many to list here), but all that satisfy the condition are isomorphic, so the expected value is $1$.\n\nConstraints:\n\n- In test points 1–3, $n \\leqslant 7$.\n- In test points 4–6, $n \\leqslant 10$.\n- In test points 7–10, $n \\leqslant 1000$.\n- In test points 11–16, $n \\leqslant 10000$.\n- In test points 17–25, $n \\leqslant 100000$.\n\nThe testdata has a gradient; each test point is worth 4 points.\n\nTo avoid constant-factor issues, the last two points have a 2 s time limit.\n\nTerminology:\n\n- Tournament: https://en.wikipedia.org/wiki/Tournament_(graph_theory)\n- Hamiltonian cycle: https://en.wikipedia.org/wiki/Hamiltonian_cycle\n\nby oscar\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "射命丸文的笔记", "background": "### （七）再见，地底世界的朋友们\n\n在地灵殿住了许多天了呢。\n\n这些日子里，觉分享了很多旧地狱的故事。\n\n此次地底旅行，可以说是非常充实了。\n\n虽然仍旧有些不舍，不过人类总是要见太阳的，再说这样麻烦觉姐姐招待我们也有些过意不去呢。\n\n那么，和觉，恋，阿燐，阿空，以及其他宠物们说再见吧。\n\n......\n\n旧地狱的街市，依旧飘着雪。\n\n已经能看到溶洞了。\n\n环境又变得幽闭起来。\n\n诶，前面不是山女吗？\n\n“啊，你们要回地面了吗，玩的怎样？”\n\n“很开心呢，对了，剩下的问题已经解决了”\n\n我们向山女解释了从荷取那里听到的方法。\n\n“谢谢!”\n\n“不客气，那么再见了~”\n\n世界一片白茫茫的...\n\n阳光是那么的刺眼，以至于几分钟后我们才能睁开眼睛看清楚地面的景色。\n\n沿着魔法森林中的小路向神社走去，这次的旅行也在我们的脚步声中走向了尾声。\n\n前方的地面上忽然出现了一页破损的笔记。\n\n捡起来一看，发现是从文文的笔记本上脱落下来的。\n\n射命丸文，作为（不靠谱的）新闻记者，观察到最近地灵殿里的宠物们偶尔会互相打架，于是将每场决斗的胜负关系写在了她的笔记本上。刚刚捡起来的这页笔记，上面就记录着几场“单循环赛”。\n\n每场循环赛被抽象成一张竞赛图，其中顶点代表参加循环赛的宠物，从顶点 $u$ 指向顶点 $v$ 的边代表在一场比赛中宠物 $u$ 战胜了宠物 $v$。\n\n观察到这页笔记上所有的竞赛图中都至少存在一条经过所有顶点的回路，我们猜想文文只会记录这样的循环赛。\n\n可能是因为文文不清楚宠物们谁能打过谁，于是在那页笔记的最下面留下了一个这样的问题...\n\n(见题目描述)\n\n这最后一个问题，就留给你来解决啦。\n\n博丽大结界，已经在我们身后了。\n\n希望这次地底旅行，能给你留下美好的记忆~\n\n(全文完)", "description": "如果一个竞赛图含有哈密顿回路，则称这张竞赛图为值得记录的。\n\n从所有含有 $n$ 个顶点（顶点互不相同）的，值得记录的竞赛图中等概率随机选取一个。\n\n求选取的竞赛图中哈密顿回路数量的期望值。\n\n由于答案可能过大/丢失精度，只需要输出答案除以 $998244353$ 的余数。\n\n即：设答案为 $\\frac{q}{p}$，则你需要输出一个整数 $x$，满足 $px\\equiv q \\mod 998244353$ 且 $0\\leqslant x<998244353$，可以证明恰好存在一个这样的 $x$。\n\n若不存在这样的竞赛图，输出 `-1`。", "inputFormat": "一行一个正整数 $n$。", "outputFormat": "$n$ 行，第 $i$ 行一个数字，代表输入为 $i$ 时的答案", "hint": "### 样例解释：\n\n$n=1$ 时只有一种满足条件的竞赛图，就是一个点。\n\n$n=2$ 时竞赛图中只有一条边，不能形成哈密顿回路。\n\n$n=3$ 时有两种满足条件的竞赛图，分别为 $1\\to2\\to3\\to1$ 和 $1\\to3\\to2\\to1$，都只有 $1$ 条哈密顿回路，随机取出后期望值为 $1$。\n\n$n=4$ 时有很多种满足条件的的竞赛图，这里写不下了，但是所有满足条件的竞赛图都是同构的，所以随机取出后期望值为 $1$。\n\n### 数据范围：\n\n测试点 1~3 中 $n\\leqslant7$。\n\n测试点 4~6 中 $n\\leqslant10$。\n\n测试点 7~10 中 $n\\leqslant1000$。\n\n测试点 11~16 中 $n\\leqslant10000$。\n\n测试点 17~25 中 $n\\leqslant100000$。\n\n数据有梯度，每个测试点 $4$ 分。\n\n为防止卡常，最后两个点开 2s 时限。\n\n### 名词解释：\n\n[竞赛图](https://en.wikipedia.org/wiki/Tournament_(graph_theory))：指任意两个顶点间恰有一条有向边的有向图。\n\n[哈密顿回路](https://en.wikipedia.org/wiki/Hamiltonian_cycle)：指除起点和终点外经过所有顶点恰好一次且起点和终点相同的路径。\n\n\nby oscar\n", "locale": "zh-CN"}}}
{"pid": "P4234", "type": "P", "difficulty": 6, "samples": [["4 6 \n1 2 10 \n1 3 100 \n1 4 90 \n2 3 20 \n2 4 80 \n3 4 40 \n", "20"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144]}, "tags": ["图论", "O2优化", "枚举", "深度优先搜索 DFS", "生成树", "动态树 LCT"], "title": "最小差值生成树", "background": "", "description": "给定一个点标号从 $1$ 到 $n$ 的、有 $m$ 条边的无向图，求边权最大值与最小值的差值最小的生成树。图可能存在自环。", "inputFormat": "第一行有两个整数，表示图的点数 $n$ 和边数 $m$。\n\n接下来 $m$ 行，每行三个整数 $u, v, w$，表示存在一条连接 $u, v$ 长度为 $w$ 的边。", "outputFormat": "输出一行一个整数，表示答案。\n", "hint": "#### 数据规模与约定\n\n- 对于 $30\\%$ 的数据，保证 $n \\leq 100$，$m \\leq 10^3$。\n- 对于 $97\\%$ 的数据，保证 $n \\leq 500$，$m \\leq 10^5$。\n- 对于 $100\\%$ 的数据，保证 $1 \\leq n \\leq 5 \\times 10^4$，$1 \\leq m \\leq 2 \\times 10^5$，$1 \\leq u, v \\leq n$，$1 \\leq w \\leq 10^4$。", "locale": "zh-CN", "translations": {"en": {"title": "Minimum Difference Spanning Tree", "background": "", "description": "Given an undirected graph with vertices labeled from $1$ to $n$ and $m$ edges, find a spanning tree that minimizes the difference between the maximum and minimum edge weights in the tree. The graph may contain self-loops.", "inputFormat": "The first line contains two integers, the number of vertices $n$ and the number of edges $m$.\n\nThen follow $m$ lines. Each line contains three integers $u, v, w$, indicating there is an edge between $u$ and $v$ with weight $w$.", "outputFormat": "Output a single integer on one line, which is the answer.", "hint": "#### Constraints and Conventions\n\n- For $30\\%$ of the testdata, it is guaranteed that $n \\leq 100$, $m \\leq 10^3$.\n- For $97\\%$ of the testdata, it is guaranteed that $n \\leq 500$, $m \\leq 10^5$.\n- For $100\\%$ of the testdata, it is guaranteed that $1 \\leq n \\leq 5 \\times 10^4$, $1 \\leq m \\leq 2 \\times 10^5$, $1 \\leq u, v \\leq n$, $1 \\leq w \\leq 10^4$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "最小差值生成树", "background": "", "description": "给定一个点标号从 $1$ 到 $n$ 的、有 $m$ 条边的无向图，求边权最大值与最小值的差值最小的生成树。图可能存在自环。", "inputFormat": "第一行有两个整数，表示图的点数 $n$ 和边数 $m$。\n\n接下来 $m$ 行，每行三个整数 $u, v, w$，表示存在一条连接 $u, v$ 长度为 $w$ 的边。", "outputFormat": "输出一行一个整数，表示答案。\n", "hint": "#### 数据规模与约定\n\n- 对于 $30\\%$ 的数据，保证 $n \\leq 100$，$m \\leq 10^3$。\n- 对于 $97\\%$ 的数据，保证 $n \\leq 500$，$m \\leq 10^5$。\n- 对于 $100\\%$ 的数据，保证 $1 \\leq n \\leq 5 \\times 10^4$，$1 \\leq m \\leq 2 \\times 10^5$，$1 \\leq u, v \\leq n$，$1 \\leq w \\leq 10^4$。", "locale": "zh-CN"}}}
{"pid": "P4235", "type": "P", "difficulty": 6, "samples": [["2 2\naa\naa", "32770\n"], ["3 6\ni\ndont\nknow\nwhat\nto\nsay", "58261\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 4500, 4500, 4500, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [192000, 192000, 192000, 192000, 192000, 192000, 192000, 192000, 192000, 192000, 192000, 192000, 192000, 192000, 192000, 192000, 192000, 192000]}, "tags": ["字符串", "O2优化", "哈希 hashing", "概率论"], "title": "Hash?", "background": "**zhoutb2333**学习了哈希算法，他于是去统计给定一些字符串，其中有多少个本质不同的字符串。\n\n\n但是**zhoutb2333**突发奇想，如果哈希采用的$base$每次随机，那么结果会变成什么样呢？\n\n**辣鸡出题人又出锅了！subtask3的数据有问题，现在统一将模数改为65537**\n\n题目来源：[zhoutb2333](https://www.luogu.org/space/show?uid=31564)", "description": "他通过某种办法，获得了一个函数：`int Rand(int x)`，它会等概率地返回一个 $[0,x)$ 中的整数。\n\n他写下了这样的代码：\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\ntypedef long long ll;\nconst int x=10,maxn=35,maxlen=16010;\nll HASH[maxn];\nconst ll p=65537;\nchar str[maxlen];\nll Hash(){\n    int base=Rand(x);\n    ll ret=0;\n    for(int i=1;str[i];i++)\n        ret=(ret*base+str[i]-'a'+1)%p;\n    return ret;\n}\nint main(){\n    int ans=0,n;\n    scanf(\"%d\",&n);\n    for(int i=1;i<=n;i++)\n        scanf(\"%s\",str+1),HASH[i]=Hash();\n    sort(HASH+1,HASH+n+1);\n    HASH[0]=-1;\n    for(int i=1;i<=n;i++)\n        ans+=(HASH[i]!=HASH[i-1]);\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n```\n\n**zhoutb2333** 想问你，给定一些字符串和参数 $x$，答案 $ans$ 的期望是多少呢？\n\n$65537= 2^{16}+1$ **是质数**\n\n**参数 $x$ 在这个程序中是确定的 $10$，但是每次输入会给定。**", "inputFormat": "第一行三个整数 $x,N$，表示 $base$ 生成的参数和字符串的个数\n\n接下来 $N$ 行每行一个字符串，字符串仅由小写字母组成。", "outputFormat": "一行一个小数，表示答案 $ans$ 的期望，**模 $65537$ 输出**。\n\n即：如果你的答案为 $\\frac{q}{p}$（$\\gcd (p,q)=1$），那么输出使得 $px \\equiv q \\pmod {65537}$ 的最小正整数 $x$。可以证明答案 $ans$ 一定为正有理数，并且这样的 $x$ 一定存在。", "hint": "本题由 $3$ 个 $\\text{subtask}$ 组成，设 $M$ 为这 $N$ 个字符串中，每个字符串长度的最大值。\n\n对于 $\\text{subtask} \\ 1$：$1 \\le N \\le 8 , M \\le 10,x \\le 4$，分值为 $20$，时间限制为 $1s$。\n\n对于 $\\text{subtask} \\ 2$：$1 \\le N \\le 30 , M \\le 500,x \\le 500$，分值为 $50$，时间限制为 $1s$。\n\n对于 $\\text{subtask} \\ 3$：$1 \\le N \\le 5 , M \\le 16000,x \\le 16000$，分值为 $30$，时间限制为 $4.5s$。\n\n**样例 #1 解释：**\n\n参数 $x=2$，那么可能的哈希 $base$ 为 $0,1$。\n\n如果哈希第一个 `aa` 采用的 $base$ 和第二个 `aa` 的 $base$ 相同，那么答案为 $1$。\n\n如果两个 $base$ 不相同，那么答案为 $2$。\n\n分析发现这两种情况发生的概率相同，都是 $\\frac{1}{2}$，那么答案 $ans$ 的期望为 $1 * \\frac{1}{2} + 2 * \\frac{1}{2}=\\frac{3}{2}$。使得 $2x \\equiv 3 \\ \\pmod {65537}$ 的最小正整数 $x$ 为 $32770$。\n\n**样例 #2 解释：**\n\n求得答案为 $\\frac{53}{9}$。使得 $9x \\equiv 53 \\ \\pmod {65537}$ 的最小正整数 $x$ 为 $58261$。", "locale": "zh-CN", "translations": {"en": {"title": "Hash?", "background": "zhoutb2333 learned hashing and decided to count how many essentially different strings there are among some given strings.\n\nBut then zhoutb2333 had a sudden idea: if the hashing $base$ is chosen randomly each time, what will the result look like?\n\nThe lousy problem setter broke it again! The testdata for subtask 3 had an issue, so the modulus is now uniformly changed to $65537$.\n\nProblem source: [zhoutb2333](https://www.luogu.org/space/show?uid=31564).", "description": "By some means, he obtained a function: `int Rand(int x)`, which returns an integer uniformly at random from $[0, x)$.\n\nHe wrote the following code:\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\ntypedef long long ll;\nconst int x=10,maxn=35,maxlen=16010;\nll HASH[maxn];\nconst ll p=65537;\nchar str[maxlen];\nll Hash(){\n    int base=Rand(x);\n    ll ret=0;\n    for(int i=1;str[i];i++)\n        ret=(ret*base+str[i]-'a'+1)%p;\n    return ret;\n}\nint main(){\n    int ans=0,n;\n    scanf(\"%d\",&n);\n    for(int i=1;i<=n;i++)\n        scanf(\"%s\",str+1),HASH[i]=Hash();\n    sort(HASH+1,HASH+n+1);\n    HASH[0]=-1;\n    for(int i=1;i<=n;i++)\n        ans+=(HASH[i]!=HASH[i-1]);\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n```\n\nzhoutb2333 asks: given some strings and the parameter $x$, what is the expectation of the answer $ans$?\n\n$65537 = 2^{16} + 1$ is prime.\n\nThe parameter $x$ is fixed to $10$ in this program, but it will be provided in each input.", "inputFormat": "The first line contains two integers $x, N$, denoting the parameter that generates the $base$ and the number of strings.\n\nThe next $N$ lines each contain one string, consisting only of lowercase letters.", "outputFormat": "Output a single number on one line: the expectation of $ans$, output modulo $65537$.\n\nThat is, if your answer is $\\frac{q}{p}$ ($\\gcd(p, q) = 1$), then output the smallest positive integer $x$ such that $p x \\equiv q \\pmod{65537}$. It can be proved that the answer $ans$ is always a positive rational number, and such an $x$ always exists.", "hint": "This problem has $3$ $\\text{subtask}$s. Let $M$ be the maximum length among these $N$ strings.\n\nFor $\\text{subtask} \\ 1$: $1 \\le N \\le 8, \\ M \\le 10, \\ x \\le 4$, score $20$, time limit $1 \\ \\text{s}$.\n\nFor $\\text{subtask} \\ 2$: $1 \\le N \\le 30, \\ M \\le 500, \\ x \\le 500$, score $50$, time limit $1 \\ \\text{s}$.\n\nFor $\\text{subtask} \\ 3$: $1 \\le N \\le 5, \\ M \\le 16000, \\ x \\le 16000$, score $30$, time limit $4.5 \\ \\text{s}$.\n\nSample #1 explanation:\n\nWith parameter $x = 2$, the possible hash $base$ values are $0, 1$.\n\nIf the first `aa` and the second `aa` use the same $base$ for hashing, then the answer is $1$.\nIf the two $base$ values are different, then the answer is $2$.\n\nThese two cases happen with the same probability, both $\\frac{1}{2}$, so the expectation of $ans$ is $1 * \\frac{1}{2} + 2 * \\frac{1}{2} = \\frac{3}{2}$. The smallest positive integer $x$ such that $2 x \\equiv 3 \\ \\pmod{65537}$ is $32770$.\n\nSample #2 explanation:\n\nThe answer is $\\frac{53}{9}$. The smallest positive integer $x$ such that $9 x \\equiv 53 \\ \\pmod{65537}$ is $58261$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "Hash?", "background": "**zhoutb2333**学习了哈希算法，他于是去统计给定一些字符串，其中有多少个本质不同的字符串。\n\n\n但是**zhoutb2333**突发奇想，如果哈希采用的$base$每次随机，那么结果会变成什么样呢？\n\n**辣鸡出题人又出锅了！subtask3的数据有问题，现在统一将模数改为65537**\n\n题目来源：[zhoutb2333](https://www.luogu.org/space/show?uid=31564)", "description": "他通过某种办法，获得了一个函数：`int Rand(int x)`，它会等概率地返回一个 $[0,x)$ 中的整数。\n\n他写下了这样的代码：\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\ntypedef long long ll;\nconst int x=10,maxn=35,maxlen=16010;\nll HASH[maxn];\nconst ll p=65537;\nchar str[maxlen];\nll Hash(){\n    int base=Rand(x);\n    ll ret=0;\n    for(int i=1;str[i];i++)\n        ret=(ret*base+str[i]-'a'+1)%p;\n    return ret;\n}\nint main(){\n    int ans=0,n;\n    scanf(\"%d\",&n);\n    for(int i=1;i<=n;i++)\n        scanf(\"%s\",str+1),HASH[i]=Hash();\n    sort(HASH+1,HASH+n+1);\n    HASH[0]=-1;\n    for(int i=1;i<=n;i++)\n        ans+=(HASH[i]!=HASH[i-1]);\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n```\n\n**zhoutb2333** 想问你，给定一些字符串和参数 $x$，答案 $ans$ 的期望是多少呢？\n\n$65537= 2^{16}+1$ **是质数**\n\n**参数 $x$ 在这个程序中是确定的 $10$，但是每次输入会给定。**", "inputFormat": "第一行三个整数 $x,N$，表示 $base$ 生成的参数和字符串的个数\n\n接下来 $N$ 行每行一个字符串，字符串仅由小写字母组成。", "outputFormat": "一行一个小数，表示答案 $ans$ 的期望，**模 $65537$ 输出**。\n\n即：如果你的答案为 $\\frac{q}{p}$（$\\gcd (p,q)=1$），那么输出使得 $px \\equiv q \\pmod {65537}$ 的最小正整数 $x$。可以证明答案 $ans$ 一定为正有理数，并且这样的 $x$ 一定存在。", "hint": "本题由 $3$ 个 $\\text{subtask}$ 组成，设 $M$ 为这 $N$ 个字符串中，每个字符串长度的最大值。\n\n对于 $\\text{subtask} \\ 1$：$1 \\le N \\le 8 , M \\le 10,x \\le 4$，分值为 $20$，时间限制为 $1s$。\n\n对于 $\\text{subtask} \\ 2$：$1 \\le N \\le 30 , M \\le 500,x \\le 500$，分值为 $50$，时间限制为 $1s$。\n\n对于 $\\text{subtask} \\ 3$：$1 \\le N \\le 5 , M \\le 16000,x \\le 16000$，分值为 $30$，时间限制为 $4.5s$。\n\n**样例 #1 解释：**\n\n参数 $x=2$，那么可能的哈希 $base$ 为 $0,1$。\n\n如果哈希第一个 `aa` 采用的 $base$ 和第二个 `aa` 的 $base$ 相同，那么答案为 $1$。\n\n如果两个 $base$ 不相同，那么答案为 $2$。\n\n分析发现这两种情况发生的概率相同，都是 $\\frac{1}{2}$，那么答案 $ans$ 的期望为 $1 * \\frac{1}{2} + 2 * \\frac{1}{2}=\\frac{3}{2}$。使得 $2x \\equiv 3 \\ \\pmod {65537}$ 的最小正整数 $x$ 为 $32770$。\n\n**样例 #2 解释：**\n\n求得答案为 $\\frac{53}{9}$。使得 $9x \\equiv 53 \\ \\pmod {65537}$ 的最小正整数 $x$ 为 $58261$。", "locale": "zh-CN"}}}
{"pid": "P4236", "type": "P", "difficulty": 5, "samples": [["3\n2 5\n2 9\n3 9", "lsq Win\nwzt Win\nlsq Win"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["进制"], "title": "扑克", "background": "lsq邀请wzt去他家打扑克牌", "description": "lsq的扑克没有大小王，共计有n张，由于wzt沉迷于幂运算无法自拔，wzt提出要每次抽a^2张牌（这里“^”是乘方的意思），lsq觉得这样抽真没意思，于是改成了每次抽a^k（k是一个自然数，由游戏者自由选择）张牌。**由lsq开始**，每个人轮流按上述规则摸牌，谁先摸到最后一张牌谁就赢。\n\n由于时间充裕，lsq和wzt一共会玩q盘游戏，每一盘都有不同的a和n。wzt怒敲了一波代码，竟然可以算出当确定了a和n的值后，若能必胜如何下。lsq在见识过你的~~毒瘤~~操作后，希望你也帮他写出一个程序，能判断确定了a和n的值后他是否能赢，lsq当然知道怎么下最优，所以不需要你算出如何下 \n\n**注意：此题中两方的打牌决策都是若有必胜决策则必用必胜决策**\n\n此题中k是一个每次抽牌都可由抽牌者自己决定的一个非负整数，可以结合下面的样例加以理解", "inputFormat": "第一行一个数q， 表示有q局游戏\n接下来q行，每行两个整数a,n，意义如上", "outputFormat": "输出共q行\n若lsq能赢，输出“lsq Win”\n若wzt能赢，输出“wzt Win”", "hint": "对于30%的数据，满足q<=30，a<=30，n<=1e8\n\n对于50%的数据，满足q<=50，a<=30，n<=1e12\n\n对于100%的数据，满足q<=50000，a<=20000，n<=1e500\n\n样例一解释：\n询问1：lsq必胜，lsq先抽2^1=2，接下来无论wzt抽2^1=2或2^0=1，lsq只要把牌抽完；其他抽法同上（只是顺序不同）\n\n询问2：wzt必胜，若lsq先抽2^0=1，则wzt抽2^3=8；若lsq先抽2^1=2，则wzt抽2^2=4，接下来无论lsq抽2^1=2或2^0=1，wzt只要把牌抽完；其他抽法同上（只是顺序不同）\n\n询问3：lsq必胜，lsq只需拿走3^2=9即可\n\nBy [Broadway](https://www.luogu.org/space/show?uid=33509)", "locale": "zh-CN", "translations": {"en": {"title": "Poker", "background": "lsq invites wzt to his home to play poker.", "description": "lsq’s deck has no Jokers and contains a total of $n$ cards. Since wzt is obsessed with exponentiation, he first proposed drawing $a^2$ cards each time (here “^” denotes exponentiation). lsq found that boring, so they changed the rule to drawing $a^k$ cards each time, where $k$ is a non-negative integer freely chosen by the player on their turn. lsq starts first, and the two players take turns drawing cards according to the rule. Whoever draws the last card wins.\n\nSince they have plenty of time, lsq and wzt will play $q$ games in total, each with different $a$ and $n$. wzt banged out some code and can compute the winning strategy once $a$ and $n$ are fixed. After seeing your “operations,” lsq hopes you can also write a program to determine whether he can win given $a$ and $n$. Since lsq knows how to play optimally, you do not need to output the specific moves.\n\nNote: In this problem, both players always choose a winning move whenever one exists.\n\nHere $k$ is a non-negative integer that the player drawing the cards can decide on each turn. You can refer to the sample below for understanding.", "inputFormat": "The first line contains one integer $q$, indicating there are $q$ games.  \nThe next $q$ lines each contain two integers $a$, $n$, as defined above.", "outputFormat": "Output $q$ lines.  \nIf lsq can win, output \"lsq Win\".  \nIf wzt can win, output \"wzt Win\".", "hint": "Constraints:\n- For 30% of the testdata, $q \\le 30$, $a \\le 30$, $n \\le 10^8$.\n- For 50% of the testdata, $q \\le 50$, $a \\le 30$, $n \\le 10^{12}$.\n- For 100% of the testdata, $q \\le 50000$, $a \\le 20000$, $n \\le 10^{500}$.\n\nExplanation for Sample 1:\n- Query 1: lsq is guaranteed to win. lsq first draws $2^1 = 2$. Afterwards, no matter whether wzt draws $2^1 = 2$ or $2^0 = 1$, lsq can take all the remaining cards. Other draw orders are similar (just a different order).\n- Query 2: wzt is guaranteed to win. If lsq first draws $2^0 = 1$, then wzt draws $2^3 = 8$. If lsq first draws $2^1 = 2$, then wzt draws $2^2 = 4$. Afterwards, no matter whether lsq draws $2^1 = 2$ or $2^0 = 1$, wzt can take all the remaining cards. Other draw orders are similar (just a different order).\n- Query 3: lsq is guaranteed to win; he only needs to take $3^2 = 9$.\n\nBy [Broadway](https://www.luogu.org/space/show?uid=33509)\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "扑克", "background": "lsq邀请wzt去他家打扑克牌", "description": "lsq的扑克没有大小王，共计有n张，由于wzt沉迷于幂运算无法自拔，wzt提出要每次抽a^2张牌（这里“^”是乘方的意思），lsq觉得这样抽真没意思，于是改成了每次抽a^k（k是一个自然数，由游戏者自由选择）张牌。**由lsq开始**，每个人轮流按上述规则摸牌，谁先摸到最后一张牌谁就赢。\n\n由于时间充裕，lsq和wzt一共会玩q盘游戏，每一盘都有不同的a和n。wzt怒敲了一波代码，竟然可以算出当确定了a和n的值后，若能必胜如何下。lsq在见识过你的~~毒瘤~~操作后，希望你也帮他写出一个程序，能判断确定了a和n的值后他是否能赢，lsq当然知道怎么下最优，所以不需要你算出如何下 \n\n**注意：此题中两方的打牌决策都是若有必胜决策则必用必胜决策**\n\n此题中k是一个每次抽牌都可由抽牌者自己决定的一个非负整数，可以结合下面的样例加以理解", "inputFormat": "第一行一个数q， 表示有q局游戏\n接下来q行，每行两个整数a,n，意义如上", "outputFormat": "输出共q行\n若lsq能赢，输出“lsq Win”\n若wzt能赢，输出“wzt Win”", "hint": "对于30%的数据，满足q<=30，a<=30，n<=1e8\n\n对于50%的数据，满足q<=50，a<=30，n<=1e12\n\n对于100%的数据，满足q<=50000，a<=20000，n<=1e500\n\n样例一解释：\n询问1：lsq必胜，lsq先抽2^1=2，接下来无论wzt抽2^1=2或2^0=1，lsq只要把牌抽完；其他抽法同上（只是顺序不同）\n\n询问2：wzt必胜，若lsq先抽2^0=1，则wzt抽2^3=8；若lsq先抽2^1=2，则wzt抽2^2=4，接下来无论lsq抽2^1=2或2^0=1，wzt只要把牌抽完；其他抽法同上（只是顺序不同）\n\n询问3：lsq必胜，lsq只需拿走3^2=9即可\n\nBy [Broadway](https://www.luogu.org/space/show?uid=33509)", "locale": "zh-CN"}}}
{"pid": "P4237", "type": "P", "difficulty": 6, "samples": [["4 6 3 2\n16 37 22 24 \n1 4 25\n1 1 23\n4 1 20\n3 1 47\n1 1 18\n3 3 24\n213 1\n174 2\n62 4\n1493 3\n2632 4", "Yes\n3741"], ["4 2 3 2\n16 37 22 24\n1 4 25\n1 3 12\n213 1\n174 3\n62 4\n1493 2\n2632 4", "No\n1"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["最短路"], "title": "荒芜的海洋", "background": "在一个渺远的海洋中，一场世纪大战级别的游戏上演了。\n\n感谢 [lsq](https://www.luogu.org/space/show?uid=26556) 本人参与验题", "description": "这块海洋上有n个小岛，小岛有m座石桥相连。有一些小岛上有wzt埋下的奖赏，它们非常诱人。它们的诱惑力用整数ki描述。而一些小岛上有lsq的雇佣兵，他们有一个价格，用整数bi描述。lsq必须花钱，他的雇佣兵才会帮他寻找奖赏。 \n\n雇佣兵的价格并不会变。对于每一个雇佣兵，在寻找过程中，他会越过一座座的桥，这过程中，他的价格会 **加上他所经过的所有桥的长度** 。\n\n遗憾的是，不只有桥的阻挡，每座岛上有许多猛兽，虽然雇佣兵们都英勇无比，但驱逐猛兽的过程会让人很不爽。因此，对于每一个雇佣兵，价格会 **加上他所经过的所有岛（包括出发岛）上的猛兽数量之和**。\n\nlsq了解这里的一切情况，他需要做出决策，即决定他的每个雇佣兵应该去找哪个奖赏。lsq的目的是找到所有奖赏，并取得最大收益。每个雇佣兵只能雇佣一次。\n\n收益的定义为： **所有奖赏的诱惑力减去lsq花的所有的钱**\n\nlsq的决策异常艰难，于是只好请 ~~AK过NOI~~ 的你来帮忙。", "inputFormat": "第一行4个数，n（小岛总数）,m（桥总数）,a（lsq的雇佣兵总人数）,b（奖赏总数）\n\n接下来一行n个数，表示每个小岛上的猛兽数量\n\n接下来m行，每行三个数u,v,w，表示u号小岛与v号小岛之间有一座长度为w的桥相连\n\n接下来a行，每行两个数qi,pi，表示i号雇佣兵价格为qi，初始位置为pi号小岛\n\n接下来b行，每行两个数ki,qi，表示i号奖赏的诱惑力为ki，位置为qi号小岛", "outputFormat": "如果能找到所有奖赏，输出“Yes”，并在下一行输出能达到的最大满意度。\n\n如果不能找到所有奖赏，输出“No”，并在下一行输出最多能找到多少奖赏。", "hint": "对于30% 的数据，满足n<=200，m<=200，b<=a<=30\n\n对于50% 的数据，满足n<=500，m<=800，b<=a<=100\n\n对于100% 的数据，满足n<=1000，m<=15000，b<=a<=300，其余数据保证不会爆int(Pascal语言为longint)\n\n![](https://cdn.luogu.com.cn/upload/pic/14497.png)\n![](https://cdn.luogu.com.cn/upload/pic/14498.png)\n\nBy [Ebola](https://www.luogu.org/space/show?uid=20158)", "locale": "zh-CN", "translations": {"en": {"title": "Desolate Ocean", "background": "In a distant ocean, a game at the level of a century-defining war is being played.\n\nThanks to [lsq](https://www.luogu.org/space/show?uid=26556) for participating in problem testing.", "description": "There are $n$ small islands on this ocean, connected by $m$ stone bridges. Some islands have rewards buried by wzt; they are very tempting. Their temptation is described by an integer $k_i$. Some islands have lsq’s mercenaries, each with a price described by an integer $b_i$. lsq must pay money for his mercenaries to help him search for rewards.\n\nA mercenary’s base price does not change. During the search, for each mercenary, as he crosses bridges, his total cost will increase by the sum of the lengths of all bridges he passes. Unfortunately, there are not only bridges blocking the way; each island has many beasts. Although the mercenaries are brave, driving away beasts is unpleasant. Therefore, for each mercenary, his total cost will also increase by the sum of the numbers of beasts on all islands he passes through (including the starting island).\n\nlsq knows everything about the situation and must decide which reward each of his mercenaries should go for. The goal is to find all rewards and achieve maximum profit. Each mercenary can be hired at most once.\n\nProfit is defined as: the sum of the temptation values of all rewards minus all the money lsq spends.\n\nlsq’s decision is extremely difficult, so he asks you for help.", "inputFormat": "The first line contains four integers: $n$ (total number of islands), $m$ (total number of bridges), $a$ (total number of lsq’s mercenaries), $b$ (total number of rewards).\n\nThe next line contains $n$ integers, the number of beasts on each island.\n\nThe next $m$ lines, each with three integers $u, v, w$, indicate that there is a bridge of length $w$ connecting island $u$ and island $v$.\n\nThe next $a$ lines, each with two integers $q_i, p_i$, indicate that the $i$-th mercenary has base price $q_i$ and initial position at island $p_i$.\n\nThe next $b$ lines, each with two integers $k_i, q_i$, indicate that the $i$-th reward has temptation $k_i$ and is located at island $q_i$.", "outputFormat": "If all rewards can be found, output \"Yes\", and on the next line output the maximum profit.\n\nIf not all rewards can be found, output \"No\", and on the next line output the maximum number of rewards that can be found.", "hint": "Constraints:\n- For 30% of the testdata, $n \\le 200$, $m \\le 200$, $b \\le a \\le 30$.\n- For 50% of the testdata, $n \\le 500$, $m \\le 800$, $b \\le a \\le 100$.\n- For 100% of the testdata, $n \\le 1000$, $m \\le 15000$, $b \\le a \\le 300$. The rest of the testdata guarantees no 32-bit signed int overflow (Pascal: longint).\n\n![](https://cdn.luogu.com.cn/upload/pic/14497.png)\n![](https://cdn.luogu.com.cn/upload/pic/14498.png)\n\nBy [Ebola](https://www.luogu.org/space/show?uid=20158).\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "荒芜的海洋", "background": "在一个渺远的海洋中，一场世纪大战级别的游戏上演了。\n\n感谢 [lsq](https://www.luogu.org/space/show?uid=26556) 本人参与验题", "description": "这块海洋上有n个小岛，小岛有m座石桥相连。有一些小岛上有wzt埋下的奖赏，它们非常诱人。它们的诱惑力用整数ki描述。而一些小岛上有lsq的雇佣兵，他们有一个价格，用整数bi描述。lsq必须花钱，他的雇佣兵才会帮他寻找奖赏。 \n\n雇佣兵的价格并不会变。对于每一个雇佣兵，在寻找过程中，他会越过一座座的桥，这过程中，他的价格会 **加上他所经过的所有桥的长度** 。\n\n遗憾的是，不只有桥的阻挡，每座岛上有许多猛兽，虽然雇佣兵们都英勇无比，但驱逐猛兽的过程会让人很不爽。因此，对于每一个雇佣兵，价格会 **加上他所经过的所有岛（包括出发岛）上的猛兽数量之和**。\n\nlsq了解这里的一切情况，他需要做出决策，即决定他的每个雇佣兵应该去找哪个奖赏。lsq的目的是找到所有奖赏，并取得最大收益。每个雇佣兵只能雇佣一次。\n\n收益的定义为： **所有奖赏的诱惑力减去lsq花的所有的钱**\n\nlsq的决策异常艰难，于是只好请 ~~AK过NOI~~ 的你来帮忙。", "inputFormat": "第一行4个数，n（小岛总数）,m（桥总数）,a（lsq的雇佣兵总人数）,b（奖赏总数）\n\n接下来一行n个数，表示每个小岛上的猛兽数量\n\n接下来m行，每行三个数u,v,w，表示u号小岛与v号小岛之间有一座长度为w的桥相连\n\n接下来a行，每行两个数qi,pi，表示i号雇佣兵价格为qi，初始位置为pi号小岛\n\n接下来b行，每行两个数ki,qi，表示i号奖赏的诱惑力为ki，位置为qi号小岛", "outputFormat": "如果能找到所有奖赏，输出“Yes”，并在下一行输出能达到的最大满意度。\n\n如果不能找到所有奖赏，输出“No”，并在下一行输出最多能找到多少奖赏。", "hint": "对于30% 的数据，满足n<=200，m<=200，b<=a<=30\n\n对于50% 的数据，满足n<=500，m<=800，b<=a<=100\n\n对于100% 的数据，满足n<=1000，m<=15000，b<=a<=300，其余数据保证不会爆int(Pascal语言为longint)\n\n![](https://cdn.luogu.com.cn/upload/pic/14497.png)\n![](https://cdn.luogu.com.cn/upload/pic/14498.png)\n\nBy [Ebola](https://www.luogu.org/space/show?uid=20158)", "locale": "zh-CN"}}}
{"pid": "P4238", "type": "P", "difficulty": 6, "samples": [["5\n1 6 3 4 9", "1 998244347 33 998244169 1020"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["数学", "递推", "倍增", "递归", "逆元", "快速傅里叶变换 FFT", "快速数论变换 NTT", "模板题"], "title": "【模板】多项式乘法逆", "background": "注意：本题并不属于中国计算机学会划定的提高组知识点考察范围。", "description": "给定一个多项式 $F(x)$ ，请求出一个多项式 $G(x)$， 满足 $F(x) * G(x) \\equiv 1 \\pmod{x^n}$。系数对 $998244353$ 取模。\n\n", "inputFormat": "首先输入一个整数 $n$， 表示输入多项式的项数。  \n接着输入 $n$ 个整数，第 $i$ 个整数 $a_i$ 代表 $F(x)$ 次数为 $i-1$ 的项的系数。  ", "outputFormat": "输出 $n$ 个数字，第 $i$ 个整数 $b_i$ 代表 $G(x)$ 次数为 $i-1$ 的项的系数。保证有解。", "hint": "对于 $100\\%$ 的数据，$1 \\leq n \\leq 10^5$，$ 0 \\leq a_i \\leq 10^9$。", "locale": "zh-CN", "translations": {"en": {"title": "{{[Template] Polynomial Multiplicative Inverse}}", "background": "{{Note: This problem is not within the knowledge points designated by the China Computer Federation (CCF) for the Senior track.}}", "description": "{{Given a polynomial $F(x)$, find a polynomial $G(x)$ such that $F(x) * G(x) \\equiv 1 \\pmod{x^n}$. Coefficients are taken modulo 998244353.}}", "inputFormat": "{{First, input an integer $n$, indicating the number of terms of the input polynomial.  \nThen input $n$ integers; the $i$-th integer $a_i$ denotes the coefficient of the term of $F(x)$ with degree $i-1$.}}", "outputFormat": "{{Output $n$ integers; the $i$-th integer $b_i$ denotes the coefficient of the term of $G(x)$ with degree $i-1$. It is guaranteed that a solution exists.}}", "hint": "{{For $100\\%$ of the testdata, $1 \\leq n \\leq 10^5$, $0 \\leq a_i \\leq 10^9$.}}\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】多项式乘法逆", "background": "注意：本题并不属于中国计算机学会划定的提高组知识点考察范围。", "description": "给定一个多项式 $F(x)$ ，请求出一个多项式 $G(x)$， 满足 $F(x) * G(x) \\equiv 1 \\pmod{x^n}$。系数对 $998244353$ 取模。\n\n", "inputFormat": "首先输入一个整数 $n$， 表示输入多项式的项数。  \n接着输入 $n$ 个整数，第 $i$ 个整数 $a_i$ 代表 $F(x)$ 次数为 $i-1$ 的项的系数。  ", "outputFormat": "输出 $n$ 个数字，第 $i$ 个整数 $b_i$ 代表 $G(x)$ 次数为 $i-1$ 的项的系数。保证有解。", "hint": "对于 $100\\%$ 的数据，$1 \\leq n \\leq 10^5$，$ 0 \\leq a_i \\leq 10^9$。", "locale": "zh-CN"}}}
