{"pid": "P3816", "type": "P", "difficulty": 6, "samples": [["1\n2\n3\n0", "1\n3\n5\n0"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000, 256000]}, "tags": ["字符串", "动态规划 DP", "2017", "各省省选", "福建", "枚举"], "title": "[FJOI2017] 树的平均路长问题", "background": "", "description": "一棵树 $T$ 的平均路长 $IPL(T)$定义为：\n\n$IPL(T)=\\sum_{v\\varepsilon T}length(path(v))$\n\n其中， $v$ 是树 $T$ 中的内结点， $length(path(v))$是从树根到结点$v$的路径长度。\n\n红黑树是一类特殊的二叉搜索树，其中每个结点被“染成”红色或黑色。若将二叉搜索树结点中的空指针看作是指向一个空结点，则称这类空结点为二叉搜索树的前端结点。并规定所有前端结点的高度为$-1$。除了前端结点外，其他结点均为内结点。\n\n一棵红黑树是满足下面“红黑性质”染色二叉搜索树：\n\n1. 每个结点被染成红色或黑色；\n\n2. 每个前端结点为黑色结点；\n\n3. 任一红结点的儿子结点均为黑结点；\n\n4. 在从任一结点到其子孙前端结点的所有路径上具有相同的黑结点数。\n\n从红黑树中任一结点 $x$ 出发(不包括结点 $x$)，到达一个前端结点的任意一条路径上的黑结点个数称为结点 $x$ 的黑高度，记作 $bh(x)$。红黑树的黑高度定义为其根结点的黑高度。\n\n给定正整数 $n$，试设计一个算法，计算出在所有含有 $n$ 个结点的红黑树中，平均路长的最大值。\n", "inputFormat": "文件有多个测试项。每行有1个正整数$n$， ($1\\le n\\le 30000$)，表示红黑树的结点数。文件最后以一个$0$结束。\n", "outputFormat": "对每行中红黑树的结点数 $n$，将计算出的平均路长的最大值输出到文件中。\n\n每行输出一个最大值。 文件最后以一个$0$ 结束。\n", "hint": "", "locale": "zh-CN", "translations": {"en": {"title": "[FJOI2017] Average Path Length of a Tree", "background": "", "description": "The internal path length $IPL(T)$ of a tree $T$ is defined as:\n$$IPL(T)=\\sum_{v\\in T} length(path(v)),$$\nwhere $v$ ranges over the internal nodes of $T$, and $length(path(v))$ is the length of the path from the root to node $v$.\n\nA red-black tree is a special binary search tree in which each node is colored red or black. If we regard null pointers in a binary search tree as pointing to an empty node, we call these empty nodes the external nodes of the BST. We stipulate that all external nodes have height $-1$. All nodes other than external nodes are internal nodes.\n\nA red-black tree is a colored binary search tree that satisfies the following red-black properties:\n1. Every node is either red or black.\n2. Every external node is black.\n3. The children of any red node are black.\n4. Every path from any node to its descendant external nodes contains the same number of black nodes.\n\nFor any node $x$ in a red-black tree, the number of black nodes on any path from $x$ (excluding $x$) down to an external node is called the black height of node $x$, denoted $bh(x)$. The black height of a red-black tree is the black height of its root.\n\nGiven a positive integer $n$, design an algorithm to compute, among all red-black trees with $n$ nodes, the maximum possible internal path length.", "inputFormat": "Multiple test cases. Each line contains a single positive integer $n$ ($1\\le n\\le 30000$), which is the number of nodes in the red-black tree. The input is terminated by a line containing a single $0$.", "outputFormat": "For each given $n$, output the maximum internal path length on a separate line. Do not output any extra content.", "hint": "\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[FJOI2017] 树的平均路长问题", "background": "", "description": "一棵树 $T$ 的平均路长 $IPL(T)$定义为：\n\n$IPL(T)=\\sum_{v\\varepsilon T}length(path(v))$\n\n其中， $v$ 是树 $T$ 中的内结点， $length(path(v))$是从树根到结点$v$的路径长度。\n\n红黑树是一类特殊的二叉搜索树，其中每个结点被“染成”红色或黑色。若将二叉搜索树结点中的空指针看作是指向一个空结点，则称这类空结点为二叉搜索树的前端结点。并规定所有前端结点的高度为$-1$。除了前端结点外，其他结点均为内结点。\n\n一棵红黑树是满足下面“红黑性质”染色二叉搜索树：\n\n1. 每个结点被染成红色或黑色；\n\n2. 每个前端结点为黑色结点；\n\n3. 任一红结点的儿子结点均为黑结点；\n\n4. 在从任一结点到其子孙前端结点的所有路径上具有相同的黑结点数。\n\n从红黑树中任一结点 $x$ 出发(不包括结点 $x$)，到达一个前端结点的任意一条路径上的黑结点个数称为结点 $x$ 的黑高度，记作 $bh(x)$。红黑树的黑高度定义为其根结点的黑高度。\n\n给定正整数 $n$，试设计一个算法，计算出在所有含有 $n$ 个结点的红黑树中，平均路长的最大值。\n", "inputFormat": "文件有多个测试项。每行有1个正整数$n$， ($1\\le n\\le 30000$)，表示红黑树的结点数。文件最后以一个$0$结束。\n", "outputFormat": "对每行中红黑树的结点数 $n$，将计算出的平均路长的最大值输出到文件中。\n\n每行输出一个最大值。 文件最后以一个$0$ 结束。\n", "hint": "", "locale": "zh-CN"}}}
{"pid": "P3817", "type": "P", "difficulty": 2, "samples": [["3 3\n2 2 2", "1\n"], ["6 1\n1 6 1 2 0 4", "11"], ["5 9\n3 1 4 1 5", "0\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["模拟", "贪心", "洛谷月赛"], "title": "小A的糖果", "background": "", "description": "小 A 有 $n$ 个糖果盒，第 $i$ 个盒中有 $a_i$ 颗糖果。\n\n小 A 每次可以从其中一盒糖果中吃掉一颗，他想知道，要让任意两个相邻的盒子中糖的个数之和都不大于 $x$，至少得吃掉几颗糖。\n", "inputFormat": "输入的第一行是两个用空格隔开的整数，代表糖果盒的个数 $n$ 和给定的参数 $x$。\n\n第二行有 $n$ 个用空格隔开的整数，第 $i$ 个整数代表第 $i$ 盒糖的糖果个数 $a_i$。", "outputFormat": "输出一行一个整数，代表最少要吃掉的糖果的数量。", "hint": "#### 样例输入输出 1 解释\n\n吃掉第 2 盒中的一个糖果即可。\n\n---\n\n#### 样例输入输出 2 解释\n\n第 2 盒糖吃掉 $6$ 颗，第 4 盒吃掉 $2$ 颗，第 6 盒吃掉 $3$ 颗。\n\n---\n\n#### 数据规模与约定\n\n- 对于 $30\\%$ 的数据，保证 $n \\leq 20$，$a_i, x \\leq 100$。\n- 对于 $70\\%$ 的数据，保证 $n \\leq 10^3$，$a_i, x \\leq 10^5$。\n- 对于 $100\\%$ 的数据，保证 $2 \\leq n \\leq 10^5$，$0 \\leq a_i, x \\leq 10^9$。", "locale": "zh-CN", "translations": {"en": {"title": "Xiao A's Candies", "background": "", "description": "Xiao A has $n$ candy boxes; the $i$-th box contains $a_i$ candies.\n\nEach time, Xiao A can eat one candy from one box. He wants to know: to make the sum of candies in any two adjacent boxes no greater than $x$, what is the minimum number of candies he must eat.", "inputFormat": "The first line contains two space-separated integers, the number of boxes $n$ and the given parameter $x$.\n\nThe second line contains $n$ space-separated integers; the $i$-th integer is $a_i$, the number of candies in the $i$-th box.", "outputFormat": "Output one line with a single integer, the minimum number of candies to eat.", "hint": "#### Explanation for Sample Input/Output 1\n\nEating one candy from box 2 suffices.\n\n---\n\n#### Explanation for Sample Input/Output 2\n\nEat $6$ from box 2, $2$ from box 4, and $3$ from box 6.\n\n---\n\n#### Constraints\n\n- For $30\\%$ of the testdata, it is guaranteed that $n \\leq 20$ and $a_i, x \\leq 100$.\n- For $70\\%$ of the testdata, it is guaranteed that $n \\leq 10^3$ and $a_i, x \\leq 10^5$.\n- For $100\\%$ of the testdata, it is guaranteed that $2 \\leq n \\leq 10^5$ and $0 \\leq a_i, x \\leq 10^9$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "小A的糖果", "background": "", "description": "小 A 有 $n$ 个糖果盒，第 $i$ 个盒中有 $a_i$ 颗糖果。\n\n小 A 每次可以从其中一盒糖果中吃掉一颗，他想知道，要让任意两个相邻的盒子中糖的个数之和都不大于 $x$，至少得吃掉几颗糖。\n", "inputFormat": "输入的第一行是两个用空格隔开的整数，代表糖果盒的个数 $n$ 和给定的参数 $x$。\n\n第二行有 $n$ 个用空格隔开的整数，第 $i$ 个整数代表第 $i$ 盒糖的糖果个数 $a_i$。", "outputFormat": "输出一行一个整数，代表最少要吃掉的糖果的数量。", "hint": "#### 样例输入输出 1 解释\n\n吃掉第 2 盒中的一个糖果即可。\n\n---\n\n#### 样例输入输出 2 解释\n\n第 2 盒糖吃掉 $6$ 颗，第 4 盒吃掉 $2$ 颗，第 6 盒吃掉 $3$ 颗。\n\n---\n\n#### 数据规模与约定\n\n- 对于 $30\\%$ 的数据，保证 $n \\leq 20$，$a_i, x \\leq 100$。\n- 对于 $70\\%$ 的数据，保证 $n \\leq 10^3$，$a_i, x \\leq 10^5$。\n- 对于 $100\\%$ 的数据，保证 $2 \\leq n \\leq 10^5$，$0 \\leq a_i, x \\leq 10^9$。", "locale": "zh-CN"}}}
{"pid": "P3818", "type": "P", "difficulty": 4, "samples": [["3 6 2 1\n...#..\n..##..\n..#...", "5\n"], ["3 7 2 1\n..#..#.\n.##.##.\n.#..#..", "-1"], ["6 6 -2 0\n.#....\n.#.#..\n.####.\n.#..#.\n.##.#.\n....#.", "21"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["搜索", "广度优先搜索 BFS", "最短路", "洛谷月赛"], "title": "小A和uim之大逃离 II", "background": "话说上回……还是参见 <https://www.luogu.com.cn/problem/P1373> 吧\n\n小 a 和 uim 再次来到雨林中探险。突然一阵南风吹来，一片乌云从南部天边急涌过来，还伴着一道道闪电，一阵阵雷声。刹那间，狂风大作，乌云布满了天空，紧接着豆大的雨点从天空中打落下来，只见前方出现了一个牛头马面的怪物，低沉着声音说：“呵呵，既然你们来到这，两个都别活了！”。小 a 和他的小伙伴再次惊呆了！\n", "description": "瞬间，地面上出现了一个 $H$ 行 $W$ 列的巨幅矩阵，矩阵的每个格子上要么是空地 `.` 或者障碍 `#`。\n\n他们起点在 $(1,1)$，要逃往 $(H,W)$ 的出口。他们可以一次向上下左右移动一格，这个算一步操作。不过他们还保留着上次冒险时收集的魔液，一口气喝掉后可以瞬移到相对自己位置的 $(D,R)$ 向量；也就是说，原来的位置是 $(x,y)$，然后新的位置是 $(x+D,y+R)$，这个也算一步操作，不过他们仅能至多进行一次这种操作（当然可以不喝魔液）。\n\n这个地方是个是非之地。所以他们希望知道最小能有几步操作可以离开这个鬼地方。不过他们可能逃不出这个鬼地方，遇到这种情况，只能等死，别无他法。\n", "inputFormat": "第一行个整数，$H,W,D,R$，意义在描述已经说明。\n\n接下来 $H$ 行，每行长度是 $W$，仅有 `.` 或者 `#` 的字符串。\n", "outputFormat": "请输出一个整数表示最小的逃出操作次数。如果他们逃不出来，就输出 $-1$。\n", "hint": "样例解释 $1$\n\n$(1,1) \\to (1,2)\\to (1,3)\\to$ 喝魔液 $\\to (3,4)\\to (3,5)\\to (3,6)$。\n\n样例解释 $2$\n\n因为只有一瓶魔液所以他们没办法逃出来。\n\n样例解释 $3$\n\n$D$ 和 $R$ 还可以是 $0$或者负数。\n\n数据范围与约定\n\n$40\\%$ 的测试数据 $2\\leq H,W\\leq 5$。\n\n$70\\%$ 的测试数据 $2\\leq H,W\\leq 100$。\n\n$100\\%$ 的测试数据 $2\\leq H,W\\leq 1000,|D|<H,|R|<W$。", "locale": "zh-CN", "translations": {"en": {"title": "Little A and uim's Great Escape II", "background": "As for the last story... please see https://www.luogu.com.cn/problem/P1373.\n\nLittle A and his friend uim venture into the rainforest again. Suddenly, a south wind blows, dark clouds surge from the southern horizon, lightning flashes and thunder rumbles. In an instant, a gale rises, the sky is shrouded in clouds, and soon bean-sized raindrops start to fall. A monster with a bull’s head and a horse’s face appears ahead, growling: “Heh, since you’ve come here, neither of you will leave alive!” Little A and his companion are shocked once again.", "description": "In a flash, a huge matrix of $H$ rows and $W$ columns appears on the ground. Each cell is either empty land `.` or an obstacle `#`.\n\nThey start at $(1, 1)$ and must escape to the exit at $(H, W)$. They can move one cell up, down, left, or right; each such move counts as one operation. They still have the magic potion from their last adventure. If they drink it in one go, they can instantly teleport by the relative vector $(D, R)$; that is, if their current position is $(x, y)$, the new position becomes $(x + D, y + R)$. This also counts as one operation, but they can use this operation at most once (they may also choose not to drink the potion).\n\nThis is a dangerous place. They want to know the minimum number of operations needed to get out. However, it might be impossible to escape; in that case, they can only await their fate.", "inputFormat": "The first line contains four integers $H$, $W$, $D$, $R$, whose meanings are explained in the description.\n\nThe next $H$ lines each contain a string of length $W$, consisting only of `.` and `#`.", "outputFormat": "Output a single integer representing the minimum number of operations needed to escape. If they cannot escape, output $-1$.", "hint": "Sample explanation 1.\n\n$(1, 1) \\to (1, 2) \\to (1, 3) \\to$ drink the magic potion $\\to (3, 4) \\to (3, 5) \\to (3, 6)$.\n\nSample explanation 2.\n\nSince there is only one bottle of magic potion, they cannot escape.\n\nSample explanation 3.\n\n$D$ and $R$ can also be $0$ or negative.\n\nConstraints and Notes.\n\n- For $40\\%$ of the testdata, $2 \\le H, W \\le 5$.\n- For $70\\%$ of the testdata, $2 \\le H, W \\le 100$.\n- For $100\\%$ of the testdata, $2 \\le H, W \\le 1000$, $|D| < H$, $|R| < W$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "小A和uim之大逃离 II", "background": "话说上回……还是参见 <https://www.luogu.com.cn/problem/P1373> 吧\n\n小 a 和 uim 再次来到雨林中探险。突然一阵南风吹来，一片乌云从南部天边急涌过来，还伴着一道道闪电，一阵阵雷声。刹那间，狂风大作，乌云布满了天空，紧接着豆大的雨点从天空中打落下来，只见前方出现了一个牛头马面的怪物，低沉着声音说：“呵呵，既然你们来到这，两个都别活了！”。小 a 和他的小伙伴再次惊呆了！\n", "description": "瞬间，地面上出现了一个 $H$ 行 $W$ 列的巨幅矩阵，矩阵的每个格子上要么是空地 `.` 或者障碍 `#`。\n\n他们起点在 $(1,1)$，要逃往 $(H,W)$ 的出口。他们可以一次向上下左右移动一格，这个算一步操作。不过他们还保留着上次冒险时收集的魔液，一口气喝掉后可以瞬移到相对自己位置的 $(D,R)$ 向量；也就是说，原来的位置是 $(x,y)$，然后新的位置是 $(x+D,y+R)$，这个也算一步操作，不过他们仅能至多进行一次这种操作（当然可以不喝魔液）。\n\n这个地方是个是非之地。所以他们希望知道最小能有几步操作可以离开这个鬼地方。不过他们可能逃不出这个鬼地方，遇到这种情况，只能等死，别无他法。\n", "inputFormat": "第一行个整数，$H,W,D,R$，意义在描述已经说明。\n\n接下来 $H$ 行，每行长度是 $W$，仅有 `.` 或者 `#` 的字符串。\n", "outputFormat": "请输出一个整数表示最小的逃出操作次数。如果他们逃不出来，就输出 $-1$。\n", "hint": "样例解释 $1$\n\n$(1,1) \\to (1,2)\\to (1,3)\\to$ 喝魔液 $\\to (3,4)\\to (3,5)\\to (3,6)$。\n\n样例解释 $2$\n\n因为只有一瓶魔液所以他们没办法逃出来。\n\n样例解释 $3$\n\n$D$ 和 $R$ 还可以是 $0$或者负数。\n\n数据范围与约定\n\n$40\\%$ 的测试数据 $2\\leq H,W\\leq 5$。\n\n$70\\%$ 的测试数据 $2\\leq H,W\\leq 100$。\n\n$100\\%$ 的测试数据 $2\\leq H,W\\leq 1000,|D|<H,|R|<W$。", "locale": "zh-CN"}}}
{"pid": "P3819", "type": "P", "difficulty": 4, "samples": [["100 3\n20 3\n50 2\n70 1\n", "110\n"], ["100 2\n0 1\n100 10\n", "100\n"], ["10000000000 5\n3282894320 391\n4394338332 929\n6932893249 181\n7823822843 440\n9322388365 623\n", "5473201404068\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["模拟", "数学", "前缀和", "洛谷月赛"], "title": "松江 1843 路", "background": "", "description": "涞坊路是一条长 $L$ 米的道路，道路上的坐标范围从 $0$ 到 $L$，路上有 $N$ 座房子，第 $i$ 座房子建在坐标为 $x_i$ 的地方，其中住了 $r_i$ 人。\n\n松江 1843 路公交车要在这条路上建一个公交站，市政府希望让最多的人得到方便，因此希望所有的每一个的居民，从家到车站的距离的**总和**最短。\n\n公交站应该建在哪里呢？", "inputFormat": "第一行输入 $L$、$N$。\n\n接下来 $N$ 行，每行两个整数 $x_i$ 和 $r_i$。", "outputFormat": "一个整数，最小的每个人从家到车站的距离的总和。\n", "hint": "### 样例解释 1\n\n当建在坐标 $40$ 的时候，所有人距离车站的距离总和为 $|20-40| \\times 3+|50-40| \\times 2+|70-40| \\times 1=110$。\n\n### 数据范围和约定\n\n对于 $10\\% $的数据，$1\\le N \\le 50$，$R_i=1$。\n\n对于 $30\\%$ 的数据，$1 \\le N \\le 100$，$R_i \\le 10$，$1 \\le L \\le 1000$。\n\n对于 $70\\%$ 的数据，$1 \\le N \\le 1000$，$R_i \\le 100$，$1 \\le L \\le 10^6$。\n\n对于全部数据，$1 \\le L \\le 10^{10}$，$1 \\le N \\le 10^5$，$0 \\le x_i \\le L$，$1 \\le r_i \\le 1000$。", "locale": "zh-CN", "translations": {"en": {"title": "Songjiang 1843 Road", "background": "", "description": "Laifang Road is a road of length $L$ meters, with coordinates ranging from $0$ to $L$. There are $N$ houses on the road. The $i$-th house is located at coordinate $x_i$ and has $r_i$ residents.\n\nThe Songjiang 1843 Road bus line will build a bus stop on this road. The city government wants to serve as many people as possible, so it hopes to minimize the sum of distances from every resident’s home to the stop.\n\nWhere should the bus stop be built?", "inputFormat": "The first line contains $L$, $N$.\n\nThe next $N$ lines each contain two integers $x_i$ and $r_i$.", "outputFormat": "Output one integer: the minimal sum of distances from all residents’ homes to the bus stop.", "hint": "Sample Explanation 1\n\nWhen the stop is built at coordinate $40$, the sum of distances is $|20-40| \\times 3+|50-40| \\times 2+|70-40| \\times 1=110$.\n\nConstraints\n\n- For $10\\%$ of the testdata, $1 \\le N \\le 50$, $r_i=1$.\n- For $30\\%$ of the testdata, $1 \\le N \\le 100$, $r_i \\le 10$, $1 \\le L \\le 1000$.\n- For $70\\%$ of the testdata, $1 \\le N \\le 1000$, $r_i \\le 100$, $1 \\le L \\le 10^6$.\n- For all testdata, $1 \\le L \\le 10^{10}$, $1 \\le N \\le 10^5$, $0 \\le x_i \\le L$, $1 \\le r_i \\le 1000$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "松江 1843 路", "background": "", "description": "涞坊路是一条长 $L$ 米的道路，道路上的坐标范围从 $0$ 到 $L$，路上有 $N$ 座房子，第 $i$ 座房子建在坐标为 $x_i$ 的地方，其中住了 $r_i$ 人。\n\n松江 1843 路公交车要在这条路上建一个公交站，市政府希望让最多的人得到方便，因此希望所有的每一个的居民，从家到车站的距离的**总和**最短。\n\n公交站应该建在哪里呢？", "inputFormat": "第一行输入 $L$、$N$。\n\n接下来 $N$ 行，每行两个整数 $x_i$ 和 $r_i$。", "outputFormat": "一个整数，最小的每个人从家到车站的距离的总和。\n", "hint": "### 样例解释 1\n\n当建在坐标 $40$ 的时候，所有人距离车站的距离总和为 $|20-40| \\times 3+|50-40| \\times 2+|70-40| \\times 1=110$。\n\n### 数据范围和约定\n\n对于 $10\\% $的数据，$1\\le N \\le 50$，$R_i=1$。\n\n对于 $30\\%$ 的数据，$1 \\le N \\le 100$，$R_i \\le 10$，$1 \\le L \\le 1000$。\n\n对于 $70\\%$ 的数据，$1 \\le N \\le 1000$，$R_i \\le 100$，$1 \\le L \\le 10^6$。\n\n对于全部数据，$1 \\le L \\le 10^{10}$，$1 \\le N \\le 10^5$，$0 \\le x_i \\le L$，$1 \\le r_i \\le 1000$。", "locale": "zh-CN"}}}
{"pid": "P3820", "type": "P", "difficulty": 5, "samples": [["5 5\n.*...\n.****\n*....\n*****\n.....\n3\n1 2 1 1 1 3\n2 1 3 1\n1 2 1 1 1 3", "2\n1\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["并查集", "洛谷原创", "广度优先搜索 BFS", "连通块", "洛谷月赛"], "title": "小D的地下温泉", "background": "小 D 最喜欢泡温泉了。小 D 找某奸商租下了一块 $N$ 行 $M$ 列的地，左上角为 $(1,1)$，右下角为 $(N,M)$。小 D 本以为这块地里全是温泉，结果这块地极不稳定，曾经发生过一些地形变动，所以其中一些地方全是土。", "description": "一开始他会告诉你当前这块地的情况，但是小 D 有一些假操作，希望你操作给他看：\n\n1. 由小 D 指定 $w$ 个位置，他希望知道其中哪个位置下水泡温泉的范围最大。泡温泉的范围定义为指定位置通过向上下左右四个方向能到达的位置的个数。若询问的位置为土，则范围为 $0$。如果如果有多个位置均为最大，输出给出顺序较前的那个。位置编号为 $1,2,...,w$。\n\n2. 由小 D 指定 $w$ 个位置，他会使用魔法按顺序翻转这 $w$ 个地方的地形。即若原位置是土，则该位置变为温泉；若原位置是温泉，则该位置变为土。因为小 D 不希望活动范围减少得太快，所以他在将温泉变为土时不会将一个区域分割。", "inputFormat": "第一行输入两个整数，$N,M$，为土地大小。\n\n接下来的 $N$ 行每行输入 $M$ 个字符，为 `.`（代表温泉）或 `*`（代表土）\n\n第 $N+2$ 行输入一个整数，$Q$，为操作数量。\n\n接下来的 $Q$ 行，每行先读入两个整数 $opt$ 和 $w$，表示操作类型和指定点的数量，在同一行还有 $2w$ 个数 $x_{1},y_{1},x_{2},y_{2},...,x_{w},y_{w}$，分别表示 $w$ 个操作的位置为 $(x_{1},y_{1}),(x_{2},y_{2}),...,(x_{w},y_{w})$。", "outputFormat": "对于每个操作 1，输出询问的答案并换行", "hint": "对于 $30\\%$ 的数据，$N,M\\le 100,\\sum w\\le 100$\n\n对于 $70\\%$ 的数据，$N,M\\le 1000$\n\n对于 $100\\%$ 的数据，$1\\le NM,Q\\le 10^{6},\\sum w\\le 10^{6},w\\geq 1$\n\n数据在 Windows 下制作", "locale": "zh-CN", "translations": {"en": {"title": "Xiao D's Underground Hot Springs", "background": "Xiao D loves soaking in hot springs. Xiao D rented a piece of land with $N$ rows and $M$ columns from a certain profiteer, with the top-left corner at $(1, 1)$ and the bottom-right corner at $(N, M)$. Xiao D originally thought the entire land was hot springs, but the land is very unstable and has undergone some terrain changes in the past, so some places are all soil.", "description": "At the beginning, he will tell you the current state of this land, but Xiao D has some pretend operations and wants you to perform them for him:\n\n1. Xiao D specifies $w$ positions and wants to know which of these positions has the largest soaking range if he goes down to soak at that position. The soaking range is defined as the number of positions reachable from the specified position by moving in the four directions up, down, left, and right. If the queried position is soil, then the range is $0$. If multiple positions tie for the maximum, output the one that appears earlier in the given order. The positions are indexed as $1, 2, \\ldots, w$.\n\n2. Xiao D specifies $w$ positions. He will use magic to toggle the terrain of these $w$ places in order. That is, if the original position is soil, it becomes a hot spring; if the original position is a hot spring, it becomes soil. Because Xiao D does not want the activity range to shrink too quickly, when turning a hot spring into soil he will not split a connected region.", "inputFormat": "The first line contains two integers, $N, M$, representing the size of the land.\n\nThe next $N$ lines each contain $M$ characters, either `.` (representing a hot spring) or `*` (representing soil).\n\nThe $(N+2)$-th line contains an integer $Q$, the number of operations.\n\nIn each of the next $Q$ lines, first read two integers $opt$ and $w$, representing the operation type and the number of specified points. On the same line, there are also $2w$ numbers $x_{1}, y_{1}, x_{2}, y_{2}, \\ldots, x_{w}, y_{w}$, which represent the $w$ operation positions $(x_{1}, y_{1}), (x_{2}, y_{2}), \\ldots, (x_{w}, y_{w})$.", "outputFormat": "For each operation of type $1$, output the answer to the query on a new line.", "hint": "- For $30\\%$ of the testdata, $N, M \\le 100, \\sum w \\le 100$.\n- For $70\\%$ of the testdata, $N, M \\le 1000$.\n- Constraints: for $100\\%$ of the testdata, $1 \\le NM, Q \\le 10^{6}, \\sum w \\le 10^{6}, w \\ge 1$.\n- The testdata is generated on Windows.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "小D的地下温泉", "background": "小 D 最喜欢泡温泉了。小 D 找某奸商租下了一块 $N$ 行 $M$ 列的地，左上角为 $(1,1)$，右下角为 $(N,M)$。小 D 本以为这块地里全是温泉，结果这块地极不稳定，曾经发生过一些地形变动，所以其中一些地方全是土。", "description": "一开始他会告诉你当前这块地的情况，但是小 D 有一些假操作，希望你操作给他看：\n\n1. 由小 D 指定 $w$ 个位置，他希望知道其中哪个位置下水泡温泉的范围最大。泡温泉的范围定义为指定位置通过向上下左右四个方向能到达的位置的个数。若询问的位置为土，则范围为 $0$。如果如果有多个位置均为最大，输出给出顺序较前的那个。位置编号为 $1,2,...,w$。\n\n2. 由小 D 指定 $w$ 个位置，他会使用魔法按顺序翻转这 $w$ 个地方的地形。即若原位置是土，则该位置变为温泉；若原位置是温泉，则该位置变为土。因为小 D 不希望活动范围减少得太快，所以他在将温泉变为土时不会将一个区域分割。", "inputFormat": "第一行输入两个整数，$N,M$，为土地大小。\n\n接下来的 $N$ 行每行输入 $M$ 个字符，为 `.`（代表温泉）或 `*`（代表土）\n\n第 $N+2$ 行输入一个整数，$Q$，为操作数量。\n\n接下来的 $Q$ 行，每行先读入两个整数 $opt$ 和 $w$，表示操作类型和指定点的数量，在同一行还有 $2w$ 个数 $x_{1},y_{1},x_{2},y_{2},...,x_{w},y_{w}$，分别表示 $w$ 个操作的位置为 $(x_{1},y_{1}),(x_{2},y_{2}),...,(x_{w},y_{w})$。", "outputFormat": "对于每个操作 1，输出询问的答案并换行", "hint": "对于 $30\\%$ 的数据，$N,M\\le 100,\\sum w\\le 100$\n\n对于 $70\\%$ 的数据，$N,M\\le 1000$\n\n对于 $100\\%$ 的数据，$1\\le NM,Q\\le 10^{6},\\sum w\\le 10^{6},w\\geq 1$\n\n数据在 Windows 下制作", "locale": "zh-CN"}}}
{"pid": "P3821", "type": "P", "difficulty": 6, "samples": [["2 1 1 2 1\n1 2 1\n0\n", "1\n"], ["2 1 1 2 1\n1 2 2\n0\n", "2"], ["2 1 1 2 10000001\n1 2 2\n0\n", "2"], ["2 1 1 2 10000001\n1 2 2\n1\n2\n2 1\n", "2"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["数学", "图论", "矩阵乘法"], "title": "Isaac", "background": "居润国迷上了一款游戏《以撒的结合重生》。他已经打到了最后一关，这一关有特殊的走位技巧。\n\n1. 居润国从时刻 $0$ 开始，要控制以撒从起点走到终点。\n\n2. 居润国只能在第 $k$ 时刻恰好走到终点。（从一个房间走到另一个房间居润国需要花费一个单位时间，居润国手速快，不会在同一个房间停留，以撒可以在这些房间中来回走动）\n\n3. 若房间 $u$ 和 $v$ 相连，则居润国能控制以撒通过这两个房间的通道当且仅当以撒的血量大于等于 $f(u, v)$\n\n4. 在这些房间之间有一堆怪物在游走。\n\n5. 居润国为了求稳，于是上网找到了一个解码器，在代码中发现这些怪物们游走的房间有固定的规律：怪物每次都会从一个房间移动到另一个房间（也需花费一个单位时间），且他们总是在几个固定的房间按照固定的顺序内游走，游走的房间个数为 $T$。\n\n为了不在玩游戏时失误，居润国希望能够避开所有的怪物走到终点，即无伤通过最后一关，同时希望你找到居润国控制的以撒完成这个任务至少需要的血量。对编程一窍不通的他找到了你，希望寻求解决。如果要是你无法解决，那么就光明正大地告诉他： `'IMP0SSBLE!!'` 他一定不会打死你的。", "description": "求居润国是否能在上述条件要求下无伤通过最后一关。如果可以，输出居润国控制的以撒最少所需的血量 $B$，否则输出 `'IMP0SSBLE!!'` \n", "inputFormat": "第一行有五个数，分别为 $n,m,s,t,k$，分别表示一共有 $n$ 个房间，以及 $m$ 对相邻房间及其通过所需要的血量，以 $s$ 为起点，$t$ 为终点，要在 $k$ 时刻恰好走到终点。\n\n接下来 $m$ 行每行分别有三个数，分别是 $u,v,w$，表示房间 $u$ 和房间 $v$ 相邻，两个房间互相通过的血量均为 $w$。\n\n接下来一行是单独的一个数 $a$，表示一共有 $a$ 只怪物\n\n接下来有 $a$ 个数据分别表示每个怪物的游走规律\n\n每个数据的第一个数 $T$ 表示怪物游走的房间个数，接下来有 $T$ 个房间编号表示从**第零时刻开始**怪物将从第一个房间按顺序和周期游走。", "outputFormat": "仅一行，居润国控制以撒的最少所需血量 $B$，或是 `'IMP0SSBLE!!'` \n", "hint": "共 $20$ 组数据。\n\n对于 $15\\%$ 的数据，$a = 0$，$k \\leq 20$。\n\n对于 $25\\%$ 的数据，$a \\leq 3$，$k \\leq 1500$。\n\n对于 $50\\%$ 的数据，$a \\leq 3$，$k \\leq 10^4$。\n\n对于 $70\\%$ 的数据，$a \\leq 20$，$k \\leq 10^6$。\n\n对于 $85\\%$ 的数据，$a \\leq 30$，$k \\leq 10^8$。\n\n对于 $100\\%$ 的数据，$a \\leq 30$，$k \\leq 2*10^9$，$2 \\leq T \\leq 4$，$n \\leq 50$，$m \\leq 1250$。\n\n所有输入皆在 int 范围内。\n\n所有数据皆大于零，**可能会有重边，若一条边输入多次 则以最后一次出现的权值为准。**", "locale": "zh-CN", "translations": {"en": {"title": "Isaac", "background": "Ju Runguo got hooked on a game, The Binding of Isaac: Rebirth. He has reached the final level, which requires special movement techniques.\n\n1. Starting from time $0$, he must control Isaac to go from the start to the finish.\n2. He can arrive at the finish only exactly at time $k$. (Moving from one room to another costs one time unit. His hands are fast, so he never waits in the same room. Isaac may move back and forth among rooms.)\n3. If rooms $u$ and $v$ are connected, he can control Isaac to traverse the passage between them if and only if Isaac’s health is at least $f(u, v)$.\n4. There are monsters roaming among these rooms.\n5. To play it safe, Ju Runguo found a decoder online and discovered in the code that the monsters roam rooms with a fixed pattern: each time they move from one room to another (also costing one time unit), and they always roam within several fixed rooms in a fixed order. The number of rooms in the roaming cycle is $T$.\n\nTo avoid making mistakes while playing, Ju Runguo hopes to avoid all monsters and reach the finish, i.e., pass the final level without taking damage, and he hopes you can find the minimum health Isaac needs under his control to complete this task. If you cannot solve it, then just tell him openly: 'IMP0SSBLE!!'. He definitely won't kill you.", "description": "Determine whether Ju Runguo can pass the final level without taking damage under the above conditions. If he can, output the minimum required health $B$ for Isaac under Ju Runguo’s control; otherwise, output 'IMP0SSBLE!!'.", "inputFormat": "The first line contains five numbers $n, m, s, t, k$, representing that there are $n$ rooms in total, $m$ pairs of adjacent rooms together with the required health to traverse them, the start is $s$, the finish is $t$, and Isaac must arrive exactly at time $k$.\n\nEach of the next $m$ lines contains three numbers $u, v, w$, meaning that room $u$ and room $v$ are adjacent, and the required health to traverse between the two rooms in both directions is $w$.\n\nThe next line contains a single number $a$, the number of monsters.\n\nThen follow $a$ data blocks, each describing one monster’s roaming pattern.\n\nIn each block, the first number $T$ is the number of rooms in the monster’s roaming cycle, followed by $T$ room IDs that indicate that starting from time $0$, the monster will move from the first room in order and periodically repeat the sequence.", "outputFormat": "Output a single line: the minimum required health $B$ for Isaac under Ju Runguo’s control, or 'IMP0SSBLE!!'.", "hint": "There are $20$ groups of testdata.\n\nFor $15\\%$ of the testdata, $a = 0$, $k \\leq 20$.\n\nFor $25\\%$ of the testdata, $a \\leq 3$, $k \\leq 1500$.\n\nFor $50\\%$ of the testdata, $a \\leq 3$, $k \\leq 10^4$.\n\nFor $70\\%$ of the testdata, $a \\leq 20$, $k \\leq 10^6$.\n\nFor $85\\%$ of the testdata, $a \\leq 30$, $k \\leq 10^8$.\n\nFor $100\\%$ of the testdata, $a \\leq 30$, $k \\leq 2*10^9$, $2 \\leq T \\leq 4$, $n \\leq 50$, $m \\leq 1250$.\n\nAll inputs are within the range of int.\n\nAll numbers are positive. There may be multiple edges; if an edge is given multiple times, the weight of its last occurrence prevails.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "Isaac", "background": "居润国迷上了一款游戏《以撒的结合重生》。他已经打到了最后一关，这一关有特殊的走位技巧。\n\n1. 居润国从时刻 $0$ 开始，要控制以撒从起点走到终点。\n\n2. 居润国只能在第 $k$ 时刻恰好走到终点。（从一个房间走到另一个房间居润国需要花费一个单位时间，居润国手速快，不会在同一个房间停留，以撒可以在这些房间中来回走动）\n\n3. 若房间 $u$ 和 $v$ 相连，则居润国能控制以撒通过这两个房间的通道当且仅当以撒的血量大于等于 $f(u, v)$\n\n4. 在这些房间之间有一堆怪物在游走。\n\n5. 居润国为了求稳，于是上网找到了一个解码器，在代码中发现这些怪物们游走的房间有固定的规律：怪物每次都会从一个房间移动到另一个房间（也需花费一个单位时间），且他们总是在几个固定的房间按照固定的顺序内游走，游走的房间个数为 $T$。\n\n为了不在玩游戏时失误，居润国希望能够避开所有的怪物走到终点，即无伤通过最后一关，同时希望你找到居润国控制的以撒完成这个任务至少需要的血量。对编程一窍不通的他找到了你，希望寻求解决。如果要是你无法解决，那么就光明正大地告诉他： `'IMP0SSBLE!!'` 他一定不会打死你的。", "description": "求居润国是否能在上述条件要求下无伤通过最后一关。如果可以，输出居润国控制的以撒最少所需的血量 $B$，否则输出 `'IMP0SSBLE!!'` \n", "inputFormat": "第一行有五个数，分别为 $n,m,s,t,k$，分别表示一共有 $n$ 个房间，以及 $m$ 对相邻房间及其通过所需要的血量，以 $s$ 为起点，$t$ 为终点，要在 $k$ 时刻恰好走到终点。\n\n接下来 $m$ 行每行分别有三个数，分别是 $u,v,w$，表示房间 $u$ 和房间 $v$ 相邻，两个房间互相通过的血量均为 $w$。\n\n接下来一行是单独的一个数 $a$，表示一共有 $a$ 只怪物\n\n接下来有 $a$ 个数据分别表示每个怪物的游走规律\n\n每个数据的第一个数 $T$ 表示怪物游走的房间个数，接下来有 $T$ 个房间编号表示从**第零时刻开始**怪物将从第一个房间按顺序和周期游走。", "outputFormat": "仅一行，居润国控制以撒的最少所需血量 $B$，或是 `'IMP0SSBLE!!'` \n", "hint": "共 $20$ 组数据。\n\n对于 $15\\%$ 的数据，$a = 0$，$k \\leq 20$。\n\n对于 $25\\%$ 的数据，$a \\leq 3$，$k \\leq 1500$。\n\n对于 $50\\%$ 的数据，$a \\leq 3$，$k \\leq 10^4$。\n\n对于 $70\\%$ 的数据，$a \\leq 20$，$k \\leq 10^6$。\n\n对于 $85\\%$ 的数据，$a \\leq 30$，$k \\leq 10^8$。\n\n对于 $100\\%$ 的数据，$a \\leq 30$，$k \\leq 2*10^9$，$2 \\leq T \\leq 4$，$n \\leq 50$，$m \\leq 1250$。\n\n所有输入皆在 int 范围内。\n\n所有数据皆大于零，**可能会有重边，若一条边输入多次 则以最后一次出现的权值为准。**", "locale": "zh-CN"}}}
{"pid": "P3822", "type": "P", "difficulty": 6, "samples": [["10 3 1 2\n1 100 0\n1 2333 0\n1 -233 0\n2 5\n2 7\n2 15\n1 5 15\n2 15\n1 -1 12\n2 15", "0\n1\n0\n1\n0"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000, 512000]}, "tags": ["高精度", "2017", "线段树", "NOI", "O2优化", "进制"], "title": "[NOI2017] 整数", "background": "在人类智慧的山巅，有着一台字长为 $1\\,048\\,576$ 位（此数字与解题无关）的超级计算机，著名理论计算机科学家 P 博士正用它进行各种研究。不幸的是，这天台风切断了电力系统，超级计算机无法工作，而 P 博士明天就要交实验结果了，只好求助于学过 OI 的你...\n", "description": "P 博士将他的计算任务抽象为对一个整数的操作。\n\n具体来说，有一个整数 $x$，一开始为 $0$。\n\n接下来有 $n$ 个操作，每个操作都是以下两种类型中的一种：\n\n- `1 a b`：将 $x$ 加上整数 $a\\cdot 2^b$，其中 $a$ 为一个整数，$b$ 为一个非负整数\n\n- `2 k` ：询问 $x$ 在用二进制表示时，位权为 $2^k$ 的位的值（即这一位上的 $1$ 代表 $2^k$）\n\n保证在任何时候，$x\\geqslant 0$。", "inputFormat": "输入的第一行包含四个正整数 $n,t_1,t_2,t_3$，$n$ 的含义见题目描述，$t_1$，$t_2$，$t_3$ 的具体含义见子任务。\n\n接下来 $n$ 行，每行给出一个操作，具体格式和含义见题目描述。", "outputFormat": "对于每个询问操作，输出一行，表示该询问的答案（$0$ 或 $1$）。对于加法操作，没有任何输出。\n", "hint": "在所有测试点中，$1\\leqslant t_1 \\leqslant 3, 1 \\leqslant t_2 \\leqslant 4, 1 \\leqslant t_3 \\leqslant 2$。不同的 $t_1, t_2, t_3$ 对应的特殊限制如下：\n\n- 对于 $t_1 = 1$ 的测试点，满足 $a = 1$；\n- 对于 $t_1 = 2$ 的测试点，满足 $|a| = 1$；\n- 对于 $t_1 = 3$ 的测试点，满足 $|a| \\leqslant 10^9$；\n- 对于 $t_2 = 1$ 的测试点，满足 $0 \\leqslant b, k \\leqslant 30$；\n- 对于 $t_2 = 2$ 的测试点，满足 $0 \\leqslant b, k \\leqslant 100$；\n- 对于 $t_2 = 3$ 的测试点，满足 $0 \\leqslant b, k \\leqslant n$；\n- 对于 $t_2 = 4$ 的测试点，满足 $0 \\leqslant b, k \\leqslant 30n$；\n- 对于 $t_3 = 1$ 的测试点，保证所有询问操作都在所有修改操作之后；\n- 对于 $t_3 = 2$ 的测试点，不保证询问操作和修改操作的先后顺序。\n\n本题共 25 个测试点，每个测试点 4 分。各个测试点的数据范围如下：\n\n::cute-table{tuack}\n\n| 测试点编号 | $n \\le$ | $t_1$ | $t_2$ | $t_3$ |\n|:-:|:-:|:-:|:-:|:-:|\n| $1$ | $10$ | $3$ | $1$ | $2$ |\n| $2$ | $100$ | $3$ | $2$ | $2$ |\n| $3$ | $2000$ | $3$ | $2$ | $2$ |\n| $4$ | $4000$ | $1$ | $3$ | $2$ |\n| $5$ | $6000$ | $3$ | $3$ | $1$ |\n| $6$ | $8000$ | $2$ | $3$ | $2$ |\n| $7$ | $9000$ | $3$ | $4$ | $2$ |\n| $8$ | $10000$ | $3$ | $3$ | $2$ |\n| $9$ | $30000$ | $3$ | $4$ | $2$ |\n| $10$ | $50000$ | $3$ | $4$ | $1$ |\n| $11$ | $60000$ | $3$ | $3$ | $2$ |\n| $12$ | $65000$ | $2$ | $4$ | $2$ |\n| $13$ | $70000$ | $3$ | $4$ | $2$ |\n| $14$ | $200000$ | $3$ | $4$ | $2$ |\n| $15$ | $300000$ | $2$ | $4$ | $2$ |\n| $16$ | $400000$ | $3$ | $4$ | $2$ |\n| $17$ | $500000$ | $3$ | $3$ | $2$ |\n| $18$ | $600000$ | $3$ | $4$ | $2$ |\n| $19$ | $700000$ | $3$ | $4$ | $2$ |\n| $20$ | $800000$ | $1$ | $4$ | $2$ |\n| $21$ | $900000$ | $2$ | $4$ | $2$ |\n| $22$ | $930000$ | $3$ | $3$ | $2$ |\n| $23$ | $960000$ | $3$ | $4$ | $1$ |\n| $24$ | $990000$ | $3$ | $3$ | $2$ |\n| $25$ | $1000000$ | $3$ | $4$ | $2$ |", "locale": "zh-CN", "translations": {"en": {"title": "[NOI2017] Integer", "background": "At the summit of human wisdom, there is a supercomputer with a word length of $1\\,048\\,576$ bits (this number is irrelevant to solving the problem). Dr. P, a famous theoretical computer scientist, is using it for various research. Unfortunately, a typhoon cut off the power system today, and the supercomputer cannot work. Dr. P needs to submit the experimental results tomorrow, so he has to ask you, who have studied OI, for help...", "description": "Dr. P abstracts his computation task as operations on an integer.\n\nSpecifically, there is an integer $x$, initially $0$.\n\nThen there are $n$ operations, each of the following two types:\n- `1 a b`: add the integer $a \\cdot 2^b$ to $x$, where $a$ is an integer and $b$ is a nonnegative integer.\n- `2 k`: ask for the value of the bit of $x$ in binary whose weight is $2^k$ (that is, a $1$ in this bit represents $2^k$).\n\nIt is guaranteed that $x \\geqslant 0$ at all times.", "inputFormat": "The first line of input contains four positive integers $n, t_1, t_2, t_3$. The meaning of $n$ is given in the problem statement, and the meanings of $t_1, t_2, t_3$ are given in the subtasks.\n\nThen follow $n$ lines, each giving one operation. The specific format and meaning are as described above.", "outputFormat": "For each query operation, output one line representing the answer ($0$ or $1$). For addition operations, there is no output.", "hint": "In all test points, $1 \\leqslant t_1 \\leqslant 3$, $1 \\leqslant t_2 \\leqslant 4$, $1 \\leqslant t_3 \\leqslant 2$. Different pairs $t_1, t_2, t_3$ correspond to the following special restrictions:\n- For $t_1 = 1$, $a = 1$.\n- For $t_1 = 2$, $|a| = 1$.\n- For $t_1 = 3$, $|a| \\leqslant 10^9$.\n- For $t_2 = 1$, $0 \\leqslant b, k \\leqslant 30$.\n- For $t_2 = 2$, $0 \\leqslant b, k \\leqslant 100$.\n- For $t_2 = 3$, $0 \\leqslant b, k \\leqslant n$.\n- For $t_2 = 4$, $0 \\leqslant b, k \\leqslant 30n$.\n- For $t_3 = 1$, all query operations appear after all addition operations.\n- For $t_3 = 2$, the order between query operations and addition operations is not guaranteed.\n\nThere are 25 test points in total, each worth 4 points. The Constraints of each test point are as follows:\n\n::cute-table{tuack}\n\n| Test point ID | $n \\le$ | $t_1$ | $t_2$ | $t_3$ |\n|:-:|:-:|:-:|:-:|:-:|\n| $1$ | $10$ | $3$ | $1$ | $2$ |\n| $2$ | $100$ | $3$ | $2$ | $2$ |\n| $3$ | $2000$ | $3$ | $2$ | $2$ |\n| $4$ | $4000$ | $1$ | $3$ | $2$ |\n| $5$ | $6000$ | $3$ | $3$ | $1$ |\n| $6$ | $8000$ | $2$ | $3$ | $2$ |\n| $7$ | $9000$ | $3$ | $4$ | $2$ |\n| $8$ | $10000$ | $3$ | $3$ | $2$ |\n| $9$ | $30000$ | $3$ | $4$ | $2$ |\n| $10$ | $50000$ | $3$ | $4$ | $1$ |\n| $11$ | $60000$ | $3$ | $3$ | $2$ |\n| $12$ | $65000$ | $2$ | $4$ | $2$ |\n| $13$ | $70000$ | $3$ | $4$ | $2$ |\n| $14$ | $200000$ | $3$ | $4$ | $2$ |\n| $15$ | $300000$ | $2$ | $4$ | $2$ |\n| $16$ | $400000$ | $3$ | $4$ | $2$ |\n| $17$ | $500000$ | $3$ | $3$ | $2$ |\n| $18$ | $600000$ | $3$ | $4$ | $2$ |\n| $19$ | $700000$ | $3$ | $4$ | $2$ |\n| $20$ | $800000$ | $1$ | $4$ | $2$ |\n| $21$ | $900000$ | $2$ | $4$ | $2$ |\n| $22$ | $930000$ | $3$ | $3$ | $2$ |\n| $23$ | $960000$ | $3$ | $4$ | $1$ |\n| $24$ | $990000$ | $3$ | $3$ | $2$ |\n| $25$ | $1000000$ | $3$ | $4$ | $2$ |\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[NOI2017] 整数", "background": "在人类智慧的山巅，有着一台字长为 $1\\,048\\,576$ 位（此数字与解题无关）的超级计算机，著名理论计算机科学家 P 博士正用它进行各种研究。不幸的是，这天台风切断了电力系统，超级计算机无法工作，而 P 博士明天就要交实验结果了，只好求助于学过 OI 的你...\n", "description": "P 博士将他的计算任务抽象为对一个整数的操作。\n\n具体来说，有一个整数 $x$，一开始为 $0$。\n\n接下来有 $n$ 个操作，每个操作都是以下两种类型中的一种：\n\n- `1 a b`：将 $x$ 加上整数 $a\\cdot 2^b$，其中 $a$ 为一个整数，$b$ 为一个非负整数\n\n- `2 k` ：询问 $x$ 在用二进制表示时，位权为 $2^k$ 的位的值（即这一位上的 $1$ 代表 $2^k$）\n\n保证在任何时候，$x\\geqslant 0$。", "inputFormat": "输入的第一行包含四个正整数 $n,t_1,t_2,t_3$，$n$ 的含义见题目描述，$t_1$，$t_2$，$t_3$ 的具体含义见子任务。\n\n接下来 $n$ 行，每行给出一个操作，具体格式和含义见题目描述。", "outputFormat": "对于每个询问操作，输出一行，表示该询问的答案（$0$ 或 $1$）。对于加法操作，没有任何输出。\n", "hint": "在所有测试点中，$1\\leqslant t_1 \\leqslant 3, 1 \\leqslant t_2 \\leqslant 4, 1 \\leqslant t_3 \\leqslant 2$。不同的 $t_1, t_2, t_3$ 对应的特殊限制如下：\n\n- 对于 $t_1 = 1$ 的测试点，满足 $a = 1$；\n- 对于 $t_1 = 2$ 的测试点，满足 $|a| = 1$；\n- 对于 $t_1 = 3$ 的测试点，满足 $|a| \\leqslant 10^9$；\n- 对于 $t_2 = 1$ 的测试点，满足 $0 \\leqslant b, k \\leqslant 30$；\n- 对于 $t_2 = 2$ 的测试点，满足 $0 \\leqslant b, k \\leqslant 100$；\n- 对于 $t_2 = 3$ 的测试点，满足 $0 \\leqslant b, k \\leqslant n$；\n- 对于 $t_2 = 4$ 的测试点，满足 $0 \\leqslant b, k \\leqslant 30n$；\n- 对于 $t_3 = 1$ 的测试点，保证所有询问操作都在所有修改操作之后；\n- 对于 $t_3 = 2$ 的测试点，不保证询问操作和修改操作的先后顺序。\n\n本题共 25 个测试点，每个测试点 4 分。各个测试点的数据范围如下：\n\n::cute-table{tuack}\n\n| 测试点编号 | $n \\le$ | $t_1$ | $t_2$ | $t_3$ |\n|:-:|:-:|:-:|:-:|:-:|\n| $1$ | $10$ | $3$ | $1$ | $2$ |\n| $2$ | $100$ | $3$ | $2$ | $2$ |\n| $3$ | $2000$ | $3$ | $2$ | $2$ |\n| $4$ | $4000$ | $1$ | $3$ | $2$ |\n| $5$ | $6000$ | $3$ | $3$ | $1$ |\n| $6$ | $8000$ | $2$ | $3$ | $2$ |\n| $7$ | $9000$ | $3$ | $4$ | $2$ |\n| $8$ | $10000$ | $3$ | $3$ | $2$ |\n| $9$ | $30000$ | $3$ | $4$ | $2$ |\n| $10$ | $50000$ | $3$ | $4$ | $1$ |\n| $11$ | $60000$ | $3$ | $3$ | $2$ |\n| $12$ | $65000$ | $2$ | $4$ | $2$ |\n| $13$ | $70000$ | $3$ | $4$ | $2$ |\n| $14$ | $200000$ | $3$ | $4$ | $2$ |\n| $15$ | $300000$ | $2$ | $4$ | $2$ |\n| $16$ | $400000$ | $3$ | $4$ | $2$ |\n| $17$ | $500000$ | $3$ | $3$ | $2$ |\n| $18$ | $600000$ | $3$ | $4$ | $2$ |\n| $19$ | $700000$ | $3$ | $4$ | $2$ |\n| $20$ | $800000$ | $1$ | $4$ | $2$ |\n| $21$ | $900000$ | $2$ | $4$ | $2$ |\n| $22$ | $930000$ | $3$ | $3$ | $2$ |\n| $23$ | $960000$ | $3$ | $4$ | $1$ |\n| $24$ | $990000$ | $3$ | $3$ | $2$ |\n| $25$ | $1000000$ | $3$ | $4$ | $2$ |", "locale": "zh-CN"}}}
{"pid": "P3823", "type": "P", "difficulty": 6, "samples": [["5 9\n3 1 3 5 3\n3 333135 2\n3 333135 1\n1 1 3\n1 2 5\n1 3 2\n1 5 4\n3 333135 2\n3 333135 1\n3 333135 3", "0\n81\n1\n81\n0"], ["2 10\n6 6\n3 666666 1\n1 1 2\n3 666666 2\n3 666666 4\n3 666666666666666666666666666666 1\n2 1\n1 2 1\n3 666666 2\n3 666666 4\n3 666666666666666666666666666666 1", "64\n1\n0\n75497471\n1\n0\n75497471"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000, 1280000]}, "tags": ["字符串", "2017", "NOI", "O2优化", "哈希 hashing"], "title": "[NOI2017] 蚯蚓排队", "background": null, "description": "蚯蚓幼儿园有 $n$ 只蚯蚓。幼儿园园长神刀手为了管理方便，时常让这些蚯蚓们列队表演。\n\n所有蚯蚓用从 $1$ 到 $n$ 的连续正整数编号。每只蚯蚓的长度可以用一个正整数表示，根据入园要求，所有蚯蚓的长度都不超过 $6$ 。神刀手希望这些蚯蚓排成若干个队伍，初始时，每只蚯蚓各自排成一个仅有一只蚯蚓的队伍，该蚯蚓既在队首，也在队尾。\n\n神刀手将会依次进行 $m$ 次操作，每个操作都是以下三种操作中的一种：\n\n1. 给出 $i$ 和 $j$ ，令 $i$ 号蚯蚓与 $j$ 号蚯蚓所在的两个队伍合并为一个队伍，具体来说，令 $j$ 号蚯蚓紧挨在 $i$ 号蚯蚓之后，其余蚯蚓保持队伍的前后关系不变。\n\n2. 给出 $i$ ，令 $i$ 号蚯蚓与紧挨其后的一只蚯蚓分离为两个队伍，具体来说，在分离之后， $i$ 号蚯蚓在其中一个队伍的队尾，原本紧挨其后的那一只蚯蚓在另一个队伍的队首，其余蚯蚓保持队伍的前后关系不变。\n\n3. 给出一个正整数 $k$ 和一个长度至少为 $k$ 的数字串 $s$ ，对于 $s$ 的每个长度为 $k$ 的连续子串 $t$ （这样的子串共有 $|s|-k+1$ 个，其中 $|s|$ 为 $s$ 的长度），定义函数 $f(t)$，询问所有这些 $f(t)$ 的**乘积**对 $998244353$ 取模后的结果。其中 $f(t)$ 的定义如下：\n\n对于当前的蚯蚓队伍，定义某个蚯蚓的**向后 $k$ 数字串**为：从该蚯蚓出发，沿队伍的向后方向，寻找最近的 $k$ 只蚯蚓（包括其自身），将这些蚯蚓的长度视作字符连接而成的数字串；如果这样找到的蚯蚓不足 $k$ 只，则其没有**向后 $k$ 数字串**。例如蚯蚓的队伍为 $10$ 号蚯蚓在队首，其后是 $22$ 号蚯蚓，其后是 $3$ 号蚯蚓（为队尾），这些蚯蚓的长度分别为 $4$ 、 $5$ 、 $6$ ，则 $10$ 号蚯蚓的**向后 $3$ 数字串**为 `456`， $22$ 号蚯蚓没有**向后 $3$ 数字串**，但其**向后 $2$ 数字串**为 `56`，其**向后 $1$ 数字串**为 `5`。\n\n而 $f(t)$ 表示所有蚯蚓中，**向后 $k$ 数字串**恰好为 $t$ 的蚯蚓只数。", "inputFormat": "输入文件的第一行有两个正整数 $n,m$ ，分别表示蚯蚓的只数与操作次数。\n\n第二行包含 $n$ 个不超过 $6$ 的正整数，依次表示编号为 $1,2,\\dots,n$ 的蚯蚓的长度。\n\n接下来 $m$ 行，每行表示一个操作。每个操作的格式可以为：\n\n* `1` $i$ $j$（$1 \\leq i, j \\leq n$）表示：令 $i$ 号与 $j$ 号蚯蚓**所在**的两个队伍合并为一个队伍，新队伍中，$j$ 号蚯蚓紧挨在 $i$ 号蚯蚓之后。保证在此操作之前，$i$ 号蚯蚓在某个队伍的队尾，$j$ 号蚯蚓在某个队伍的队首，且两只蚯蚓不在同一个队伍中。\n\n* `2` $i$（$1 \\leq i \\leq n$）表示：令 $i$ 号蚯蚓与紧挨其后一个蚯蚓分离为两个队伍。保证在此操作之前，$i$ 号蚯蚓不是某个队伍的队尾。\n\n* `3` $s$ $k$（$k$ 为正整数，$s$ 为一个长度至少为 $k$ 的数字串）表示：询问 $s$ 的每个长度为 $k$ 的子串 $t$ 的 $f(t)$ 的乘积，对 $998244353$ 取模的结果。$f(t)$ 的定义见题目描述。\n\n同一行输入的相邻两个元素之间，用恰好一个空格隔开。\n\n输入文件可能较大，请不要使用过于缓慢的读入方式。", "outputFormat": "依次对于每个形如 `3 s k` 的操作，输出一行，仅包含一个整数，表示询问的结果。", "hint": "保证 $n \\leq 2 \\times 10^{5}$，$m \\leq 5 \\times 10^{5}$，$k \\leq 50$ 。\n\n设 $\\sum |s|$ 为某个输入文件中所有询问的 $s$ 的长度总和，则 $\\sum |s| \\leq 10^{7}$  。\n\n设 $c$ 为某个输入文件中形如 `2 i` 的操作的次数，则 $c \\leq 10^{3}$ 。\n\n每个测试点的详细信息见下表：\n\n| 测试点编号 | $n$ | $m$ | $k$ | $\\sum \\|s\\|$ | $c$ | 全为 $\\texttt{1}$ |\n|:-:|:-:|:-:|:-:|:-:|:-:|:-:|\n| 1 | $=1$ | $\\leq 10^{3}$ | $=1$ | $\\leq 10^{3}$ | $=0$ | No |\n| 2 | $\\leq 20$ | $\\leq 40$ | $\\leq 10$ | $\\leq 10^{3}$ | $=0$ | No |\n| 3 | $\\leq 150$ | $\\leq 2,000$ | $\\leq 50$ | $\\leq 10^{3}$ | $\\leq 10^{3}$ | No |\n| 4 | $\\leq 500$ | $\\leq 600$ | $\\leq 50$ | $\\leq 10^{3}$ | $=0$ | No |\n| 5 | $\\leq 10^{3}$ | $\\leq 2,000$ | $\\leq 50$ | $\\leq 10^{3}$ | $\\leq 10^{3}$ | No |\n| 6 | $\\leq 5 \\times 10^{4}$ | $\\leq 6 \\times 10^{4}$ | $\\leq 5$ | $\\leq 5 \\times 10^{4}$ | $\\leq 10^{3}$ | No |\n| 7 | $\\leq 5 \\times 10^{4}$ | $\\leq 6 \\times 10^{4}$ | $\\leq 50$ | $\\leq 5 \\times 10^{4}$ | $=0$ | Yes |\n| 8 | $\\leq 5 \\times 10^{4}$ | $\\leq 6 \\times 10^{4}$ | $\\leq 50$ | $\\leq 5 \\times 10^{4}$ | $=0$ | No |\n| 9 | $\\leq 5 \\times 10^{4}$ | $\\leq 6 \\times 10^{4}$ | $\\leq 50$ | $\\leq 5 \\times 10^{4}$ | $\\leq 10^{3}$ | No |\n| 10 | $\\leq 5 \\times 10^{4}$ | $\\leq 8 \\times 10^{4}$ | $\\leq 50$ | $\\leq 2.5 \\times 10^{6}$ | $=0$ | No |\n| 11 | $\\leq 5 \\times 10^{4}$ | $\\leq 8 \\times 10^{4}$ | $\\leq 50$ | $\\leq 2.5 \\times 10^{6}$ | $\\leq 10^{3}$ | No |\n| 12 | $\\leq 10^{5}$ | $\\leq 1.1 \\times 10^{5}$ | $\\leq 6$ | $\\leq 10^{5}$ | $\\leq 10^{3}$ | No |\n| 13 | $\\leq 10^{5}$ | $\\leq 1.1 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{5}$ | $=0$ | Yes |\n| 14 | $\\leq 10^{5}$ | $\\leq 1.1 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{5}$ | $=0$ | No |\n| 15 | $\\leq 10^{5}$ | $\\leq 1.1 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{5}$ | $\\leq 10^{3}$ | No |\n| 16 | $\\leq 10^{5}$ | $\\leq 1.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 5 \\times 10^{6}$ | $=0$ | No |\n| 17 | $\\leq 10^{5}$ | $\\leq 1.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 5 \\times 10^{6}$ | $\\leq 10^{3}$ | No |\n| 18 | $\\leq 2 \\times 10^{5}$ | $\\leq 5 \\times 10^{5}$ | $=1$ | $\\leq 10^{7}$ | $=0$ | No |\n| 19 | $\\leq 2 \\times 10^{5}$ | $\\leq 5 \\times 10^{5}$ | $=1$ | $\\leq 10^{7}$ | $\\leq 10^{3}$ | No |\n| 20 | $\\leq 2 \\times 10^{5}$ | $\\leq 2.5 \\times 10^{5}$ | $\\leq 7$ | $\\leq 2 \\times 10^{5}$ | $\\leq 10^{3}$ | No |\n| 21 | $\\leq 2 \\times 10^{5}$ | $\\leq 2.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 2 \\times 10^{5}$ | $=0$ | Yes |\n| 22 | $\\leq 2 \\times 10^{5}$ | $\\leq 2.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 2 \\times 10^{5}$ | $=0$ | No |\n| 23 | $\\leq 2 \\times 10^{5}$ | $\\leq 2.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 2 \\times 10^{5}$ | $\\leq 10^{3}$ | No |\n| 24 | $\\leq 2 \\times 10^{5}$ | $\\leq 3 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{7}$ | $=0$ | No |\n| 25 | $\\leq 2 \\times 10^{5}$ | $\\leq 3 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{7}$ | $\\leq 10^{3}$ | No |\n\n如果一个测试点的“全为`1`”的一列为“Yes”，表示该测试点的所有蚯蚓的长度均为 1，并且所有询问串 $s$ 的每一位也均为`1`。", "locale": "zh-CN", "translations": {"en": {"title": "[NOI2017] Earthworms Queueing", "background": "", "description": "There are $n$ earthworms in a kindergarten. For easier management, the principal Shen Dao Shou often asks the earthworms to line up and perform.\n\nAll earthworms are numbered with consecutive positive integers from $1$ to $n$. The length of each earthworm is a positive integer, and by admission requirements, all lengths do not exceed $6$. Shen Dao Shou wants these earthworms to form several queues. Initially, each earthworm forms a queue by itself, where that earthworm is both the head and the tail of its queue.\n\nShen Dao Shou will perform $m$ operations in sequence. Each operation is one of the following three types:\n\n1. Given $i$ and $j$, merge the two queues containing earthworms $i$ and $j$ into a single queue. Specifically, place earthworm $j$ immediately after earthworm $i$, and keep the relative order of all other earthworms unchanged.\n\n2. Given $i$, split earthworm $i$ and the earthworm immediately after it into two queues. Specifically, after the split, earthworm $i$ becomes the tail of one queue, and the earthworm that was immediately after it becomes the head of the other queue. The relative order of all other earthworms remains unchanged.\n\n3. Given a positive integer $k$ and a digit string $s$ of length at least $k$, for every length-$k$ contiguous substring $t$ of $s$ (there are $|s|-k+1$ such substrings, where $|s|$ is the length of $s$), define a function $f(t)$ and ask for the product of all these $f(t)$ values modulo $998244353$. The definition of $f(t)$ is as follows:\n\nFor the current queues of earthworms, define an earthworm’s backward $k$-digit string as follows: starting from that earthworm and moving along the queue towards the back, find the nearest $k$ earthworms (including itself) and concatenate their lengths as characters to form a digit string. If fewer than $k$ earthworms can be found this way, then it does not have a backward $k$-digit string. For example, if the queue of earthworms has earthworm $10$ at the head, followed by earthworm $22$, followed by earthworm $3$ (which is at the tail), and their lengths are $4$, $5$, and $6$ respectively, then the backward $3$-digit string of earthworm $10$ is `456`. Earthworm $22$ does not have a backward $3$-digit string, but its backward $2$-digit string is `56`, and its backward $1$-digit string is `5`.\n\nThen $f(t)$ denotes the number of earthworms whose backward $k$-digit string is exactly $t$.", "inputFormat": "The first line contains two positive integers $n, m$, denoting the number of earthworms and the number of operations.\n\nThe second line contains $n$ positive integers not exceeding $6$, in order, denoting the lengths of earthworms numbered $1, 2, \\dots, n$.\n\nEach of the next $m$ lines describes an operation, in one of the following formats:\n\n- `1` $i$ $j$ ($1 \\leq i, j \\leq n$): Merge the two queues containing earthworms $i$ and $j$ into one queue, and in the new queue, place earthworm $j$ immediately after earthworm $i$. It is guaranteed that before this operation, earthworm $i$ is at the tail of some queue, earthworm $j$ is at the head of some queue, and the two earthworms are not in the same queue.\n\n- `2` $i$ ($1 \\leq i \\leq n$): Split earthworm $i$ and the earthworm immediately after it into two queues. It is guaranteed that before this operation, earthworm $i$ is not the tail of its queue.\n\n- `3` $s$ $k$ ($k$ is a positive integer, and $s$ is a digit string of length at least $k$): Query the product of $f(t)$ over every length-$k$ substring $t$ of $s$, modulo $998244353$. The definition of $f(t)$ is given in the problem statement.\n\nAdjacent elements on the same line are separated by exactly one space.\n\nThe input file can be large. Please avoid overly slow input methods.", "outputFormat": "For each operation of the form `3 s k`, output a single line containing a single integer, which is the answer to that query.", "hint": "Constraints:\n\nIt is guaranteed that $n \\leq 2 \\times 10^{5}$, $m \\leq 5 \\times 10^{5}$, $k \\leq 50$.\n\nLet $\\sum |s|$ be the total length of all query strings $s$ in an input file. Then $\\sum |s| \\leq 10^{7}$.\n\nLet $c$ be the number of operations of the form `2 i` in an input file. Then $c \\leq 10^{3}$.\n\nDetails for each test point are shown in the table below:\n\n| Test Point | $n$ | $m$ | $k$ | $\\sum |s|$ | $c$ | All are $\\texttt{1}$ |\n|:-:|:-:|:-:|:-:|:-:|:-:|:-:|\n| 1 | $=1$ | $\\leq 10^{3}$ | $=1$ | $\\leq 10^{3}$ | $=0$ | No |\n| 2 | $\\leq 20$ | $\\leq 40$ | $\\leq 10$ | $\\leq 10^{3}$ | $=0$ | No |\n| 3 | $\\leq 150$ | $\\leq 2,000$ | $\\leq 50$ | $\\leq 10^{3}$ | $\\leq 10^{3}$ | No |\n| 4 | $\\leq 500$ | $\\leq 600$ | $\\leq 50$ | $\\leq 10^{3}$ | $=0$ | No |\n| 5 | $\\leq 10^{3}$ | $\\leq 2,000$ | $\\leq 50$ | $\\leq 10^{3}$ | $\\leq 10^{3}$ | No |\n| 6 | $\\leq 5 \\times 10^{4}$ | $\\leq 6 \\times 10^{4}$ | $\\leq 5$ | $\\leq 5 \\times 10^{4}$ | $\\leq 10^{3}$ | No |\n| 7 | $\\leq 5 \\times 10^{4}$ | $\\leq 6 \\times 10^{4}$ | $\\leq 50$ | $\\leq 5 \\times 10^{4}$ | $=0$ | Yes |\n| 8 | $\\leq 5 \\times 10^{4}$ | $\\leq 6 \\times 10^{4}$ | $\\leq 50$ | $\\leq 5 \\times 10^{4}$ | $=0$ | No |\n| 9 | $\\leq 5 \\times 10^{4}$ | $\\leq 6 \\times 10^{4}$ | $\\leq 50$ | $\\leq 5 \\times 10^{4}$ | $\\leq 10^{3}$ | No |\n| 10 | $\\leq 5 \\times 10^{4}$ | $\\leq 8 \\times 10^{4}$ | $\\leq 50$ | $\\leq 2.5 \\times 10^{6}$ | $=0$ | No |\n| 11 | $\\leq 5 \\times 10^{4}$ | $\\leq 8 \\times 10^{4}$ | $\\leq 50$ | $\\leq 2.5 \\times 10^{6}$ | $\\leq 10^{3}$ | No |\n| 12 | $\\leq 10^{5}$ | $\\leq 1.1 \\times 10^{5}$ | $\\leq 6$ | $\\leq 10^{5}$ | $\\leq 10^{3}$ | No |\n| 13 | $\\leq 10^{5}$ | $\\leq 1.1 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{5}$ | $=0$ | Yes |\n| 14 | $\\leq 10^{5}$ | $\\leq 1.1 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{5}$ | $=0$ | No |\n| 15 | $\\leq 10^{5}$ | $\\leq 1.1 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{5}$ | $\\leq 10^{3}$ | No |\n| 16 | $\\leq 10^{5}$ | $\\leq 1.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 5 \\times 10^{6}$ | $=0$ | No |\n| 17 | $\\leq 10^{5}$ | $\\leq 1.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 5 \\times 10^{6}$ | $\\leq 10^{3}$ | No |\n| 18 | $\\leq 2 \\times 10^{5}$ | $\\leq 5 \\times 10^{5}$ | $=1$ | $\\leq 10^{7}$ | $=0$ | No |\n| 19 | $\\leq 2 \\times 10^{5}$ | $\\leq 5 \\times 10^{5}$ | $=1$ | $\\leq 10^{7}$ | $\\leq 10^{3}$ | No |\n| 20 | $\\leq 2 \\times 10^{5}$ | $\\leq 2.5 \\times 10^{5}$ | $\\leq 7$ | $\\leq 2 \\times 10^{5}$ | $\\leq 10^{3}$ | No |\n| 21 | $\\leq 2 \\times 10^{5}$ | $\\leq 2.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 2 \\times 10^{5}$ | $=0$ | Yes |\n| 22 | $\\leq 2 \\times 10^{5}$ | $\\leq 2.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 2 \\times 10^{5}$ | $=0$ | No |\n| 23 | $\\leq 2 \\times 10^{5}$ | $\\leq 2.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 2 \\times 10^{5}$ | $\\leq 10^{3}$ | No |\n| 24 | $\\leq 2 \\times 10^{5}$ | $\\leq 3 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{7}$ | $=0$ | No |\n| 25 | $\\leq 2 \\times 10^{5}$ | $\\leq 3 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{7}$ | $\\leq 10^{3}$ | No |\n\nIf the “All are `1`” column of a test point is “Yes”, it means all earthworms have length $1$, and every digit in every query string $s$ is also `1`.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[NOI2017] 蚯蚓排队", "background": null, "description": "蚯蚓幼儿园有 $n$ 只蚯蚓。幼儿园园长神刀手为了管理方便，时常让这些蚯蚓们列队表演。\n\n所有蚯蚓用从 $1$ 到 $n$ 的连续正整数编号。每只蚯蚓的长度可以用一个正整数表示，根据入园要求，所有蚯蚓的长度都不超过 $6$ 。神刀手希望这些蚯蚓排成若干个队伍，初始时，每只蚯蚓各自排成一个仅有一只蚯蚓的队伍，该蚯蚓既在队首，也在队尾。\n\n神刀手将会依次进行 $m$ 次操作，每个操作都是以下三种操作中的一种：\n\n1. 给出 $i$ 和 $j$ ，令 $i$ 号蚯蚓与 $j$ 号蚯蚓所在的两个队伍合并为一个队伍，具体来说，令 $j$ 号蚯蚓紧挨在 $i$ 号蚯蚓之后，其余蚯蚓保持队伍的前后关系不变。\n\n2. 给出 $i$ ，令 $i$ 号蚯蚓与紧挨其后的一只蚯蚓分离为两个队伍，具体来说，在分离之后， $i$ 号蚯蚓在其中一个队伍的队尾，原本紧挨其后的那一只蚯蚓在另一个队伍的队首，其余蚯蚓保持队伍的前后关系不变。\n\n3. 给出一个正整数 $k$ 和一个长度至少为 $k$ 的数字串 $s$ ，对于 $s$ 的每个长度为 $k$ 的连续子串 $t$ （这样的子串共有 $|s|-k+1$ 个，其中 $|s|$ 为 $s$ 的长度），定义函数 $f(t)$，询问所有这些 $f(t)$ 的**乘积**对 $998244353$ 取模后的结果。其中 $f(t)$ 的定义如下：\n\n对于当前的蚯蚓队伍，定义某个蚯蚓的**向后 $k$ 数字串**为：从该蚯蚓出发，沿队伍的向后方向，寻找最近的 $k$ 只蚯蚓（包括其自身），将这些蚯蚓的长度视作字符连接而成的数字串；如果这样找到的蚯蚓不足 $k$ 只，则其没有**向后 $k$ 数字串**。例如蚯蚓的队伍为 $10$ 号蚯蚓在队首，其后是 $22$ 号蚯蚓，其后是 $3$ 号蚯蚓（为队尾），这些蚯蚓的长度分别为 $4$ 、 $5$ 、 $6$ ，则 $10$ 号蚯蚓的**向后 $3$ 数字串**为 `456`， $22$ 号蚯蚓没有**向后 $3$ 数字串**，但其**向后 $2$ 数字串**为 `56`，其**向后 $1$ 数字串**为 `5`。\n\n而 $f(t)$ 表示所有蚯蚓中，**向后 $k$ 数字串**恰好为 $t$ 的蚯蚓只数。", "inputFormat": "输入文件的第一行有两个正整数 $n,m$ ，分别表示蚯蚓的只数与操作次数。\n\n第二行包含 $n$ 个不超过 $6$ 的正整数，依次表示编号为 $1,2,\\dots,n$ 的蚯蚓的长度。\n\n接下来 $m$ 行，每行表示一个操作。每个操作的格式可以为：\n\n* `1` $i$ $j$（$1 \\leq i, j \\leq n$）表示：令 $i$ 号与 $j$ 号蚯蚓**所在**的两个队伍合并为一个队伍，新队伍中，$j$ 号蚯蚓紧挨在 $i$ 号蚯蚓之后。保证在此操作之前，$i$ 号蚯蚓在某个队伍的队尾，$j$ 号蚯蚓在某个队伍的队首，且两只蚯蚓不在同一个队伍中。\n\n* `2` $i$（$1 \\leq i \\leq n$）表示：令 $i$ 号蚯蚓与紧挨其后一个蚯蚓分离为两个队伍。保证在此操作之前，$i$ 号蚯蚓不是某个队伍的队尾。\n\n* `3` $s$ $k$（$k$ 为正整数，$s$ 为一个长度至少为 $k$ 的数字串）表示：询问 $s$ 的每个长度为 $k$ 的子串 $t$ 的 $f(t)$ 的乘积，对 $998244353$ 取模的结果。$f(t)$ 的定义见题目描述。\n\n同一行输入的相邻两个元素之间，用恰好一个空格隔开。\n\n输入文件可能较大，请不要使用过于缓慢的读入方式。", "outputFormat": "依次对于每个形如 `3 s k` 的操作，输出一行，仅包含一个整数，表示询问的结果。", "hint": "保证 $n \\leq 2 \\times 10^{5}$，$m \\leq 5 \\times 10^{5}$，$k \\leq 50$ 。\n\n设 $\\sum |s|$ 为某个输入文件中所有询问的 $s$ 的长度总和，则 $\\sum |s| \\leq 10^{7}$  。\n\n设 $c$ 为某个输入文件中形如 `2 i` 的操作的次数，则 $c \\leq 10^{3}$ 。\n\n每个测试点的详细信息见下表：\n\n| 测试点编号 | $n$ | $m$ | $k$ | $\\sum \\|s\\|$ | $c$ | 全为 $\\texttt{1}$ |\n|:-:|:-:|:-:|:-:|:-:|:-:|:-:|\n| 1 | $=1$ | $\\leq 10^{3}$ | $=1$ | $\\leq 10^{3}$ | $=0$ | No |\n| 2 | $\\leq 20$ | $\\leq 40$ | $\\leq 10$ | $\\leq 10^{3}$ | $=0$ | No |\n| 3 | $\\leq 150$ | $\\leq 2,000$ | $\\leq 50$ | $\\leq 10^{3}$ | $\\leq 10^{3}$ | No |\n| 4 | $\\leq 500$ | $\\leq 600$ | $\\leq 50$ | $\\leq 10^{3}$ | $=0$ | No |\n| 5 | $\\leq 10^{3}$ | $\\leq 2,000$ | $\\leq 50$ | $\\leq 10^{3}$ | $\\leq 10^{3}$ | No |\n| 6 | $\\leq 5 \\times 10^{4}$ | $\\leq 6 \\times 10^{4}$ | $\\leq 5$ | $\\leq 5 \\times 10^{4}$ | $\\leq 10^{3}$ | No |\n| 7 | $\\leq 5 \\times 10^{4}$ | $\\leq 6 \\times 10^{4}$ | $\\leq 50$ | $\\leq 5 \\times 10^{4}$ | $=0$ | Yes |\n| 8 | $\\leq 5 \\times 10^{4}$ | $\\leq 6 \\times 10^{4}$ | $\\leq 50$ | $\\leq 5 \\times 10^{4}$ | $=0$ | No |\n| 9 | $\\leq 5 \\times 10^{4}$ | $\\leq 6 \\times 10^{4}$ | $\\leq 50$ | $\\leq 5 \\times 10^{4}$ | $\\leq 10^{3}$ | No |\n| 10 | $\\leq 5 \\times 10^{4}$ | $\\leq 8 \\times 10^{4}$ | $\\leq 50$ | $\\leq 2.5 \\times 10^{6}$ | $=0$ | No |\n| 11 | $\\leq 5 \\times 10^{4}$ | $\\leq 8 \\times 10^{4}$ | $\\leq 50$ | $\\leq 2.5 \\times 10^{6}$ | $\\leq 10^{3}$ | No |\n| 12 | $\\leq 10^{5}$ | $\\leq 1.1 \\times 10^{5}$ | $\\leq 6$ | $\\leq 10^{5}$ | $\\leq 10^{3}$ | No |\n| 13 | $\\leq 10^{5}$ | $\\leq 1.1 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{5}$ | $=0$ | Yes |\n| 14 | $\\leq 10^{5}$ | $\\leq 1.1 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{5}$ | $=0$ | No |\n| 15 | $\\leq 10^{5}$ | $\\leq 1.1 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{5}$ | $\\leq 10^{3}$ | No |\n| 16 | $\\leq 10^{5}$ | $\\leq 1.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 5 \\times 10^{6}$ | $=0$ | No |\n| 17 | $\\leq 10^{5}$ | $\\leq 1.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 5 \\times 10^{6}$ | $\\leq 10^{3}$ | No |\n| 18 | $\\leq 2 \\times 10^{5}$ | $\\leq 5 \\times 10^{5}$ | $=1$ | $\\leq 10^{7}$ | $=0$ | No |\n| 19 | $\\leq 2 \\times 10^{5}$ | $\\leq 5 \\times 10^{5}$ | $=1$ | $\\leq 10^{7}$ | $\\leq 10^{3}$ | No |\n| 20 | $\\leq 2 \\times 10^{5}$ | $\\leq 2.5 \\times 10^{5}$ | $\\leq 7$ | $\\leq 2 \\times 10^{5}$ | $\\leq 10^{3}$ | No |\n| 21 | $\\leq 2 \\times 10^{5}$ | $\\leq 2.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 2 \\times 10^{5}$ | $=0$ | Yes |\n| 22 | $\\leq 2 \\times 10^{5}$ | $\\leq 2.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 2 \\times 10^{5}$ | $=0$ | No |\n| 23 | $\\leq 2 \\times 10^{5}$ | $\\leq 2.5 \\times 10^{5}$ | $\\leq 50$ | $\\leq 2 \\times 10^{5}$ | $\\leq 10^{3}$ | No |\n| 24 | $\\leq 2 \\times 10^{5}$ | $\\leq 3 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{7}$ | $=0$ | No |\n| 25 | $\\leq 2 \\times 10^{5}$ | $\\leq 3 \\times 10^{5}$ | $\\leq 50$ | $\\leq 10^{7}$ | $\\leq 10^{3}$ | No |\n\n如果一个测试点的“全为`1`”的一列为“Yes”，表示该测试点的所有蚯蚓的长度均为 1，并且所有询问串 $s$ 的每一位也均为`1`。", "locale": "zh-CN"}}}
{"pid": "P3824", "type": "P", "difficulty": 7, "samples": [["10 5 1 2", "342025319"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 2000, 2500, 2500, 3000, 3000, 3000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["动态规划 DP", "递推", "2017", "多项式", "NOI", "O2优化", "动态规划优化", "前缀和", "概率论", "线性递推", "向量"], "title": "[NOI2017] 泳池", "background": "久莲是个爱玩的女孩子。\n\n暑假终于到了，久莲决定请她的朋友们来游泳，她打算先在她家的私人海滩外圈一块长方形的海域作为游泳场。然而大海里有着各种各样的危险，有些地方水太深，有些地方有带毒的水母出没。她想让圈出来的这一块海域都是安全的。\n", "description": "经过初步分析，这块海域可视为一个底边长为 $N$ 米，高为 $1001$ 米的长方形网格。其中网格的底边对应着她家的私人海滩，每一个 $1\\:\\textrm{m}\\times1\\:\\textrm{m}$ 的小正方形都代表着一个单位海域。她拜托了她爸爸明天去测量每一个小正方形是否安全。在得知了信息之后，她要做的就是圈出她想要的游泳场啦。  \n\n她心目中理想的游泳场满足如下三个条件：\n- 必须保证安全性。即游泳场中的每一个单位海域都是安全的。\n- 必须是矩形。即游泳场必须是整个网格中的一个 $a\\times b$ 的子网格。\n- 必须和海滩相邻。即游泳场的下边界必须紧贴网格的下边界。\n\n例如：当 $N = 5$ 时，若测量的结果如下（因为 $1001$ 太大，这儿只画出网格最下面三行的信息，其他部分都是危险的）。 \n\n ![](https://cdn.luogu.com.cn/upload/pic/6465.png) \n\n那么她可以选取最下面一行的 $1\\times4$ 的子海域，也可以选择第三列的 $3\\times1$ 的子海域。注意她不能选取最上面一行的 $1\\times5$ 的子海域，因为它没有与海滩相邻。\n\n为了让朋友们玩的开心，她想让游泳场的面积尽可能的大。因此她会选取最下面那一行的 $1\\times4$ 的子海域作为最终方案。\n\n虽然她要明天才能知道每一个单位海域是否安全，但是她现在就想行动起来估计一下她的游泳场面积有多大。经过简单的估计，她假设每一个单位海域都有独立的 $q$ 的概率是安全的，$1 − q$ 的概率是不安全的。她想要知道她能选择的最大的游泳场的面积**恰好**为 $K$ 的概率是多少。\n\n然而久莲对数学并不感兴趣，因此她想让你来帮她计算一下这个数值。", "inputFormat": "输入一行四个正整数 $N,K,x,y$，其中 $1 \\leq x < y < 998\\,244\\,353$。$q$ 的取值为 $\\dfrac{x}{y}$。", "outputFormat": "输出一行一个整数表示答案在模 $998\\,244\\,353$ 意义下的取值。\n\n即设答案化为最简分式后的形式为 $\\dfrac{a}{b}$ ，其中 $a$ 和 $b$ 的互质。输出整数 $x$ 使得 $bx \\equiv a \\mod 998\\,244\\,353$ 且 $0 \\leq x < 998\\,244\\,353$。可以证明这样的整数 $x$ 是唯一的。 ", "hint": "| 测试点编号 | $N$ | $K$ |\n|:-:|:-:|:-:|\n| 1,2 | $=1$ | $\\leq 1000$ |\n| 3 | $\\leq 10$ | $\\leq 8$ |\n| 4 | $\\leq 10$ | $\\leq 9$ |\n| 5 | $\\leq 10$ | $\\leq 10$ |\n| 6 | $\\leq 1000$ | $\\leq 7$ |\n| 7 | $\\leq 1000$ | $\\leq 8$ |\n| 8 | $\\leq 1000$ | $\\leq 9$ |\n| 9,10,11 | $\\leq 1000$ | $\\leq 100$ |\n| 12,13,14 | $\\leq 1000$ | $\\leq 1000$ |\n| 15,16 | $\\leq 10^9$ | $\\leq 10$ |\n| 17,18 | $\\leq 10^9$ | $\\leq 100$ |\n| 19,20 | $\\leq 10^9$ | $\\leq 1000$ |", "locale": "zh-CN", "translations": {"en": {"title": "[NOI2017] Swimming Pool", "background": "Jiulian is a playful girl.\n\nSummer vacation has finally arrived. Jiulian decides to invite her friends to go swimming, and she plans to fence off a rectangular sea area outside her private beach as the swimming field. However, the ocean has all kinds of dangers: some places are too deep, and some have poisonous jellyfish. She wants the fenced area to be completely safe.", "description": "After preliminary analysis, this sea area can be viewed as a rectangular grid with base length $N$ meters and height $1001$ meters. The base of the grid corresponds to her private beach, and each $1\\:\\textrm{m} \\times 1\\:\\textrm{m}$ small square represents one unit sea area. She will ask her father to measure tomorrow whether each small square is safe. After obtaining the information, all she needs to do is to fence out her desired swimming field.\n\nHer ideal swimming field must satisfy the following three conditions:\n- Safety. Every unit sea area in the swimming field must be safe.\n- Rectangular. The swimming field must be an $a \\times b$ subgrid of the whole grid.\n- Adjacent to the beach. The lower boundary of the swimming field must be flush with the bottom boundary of the grid.\n\nFor example: when $N = 5$, suppose the measurement results are as follows (since $1001$ is too large, only the bottom three rows are shown here; the other parts are unsafe).\n\n![](https://cdn.luogu.com.cn/upload/pic/6465.png)\n\nThen she can select the $1 \\times 4$ subregion in the bottom row, or the $3 \\times 1$ subregion in the third column. Note that she cannot select the $1 \\times 5$ subregion in the top row because it is not adjacent to the beach.\n\nTo maximize her friends’ fun, she wants the swimming field to have the largest possible area. Therefore she would choose the $1 \\times 4$ subregion in the bottom row as the final plan.\n\nAlthough she will only know tomorrow whether each unit sea area is safe, she wants to estimate now how large the area of her swimming field might be. With a simple estimate, she assumes each unit sea area is independently safe with probability $q$ and unsafe with probability $1 - q$. She wants to know the probability that the maximum area of a selectable swimming field is exactly $K$.\n\nHowever, Jiulian is not interested in mathematics, so she wants you to help her compute this value.", "inputFormat": "The input contains one line with four positive integers $N, K, x, y$, where $1 \\leq x < y < 998\\,244\\,353$. The value of $q$ is $\\dfrac{x}{y}$.", "outputFormat": "Output one integer: the value of the answer modulo $998\\,244\\,353$.\n\nThat is, write the answer as a reduced fraction $\\dfrac{a}{b}$ with $\\gcd(a, b) = 1$. Output the integer $x$ such that $b x \\equiv a \\bmod 998\\,244\\,353$ and $0 \\leq x < 998\\,244\\,353$. It can be proven that such an integer $x$ is unique.", "hint": "| Test point ID | $N$ | $K$ |\n|:-:|:-:|:-:|\n| 1,2 | $= 1$ | $\\leq 1000$ |\n| 3 | $\\leq 10$ | $\\leq 8$ |\n| 4 | $\\leq 10$ | $\\leq 9$ |\n| 5 | $\\leq 10$ | $\\leq 10$ |\n| 6 | $\\leq 1000$ | $\\leq 7$ |\n| 7 | $\\leq 1000$ | $\\leq 8$ |\n| 8 | $\\leq 1000$ | $\\leq 9$ |\n| 9,10,11 | $\\leq 1000$ | $\\leq 100$ |\n| 12,13,14 | $\\leq 1000$ | $\\leq 1000$ |\n| 15,16 | $\\leq 10^9$ | $\\leq 10$ |\n| 17,18 | $\\leq 10^9$ | $\\leq 100$ |\n| 19,20 | $\\leq 10^9$ | $\\leq 1000$ |\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[NOI2017] 泳池", "background": "久莲是个爱玩的女孩子。\n\n暑假终于到了，久莲决定请她的朋友们来游泳，她打算先在她家的私人海滩外圈一块长方形的海域作为游泳场。然而大海里有着各种各样的危险，有些地方水太深，有些地方有带毒的水母出没。她想让圈出来的这一块海域都是安全的。\n", "description": "经过初步分析，这块海域可视为一个底边长为 $N$ 米，高为 $1001$ 米的长方形网格。其中网格的底边对应着她家的私人海滩，每一个 $1\\:\\textrm{m}\\times1\\:\\textrm{m}$ 的小正方形都代表着一个单位海域。她拜托了她爸爸明天去测量每一个小正方形是否安全。在得知了信息之后，她要做的就是圈出她想要的游泳场啦。  \n\n她心目中理想的游泳场满足如下三个条件：\n- 必须保证安全性。即游泳场中的每一个单位海域都是安全的。\n- 必须是矩形。即游泳场必须是整个网格中的一个 $a\\times b$ 的子网格。\n- 必须和海滩相邻。即游泳场的下边界必须紧贴网格的下边界。\n\n例如：当 $N = 5$ 时，若测量的结果如下（因为 $1001$ 太大，这儿只画出网格最下面三行的信息，其他部分都是危险的）。 \n\n ![](https://cdn.luogu.com.cn/upload/pic/6465.png) \n\n那么她可以选取最下面一行的 $1\\times4$ 的子海域，也可以选择第三列的 $3\\times1$ 的子海域。注意她不能选取最上面一行的 $1\\times5$ 的子海域，因为它没有与海滩相邻。\n\n为了让朋友们玩的开心，她想让游泳场的面积尽可能的大。因此她会选取最下面那一行的 $1\\times4$ 的子海域作为最终方案。\n\n虽然她要明天才能知道每一个单位海域是否安全，但是她现在就想行动起来估计一下她的游泳场面积有多大。经过简单的估计，她假设每一个单位海域都有独立的 $q$ 的概率是安全的，$1 − q$ 的概率是不安全的。她想要知道她能选择的最大的游泳场的面积**恰好**为 $K$ 的概率是多少。\n\n然而久莲对数学并不感兴趣，因此她想让你来帮她计算一下这个数值。", "inputFormat": "输入一行四个正整数 $N,K,x,y$，其中 $1 \\leq x < y < 998\\,244\\,353$。$q$ 的取值为 $\\dfrac{x}{y}$。", "outputFormat": "输出一行一个整数表示答案在模 $998\\,244\\,353$ 意义下的取值。\n\n即设答案化为最简分式后的形式为 $\\dfrac{a}{b}$ ，其中 $a$ 和 $b$ 的互质。输出整数 $x$ 使得 $bx \\equiv a \\mod 998\\,244\\,353$ 且 $0 \\leq x < 998\\,244\\,353$。可以证明这样的整数 $x$ 是唯一的。 ", "hint": "| 测试点编号 | $N$ | $K$ |\n|:-:|:-:|:-:|\n| 1,2 | $=1$ | $\\leq 1000$ |\n| 3 | $\\leq 10$ | $\\leq 8$ |\n| 4 | $\\leq 10$ | $\\leq 9$ |\n| 5 | $\\leq 10$ | $\\leq 10$ |\n| 6 | $\\leq 1000$ | $\\leq 7$ |\n| 7 | $\\leq 1000$ | $\\leq 8$ |\n| 8 | $\\leq 1000$ | $\\leq 9$ |\n| 9,10,11 | $\\leq 1000$ | $\\leq 100$ |\n| 12,13,14 | $\\leq 1000$ | $\\leq 1000$ |\n| 15,16 | $\\leq 10^9$ | $\\leq 10$ |\n| 17,18 | $\\leq 10^9$ | $\\leq 100$ |\n| 19,20 | $\\leq 10^9$ | $\\leq 1000$ |", "locale": "zh-CN"}}}
{"pid": "P3825", "type": "P", "difficulty": 6, "samples": [["3 1\nxcc\n1\n1 A 2 B", "ABA"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["2017", "NOI", "Special Judge", "O2优化", "拓扑排序", "2-SAT", "强连通分量"], "title": "[NOI2017] 游戏", "background": "【本题原题时限 1s】\n\n狂野飙车是小 L 最喜欢的游戏。与其他业余玩家不同的是，小 L 在玩游戏之余，还精于研究游戏的设计，因此他有着与众不同的游戏策略。\n", "description": "小 L 计划进行 $n$ 场游戏，每场游戏使用一张地图，小 L 会选择一辆车在该地图上完成游戏。\n\n小 L 的赛车有三辆，分别用大写字母 $A$、$B$、$C$ 表示。地图一共有四种，分别用小写字母 $x$、$a$、$b$、$c$ 表示。\n\n其中，赛车 $A$ 不适合在地图 $a$ 上使用，赛车 $B$ 不适合在地图 $b$ 上使用，赛车 $C$ 不适合在地图 $c$ 上使用，而地图 $x$ 则适合所有赛车参加。\n\n适合所有赛车参加的地图并不多见，最多只会有 $d$ 张。\n\n$n$ 场游戏的地图可以用一个小写字母组成的字符串描述。例如：$S=\\texttt{xaabxcbc}$ 表示小 L 计划进行 $8$ 场游戏，其中第 $1$ 场和第 $5$ 场的地图类型是 $x$，适合所有赛车，第 $2$ 场和第 $3$ 场的地图是 $a$，不适合赛车 $A$，第 $4$ 场和第 $7$ 场的地图是 $b$，不适合赛车 $B$，第 $6$ 场和第 $8$ 场的地图是 $c$，不适合赛车 $C$。\n\n小 L 对游戏有一些特殊的要求，这些要求可以用四元组 $ (i, h_i, j, h_j) $ 来描述，表示若在第 $i$ 场使用型号为 $h_i$ 的车子，则第 $j$ 场游戏要使用型号为 $h_j$ 的车子。\n\n你能帮小 L 选择每场游戏使用的赛车吗？如果有多种方案，输出任意一种方案。\n\n如果无解，输出 `-1`。", "inputFormat": "输入第一行包含两个非负整数 $n$, $d$。\n\n输入第二行为一个字符串 $S$。\n\n$n$, $d$, $S$ 的含义见题目描述，其中 $S$ 包含 $n$ 个字符，且其中恰好 $d$ 个为小写字母 $x$。\n\n输入第三行为一个正整数 $m$ ，表示有 $m$ 条用车规则。\n\n接下来 $m$ 行，每行包含一个四元组 $i,h_i,j,h_j$ ，其中 $i,j$ 为整数，$h_i,h_j$ 为字符 $A$ 、$B$ 或 $C$，含义见题目描述。", "outputFormat": "输出一行。\n\n若无解输出 `-1`。\n\n若有解，则包含一个长度为 $n$ 的仅包含大写字母 A、B、C 的字符串，表示小 L 在这 $n$ 场游戏中如何安排赛车的使用。如果存在多组解，输出其中任意一组即可。", "hint": "### 样例 1 解释\n\n小 $L$ 计划进行 $3$ 场游戏，其中第 $1$ 场的地图类型是 $x$，适合所有赛车，第 $2$ 场和第 $3$ 场的地图是 $c$，不适合赛车 $C$。\n\n小 $L$ 希望：若第 $1$ 场游戏使用赛车 $A$，则第 $2$ 场游戏使用赛车 $B$。\n\n那么为这 $3$ 场游戏分别安排赛车 $A$、$B$、$A$ 可以满足所有条件。\n\n若依次为 $3$ 场游戏安排赛车为 $BBB$ 或 $BAA$ 时，也可以满足所有条件，也被视为正确答案。\n\n但依次安排赛车为 $AAB$ 或 $ABC$ 时，因为不能满足所有条件，所以不被视为正确答案。\n\n### 样例 2\n\n详见附加文件。\n\n### 数据范围\n\n| 测试点编号 |        $n$         |   $d$   |    $m$     |        其他性质         |\n| :--------: | :----------------: | :-----: | :--------: | :---------------------: |\n|    $1$     |      $\\le 2$       |   $0$   |  $\\le 4$   |           无            |\n|    $2$     |      $\\le 2$       | $\\le n$ |  $\\le 4$   |           无            |\n|    $3$     |      $\\le 5$       |   $0$   |  $\\le 10$  |           无            |\n|    $4$     |      $\\le 5$       | $\\le n$ |  $\\le 10$  |           无            |\n|    $5$     |      $\\le 10$      |   $0$   |  $\\le 20$  |           无            |\n|    $6$     |      $\\le 10$      | $\\le 8$ |  $\\le 20$  |           无            |\n|    $7$     |      $\\le 20$      |   $0$   |  $\\le 40$  |    $S$ 中只包含 $c$     |\n|    $8$     |      $\\le 20$      |   $0$   |  $\\le 40$  |           无            |\n|    $9$     |      $\\le 20$      | $\\le 8$ |  $\\le 40$  | $S$ 中只包含 $x$ 或 $c$ |\n|    $10$    |      $\\le 20$      | $\\le 8$ |  $\\le 40$  |           无            |\n|    $11$    |     $\\le 100$      |   $0$   | $\\le 200$  |    $S$ 中只包含 $c$     |\n|    $12$    |     $\\le 100$      |   $0$   | $\\le 200$  |           无            |\n|    $13$    |     $\\le 100$      | $\\le 8$ | $\\le 200$  | $S$ 中只包含 $x$ 或 $c$ |\n|    $14$    |     $\\le 100$      | $\\le 8$ | $\\le 200$  |           无            |\n|    $15$    | $\\le 5\\times 10^3$ |   $0$   | $\\le 10^4$ |           无            |\n|    $16$    | $\\le 5\\times 10^3$ | $\\le 8$ | $\\le 10^4$ | $S$ 中只包含 $x$ 或 $c$ |\n|    $17$    | $\\le 5\\times 10^3$ | $\\le 8$ | $\\le 10^4$ |           无            |\n|    $18$    | $\\le 5\\times 10^4$ |   $0$   | $\\le 10^5$ |           无            |\n|    $19$    | $\\le 5\\times 10^4$ | $\\le 8$ | $\\le 10^5$ | $S$ 中只包含 $x$ 或 $c$ |\n|    $20$    | $\\le 5\\times 10^4$ | $\\le 8$ | $\\le 10^5$ |           无            |", "locale": "zh-CN", "translations": {"en": {"title": "[NOI2017] Game", "background": "[Original problem time limit: 1 s.]\n\nAsphalt is Little L’s favorite game. Unlike other casual players, Little L studies game design in his spare time, so he has a unique strategy for playing.", "description": "Little L plans to play $n$ games. Each game uses one map, and Little L will choose a car to complete the game on that map.\n\nLittle L has three cars, denoted by uppercase letters $A$, $B$, and $C$. There are four types of maps, denoted by lowercase letters $x$, $a$, $b$, and $c$.\n\nAmong them, car $A$ is not suitable for map $a$, car $B$ is not suitable for map $b$, car $C$ is not suitable for map $c$, while map $x$ is suitable for all cars.\n\nMaps that are suitable for all cars are rare; there will be at most $d$ of them.\n\nThe maps for the $n$ games can be described by a string of lowercase letters. For example, $S=\\texttt{xaabxcbc}$ means Little L plans to play $8$ games: the $1$-st and $5$-th maps are of type $x$, suitable for all cars; the $2$-nd and $3$-rd maps are of type $a$, unsuitable for car $A$; the $4$-th and $7$-th maps are of type $b$, unsuitable for car $B$; and the $6$-th and $8$-th maps are of type $c$, unsuitable for car $C$.\n\nLittle L has some special requirements, which can be described by a quadruple $(i, h_i, j, h_j)$, meaning: if the car used in game $i$ is $h_i$, then the car used in game $j$ must be $h_j$.\n\nCan you help Little L choose a car for each game? If there are multiple solutions, output any of them.\n\nIf there is no solution, output `-1`.", "inputFormat": "The first line contains two non-negative integers, $n$ and $d$.\n\nThe second line contains a string $S$.\n\nThe meanings of $n$, $d$, and $S$ are as described above. The string $S$ contains $n$ characters, and exactly $d$ of them are the lowercase letter $x$.\n\nThe third line contains a positive integer $m$, indicating that there are $m$ car-usage rules.\n\nThe next $m$ lines each contain a quadruple $i, h_i, j, h_j$, where $i$ and $j$ are integers, and $h_i$ and $h_j$ are characters among $A$, $B$, and $C$, with meanings as described above.", "outputFormat": "Output one line.\n\nIf there is no solution, output `-1`.\n\nIf there is a solution, output a string of length $n$ consisting only of uppercase letters $A$, $B$, and $C$, indicating how Little L arranges the cars for these $n$ games. If multiple solutions exist, output any one of them.", "hint": "### Sample 1 Explanation\n\nLittle $L$ plans to play $3$ games. The $1$-st map is of type $x$, suitable for all cars, and the $2$-nd and $3$-rd maps are of type $c$, unsuitable for car $C$.\n\nLittle $L$ requires: if car $A$ is used in game $1$, then car $B$ must be used in game $2$.\n\nAssigning cars $A$, $B$, $A$ to the $3$ games satisfies all conditions.\n\nAssigning cars $B B B$ or $B A A$ to the $3$ games also satisfies all conditions and is considered correct.\n\nHowever, assigning cars $A A B$ or $A B C$ does not satisfy all conditions, so it is not considered correct.\n\n### Sample 2\n\nSee the attached file.\n\n### Constraints\n\n| Test point ID |        $n$         |   $d$   |    $m$     |        Other properties        |\n| :-----------: | :----------------: | :-----: | :--------: | :----------------------------: |\n|      $1$      |      $\\le 2$       |   $0$   |  $\\le 4$   |              None              |\n|      $2$      |      $\\le 2$       | $\\le n$ |  $\\le 4$   |              None              |\n|      $3$      |      $\\le 5$       |   $0$   |  $\\le 10$  |              None              |\n|      $4$      |      $\\le 5$       | $\\le n$ |  $\\le 10$  |              None              |\n|      $5$      |      $\\le 10$      |   $0$   |  $\\le 20$  |              None              |\n|      $6$      |      $\\le 10$      | $\\le 8$ |  $\\le 20$  |              None              |\n|      $7$      |      $\\le 20$      |   $0$   |  $\\le 40$  |     $S$ only contains $c$      |\n|      $8$      |      $\\le 20$      |   $0$   |  $\\le 40$  |              None              |\n|      $9$      |      $\\le 20$      | $\\le 8$ |  $\\le 40$  | $S$ only contains $x$ or $c$   |\n|     $10$      |      $\\le 20$      | $\\le 8$ |  $\\le 40$  |              None              |\n|     $11$      |     $\\le 100$      |   $0$   | $\\le 200$  |     $S$ only contains $c$      |\n|     $12$      |     $\\le 100$      |   $0$   | $\\le 200$  |              None              |\n|     $13$      |     $\\le 100$      | $\\le 8$ | $\\le 200$  | $S$ only contains $x$ or $c$   |\n|     $14$      |     $\\le 100$      | $\\le 8$ | $\\le 200$  |              None              |\n|     $15$      | $\\le 5\\times 10^3$ |   $0$   | $\\le 10^4$ |              None              |\n|     $16$      | $\\le 5\\times 10^3$ | $\\le 8$ | $\\le 10^4$ | $S$ only contains $x$ or $c$   |\n|     $17$      | $\\le 5\\times 10^3$ | $\\le 8$ | $\\le 10^4$ |              None              |\n|     $18$      | $\\le 5\\times 10^4$ |   $0$   | $\\le 10^5$ |              None              |\n|     $19$      | $\\le 5\\times 10^4$ | $\\le 8$ | $\\le 10^5$ | $S$ only contains $x$ or $c$   |\n|     $20$      | $\\le 5\\times 10^4$ | $\\le 8$ | $\\le 10^5$ |              None              |\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[NOI2017] 游戏", "background": "【本题原题时限 1s】\n\n狂野飙车是小 L 最喜欢的游戏。与其他业余玩家不同的是，小 L 在玩游戏之余，还精于研究游戏的设计，因此他有着与众不同的游戏策略。\n", "description": "小 L 计划进行 $n$ 场游戏，每场游戏使用一张地图，小 L 会选择一辆车在该地图上完成游戏。\n\n小 L 的赛车有三辆，分别用大写字母 $A$、$B$、$C$ 表示。地图一共有四种，分别用小写字母 $x$、$a$、$b$、$c$ 表示。\n\n其中，赛车 $A$ 不适合在地图 $a$ 上使用，赛车 $B$ 不适合在地图 $b$ 上使用，赛车 $C$ 不适合在地图 $c$ 上使用，而地图 $x$ 则适合所有赛车参加。\n\n适合所有赛车参加的地图并不多见，最多只会有 $d$ 张。\n\n$n$ 场游戏的地图可以用一个小写字母组成的字符串描述。例如：$S=\\texttt{xaabxcbc}$ 表示小 L 计划进行 $8$ 场游戏，其中第 $1$ 场和第 $5$ 场的地图类型是 $x$，适合所有赛车，第 $2$ 场和第 $3$ 场的地图是 $a$，不适合赛车 $A$，第 $4$ 场和第 $7$ 场的地图是 $b$，不适合赛车 $B$，第 $6$ 场和第 $8$ 场的地图是 $c$，不适合赛车 $C$。\n\n小 L 对游戏有一些特殊的要求，这些要求可以用四元组 $ (i, h_i, j, h_j) $ 来描述，表示若在第 $i$ 场使用型号为 $h_i$ 的车子，则第 $j$ 场游戏要使用型号为 $h_j$ 的车子。\n\n你能帮小 L 选择每场游戏使用的赛车吗？如果有多种方案，输出任意一种方案。\n\n如果无解，输出 `-1`。", "inputFormat": "输入第一行包含两个非负整数 $n$, $d$。\n\n输入第二行为一个字符串 $S$。\n\n$n$, $d$, $S$ 的含义见题目描述，其中 $S$ 包含 $n$ 个字符，且其中恰好 $d$ 个为小写字母 $x$。\n\n输入第三行为一个正整数 $m$ ，表示有 $m$ 条用车规则。\n\n接下来 $m$ 行，每行包含一个四元组 $i,h_i,j,h_j$ ，其中 $i,j$ 为整数，$h_i,h_j$ 为字符 $A$ 、$B$ 或 $C$，含义见题目描述。", "outputFormat": "输出一行。\n\n若无解输出 `-1`。\n\n若有解，则包含一个长度为 $n$ 的仅包含大写字母 A、B、C 的字符串，表示小 L 在这 $n$ 场游戏中如何安排赛车的使用。如果存在多组解，输出其中任意一组即可。", "hint": "### 样例 1 解释\n\n小 $L$ 计划进行 $3$ 场游戏，其中第 $1$ 场的地图类型是 $x$，适合所有赛车，第 $2$ 场和第 $3$ 场的地图是 $c$，不适合赛车 $C$。\n\n小 $L$ 希望：若第 $1$ 场游戏使用赛车 $A$，则第 $2$ 场游戏使用赛车 $B$。\n\n那么为这 $3$ 场游戏分别安排赛车 $A$、$B$、$A$ 可以满足所有条件。\n\n若依次为 $3$ 场游戏安排赛车为 $BBB$ 或 $BAA$ 时，也可以满足所有条件，也被视为正确答案。\n\n但依次安排赛车为 $AAB$ 或 $ABC$ 时，因为不能满足所有条件，所以不被视为正确答案。\n\n### 样例 2\n\n详见附加文件。\n\n### 数据范围\n\n| 测试点编号 |        $n$         |   $d$   |    $m$     |        其他性质         |\n| :--------: | :----------------: | :-----: | :--------: | :---------------------: |\n|    $1$     |      $\\le 2$       |   $0$   |  $\\le 4$   |           无            |\n|    $2$     |      $\\le 2$       | $\\le n$ |  $\\le 4$   |           无            |\n|    $3$     |      $\\le 5$       |   $0$   |  $\\le 10$  |           无            |\n|    $4$     |      $\\le 5$       | $\\le n$ |  $\\le 10$  |           无            |\n|    $5$     |      $\\le 10$      |   $0$   |  $\\le 20$  |           无            |\n|    $6$     |      $\\le 10$      | $\\le 8$ |  $\\le 20$  |           无            |\n|    $7$     |      $\\le 20$      |   $0$   |  $\\le 40$  |    $S$ 中只包含 $c$     |\n|    $8$     |      $\\le 20$      |   $0$   |  $\\le 40$  |           无            |\n|    $9$     |      $\\le 20$      | $\\le 8$ |  $\\le 40$  | $S$ 中只包含 $x$ 或 $c$ |\n|    $10$    |      $\\le 20$      | $\\le 8$ |  $\\le 40$  |           无            |\n|    $11$    |     $\\le 100$      |   $0$   | $\\le 200$  |    $S$ 中只包含 $c$     |\n|    $12$    |     $\\le 100$      |   $0$   | $\\le 200$  |           无            |\n|    $13$    |     $\\le 100$      | $\\le 8$ | $\\le 200$  | $S$ 中只包含 $x$ 或 $c$ |\n|    $14$    |     $\\le 100$      | $\\le 8$ | $\\le 200$  |           无            |\n|    $15$    | $\\le 5\\times 10^3$ |   $0$   | $\\le 10^4$ |           无            |\n|    $16$    | $\\le 5\\times 10^3$ | $\\le 8$ | $\\le 10^4$ | $S$ 中只包含 $x$ 或 $c$ |\n|    $17$    | $\\le 5\\times 10^3$ | $\\le 8$ | $\\le 10^4$ |           无            |\n|    $18$    | $\\le 5\\times 10^4$ |   $0$   | $\\le 10^5$ |           无            |\n|    $19$    | $\\le 5\\times 10^4$ | $\\le 8$ | $\\le 10^5$ | $S$ 中只包含 $x$ 或 $c$ |\n|    $20$    | $\\le 5\\times 10^4$ | $\\le 8$ | $\\le 10^5$ |           无            |", "locale": "zh-CN"}}}
{"pid": "P3826", "type": "P", "difficulty": 7, "samples": [["2 3 2\n3 3 3 3\n2 5 8 3\n1\n3\n", "16\n27\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144, 262144]}, "tags": ["贪心", "递推", "2017", "NOI", "O2优化", "栈", "反悔贪心"], "title": "[NOI2017] 蔬菜", "background": "", "description": "小 N 是蔬菜仓库的管理员，负责设计蔬菜的销售方案。\n\n在蔬菜仓库中，共存放有 $n$ 种蔬菜，小 N 需要根据不同蔬菜的特性，综合考虑各方面因素，设计合理的销售方案，以获得最多的收益。\n\n在计算销售蔬菜的收益时，每销售一个单位第 $i$ 种蔬菜，就可以获得 $a_i$ 的收益。\n\n特别地，由于政策鼓励商家进行多样化销售，第一次销售第 $i$ 种蔬菜时，还会额外得到 $s_i$ 的额外收益。\n\n在经营开始时，第 $i$ 种蔬菜的库存为 $c_i$ 个单位。\n\n然而，蔬菜的保鲜时间非常有限，一旦变质就不能进行销售，不过聪明的小 N 已经计算出了每个单位蔬菜变质的时间：对于第 $i$ 种蔬菜，存在保鲜值 $x_i$，每天结束时会有 $x_i$ 个单位的蔬菜变质，直到所有蔬菜都变质。（注意：每一单位蔬菜的变质时间是固定的，不随销售发生变化）\n\n形式化地：对于所有的满足条件 $d\\times x_i \\leq c_i$ 的正整数 $d$，有 $x_i$ 个单位的蔬菜将在第 $d$ 天结束时变质。\n\n特别地，若 $(d - 1)\\times x_i \\leq c_i < d\\times x_i$，则有 $c_i - (d - 1)\\times x_i$ 单位的蔬菜将在第 $d$ 天结束时变质。\n\n注意，当 $x_i = 0$ 时，意味着这种蔬菜不会变质。\n\n同时，每天销售的蔬菜，总量也是有限的，最多不能超过 $m$ 个单位。\n\n现在，小 N 有 $k$ 个问题，想请你帮忙算一算。每个问题的形式都是：对于已知的 $p_j$，如果需要销售 $p_j$ 天，最多能获得多少收益？", "inputFormat": "第一行包含三个正整数 $n,m,k$，分别表示蔬菜的种类数目、每天能售出蔬菜总量上限、小 N 提出的问题的个数。\n\n接下来 $n$ 行，每行输入四个非负整数，描述一种蔬菜的特点，依次为 $a_i,s_i,c_i,x_i$，意义如上文所述。\n\n接下来 $k$ 行，每行输入一个非负整数 $p_j$，意义如上文所述。", "outputFormat": "输出 $k$ 行，每行包含一个整数，第 $i$ 行的数表示第 $i$ 个问题的答案。", "hint": "### 样例解释\n\n共有两种蔬菜：\n\n销售第 $1$ 种蔬菜时，每销售一单位可以获得的收益为 $3$，第一次销售这种蔬菜时，额外可以获得的收益为 $3$。这种蔬菜共有 $3$ 个单位，均会在第一天结束时变质。\n\n销售第 $2$ 种蔬菜时，每销售一单位可以获得的收益为 $2$，第一次销售这种蔬菜时，额外可以获得的收益为 $5$。这种蔬菜共有 $8$ 个单位，其中，有 $3$ 单位在第一天结束时变质，$3$ 单位在第二天结束时变质，$2$ 单位在第三天结束时变质。\n\n在只销售 $1$ 天时，应当销售 $2$ 单位的第一种蔬菜和 $1$ 单位的第二种蔬菜。\n\n在这种情况下：销售第一种蔬菜的收益为 $2 \\times 3 + 3$；销售第二种蔬菜的收益为 $1 \\times 2 + 5$；总共获得的收益为 $(2 \\times 3 + 3) + (1 \\times 2 + 5) = 16$。\n\n在只销售 $3$ 天时，第一天应当销售 $3$ 单位的第一种蔬菜，第二天应当销售 $3$ 单位的第二种蔬菜（此时选择在第二天结束时会变质的 $3$ 个单位出售），第三天销售 $2$ 单位的第二种蔬菜。\n\n在这种情况下：销售第一种蔬菜的收益为 $3 \\times 3 + 3$；销售第二种蔬菜的收益为 $(3 + 2) \\times 2 + 5$；总共获得的收益为 $(3 \\times 3 + 3) + [(3 + 2) \\times 2 + 5] = 27$。\n\n### 数据范围\n\n::cute-table{tuack}\n\n| 测试点编号 |    $n$     |   $m$    |   $p_j$    | 特性 $1$ |    特性 $2$    |\n| :--------: | :--------: | :------: | :--------: | :------: | :------------: |\n|    $1$     |  $\\le 2$   | $\\le 10$ | $\\le 10^3$ |    无    |       无       |\n|    $2$     |  $\\le 3$   | ^ | ^ |    ^    |       ^       |\n|    $3$     |  $\\le 4$   | ^ | ^ |    ^    |       ^       |\n|    $4$     | $\\le 10^3$ | ^ |  $\\le 2$   |    ^    |       ^       |\n|    $5$     | ^ | ^ |  $\\le 3$   |    ^    |       ^       |\n|    $6$     | ^ | ^ |  $\\le 4$   |    ^    |       ^       |\n|    $7$     |  $\\le 4$   | $\\le 1$  |  ^   |    ^    |       ^       |\n|    $8$     |  $\\le 6$   | $\\le 2$  |  $\\le 6$   |    ^    |       ^       |\n|    $9$     |  $\\le 8$   | $\\le 1$  |  $\\le 8$   |    ^    |       ^       |\n|    $10$    |  $\\le 10$  | $\\le 2$  |  $\\le 10$  |    ^    |       ^       |\n|    $11$    |  $\\le 20$  | $\\le 3$  |  $\\le 20$  |    ^    |       ^       |\n|    $12$    | $\\le 10^2$ | $\\le 10$ | $\\le 10^2$ |    有    | ^ |\n|    $13$    | ^ | ^ | ^ |    无    |       有       |\n|    $14$    | ^ | ^ | ^ |    ^    | 无 |\n|    $15$    | ^ | ^ | ^ |    ^    | ^ |\n|    $16$    | $\\le 10^3$ | ^ | $\\le 10^3$ |    有    | 有 |\n|    $17$    | ^ | ^ | ^ |    ^    | 无 |\n|    $18$    | ^ | ^ | ^ |    无    |       有       |\n|    $19$    | ^ | ^ | ^ |    ^    | 无 |\n|    $20$    | ^ | ^ | ^ |    ^    | ^ |\n|    $21$    | $\\le 10^5$ | ^ | $\\le 10^5$ |    有    | 有 |\n|    $22$    | ^ | ^ | ^ |    ^    |       无       |\n|    $23$    | ^ | ^ | ^ |    无    |       有       |\n|    $24$    | ^ | ^ | ^ |    ^    |       无       |\n|    $25$    | ^ | ^ | ^ |    ^    |       ^       |\n\n特性 $1$：所有的 $s_i$ 均为 $0$；\n\n特性 $2$：所有的 $x_i$ 均为 $0$。\n\n对于所有的测试数据，均保证 $k$ 组询问中的 $p_j$ 互不相同。\n\n对于所有的测试数据，均保证 $0<a_i,c_i\\le 10^9$，$0\\le s_i,x_i\\le 10^9$。", "locale": "zh-CN", "translations": {"en": {"title": "[NOI2017] Vegetables", "background": "", "description": "Xiao N is the administrator of a vegetable warehouse, responsible for designing a sales plan for the vegetables.\n\nThere are $n$ types of vegetables stored in the warehouse. Xiao N needs to design a reasonable sales plan by considering various factors based on the characteristics of different vegetables, in order to obtain the maximum profit.\n\nWhen calculating the profit from selling vegetables, for each unit of the $i$-th vegetable sold, a profit of $a_i$ is obtained.\n\nIn particular, due to policies that encourage diversified sales, the first time the $i$-th vegetable is sold, an additional bonus profit of $s_i$ is also obtained.\n\nAt the beginning of operations, the inventory of the $i$-th vegetable is $c_i$ units.\n\nHowever, vegetables have a very limited freshness period. Once spoiled, they cannot be sold. Fortunately, Xiao N has already calculated the spoilage time of each unit of vegetable: for the $i$-th vegetable, there exists a freshness parameter $x_i$. At the end of each day, $x_i$ units of this vegetable will spoil, until all units have spoiled. (Note: The spoilage time of each unit is fixed and does not change due to sales.)\n\nFormally: for every positive integer $d$ such that $d \\times x_i \\leq c_i$, there will be $x_i$ units of the $i$-th vegetable spoiling at the end of day $d$.\n\nIn particular, if $(d - 1) \\times x_i \\leq c_i < d \\times x_i$, then $c_i - (d - 1) \\times x_i$ units of the $i$-th vegetable will spoil at the end of day $d$.\n\nNote that when $x_i = 0$, it means this vegetable never spoils.\n\nMeanwhile, the total number of vegetables that can be sold per day is limited to at most $m$ units.\n\nNow, Xiao N has $k$ questions and asks for your help. Each question is: given $p_j$, if sales last for $p_j$ days, what is the maximum profit that can be obtained?", "inputFormat": "The first line contains three positive integers $n, m, k$, representing the number of vegetable types, the maximum total number of vegetable units that can be sold per day, and the number of questions asked by Xiao N, respectively.\n\nThe next $n$ lines each contain four non-negative integers describing the characteristics of one type of vegetable, in the order $a_i, s_i, c_i, x_i$, with meanings as described above.\n\nThe next $k$ lines each contain one non-negative integer $p_j$, with the meaning as described above.", "outputFormat": "Output $k$ lines. The number on the $i$-th line is the answer to the $i$-th question.", "hint": "### Sample Explanation\n\nThere are two types of vegetables:\n\nFor the $1$-st vegetable, the profit per unit sold is $3$, and an additional bonus profit of $3$ is obtained when selling this vegetable for the first time. There are $3$ units in total, and all of them will spoil at the end of day $1$.\n\nFor the $2$-nd vegetable, the profit per unit sold is $2$, and an additional bonus profit of $5$ is obtained when selling this vegetable for the first time. There are $8$ units in total, among which $3$ units spoil at the end of day $1$, $3$ units spoil at the end of day $2$, and $2$ units spoil at the end of day $3$.\n\nIf sales last for $1$ day, you should sell $2$ units of the first vegetable and $1$ unit of the second vegetable.\n\nIn this case: the profit from selling the first vegetable is $2 \\times 3 + 3$; the profit from selling the second vegetable is $1 \\times 2 + 5$; the total profit is $(2 \\times 3 + 3) + (1 \\times 2 + 5) = 16$.\n\nIf sales last for $3$ days, on day $1$ you should sell $3$ units of the first vegetable, on day $2$ you should sell $3$ units of the second vegetable (choose the $3$ units that will spoil at the end of day $2$), and on day $3$ you should sell $2$ units of the second vegetable.\n\nIn this case: the profit from selling the first vegetable is $3 \\times 3 + 3$; the profit from selling the second vegetable is $(3 + 2) \\times 2 + 5$; the total profit is $(3 \\times 3 + 3) + [(3 + 2) \\times 2 + 5] = 27$.\n\n### Constraints\n\n::cute-table{tuack}\n| Test point ID |     $n$     |    $m$    |   $p_j$    | Feature $1$ |    Feature $2$    |\n| :-----------: | :---------: | :-------: | :--------: | :---------: | :---------------: |\n|      $1$      |   $\\le 2$   | $\\le 10$  | $\\le 10^3$ |     No      |        No         |\n|      $2$      |   $\\le 3$   | ^         | ^          |     ^       |        ^          |\n|      $3$      |   $\\le 4$   | ^         | ^          |     ^       |        ^          |\n|      $4$      | $\\le 10^3$  | ^         | $\\le 2$    |     ^       |        ^          |\n|      $5$      | ^           | ^         | $\\le 3$    |     ^       |        ^          |\n|      $6$      | ^           | ^         | $\\le 4$    |     ^       |        ^          |\n|      $7$      |   $\\le 4$   | $\\le 1$   | ^          |     ^       |        ^          |\n|      $8$      |   $\\le 6$   | $\\le 2$   | $\\le 6$    |     ^       |        ^          |\n|      $9$      |   $\\le 8$   | $\\le 1$   | $\\le 8$    |     ^       |        ^          |\n|     $10$      |  $\\le 10$   | $\\le 2$   | $\\le 10$   |     ^       |        ^          |\n|     $11$      |  $\\le 20$   | $\\le 3$   | $\\le 20$   |     ^       |        ^          |\n|     $12$      | $\\le 10^2$  | $\\le 10$  | $\\le 10^2$ |     Yes     |        ^          |\n|     $13$      | ^           | ^         | ^          |     No      |        Yes        |\n|     $14$      | ^           | ^         | ^          |     ^       |        No         |\n|     $15$      | ^           | ^         | ^          |     ^       |        ^          |\n|     $16$      | $\\le 10^3$  | ^         | $\\le 10^3$ |     Yes     |        Yes        |\n|     $17$      | ^           | ^         | ^          |     ^       |        No         |\n|     $18$      | ^           | ^         | ^          |     No      |        Yes        |\n|     $19$      | ^           | ^         | ^          |     ^       |        No         |\n|     $20$      | ^           | ^         | ^          |     ^       |        ^          |\n|     $21$      | $\\le 10^5$  | ^         | $\\le 10^5$ |     Yes     |        Yes        |\n|     $22$      | ^           | ^         | ^          |     ^       |        No         |\n|     $23$      | ^           | ^         | ^          |     No      |        Yes        |\n|     $24$      | ^           | ^         | ^          |     ^       |        No         |\n|     $25$      | ^           | ^         | ^          |     ^       |        ^          |\n\nFeature $1$: all $s_i$ are $0$.\n\nFeature $2$: all $x_i$ are $0$.\n\nFor all testdata, it is guaranteed that the $p_j$ in the $k$ queries are pairwise distinct.\n\nFor all testdata, it is guaranteed that $0 < a_i, c_i \\le 10^9$, $0 \\le s_i, x_i \\le 10^9$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[NOI2017] 蔬菜", "background": "", "description": "小 N 是蔬菜仓库的管理员，负责设计蔬菜的销售方案。\n\n在蔬菜仓库中，共存放有 $n$ 种蔬菜，小 N 需要根据不同蔬菜的特性，综合考虑各方面因素，设计合理的销售方案，以获得最多的收益。\n\n在计算销售蔬菜的收益时，每销售一个单位第 $i$ 种蔬菜，就可以获得 $a_i$ 的收益。\n\n特别地，由于政策鼓励商家进行多样化销售，第一次销售第 $i$ 种蔬菜时，还会额外得到 $s_i$ 的额外收益。\n\n在经营开始时，第 $i$ 种蔬菜的库存为 $c_i$ 个单位。\n\n然而，蔬菜的保鲜时间非常有限，一旦变质就不能进行销售，不过聪明的小 N 已经计算出了每个单位蔬菜变质的时间：对于第 $i$ 种蔬菜，存在保鲜值 $x_i$，每天结束时会有 $x_i$ 个单位的蔬菜变质，直到所有蔬菜都变质。（注意：每一单位蔬菜的变质时间是固定的，不随销售发生变化）\n\n形式化地：对于所有的满足条件 $d\\times x_i \\leq c_i$ 的正整数 $d$，有 $x_i$ 个单位的蔬菜将在第 $d$ 天结束时变质。\n\n特别地，若 $(d - 1)\\times x_i \\leq c_i < d\\times x_i$，则有 $c_i - (d - 1)\\times x_i$ 单位的蔬菜将在第 $d$ 天结束时变质。\n\n注意，当 $x_i = 0$ 时，意味着这种蔬菜不会变质。\n\n同时，每天销售的蔬菜，总量也是有限的，最多不能超过 $m$ 个单位。\n\n现在，小 N 有 $k$ 个问题，想请你帮忙算一算。每个问题的形式都是：对于已知的 $p_j$，如果需要销售 $p_j$ 天，最多能获得多少收益？", "inputFormat": "第一行包含三个正整数 $n,m,k$，分别表示蔬菜的种类数目、每天能售出蔬菜总量上限、小 N 提出的问题的个数。\n\n接下来 $n$ 行，每行输入四个非负整数，描述一种蔬菜的特点，依次为 $a_i,s_i,c_i,x_i$，意义如上文所述。\n\n接下来 $k$ 行，每行输入一个非负整数 $p_j$，意义如上文所述。", "outputFormat": "输出 $k$ 行，每行包含一个整数，第 $i$ 行的数表示第 $i$ 个问题的答案。", "hint": "### 样例解释\n\n共有两种蔬菜：\n\n销售第 $1$ 种蔬菜时，每销售一单位可以获得的收益为 $3$，第一次销售这种蔬菜时，额外可以获得的收益为 $3$。这种蔬菜共有 $3$ 个单位，均会在第一天结束时变质。\n\n销售第 $2$ 种蔬菜时，每销售一单位可以获得的收益为 $2$，第一次销售这种蔬菜时，额外可以获得的收益为 $5$。这种蔬菜共有 $8$ 个单位，其中，有 $3$ 单位在第一天结束时变质，$3$ 单位在第二天结束时变质，$2$ 单位在第三天结束时变质。\n\n在只销售 $1$ 天时，应当销售 $2$ 单位的第一种蔬菜和 $1$ 单位的第二种蔬菜。\n\n在这种情况下：销售第一种蔬菜的收益为 $2 \\times 3 + 3$；销售第二种蔬菜的收益为 $1 \\times 2 + 5$；总共获得的收益为 $(2 \\times 3 + 3) + (1 \\times 2 + 5) = 16$。\n\n在只销售 $3$ 天时，第一天应当销售 $3$ 单位的第一种蔬菜，第二天应当销售 $3$ 单位的第二种蔬菜（此时选择在第二天结束时会变质的 $3$ 个单位出售），第三天销售 $2$ 单位的第二种蔬菜。\n\n在这种情况下：销售第一种蔬菜的收益为 $3 \\times 3 + 3$；销售第二种蔬菜的收益为 $(3 + 2) \\times 2 + 5$；总共获得的收益为 $(3 \\times 3 + 3) + [(3 + 2) \\times 2 + 5] = 27$。\n\n### 数据范围\n\n::cute-table{tuack}\n\n| 测试点编号 |    $n$     |   $m$    |   $p_j$    | 特性 $1$ |    特性 $2$    |\n| :--------: | :--------: | :------: | :--------: | :------: | :------------: |\n|    $1$     |  $\\le 2$   | $\\le 10$ | $\\le 10^3$ |    无    |       无       |\n|    $2$     |  $\\le 3$   | ^ | ^ |    ^    |       ^       |\n|    $3$     |  $\\le 4$   | ^ | ^ |    ^    |       ^       |\n|    $4$     | $\\le 10^3$ | ^ |  $\\le 2$   |    ^    |       ^       |\n|    $5$     | ^ | ^ |  $\\le 3$   |    ^    |       ^       |\n|    $6$     | ^ | ^ |  $\\le 4$   |    ^    |       ^       |\n|    $7$     |  $\\le 4$   | $\\le 1$  |  ^   |    ^    |       ^       |\n|    $8$     |  $\\le 6$   | $\\le 2$  |  $\\le 6$   |    ^    |       ^       |\n|    $9$     |  $\\le 8$   | $\\le 1$  |  $\\le 8$   |    ^    |       ^       |\n|    $10$    |  $\\le 10$  | $\\le 2$  |  $\\le 10$  |    ^    |       ^       |\n|    $11$    |  $\\le 20$  | $\\le 3$  |  $\\le 20$  |    ^    |       ^       |\n|    $12$    | $\\le 10^2$ | $\\le 10$ | $\\le 10^2$ |    有    | ^ |\n|    $13$    | ^ | ^ | ^ |    无    |       有       |\n|    $14$    | ^ | ^ | ^ |    ^    | 无 |\n|    $15$    | ^ | ^ | ^ |    ^    | ^ |\n|    $16$    | $\\le 10^3$ | ^ | $\\le 10^3$ |    有    | 有 |\n|    $17$    | ^ | ^ | ^ |    ^    | 无 |\n|    $18$    | ^ | ^ | ^ |    无    |       有       |\n|    $19$    | ^ | ^ | ^ |    ^    | 无 |\n|    $20$    | ^ | ^ | ^ |    ^    | ^ |\n|    $21$    | $\\le 10^5$ | ^ | $\\le 10^5$ |    有    | 有 |\n|    $22$    | ^ | ^ | ^ |    ^    |       无       |\n|    $23$    | ^ | ^ | ^ |    无    |       有       |\n|    $24$    | ^ | ^ | ^ |    ^    |       无       |\n|    $25$    | ^ | ^ | ^ |    ^    |       ^       |\n\n特性 $1$：所有的 $s_i$ 均为 $0$；\n\n特性 $2$：所有的 $x_i$ 均为 $0$。\n\n对于所有的测试数据，均保证 $k$ 组询问中的 $p_j$ 互不相同。\n\n对于所有的测试数据，均保证 $0<a_i,c_i\\le 10^9$，$0\\le s_i,x_i\\le 10^9$。", "locale": "zh-CN"}}}
{"pid": "P3827", "type": "P", "difficulty": 7, "samples": [["6 2\n-1 0\n-1 -1\n0 -1\n1 0\n0 1\n0 0\n3 1 3 6\n2 0 1\n", "3\n2\n"]], "limits": {"time": [3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["2017", "NOI", "O2优化"], "title": "[NOI2017] 分身术", "background": "", "description": "> “分！身！术！” —— 小 P\n\n平面上有 $n$ 个小 P 的分身。定义一组分身占领的区域为覆盖这组分身的最小凸多边形。小 P 能力有限，每一时刻都会有若干分身消失。但在下一时刻之前，小 P 会使用分身术使得这些消失的分身重新出现在原来的位置。\n\n小 P 想知道，每一时刻分身消失后，剩下的分身占领的区域面积是多少？\n", "inputFormat": "输入第一行包含两个正整数 $n,m$，描述初始时分身的个数，和总时刻数。\n\n接下来 $n$ 行，第 $i$ 行有两个整数 $x_i, y_i$ ，描述第 $i$ 个分身的位置。\n\n接下来 $m$ 行，每行的第一个整数 $k$ 表示这一时刻有 $k$ 个分身消失。接下来有 $k$ 个非负整数 $c_1, c_2, \\ldots, c_k$，用于生成消失的分身的编号。\n\n生成方式如下：\n\n设上一个时刻中，分身占领面积的**两倍**为 $S$。则该时刻消失的分身 $p_1, p_2, \\ldots , p_k$ 的编号为：$p_i = [(S + c_i) \\bmod n] + 1$。\n\n特别的，在第一个时刻，我们认为上一个时刻中，$S = -1$，即：第一个时刻消失的分身$p_1, p_2, \\ldots , p_k$的编号为：$p_i = [(−1 + c_i) \\bmod n] + 1$。", "outputFormat": "按给出时刻的顺序依次输出 $m$ 行，每行一个整数，表示该时刻剩余分身所占领区域面积的**两倍**。", "hint": "### 样例解释\n\n如下图所示：左图表示输入的 $6$ 个分身的位置及它们占领的区域；中图表示第一个时刻的情形，消失的分身编号分别为 $1,3,6$，剩余 $3$ 个点占领图中实线内部区域，占据面积的两倍为 $3$；右图表示第二个时刻的情形，消失的分身编号分别为\n\n$[(0 + 3)\\bmod 6] + 1 = 4$\n\n$[(1 + 3)\\bmod 6] + 1 = 5$\n\n剩余的 $4$ 个点占领图中实线内部区域。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/bieyspo4.png) \n\n对于所有数据，保证：\n\n-  $|x_i|,|y_i|\\le 10^8$ ；\n- 没有两个分身的坐标是完全相同的；\n-  $k\\le 100$ ；\n- 所有时刻的  $k$ 之和不超过  $2\\times 10^6$ ；\n-  $0\\le c_i\\le 2^{31}-1$ ；\n- 初始时，所有的  $n$ 个分身占据区域面积大于  $0$ ；\n- 定义所有  $n$ 个分身所占据区域的**顶点集合**为  $S$ ，  $|S|\\ge 3$ 。在任意时刻，  $S$ 中至少存在两个未消失的分身。\n\n| 测试点编号 | $n \\leq$ | $m \\leq$ |    $k$     |\n| :--------: | :------: | :------: | :--------: |\n|    $1$     |   $10$   |   $10$   | $\\leq n-3$ |\n|    $2$     |  $10^3$  |  $10^3$  | $\\leq n-3$ |\n|    $3$     |  $10^3$  |  $10^3$  | $\\leq n-3$ |\n|    $4$     |  $10^3$  |  $10^3$  | $\\leq n-3$ |\n|    $5$     |  $10^5$  |  $10^5$  |    $=1$    |\n|    $6$     |  $10^5$  |  $10^5$  |    $=1$    |\n|    $7$     |  $10^5$  |  $10^5$  |    $=1$    |\n|    $8$     |  $10^5$  |  $10^5$  |    $=1$    |\n|    $9$     |  $10^5$  |  $10^5$  |    $=2$    |\n|    $10$    |  $10^5$  |  $10^5$  |    $=2$    |\n|    $11$    |  $10^5$  |  $10^5$  |  $\\leq 3$  |\n|    $12$    |  $10^5$  |  $10^5$  |  $\\leq 5$  |\n|    $13$    |  $10^5$  |  $10^5$  |  $\\leq 9$  |\n|    $14$    |  $10^5$  |  $10^5$  | $\\leq 12$  |\n|    $15$    |  $10^5$  |  $10^5$  | $\\leq 20$  |\n|    $16$    |  $10^5$  |  $10^5$  | $\\leq 100$ |\n|    $17$    |  $10^5$  |  $10^5$  | $\\leq 100$ |\n|    $18$    |  $10^5$  |  $10^5$  | $\\leq 100$ |\n|    $19$    |  $10^5$  |  $10^5$  | $\\leq 100$ |\n|    $20$    |  $10^5$  |  $10^5$  | $\\leq 100$ |", "locale": "zh-CN", "translations": {"en": {"title": "[NOI2017] Clone Technique", "background": "", "description": "\"Clone! Technique!\" — Xiao P.\n\nOn a plane, there are $n$ clones of Xiao P. Define the region occupied by a set of clones as the smallest convex polygon that covers this set of clones (i.e., the convex hull). Xiao P's ability is limited: at each time step, several clones will disappear. However, before the next time step, Xiao P will use the Clone Technique to make these disappeared clones reappear at their original positions.\n\nXiao P wants to know the area of the region occupied by the remaining clones after the disappearances at each time step.\n\nConstraints\n\n- $|x_i|, |y_i| \\le 10^8$.\n- No two clones share exactly the same coordinates.\n- $k \\le 100$.\n- The sum of $k$ over all time steps does not exceed $2 \\times 10^6$.\n- $0 \\le c_i \\le 2^{31} - 1$.\n- Initially, the area occupied by all $n$ clones is greater than $0$.\n- Define the vertex set of the region occupied by all $n$ clones as $S$, with $|S| \\ge 3$. At any time step, there exist at least two clones from $S$ that have not disappeared.\n\n| Test point ID | $n \\leq$ | $m \\leq$ |    $k$     |\n| :-----------: | :------: | :------: | :--------: |\n|      $1$      |   $10$   |   $10$   | $\\leq n-3$ |\n|      $2$      |  $10^3$  |  $10^3$  | $\\leq n-3$ |\n|      $3$      |  $10^3$  |  $10^3$  | $\\leq n-3$ |\n|      $4$      |  $10^3$  |  $10^3$  | $\\leq n-3$ |\n|      $5$      |  $10^5$  |  $10^5$  |    $=1$    |\n|      $6$      |  $10^5$  |  $10^5$  |    $=1$    |\n|      $7$      |  $10^5$  |  $10^5$  |    $=1$    |\n|      $8$      |  $10^5$  |  $10^5$  |    $=1$    |\n|      $9$      |  $10^5$  |  $10^5$  |    $=2$    |\n|     $10$      |  $10^5$  |  $10^5$  |    $=2$    |\n|     $11$      |  $10^5$  |  $10^5$  |  $\\leq 3$  |\n|     $12$      |  $10^5$  |  $10^5$  |  $\\leq 5$  |\n|     $13$      |  $10^5$  |  $10^5$  |  $\\leq 9$  |\n|     $14$      |  $10^5$  |  $10^5$  | $\\leq 12$  |\n|     $15$      |  $10^5$  |  $10^5$  | $\\leq 20$  |\n|     $16$      |  $10^5$  |  $10^5$  | $\\leq 100$ |\n|     $17$      |  $10^5$  |  $10^5$  | $\\leq 100$ |\n|     $18$      |  $10^5$  |  $10^5$  | $\\leq 100$ |\n|     $19$      |  $10^5$  |  $10^5$  | $\\leq 100$ |\n|     $20$      |  $10^5$  |  $10^5$  | $\\leq 100$ |", "inputFormat": "The first line contains two positive integers $n, m$, denoting the initial number of clones and the total number of time steps.\n\nThe next $n$ lines each contain two integers $x_i, y_i$, describing the position of the $i$-th clone.\n\nThe next $m$ lines: on each line, the first integer $k$ indicates that $k$ clones disappear at this time step. Then there are $k$ non-negative integers $c_1, c_2, \\ldots, c_k$, used to generate the indices of the disappearing clones.\n\nGeneration method:\n\nLet $S$ be twice the area of the region occupied by the clones at the previous time step. Then the indices of the clones that disappear at this time step, $p_1, p_2, \\ldots , p_k$, are:\n$p_i = [(S + c_i) \\bmod n] + 1$.\n\nIn particular, at the first time step we assume $S = -1$, i.e., the indices of the clones that disappear at the first time step, $p_1, p_2, \\ldots , p_k$, are:\n$p_i = [(−1 + c_i) \\bmod n] + 1$.", "outputFormat": "Output $m$ lines in the order of the time steps. Each line contains one integer: twice the area of the region occupied by the remaining clones at that time step.", "hint": "Sample explanation:\n\nAs shown in the figure: the left figure shows the positions of the $6$ clones and the region they occupy; the middle figure shows the situation at the first time step, where the indices of the disappearing clones are $1, 3, 6$. The remaining $3$ points occupy the region inside the solid lines in the figure, and twice the area is $3$. The right figure shows the situation at the second time step, where the indices of the disappearing clones are\n\n$[(0 + 3)\\bmod 6] + 1 = 4$\n\n$[(1 + 3)\\bmod 6] + 1 = 5$\n\nThe remaining $4$ points occupy the region inside the solid lines in the figure.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/bieyspo4.png)\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[NOI2017] 分身术", "background": "", "description": "> “分！身！术！” —— 小 P\n\n平面上有 $n$ 个小 P 的分身。定义一组分身占领的区域为覆盖这组分身的最小凸多边形。小 P 能力有限，每一时刻都会有若干分身消失。但在下一时刻之前，小 P 会使用分身术使得这些消失的分身重新出现在原来的位置。\n\n小 P 想知道，每一时刻分身消失后，剩下的分身占领的区域面积是多少？\n", "inputFormat": "输入第一行包含两个正整数 $n,m$，描述初始时分身的个数，和总时刻数。\n\n接下来 $n$ 行，第 $i$ 行有两个整数 $x_i, y_i$ ，描述第 $i$ 个分身的位置。\n\n接下来 $m$ 行，每行的第一个整数 $k$ 表示这一时刻有 $k$ 个分身消失。接下来有 $k$ 个非负整数 $c_1, c_2, \\ldots, c_k$，用于生成消失的分身的编号。\n\n生成方式如下：\n\n设上一个时刻中，分身占领面积的**两倍**为 $S$。则该时刻消失的分身 $p_1, p_2, \\ldots , p_k$ 的编号为：$p_i = [(S + c_i) \\bmod n] + 1$。\n\n特别的，在第一个时刻，我们认为上一个时刻中，$S = -1$，即：第一个时刻消失的分身$p_1, p_2, \\ldots , p_k$的编号为：$p_i = [(−1 + c_i) \\bmod n] + 1$。", "outputFormat": "按给出时刻的顺序依次输出 $m$ 行，每行一个整数，表示该时刻剩余分身所占领区域面积的**两倍**。", "hint": "### 样例解释\n\n如下图所示：左图表示输入的 $6$ 个分身的位置及它们占领的区域；中图表示第一个时刻的情形，消失的分身编号分别为 $1,3,6$，剩余 $3$ 个点占领图中实线内部区域，占据面积的两倍为 $3$；右图表示第二个时刻的情形，消失的分身编号分别为\n\n$[(0 + 3)\\bmod 6] + 1 = 4$\n\n$[(1 + 3)\\bmod 6] + 1 = 5$\n\n剩余的 $4$ 个点占领图中实线内部区域。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/bieyspo4.png) \n\n对于所有数据，保证：\n\n-  $|x_i|,|y_i|\\le 10^8$ ；\n- 没有两个分身的坐标是完全相同的；\n-  $k\\le 100$ ；\n- 所有时刻的  $k$ 之和不超过  $2\\times 10^6$ ；\n-  $0\\le c_i\\le 2^{31}-1$ ；\n- 初始时，所有的  $n$ 个分身占据区域面积大于  $0$ ；\n- 定义所有  $n$ 个分身所占据区域的**顶点集合**为  $S$ ，  $|S|\\ge 3$ 。在任意时刻，  $S$ 中至少存在两个未消失的分身。\n\n| 测试点编号 | $n \\leq$ | $m \\leq$ |    $k$     |\n| :--------: | :------: | :------: | :--------: |\n|    $1$     |   $10$   |   $10$   | $\\leq n-3$ |\n|    $2$     |  $10^3$  |  $10^3$  | $\\leq n-3$ |\n|    $3$     |  $10^3$  |  $10^3$  | $\\leq n-3$ |\n|    $4$     |  $10^3$  |  $10^3$  | $\\leq n-3$ |\n|    $5$     |  $10^5$  |  $10^5$  |    $=1$    |\n|    $6$     |  $10^5$  |  $10^5$  |    $=1$    |\n|    $7$     |  $10^5$  |  $10^5$  |    $=1$    |\n|    $8$     |  $10^5$  |  $10^5$  |    $=1$    |\n|    $9$     |  $10^5$  |  $10^5$  |    $=2$    |\n|    $10$    |  $10^5$  |  $10^5$  |    $=2$    |\n|    $11$    |  $10^5$  |  $10^5$  |  $\\leq 3$  |\n|    $12$    |  $10^5$  |  $10^5$  |  $\\leq 5$  |\n|    $13$    |  $10^5$  |  $10^5$  |  $\\leq 9$  |\n|    $14$    |  $10^5$  |  $10^5$  | $\\leq 12$  |\n|    $15$    |  $10^5$  |  $10^5$  | $\\leq 20$  |\n|    $16$    |  $10^5$  |  $10^5$  | $\\leq 100$ |\n|    $17$    |  $10^5$  |  $10^5$  | $\\leq 100$ |\n|    $18$    |  $10^5$  |  $10^5$  | $\\leq 100$ |\n|    $19$    |  $10^5$  |  $10^5$  | $\\leq 100$ |\n|    $20$    |  $10^5$  |  $10^5$  | $\\leq 100$ |", "locale": "zh-CN"}}}
{"pid": "P3828", "type": "P", "difficulty": 6, "samples": [["2\n46\n78\n0 1 0 1 0 1", "2"], ["2\n23\n52\n1 1 1 1 1 1", "9"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["2012", "各省省选", "上海"], "title": "[SHOI2012] 火柴游戏", "background": "SHOI2012D1T1\n", "description": "小明非常喜欢玩火柴游戏：首先用火柴棒摆出一个可能是错误的等式，然后通过添加、删除或移动火柴棒，使得等式成立。下图展示每个数字的样子：\n\n ![](https://cdn.luogu.com.cn/upload/pic/6548.png) \n\n我们只考虑形如“A = B”的式子，其中 A 和 B 是两个具有相同位数的整数。\n\n小明可进行三种操作：\n\n1. 在任意位置添加一根火柴棒；\n\n2. 从任意位置删除一根火柴棒；\n\n3. 将任意一根火柴棒移动到另一个位置。\n\n在完成所有操作后，等号两侧必须都是合法的数字，且完全相等。我们约定：\n\n1. 小明不能消除任何数字，也就是说，可以删除一个数字的部分火柴，但不能令它消失；\n\n2. 小明不能增加任何数字，也就是说，可以在一个已有的数字上添加火柴，或将火柴移动到一个已有的数字上，但不能凭空增加一个数字；\n\n3. 小明不能拆分或者合并数字，比如将一个 8 变成两个 1，或者将两个 1合并成一个 8；\n\n4. 其中代表 1 的火柴棒必须靠右边摆放，放在左边不是有效的数字。每种操作都有一定的代价：\n\n 对一个添加操作，如果这是第$i$次进行添加操作，这一步的费用为 $p_1\\times i+q_1$\n\n 对一个删除操作，如果这是第$i$次进行删除操作，这一步的费用为$p_2\\times i+q_2$\n\n 对一个移动操作，如果这是第$i$次进行移动操作，这一步的费用为$p_3\\times i+q_3$\n\n例如，小明在游戏中添加了 3 根火柴，移动了 1 根火柴，删除了 2 根火柴，那么他总的花费为$[(p_1\\times 1+q_1)+(p_1\\times 2+q_1)+(p_1\\times 3+q_1)]+(p_3\\times 1+q_3)+[(p_2\\times 1+q_2 )+(p_2\\times 2+q_2)]$。\n\n小明想知道，他如何才能用最少的花费使等式成立。你能写个程序帮助他吗？\n", "inputFormat": "第 1 行，一个整数 L，表示等式中两个数的位数。\n\n第 2-3 行，每行各一个长度为 L、仅由数字构成的字符串，表示等式两侧的数。\n\n第 4 行，给出六个不超过 100 的非负整数$p_1,q_1,p_2,q_2,p_3,q_3$。\n", "outputFormat": "输出一行，包含一个整数，为使等式成立的最小的操作代价。\n", "hint": "对于 30%数据，有$L\\le 20$，且$p_1 = p_2 = p_3 = 0$；\n\n对于 60%数据，有$L\\le 100$；\n\n对于 100%数据，有$L\\le 200$。\n", "locale": "zh-CN", "translations": {"en": {"title": "[SHOI2012] Matchstick Game", "background": "SHOI2012D1T1.", "description": "Xiaoming loves playing the matchstick game: first he uses matchsticks to form an equation that may be incorrect, then by adding, deleting, or moving matchsticks, he makes the equation correct. The following image shows what each digit looks like:\n\n![](https://cdn.luogu.com.cn/upload/pic/6548.png)\n\nWe only consider expressions of the form \"A = B\", where A and B are two integers with the same number of digits.\n\nXiaoming can perform three types of operations:\n1. Add one matchstick at any position.\n2. Delete one matchstick from any position.\n3. Move any one matchstick to another position.\n\nAfter all operations, both sides of the equal sign must be valid numbers and exactly the same. We agree on the following rules:\n1. Xiaoming cannot eliminate any digit entirely. That is, you may delete some sticks from a digit, but you must not make that digit disappear.\n2. Xiaoming cannot create any new digit. That is, you may add sticks onto an existing digit or move sticks onto an existing digit, but you must not create a new digit out of nothing.\n3. Xiaoming cannot split or merge digits. For example, turning an 8 into two 1s, or merging two 1s into one 8, is not allowed.\n4. The matchstick representing the digit 1 must be placed on the right side; placing it on the left does not form a valid digit.\n\nEach operation has a certain cost:\n- For an add operation, if this is the $i$-th add, the cost of this step is $p_1\\times i+q_1$.\n- For a delete operation, if this is the $i$-th delete, the cost of this step is $p_2\\times i+q_2$.\n- For a move operation, if this is the $i$-th move, the cost of this step is $p_3\\times i+q_3$.\n\nFor example, if Xiaoming adds 3 matchsticks, moves 1 matchstick, and deletes 2 matchsticks, then his total cost is $[(p_1\\times 1+q_1)+(p_1\\times 2+q_1)+(p_1\\times 3+q_1)]+(p_3\\times 1+q_3)+[(p_2\\times 1+q_2 )+(p_2\\times 2+q_2)]$.\n\nXiaoming wants to know the minimum cost to make the equation correct. Can you write a program to help him?", "inputFormat": "- Line 1: An integer L, the number of digits on each side of the equation.\n- Lines 2–3: Each line contains a length L string consisting only of digits, representing the numbers on the two sides of the equation.\n- Line 4: Six non-negative integers not exceeding 100: $p_1,q_1,p_2,q_2,p_3,q_3$.", "outputFormat": "Output one line containing a single integer: the minimum total operation cost to make the equation correct.", "hint": "For 30% of the testdata, $L\\le 20$, and $p_1 = p_2 = p_3 = 0$.\n\nFor 60% of the testdata, $L\\le 100$.\n\nFor 100% of the testdata, $L\\le 200$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SHOI2012] 火柴游戏", "background": "SHOI2012D1T1\n", "description": "小明非常喜欢玩火柴游戏：首先用火柴棒摆出一个可能是错误的等式，然后通过添加、删除或移动火柴棒，使得等式成立。下图展示每个数字的样子：\n\n ![](https://cdn.luogu.com.cn/upload/pic/6548.png) \n\n我们只考虑形如“A = B”的式子，其中 A 和 B 是两个具有相同位数的整数。\n\n小明可进行三种操作：\n\n1. 在任意位置添加一根火柴棒；\n\n2. 从任意位置删除一根火柴棒；\n\n3. 将任意一根火柴棒移动到另一个位置。\n\n在完成所有操作后，等号两侧必须都是合法的数字，且完全相等。我们约定：\n\n1. 小明不能消除任何数字，也就是说，可以删除一个数字的部分火柴，但不能令它消失；\n\n2. 小明不能增加任何数字，也就是说，可以在一个已有的数字上添加火柴，或将火柴移动到一个已有的数字上，但不能凭空增加一个数字；\n\n3. 小明不能拆分或者合并数字，比如将一个 8 变成两个 1，或者将两个 1合并成一个 8；\n\n4. 其中代表 1 的火柴棒必须靠右边摆放，放在左边不是有效的数字。每种操作都有一定的代价：\n\n 对一个添加操作，如果这是第$i$次进行添加操作，这一步的费用为 $p_1\\times i+q_1$\n\n 对一个删除操作，如果这是第$i$次进行删除操作，这一步的费用为$p_2\\times i+q_2$\n\n 对一个移动操作，如果这是第$i$次进行移动操作，这一步的费用为$p_3\\times i+q_3$\n\n例如，小明在游戏中添加了 3 根火柴，移动了 1 根火柴，删除了 2 根火柴，那么他总的花费为$[(p_1\\times 1+q_1)+(p_1\\times 2+q_1)+(p_1\\times 3+q_1)]+(p_3\\times 1+q_3)+[(p_2\\times 1+q_2 )+(p_2\\times 2+q_2)]$。\n\n小明想知道，他如何才能用最少的花费使等式成立。你能写个程序帮助他吗？\n", "inputFormat": "第 1 行，一个整数 L，表示等式中两个数的位数。\n\n第 2-3 行，每行各一个长度为 L、仅由数字构成的字符串，表示等式两侧的数。\n\n第 4 行，给出六个不超过 100 的非负整数$p_1,q_1,p_2,q_2,p_3,q_3$。\n", "outputFormat": "输出一行，包含一个整数，为使等式成立的最小的操作代价。\n", "hint": "对于 30%数据，有$L\\le 20$，且$p_1 = p_2 = p_3 = 0$；\n\n对于 60%数据，有$L\\le 100$；\n\n对于 100%数据，有$L\\le 200$。\n", "locale": "zh-CN"}}}
{"pid": "P3829", "type": "P", "difficulty": 5, "samples": [["2\n6.0 2.0 0.0\n0.0 0.0 0.0\n2.0 -2.0 1.5707963268", "21.66"], ["3\n6.0 6.0 1.0\n4.0 4.0 0.0\n0.0 8.0 0.0\n0.0 0.0 0.0", "41.60"], ["3\n6.0 6.0 1.0\n4.0 4.0 0.1745329252\n0.0 8.0 0.3490658504\n0.0 0.0 0.5235987756", "41.63"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288, 524288]}, "tags": ["2012", "各省省选", "上海", "凸包"], "title": "[SHOI2012] 信用卡凸包", "background": "SHOI2012D1T2", "description": "信用卡是一个矩形，唯四个角作了圆滑处理，使它们都是与矩形的两边相切的 $\\frac14$ 圆，如下图所示。现在平面上有一些规格相同的信用卡，试求其凸包的周长。注意凸包未必是多边形，因为它可能包含若干段圆弧。\n\n ![](https://cdn.luogu.com.cn/upload/pic/6549.png)", "inputFormat": "输入的第一行是一个正整数 $n$，表示信用卡的张数。第二行包含三个实数 $a,b,r$，分别表示信用卡（圆滑处理前）竖直方向的长度、水平方向的长度，以及 $\\frac14$ 圆的半径。\n\n之后 $n$ 行，每行包含三个实数 $x,y,\\theta$，分别表示一张信用卡中心（即对角线交点）的横、纵坐标，以及绕中心**逆时针**旋转的弧度。", "outputFormat": "输出只有一行，包含一个实数，表示凸包的周长，四舍五入精确到小数点后 2 位。", "hint": "样例 1 说明：\n\n![](https://cdn.luogu.com.cn/upload/pic/6550.png)\n\n本样例中的 $2$ 张信用卡的轮廓在上图中用实线标出，如果视 $1.5707963268$ 为 $\\frac\\pi2$，那么凸包的周长为 $16+4\\sqrt2$\n\n样例 2 说明：\n\n![](https://cdn.luogu.com.cn/upload/pic/6551.png)\n\n样例 3 说明：\n\n![](https://cdn.luogu.com.cn/upload/pic/6552.png)\n\n其凸包的周长约为 $41.628267652$。\n\n\n本题可能需要使用数学库中的三角函数。不熟悉使用方法的选手，可以参考下面的程序及其输出结果：\n\n```cpp\nuses math;\nconst Pi = 3.141592653589793;\nbegin\nwriteln(sin(30.0 / 180.0 * Pi) : 0 : 10);\nwriteln(cos(60.0 / 180.0 * Pi) : 0 : 10);\nwriteln(tan(45.0 / 180.0 * Pi) : 0 : 10);\nwriteln(arcsin(1.0) : 0 : 10);\nwriteln(arccos(0.0) : 0 : 10);\nwriteln(arctan(1.0) : 0 : 10);\nend.\n```\n```cpp\n#include <iostream>\n#include <math.h>\nusing namespace std;\nconst double Pi = 3.141592653589793;\nint main()\n{\n    cout.setf(ios::fixed);\n    cout.precision(10);\n    cout<<sin(30.0 / 180.0 * Pi)<<endl;\n    cout<<cos(60.0 / 180.0 * Pi)<<endl;\n    cout<<tan(45.0 / 180.0 * Pi)<<endl;\n    cout<<asin(1.0)<<endl;\n    cout<<acos(0.0)<<endl;\n    cout<<atan(1.0)<<endl;\n    return 0;\n}\n```\n输出结果：\n```\n0.5000000000\n0.5000000000\n1.0000000000\n1.5707963268\n1.5707963268\n0.7853981634\n```\n\n数据范围：\n\n ![](https://cdn.luogu.com.cn/upload/pic/6553.png) \n\n![](https://cdn.luogu.com.cn/upload/pic/6554.png)", "locale": "zh-CN", "translations": {"en": {"title": "[SHOI2012] Credit Card Convex Hull", "background": "SHOI2012D1T2", "description": "A credit card is a rectangle whose four corners are rounded so that each corner is a $1/4$ circle tangent to the two adjacent sides, as shown below. Now there are several credit cards of identical specifications placed on the plane. Find the perimeter of their convex hull. Note that the convex hull is not necessarily a polygon, because it may contain several circular arcs.\n\n![](https://cdn.luogu.com.cn/upload/pic/6549.png)", "inputFormat": "The first line contains a positive integer $n$, the number of credit cards. The second line contains three real numbers $a$, $b$, $r$, which denote, respectively, the length of the credit card (before rounding) in the vertical direction, the length in the horizontal direction, and the radius of each $1/4$ circle.\n\nThen there are $n$ lines. Each line contains three real numbers $x$, $y$, $\\theta$, which denote, respectively, the $x$- and $y$-coordinates of a card’s center (i.e., the intersection point of its diagonals), and the angle (in radians) it is rotated counterclockwise about its center.", "outputFormat": "Output a single line containing one real number: the perimeter of the convex hull, rounded to 2 decimal places.", "hint": "Explanation for Sample 1: ![](https://cdn.luogu.com.cn/upload/pic/6550.png)\n\nIn this sample, the outlines of the 2 credit cards are drawn in solid lines above. If we regard $1.5707963268$ as $\\pi/2$, then the perimeter of the convex hull is $16 + 4\\sqrt{2}$.\n\nExplanation for Sample 2: ![](https://cdn.luogu.com.cn/upload/pic/6551.png)\n\nExplanation for Sample 3: ![](https://cdn.luogu.com.cn/upload/pic/6552.png)\n\nThe perimeter of its convex hull is approximately $41.628267652$.\n\nThis problem may require trigonometric functions from the math library. If you are not familiar with their usage, you can refer to the following programs and their outputs:\n\n```cpp\nuses math;\nconst Pi = 3.141592653589793;\nbegin\nwriteln(sin(30.0 / 180.0 * Pi) : 0 : 10);\nwriteln(cos(60.0 / 180.0 * Pi) : 0 : 10);\nwriteln(tan(45.0 / 180.0 * Pi) : 0 : 10);\nwriteln(arcsin(1.0) : 0 : 10);\nwriteln(arccos(0.0) : 0 : 10);\nwriteln(arctan(1.0) : 0 : 10);\nend.\n```\n```cpp\n#include <iostream>\n#include <math.h>\nusing namespace std;\nconst double Pi = 3.141592653589793;\nint main()\n{\ncout.setf(ios::fixed);\ncout.precision(10);\ncout<<sin(30.0 / 180.0 * Pi)<<endl;\ncout<<cos(60.0 / 180.0 * Pi)<<endl;\ncout<<tan(45.0 / 180.0 * Pi)<<endl;\ncout<<asin(1.0)<<endl;\ncout<<acos(0.0)<<endl;\ncout<<atan(1.0)<<endl;\nreturn 0;\n}\n```\nOutput:\n0.5000000000\n\n0.5000000000\n\n1.0000000000\n\n1.5707963268\n\n1.5707963268\n\n0.7853981634\n\nConstraints:\n\n![](https://cdn.luogu.com.cn/upload/pic/6553.png)\n\n![](https://cdn.luogu.com.cn/upload/pic/6554.png)\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SHOI2012] 信用卡凸包", "background": "SHOI2012D1T2", "description": "信用卡是一个矩形，唯四个角作了圆滑处理，使它们都是与矩形的两边相切的 $\\frac14$ 圆，如下图所示。现在平面上有一些规格相同的信用卡，试求其凸包的周长。注意凸包未必是多边形，因为它可能包含若干段圆弧。\n\n ![](https://cdn.luogu.com.cn/upload/pic/6549.png)", "inputFormat": "输入的第一行是一个正整数 $n$，表示信用卡的张数。第二行包含三个实数 $a,b,r$，分别表示信用卡（圆滑处理前）竖直方向的长度、水平方向的长度，以及 $\\frac14$ 圆的半径。\n\n之后 $n$ 行，每行包含三个实数 $x,y,\\theta$，分别表示一张信用卡中心（即对角线交点）的横、纵坐标，以及绕中心**逆时针**旋转的弧度。", "outputFormat": "输出只有一行，包含一个实数，表示凸包的周长，四舍五入精确到小数点后 2 位。", "hint": "样例 1 说明：\n\n![](https://cdn.luogu.com.cn/upload/pic/6550.png)\n\n本样例中的 $2$ 张信用卡的轮廓在上图中用实线标出，如果视 $1.5707963268$ 为 $\\frac\\pi2$，那么凸包的周长为 $16+4\\sqrt2$\n\n样例 2 说明：\n\n![](https://cdn.luogu.com.cn/upload/pic/6551.png)\n\n样例 3 说明：\n\n![](https://cdn.luogu.com.cn/upload/pic/6552.png)\n\n其凸包的周长约为 $41.628267652$。\n\n\n本题可能需要使用数学库中的三角函数。不熟悉使用方法的选手，可以参考下面的程序及其输出结果：\n\n```cpp\nuses math;\nconst Pi = 3.141592653589793;\nbegin\nwriteln(sin(30.0 / 180.0 * Pi) : 0 : 10);\nwriteln(cos(60.0 / 180.0 * Pi) : 0 : 10);\nwriteln(tan(45.0 / 180.0 * Pi) : 0 : 10);\nwriteln(arcsin(1.0) : 0 : 10);\nwriteln(arccos(0.0) : 0 : 10);\nwriteln(arctan(1.0) : 0 : 10);\nend.\n```\n```cpp\n#include <iostream>\n#include <math.h>\nusing namespace std;\nconst double Pi = 3.141592653589793;\nint main()\n{\n    cout.setf(ios::fixed);\n    cout.precision(10);\n    cout<<sin(30.0 / 180.0 * Pi)<<endl;\n    cout<<cos(60.0 / 180.0 * Pi)<<endl;\n    cout<<tan(45.0 / 180.0 * Pi)<<endl;\n    cout<<asin(1.0)<<endl;\n    cout<<acos(0.0)<<endl;\n    cout<<atan(1.0)<<endl;\n    return 0;\n}\n```\n输出结果：\n```\n0.5000000000\n0.5000000000\n1.0000000000\n1.5707963268\n1.5707963268\n0.7853981634\n```\n\n数据范围：\n\n ![](https://cdn.luogu.com.cn/upload/pic/6553.png) \n\n![](https://cdn.luogu.com.cn/upload/pic/6554.png)", "locale": "zh-CN"}}}
{"pid": "P3830", "type": "P", "difficulty": 6, "samples": [["1 4", "2.166667"], ["2 4", "2.666667"], ["1 12", "4.206421"], ["2 12", "5.916614"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072, 131072]}, "tags": ["动态规划 DP", "2012", "各省省选", "上海", "期望", "构造"], "title": "[SHOI2012] 随机树", "background": "SHOI2012 D1T3", "description": "一棵含 $n$ 个叶结点的二叉树可以通过如下方式生成。初始时只有根结点。首先，将根结点展开（本题中的“展开”是指给一个叶结点添上左、右两个子结点）：\n\n[a]\n\n然后，等概率地随机将两个叶结点中的一个展开，即生成以下两棵树之一：\n\n[b]\n\n之后，每次在当前二叉树的所有叶结点中，等概率地随机选择一个，将其展开。\n\n不断地重复这一操作，直至产生 $n$ 个叶结点为止。例如，某棵含 5 个叶结点的二叉树可能按如下步骤生成。\n\n[c]\n\n对于按该方式随机生成的一棵含 $n$ 个叶结点的二叉树，求：\n\n1. **叶结点平均深度** 的数学期望值。\n2. **树深度** 的数学期望值。约定根结点的深度为 0。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/7ql5uhxn.png)", "inputFormat": "输入仅有一行，包含两个正整数 $q$, $n$，分别表示问题编号以及叶结点的个数。", "outputFormat": "输出仅有一行，包含一个实数 $d$，四舍五入精确到小数点后 $6$ 位。如果 $q = 1$，则 $d$ 表示叶结点平均深度的数学期望值；如果 $q = 2$，则 $d$ 表示树深度的数学期望值。", "hint": "### 【样例1、样例2说明】\n数学期望值是随机变量的值乘以其概率的总和：记随机变量 $X$ 可能的取值为 $x_1,x_2,\\cdots,x_n$，它们取到的概率分别为 $p_1,p_2,\\cdots,p_n$，那么随机变量 $X$ 的数学期望值就是\n\n$E(X)=\\sum_{i = 1}^{n}p_ix_i$\n\n例如，掷一枚写有 1、2、3、4、5、6 这 6 个数的均匀骰子，掷到的数的数学期望值是：\n\n$E=\\frac{1}{6}\\times1+\\frac{1}{6}\\times2+\\frac{1}{6}\\times3+\\frac{1}{6}\\times4+\\frac{1}{6}\\times5+\\frac{1}{6}\\times6 = 3.5$\n\n尽管 3.5 不是骰子上的某个数。又如，一道 4 选 1 的选择题，答对得 5 分，不答不得分，答错倒扣 1 分。那么，当我们不答时，一定得 0 分；而等概率地随便猜一个时，得分的数学期望值是：\n\n$E=\\frac{1}{4}\\times 5+\\frac{1}{4}\\times (-1)+\\frac{1}{4}\\times (-1)+\\frac{1}{4}\\times (-1)=\\frac{1}{2}$\n\n本题中，根据二叉树的生成方式，当 $n = 4$ 时，下图中前四棵树被生成的概率均为 $1/6$，最后一棵树被生成的概率为 $1/3$。它们的叶结点平均深度分别是 $9/4$、$9/4$、$9/4$、2，因此叶结点平均深度的数学期望值是\n\n$E=\\frac{1}{6}\\times\\frac{9}{4}+\\frac{1}{6}\\times\\frac{9}{4}+\\frac{1}{6}\\times\\frac{9}{4}+\\frac{1}{6}\\times\\frac{9}{4}+\\frac{1}{3}\\times2=\\frac{13}{6}$\n\n而它们的树深度分别是 3、3、3、3、2，因此树深度的数学期望值是\n\n$E=\\frac{1}{6}\\times3+\\frac{1}{6}\\times3+\\frac{1}{6}\\times3+\\frac{1}{6}\\times3+\\frac{1}{3}\\times2=\\frac{8}{3}$\n\n### 【数据规模】\n| 测试数据编号 | $q$ | $n$ |\n| ---- | ---- | ---- |\n| 1,2 | $q = 1$ | $2\\leq n\\leq10$ |\n| 3,4,5 | $q = 1$ | $2\\leq n\\leq100$ |\n| 6,7 | $q = 2$ | $2\\leq n\\leq10$ |\n| 8,9,10 | $q = 2$ | $2\\leq n\\leq100$ | \n\n![](https://cdn.luogu.com.cn/upload/pic/6556.png) \n\n ![](https://cdn.luogu.com.cn/upload/pic/6557.png) \n\n![](https://cdn.luogu.com.cn/upload/pic/6558.png)", "locale": "zh-CN", "translations": {"en": {"title": "[SHOI2012] Random Tree", "background": "SHOI2012 D1T3.", "description": "A binary tree with $n$ leaf nodes can be generated as follows. Initially there is only the root node. First, expand the root node (in this problem, “expand” means adding left and right children to a leaf node):\n\n[a]\n\nThen, uniformly at random choose one of the two leaf nodes to expand, i.e., generate one of the following two trees:\n\n[b]\n\nAfter that, at each step, uniformly at random choose one leaf node from all current leaf nodes and expand it.\n\nRepeat this operation until there are $n$ leaf nodes. For example, a binary tree with $5$ leaf nodes might be generated by the following steps.\n\n[c]\n\nFor a binary tree with $n$ leaf nodes generated by this process, find:\n\n1. The expected value of the average depth of the leaf nodes.\n2. The expected value of the tree depth. The root node is defined to have depth $0$.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/7ql5uhxn.png)", "inputFormat": "The input contains one line with two positive integers $q$, $n$, representing the query type and the number of leaf nodes, respectively.", "outputFormat": "Output one line with a real number $d$, rounded to $6$ digits after the decimal point. If $q = 1$, then $d$ is the expected value of the average depth of the leaf nodes; if $q = 2$, then $d$ is the expected value of the tree depth.", "hint": "【Explanation for Samples 1 and 2】\nThe expected value of a random variable is the sum of each value times its probability. Let the possible values of random variable $X$ be $x_1, x_2, \\cdots, x_n$, and their probabilities be $p_1, p_2, \\cdots, p_n$. Then the expected value of $X$ is\n$E(X)=\\sum_{i = 1}^{n} p_i x_i$.\n\nFor example, when rolling a fair die labeled with the $6$ numbers $1, 2, 3, 4, 5, 6$, the expected value of the outcome is:\n$E=\\frac{1}{6}\\times 1+\\frac{1}{6}\\times 2+\\frac{1}{6}\\times 3+\\frac{1}{6}\\times 4+\\frac{1}{6}\\times 5+\\frac{1}{6}\\times 6 = 3.5$,\neven though $3.5$ is not one of the die faces. As another example, consider a single-choice question with $4$ options: a correct answer gives $5$ points, no answer gives $0$ points, and a wrong answer gives $-1$ point. If we do not answer, we certainly get $0$; if we guess uniformly at random, the expected score is:\n$E=\\frac{1}{4}\\times 5+\\frac{1}{4}\\times (-1)+\\frac{1}{4}\\times (-1)+\\frac{1}{4}\\times (-1)=\\frac{1}{2}$.\n\nIn this problem, according to the generation process, when $n = 4$, in the figure below the first four trees are generated with probability $1/6$ each, and the last tree with probability $1/3$. Their average leaf depths are $9/4$, $9/4$, $9/4$, $9/4$, $2$, so the expected value of the average leaf depth is\n$E=\\frac{1}{6}\\times \\frac{9}{4}+\\frac{1}{6}\\times \\frac{9}{4}+\\frac{1}{6}\\times \\frac{9}{4}+\\frac{1}{6}\\times \\frac{9}{4}+\\frac{1}{3}\\times 2=\\frac{13}{6}$.\nTheir tree depths are $3, 3, 3, 3, 2$, so the expected value of the tree depth is\n$E=\\frac{1}{6}\\times 3+\\frac{1}{6}\\times 3+\\frac{1}{6}\\times 3+\\frac{1}{6}\\times 3+\\frac{1}{3}\\times 2=\\frac{8}{3}$.\n\nConstraints\n| Testdata ID | $q$ | $n$ |\n| ---- | ---- | ---- |\n| 1, 2 | $q = 1$ | $2 \\leq n \\leq 10$ |\n| 3, 4, 5 | $q = 1$ | $2 \\leq n \\leq 100$ |\n| 6, 7 | $q = 2$ | $2 \\leq n \\leq 10$ |\n| 8, 9, 10 | $q = 2$ | $2 \\leq n \\leq 100$ |\n\n![](https://cdn.luogu.com.cn/upload/pic/6556.png)\n\n![](https://cdn.luogu.com.cn/upload/pic/6557.png)\n\n![](https://cdn.luogu.com.cn/upload/pic/6558.png)\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SHOI2012] 随机树", "background": "SHOI2012 D1T3", "description": "一棵含 $n$ 个叶结点的二叉树可以通过如下方式生成。初始时只有根结点。首先，将根结点展开（本题中的“展开”是指给一个叶结点添上左、右两个子结点）：\n\n[a]\n\n然后，等概率地随机将两个叶结点中的一个展开，即生成以下两棵树之一：\n\n[b]\n\n之后，每次在当前二叉树的所有叶结点中，等概率地随机选择一个，将其展开。\n\n不断地重复这一操作，直至产生 $n$ 个叶结点为止。例如，某棵含 5 个叶结点的二叉树可能按如下步骤生成。\n\n[c]\n\n对于按该方式随机生成的一棵含 $n$ 个叶结点的二叉树，求：\n\n1. **叶结点平均深度** 的数学期望值。\n2. **树深度** 的数学期望值。约定根结点的深度为 0。\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/7ql5uhxn.png)", "inputFormat": "输入仅有一行，包含两个正整数 $q$, $n$，分别表示问题编号以及叶结点的个数。", "outputFormat": "输出仅有一行，包含一个实数 $d$，四舍五入精确到小数点后 $6$ 位。如果 $q = 1$，则 $d$ 表示叶结点平均深度的数学期望值；如果 $q = 2$，则 $d$ 表示树深度的数学期望值。", "hint": "### 【样例1、样例2说明】\n数学期望值是随机变量的值乘以其概率的总和：记随机变量 $X$ 可能的取值为 $x_1,x_2,\\cdots,x_n$，它们取到的概率分别为 $p_1,p_2,\\cdots,p_n$，那么随机变量 $X$ 的数学期望值就是\n\n$E(X)=\\sum_{i = 1}^{n}p_ix_i$\n\n例如，掷一枚写有 1、2、3、4、5、6 这 6 个数的均匀骰子，掷到的数的数学期望值是：\n\n$E=\\frac{1}{6}\\times1+\\frac{1}{6}\\times2+\\frac{1}{6}\\times3+\\frac{1}{6}\\times4+\\frac{1}{6}\\times5+\\frac{1}{6}\\times6 = 3.5$\n\n尽管 3.5 不是骰子上的某个数。又如，一道 4 选 1 的选择题，答对得 5 分，不答不得分，答错倒扣 1 分。那么，当我们不答时，一定得 0 分；而等概率地随便猜一个时，得分的数学期望值是：\n\n$E=\\frac{1}{4}\\times 5+\\frac{1}{4}\\times (-1)+\\frac{1}{4}\\times (-1)+\\frac{1}{4}\\times (-1)=\\frac{1}{2}$\n\n本题中，根据二叉树的生成方式，当 $n = 4$ 时，下图中前四棵树被生成的概率均为 $1/6$，最后一棵树被生成的概率为 $1/3$。它们的叶结点平均深度分别是 $9/4$、$9/4$、$9/4$、2，因此叶结点平均深度的数学期望值是\n\n$E=\\frac{1}{6}\\times\\frac{9}{4}+\\frac{1}{6}\\times\\frac{9}{4}+\\frac{1}{6}\\times\\frac{9}{4}+\\frac{1}{6}\\times\\frac{9}{4}+\\frac{1}{3}\\times2=\\frac{13}{6}$\n\n而它们的树深度分别是 3、3、3、3、2，因此树深度的数学期望值是\n\n$E=\\frac{1}{6}\\times3+\\frac{1}{6}\\times3+\\frac{1}{6}\\times3+\\frac{1}{6}\\times3+\\frac{1}{3}\\times2=\\frac{8}{3}$\n\n### 【数据规模】\n| 测试数据编号 | $q$ | $n$ |\n| ---- | ---- | ---- |\n| 1,2 | $q = 1$ | $2\\leq n\\leq10$ |\n| 3,4,5 | $q = 1$ | $2\\leq n\\leq100$ |\n| 6,7 | $q = 2$ | $2\\leq n\\leq10$ |\n| 8,9,10 | $q = 2$ | $2\\leq n\\leq100$ | \n\n![](https://cdn.luogu.com.cn/upload/pic/6556.png) \n\n ![](https://cdn.luogu.com.cn/upload/pic/6557.png) \n\n![](https://cdn.luogu.com.cn/upload/pic/6558.png)", "locale": "zh-CN"}}}
{"pid": "P3831", "type": "P", "difficulty": 5, "samples": [["2 1\n1 2\n1 1 2 2", "5"], ["6 9\n2 1\n2 5\n3 2\n4 4\n5 2\n5 6\n6 1\n6 3\n6 4\n1 1 4 6", "27"], ["6 10\n2 1\n2 5\n3 2\n4 4\n5 2\n5 6\n6 1\n6 3\n6 4\n6 6\n1 1 4 6", "26"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["图论", "2012", "各省省选", "上海", "最短路"], "title": "[SHOI2012] 回家的路", "background": "SHOI2012 D2T1", "description": "2046 年 OI 城的城市轨道交通建设终于全部竣工，由于前期规划周密，建成后的轨道交通网络由 $2n$ 条地铁线路构成，组成了一个 $n$ 纵 $n$ 横的交通网。如下图所示，这 $2n$ 条线路每条线路都包含 $n$ 个车站，而每个车站都在一组纵横线路的交汇处。\n\n\n出于建设成本的考虑，并非每个车站都能够进行站内换乘，能够进行站内换乘的地铁站共有 $m$ 个，在下图中，标上方块标记的车站为换乘车站。已知地铁运行 $1$ 站需要 $2$ 分钟，而站内换乘需要步行 $1$ 分钟。Serenade 想要知道，在不中途出站的前提下，他从学校回家最快需要多少时间（等车时间忽略不计）。\n\n\n![](https://cdn.luogu.com.cn/upload/pic/6547.png)", "inputFormat": "第一行有两个整数 $n,m$。\n\n接下去 $m$ 行每行两个整数 $x,y$，表示第 $x$ 条横向线路与第 $y$ 条纵向线路的交汇站是站内换乘站。\n\n接下去一行是四个整数 $x_1,y_1,x_2,y_2$。表示 Serenade 从学校回家时，在第 $x_1$ 条横向线路与第 $y_1$ 条纵向线路的交汇站上车，在第 $x_2$ 条横向线路与第 $y_2$ 条纵向线路的交汇站下车。", "outputFormat": "输出文件只有一行，即 Serenade 在合理选择线路的情况下，回家所需要的时间。如果 Serenade 无法在不出站换乘的情况下回家，请输出 `-1`。", "hint": "对于 $30\\%$ 的数据，$n\\le 50,m\\le 1000$；\n\n对于 $60\\%$ 的数据，$n\\le 500,m\\le 2000$；\n\n对于 $100\\%$ 的数据，$n\\le 20000,m\\le 100000$；", "locale": "zh-CN", "translations": {"en": {"title": "[SHOI2012] The Way Home", "background": "SHOI2012 D2T1.", "description": "In 2046, the urban rail transit construction of OI City was finally completed. Thanks to meticulous planning, the completed rail network consists of $2n$ subway lines, forming a grid with $n$ vertical and $n$ horizontal lines. As shown in the figure below, each of these $2n$ lines contains $n$ stations, and each station lies at the intersection of one vertical line and one horizontal line.\n\nFor cost reasons, not every station allows in-station transfers. There are $m$ stations where in-station transfer is possible; in the figure below, stations marked with squares are transfer stations. It is known that traveling one stop takes $2$ minutes, and an in-station transfer requires $1$ minute of walking. Serenade wants to know, without exiting the station mid-journey, the minimum time needed to get home from school (waiting time is ignored).\n\n![](https://cdn.luogu.com.cn/upload/pic/6547.png)", "inputFormat": "The first line contains two integers $n, m$.\n\nEach of the next $m$ lines contains two integers $x, y$, indicating that the intersection of the $x$-th horizontal line and the $y$-th vertical line is an in-station transfer station.\n\nThe next line contains four integers $x_1, y_1, x_2, y_2$. They mean that Serenade boards at the intersection of the $x_1$-th horizontal line and the $y_1$-th vertical line, and alights at the intersection of the $x_2$-th horizontal line and the $y_2$-th vertical line.", "outputFormat": "Output one line: the minimum time for Serenade to get home with an optimal choice of lines. If Serenade cannot get home without exiting the station to transfer, output `-1`.", "hint": "- For $30\\%$ of the testdata, $n \\le 50, m \\le 1000$.\n- For $60\\%$ of the testdata, $n \\le 500, m \\le 2000$.\n- For $100\\%$ of the testdata, $n \\le 20000, m \\le 100000$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SHOI2012] 回家的路", "background": "SHOI2012 D2T1", "description": "2046 年 OI 城的城市轨道交通建设终于全部竣工，由于前期规划周密，建成后的轨道交通网络由 $2n$ 条地铁线路构成，组成了一个 $n$ 纵 $n$ 横的交通网。如下图所示，这 $2n$ 条线路每条线路都包含 $n$ 个车站，而每个车站都在一组纵横线路的交汇处。\n\n\n出于建设成本的考虑，并非每个车站都能够进行站内换乘，能够进行站内换乘的地铁站共有 $m$ 个，在下图中，标上方块标记的车站为换乘车站。已知地铁运行 $1$ 站需要 $2$ 分钟，而站内换乘需要步行 $1$ 分钟。Serenade 想要知道，在不中途出站的前提下，他从学校回家最快需要多少时间（等车时间忽略不计）。\n\n\n![](https://cdn.luogu.com.cn/upload/pic/6547.png)", "inputFormat": "第一行有两个整数 $n,m$。\n\n接下去 $m$ 行每行两个整数 $x,y$，表示第 $x$ 条横向线路与第 $y$ 条纵向线路的交汇站是站内换乘站。\n\n接下去一行是四个整数 $x_1,y_1,x_2,y_2$。表示 Serenade 从学校回家时，在第 $x_1$ 条横向线路与第 $y_1$ 条纵向线路的交汇站上车，在第 $x_2$ 条横向线路与第 $y_2$ 条纵向线路的交汇站下车。", "outputFormat": "输出文件只有一行，即 Serenade 在合理选择线路的情况下，回家所需要的时间。如果 Serenade 无法在不出站换乘的情况下回家，请输出 `-1`。", "hint": "对于 $30\\%$ 的数据，$n\\le 50,m\\le 1000$；\n\n对于 $60\\%$ 的数据，$n\\le 500,m\\le 2000$；\n\n对于 $100\\%$ 的数据，$n\\le 20000,m\\le 100000$；", "locale": "zh-CN"}}}
{"pid": "P3832", "type": "P", "difficulty": 0, "samples": [["3\n1 3 2", "1 2 3\n2 1 3"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2012", "各省省选", "上海"], "title": "[SHOI2012] 排序", "background": "SHOI2012 D2T2\n", "description": "众所周知，1~n 的全排列包含 n!个排列。通常情况下，我们在生成全排列时都按照他们的字典序生成的。而在本题中，我们就将要考虑一种特殊的全排列生成方式。\n\n具体的，生成的全排列的顺序是由一个生成器决定的。\n\n(1) 生成器本身也是一个 1~n 的排列：$a_1$ , $a_2$ , …, $a_n$ 。\n\n(2) 对于两个不相同的 1~n 的 $x_1$ , $x_2$ , …, $x_n$ 、$y_1$ , $y_2$ , …, $y_n$ 排列而言，首先找到最小的 i，使得 $x_{ai}$ 与 $y_{ai}$ 不相等。\n\n(3) 根据(2)中选择的 i，如果 $x_{ai}$ 在排列 $a_1$ , $a_2$ , …, $a_n$ 中排在 $y_{ai}$ 之前，那么 $x_1$ ,$x_2$ , …, $x_n$ 就会在 $y_1$ , $y_2$ , …, $y_n$ 之前生成。\n\n例如，当 n = 3，生成器为 132 时，1~n 的全排列的生成顺序为：123，132，321，312，231，213。\n\n输入一个排列 $x_1$ , $x_2$, …, $x_n$ ，问，哪个生成器能使得这个排列在所有的排列中尽可能早的生成，哪个生成器能使得这个排列在所有的排列中尽可能晚的生成。\n\n如果有多种生成器能达到要求，那么请输出字典序最小的符合要求的生成器。\n", "inputFormat": "输入的第一行是整数 n，第二行是 1~n 的一个排列 $x_1$ , $x_2$ , …, $x_n$ 。\n", "outputFormat": "输出的第一行是一个 1~n 的排列，表示让 $x_1$ , $x_2$ , …, $x_n$ 尽早输出的生成器。\n\n输出的第二行是一个 1~n 的排列，表示让 $x_1$ , $x_2$ , …, $x_n$ 尽晚输出的生成器。\n\n如果有多种生成器能达到要求，那么请输出字典序最小的符合要求的生成器。\n", "hint": "对于 30%的数据，有 n ≤ 10；\n\n对于 50%的数据，有 n ≤ 200；\n\n对于 90%的数据，有 n ≤ 30000；\n\n对于 100%的数据，有 n ≤ 500000。\n", "locale": "zh-CN", "translations": {"en": {"title": "[SHOI2012] Sorting", "background": "SHOI2012 D2T2.", "description": "As is well known, the set of all permutations of $\\{1, 2, \\dots, n\\}$ contains $n!$ permutations. Normally, when we generate all permutations, we list them in lexicographic order. In this problem, we consider a special way of generating all permutations.\n\nSpecifically, the generation order is determined by a generator.\n\n(1) The generator is itself a permutation of $\\{1, 2, \\dots, n\\}$: $a_1$, $a_2$, …, $a_n$.\n\n(2) For two distinct permutations of $\\{1, 2, \\dots, n\\}$, $x_1$, $x_2$, …, $x_n$ and $y_1$, $y_2$, …, $y_n$, first find the smallest $i$ such that $x_{a_i}$ and $y_{a_i}$ are not equal.\n\n(3) According to the $i$ chosen in (2), if $x_{a_i}$ comes before $y_{a_i}$ in the permutation $a_1$, $a_2$, …, $a_n$, then $x_1$, $x_2$, …, $x_n$ will be generated before $y_1$, $y_2$, …, $y_n$.\n\nFor example, when $n = 3$ and the generator is 132, the generation order of all permutations of $\\{1, 2, \\dots, n\\}$ is: 123, 132, 321, 312, 231, 213.\n\nGiven a permutation $x_1$, $x_2$, …, $x_n$, determine which generator makes this permutation appear as early as possible among all permutations, and which generator makes it appear as late as possible.\n\nIf multiple generators satisfy the requirement, output the lexicographically smallest one.", "inputFormat": "The first line contains an integer $n$. The second line contains a permutation $x_1$, $x_2$, …, $x_n$ of $\\{1, 2, \\dots, n\\}$.", "outputFormat": "The first line outputs a permutation of $\\{1, 2, \\dots, n\\}$, representing a generator that makes $x_1$, $x_2$, …, $x_n$ appear as early as possible.\n\nThe second line outputs a permutation of $\\{1, 2, \\dots, n\\}$, representing a generator that makes $x_1$, $x_2$, …, $x_n$ appear as late as possible.\n\nIf multiple generators satisfy the requirement, output the lexicographically smallest one.", "hint": "Constraints\n\n- For 30% of the testdata, $n \\le 10$.\n- For 50% of the testdata, $n \\le 200$.\n- For 90% of the testdata, $n \\le 30000$.\n- For 100% of the testdata, $n \\le 500000$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SHOI2012] 排序", "background": "SHOI2012 D2T2\n", "description": "众所周知，1~n 的全排列包含 n!个排列。通常情况下，我们在生成全排列时都按照他们的字典序生成的。而在本题中，我们就将要考虑一种特殊的全排列生成方式。\n\n具体的，生成的全排列的顺序是由一个生成器决定的。\n\n(1) 生成器本身也是一个 1~n 的排列：$a_1$ , $a_2$ , …, $a_n$ 。\n\n(2) 对于两个不相同的 1~n 的 $x_1$ , $x_2$ , …, $x_n$ 、$y_1$ , $y_2$ , …, $y_n$ 排列而言，首先找到最小的 i，使得 $x_{ai}$ 与 $y_{ai}$ 不相等。\n\n(3) 根据(2)中选择的 i，如果 $x_{ai}$ 在排列 $a_1$ , $a_2$ , …, $a_n$ 中排在 $y_{ai}$ 之前，那么 $x_1$ ,$x_2$ , …, $x_n$ 就会在 $y_1$ , $y_2$ , …, $y_n$ 之前生成。\n\n例如，当 n = 3，生成器为 132 时，1~n 的全排列的生成顺序为：123，132，321，312，231，213。\n\n输入一个排列 $x_1$ , $x_2$, …, $x_n$ ，问，哪个生成器能使得这个排列在所有的排列中尽可能早的生成，哪个生成器能使得这个排列在所有的排列中尽可能晚的生成。\n\n如果有多种生成器能达到要求，那么请输出字典序最小的符合要求的生成器。\n", "inputFormat": "输入的第一行是整数 n，第二行是 1~n 的一个排列 $x_1$ , $x_2$ , …, $x_n$ 。\n", "outputFormat": "输出的第一行是一个 1~n 的排列，表示让 $x_1$ , $x_2$ , …, $x_n$ 尽早输出的生成器。\n\n输出的第二行是一个 1~n 的排列，表示让 $x_1$ , $x_2$ , …, $x_n$ 尽晚输出的生成器。\n\n如果有多种生成器能达到要求，那么请输出字典序最小的符合要求的生成器。\n", "hint": "对于 30%的数据，有 n ≤ 10；\n\n对于 50%的数据，有 n ≤ 200；\n\n对于 90%的数据，有 n ≤ 30000；\n\n对于 100%的数据，有 n ≤ 500000。\n", "locale": "zh-CN"}}}
{"pid": "P3833", "type": "P", "difficulty": 5, "samples": [["4\n0 1\n1 2\n2 3\n4\nA 1 3 1\nQ 0\nQ 1\nQ 2", "3\n3\n2"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000, 128000]}, "tags": ["2012", "线段树", "倍增", "各省省选", "上海", "最近公共祖先 LCA", "树链剖分"], "title": "[SHOI2012] 魔法树", "background": "SHOI2012 D2T3\n", "description": "Harry Potter 新学了一种魔法：可以改变树上的果子个数。满心欢喜的他找到了一个巨大的果树，来试验他的新法术。\n\n这棵果树共有 $N$ 个节点，其中节点 $0$ 是根节点，每个节点 $u$ 的父亲记为 $fa[u]$，保证有 $fa[u] < u$ 。初始时，这棵果树上的果子都被 Dumbledore 用魔法清除掉了，所以这个果树的每个节点上都没有果子（即 $0$ 个果子）。\n\n不幸的是，Harry 的法术学得不到位，只能对树上一段路径的节点上的果子个数统一增加一定的数量。也就是说，Harry 的魔法可以这样描述：`A u v d` 。表示将点 $u$ 和 $v$ 之间的路径上的所有节点的果子个数都加上 $d$。\n\n接下来，为了方便检验 Harry 的魔法是否成功，你需要告诉他在释放魔法的过程中的一些有关果树的信息：`Q u`。表示当前果树中，以点 $u$ 为根的子树中，总共有多少个果子？\n", "inputFormat": "第一行一个正整数 $N (1 \\leq N \\leq 100000)$，表示果树的节点总数，节点以 $0,1,\\dots,N - 1$ 标号，$0$ 一定代表根节点。\n\n接下来 $N - 1$ 行，每行两个整数 $a,b (0 \\leq a < b < N)$，表示 $a$ 是 $b$ 的父亲。\n\n接下来是一个正整数 $Q(1 \\leq Q \\leq 100000)$，表示共有 $Q$ 次操作。\n\n后面跟着 $Q$ 行，每行是以下两种中的一种：\n\n1. `A u v d`，表示将 $u$ 到 $v$ 的路径上的所有节点的果子数加上 $d$。保证 $0 \\leq u,v < N,0 < d < 100000$\n\n2. `Q u`，表示询问以 $u$ 为根的子树中的总果子数，注意是包括 $u$ 本身的。\n", "outputFormat": "对于所有的 `Q` 操作，依次输出询问的答案，每行一个。答案可能会超过 $2^{32}$ ，但不会超过 $10^{15}$ 。\n", "hint": "", "locale": "zh-CN", "translations": {"en": {"title": "[SHOI2012] Magic Tree", "background": "SHOI2012 D2T3.", "description": "Harry Potter has learned a new kind of magic: he can change the number of fruits on a tree. Overjoyed, he found a huge fruit tree to test his new spell.\n\nThis fruit tree has $N$ nodes. Node $0$ is the root, and the parent of each node $u$ is denoted by $fa[u]$, with the guarantee that $fa[u] < u$. Initially, all the fruits on this tree were removed by Dumbledore’s magic, so every node on this fruit tree has no fruits (that is, $0$ fruits).\n\nUnfortunately, Harry’s magic is not yet perfect; he can only uniformly increase the number of fruits on all nodes along a path in the tree by a fixed amount. In other words, Harry’s magic can be described as: `A u v d`. This means adding $d$ to the number of fruits on every node on the path between nodes $u$ and $v$.\n\nNext, to help check whether Harry’s magic is working, you need to tell him some information about the fruit tree during the process: `Q u`. This asks for the total number of fruits currently in the subtree rooted at node $u$.", "inputFormat": "The first line contains a positive integer $N$ $(1 \\leq N \\leq 100000)$, the total number of nodes in the fruit tree. Nodes are labeled $0, 1, \\dots, N - 1$, and $0$ is the root.\n\nThe next $N - 1$ lines each contain two integers $a, b$ $(0 \\leq a < b < N)$, indicating that $a$ is the parent of $b$.\n\nThen follows a positive integer $Q$ $(1 \\leq Q \\leq 100000)$, the number of operations.\n\nThen there are $Q$ lines, each being one of the following two types:\n1. `A u v d`: Add $d$ to the number of fruits on every node along the path from $u$ to $v$. It is guaranteed that $0 \\leq u, v < N$, $0 < d < 100000$.\n2. `Q u`: Query the total number of fruits in the subtree rooted at $u$, including $u$ itself.", "outputFormat": "For every `Q` operation, output the answer in order, one per line. The answer may exceed $2^{32}$, but will not exceed $10^{15}$.", "hint": "\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "[SHOI2012] 魔法树", "background": "SHOI2012 D2T3\n", "description": "Harry Potter 新学了一种魔法：可以改变树上的果子个数。满心欢喜的他找到了一个巨大的果树，来试验他的新法术。\n\n这棵果树共有 $N$ 个节点，其中节点 $0$ 是根节点，每个节点 $u$ 的父亲记为 $fa[u]$，保证有 $fa[u] < u$ 。初始时，这棵果树上的果子都被 Dumbledore 用魔法清除掉了，所以这个果树的每个节点上都没有果子（即 $0$ 个果子）。\n\n不幸的是，Harry 的法术学得不到位，只能对树上一段路径的节点上的果子个数统一增加一定的数量。也就是说，Harry 的魔法可以这样描述：`A u v d` 。表示将点 $u$ 和 $v$ 之间的路径上的所有节点的果子个数都加上 $d$。\n\n接下来，为了方便检验 Harry 的魔法是否成功，你需要告诉他在释放魔法的过程中的一些有关果树的信息：`Q u`。表示当前果树中，以点 $u$ 为根的子树中，总共有多少个果子？\n", "inputFormat": "第一行一个正整数 $N (1 \\leq N \\leq 100000)$，表示果树的节点总数，节点以 $0,1,\\dots,N - 1$ 标号，$0$ 一定代表根节点。\n\n接下来 $N - 1$ 行，每行两个整数 $a,b (0 \\leq a < b < N)$，表示 $a$ 是 $b$ 的父亲。\n\n接下来是一个正整数 $Q(1 \\leq Q \\leq 100000)$，表示共有 $Q$ 次操作。\n\n后面跟着 $Q$ 行，每行是以下两种中的一种：\n\n1. `A u v d`，表示将 $u$ 到 $v$ 的路径上的所有节点的果子数加上 $d$。保证 $0 \\leq u,v < N,0 < d < 100000$\n\n2. `Q u`，表示询问以 $u$ 为根的子树中的总果子数，注意是包括 $u$ 本身的。\n", "outputFormat": "对于所有的 `Q` 操作，依次输出询问的答案，每行一个。答案可能会超过 $2^{32}$ ，但不会超过 $10^{15}$ 。\n", "hint": "", "locale": "zh-CN"}}}
{"pid": "P3834", "type": "P", "difficulty": 5, "samples": [["5 5\n25957 6405 15770 26287 26465 \n2 2 1\n3 4 1\n4 5 1\n1 2 2\n4 4 1\n", "6405\n15770\n26287\n25957\n26287\n"]], "limits": {"time": [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], "memory": [1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576]}, "tags": ["莫队", "线段树", "离散化", "O2优化", "可持久化线段树", "可持久化", "分块", "整体二分", "模板题"], "title": "【模板】可持久化线段树 2", "background": "这是个非常经典的可持久化权值线段树入门题——静态区间第 $k$ 小。", "description": "如题，给定 $n$ 个整数构成的序列 $a$，将对于指定的闭区间 $[l, r]$ 查询其区间内的第 $k$ 小值。\n", "inputFormat": "第一行包含两个整数，分别表示序列的长度 $n$ 和查询的个数 $m$。  \n第二行包含 $n$ 个整数，第 $i$ 个整数表示序列的第 $i$ 个元素 $a_i$。   \n接下来 $m$ 行每行包含三个整数 $ l, r, k$ , 表示查询区间 $[l, r]$ 内的第 $k$ 小值。\n", "outputFormat": "对于每次询问，输出一行一个整数表示答案。", "hint": "### 样例 1 解释\n\n$n=5$，数列长度为 $5$，数列从第一项开始依次为 $\\{25957, 6405, 15770, 26287, 26465\\}$。\n\n- 第一次查询为 $[2, 2]$ 区间内的第一小值，即为 $6405$。\n- 第二次查询为 $[3, 4]$ 区间内的第一小值，即为 $15770$。\n- 第三次查询为 $[4, 5]$ 区间内的第一小值，即为 $26287$。\n- 第四次查询为 $[1, 2]$ 区间内的第二小值，即为 $25957$。\n- 第五次查询为 $[4, 4]$ 区间内的第一小值，即为 $26287$。\n\n\n### 数据规模与约定\n\n- 对于 $10\\%$ 的数据，满足 $1 \\leq n,m \\leq 10$。\n- 对于 $25\\%$ 的数据，满足 $1 \\leq n,m \\leq 10^3$。\n- 对于 $40\\%$ 的数据，满足 $1 \\leq n,m \\leq 10^5$。\n- 对于 $50\\%$ 的数据，满足 $1 \\leq n,m \\leq 2\\times 10^5$，$0\\le a_i \\leq 2\\times 10^5$。\n- 对于所有数据，满足 $1 \\leq n,m \\leq 2\\times 10^5$，$0\\le a_i \\leq 10^9$，$1 \\leq l \\leq r \\leq n$，$1 \\leq k \\leq r - l + 1$。", "locale": "zh-CN", "translations": {"en": {"title": "[Template] Persistent Segment Tree 2", "background": "This is a very classic introductory problem on the persistent value segment tree (权值线段树) — the static range $ k $-th smallest query.", "description": "As stated, given a sequence $ a $ of $ n $ integers, for each specified closed interval $ [l, r] $, query the $ k $-th smallest value within the interval.", "inputFormat": "The first line contains two integers, the length $ n $ of the sequence and the number $ m $ of queries.  \nThe second line contains $ n $ integers; the $ i $-th integer is the $ i $-th element $ a_i $ of the sequence.  \nEach of the next $ m $ lines contains three integers $ l, r, k $, denoting the $ k $-th smallest value within the range $ [l, r] $.", "outputFormat": "For each query, output one line with a single integer, the answer.", "hint": "### Sample 1 Explanation\n\n$n=5$, the sequence length is $5$, and the sequence from the first term is $\\{25957, 6405, 15770, 26287, 26465\\}$.\n\n- The first query asks for the first smallest value in $[2, 2]$, which is $6405$.\n- The second query asks for the first smallest value in $[3, 4]$, which is $15770$.\n- The third query asks for the first smallest value in $[4, 5]$, which is $26287$.\n- The fourth query asks for the second smallest value in $[1, 2]$, which is $25957$.\n- The fifth query asks for the first smallest value in $[4, 4]$, which is $26287$.\n\n### Constraints\n\n- For $10\\%$ of the testdata, $1 \\leq n,m \\leq 10$.\n- For $25\\%$ of the testdata, $1 \\leq n,m \\leq 10^3$.\n- For $40\\%$ of the testdata, $1 \\leq n,m \\leq 10^5$.\n- For $50\\%$ of the testdata, $1 \\leq n,m \\leq 2\\times 10^5$, $0\\le a_i \\leq 2\\times 10^5$.\n- For all testdata, $1 \\leq n,m \\leq 2\\times 10^5$, $0\\le a_i \\leq 10^9$, $1 \\leq l \\leq r \\leq n$, $1 \\leq k \\leq r - l + 1$.\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】可持久化线段树 2", "background": "这是个非常经典的可持久化权值线段树入门题——静态区间第 $k$ 小。", "description": "如题，给定 $n$ 个整数构成的序列 $a$，将对于指定的闭区间 $[l, r]$ 查询其区间内的第 $k$ 小值。\n", "inputFormat": "第一行包含两个整数，分别表示序列的长度 $n$ 和查询的个数 $m$。  \n第二行包含 $n$ 个整数，第 $i$ 个整数表示序列的第 $i$ 个元素 $a_i$。   \n接下来 $m$ 行每行包含三个整数 $ l, r, k$ , 表示查询区间 $[l, r]$ 内的第 $k$ 小值。\n", "outputFormat": "对于每次询问，输出一行一个整数表示答案。", "hint": "### 样例 1 解释\n\n$n=5$，数列长度为 $5$，数列从第一项开始依次为 $\\{25957, 6405, 15770, 26287, 26465\\}$。\n\n- 第一次查询为 $[2, 2]$ 区间内的第一小值，即为 $6405$。\n- 第二次查询为 $[3, 4]$ 区间内的第一小值，即为 $15770$。\n- 第三次查询为 $[4, 5]$ 区间内的第一小值，即为 $26287$。\n- 第四次查询为 $[1, 2]$ 区间内的第二小值，即为 $25957$。\n- 第五次查询为 $[4, 4]$ 区间内的第一小值，即为 $26287$。\n\n\n### 数据规模与约定\n\n- 对于 $10\\%$ 的数据，满足 $1 \\leq n,m \\leq 10$。\n- 对于 $25\\%$ 的数据，满足 $1 \\leq n,m \\leq 10^3$。\n- 对于 $40\\%$ 的数据，满足 $1 \\leq n,m \\leq 10^5$。\n- 对于 $50\\%$ 的数据，满足 $1 \\leq n,m \\leq 2\\times 10^5$，$0\\le a_i \\leq 2\\times 10^5$。\n- 对于所有数据，满足 $1 \\leq n,m \\leq 2\\times 10^5$，$0\\le a_i \\leq 10^9$，$1 \\leq l \\leq r \\leq n$，$1 \\leq k \\leq r - l + 1$。", "locale": "zh-CN"}}}
{"pid": "P3835", "type": "P", "difficulty": 6, "samples": [["10\n0 1 9\n1 1 3\n1 1 10\n2 4 2\n3 3 9\n3 1 2\n6 4 1\n6 2 9\n8 6 3\n4 5 8", "9\n1\n2\n10\n3"]], "limits": {"time": [2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000], "memory": [1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864, 1572864]}, "tags": ["线段树", "平衡树", "深度优先搜索 DFS", "可持久化", "模板题"], "title": "【模板】可持久化平衡树", "background": "本题为题目 **普通平衡树** 的可持久化加强版。\n\n**数据已经经过强化**\n\n**感谢@Kelin 提供的一组hack数据**\n", "description": "您需要写一种数据结构（可参考题目标题），来维护一个可重整数集合，其中需要提供以下操作（ **对于各个以往的历史版本** ）：\n\n\n1、 插入 $x$\n\n2、 删除 $x$（若有多个相同的数，应只删除一个，**如果没有请忽略该操作**）\n\n\n3、 查询 $x$ 的排名（排名定义为比当前数小的数的个数 $+1$）\n\n\n4、查询排名为 $x$ 的数\n\n\n5、 求 $x$ 的前驱（前驱定义为小于 $x$，且最大的数，**如不存在输出** $-2^{31}+1$ ）\n\n\n6、求 $x$ 的后继（后继定义为大于 $x$，且最小的数，**如不存在输出** $2^{31}-1$ ）\n\n\n**和原本平衡树不同的一点是，每一次的任何操作都是基于某一个历史版本，同时生成一个新的版本。（操作3, 4, 5, 6即保持原版本无变化）**\n\n每个版本的编号即为操作的序号（版本0即为初始状态，空树）\n", "inputFormat": "第一行包含一个正整数 $n$ ，表示操作的总数。\n\n接下来 $n$ 行，每行包含三个整数，第 $i$ 行记为 $v_i, \\text{opt}_i, x_i$。\n\n$v_i$ 表示基于的过去版本号，$\\text{opt}_i$ 表示操作的序号， $x_i$ 表示参与操作的数值\n", "outputFormat": "每行包含一个整数，依次为各个 $3,4,5,6$ 操作所对应的答案\n", "hint": "【数据范围】   \n对于 $28\\%$ 的数据，$ 1 \\leq n \\leq 10 $；   \n对于 $44\\%$ 的数据，$ 1 \\leq n \\leq 2\\times {10}^2 $；   \n对于 $60\\%$ 的数据， $ 1 \\leq n \\leq 3\\times {10}^3 $；   \n对于 $84\\%$ 的数据， $ 1 \\leq n \\leq {10}^5 $；   \n对于 $92\\%$ 的数据， $ 1 \\leq n \\leq 2\\times {10}^5 $；   \n对于 $100\\%$ 的数据， $ 1 \\leq n \\leq 5 \\times  10^5 $ , $|x_i| \\leq {10}^9$，$0 \\le v_i < i$，$1\\le \\text{opt} \\le 6$。\n\n**经实测，正常常数的可持久化平衡树均可通过，请各位放心**\n\n\n\n样例说明：\n\n共 $10$ 次操作，$11$ 个版本，各版本的状况依次是：\n\n0.  $[]$\n\n1.  $[9]$\n\n2.  $[3, 9]$\n\n3.  $[9, 10]$\n\n4.  $[3, 9]$\n\n5.  $[9, 10]$\n\n6.  $[2, 9, 10]$\n\n7.  $[2, 9, 10]$\n\n8.  $[2, 10]$\n\n9.  $[2, 10]$\n\n10.  $[3, 9]$\n", "locale": "zh-CN", "translations": {"en": {"title": "[Template] Persistent Balanced Tree", "background": "This problem is a persistent enhanced version of the problem Ordinary Balanced Tree.\n\nThe testdata has been strengthened.\n\nThanks to @Kelin for providing a set of hack testdata.", "description": "You need to implement a data structure (refer to the problem title) to maintain a multiset of integers, and support the following operations for each historical version:\n\n1. Insert $x$.\n\n2. Delete $x$ (if there are multiple equal numbers, delete only one; if none exists, ignore this operation).\n\n3. Query the rank of $x$ (rank is defined as the number of elements strictly less than $x$, plus $1$).\n\n4. Query the number whose rank is $x$.\n\n5. Query the predecessor of $x$ (the predecessor is defined as the largest number strictly less than $x$; if it does not exist, output $-2^{31}+1$).\n\n6. Query the successor of $x$ (the successor is defined as the smallest number strictly greater than $x$; if it does not exist, output $2^{31}-1$).\n\nUnlike the original balanced tree, every operation here is based on some historical version and produces a new version. (Operations 3, 4, 5, 6 do not modify the original version.)\n\nEach version is numbered by the operation index (version $0$ is the initial state, an empty tree).", "inputFormat": "The first line contains a positive integer $n$, the total number of operations.\n\nThe next $n$ lines each contain three integers. On the $i$-th line, they are $v_i, \\text{opt}_i, x_i$.\n\n$v_i$ is the index of the past version to base on, $\\text{opt}_i$ is the operation type, and $x_i$ is the value involved in the operation.", "outputFormat": "Each line contains one integer, in order, corresponding to the answers for operations $3, 4, 5, 6$.", "hint": "Constraints  \nFor $28\\%$ of the testdata, $1 \\leq n \\leq 10$.  \nFor $44\\%$ of the testdata, $1 \\leq n \\leq 2 \\times 10^2$.  \nFor $60\\%$ of the testdata, $1 \\leq n \\leq 3 \\times 10^3$.  \nFor $84\\%$ of the testdata, $1 \\leq n \\leq 10^5$.  \nFor $92\\%$ of the testdata, $1 \\leq n \\leq 2 \\times 10^5$.  \nFor $100\\%$ of the testdata, $1 \\leq n \\leq 5 \\times 10^5$, $|x_i| \\leq 10^9$, $0 \\le v_i < i$, $1 \\le \\text{opt} \\le 6$.\n\nEmpirically, persistent balanced trees with normal constant factors can pass. Please rest assured.\n\nSample explanation:\n\nThere are $10$ operations and $11$ versions. The states of each version are:\n\n0. $[]$  \n1. $[9]$  \n2. $[3, 9]$  \n3. $[9, 10]$  \n4. $[3, 9]$  \n5. $[9, 10]$  \n6. $[2, 9, 10]$  \n7. $[2, 9, 10]$  \n8. $[2, 10]$  \n9. $[2, 10]$  \n10. $[3, 9]$\n\nTranslated by ChatGPT 5", "locale": "en"}, "zh-CN": {"title": "【模板】可持久化平衡树", "background": "本题为题目 **普通平衡树** 的可持久化加强版。\n\n**数据已经经过强化**\n\n**感谢@Kelin 提供的一组hack数据**\n", "description": "您需要写一种数据结构（可参考题目标题），来维护一个可重整数集合，其中需要提供以下操作（ **对于各个以往的历史版本** ）：\n\n\n1、 插入 $x$\n\n2、 删除 $x$（若有多个相同的数，应只删除一个，**如果没有请忽略该操作**）\n\n\n3、 查询 $x$ 的排名（排名定义为比当前数小的数的个数 $+1$）\n\n\n4、查询排名为 $x$ 的数\n\n\n5、 求 $x$ 的前驱（前驱定义为小于 $x$，且最大的数，**如不存在输出** $-2^{31}+1$ ）\n\n\n6、求 $x$ 的后继（后继定义为大于 $x$，且最小的数，**如不存在输出** $2^{31}-1$ ）\n\n\n**和原本平衡树不同的一点是，每一次的任何操作都是基于某一个历史版本，同时生成一个新的版本。（操作3, 4, 5, 6即保持原版本无变化）**\n\n每个版本的编号即为操作的序号（版本0即为初始状态，空树）\n", "inputFormat": "第一行包含一个正整数 $n$ ，表示操作的总数。\n\n接下来 $n$ 行，每行包含三个整数，第 $i$ 行记为 $v_i, \\text{opt}_i, x_i$。\n\n$v_i$ 表示基于的过去版本号，$\\text{opt}_i$ 表示操作的序号， $x_i$ 表示参与操作的数值\n", "outputFormat": "每行包含一个整数，依次为各个 $3,4,5,6$ 操作所对应的答案\n", "hint": "【数据范围】   \n对于 $28\\%$ 的数据，$ 1 \\leq n \\leq 10 $；   \n对于 $44\\%$ 的数据，$ 1 \\leq n \\leq 2\\times {10}^2 $；   \n对于 $60\\%$ 的数据， $ 1 \\leq n \\leq 3\\times {10}^3 $；   \n对于 $84\\%$ 的数据， $ 1 \\leq n \\leq {10}^5 $；   \n对于 $92\\%$ 的数据， $ 1 \\leq n \\leq 2\\times {10}^5 $；   \n对于 $100\\%$ 的数据， $ 1 \\leq n \\leq 5 \\times  10^5 $ , $|x_i| \\leq {10}^9$，$0 \\le v_i < i$，$1\\le \\text{opt} \\le 6$。\n\n**经实测，正常常数的可持久化平衡树均可通过，请各位放心**\n\n\n\n样例说明：\n\n共 $10$ 次操作，$11$ 个版本，各版本的状况依次是：\n\n0.  $[]$\n\n1.  $[9]$\n\n2.  $[3, 9]$\n\n3.  $[9, 10]$\n\n4.  $[3, 9]$\n\n5.  $[9, 10]$\n\n6.  $[2, 9, 10]$\n\n7.  $[2, 9, 10]$\n\n8.  $[2, 10]$\n\n9.  $[2, 10]$\n\n10.  $[3, 9]$\n", "locale": "zh-CN"}}}
